"use strict";(self.webpackChunkcognik_web_app=self.webpackChunkcognik_web_app||[]).push([[4987],{50764:function(Y,G,e){e.r(G),e.d(G,{default:function(){return ve}});var k=e(26068),c=e.n(k),Z=e(48305),u=e.n(Z),K=e(46896),g=e(39530),h=e(86487),W=e(87146),o=e(75271),T=e(32699),t=e(52676),J=function(p){var U=(0,h.useSearchParams)(),y=u()(U,2),R=y[0],F=y[1],C=(0,o.useRef)(null),S=(0,h.useRequest)(function(){return(0,g.Ij)(c()({},p))}),j=S.data,E=(0,h.useRequest)(function(){return(0,g.J1)({projectId:Number.parseInt(R.get("projectId")||"0")})}),x=E.data;return console.log("schema graph init"),(0,o.useEffect)(function(){if(x&&j){var B,M,D=new W.kJ({container:C.current,autoFit:"view",node:{type:"circle",style:{type:"circle",labelText:function(N){return N.label},fill:"#5CA5FF"}},edge:{type:"cubic-horizontal",animation:{enter:!1},style:{stroke:"#ccc",endArrow:!0,labelText:function(N){return N.label}}},layout:{type:"radial",nodeSize:32,unitRadius:200,linkDistance:500,preventOverlap:!0,maxPreventOverlapIteration:100,strictRadial:!1},behaviors:[{type:"click-select",degree:1,state:"active",unselectedState:"inactive",multiple:!0,trigger:["shift"]},"drag-canvas","zoom-canvas","drag-element","hover-activate"]});D.addData({nodes:(0,T.uniqBy)(x==null||(B=x.entityTypeDTOList)===null||B===void 0?void 0:B.map(function(_){return{id:"node-"+_.id,type:"circle",label:_.nameZh}}),"id"),edges:(0,T.uniqBy)(j==null||(M=j.relationTypeDTOList)===null||M===void 0?void 0:M.map(function(_){return{id:"edge-"+_.startEntity.id+"-"+_.endEntity.id,source:"node-"+_.startEntity.id,target:"node-"+_.endEntity.id,label:_.nameZh}}),"id")}),D.render()}},[x,j]),(0,t.jsx)("div",{style:{border:"1px solid #e8e8e8",backgroundColor:"#e8e8e8",height:"800px"},ref:C})},I=o.memo(J),w=e(60359),P=e(24390),b=e(71417),m=e(56192),s=e(67709),d=e(21945),r=e(57228),l=e(72254),n=e(78422),ue=e(78581),q=e(32917),le=e(82092),ee=e.n(le),ie=e(26551),oe=(0,ie.kc)(function(H){var p=H.token;return{main:{".ant-descriptions-row > td":{paddingBottom:"8px"},".ant-page-header-heading-extra":{flexDirection:"column"}},headerList:{marginBottom:"4px",".ant-descriptions-row > td":{paddingBottom:"8px"}},stepDescription:ee()({position:"relative",left:"38px",paddingTop:"8px",fontSize:"14px",textAlign:"left","> div":{marginTop:"8px",marginBottom:"4px"}},"@media screen and (max-width: ".concat(p.screenSM,"px)"),{left:"8px"}),pageHeader:ee()({".ant-page-header-heading-extra > * + *":{marginLeft:"8px"}},"@media screen and (max-width: ".concat(p.screenSM,"px)"),{".ant-pro-page-header-wrap-row":{flexDirection:"column"}}),moreInfo:{display:"flex",justifyContent:"space-between",width:"200px"}}}),de=oe,ce=e(15558),te=e.n(ce),me=function(p){var U=(0,h.useSearchParams)(),y=u()(U,2),R=y[0],F=y[1],C=(0,o.useRef)(null),S=(0,h.useRequest)(function(){return(0,g.J1)({projectId:Number.parseInt(R.get("projectId")||"0")})}),j=S.data;return console.log("schema graph init"),(0,o.useEffect)(function(){var E,x,B;if(!(!j||!C.current)){var M=new W.kJ({container:C.current,autoFit:"view",node:{type:"circle",style:{type:"circle",labelText:function(O){return O.label}}},edge:{type:"cubic-horizontal",animation:{enter:!1},style:{stroke:"#ccc",endArrow:!0,labelText:function(O){return O.label}}},layout:{type:"radial",nodeSize:32,unitRadius:200,linkDistance:500,preventOverlap:!0,maxPreventOverlapIteration:100,strictRadial:!1},behaviors:[{type:"click-select",degree:1,state:"active",unselectedState:"inactive",multiple:!0,trigger:["shift"]},"drag-canvas","zoom-canvas","drag-element","hover-activate"]}),D=p==null||(E=p.subGraph)===null||E===void 0||(E=E.resultNodes)===null||E===void 0?void 0:E.map(function(i){return i.label}),_=[];j.entityTypeDTOList.forEach(function(i){D!=null&&D.includes(i.name)&&_.push({id:"node-"+i.id,type:"circle",label:i.nameZh,name:i.name,style:{size:60,fill:"#7FFFD4"}})}),console.log(_);var N=[],X=p==null||(x=p.subGraph)===null||x===void 0||(x=x.resultNodes)===null||x===void 0?void 0:x.map(function(i){if(_.length>0){var O=(0,T.find)(_,function(Q){return Q.name===i.label});if(O){var z;N.push({id:"type-edge-"+i.id+"-"+O.id,source:O.id,target:(z=i.id)===null||z===void 0?void 0:z.toString(),label:"typeOf",style:{stroke:"#5CACEE"}})}}return{id:i.id,type:"circle",label:i.name}}),V=(0,T.uniqBy)(p==null||(B=p.subGraph)===null||B===void 0?void 0:B.resultEdges,"id").map(function(i){return{id:i.id,source:i.from,target:i.to,label:i.label}});M.addData({nodes:[].concat(te()(X),_),edges:[].concat(te()(V),N)}),M.render()}},[j]),(0,t.jsx)("div",{style:{border:"1px solid #e8e8e8",backgroundColor:"#e8e8e8",height:"800px"},ref:C})},pe=o.memo(me),_e=function(){var p,U,y,R,F,C=de(),S=C.styles,j=(0,h.useSearchParams)(),E=u()(j,2),x=E[0],B=E[1],M=(0,o.useState)([]),D=u()(M,2),_=D[0],N=D[1],X=(0,o.useState)([]),V=u()(X,2),i=V[0],O=V[1],z=(0,o.useState)([]),Q=u()(z,2),ae=Q[0],he=Q[1],be=(0,o.useState)([]),re=u()(be,2),ne=re[0],fe=re[1],ge=(0,h.useRequest)(function(){return(0,g.nR)({id:Number.parseInt(x.get("taskId")||"0")})}),a=ge.data;(0,o.useEffect)(function(){a&&((0,g.Eq)(a).then(function(v){v.success&&N(v.result)}),(0,K.al)({id:a.taskId,jobId:a.id}).then(function(v){if(v.success&&v.result.resultMessage){var A=(0,q.V)(v.result),$=(0,T.sortBy)(A.resultMessage,function(Re){return Re.index});O($),he(A.resultNodes),fe(A.resultEdges)}}))},[a]);var f=(0,q.V)((a==null?void 0:a.extension)||"{}"),xe=(0,t.jsx)("div",{className:S.moreInfo,children:(0,t.jsx)(r.Z,{title:"\u72B6\u6001",value:(a==null?void 0:a.status)==="WAITING"?"\u7B49\u5F85":(a==null?void 0:a.status)==="RUNNING"?"\u8FD0\u884C\u4E2D":(a==null?void 0:a.status)==="ERROR"?"\u5F02\u5E38":"\u5DF2\u5B8C\u6210",prefix:(a==null?void 0:a.status)==="WAITING"?(0,t.jsx)(w.Z,{style:{color:"grey"}}):(a==null?void 0:a.status)==="RUNNING"?(0,t.jsx)(P.Z,{style:{color:"blue"}}):(a==null?void 0:a.status)==="ERROR"?(0,t.jsx)(b.Z,{style:{color:"red"}}):(0,t.jsx)(m.Z,{style:{color:"green"}})})}),ye=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Z,{className:S.headerList,size:"small",title:"\u57FA\u7840\u4FE1\u606F",children:[(0,t.jsx)(l.Z.Item,{label:"\u77E5\u8BC6\u540D\u79F0",children:a==null?void 0:a.jobName}),(0,t.jsx)(l.Z.Item,{label:"\u521B\u5EFA\u4EBA",children:a==null?void 0:a.createUser}),(0,t.jsx)(l.Z.Item,{label:"\u521B\u5EFA\u65F6\u95F4",children:a==null?void 0:a.gmtCreate}),(0,t.jsx)(l.Z.Item,{label:"\u4E0A\u4F20\u6587\u6863",children:(0,t.jsx)("a",{href:a==null?void 0:a.fileUrl,children:a==null?void 0:a.fileUrl.split("/").at(-1)})})]}),(0,t.jsxs)(l.Z,{className:S.headerList,size:"small",title:"\u5206\u6BB5\u914D\u7F6E",children:[(0,t.jsx)(l.Z.Item,{label:"\u5206\u6BB5\u65B9\u5F0F",children:f!=null&&(p=f.splitConfig)!==null&&p!==void 0&&p.semanticSplit?"\u8BED\u4E49\u5207\u5206":"\u4E0D\u4F7F\u7528\u8BED\u4E49\u5207\u5206"}),(0,t.jsx)(l.Z.Item,{label:"\u5206\u6BB5\u957F\u5EA6",children:f==null||(U=f.splitConfig)===null||U===void 0?void 0:U.splitLength})]}),(0,t.jsxs)(l.Z,{className:S.headerList,size:"small",title:"\u62BD\u53D6\u914D\u7F6E",children:[(0,t.jsxs)(l.Z.Item,{label:"\u62BD\u53D6\u6A21\u578B",children:[f==null||(y=f.extractConfig)===null||y===void 0||(y=y.llm)===null||y===void 0?void 0:y.model,"(",f==null||(R=f.extractConfig)===null||R===void 0||(R=R.llm)===null||R===void 0?void 0:R.desc,")"]}),(0,t.jsx)(l.Z.Item,{label:"\u9AD8\u7EA7\u914D\u7F6E",children:(f==null||(F=f.extractConfig)===null||F===void 0?void 0:F.llmPrompt)||"{}"})]})]}),je=(0,o.useState)({operationKey:"tab1",tabActiveKey:"detail"}),se=u()(je,2),L=se[0],Ee=se[1],Pe=function(A){Ee(c()(c()({},L),{},{tabActiveKey:A}))};return(0,t.jsx)(s._z,{title:a==null?void 0:a.jobName,className:S.pageHeader,content:ye,extraContent:xe,tabActiveKey:L.tabActiveKey,onTabChange:Pe,tabList:[{key:"detail",tab:"\u5206\u6BB5\u7ED3\u679C"},{key:"log",tab:"\u6267\u884C\u65E5\u5FD7"},{key:"extract_result",tab:"\u62BD\u53D6\u6548\u679C[\u62BD\u6837]"},{key:"extract_model",tab:"\u62BD\u53D6\u77E5\u8BC6\u6A21\u578B"}],children:(0,t.jsxs)("div",{className:S.main,children:[L.tabActiveKey==="detail"&&(0,t.jsx)(n.Z,{size:"large",header:!1,footer:!1,bordered:!0,dataSource:_,renderItem:function(A,$){return(0,t.jsx)(n.Z.Item,{children:(0,t.jsx)(d.gm,{lines:3,children:A},$)})}}),L.tabActiveKey==="log"&&(0,t.jsx)(ue.Z,{items:i.map(function(v){return{dot:v.status==="WAITING"?(0,t.jsx)(w.Z,{}):v.status==="RUNNING"?(0,t.jsx)(P.Z,{}):v.status==="ERROR"?(0,t.jsx)(b.Z,{}):(0,t.jsx)(m.Z,{}),color:v.status==="WAITING"?"gray":v.status==="RUNNING"?"blue":v.status==="ERROR"?"red":"green",children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:v.name}),v.traceLog.split(`
`).map(function(A,$){return(0,t.jsx)("p",{children:A},$)})]})}})}),L.tabActiveKey==="extract_result"&&(0,t.jsx)(pe,{job:a,subGraph:{resultEdges:ne,resultNodes:ae}}),L.tabActiveKey==="extract_model"&&(0,t.jsx)(I,{job:a,subGraph:{resultEdges:ne,resultNodes:ae}})]})})},ve=_e},39530:function(Y,G,e){e.d(G,{Eq:function(){return T},Ij:function(){return J},J1:function(){return w},nR:function(){return W}});var k=e(90228),c=e.n(k),Z=e(26068),u=e.n(Z),K=e(87999),g=e.n(K),h=e(86487);function W(b,m){return o.apply(this,arguments)}function o(){return o=g()(c()().mark(function b(m,s){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,h.request)("/api/public/v1/builder/job/get",u()({method:"GET",params:u()({},m)},s||{})).then(function(l){return{data:l.result}}));case 1:case"end":return r.stop()}},b)})),o.apply(this,arguments)}function T(b,m){return t.apply(this,arguments)}function t(){return t=g()(c()().mark(function b(m,s){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,h.request)("/api/public/v1/builder/job/split/preview",u()({data:m,method:"POST"},s||{})));case 1:case"end":return r.stop()}},b)})),t.apply(this,arguments)}function J(b,m){return I.apply(this,arguments)}function I(){return I=g()(c()().mark(function b(m,s){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,h.request)("/api/public/v1/builder/job/schema/diff",u()({data:m,method:"POST"},s||{})).then(function(l){return{data:l.result}}));case 1:case"end":return r.stop()}},b)})),I.apply(this,arguments)}function w(b,m){return P.apply(this,arguments)}function P(){return P=g()(c()().mark(function b(m,s){return c()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,h.request)("/api/v1/schemas/graph/".concat(m.projectId),u()({method:"GET",params:u()({},m)},s||{})).then(function(l){return{data:l.result}}));case 1:case"end":return r.stop()}},b)})),P.apply(this,arguments)}},46896:function(Y,G,e){e.d(G,{_5:function(){return b},al:function(){return T},jR:function(){return W}});var k=e(90228),c=e.n(k),Z=e(26068),u=e.n(Z),K=e(87999),g=e.n(K),h=e(86487);function W(s,d){return o.apply(this,arguments)}function o(){return o=g()(c()().mark(function s(d,r){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,h.request)("/api/public/v1/builder/job/list",u()({method:"GET",params:u()({},d)},r||{})));case 1:case"end":return n.stop()}},s)})),o.apply(this,arguments)}function T(s,d){return t.apply(this,arguments)}function t(){return t=g()(c()().mark(function s(d,r){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,h.request)("/api/public/v1/reasoner/task/builder/query",u()({method:"GET",params:u()({},d)},r||{})));case 1:case"end":return n.stop()}},s)})),t.apply(this,arguments)}function J(s,d){return I.apply(this,arguments)}function I(){return I=_asyncToGenerator(_regeneratorRuntime().mark(function s(d,r){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/rule",_objectSpread({data:d,method:"PUT"},r||{})));case 1:case"end":return n.stop()}},s)})),I.apply(this,arguments)}function w(s,d){return P.apply(this,arguments)}function P(){return P=_asyncToGenerator(_regeneratorRuntime().mark(function s(d,r){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",request("/api/rule",_objectSpread({data:d,method:"POST"},r||{})));case 1:case"end":return n.stop()}},s)})),P.apply(this,arguments)}function b(s,d){return m.apply(this,arguments)}function m(){return m=g()(c()().mark(function s(d,r){return c()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(0,h.request)("/api/public/v1/builder/job/delete",u()({method:"GET",params:u()({},d)},r||{})));case 1:case"end":return n.stop()}},s)})),m.apply(this,arguments)}}}]);
