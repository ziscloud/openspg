"use strict";(self.webpackChunkcognik_web_app=self.webpackChunkcognik_web_app||[]).push([[8609],{71769:function(ie,I,r){r.r(I),r.d(I,{default:function(){return Ee}});var R=r(26068),o=r.n(R),O=r(90228),l=r.n(O),Z=r(87999),p=r.n(Z),_=r(48305),v=r.n(_),b=r(86487);function w(D,S){return E.apply(this,arguments)}function E(){return E=p()(l()().mark(function D(S,L){return l()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,b.request)("/api/public/v1/builder/job/submit",o()({data:S,method:"POST"},L||{})));case 1:case"end":return m.stop()}},D)})),E.apply(this,arguments)}function M(D,S){return F.apply(this,arguments)}function F(){return F=p()(l()().mark(function D(S,L){return l()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,b.request)("/api/v1/datas/getLlmSelect",o()({method:"GET",params:o()({},S)},L||{})).then(function(P){return{data:P.result}}));case 1:case"end":return m.stop()}},D)})),F.apply(this,arguments)}var N=r(39530),A=r(13564),d=r(67709),c=r(66918),h=r(14378),x=r(37520),i=r(15837),j=r(91592),oe=r(45343),ce=r(29808),de=r(16331),pe=r(69230),me=r(84336),fe=r(77758),W=r(68658),G=r(83616),Q=r(71158),Y=r(78422),ve=r(34937),y=r(75271),he=r(26551),ge=(0,he.kc)(function(){return{card:{marginBottom:"24px"},result:{maxWidth:"560px",margin:"0 auto",padding:"24px 0 8px"}}}),be=ge,t=r(52676),Ce=function(){var S=be(),L=S.styles,K=(0,b.useSearchParams)(),m=v()(K,2),P=m[0],We=m[1],Fe=pe.ZP.useMessage(),q=v()(Fe,2),k=q[0],je=q[1],ye=(0,y.useState)([]),ee=v()(ye,2),z=ee[0],Se=ee[1],Be=(0,y.useState)(!1),re=v()(Be,2),_e=re[0],J=re[1],xe=(0,y.useState)(!1),te=v()(xe,2),De=te[0],H=te[1],Pe=(0,b.useNavigate)(),Te=(0,y.useState)({dataSourceConfig_structure:"unstructuredContent",type:"FILE_EXTRACT",splitConfig_splitLength:2e3,receiverMode:"alipay",jobName:""}),ue=v()(Te,2),g=ue[0],V=ue[1],Ae=(0,y.useState)(0),ne=v()(Ae,2),Ue=ne[0],$e=ne[1],Ie=(0,y.useState)([]),ae=v()(Ie,2),Le=ae[0],Re=ae[1],se=(0,y.useRef)(),Oe=me.Z.useToken(),X=Oe.token,Ze=X.colorBgContainer,we=X.colorFillAlter,Me=X.borderRadiusLG,Ne={background:we,borderRadius:Me,border:"none"};return(0,t.jsxs)(d._z,{content:"\u5C06\u4E00\u4E2A\u5197\u957F\u6216\u7528\u6237\u4E0D\u719F\u6089\u7684\u8868\u5355\u4EFB\u52A1\u5206\u6210\u591A\u4E2A\u6B65\u9AA4\uFF0C\u6307\u5BFC\u7528\u6237\u5B8C\u6210\u3002",children:[je,(0,t.jsx)(fe.Z,{variant:"outlined",children:(0,t.jsxs)(c.L0,{formRef:se,current:Ue,onCurrentChange:$e,submitter:{render:function(u,a){return u.step===1?[(0,t.jsx)(W.ZP,{loading:_e,type:"primary",onClick:function(){var e,n,C={projectId:Number.parseInt(P.get("projectId")||"0"),jobName:g.jobName,type:g.type,createUser:"openspg",lifeCycle:"ONCE",action:"UPSERT",computingConf:"",dependence:"INDEPENDENT",cron:"0 0 0 * * ?",fileUrl:(e=g.fileUrl[0])===null||e===void 0||(e=e.response)===null||e===void 0?void 0:e.result,dataSourceType:(n=g.fileUrl[0])===null||n===void 0||(n=n.name)===null||n===void 0||(n=n.split("."))===null||n===void 0||(n=n.pop())===null||n===void 0?void 0:n.toUpperCase(),extension:JSON.stringify({splitConfig:{splitLength:g.splitConfig_splitLength,semanticSplit:!!g.splitConfig_semanticSplit}})};J(!0),(0,N.Eq)(C).then(function(B){B.success&&(Se(B.result.map(function(T,U){return{id:U,content:T}})),J(!1))}).catch(function(B){k.open({type:"error",content:B.message}),J(!1)})},children:"\u9884\u89C8\u62BD\u53D6\u7ED3\u679C"},"preview"),(0,t.jsx)(W.ZP,{onClick:function(){var e;return(e=u.onPre)===null||e===void 0?void 0:e.call(u)},children:"\u4E0A\u4E00\u6B65"},"pre"),(0,t.jsx)(W.ZP,{type:"primary",onClick:function(){var e;return(e=u.onSubmit)===null||e===void 0?void 0:e.call(u)},children:"\u4E0B\u4E00\u6B65"},"goToTree")]:a},submitButtonProps:{loading:De}},onFinish:function(){var f=p()(l()().mark(function u(a){var s,e,n,C,B,T,U;return l()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return H(!0),B={jobName:a.jobName,type:a.type,lifeCycle:"ONCE",action:"UPSERT",projectId:Number.parseInt(P.get("projectId")||"0"),createUser:"openspg",dataSourceType:(s=a.fileUrl[0])===null||s===void 0||(s=s.name)===null||s===void 0||(s=s.split("."))===null||s===void 0||(s=s.pop())===null||s===void 0?void 0:s.toUpperCase(),fileUrl:(e=a.fileUrl[0])===null||e===void 0||(e=e.response)===null||e===void 0?void 0:e.result,extension:JSON.stringify({dataSourceConfig:{columns:[],type:"UPLOAD",fileName:(n=a.fileUrl[0])===null||n===void 0?void 0:n.name,fileUrl:(C=a.fileUrl[0])===null||C===void 0||(C=C.response)===null||C===void 0?void 0:C.result,ignoreHeader:!0,structure:!1},splitConfig:{splitLength:a.splitConfig_splitLength,semanticSplit:!!a.splitConfig_semanticSplit},extractConfig:{llm:JSON.stringify(Le.find(function(le){return le.llm_id===a.extractConfig_llm})||""),llmPrompt:"",autoSchema:!0,autoWrite:!0}})},$.next=4,w(B);case 4:T=$.sent,T.success?((U=se.current)===null||U===void 0||U.resetFields(),k.success({content:"\u63D0\u4EA4\u6210\u529F, 3\u79D2\u540E\u81EA\u52A8\u8DF3\u8F6C\u5230 \u201C\u6784\u5EFA\u4EFB\u52A1\u5217\u8868\u201D",onClose:function(){H(!1),Pe("/knowledgebase/kb-list/modeling?projectId=".concat(P.get("projectId")))},duration:3})):(k.error((0,t.jsxs)("div",{style:{maxWidth:"300px"},children:[(0,t.jsx)(G.Z.Title,{level:3,children:T.errorCode}),(0,t.jsx)(G.Z.Paragraph,{copyable:!0,ellipsis:{rows:5},children:T.errorMessage})]})),H(!1));case 6:case"end":return $.stop()}},u)}));return function(u){return f.apply(this,arguments)}}(),children:[(0,t.jsxs)(c.L0.StepForm,{title:"\u57FA\u7840\u914D\u7F6E",initialValues:g,onFinish:function(){var f=p()(l()().mark(function u(a){return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return V(function(n){return o()(o()({},n),a)}),e.abrupt("return",!0);case 2:case"end":return e.stop()}},u)}));return function(u){return f.apply(this,arguments)}}(),children:[(0,t.jsx)(h.Z,{label:"\u77E5\u8BC6\u540D\u79F0",name:"jobName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u77E5\u8BC6\u540D\u79F0"}],placeholder:"\u8BF7\u8F93\u5165\u77E5\u8BC6\u540D\u79F0"}),(0,t.jsx)(x.Z.Group,{name:"type",label:"\u6570\u636E\u6E90",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90"}],options:[{label:"\u672C\u5730\u6587\u4EF6",value:"FILE_EXTRACT"},{label:"\u8BED\u96C0\u6587\u6863/\u77E5\u8BC6\u5E93",value:"YUQUE_EXTRACT"},{label:"\u6279\u91CF\u6570\u636E",value:"BATCH"},{label:"\u5B9E\u65F6\u6570\u636E",value:"STREAM"}]}),(0,t.jsx)(x.Z.Group,{fieldProps:{style:{display:"flex",flexDirection:"column",gap:8}},name:"dataSourceConfig_structure",label:"\u5185\u5BB9\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5185\u5BB9\u7C7B\u578B"}],options:[{label:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("b",{children:"\u7ED3\u6784\u5316\u5185\u5BB9"}),"-\u8868\u683C\u5F62\u5F0F\u5185\u5BB9\uFF0C \u65E0\u9700\u62BD\u53D6\uFF0C \u53EF\u76F4\u63A5\u4E0E\u77E5\u8BC6\u6A21\u578B\u6620\u5C04\u5E76\u5BFC\u5165\u6570\u636E"]}),value:"structuredContent"},{label:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("b",{children:"\u975E\u7ED3\u6784\u5316\u5185\u5BB9"}),"-\u5185\u5BB9\u65E0\u660E\u786E\u7ED3\u6784\uFF0C \u9700\u5927\u6A21\u578B\u62BD\u53D6"]}),value:"unstructuredContent"}]}),(0,t.jsx)(i.Z,{label:"\u4E0A\u4F20\u6587\u4EF6",name:"fileUrl",action:"/api/public/v1/reasoner/dialog/uploadFile",fieldProps:{maxCount:1,showUploadList:{extra:function(u){var a=u.size,s=a===void 0?0:a;return(0,t.jsxs)("span",{style:{color:"#cccccc"},children:["(",(s/1024/1024).toFixed(2),"MB)"]})},showDownloadIcon:!0,showRemoveIcon:!0}},rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20\u6587\u4EF6"}]}),(0,t.jsxs)(G.Z.Text,{type:"secondary",children:["\u652F\u6301\u62D3\u5C55\u540D:.txt\uFF0C.csv\uFF0C.pdf\uFF0C.md\uFF0C.json\uFF0C.doc\uFF0C.docx",(0,t.jsx)("br",{})," \u6CE8\u610F: \u5355\u6B21\u4EC5\u652F\u6301\u4E0A\u4F201\u4E2A\u6587\u4EF6\uFF0C\u5355\u4E2A\u6587\u4EF6\u5927\u5C0F\u5728200MB\u4EE5\u5185"]})]}),(0,t.jsx)(c.L0.StepForm,{initialValues:g,title:"\u5206\u6BB5\u914D\u7F6E/\u6620\u5C04\u914D\u7F6E",onFinish:function(){var f=p()(l()().mark(function u(a){return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return V(function(n){return o()(o()({},n),a)}),e.abrupt("return",!0);case 2:case"end":return e.stop()}},u)}));return function(u){return f.apply(this,arguments)}}(),children:(0,t.jsxs)(Q.Z,{children:[(0,t.jsxs)(Q.Z,{vertical:!0,children:[(0,t.jsx)(j.Z,{label:"\u5206\u6BB5\u6700\u5927\u957F\u5EA6",name:"splitConfig_splitLength",min:100,fieldProps:{precision:0},rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5206\u6BB5\u6700\u5927\u957F\u5EA6"}]}),(0,t.jsx)(oe.Z.Group,{name:"splitConfig_semanticSplit",layout:"vertical",label:"\u5206\u6BB5\u5904\u7406",options:[{label:"\u6839\u636E\u6587\u6863\u8BED\u4E49\u5207\u5206\u6587\u6863\uFF08\u6309\u8BED\u4E49\u5207\u5206\u53EF\u80FD\u8017\u65F6\u8F83\u957F\uFF0C\u6BB5\u843D\u957F\u5EA6\u53EF\u80FD\u5C0F\u4E8E\u5206\u6BB5\u6700\u5927\u957F\u5EA6\uFF09",value:"1"}]})]}),z&&z.length>0&&(0,t.jsx)(Y.Z,{style:{maxWidth:"50%"},pagination:{pageSize:5},size:"small",header:!1,footer:!1,bordered:!0,dataSource:z,renderItem:function(u){return(0,t.jsx)(Y.Z.Item,{children:(0,t.jsx)(ve.Z,{bordered:!1,defaultActiveKey:["1"],expandIcon:function(s){var e=s.isActive;return(0,t.jsx)(A.Z,{rotate:e?90:0})},style:{background:Ze,width:"100%"},items:[{key:"item-"+u.id,label:"\u5206\u6BB5"+u.id,children:(0,t.jsx)("p",{children:u.content}),style:Ne}]})})}})]})}),(0,t.jsxs)(c.L0.StepForm,{initialValues:g,title:"\u62BD\u53D6\u914D\u7F6E/\u5BFC\u5165\u914D\u7F6E",onFinish:function(){var f=p()(l()().mark(function u(a){return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return V(function(n){return o()(o()({},n),a)}),e.abrupt("return",!0);case 2:case"end":return e.stop()}},u)}));return function(u){return f.apply(this,arguments)}}(),children:[(0,t.jsx)(ce.Z,{name:"extractConfig_llm",label:"\u62BD\u53D6\u6A21\u578B",request:p()(l()().mark(function f(){var u,a;return l()().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=P.get("projectId"),u){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,M({projectId:Number.parseInt(u)});case 5:return a=e.sent,Re(a.data),e.abrupt("return",a.data.map(function(n){return{label:n.model+" ("+n.desc+")",value:n.llm_id}}));case 8:case"end":return e.stop()}},f)})),placeholder:"\u8BF7\u9009\u62E9\u62BD\u53D6\u6A21\u578B",rules:[{required:!0,message:"Please select your country!"}]}),(0,t.jsx)(de.Z,{name:"computingConf",label:"\u811A\u672C\u914D\u7F6E",placeholder:"\u8BF7\u8F93\u5165\u811A\u672C\u914D\u7F6E"})]})]})})]})},Ee=Ce},39530:function(ie,I,r){r.d(I,{Eq:function(){return w},Ij:function(){return M},J1:function(){return N},nR:function(){return v}});var R=r(90228),o=r.n(R),O=r(26068),l=r.n(O),Z=r(87999),p=r.n(Z),_=r(86487);function v(d,c){return b.apply(this,arguments)}function b(){return b=p()(o()().mark(function d(c,h){return o()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,_.request)("/api/public/v1/builder/job/get",l()({method:"GET",params:l()({},c)},h||{})).then(function(j){return{data:j.result}}));case 1:case"end":return i.stop()}},d)})),b.apply(this,arguments)}function w(d,c){return E.apply(this,arguments)}function E(){return E=p()(o()().mark(function d(c,h){return o()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,_.request)("/api/public/v1/builder/job/split/preview",l()({data:c,method:"POST"},h||{})));case 1:case"end":return i.stop()}},d)})),E.apply(this,arguments)}function M(d,c){return F.apply(this,arguments)}function F(){return F=p()(o()().mark(function d(c,h){return o()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,_.request)("/api/public/v1/builder/job/schema/diff",l()({data:c,method:"POST"},h||{})).then(function(j){return{data:j.result}}));case 1:case"end":return i.stop()}},d)})),F.apply(this,arguments)}function N(d,c){return A.apply(this,arguments)}function A(){return A=p()(o()().mark(function d(c,h){return o()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",(0,_.request)("/api/v1/schemas/graph/".concat(c.projectId),l()({method:"GET",params:l()({},c)},h||{})).then(function(j){return{data:j.result}}));case 1:case"end":return i.stop()}},d)})),A.apply(this,arguments)}}}]);
