(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_open-semantic-graph"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_open-semantic-graph"]||[]).push([["2d0f95c5"],{"2d0f95c5":function(e,r,t){"use strict";t.d(r,"__esModule",{value:!0}),t.d(r,"MarkerDecorationsService",{enumerable:!0,get:function(){return f;}});var i=t("18203969"),o=t("77b755a9"),a=t("fb87d58a"),n=t("dd8f73a0"),s=t("05de99d3"),l=t("64976f50"),d=t("e7e5ddb3"),c=t("b1fc2372"),h=t("e793196d"),u=t("e735ca16"),m=t("c6bdbcd6"),g=t("14786fb4"),_=this&&this.__decorate||function(e,r,t,i){var o,a=arguments.length,n=a<3?r:null===i?i=Object.getOwnPropertyDescriptor(r,t):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,r,t,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(n=(a<3?o(n):a>3?o(r,t,n):o(r,t))||n);return a>3&&n&&Object.defineProperty(r,t,n),n;},p=this&&this.__param||function(e,r){return function(t,i){r(t,i,e);};};let f=class extends o.Disposable{constructor(e,r){super(),this._markerService=r,this._onDidChangeMarker=this._register(new h.Emitter),this._markerDecorations=new m.ResourceMap,e.getModels().forEach(e=>this._onModelAdded(e)),this._register(e.onModelAdded(this._onModelAdded,this)),this._register(e.onModelRemoved(this._onModelRemoved,this)),this._register(this._markerService.onMarkerChanged(this._handleMarkerChange,this));}dispose(){super.dispose(),this._markerDecorations.forEach(e=>e.dispose()),this._markerDecorations.clear();}getMarker(e,r){let t=this._markerDecorations.get(e);return t&&t.getMarker(r)||null;}_handleMarkerChange(e){e.forEach(e=>{let r=this._markerDecorations.get(e);r&&this._updateDecorations(r);});}_onModelAdded(e){let r=new k(e);this._markerDecorations.set(e.uri,r),this._updateDecorations(r);}_onModelRemoved(e){let r=this._markerDecorations.get(e.uri);if(r&&(r.dispose(),this._markerDecorations.delete(e.uri)),e.uri.scheme===c.Schemas.inMemory||e.uri.scheme===c.Schemas.internal||e.uri.scheme===c.Schemas.vscode){var t;null===(t=this._markerService)||void 0===t||t.read({resource:e.uri}).map(e=>e.owner).forEach(r=>this._markerService.remove(r,[e.uri]));}}_updateDecorations(e){let r=this._markerService.read({resource:e.model.uri,take:500});e.update(r)&&this._onDidChangeMarker.fire(e.model);}};f=_([p(0,l.IModelService),p(1,i.IMarkerService)],f);class k extends o.Disposable{constructor(e){super(),this.model=e,this._map=new m.BidirectionalMap,this._register((0,o.toDisposable)(()=>{this.model.deltaDecorations([...this._map.values()],[]),this._map.clear();}));}update(e){let{added:r,removed:t}=(0,g.diffSets)(new Set(this._map.keys()),new Set(e));if(0===r.length&&0===t.length)return!1;let i=t.map(e=>this._map.get(e)),o=r.map(e=>({range:this._createDecorationRange(this.model,e),options:this._createDecorationOption(e)})),a=this.model.deltaDecorations(i,o);for(let e of t)this._map.delete(e);for(let e=0;e<a.length;e++)this._map.set(r[e],a[e]);return!0;}getMarker(e){return this._map.getKey(e.id);}_createDecorationRange(e,r){let t=d.Range.lift(r);if(r.severity!==i.MarkerSeverity.Hint||this._hasMarkerTag(r,1)||this._hasMarkerTag(r,2)||(t=t.setEndPosition(t.startLineNumber,t.startColumn+2)),(t=e.validateRange(t)).isEmpty()){let r=e.getLineLastNonWhitespaceColumn(t.startLineNumber)||e.getLineMaxColumn(t.startLineNumber);if(1===r||t.endColumn>=r)return t;let i=e.getWordAtPosition(t.getStartPosition());i&&(t=new d.Range(t.startLineNumber,i.startColumn,t.endLineNumber,i.endColumn));}else if(r.endColumn===Number.MAX_VALUE&&1===r.startColumn&&t.startLineNumber===t.endLineNumber){let i=e.getLineFirstNonWhitespaceColumn(r.startLineNumber);i<t.endColumn&&(t=new d.Range(t.startLineNumber,i,t.endLineNumber,t.endColumn),r.startColumn=i);}return t;}_createDecorationOption(e){let r,t,o,l,d;switch(e.severity){case i.MarkerSeverity.Hint:r=this._hasMarkerTag(e,2)?void 0:this._hasMarkerTag(e,1)?"squiggly-unnecessary":"squiggly-hint",t=0;break;case i.MarkerSeverity.Info:r="squiggly-info",l=(0,n.themeColorFromId)(s.overviewRulerInfo),t=10,o={color:(0,n.themeColorFromId)(u.minimapInfo),position:1};break;case i.MarkerSeverity.Warning:r="squiggly-warning",l=(0,n.themeColorFromId)(s.overviewRulerWarning),t=20,o={color:(0,n.themeColorFromId)(u.minimapWarning),position:1};break;case i.MarkerSeverity.Error:default:r="squiggly-error",l=(0,n.themeColorFromId)(s.overviewRulerError),t=30,o={color:(0,n.themeColorFromId)(u.minimapError),position:1};}return e.tags&&(-1!==e.tags.indexOf(1)&&(d="squiggly-inline-unnecessary"),-1!==e.tags.indexOf(2)&&(d="squiggly-inline-deprecated")),{description:"marker-decoration",stickiness:1,className:r,showIfCollapsed:!0,overviewRuler:{color:l,position:a.OverviewRulerLane.Right},minimap:o,zIndex:t,inlineClassName:d};}_hasMarkerTag(e,r){return!!e.tags&&e.tags.indexOf(r)>=0;}}},"64976f50":function(e,r,t){"use strict";t.d(r,"__esModule",{value:!0}),t.d(r,"IModelService",{enumerable:!0,get:function(){return i;}});let i=(0,t("2aa5bed3").createDecorator)("modelService");}}]);
