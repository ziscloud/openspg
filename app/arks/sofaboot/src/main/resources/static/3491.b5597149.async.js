!(function(){var r0=(pr,Gt,H)=>new Promise((ze,qe)=>{var v=Je=>{try{G(H.next(Je))}catch(Oe){qe(Oe)}},at=Je=>{try{G(H.throw(Je))}catch(Oe){qe(Oe)}},G=Je=>Je.done?ze(Je.value):Promise.resolve(Je.value).then(v,at);G((H=H.apply(pr,Gt)).next())});(self.webpackChunkcognik_web_app=self.webpackChunkcognik_web_app||[]).push([[3491],{52090:function(pr,Gt,H){"use strict";var ze=H(75271),qe=H(93425),v=function(){return v=Object.assign||function(G){for(var Je,Oe=1,yt=arguments.length;Oe<yt;Oe++){Je=arguments[Oe];for(var Re in Je)Object.prototype.hasOwnProperty.call(Je,Re)&&(G[Re]=Je[Re])}return G},v.apply(this,arguments)},at=(0,ze.forwardRef)(function(G,Je){return ze.createElement(qe.P,v({},G,{chartType:"Area",ref:Je}))});Gt.Z=at},54727:function(pr,Gt,H){"use strict";var ze=H(75271),qe=H(93425),v=function(){return v=Object.assign||function(G){for(var Je,Oe=1,yt=arguments.length;Oe<yt;Oe++){Je=arguments[Oe];for(var Re in Je)Object.prototype.hasOwnProperty.call(Je,Re)&&(G[Re]=Je[Re])}return G},v.apply(this,arguments)},at=(0,ze.forwardRef)(function(G,Je){return ze.createElement(qe.P,v({},G,{chartType:"Gauge",ref:Je}))});Gt.Z=at},842:function(pr,Gt,H){"use strict";var ze=H(75271),qe=H(93425),v=function(){return v=Object.assign||function(G){for(var Je,Oe=1,yt=arguments.length;Oe<yt;Oe++){Je=arguments[Oe];for(var Re in Je)Object.prototype.hasOwnProperty.call(Je,Re)&&(G[Re]=Je[Re])}return G},v.apply(this,arguments)},at=(0,ze.forwardRef)(function(G,Je){return ze.createElement(qe.P,v({},G,{chartType:"Liquid",ref:Je}))});Gt.Z=at},59929:function(pr,Gt,H){"use strict";var ze=H(75271),qe=H(93425),v=function(){return v=Object.assign||function(G){for(var Je,Oe=1,yt=arguments.length;Oe<yt;Oe++){Je=arguments[Oe];for(var Re in Je)Object.prototype.hasOwnProperty.call(Je,Re)&&(G[Re]=Je[Re])}return G},v.apply(this,arguments)},at=(0,ze.forwardRef)(function(G,Je){return ze.createElement(qe.P,v({},G,{chartType:"WordCloud",ref:Je}))});Gt.Z=at},73120:function(pr,Gt,H){"use strict";H.d(Gt,{f:function(){return st}});var ze=H(35576),qe=H(39050),v=H(82187),at=H.n(v),G=H(75271),Je=H(9093),Oe=H(55443),yt=H(30383),Re=function(Yt){return(0,ze.Z)({},Yt.componentCls,{width:"100%","&-wide":{maxWidth:1152,margin:"0 auto"}})};function zt(qt){return(0,yt.Xj)("ProLayoutGridContent",function(Yt){var ir=(0,Oe.Z)((0,Oe.Z)({},Yt),{},{componentCls:".".concat(qt)});return[Re(ir)]})}var ct=H(52676),st=function(Yt){var ir=(0,G.useContext)(Je.X),or=Yt.children,Sr=Yt.contentWidth,_r=Yt.className,Gr=Yt.style,vn=(0,G.useContext)(qe.ZP.ConfigContext),ii=vn.getPrefixCls,Yn=Yt.prefixCls||ii("pro"),xt=Sr||ir.contentWidth,Pe="".concat(Yn,"-grid-content"),Ft=zt(Pe),tt=Ft.wrapSSR,Jt=Ft.hashId,wr=xt==="Fixed"&&ir.layout==="top";return tt((0,ct.jsx)("div",{className:at()(Pe,Jt,_r,(0,ze.Z)({},"".concat(Pe,"-wide"),wr)),style:Gr,children:(0,ct.jsx)("div",{className:"".concat(Yn,"-grid-content-children ").concat(Jt).trim(),children:or})}))}},26754:function(pr,Gt,H){"use strict";H.d(Gt,{S:function(){return Oe}});var ze=H(55443),qe=H(38334),v=H(78214),at=H(75271),G=H(52676),Je=["isLoading","pastDelay","timedOut","error","retry"],Oe=function(Re){var zt=Re.isLoading,ct=Re.pastDelay,st=Re.timedOut,qt=Re.error,Yt=Re.retry,ir=(0,qe.Z)(Re,Je);return(0,G.jsx)("div",{style:{paddingBlockStart:100,textAlign:"center"},children:(0,G.jsx)(v.Z,(0,ze.Z)({size:"large"},ir))})}},9093:function(pr,Gt,H){"use strict";H.d(Gt,{X:function(){return qe}});var ze=H(75271),qe=(0,ze.createContext)({})},43159:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(pr){try{let Re=function(){G||(G=!0,v())},zt=function(){try{at.documentElement.doScroll("left")}catch(ct){return void setTimeout(zt,50)}Re()};var Oe=Re,yt=zt,H=(H=document.getElementsByTagName("script"))[H.length-1],Gt=H.getAttribute("data-injectcss"),H=H.getAttribute("data-disable-injectsvg");if(!H){var ze,qe,v,at,G,Je=function(ct,st){st.parentNode.insertBefore(ct,st)};if(Gt&&!pr.__iconfont__svg__cssinject__){pr.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(ct){console&&console.log(ct)}}ze=function(){var ct,st=document.createElement("div");st.innerHTML=pr._iconfont_svg_string_3580659,(st=st.getElementsByTagName("svg")[0])&&(st.setAttribute("aria-hidden","true"),st.style.position="absolute",st.style.width=0,st.style.height=0,st.style.overflow="hidden",st=st,(ct=document.body).firstChild?Je(st,ct.firstChild):ct.appendChild(st))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(ze,0):(qe=function(){document.removeEventListener("DOMContentLoaded",qe,!1),ze()},document.addEventListener("DOMContentLoaded",qe,!1)):document.attachEvent&&(v=ze,at=pr.document,G=!1,zt(),at.onreadystatechange=function(){at.readyState=="complete"&&(at.onreadystatechange=null,Re())})}}catch(Re){}}(window)},85414:function(pr,Gt,H){"use strict";H.d(Gt,{zP:function(){return NP},JE:function(){return BO},ns:function(){return FP}});var ze=H(75271),qe=(0,ze.createContext)({});function v(){return(0,ze.useContext)(qe)}var at={},G={},Je=e=>G[e],Oe=(e,t)=>{G[e]=t},yt=e=>at[e],Re=(e,t)=>{at[e]=t},zt={},ct={},st=34,qt=10,Yt=13;function ir(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function or(e,t){var r=ir(e);return function(i,a){return t(r(i),a,e)}}function Sr(e){var t=Object.create(null),r=[];return e.forEach(function(i){for(var a in i)a in t||r.push(t[a]=a)}),r}function _r(e,t){var r=e+"",i=r.length;return i<t?new Array(t-i+1).join(0)+r:r}function Gr(e){return e<0?"-"+_r(-e,6):e>9999?"+"+_r(e,6):_r(e,4)}function vn(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Gr(e.getUTCFullYear(),4)+"-"+_r(e.getUTCMonth()+1,2)+"-"+_r(e.getUTCDate(),2)+(a?"T"+_r(t,2)+":"+_r(r,2)+":"+_r(i,2)+"."+_r(a,3)+"Z":i?"T"+_r(t,2)+":"+_r(r,2)+":"+_r(i,2)+"Z":r||t?"T"+_r(t,2)+":"+_r(r,2)+"Z":"")}function ii(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function i(C,R){var U,X,ee=a(C,function(xe,ke){if(U)return U(xe,ke-1);X=xe,U=R?or(xe,R):ir(xe)});return ee.columns=X||[],ee}function a(C,R){var U=[],X=C.length,ee=0,xe=0,ke,Ne=X<=0,it=!1;C.charCodeAt(X-1)===qt&&--X,C.charCodeAt(X-1)===Yt&&--X;function gt(){if(Ne)return ct;if(it)return it=!1,zt;var Kt,Rt=ee,tr;if(C.charCodeAt(Rt)===st){for(;ee++<X&&C.charCodeAt(ee)!==st||C.charCodeAt(++ee)===st;);return(Kt=ee)>=X?Ne=!0:(tr=C.charCodeAt(ee++))===qt?it=!0:tr===Yt&&(it=!0,C.charCodeAt(ee)===qt&&++ee),C.slice(Rt+1,Kt-1).replace(/""/g,'"')}for(;ee<X;){if((tr=C.charCodeAt(Kt=ee++))===qt)it=!0;else if(tr===Yt)it=!0,C.charCodeAt(ee)===qt&&++ee;else if(tr!==r)continue;return C.slice(Rt,Kt)}return Ne=!0,C.slice(Rt,X)}for(;(ke=gt())!==ct;){for(var rr=[];ke!==zt&&ke!==ct;)rr.push(ke),ke=gt();R&&(rr=R(rr,xe++))==null||U.push(rr)}return U}function u(C,R){return C.map(function(U){return R.map(function(X){return A(U[X])}).join(e)})}function f(C,R){return R==null&&(R=Sr(C)),[R.map(A).join(e)].concat(u(C,R)).join(`
`)}function m(C,R){return R==null&&(R=Sr(C)),u(C,R).join(`
`)}function _(C){return C.map(b).join(`
`)}function b(C){return C.map(A).join(e)}function A(C){return C==null?"":C instanceof Date?vn(C):t.test(C+="")?'"'+C.replace(/"/g,'""')+'"':C}return{parse:i,parseRows:a,format:f,formatBody:m,formatRows:_,formatRow:b,formatValue:A}}var Yn=ii(","),xt=Yn.parse,Pe=Yn.parseRows,Ft=Yn.format,tt=Yn.formatBody,Jt=Yn.formatRows,wr=Yn.formatRow,$=Yn.formatValue,me=63710088e-1,W={centimeters:me*100,centimetres:me*100,degrees:me/111325,feet:me*3.28084,inches:me*39.37,kilometers:me/1e3,kilometres:me/1e3,meters:me,metres:me,miles:me/1609.344,millimeters:me*1e3,millimetres:me*1e3,nauticalmiles:me/1852,radians:1,yards:me*1.0936},he={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/me,yards:1.0936133},ae={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Me(e,t,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function je(e,t,r){switch(r===void 0&&(r={}),e){case"Point":return ut(t).geometry;case"LineString":return Cr(t).geometry;case"Polygon":return bt(t).geometry;case"MultiPoint":return Yr(t).geometry;case"MultiLineString":return xn(t).geometry;case"MultiPolygon":return rn(t).geometry;default:throw new Error(e+" is invalid")}}function ut(e,t,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ie(e[0])||!ie(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return Me(i,t,r)}function St(e,t,r){return r===void 0&&(r={}),Xr(e.map(function(i){return ut(i,t)}),r)}function bt(e,t,r){r===void 0&&(r={});for(var i=0,a=e;i<a.length;i++){var u=a[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<u[u.length-1].length;f++)if(u[u.length-1][f]!==u[0][f])throw new Error("First and last Position are not equivalent.")}var m={type:"Polygon",coordinates:e};return Me(m,t,r)}function Lr(e,t,r){return r===void 0&&(r={}),Xr(e.map(function(i){return bt(i,t)}),r)}function Cr(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return Me(i,t,r)}function On(e,t,r){return r===void 0&&(r={}),Xr(e.map(function(i){return Cr(i,t)}),r)}function Xr(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function xn(e,t,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:e};return Me(i,t,r)}function Yr(e,t,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:e};return Me(i,t,r)}function rn(e,t,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:e};return Me(i,t,r)}function Kr(e,t,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:e};return Me(i,t,r)}function Qn(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r}function Ur(e,t){t===void 0&&(t="kilometers");var r=W[t];if(!r)throw new Error(t+" units is invalid");return e*r}function Mn(e,t){t===void 0&&(t="kilometers");var r=W[t];if(!r)throw new Error(t+" units is invalid");return e/r}function $r(e,t){return zi(Mn(e,t))}function un(e){var t=e%360;return t<0&&(t+=360),t}function zi(e){var t=e%(2*Math.PI);return t*180/Math.PI}function gi(e){var t=e%360;return t*Math.PI/180}function _o(e,t,r){if(t===void 0&&(t="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Ur(Mn(e,t),r)}function Ii(e,t,r){if(t===void 0&&(t="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=ae[t];if(!i)throw new Error("invalid original units");var a=ae[r];if(!a)throw new Error("invalid final units");return e/i*a}function ie(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Wi(e){return!!e&&e.constructor===Object}function Ji(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!ie(t))throw new Error("bbox must only contain numbers")})}function to(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function aa(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ea(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Bs(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Bs(e[0]);throw new Error("coordinates must only contain numbers")}function Vo(e,t,r){if(!t||!r)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.type)}function Ws(e,t,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+e.geometry.type)}function _u(e,t,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,a=e.features;i<a.length;i++){var u=a[i];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!u.geometry||u.geometry.type!==t)throw new Error("Invalid input to "+r+": must be a "+t+", given "+u.geometry.type)}}function Do(e){return e.type==="Feature"?e.geometry:e}function uo(e,t){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function lo(e,t,r){if(e!==null)for(var i,a,u,f,m,_,b,A=0,C=0,R,U=e.type,X=U==="FeatureCollection",ee=U==="Feature",xe=X?e.features.length:1,ke=0;ke<xe;ke++){b=X?e.features[ke].geometry:ee?e.geometry:e,R=b?b.type==="GeometryCollection":!1,m=R?b.geometries.length:1;for(var Ne=0;Ne<m;Ne++){var it=0,gt=0;if(f=R?b.geometries[Ne]:b,f!==null){_=f.coordinates;var rr=f.type;switch(A=r&&(rr==="Polygon"||rr==="MultiPolygon")?1:0,rr){case null:break;case"Point":if(t(_,C,ke,it,gt)===!1)return!1;C++,it++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(t(_[i],C,ke,it,gt)===!1)return!1;C++,rr==="MultiPoint"&&it++}rr==="LineString"&&it++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(a=0;a<_[i].length-A;a++){if(t(_[i][a],C,ke,it,gt)===!1)return!1;C++}rr==="MultiLineString"&&it++,rr==="Polygon"&&gt++}rr==="Polygon"&&it++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(gt=0,a=0;a<_[i].length;a++){for(u=0;u<_[i][a].length-A;u++){if(t(_[i][a][u],C,ke,it,gt)===!1)return!1;C++}gt++}it++}break;case"GeometryCollection":for(i=0;i<f.geometries.length;i++)if(lo(f.geometries[i],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ot(e,t,r,i){var a=r;return lo(e,function(u,f,m,_,b){f===0&&r===void 0?a=u:a=t(a,u,f,m,_,b)},i),a}function z(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&t(e.features[r].properties,r)!==!1;r++);break;case"Feature":t(e.properties,0);break}}function K(e,t,r){var i=r;return z(e,function(a,u){u===0&&r===void 0?i=a:i=t(i,a,u)}),i}function de(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&t(e.features[r],r)!==!1;r++);}function Fe(e,t,r){var i=r;return de(e,function(a,u){u===0&&r===void 0?i=a:i=t(i,a,u)}),i}function Ce(e){var t=[];return lo(e,function(r){t.push(r)}),t}function Nt(e,t){var r,i,a,u,f,m,_,b,A,C,R=0,U=e.type==="FeatureCollection",X=e.type==="Feature",ee=U?e.features.length:1;for(r=0;r<ee;r++){for(m=U?e.features[r].geometry:X?e.geometry:e,b=U?e.features[r].properties:X?e.properties:{},A=U?e.features[r].bbox:X?e.bbox:void 0,C=U?e.features[r].id:X?e.id:void 0,_=m?m.type==="GeometryCollection":!1,f=_?m.geometries.length:1,a=0;a<f;a++){if(u=_?m.geometries[a]:m,u===null){if(t(null,R,b,A,C)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,R,b,A,C)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(t(u.geometries[i],R,b,A,C)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function Bt(e,t,r){var i=r;return Nt(e,function(a,u,f,m,_){u===0&&r===void 0?i=a:i=t(i,a,u,f,m,_)}),i}function sr(e,t){Nt(e,function(r,i,a,u,f){var m=r===null?null:r.type;switch(m){case null:case"Point":case"LineString":case"Polygon":return t(Me(r,a,{bbox:u,id:f}),i,0)===!1?!1:void 0}var _;switch(m){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var b=0;b<r.coordinates.length;b++){var A=r.coordinates[b],C={type:_,coordinates:A};if(t(Me(C,a),i,b)===!1)return!1}})}function It(e,t,r){var i=r;return sr(e,function(a,u,f){u===0&&f===0&&r===void 0?i=a:i=t(i,a,u,f)}),i}function B(e,t){sr(e,function(r,i,a){var u=0;if(r.geometry){var f=r.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var m,_=0,b=0,A=0;if(lo(r,function(C,R,U,X,ee){if(m===void 0||i>_||X>b||ee>A){m=C,_=i,b=X,A=ee,u=0;return}var xe=lineString([m,C],r.properties);if(t(xe,i,a,ee,u)===!1)return!1;u++,m=C})===!1)return!1}}})}function P(e,t,r){var i=r,a=!1;return B(e,function(u,f,m,_,b){a===!1&&r===void 0?i=u:i=t(i,u,f,m,_,b),a=!0}),i}function V(e,t){if(!e)throw new Error("geojson is required");sr(e,function(r,i,a){if(r.geometry!==null){var u=r.geometry.type,f=r.geometry.coordinates;switch(u){case"LineString":if(t(r,i,a,0,0)===!1)return!1;break;case"Polygon":for(var m=0;m<f.length;m++)if(t(lineString(f[m],r.properties),i,a,m)===!1)return!1;break}}})}function Y(e,t,r){var i=r;return V(e,function(a,u,f,m){u===0&&r===void 0?i=a:i=t(i,a,u,f,m)}),i}function ce(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,u=t.segmentIndex||0,f=t.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":f=f||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var _=m.coordinates;switch(m.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),lineString([_[u],_[u+1]],f,t);case"Polygon":return a<0&&(a=_.length+a),u<0&&(u=_[a].length+u-1),lineString([_[a][u],_[a][u+1]],f,t);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u-1),lineString([_[i][u],_[i][u+1]],f,t);case"MultiPolygon":return i<0&&(i=_.length+i),a<0&&(a=_[i].length+a),u<0&&(u=_[i][a].length-u-1),lineString([_[i][a][u],_[i][a][u+1]],f,t)}throw new Error("geojson is invalid")}function Se(e,t){if(t=t||{},!isObject(t))throw new Error("options is invalid");var r=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,u=t.coordIndex||0,f=t.properties,m;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,m=e.features[r].geometry;break;case"Feature":f=f||e.properties,m=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":m=e;break;default:throw new Error("geojson is invalid")}if(m===null)return null;var _=m.coordinates;switch(m.type){case"Point":return point(_,f,t);case"MultiPoint":return i<0&&(i=_.length+i),point(_[i],f,t);case"LineString":return u<0&&(u=_.length+u),point(_[u],f,t);case"Polygon":return a<0&&(a=_.length+a),u<0&&(u=_[a].length+u),point(_[a][u],f,t);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u),point(_[i][u],f,t);case"MultiPolygon":return i<0&&(i=_.length+i),a<0&&(a=_[i].length+a),u<0&&(u=_[i][a].length-u),point(_[i][a][u],f,t)}throw new Error("geojson is invalid")}var Ue={REGISTERED_PROTOCOLS:{}},Q=Object.defineProperty,ve=Object.defineProperties,rt=Object.getOwnPropertyDescriptors,wt=Object.getOwnPropertySymbols,nr=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable,Qt=(e,t,r)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Br=(e,t)=>{for(var r in t||(t={}))nr.call(t,r)&&Qt(e,r,t[r]);if(wt)for(var r of wt(t))_t.call(t,r)&&Qt(e,r,t[r]);return e},Fr=(e,t)=>ve(e,rt(t)),Mt=e=>Ue.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))],Dr=class extends Error{constructor(e,t,r,i){super(`AJAXError: ${t} (${e}): ${r}`),this.status=e,this.statusText=t,this.url=r,this.body=i}};function Er(e,t){const r=new XMLHttpRequest,i=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",i,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(const a in e.headers)e.headers.hasOwnProperty(a)&&r.setRequestHeader(a,e.headers[a]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){let a=r.response;if(e.type==="json")try{a=JSON.parse(r.response)}catch(u){return t(u)}t(null,a,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{const a=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new Dr(r.status,r.statusText,i.toString(),a))}},r.cancel=r.abort,r.send(e.body),r}function Rr(e){return new Promise((t,r)=>{Er(e,(i,a,u,f,m)=>{i?r({err:i,data:null,xhr:m}):t({err:null,data:a,cacheControl:u,expires:f,xhr:m})})})}function zn(e,t){return Er(e,t)}var jr=(e,t)=>(Mt(e.url)||zn)(Fr(Br({},e),{type:"json"}),t),qn=(e,t)=>(Mt(e.url)||zn)(Fr(Br({},e),{type:"arrayBuffer"}),t),Li=(e,t)=>zn(Fr(Br({},e),{method:"POST"}),t),ei=(e,t)=>zn(Fr(Br({},e),{method:"GET"}),t);function Ai(e){const t=window.document.createElement("a");return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}var di="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Aa(e,t){const r=new window.Image,i=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=()=>{t(null,r),i.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=di})},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?i.createObjectURL(a):di}function Bi(e,t){const r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(i=>{t(null,i)}).catch(i=>{t(new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}var ro=(e,t,r)=>{const i=(a,u)=>{if(a)t(a);else if(u){const f=typeof createImageBitmap=="function",m=r?r(u):u;f?Bi(m,t):Aa(m,t)}};return e.type==="json"?jr(e,i):qn(e,i)},mi=(e,t)=>{typeof createImageBitmap=="function"?Bi(e,t):Aa(e,t)},Jn=(e=>(e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e))(Jn||{}),oi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bo(e,t,r){const i=e.classList;for(const a in oi)oi.hasOwnProperty(a)&&i.remove(`l7-${r}-anchor-${a}`);i.add(`l7-${r}-anchor-${t}`)}function Fs(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function eo(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function co(){}var yu=.7,_s=1/yu,Gi="\\s*([+-]?\\d+)\\s*",sa="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",no="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",yo=/^#([0-9a-f]{3,8})$/,Fa=new RegExp("^rgb\\("+[Gi,Gi,Gi]+"\\)$"),Ki=new RegExp("^rgb\\("+[no,no,no]+"\\)$"),Wa=new RegExp("^rgba\\("+[Gi,Gi,Gi,sa]+"\\)$"),Na=new RegExp("^rgba\\("+[no,no,no,sa]+"\\)$"),xu=new RegExp("^hsl\\("+[sa,no,no]+"\\)$"),ys=new RegExp("^hsla\\("+[sa,no,no,sa]+"\\)$"),yc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fs(co,Zo,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Bo,formatHex:Bo,formatHsl:Yi,formatRgb:$a,toString:$a});function Bo(){return this.rgb().formatHex()}function Yi(){return Ho(this).formatHsl()}function $a(){return this.rgb().formatRgb()}function Zo(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=yo.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?re(t):r===3?new yr(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?pe(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?pe(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Fa.exec(e))?new yr(t[1],t[2],t[3],1):(t=Ki.exec(e))?new yr(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Wa.exec(e))?pe(t[1],t[2],t[3],t[4]):(t=Na.exec(e))?pe(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=xu.exec(e))?ua(t[1],t[2]/100,t[3]/100,1):(t=ys.exec(e))?ua(t[1],t[2]/100,t[3]/100,t[4]):yc.hasOwnProperty(e)?re(yc[e]):e==="transparent"?new yr(NaN,NaN,NaN,0):null}function re(e){return new yr(e>>16&255,e>>8&255,e&255,1)}function pe(e,t,r,i){return i<=0&&(e=t=r=NaN),new yr(e,t,r,i)}function Ke(e){return e instanceof co||(e=Zo(e)),e?(e=e.rgb(),new yr(e.r,e.g,e.b,e.opacity)):new yr}function Vt(e,t,r,i){return arguments.length===1?Ke(e):new yr(e,t,r,i==null?1:i)}function yr(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}Fs(yr,Vt,eo(co,{brighter:function(e){return e=e==null?_s:Math.pow(_s,e),new yr(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?yu:Math.pow(yu,e),new yr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:dn,formatHex:dn,formatRgb:Si,toString:Si}));function dn(){return"#"+jo(this.r)+jo(this.g)+jo(this.b)}function Si(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function jo(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function ua(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new bs(e,t,r,i)}function Ho(e){if(e instanceof bs)return new bs(e.h,e.s,e.l,e.opacity);if(e instanceof co||(e=Zo(e)),!e)return new bs;if(e instanceof bs)return e;e=e.rgb();var t=e.r/255,r=e.g/255,i=e.b/255,a=Math.min(t,r,i),u=Math.max(t,r,i),f=NaN,m=u-a,_=(u+a)/2;return m?(t===u?f=(r-i)/m+(r<i)*6:r===u?f=(i-t)/m+2:f=(t-r)/m+4,m/=_<.5?u+a:2-u-a,f*=60):m=_>0&&_<1?0:f,new bs(f,m,_,e.opacity)}function xs(e,t,r,i){return arguments.length===1?Ho(e):new bs(e,t,r,i==null?1:i)}function bs(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}Fs(bs,xs,eo(co,{brighter:function(e){return e=e==null?_s:Math.pow(_s,e),new bs(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?yu:Math.pow(yu,e),new bs(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,a=2*r-i;return new yr(th(e>=240?e-240:e+120,a,i),th(e,a,i),th(e<120?e+240:e-120,a,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function th(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function Ch(e){return typeof e=="string"?!!d3.color(e):!1}function ti(e){const t=Zo(e),r=[0,0,0,0];return t!=null&&(r[0]=t.r/255,r[1]=t.g/255,r[2]=t.b/255,r[3]=t.opacity),r}function Es(e){const t=e&&e[0],r=e&&e[1],i=e&&e[2];return t+r*256+i*65536-1}function Ns(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function au(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;let i=null;const a=r.createLinearGradient(0,0,256,1),u=e.positions[0],f=e.positions[e.positions.length-1];for(let m=0;m<e.colors.length;++m){const _=(e.positions[m]-u)/(f-u);a.addColorStop(_,e.colors[m])}return r.fillStyle=a,r.fillRect(0,0,256,1),i=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),t=null,r=null,{data:i,width:256,height:1}}function bu(e,t){let r=window.document.createElement("canvas"),i=r.getContext("2d");r.width=256,r.height=1;const a=i.createLinearGradient(0,0,256,1),u=t[1]-t[0];for(let _=0;_<e.colors.length;++_){const b=Math.max((e.positions[_]-t[0])/u,0);a.addColorStop(b,e.colors[_])}i.fillStyle=a,i.fillRect(0,0,256,1);const f=i.getImageData(0,0,256,1).data,m=Eo(i,f);return r=null,i=null,m}function Du(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;const i=r.createImageData(256,1);return i.data.fill(0),e.positions.forEach((a,u)=>{const f=ti(e.colors[u]);i.data[a*4+0]=f[0]*255,i.data[a*4+1]=f[1]*255,i.data[a*4+2]=f[2]*255,i.data[a*4+3]=f[3]*255}),t=null,r=null,i}function xc(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");r.globalAlpha=1,t.width=256,t.height=1;const i=256/e.colors.length;for(let f=0;f<e.colors.length;f++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[f],r.moveTo(f*i,0),r.lineTo((f+1)*i,0),r.stroke();const a=r.getImageData(0,0,256,1).data,u=Eo(r,a);return t=null,r=null,u}function Ts(e,t){let r=window.document.createElement("canvas"),i=r.getContext("2d");i.globalAlpha=1,r.width=256,r.height=1;const a=t[1]-t[0];e.positions.length-e.colors.length!==1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(let m=0;m<e.colors.length;m++)i.beginPath(),i.lineWidth=2,i.strokeStyle=e.colors[m],i.moveTo((e.positions[m]-t[0])/a*255,0),i.lineTo((e.positions[m+1]-t[0])/a*255,0),i.stroke();const u=i.getImageData(0,0,256,1).data,f=Eo(i,u);return r=null,i=null,f}function Eo(e,t){const r=e.createImageData(256,1);for(let i=0;i<r.data.length;i+=4)r.data[i+0]=t[i+0],r.data[i+1]=t[i+1],r.data[i+2]=t[i+2],r.data[i+3]=t[i+3];return r}function Eu(e){switch(e==null?void 0:e.type){case"cat":return[0,255];default:return[0,1]}}var Bu=H(35636),rh=H.n(Bu),cf=H(32222),nh=H.n(cf),Rh=H(66292),Ih=H.n(Rh),Mh=H(65439),hf=H.n(Mh),ff=H(98071),np=H.n(ff),bc=H(31223),pa=H.n(bc),pf=H(46207),Ua=H.n(pf),Tl=H(59933),Ju=H.n(Tl),Us=H(69143),el=H.n(Us),Gs=H(56549),Fu=H.n(Gs),ks=H(73806),Nu=H.n(ks),tl=H(67929),df=H.n(tl),mf=H(53954),$i=H.n(mf),ip=H(25066),ih=H.n(ip),Oh=H(38209),Fo=H.n(Oh),Ph=H(4363),vf=H.n(Ph),us=H(42950),Uu=H.n(us),Tu=H(92042),rl=H.n(Tu),oh=H(36838),Gl=H.n(oh),su=H(89300),Ec=H.n(su),nl=H(47638),ku=H.n(nl),Lh=H(53274),Tc=H.n(Lh),Kn={isNil:Ua(),merge:df(),throttle:Fo(),isString:Fu(),debounce:Ih(),pull:ih(),isTypedArray:Nu(),isPlainObject:el(),isNumber:Ju(),isBoolean:np(),isEqual:pa(),cloneDeep:nh(),uniq:vf(),clamp:rh(),upperFirst:Uu(),get:hf(),mergeWith:$i(),isFunction:rl(),isObject:Gl(),isUndefined:Ec(),camelCase:ku(),uniqueId:Tc()},{pull:ah}=Kn;function gf(e){let t=e;return typeof e=="string"&&(t=window.document.getElementById(e)),t}function zu(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Yl(e){return zu(e).split(/\s+/)}function Dh(e){var t;const r=(t=document==null?void 0:document.documentElement)==null?void 0:t.style;if(!r)return e[0];for(const i in e)if(e[i]&&e[i]in r)return e[i];return e[0]}function Mi(e,t,r){const i=window.document.createElement(e);return t&&(i.className=t||""),r&&r.appendChild(i),i}function la(e){const t=e.parentNode;t&&t.removeChild(e)}function Sa(e,t){if(e.classList!==void 0){const r=Yl(t);for(let i=0,a=r.length;i<a;i++)e.classList.add(r[i])}else if(!Al(e,t)){const r=Ac(e);il(e,(r?r+" ":"")+t)}}function As(e,t){e.classList!==void 0?Yl(t).forEach(i=>{e.classList.remove(i)}):il(e,zu((" "+Ac(e)+" ").replace(" "+t+" "," ")))}function Al(e,t){if(e.classList!==void 0)return e.classList.contains(t);const r=Ac(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}function il(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Sl(e,t,r){r===void 0?Al(e,t)?As(e,t):Sa(e,t):r?Sa(e,t):As(e,t)}function Ac(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ql(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Ys=Dh(["transform","WebkitTransform"]);function sh(e,t){e.style[Ys]=t}function _f(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{const e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function yf(e){const t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,t.join(""))}function ol(){var e;const t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;const i=((e=t.content)==null?void 0:e.split(",")).find(a=>{const[u]=a.split("=");return u==="initial-scale"});return i?i.split("=")[1]*1:1}var Xo=ol()<1?1:window.devicePixelRatio;function al(e,t){e.setAttribute("style",`${e.style.cssText}${t}`)}function Kl(e){return e.split(";").map(t=>t.trim()).filter(t=>t)}function wl(e,t){var r;const i=Kl((r=e.getAttribute("style"))!=null?r:""),a=Kl(t),u=ah(i,...a);e.setAttribute("style",u.join(";"))}function op(e){return Object.entries(e).map(([t,r])=>`${t}: ${r}`).join(";")}function uh(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function Sc(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function sl(e){e.innerHTML=""}function Bh(e){e.setAttribute("draggable","false")}function wc(e,t){if(typeof t=="string"){const r=document.createElement("div");for(r.innerHTML=t;r.firstChild;)e.append(r.firstChild)}else Array.isArray(t)?e.append(...t):e.append(t)}function Fh(e,t){var r;const i=Array.isArray(t)?t:[t];let a=e;for(;a instanceof Element&&a!==window.document.body;){if(i.find(u=>a==null?void 0:a.matches(u)))return a;a=(r=a==null?void 0:a.parentElement)!=null?r:null}}function Cc(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Nh(){return typeof importScripts=="function"}var $l=Nh()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ql=navigator==null?void 0:navigator.userAgent,Cl=!!Ql.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),mo=Ql.indexOf("Android")>-1||Ql.indexOf("Adr")>-1;function lh(){const e=Ql,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let r=!0;for(const i of t)if(e.indexOf(i)>0){r=!1;break}return r}function Au(e,t){e.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}var Rl=class{constructor(e=16){this.duration=16,this.timestamp=new Date().getTime(),this.duration=e}run(e){const t=new Date().getTime(),r=t-this.timestamp;this.timestamp=t,r>=this.duration&&e()}};function yi(e){var t=[1/0,1/0,-1/0,-1/0];return lo(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}yi.default=yi;var ho=yi;function ls(e){return typeof e=="number"}function No(e){return e-Math.fround(e)}var Vu=2*Math.PI*6378137/2;function Rc(e,t){const[r,i,a,u]=t;return e.lng>r&&e.lng<=a&&e.lat>i&&e.lat<=u}function xf(e){const t=[1/0,1/0,-1/0,-1/0];return e.forEach(r=>{const{coordinates:i}=r;Ic(t,i)}),t}function Ic(e,t){return Array.isArray(t[0])?t.forEach(r=>{Ic(e,r)}):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function ch(e,t){return Zu(e,t)}function Zu(e,t){return Array.isArray(e[0])?e.map(r=>Zu(r,t)):t(e)}function Wo(e,t=!0,r={enable:!0,decimal:1}){e=Go(e,t);const i=e[0],a=e[1];let u=i*Vu/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return f=f*Vu/180,r.enable&&(u=Number(u.toFixed(r.decimal)),f=Number(f.toFixed(r.decimal))),e.length===3?[u,f,e[2]]:[u,f]}function Io(e,t=6){const r=e[0],i=e[1];let a=r/Vu*180,u=i/Vu*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),t!=null&&(a=Number(a.toFixed(t)),u=Number(u.toFixed(t))),e.length===3?[a,u,e[2]]:[a,u]}function Jl(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Uh(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Go(e,t){if(t===!1)return e;const r=Jl(e[0]);let i=Uh(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[r,i,e[2]]:[r,i]}function Hr(e){const t=85.0511287798,r=Math.max(Math.min(t,e[1]),-t),i=256<<20;let a=Math.PI/180,u=e[0]*a,f=r*a;f=Math.log(Math.tan(Math.PI/4+f/2));const m=.5/Math.PI,_=.5,b=-.5/Math.PI;return a=.5,u=i*(m*u+_),f=i*(b*f+a),[Math.floor(u),Math.floor(f)]}function Ss(e){const t=.5/Math.PI,r=.5,i=-.5/Math.PI;let a=.5;const u=256<<20;let[f,m]=e;f=(f/u-r)/t,m=(m/u-a)/i,m=(Math.atan(Math.pow(Math.E,m))-Math.PI/4)*2,a=Math.PI/180;const _=m/a;return[f/a,_]}function hh(e,t){const r=85.0511287798,i=Math.PI/180,a=6378137;return t=Math.max(Math.min(r,t),-r),e*=i,t*=i,t=Math.log(Math.tan(Math.PI/4+t/2)),[e*a,t*a]}function Mc(e,t){const r=Math.PI/180,i=6378137,a=e/i/r,u=2*(Math.atan(Math.exp(t/i))-Math.PI/4)/r;return[a,u]}function Qa(e,t,r){const i=gi(t[1]-e[1]),a=gi(t[0]-e[0]),u=gi(e[1]),f=gi(t[1]),m=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(u)*Math.cos(f);return Ur(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),r="meters")}function io(e){const t=Math.PI/180,r=85.0511287798,i=6378137,a=Math.max(Math.min(r,e[1]),-r),u=Math.sin(a*t),f=i*e[0]*t,m=i*Math.log((1+u)/(1-u))/2;return[f,m]}function ec(e,t){const r=Math.abs(e[1][1]-e[0][1])*t,i=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-i,e[0][1]-r],[e[1][0]+i,e[1][1]+r]]}function zr(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function qs(e){return[[e[0],e[1]],[e[2],e[3]]]}function Oc(e){const t=Pc(e,[0,0]);return[e[0]/t,e[1]/t]}function Pc(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Ks(e,t){return e[0]*t[0]+e[1]*t[1]}function cs(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function kh(e,t){return Math.acos(Ks(e,t)/(cs(e)*cs(t)))*180/Math.PI}function fh(e,t){return t[0]>0?t[1]>0?90-Math.atan(t[1]/t[0])*180/Math.PI:90+Math.atan(-t[1]/t[0])*180/Math.PI:t[1]<0?180+(90-Math.atan(t[1]/t[0])*180/Math.PI):270+Math.atan(t[1]/-t[0])*180/Math.PI}function hs(e,t=100){if(!e||e.length<2)return;const r=[0,1];let i=0;const a=[];for(let u=0;u<e.length-1;u++){const f=e[u],m=e[u+1],_=Pc(f,m);i+=_;const b=[f[0]-m[0],f[1]-m[1]];let A=fh(r,b);if(u>0){const C=a[u-1].rotation;C-A>360-C+A&&(A=A+360)}a.push({start:f,end:m,dis:_,rotation:A,duration:0})}return a.map(u=>{u.duration=t*(u.dis/i)}),a}function Ja(e){if(ls(e[0]))return e;if(ls(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ls(e[0][0][0])){const t=e;let r=0,i=0,a=0;return t.forEach(u=>{u.forEach(f=>{r+=f[0],i+=f[1],a++})}),[r/a,i/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function bf(e){let t=e[0],r=e[1],i=e[0],a=e[1],u=0,f=0,m=0;for(let _=0;_<e.length;_+=2){const b=e[_],A=e[_+1];b&&A&&(t=Math.max(b,t),r=Math.max(A,r),i=Math.min(b,i),a=Math.min(A,a),u+=b,f+=A,m++)}return{center:[u/m,f/m],radius:Math.sqrt(Math.pow(t-i,2)+Math.pow(r-a,2))/2}}function tc(e){return ho(Xr([Cr(e)]))}function zh(e){let i=0;e+="x";const a=Math.floor(9007199254740991/137);for(let u=0;u<e.length;u++)i>a&&(i=Math.floor(i/137)),i=i*131+e.charCodeAt(u);return i}function Ef(e){e=e.toString();let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);return t>>>0}function ws(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function $s(e,t,r,i,a=30,u){let f=r;return u&&(f=Math.round(r*(a-1))/(a-1)),i?da(e,t,f,i):da(e,t,f,.314)}function $n(e,t){const r=1-t;return(e[0]*r+e[1]*t)*r+(e[1]*r+e[2]*t)*t}function zs(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Vs(e,t,r){const i=[t[0]-e[0],t[1]-e[1]],a=zs(i,[0,0]),u=Math.atan2(i[1],i[0]),f=a/2/Math.cos(r),m=u+r;return[f*Math.cos(m)+e[0],f*Math.sin(m)+e[1]]}function da(e,t,r,i){const a=Vs(e,t,i),u=[e[0],a[0],t[0]],f=[e[1],a[1],t[1]];return[$n(u,r),$n(f,r),0]}function Il(e,t,r,i,a=30,u){let f=r;return u&&(f=Math.round(r*29)/29),Qs(e,t,f)}function ju(e,t){const r=[e[0]-t[0],e[1]-t[1]],i=[Math.sin(r[0]/2),Math.sin(r[1]/2)],a=i[1]*i[1]+Math.cos(e[1])*Math.cos(t[1])*i[0]*i[0];return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function Qs(e,t,r){const i=[degreesToRadians(e[0]),degreesToRadians(e[1])],a=[degreesToRadians(t[0]),degreesToRadians(t[1])],u=ju(i,a);if(Math.abs(u-Math.PI)<.001)return[(1-r)*i[0]+r*a[0],(1-r)*i[1]+r*a[1]];const f=Math.sin((1-r)*u)/Math.sin(u),m=Math.sin(r*u)/Math.sin(u),_=[Math.sin(i[0]),Math.sin(i[1])],b=[Math.cos(i[0]),Math.cos(i[1])],A=[Math.sin(a[0]),Math.sin(a[1])],C=[Math.cos(a[0]),Math.cos(a[1])],R=f*b[1]*b[0]+m*C[1]*C[0],U=f*b[1]*_[0]+m*C[1]*A[0],X=f*_[1]+m*A[1];return[radiansToDegrees(Math.atan2(U,R)),radiansToDegrees(Math.atan2(X,Math.sqrt(R*R+U*U)))]}function es(e,t){let r=0;const i=[];for(let m=0;m<e.length-1;m++){const _=e[m],b=e[m+1],A=bn(_,b),C=r;r+=A,i.push({p1:_,p2:b,totalDistance:r,distance:A,lastTotalDistance:C})}const a=r*t;let u,f;for(const m of i)if(m.totalDistance>a){const b=m.p1,A=m.p2,C=(a-m.lastTotalDistance)/m.distance,R=rc(A,b,C);u=R[0],f=R[1];break}return{lng:u,lat:f,height:0}}function rc(e,t,r){return[e[0]*r+t[0]*(1-r),e[1]*r+t[1]*(1-r)]}function bn(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}var ln=Object.defineProperty,fs=Object.getOwnPropertySymbols,Ga=Object.prototype.hasOwnProperty,uu=Object.prototype.propertyIsEnumerable,xo=(e,t,r)=>t in e?ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Zs=(e,t)=>{for(var r in t||(t={}))Ga.call(t,r)&&xo(e,r,t[r]);if(fs)for(var r of fs(t))uu.call(t,r)&&xo(e,r,t[r]);return e};function Su(e,t){const{featureId:r}=t;let i=e.data.dataArray;return typeof r=="number"&&(i=i.filter(({id:a})=>a===r)),i.map(a=>{const u=Vi(a,t);return Zs(Zs({},a),u)})}function nc(e,t){return new Promise(r=>{e.inited?r(Su(e,t)):e.once("update",()=>{r(Su(e,t))})})}function Vi(e,t){const{offset:r,shape:i,thetaOffset:a,segmentNumber:u=30,autoFit:f=!0}=t,{coordinates:m}=e;if(i==="line")return pathLineAtOffset(m,r);const _=m[0],b=m[1],A=typeof a=="string"?e[a]||0:a;let C;switch(i){case"arc":C=arcLineAtOffset;break;case"greatcircle":C=greatCircleLineAtOffset;break;default:C=arcLineAtOffset}const[R,U,X]=C(_,b,r,A,u,f);return{lng:R,lat:U,height:X}}var ma=class{constructor(e=50,t){this.limit=e,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}clear(){this.order.forEach(e=>{this.delete(e)}),this.cache={},this.order=[]}get(e){const t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}set(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}delete(e){const t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}deleteCache(e){delete this.cache[e]}deleteOrder(e){const t=this.order.findIndex(r=>r===e);t>=0&&this.order.splice(t,1)}appendOrder(e){this.order.push(e)}defaultDestroy(e,t){return null}};function Vh(e){if(e.length===0)throw new Error("max requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t*1}function ul(e){if(e.length===0)throw new Error("min requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t*1}function Lc(e){if(e.length===0)return 0;let t=e[0]*1;for(let r=1;r<e.length;r++)t+=e[r]*1;return t}function Hu(e){if(e.length===0)throw new Error("mean requires at least one data point");return Lc(e)/e.length}function Cs(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();let t=e[0],r=NaN,i=0,a=1;for(let u=1;u<e.length+1;u++)e[u]!==t?(a>i&&(i=a,r=t),a=1,t=e[u]):a++;return r*1}var ll={min:ul,max:Vh,mean:Hu,sum:Lc,mode:Cs};function lu(e,t){return e.map(r=>r[t])}function Zh(e,t){return ll[e](t)}function ic(e,t){t===void 0&&(t={});var r=Number(e[0]),i=Number(e[1]),a=Number(e[2]),u=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[r,i],m=[r,u],_=[a,u],b=[a,i];return bt([[f,b,_,m,f]],t.properties,{bbox:e,id:t.id})}var wa=H(11312),oc=H.n(wa),cu=(e=>(e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e))(cu||{}),ka=(e=>(e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e))(ka||{}),ph=0,hu=1,Rs=2;function dh(e){e.forEach(t=>{t.isCurrent&&(t.isVisible=t.isLoaded)})}function cl(e){e.forEach(t=>{t.properties.state=ph}),e.forEach(t=>{t.isCurrent&&!mh(t)&&Ml(t)}),e.forEach(t=>{t.isVisible=!!(t.properties.state&Rs)})}function Js(e){e.forEach(r=>{r.properties.state=ph}),e.forEach(r=>{r.isCurrent&&mh(r)}),e.slice().sort((r,i)=>r.z-i.z).forEach(r=>{r.isVisible=!!(r.properties.state&Rs),r.children.length&&(r.isVisible||r.properties.state&hu)?r.children.forEach(i=>{i.properties.state=hu}):r.isCurrent&&Ml(r)})}function mh(e){for(;e;){if(e.isLoaded)return e.properties.state|=Rs,!0;e=e.parent}return!1}function Ml(e){e.children.forEach(t=>{t.isLoaded?t.properties.state|=Rs:Ml(t)})}var jh=256,Dc=[-1/0,-1/0,1/0,1/0],l=.2,h=5,c={[cu.Realtime]:dh,[cu.Overlap]:cl,[cu.Replace]:Js},d=()=>{};function x(e,t,r){const i=Math.floor((e+180)/360*Math.pow(2,r)),a=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[i,a]}function T(e,t,r){const i=e/Math.pow(2,r)*360-180,a=Math.PI-2*Math.PI*t/Math.pow(2,r),u=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[i,u]}var S=(e,t,r)=>{const[i,a]=T(e,t,r),[u,f]=T(e+1,t+1,r);return[i,f,u,a]};function I({zoom:e,latLonBounds:t,maxZoom:r=1/0,minZoom:i=0,zoomOffset:a=0,extent:u=Dc}){let f=Math.ceil(e)+a;if(Number.isFinite(i)&&f<i)return[];Number.isFinite(r)&&f>r&&(f=r);const[m,_,b,A]=t,C=[Math.max(m,u[0]),Math.max(_,u[1]),Math.min(b,u[2]),Math.min(A,u[3])],R=[],[U,X]=x(C[0],C[1],f),[ee,xe]=x(C[2],C[3],f);for(let gt=U;gt<=ee;gt++)for(let rr=xe;rr<=X;rr++)R.push({x:gt,y:rr,z:f});const ke=(ee+U)/2,Ne=(X+xe)/2,it=(gt,rr)=>Math.abs(gt-ke)+Math.abs(rr-Ne);return R.sort((gt,rr)=>it(gt.x,gt.y)-it(rr.x,rr.y)),R}var N=(e,t,r,i=!0)=>{const a=Math.pow(2,r),u=a-1,f=a;let m=e;const _=t;return i&&(m<0?m=m+f:m>u&&(m=m%f)),{warpX:m,warpY:_}},j=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),ne=class extends wa.EventEmitter{constructor(e){super(),this.tileSize=256,this.isVisible=!1,this.isCurrent=!1,this.isVisibleChange=!1,this.loadedLayers=0,this.isLayerLoaded=!1,this.isLoad=!1,this.isChildLoad=!1,this.parent=null,this.children=[],this.data=null,this.properties={},this.loadDataId=0;const{x:t,y:r,z:i,tileSize:a,warp:u=!0}=e;this.x=t,this.y=r,this.z=i,this.warp=u||!0,this.tileSize=a}get isLoading(){return this.loadStatus===ka.Loading}get isLoaded(){return this.loadStatus===ka.Loaded}get isFailure(){return this.loadStatus===ka.Failure}setTileLayerLoaded(){this.isLayerLoaded=!0}get isCancelled(){return this.loadStatus===ka.Cancelled}get isDone(){return[ka.Loaded,ka.Cancelled,ka.Failure].includes(this.loadStatus)}get bounds(){return S(this.x,this.y,this.z)}get bboxPolygon(){const[e,t,r,i]=this.bounds,a=[(r-e)/2,(i-t)/2];return ic(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:a,meta:`
      ${this.key}
      `}})}get key(){return`${this.x}_${this.y}_${this.z}`}layerLoad(){this.loadedLayers++,this.emit("layerLoaded")}loadData(e){return j(this,arguments,function*({getData:t,onLoad:r,onError:i}){this.loadDataId++;const a=this.loadDataId;this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=ka.Loading;let u=null,f;try{const{x:m,y:_,z:b,bounds:A,tileSize:C,warp:R}=this,{warpX:U,warpY:X}=N(m,_,b,R),{signal:ee}=this.abortController;u=yield t({x:U,y:X,z:b,bounds:A,tileSize:C,signal:ee,warp:R},this)}catch(m){f=m}if(a===this.loadDataId&&!(this.isCancelled&&!u)){if(f||!u){this.loadStatus=ka.Failure,i(f,this);return}this.loadStatus=ka.Loaded,this.data=u,r(this)}})}reloadData(e){this.isLoading&&this.abortLoad(),this.loadData(e)}abortLoad(){this.isLoaded||this.isCancelled||(this.loadStatus=ka.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}},oe=(e,t)=>{const r=qs(e),i=ec(r,t),a=360*3-180,u=85.0511287798065;return[Math.max(i[0][0],-a),Math.max(i[0][1],-u),Math.min(i[1][0],a),Math.min(i[1][1],u)]},se=(e,t)=>{const r=qs(e),i=qs(t);return zr(r,i)},we=Object.defineProperty,be=Object.defineProperties,Ze=Object.getOwnPropertyDescriptors,ge=Object.getOwnPropertySymbols,Ve=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable,ht=(e,t,r)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Lt=(e,t)=>{for(var r in t||(t={}))Ve.call(t,r)&&ht(e,r,t[r]);if(ge)for(var r of ge(t))$e.call(t,r)&&ht(e,r,t[r]);return e},Tt=(e,t)=>be(e,Ze(t)),{throttle:jt}=Kn,ar=(e=>(e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e))(ar||{}),Ir=class extends oc(){constructor(e){super(),this.currentTiles=[],this.cacheTiles=new Map,this.throttleUpdate=jt((t,r)=>{this.update(t,r)},16),this.onTileLoad=t=>{this.emit("tile-loaded",t),this.updateTileVisible(),this.loadFinished()},this.onTileError=(t,r)=>{this.emit("tile-error",{error:t,tile:r}),this.updateTileVisible(),this.loadFinished()},this.onTileUnload=t=>{this.emit("tile-unload",t),this.loadFinished()},this.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Dc,getTileData:d,warp:!0,updateStrategy:cu.Replace},this.updateOptions(e)}get isLoaded(){return this.currentTiles.every(e=>e.isDone)}get tiles(){return Array.from(this.cacheTiles.values()).sort((t,r)=>t.z-r.z)}updateOptions(e){const t=e.minZoom===void 0?this.options.minZoom:Math.ceil(e.minZoom),r=e.maxZoom===void 0?this.options.maxZoom:Math.floor(e.maxZoom);this.options=Tt(Lt(Lt({},this.options),e),{minZoom:t,maxZoom:r})}update(e,t){const r=Math.max(0,Math.ceil(e));if(this.lastViewStates&&this.lastViewStates.zoom===r&&se(this.lastViewStates.latLonBoundsBuffer,t))return;const i=oe(t,l);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=r;let a=!1;const u=this.getTileIndices(r,i).filter(f=>this.options.warp||f.x>=0&&f.x<Math.pow(2,r));this.emit("tiles-load-start"),this.currentTiles=u.map(({x:f,y:m,z:_})=>{let b=this.getTile(f,m,_);return b?(((b==null?void 0:b.isFailure)||(b==null?void 0:b.isCancelled))&&b.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),b):(b=this.createTile(f,m,_),a=!0,b)}),a&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}reloadAll(){for(const[e,t]of this.cacheTiles){if(!this.currentTiles.includes(t)){this.cacheTiles.delete(e),this.onTileUnload(t);return}this.onTileUnload(t),t.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}reloadTileById(e,t,r){const i=this.cacheTiles.get(`${t},${r},${e}`);i&&(this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}reloadTileByLnglat(e,t,r){const i=this.getTileByLngLat(e,t,r);i&&this.reloadTileById(i.z,i.x,i.y)}reloadTileByExtent(e,t){this.getTileIndices(t,e).forEach(i=>{this.reloadTileById(i.z,i.x,i.y)})}pruneRequests(){const e=[];for(const t of this.cacheTiles.values())t.isLoading&&!t.isCurrent&&!t.isVisible&&e.push(t);for(;e.length>0;)e.shift().abortLoad()}getTileByLngLat(e,t,r){const{zoomOffset:i}=this.options,a=Math.ceil(r)+i,u=x(e,t,a);return this.tiles.filter(m=>m.key===`${u[0]}_${u[1]}_${a}`)[0]}getTileExtent(e,t){return this.getTileIndices(t,e)}getTileByZXY(e,t,r){return this.tiles.filter(a=>a.key===`${t}_${r}_${e}`)[0]}clear(){for(const e of this.cacheTiles.values())e.isLoading?e.abortLoad():this.onTileUnload(e);this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}destroy(){this.clear(),this.removeAllListeners()}updateTileVisible(){const e=this.options.updateStrategy,t=new Map;for(const a of this.cacheTiles.values())t.set(a.key,a.isVisible),a.isCurrent=!1,a.isVisible=!1;for(const a of this.currentTiles)a.isCurrent=!0,a.isVisible=!0;const r=Array.from(this.cacheTiles.values());typeof e=="function"?e(r):c[e](r);let i=!1;Array.from(this.cacheTiles.values()).forEach(a=>{a.isVisible!==t.get(a.key)?(a.isVisibleChange=!0,i=!0):a.isVisibleChange=!1}),i&&this.emit("tile-update")}getTileIndices(e,t){const{tileSize:r,extent:i,zoomOffset:a}=this.options,u=Math.floor(this.options.maxZoom),f=Math.ceil(this.options.minZoom);return I({maxZoom:u,minZoom:f,zoomOffset:a,tileSize:r,zoom:e,latLonBounds:t,extent:i})}getTileId(e,t,r){return`${e},${t},${r}`}loadFinished(){const e=!this.currentTiles.some(t=>!t.isDone);return e&&this.emit("tiles-load-finished"),e}getTile(e,t,r){const i=this.getTileId(e,t,r);return this.cacheTiles.get(i)}createTile(e,t,r){const i=this.getTileId(e,t,r),a=new ne({x:e,y:t,z:r,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(i,a),a.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),a}resizeCacheTiles(){const e=h*this.currentTiles.length;if(this.cacheTiles.size>e){for(const[r,i]of this.cacheTiles)if(!i.isVisible&&!this.currentTiles.includes(i)&&(this.cacheTiles.delete(r),this.onTileUnload(i)),this.cacheTiles.size<=e)break}this.rebuildTileTree()}rebuildTileTree(){for(const e of this.cacheTiles.values())e.parent=null,e.children.length=0;for(const e of this.cacheTiles.values()){const t=this.getNearestAncestor(e.x,e.y,e.z);e.parent=t,t!=null&&t.children&&t.children.push(e)}}getNearestAncestor(e,t,r){for(;r>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),r=r-1;const i=this.getTile(e,t,r);if(i)return i}return null}};function Tr(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Qr(e){const t=[];let r=/\{([a-z])-([a-z])\}/.exec(e);if(r){const i=r[1].charCodeAt(0),a=r[2].charCodeAt(0);let u;for(u=i;u<=a;++u)t.push(e.replace(r[0],String.fromCharCode(u)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){const i=parseInt(r[2],10);for(let a=parseInt(r[1],10);a<=i;a++)t.push(e.replace(r[0],a.toString()));return t}return t.push(e),t}function mn(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");const{x:r,y:i,z:a}=t,u=Qr(e),f=Math.abs(r+i)%u.length;return(Mt(u[f])?`${u[f]}/{z}/{x}/{y}`:u[f]).replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,i.toString()).replace(/\{z\}/g,a.toString()).replace(/\{bbox\}/g,S(r,i,a).join(",")).replace(/\{-y\}/g,(Math.pow(2,a)-i-1).toString())}function Cn(e,t){const{x:r,y:i,z:a,layer:u,version:f="1.0.0",style:m="default",format:_,service:b="WMTS",tileMatrixset:A}=t,C=Qr(e),R=Math.abs(r+i)%C.length;return`${C[R]}&SERVICE=${b}&REQUEST=GetTile&VERSION=${f}&LAYER=${u}&STYLE=${m}&TILEMATRIXSET=${A}&FORMAT=${_}&TILECOL=${r}&TILEROW=${i}&TILEMATRIX=${a}`}function _n(e,t){return e==null?t:e}var wi=H(47903),nn=H.n(wi);function Vn(e,t){return e.map(r=>r[t]*1)}function ri(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Zn(e){return Array.isArray(e)?e.length===0?!1:!!ri(e[0]):!1}function Fn(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Wn(e){const t=Object.isFrozen(e)?Kn.cloneDeep(e):e;return nn()(t,!0),t}function In(e,t){return e||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}var Pn=Object.defineProperty,ca=Object.defineProperties,Mo=Object.getOwnPropertyDescriptors,va=Object.getOwnPropertySymbols,ga=Object.prototype.hasOwnProperty,To=Object.prototype.propertyIsEnumerable,Ao=(e,t,r)=>t in e?Pn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ya=(e,t)=>{for(var r in t||(t={}))ga.call(t,r)&&Ao(e,r,t[r]);if(va)for(var r of va(t))To.call(t,r)&&Ao(e,r,t[r]);return e},za=(e,t)=>ca(e,Mo(t));function fu(e,t){const{x:r,y:i,x1:a,y1:u,coordinates:f,geometry:m}=t,_=[];if(!Array.isArray(e))return{dataArray:[]};if(m)return e.filter(b=>b[m]&&b[m].type&&b[m].coordinates&&b[m].coordinates.length>0).forEach((b,A)=>{const C=Wn(b[m]);sr(C,R=>{const U=ea(R),X=za(Ya({},b),{_id:A,coordinates:U});_.push(X)})}),{dataArray:_};for(let b=0;b<e.length;b++){const A=e[b];let C=[];if(f){let U="Polygon";Array.isArray(f[0])||(U="Point"),Array.isArray(f[0])&&!Array.isArray(f[0][0])&&(U="LineString"),C=Wn({type:U,coordinates:A[f]}).coordinates}else if(r&&i&&a&&u){const U=[parseFloat(A[r]),parseFloat(A[i])],X=[parseFloat(A[a]),parseFloat(A[u])];C=[U,X]}else r&&i&&(C=[parseFloat(A[r]),parseFloat(A[i])]);const R=za(Ya({},A),{_id:b,coordinates:C});_.push(R)}return{dataArray:_}}function ts(e,t){const r=xt(e);return fu(r,t)}var eu=Object.defineProperty,Is=Object.defineProperties,ac=Object.getOwnPropertyDescriptors,hl=Object.getOwnPropertySymbols,wu=Object.prototype.hasOwnProperty,fl=Object.prototype.propertyIsEnumerable,Cu=(e,t,r)=>t in e?eu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pu=(e,t)=>{for(var r in t||(t={}))wu.call(t,r)&&Cu(e,r,t[r]);if(hl)for(var r of hl(t))fl.call(t,r)&&Cu(e,r,t[r]);return e},pl=(e,t)=>Is(e,ac(t));function Va(e){const t=e.toString();let r=5381,i=t.length;for(;i;)r=r*33^t.charCodeAt(--i);return r>>>0}function Uo(e,t){return t===void 0?null:isNaN(e.properties[t]*1)?e.properties&&e.properties[t]?Va(e.properties[t]+"")%1000019:null:e.properties[t]*1}function ps(e,t){const r=[],i={};return e.features?(e.features=e.features.filter(a=>{const u=a.geometry;return a!=null&&u&&u.type&&u.coordinates&&u.coordinates.length>0}),e=Wn(e),e.features.length===0?{dataArray:[],featureKeys:i}:(sr(e,(a,u)=>{let f=Uo(a,t==null?void 0:t.featureId);f===null&&(f=u);const m=f,_=ea(a),b=pl(pu({},a.properties),{coordinates:_,_id:m});r.push(b)}),{dataArray:r,featureKeys:i})):(e.features=[],{dataArray:[]})}function Ms(e,t,r,i){for(var a=i,u=r-t>>1,f=r-t,m,_=e[t],b=e[t+1],A=e[r],C=e[r+1],R=t+3;R<r;R+=3){var U=du(e[R],e[R+1],_,b,A,C);if(U>a)m=R,a=U;else if(U===a){var X=Math.abs(R-u);X<f&&(m=R,f=X)}}a>i&&(m-t>3&&Ms(e,t,m,i),e[m+2]=a,r-m>3&&Ms(e,m,r,i))}function du(e,t,r,i,a,u){var f=a-r,m=u-i;if(f!==0||m!==0){var _=((e-r)*f+(t-i)*m)/(f*f+m*m);_>1?(r=a,i=u):_>0&&(r+=f*_,i+=m*_)}return f=e-r,m=t-i,f*f+m*m}function pi(e,t,r,i){var a={id:typeof e=="undefined"?null:e,type:t,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return Ca(a),a}function Ca(e){var t=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")Yo(e,t);else if(r==="Polygon"||r==="MultiLineString")for(var i=0;i<t.length;i++)Yo(e,t[i]);else if(r==="MultiPolygon")for(i=0;i<t.length;i++)for(var a=0;a<t[i].length;a++)Yo(e,t[i][a])}function Yo(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function Ru(e,t){var r=[];if(e.type==="FeatureCollection")for(var i=0;i<e.features.length;i++)Ol(r,e.features[i],t,i);else e.type==="Feature"?Ol(r,e,t):Ol(r,{geometry:e},t);return r}function Ol(e,t,r,i){if(t.geometry){var a=t.geometry.coordinates,u=t.geometry.type,f=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),m=[],_=t.id;if(r.promoteId?_=t.properties[r.promoteId]:r.generateId&&(_=i||0),u==="Point")Xu(a,m);else if(u==="MultiPoint")for(var b=0;b<a.length;b++)Xu(a[b],m);else if(u==="LineString")Bc(a,m,f,!1);else if(u==="MultiLineString")if(r.lineMetrics){for(b=0;b<a.length;b++)m=[],Bc(a[b],m,f,!1),e.push(pi(_,"LineString",m,t.properties));return}else Wu(a,m,f,!1);else if(u==="Polygon")Wu(a,m,f,!0);else if(u==="MultiPolygon")for(b=0;b<a.length;b++){var A=[];Wu(a[b],A,f,!0),m.push(A)}else if(u==="GeometryCollection"){for(b=0;b<t.geometry.geometries.length;b++)Ol(e,{id:_,geometry:t.geometry.geometries[b],properties:t.properties},r,i);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(pi(_,u,m,t.properties))}}function Xu(e,t){t.push(dl(e[0])),t.push(tu(e[1])),t.push(0)}function Bc(e,t,r,i){for(var a,u,f=0,m=0;m<e.length;m++){var _=dl(e[m][0]),b=tu(e[m][1]);t.push(_),t.push(b),t.push(0),m>0&&(i?f+=(a*b-_*u)/2:f+=Math.sqrt(Math.pow(_-a,2)+Math.pow(b-u,2))),a=_,u=b}var A=t.length-3;t[2]=1,Ms(t,0,A,r),t[A+2]=1,t.size=Math.abs(f),t.start=0,t.end=t.size}function Wu(e,t,r,i){for(var a=0;a<e.length;a++){var u=[];Bc(e[a],u,r,i),t.push(u)}}function dl(e){return e/360+.5}function tu(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function ru(e,t,r,i,a,u,f,m){if(r/=t,i/=t,u>=r&&f<i)return e;if(f<r||u>=i)return null;for(var _=[],b=0;b<e.length;b++){var A=e[b],C=A.geometry,R=A.type,U=a===0?A.minX:A.minY,X=a===0?A.maxX:A.maxY;if(U>=r&&X<i){_.push(A);continue}else if(X<r||U>=i)continue;var ee=[];if(R==="Point"||R==="MultiPoint")ap(C,ee,r,i,a);else if(R==="LineString")Pl(C,ee,r,i,a,!1,m.lineMetrics);else if(R==="MultiLineString")Tf(C,ee,r,i,a,!1);else if(R==="Polygon")Tf(C,ee,r,i,a,!0);else if(R==="MultiPolygon")for(var xe=0;xe<C.length;xe++){var ke=[];Tf(C[xe],ke,r,i,a,!0),ke.length&&ee.push(ke)}if(ee.length){if(m.lineMetrics&&R==="LineString"){for(xe=0;xe<ee.length;xe++)_.push(pi(A.id,R,ee[xe],A.tags));continue}(R==="LineString"||R==="MultiLineString")&&(ee.length===1?(R="LineString",ee=ee[0]):R="MultiLineString"),(R==="Point"||R==="MultiPoint")&&(R=ee.length===3?"Point":"MultiPoint"),_.push(pi(A.id,R,ee,A.tags))}}return _.length?_:null}function ap(e,t,r,i,a){for(var u=0;u<e.length;u+=3){var f=e[u+a];f>=r&&f<=i&&(t.push(e[u]),t.push(e[u+1]),t.push(e[u+2]))}}function Pl(e,t,r,i,a,u,f){for(var m=rs(e),_=a===0?vh:qd,b=e.start,A,C,R=0;R<e.length-3;R+=3){var U=e[R],X=e[R+1],ee=e[R+2],xe=e[R+3],ke=e[R+4],Ne=a===0?U:X,it=a===0?xe:ke,gt=!1;f&&(A=Math.sqrt(Math.pow(U-xe,2)+Math.pow(X-ke,2))),Ne<r?it>r&&(C=_(m,U,X,xe,ke,r),f&&(m.start=b+A*C)):Ne>i?it<i&&(C=_(m,U,X,xe,ke,i),f&&(m.start=b+A*C)):Af(m,U,X,ee),it<r&&Ne>=r&&(C=_(m,U,X,xe,ke,r),gt=!0),it>i&&Ne<=i&&(C=_(m,U,X,xe,ke,i),gt=!0),!u&&gt&&(f&&(m.end=b+A*C),t.push(m),m=rs(e)),f&&(b+=A)}var rr=e.length-3;U=e[rr],X=e[rr+1],ee=e[rr+2],Ne=a===0?U:X,Ne>=r&&Ne<=i&&Af(m,U,X,ee),rr=m.length-3,u&&rr>=3&&(m[rr]!==m[0]||m[rr+1]!==m[1])&&Af(m,m[0],m[1],m[2]),m.length&&t.push(m)}function rs(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function Tf(e,t,r,i,a,u){for(var f=0;f<e.length;f++)Pl(e[f],t,r,i,a,u,!1)}function Af(e,t,r,i){e.push(t),e.push(r),e.push(i)}function vh(e,t,r,i,a,u){var f=(u-t)/(i-t);return e.push(u),e.push(r+(a-r)*f),e.push(1),f}function qd(e,t,r,i,a,u){var f=(u-r)/(a-r);return e.push(t+(i-t)*f),e.push(u),e.push(1),f}function Kd(e,t){var r=t.buffer/t.extent,i=e,a=ru(e,1,-1-r,r,0,-1,2,t),u=ru(e,1,1-r,2+r,0,-1,2,t);return(a||u)&&(i=ru(e,1,-r,1+r,0,-1,2,t)||[],a&&(i=Yp(a,1).concat(i)),u&&(i=i.concat(Yp(u,-1)))),i}function Yp(e,t){for(var r=[],i=0;i<e.length;i++){var a=e[i],u=a.type,f;if(u==="Point"||u==="MultiPoint"||u==="LineString")f=gh(a.geometry,t);else if(u==="MultiLineString"||u==="Polygon"){f=[];for(var m=0;m<a.geometry.length;m++)f.push(gh(a.geometry[m],t))}else if(u==="MultiPolygon")for(f=[],m=0;m<a.geometry.length;m++){for(var _=[],b=0;b<a.geometry[m].length;b++)_.push(gh(a.geometry[m][b],t));f.push(_)}r.push(pi(a.id,u,f,a.tags))}return r}function gh(e,t){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var i=0;i<e.length;i+=3)r.push(e[i]+t,e[i+1],e[i+2]);return r}function qp(e,t){if(e.transformed)return e;var r=1<<e.z,i=e.x,a=e.y,u,f,m;for(u=0;u<e.features.length;u++){var _=e.features[u],b=_.geometry,A=_.type;if(_.geometry=[],A===1)for(f=0;f<b.length;f+=2)_.geometry.push(Hh(b[f],b[f+1],t,r,i,a));else for(f=0;f<b.length;f++){var C=[];for(m=0;m<b[f].length;m+=2)C.push(Hh(b[f][m],b[f][m+1],t,r,i,a));_.geometry.push(C)}}return e.transformed=!0,e}function Hh(e,t,r,i,a,u){return[Math.round(r*(e*i-a)),Math.round(r*(t*i-u))]}function Kp(e,t,r,i,a){for(var u=t===a.maxZoom?0:a.tolerance/((1<<t)*a.extent),f={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},m=0;m<e.length;m++){f.numFeatures++,sc(f,e[m],u,a);var _=e[m].minX,b=e[m].minY,A=e[m].maxX,C=e[m].maxY;_<f.minX&&(f.minX=_),b<f.minY&&(f.minY=b),A>f.maxX&&(f.maxX=A),C>f.maxY&&(f.maxY=C)}return f}function sc(e,t,r,i){var a=t.geometry,u=t.type,f=[];if(u==="Point"||u==="MultiPoint")for(var m=0;m<a.length;m+=3)f.push(a[m]),f.push(a[m+1]),e.numPoints++,e.numSimplified++;else if(u==="LineString")Fc(f,a,e,r,!1,!1);else if(u==="MultiLineString"||u==="Polygon")for(m=0;m<a.length;m++)Fc(f,a[m],e,r,u==="Polygon",m===0);else if(u==="MultiPolygon")for(var _=0;_<a.length;_++){var b=a[_];for(m=0;m<b.length;m++)Fc(f,b[m],e,r,!0,m===0)}if(f.length){var A=t.tags||null;if(u==="LineString"&&i.lineMetrics){A={};for(var C in t.tags)A[C]=t.tags[C];A.mapbox_clip_start=a.start/a.size,A.mapbox_clip_end=a.end/a.size}var R={geometry:f,type:u==="Polygon"||u==="MultiPolygon"?3:u==="LineString"||u==="MultiLineString"?2:1,tags:A};t.id!==null&&(R.id=t.id),e.features.push(R)}}function Fc(e,t,r,i,a,u){var f=i*i;if(i>0&&t.size<(a?f:i)){r.numPoints+=t.length/3;return}for(var m=[],_=0;_<t.length;_+=3)(i===0||t[_+2]>f)&&(r.numSimplified++,m.push(t[_]),m.push(t[_+1])),r.numPoints++;a&&$d(m,u),e.push(m)}function $d(e,t){for(var r=0,i=0,a=e.length,u=a-2;i<a;u=i,i+=2)r+=(e[i]-e[u])*(e[i+1]+e[u+1]);if(r>0===t)for(i=0,a=e.length;i<a/2;i+=2){var f=e[i],m=e[i+1];e[i]=e[a-2-i],e[i+1]=e[a-1-i],e[a-2-i]=f,e[a-1-i]=m}}function Qd(e,t){return new Sf(e,t)}function Sf(e,t){t=this.options=Jd(Object.create(this.options),t);var r=t.debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=Ru(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=Kd(i,t),i.length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Sf.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Sf.prototype.splitTile=function(e,t,r,i,a,u,f){for(var m=[e,t,r,i],_=this.options,b=_.debug;m.length;){i=m.pop(),r=m.pop(),t=m.pop(),e=m.pop();var A=1<<t,C=sp(t,r,i),R=this.tiles[C];if(!R&&(b>1&&console.time("creation"),R=this.tiles[C]=Kp(e,t,r,i,_),this.tileCoords.push({z:t,x:r,y:i}),b)){b>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,i,R.numFeatures,R.numPoints,R.numSimplified),console.timeEnd("creation"));var U="z"+t;this.stats[U]=(this.stats[U]||0)+1,this.total++}if(R.source=e,a){if(t===_.maxZoom||t===a)continue;var X=1<<a-t;if(r!==Math.floor(u/X)||i!==Math.floor(f/X))continue}else if(t===_.indexMaxZoom||R.numPoints<=_.indexMaxPoints)continue;if(R.source=null,e.length!==0){b>1&&console.time("clipping");var ee=.5*_.buffer/_.extent,xe=.5-ee,ke=.5+ee,Ne=1+ee,it,gt,rr,Kt,Rt,tr;it=gt=rr=Kt=null,Rt=ru(e,A,r-ee,r+ke,0,R.minX,R.maxX,_),tr=ru(e,A,r+xe,r+Ne,0,R.minX,R.maxX,_),e=null,Rt&&(it=ru(Rt,A,i-ee,i+ke,1,R.minY,R.maxY,_),gt=ru(Rt,A,i+xe,i+Ne,1,R.minY,R.maxY,_),Rt=null),tr&&(rr=ru(tr,A,i-ee,i+ke,1,R.minY,R.maxY,_),Kt=ru(tr,A,i+xe,i+Ne,1,R.minY,R.maxY,_),tr=null),b>1&&console.timeEnd("clipping"),m.push(it||[],t+1,r*2,i*2),m.push(gt||[],t+1,r*2,i*2+1),m.push(rr||[],t+1,r*2+1,i*2),m.push(Kt||[],t+1,r*2+1,i*2+1)}}},Sf.prototype.getTile=function(e,t,r){var i=this.options,a=i.extent,u=i.debug;if(e<0||e>24)return null;var f=1<<e;t=(t%f+f)%f;var m=sp(e,t,r);if(this.tiles[m])return qp(this.tiles[m],a);u>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var _=e,b=t,A=r,C;!C&&_>0;)_--,b=Math.floor(b/2),A=Math.floor(A/2),C=this.tiles[sp(_,b,A)];return!C||!C.source?null:(u>1&&console.log("found parent tile z%d-%d-%d",_,b,A),u>1&&console.time("drilling down"),this.splitTile(C.source,_,b,A,e,t,r),u>1&&console.timeEnd("drilling down"),this.tiles[m]?qp(this.tiles[m],a):null)};function sp(e,t,r){return((1<<e)*r+t)*32+e}function Jd(e,t){for(var r in t)e[r]=t[r];return e}var Nc=class{constructor(e,t,r,i){this.vectorLayerCache={},this.x=t,this.y=r,this.z=i,this.vectorTile=e}getTileData(e){return!e||!this.vectorTile.layers[e]?[]:this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features}getFeatureById(){throw new Error("Method not implemented.")}},wf=Object.defineProperty,_h=Object.defineProperties,Cf=Object.getOwnPropertyDescriptors,Ll=Object.getOwnPropertySymbols,Rf=Object.prototype.hasOwnProperty,ko=Object.prototype.propertyIsEnumerable,uc=(e,t,r)=>t in e?wf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Uc=(e,t)=>{for(var r in t||(t={}))Rf.call(t,r)&&uc(e,r,t[r]);if(Ll)for(var r of Ll(t))ko.call(t,r)&&uc(e,r,t[r]);return e},kc=(e,t)=>_h(e,Cf(t)),zc=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),lc={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function yh(e){let t=0;for(let r=0,i=e.length,a=i-1,u,f;r<i;a=r++)u=e[r],f=e[a],t+=(f.x-u.x)*(u.y+f.y);return t}function xh(e){const t=e.length;if(t<=1)return[e];const r=[];let i,a;for(let u=0;u<t;u++){const f=yh(e[u]);f!==0&&(a===void 0&&(a=f<0),a===f<0?(i&&r.push(i),i=[e[u]]):i.push(e[u]))}return i&&r.push(i),r}var Dl=["Unknown","Point","LineString","Polygon"];function Vc(e,t,r,i,a){let u=a.geometry;const f=a.type,m=a.tags,_=a.id,b=e*Math.pow(2,i),A=e*t,C=e*r;let R=Dl[f],U,X;function ee(ke){for(let Ne=0;Ne<ke.length;Ne++){const it=ke[Ne];if(it[3])break;const gt=180-(it[1]+C)*360/b,rr=(it[0]+A)*360/b-180,Kt=360/Math.PI*Math.atan(Math.exp(gt*Math.PI/180))-90;ke[Ne]=[rr,Kt,0,1]}}switch(f){case 1:const ke=[];for(U=0;U<u.length;U++)ke[U]=u[U][0];u=ke,ee(u);break;case 2:for(U=0;U<u.length;U++)ee(u[U]);break;case 3:for(u=xh(u),U=0;U<u.length;U++)for(X=0;X<u[U].length;X++)ee(u[U][X]);break}return u.length===1?u=u[0]:R="Multi"+R,{type:"Feature",geometry:{type:R,coordinates:u},properties:m,id:_,tileOrigin:[0,0],coord:""}}var Zc=(e,t,r,i)=>zc(void 0,null,function*(){return new Promise(a=>{const u=t.getTile(e.z,e.x,e.y),m={layers:{defaultLayer:{features:u?u.features.map(b=>Vc(i,r.x,r.y,r.z,b)):[]}}},_=new Nc(m,e.x,e.y,e.z);a(_)})});function $p(e){const t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?t:Uc(Uc({},t),e.geojsonvtOptions)}function Bl(e,t){const r=$p(t),i=r.extent||4096,a=Qd(e,r),u=(m,_)=>Zc(_,a,m,i),f=kc(Uc(Uc({},lc),t),{getTileData:u});return{data:e,dataArray:[],tilesetOptions:f,isTile:!0}}var jc=Object.defineProperty,If=Object.defineProperties,up=Object.getOwnPropertyDescriptors,Mf=Object.getOwnPropertySymbols,lp=Object.prototype.hasOwnProperty,Gu=Object.prototype.propertyIsEnumerable,Fl=(e,t,r)=>t in e?jc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cp=(e,t)=>{for(var r in t||(t={}))lp.call(t,r)&&Fl(e,r,t[r]);if(Mf)for(var r of Mf(t))Gu.call(t,r)&&Fl(e,r,t[r]);return e},hp=(e,t)=>If(e,up(t));function fp(e,t){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:i,requestParameters:a={}}=t,u=new Promise(_=>{e instanceof HTMLImageElement||Cc(e)?_([e]):Qp(e,a,b=>{_(b)})}),f=In(i,r);return{originData:e,images:u,_id:1,dataArray:[{_id:0,coordinates:f}]}}function Qp(e,t,r){const i=[];if(typeof e=="string")ro(hp(cp({},t),{url:e}),(a,u)=>{u&&(i.push(u),r(i))});else{const a=e.length;let u=0;e.forEach(f=>{ro(hp(cp({},t),{url:f}),(m,_)=>{u++,_&&i.push(_),u===a&&r(i)})})}return fp}var Hc=Object.defineProperty,em=Object.defineProperties,ml=Object.getOwnPropertyDescriptors,Of=Object.getOwnPropertySymbols,Xc=Object.prototype.hasOwnProperty,cc=Object.prototype.propertyIsEnumerable,pp=(e,t,r)=>t in e?Hc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Nl=(e,t)=>{for(var r in t||(t={}))Xc.call(t,r)&&pp(e,r,t[r]);if(Of)for(var r of Of(t))cc.call(t,r)&&pp(e,r,t[r]);return e},Xh=(e,t)=>em(e,ml(t)),Pf=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),ds=(e,t,r,i)=>Pf(void 0,null,function*(){const a={x:t.x,y:t.y,z:t.z},u=mn(e,a);return new Promise(f=>{i?i(a,(m,_)=>{if(m||!_){const b={layers:{defaultLayer:{features:[]}}},A=new Nc(b,t.x,t.y,t.z);f(A)}else{const b={layers:{defaultLayer:{features:_.features}}},A=new Nc(b,t.x,t.y,t.z);f(A)}}):ei(Xh(Nl({},r),{url:u}),(m,_)=>{if(m||!_){const b={layers:{defaultLayer:{features:[]}}},A=new Nc(b,t.x,t.y,t.z);f(A)}else{const A={layers:{defaultLayer:{features:JSON.parse(_)}}},C=new Nc(A,t.x,t.y,t.z);f(C)}})})});function ns(e,t){const r=(a,u)=>ds(e,u,t==null?void 0:t.requestParameters,t.getCustomData),i=Xh(Nl({},t),{getTileData:r});return{dataArray:[],tilesetOptions:i,isTile:!0}}var _a=H(99996),nu=H(51663),Jp=H.n(nu),Wh=Object.defineProperty,ed=Object.defineProperties,tm=Object.getOwnPropertyDescriptors,td=Object.getOwnPropertySymbols,rd=Object.prototype.hasOwnProperty,rm=Object.prototype.propertyIsEnumerable,dp=(e,t,r)=>t in e?Wh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,is=(e,t)=>{for(var r in t||(t={}))rd.call(t,r)&&dp(e,r,t[r]);if(td)for(var r of td(t))rm.call(t,r)&&dp(e,r,t[r]);return e},nm=(e,t)=>ed(e,tm(t)),mp=class{constructor(e,t,r,i){this.vectorLayerCache={},this.x=t,this.y=r,this.z=i,this.vectorTile=new _a.VectorTile(new(Jp())(e))}getTileData(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];const t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;const r=[];for(let i=0;i<t.length;i++){const u=t.feature(i).toGeoJSON(this.x,this.y,this.z);r.push(nm(is({},u),{properties:is({id:u.id},u.properties)}))}return this.vectorLayerCache[e]=r,r}getFeatureById(){throw new Error("Method not implemented.")}},vp=Object.defineProperty,nd=Object.defineProperties,gp=Object.getOwnPropertyDescriptors,id=Object.getOwnPropertySymbols,im=Object.prototype.hasOwnProperty,od=Object.prototype.propertyIsEnumerable,_p=(e,t,r)=>t in e?vp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,F=(e,t)=>{for(var r in t||(t={}))im.call(t,r)&&_p(e,r,t[r]);if(id)for(var r of id(t))od.call(t,r)&&_p(e,r,t[r]);return e},le=(e,t)=>nd(e,gp(t)),De=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),At={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},$t=(e,t,r,i,a)=>De(void 0,null,function*(){const u=mn(e,t);return new Promise(f=>{if(a)a({x:r.x,y:r.y,z:r.z},(m,_)=>{if(m||!_)f(void 0);else{const b=new mp(_,r.x,r.y,r.z);f(b)}});else{const m=qn(le(F({},i),{url:u}),(_,b)=>{if(_||!b)f(void 0);else{const A=new mp(b,r.x,r.y,r.z);f(A)}});r.xhrCancel=()=>m.cancel()}})});function Ct(e,t){const r=Array.isArray(e)?e[0]:e,i=(u,f)=>$t(r,u,f,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData),a=le(F(F({},At),t),{getTileData:i});return{data:r,dataArray:[],tilesetOptions:a,isTile:!0}}function pt(e,t,r){switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r;case"%":return t%r;case"^":return Math.pow(t,r);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return r===-1?Math.atan(t):Math.atan2(t,r);case"min":return Math.min(t,r);case"max":return Math.max(t,r);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function mr(e,t){const{width:r,height:i}=t[0],a=t.map(_=>_.rasterData),u=r*i,f=[],m=JSON.stringify(e);for(let _=0;_<u;_++){const b=JSON.parse(m),A=dr(b,a,_);if(typeof A=="number")f.push(A);else{const C=xr(b);f.push(C)}}return f}function dr(e,t,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return t[e[1]][r]}catch(i){return console.warn("Raster Data err!"),0}e.map((i,a)=>{if(Array.isArray(i)&&i.length>0)switch(i[0]){case"band":try{e[a]=t[i[1]][r]}catch(u){console.warn("Raster Data err!"),e[a]=0}break;default:dr(i,t,r)}})}function Pr(e){const[t,r=-1,i=-1]=e;return t===void 0?(console.warn("Express err!"),["+",0,0]):[t.replace(/\s+/g,""),r,i]}function xr(e){const t=Pr(e),r=t[0];let i=t[1],a=t[2];return Array.isArray(i)&&(i=xr(e[1])),Array.isArray(a)&&(a=xr(e[2])),pt(r,i,a)}var Mr={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:kr}};function kr(e,t){const r=e[0].rasterData,i=e[1].rasterData,a=e[2].rasterData,u=[],[f,m]=(t==null?void 0:t.countCut)||[2,98],_=(t==null?void 0:t.RMinMax)||fr(r,f,m),b=(t==null?void 0:t.GMinMax)||fr(i,f,m),A=(t==null?void 0:t.BMinMax)||fr(a,f,m);for(let C=0;C<r.length;C++)u.push(Math.max(0,r[C]-_[0])),u.push(Math.max(0,i[C]-b[0])),u.push(Math.max(0,a[C]-A[0]));return{rasterData:u,rMinMax:_,gMinMax:b,bMinMax:A}}function fr(e,t,r){const i=e.slice().sort((m,_)=>m-_),a=i.length,u=i[Math.ceil(a*t/100)],f=i[Math.ceil(a*r/100)];return[u,f]}var Or=Object.defineProperty,lt=Object.defineProperties,Zt=Object.getOwnPropertyDescriptors,br=Object.getOwnPropertySymbols,Wr=Object.prototype.hasOwnProperty,ur=Object.prototype.propertyIsEnumerable,Jr=(e,t,r)=>t in e?Or(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vr=(e,t)=>{for(var r in t||(t={}))Wr.call(t,r)&&Jr(e,r,t[r]);if(br)for(var r of br(t))ur.call(t,r)&&Jr(e,r,t[r]);return e},qr=(e,t)=>lt(e,Zt(t)),lr=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())});function Vr(e,t,r){return lr(this,null,function*(){if(e.length===0)return{rasterData:[0],width:1,heigh:1};const i=yield Promise.all(e.map(({data:_,bands:b=[0]})=>t(_,b))),a=[];i.forEach(_=>{Array.isArray(_)?a.push(..._):a.push(_)});const{width:u,height:f}=a[0];let m;switch(typeof r){case"function":m=r(a);break;case"object":Array.isArray(r)?m={rasterData:mr(r,a)}:m=Rn(r,a);break;default:m={rasterData:a[0].rasterData}}return qr(vr({},m),{width:u,height:f})})}function Rn(e,t){const r=Mr[e.type];if(r.type==="function")return r.method(t,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?Gn(r.expression,t):{rasterData:mr(r.expression,t)}}function Gn(e,t){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");const r=mr(e.r||["band",0],t),i=mr(e.g||["band",0],t),a=mr(e.b||["band",0],t);return[r,i,a]}function Zr(e,t,r,i){return lr(this,null,function*(){const a=yield Vr(e,t,r);i(null,{data:a})})}function gr(e,t){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:i,width:a,height:u,min:f,max:m,format:_,operation:b}=t;let A,C,R;if(_===void 0||Fn(e))A=Array.from(e),C=a,R=u;else{const ee=Array.isArray(e)?e:[e];A=Vr(ee,_,b)}const U=In(i,r);return{_id:1,dataArray:[{_id:1,data:A,width:C,height:R,min:f,max:m,coordinates:U}]}}var _e=H(55443),D=H(35576);let ni=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),O=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({});const li=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{camelCase:Xn,isNil:Un,upperFirst:Fi}=Kn;class fo{constructor(){(0,D.Z)(this,"shaderModuleService",void 0),(0,D.Z)(this,"rendererService",void 0),(0,D.Z)(this,"config",void 0),(0,D.Z)(this,"quad",li),(0,D.Z)(this,"enabled",!0),(0,D.Z)(this,"renderToScreen",!1),(0,D.Z)(this,"model",void 0),(0,D.Z)(this,"name",void 0),(0,D.Z)(this,"optionsToUpdate",{})}getName(){return this.name}setName(t){this.name=t}getType(){return ni.PostProcessing}init(t,r){this.config=r,this.rendererService=t.getContainer().rendererService,this.shaderModuleService=t.getContainer().shaderModuleService;const{createAttribute:i,createBuffer:a,createModel:u}=this.rendererService,{vs:f,fs:m,uniforms:_}=this.setupShaders();this.model=u({vs:f,fs:m,attributes:{a_Position:i({buffer:a({data:[-4,-4,4,-4,0,4],type:O.FLOAT}),size:2})},uniforms:(0,_e.Z)((0,_e.Z)({u_Texture:null},_),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}render(t,r){const i=t.multiPassRenderer.getPostProcessor(),{useFramebuffer:a,getViewportSize:u,clear:f}=this.rendererService,{width:m,height:_}=u();a(this.renderToScreen?null:i.getWriteFBO(),()=>{f({framebuffer:i.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});const b=(0,_e.Z)({u_BloomFinal:0,u_Texture:i.getReadFBO(),u_ViewportSize:[m,_]},this.convertOptionsToUniforms(this.optionsToUpdate));r&&(b.u_BloomFinal=1,b.u_Texture2=r),this.model.draw({uniforms:b})})}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setRenderToScreen(t){this.renderToScreen=t}updateOptions(t){this.optionsToUpdate=(0,_e.Z)((0,_e.Z)({},this.optionsToUpdate),t)}setupShaders(){throw new Error("Method not implemented.")}convertOptionsToUniforms(t){const r={};return Object.keys(t).forEach(i=>{Un(t[i])||(r[`u_${Fi(Xn(i))}`]=t[i])}),r}}function Za(e){let t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break;default:}return t}const _i=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ta(e,t=!1){const r={};return e=e.replace(_i,(i,a,u)=>{const f=u.split(":"),m=f[0].trim();let _="";switch(f.length>1&&(_=f[1].trim()),a){case"bool":_=_==="true";break;case"float":case"int":_=Number(_);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":_?_=_.replace("[","").replace("]","").split(",").reduce((b,A)=>(b.push(Number(A.trim())),b),[]):_=new Array(Za(a)).fill(0);break;default:}return r[m]=_,`${t?"uniform ":""}${a} ${m};
`}),{content:e,uniforms:r}}function oo(e){let{content:t,uniforms:r}=ta(e,!0);return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(i,a,u)=>{u=u.trim().replace(/^.*$/gm,_=>`uniform ${_}`);const{content:f,uniforms:m}=ta(u);return Object.assign(r,m),`${a}{
${f}
};`}),{content:t,uniforms:r}}function ha(e){const t={};return e.replace(_i,(r,i,a)=>{const u=a.trim();return t[u]?"":(t[u]=!0,`uniform ${i} ${u};
`)})}const ya=null;function qo(e){return ya.indexOf(e)}const{clamp:xa}=Kn,os=2,Ra=4,ai=64,as=128,Zi=256,Ln=512,xi=8192,Ni=16384,ba=32768,Yu=null,Ae=131072,Dt=262144,vt=524288,on=1048576,ci=2097152,ao=4194304,J=8388608,fe=16777216,Be=null;function mt(e,t){return e=xa(Math.floor(e),0,255),t=xa(Math.floor(t),0,255),256*e+t}function dt(e){const{color:t,radius:r,tileX:i,tileY:a,shape:u,opacity:f,stroke:m,strokeWidth:_,strokeOpacity:b}=e,A=[],C=[],R=[],U=[mt(t[0],t[1]),mt(t[2],t[3])],X=[mt(m[0],m[1]),mt(m[2],m[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(([ee,xe])=>{A.push([...U,(ee+1)*J+(xe+1)*ci+getShapeIndex(u)*Ae+r,(i+512)*vt+(a+512)*ai]),C.push([...X,_,b]),R.push([f,0,0,0])}),{packedBuffer:A,packedBuffer2:C,packedBuffer3:R}}function Xe(e,t){if(e===0&&!t)return 0;if(e===1&&t)return 4294967295;const r=t?1:0,i=Math.floor(e*127);return i*Be+r*fe+i*Ae+r*Yu+i*Ln+r*Zi+i*os+r}const Ye={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};let Qe=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),Ee=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.METER_OFFSET=5]="METER_OFFSET",e}({});const We={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter"};var ue={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};let He=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Et=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),kt=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),hr=function(e){return e.AND="and",e.OR="or",e}({}),Wt=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Ht=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e.CUSTOM="threshold",e}({}),cn=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Ot=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({});const pn=["mapload","mapchange","mapAfterFrameChange"];var Dn=H(25865),jn=H.n(Dn);const Oi=30;function Ea({characterSet:e,getFontWidth:t,fontHeight:r,buffer:i,maxCanvasWidth:a,mapping:u={},xOffset:f=0,yOffset:m=0}){let _=0,b=f;Array.from(e).forEach((C,R)=>{if(!u[C]){const U=t(C,R);b+Oi>a&&(b=0,_++),u[C]={x:b,y:m+_*Oi,width:Oi,height:Oi,advance:U},b+=Oi}});const A=r+i*2;return{mapping:u,xOffset:b,yOffset:m+_*A,canvasHeight:mu(m+(_+1)*A)}}function qu(e,t,r){let i=0,a=0,u=0,f=[];const m={};for(const b of e)if(!m[b.id]){const{size:A}=b;i+A+t>r&&(Lf(m,f,a),i=0,a=u+a+t,u=0,f=[]),f.push({icon:b,xOffset:i}),i=i+A+t,u=Math.max(u,A)}f.length>0&&Lf(m,f,a);const _=mu(u+a+t);return{mapping:m,canvasHeight:_}}function Lf(e,t,r){for(const i of t){const{icon:a,xOffset:u}=i;e[a.id]=(0,_e.Z)((0,_e.Z)({},a),{},{x:u,y:r,image:a.image,width:a.width,height:a.height})}}function mu(e){return Math.pow(2,Math.ceil(Math.log2(e)))}const ad=Oo(),Ul="sans-serif",yp="normal",pv=24,dv=3,mv=.25,sd=8,bh=1024,om=1,Gh=1,vv=3,ja=null;function Oo(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}function am(e,t,r,i){e.font=`${i} ${r}px ${t}`,e.fillStyle="black",e.textBaseline="middle"}function sm(e,t){for(let r=0;r<e.length;r++)t.data[4*r+3]=e[r]}class gv extends wa.EventEmitter{constructor(...t){super(...t),(0,D.Z)(this,"fontAtlas",void 0),(0,D.Z)(this,"iconFontMap",void 0),(0,D.Z)(this,"iconFontGlyphs",{}),(0,D.Z)(this,"fontOptions",void 0),(0,D.Z)(this,"key",void 0),(0,D.Z)(this,"cache",new ma(vv))}get scale(){return Gh}get canvas(){const t=this.cache.get(this.key);return t&&t.data}get mapping(){const t=this.cache.get(this.key);return t&&t.mapping||{}}getCanvasByKey(t){const r=this.cache.get(t);return r&&r.data}getMappingByKey(t){const r=this.cache.get(t);return r&&r.mapping||{}}init(){this.cache.clear(),this.fontOptions={fontFamily:Ul,fontWeight:yp,characterSet:ad,fontSize:pv,buffer:dv,sdf:!0,cutoff:mv,radius:sd,iconfont:!1},this.key="",this.iconFontMap=new Map}addIconGlyphs(t){t.forEach(r=>{this.iconFontGlyphs[r.name]=r.unicode})}addIconFont(t,r){this.iconFontMap.set(t,r)}getIconFontKey(t){return this.iconFontMap.get(t)||t}getGlyph(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}setFontOptions(t){this.fontOptions=(0,_e.Z)((0,_e.Z)({},this.fontOptions),t),this.key=this.getKey();const r=this.getNewChars(this.key,this.fontOptions.characterSet),i=this.cache.get(this.key);if(i&&r.length===0)return;const a=this.generateFontAtlas(this.key,r,i);this.fontAtlas=a,this.cache.set(this.key,a)}addFontFace(t,r){const i=document.createElement("style");i.type="text/css",i.innerText=`
        @font-face{
            font-family: '${t}';
            src: url('${r}') format('woff2'),
            url('${r}') format('woff'),
            url('${r}') format('truetype');
        }`,i.onload=()=>{if(document.fonts)try{document.fonts.load(`24px ${t}`,"L7text"),document.fonts.ready.then(()=>{this.emit("fontloaded",{fontFamily:t})})}catch(a){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(a)}},document.getElementsByTagName("head")[0].appendChild(i)}destroy(){this.cache.clear(),this.iconFontMap.clear()}generateFontAtlas(t,r,i){const{fontFamily:a,fontWeight:u,fontSize:f,buffer:m,sdf:_,radius:b,cutoff:A,iconfont:C}=this.fontOptions;let R=i&&i.data;R||(R=window.document.createElement("canvas"),R.width=bh);const U=R.getContext("2d",{willReadFrequently:!0});am(U,a,f,u);const{mapping:X,canvasHeight:ee,xOffset:xe,yOffset:ke}=Ea((0,_e.Z)({getFontWidth:it=>U.measureText(it).width,fontHeight:f*Gh,buffer:m,characterSet:r,maxCanvasWidth:bh},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset})),Ne=U.getImageData(0,0,R.width,R.height);if(R.height=ee,U.putImageData(Ne,0,0),am(U,a,f,u),_){const it=new(jn())(f,m,b,A,a,u),gt=U.getImageData(0,0,it.size,it.size);for(const rr of r){if(C){const Kt=String.fromCharCode(parseInt(rr.replace("&#x","").replace(";",""),16)),Rt=it.draw(Kt);sm(Rt,gt)}else sm(it.draw(rr),gt);U.putImageData(gt,X[rr].x,X[rr].y)}}else for(const it of r)U.fillText(it,X[it].x,X[it].y+f*om);return{xOffset:xe,yOffset:ke,mapping:X,data:R,width:R.width,height:R.height}}getKey(){const{fontFamily:t,fontWeight:r}=this.fontOptions;return`${t}_${r}`}getNewChars(t,r){const i=this.cache.get(t);if(!i)return r;const a=[],u=i.mapping,f=new Set(Object.keys(u));return new Set(r).forEach(_=>{f.has(_)||a.push(_)}),a}}var Xt=H(84964);const _v=3,ud=1024,kl=64;class Yh extends wa.EventEmitter{constructor(...t){super(...t),(0,D.Z)(this,"canvasHeight",128),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"canvas",void 0),(0,D.Z)(this,"iconData",void 0),(0,D.Z)(this,"iconMap",void 0),(0,D.Z)(this,"ctx",void 0),(0,D.Z)(this,"loadingImageCount",0)}isLoading(){return this.loadingImageCount===0}init(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}addImage(t,r){var i=this;return(0,Xt.Z)(function*(){let a=new Image;i.loadingImageCount++,i.hasImage(t)?console.warn("Image Id already exists"):i.iconData.push({id:t,size:kl}),i.updateIconMap(),a=yield i.loadImage(r);const u=i.iconData.find(f=>f.id===t);u&&(u.image=a,u.width=a.width,u.height=a.height),i.update()})()}addImageMini(t,r,i){const a=i.getSceneConfig().canvas;let u=a.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:kl}),this.updateIconMap(),this.loadImageMini(r,a).then(f=>{u=f;const m=this.iconData.find(_=>_.id===t);m&&(m.image=u,m.width=u.width,m.height=u.height),this.update()})}getTexture(){return this.texture}getIconMap(){return this.iconMap}getCanvas(){return this.canvas}hasImage(t){return this.iconMap.hasOwnProperty(t)}removeImage(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(r=>r.id!==t),delete this.iconMap[t],this.update())}destroy(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}loadImage(t){return new Promise((r,i)=>{if(t instanceof HTMLImageElement){r(t);return}const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{r(a)},a.onerror=()=>{i(new Error("Could not load image at "+t))},a.src=t instanceof File?URL.createObjectURL(t):t})}update(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}updateIconAtlas(){this.canvas.width=ud,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(t=>{const{x:r,y:i,image:a,width:u=64,height:f=64}=this.iconMap[t],_=Math.max(u,f)/kl,b=f/_,A=u/_;a&&this.ctx.drawImage(a,r+(kl-A)/2,i+(kl-b)/2,A,b)})}updateIconMap(){const{mapping:t,canvasHeight:r}=qu(this.iconData,_v,ud);this.iconMap=t,this.canvasHeight=r}loadImageMini(t,r){return new Promise((i,a)=>{const u=r.createImage();u.crossOrigin="anonymous",u.onload=()=>{i(u)},u.onerror=()=>{a(new Error("Could not load image at "+t))},u.src=t})}}var po=H(39536);class Ia{constructor(){(0,D.Z)(this,"viewport",void 0),(0,D.Z)(this,"overridedViewProjectionMatrix",void 0),(0,D.Z)(this,"viewMatrixInverse",void 0),(0,D.Z)(this,"cameraPosition",void 0)}init(){}update(t){this.viewport=t,this.viewMatrixInverse=po.create(),po.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}getProjectionMatrix(){return this.viewport.getProjectionMatrix()}getModelMatrix(){return this.viewport.getModelMatrix()}getViewMatrix(){return this.viewport.getViewMatrix()}getViewMatrixUncentered(){return this.viewport.getViewMatrixUncentered()}getViewProjectionMatrixUncentered(){return this.viewport.getViewProjectionMatrixUncentered()}getViewProjectionMatrix(){return this.overridedViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}getZoom(){return this.viewport.getZoom()}getZoomScale(){return this.viewport.getZoomScale()}getCenter(){const[t,r]=this.viewport.getCenter();return[t,r]}getFocalDistance(){return this.viewport.getFocalDistance()}getCameraPosition(){return this.cameraPosition}projectFlat(t,r){return this.viewport.projectFlat(t,r)}setViewProjectionMatrix(t){this.overridedViewProjectionMatrix=t}}const xp={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"};class Wc{constructor(){(0,D.Z)(this,"container",void 0),(0,D.Z)(this,"controlCorners",void 0),(0,D.Z)(this,"controlContainer",void 0),(0,D.Z)(this,"scene",void 0),(0,D.Z)(this,"mapsService",void 0),(0,D.Z)(this,"controls",[]),(0,D.Z)(this,"unAddControls",[])}init(t,r){this.container=t.container,this.scene=r,this.mapsService=r.mapService,this.initControlPos()}addControl(t,r){r.mapService.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}getControlByName(t){return this.controls.find(r=>r.controlOption.name===t)}removeControl(t){const r=this.controls.indexOf(t);return r>-1&&this.controls.splice(r,1),t.remove(),this}addControls(){this.unAddControls.forEach(t=>{t.addTo(this.scene),this.controls.push(t)}),this.unAddControls=[]}destroy(){for(const t of this.controls)t.remove();this.controls=[],this.clearControlPos()}initControlPos(){const t=this.controlCorners={},r="l7-",i=this.controlContainer=Mi("div",r+"control-container",this.container);function a(f=[]){const m=f.map(_=>r+_).join(" ");t[f.filter(_=>!["row","column"].includes(_)).join("")]=Mi("div",m,i)}function u(f){return[...f.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),xp[f]]}Object.values(Qe).forEach(f=>{a(u(f))}),this.checkCornerOverlap()}clearControlPos(){for(const t in this.controlCorners)this.controlCorners[t]&&la(this.controlCorners[t]);this.controlContainer&&la(this.controlContainer)}checkCornerOverlap(){const t=window.MutationObserver;if(t)for(const r of Object.keys(this.controlCorners)){const i=r.match(/^(top|bottom)(left|right)$/);if(i){const[,a,u]=i,f=this.controlCorners[`${a}${u}`];new t(([{target:_}])=>{f&&(f.style[a]=_.clientHeight+"px")}).observe(this.controlCorners[`${u}${a}`],{childList:!0,attributes:!0})}}}}class ld{constructor(){(0,D.Z)(this,"container",void 0),(0,D.Z)(this,"scene",void 0),(0,D.Z)(this,"mapsService",void 0),(0,D.Z)(this,"markers",[]),(0,D.Z)(this,"markerLayers",[]),(0,D.Z)(this,"unAddMarkers",[]),(0,D.Z)(this,"unAddMarkerLayers",[])}addMarkerLayer(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}removeMarkerLayer(t){t.destroy(),this.markerLayers.indexOf(t);const r=this.markerLayers.indexOf(t);r>-1&&this.markerLayers.splice(r,1)}addMarker(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}addMarkers(){this.unAddMarkers.forEach(t=>{t.addTo(this.scene),this.markers.push(t)}),this.unAddMarkers=[]}addMarkerLayers(){this.unAddMarkerLayers.forEach(t=>{this.markerLayers.push(t),t.addTo(this.scene)}),this.unAddMarkers=[]}removeMarker(t){t.remove(),this.markers.indexOf(t);const r=this.markers.indexOf(t);r>-1&&this.markers.splice(r,1)}removeAllMarkers(){this.destroy()}init(t){this.scene=t,this.mapsService=t.mapService}destroy(){this.markers.forEach(t=>{t.remove()}),this.markers=[],this.markerLayers.forEach(t=>{t.destroy()}),this.markerLayers=[]}removeMakerLayerMarker(t){t.destroy()}}class cd{constructor(){(0,D.Z)(this,"scene",void 0),(0,D.Z)(this,"mapsService",void 0),(0,D.Z)(this,"popups",[]),(0,D.Z)(this,"unAddPopups",[])}get isMarkerReady(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}removePopup(t){t!=null&&t.isOpen()&&t.remove();const r=this.popups.indexOf(t);r>-1&&this.popups.splice(r,1);const i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}destroy(){this.popups.forEach(t=>t.remove())}addPopup(t){t&&t.getOptions().autoClose&&[...this.popups,...this.unAddPopups].forEach(r=>{r.getOptions().autoClose&&this.removePopup(r)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",()=>{this.removePopup(t)})}initPopup(){this.unAddPopups.length&&this.unAddPopups.forEach(t=>{this.addPopup(t),this.unAddPopups=[]})}init(t){this.scene=t,this.mapsService=t.mapService}}var Df={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"};const{merge:Gc}=Kn,xv={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},bv={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:hr.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0};class Wg{constructor(){(0,D.Z)(this,"sceneConfigCache",{}),(0,D.Z)(this,"layerConfigCache",{}),(0,D.Z)(this,"layerAttributeConfigCache",{})}getSceneConfig(t){return this.sceneConfigCache[t]}getSceneWarninfo(t){return Df[t]}setSceneConfig(t,r){this.sceneConfigCache[t]=(0,_e.Z)((0,_e.Z)({},xv),r)}getLayerConfig(t){return this.layerConfigCache[t]}setLayerConfig(t,r,i){this.layerConfigCache[r]=(0,_e.Z)({},Gc({},this.sceneConfigCache[t],bv,i))}getAttributeConfig(t){return this.layerAttributeConfigCache[t]}setAttributeConfig(t,r){this.layerAttributeConfigCache[t]=(0,_e.Z)((0,_e.Z)({},this.layerAttributeConfigCache[t]),r)}clean(){this.sceneConfigCache={},this.layerConfigCache={}}}var ra=H(49953);const hc=Math.PI/180,Ev=512,n=4003e4;function o({latitude:e=0,zoom:t=0,scale:r,highPrecision:i=!1,flipY:a=!1}){r=r!==void 0?r:Math.pow(2,t);const u={},f=Ev*r,m=Math.cos(e*hc),_=f/360,b=_/m,A=f/n/m;if(u.pixelsPerMeter=[A,-A,A],u.metersPerPixel=[1/A,-1/A,1/A],u.pixelsPerDegree=[_,-b,A],u.degreesPerPixel=[1/_,-1/b,1/A],i){const C=hc*Math.tan(e*hc)/m,R=_*C/2,U=f/n*C,X=U/b*A;u.pixelsPerDegree2=[0,-R,U],u.pixelsPerMeter2=[X,0,X],a&&(u.pixelsPerDegree2[1]=-u.pixelsPerDegree2[1],u.pixelsPerMeter2[1]=-u.pixelsPerMeter2[1])}return a&&(u.pixelsPerMeter[1]=-u.pixelsPerMeter[1],u.metersPerPixel[1]=-u.metersPerPixel[1],u.pixelsPerDegree[1]=-u.pixelsPerDegree[1],u.degreesPerPixel[1]=-u.degreesPerPixel[1]),u}const s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];class p{constructor(t){(0,D.Z)(this,"needRefresh",!0),(0,D.Z)(this,"coordinateSystem",void 0),(0,D.Z)(this,"viewportCenter",void 0),(0,D.Z)(this,"viewportCenterProjection",void 0),(0,D.Z)(this,"pixelsPerDegree",void 0),(0,D.Z)(this,"pixelsPerDegree2",void 0),(0,D.Z)(this,"pixelsPerMeter",void 0),this.cameraService=t}refresh(t){const r=this.cameraService.getZoom(),i=t||this.cameraService.getCenter(),{pixelsPerMeter:a,pixelsPerDegree:u}=o({latitude:i[1],zoom:r});this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=a,this.pixelsPerDegree=u,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Ee.LNGLAT?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Ee.LNGLAT_OFFSET&&this.calculateLnglatOffset(i,r),this.needRefresh=!1}getCoordinateSystem(){return this.coordinateSystem}setCoordinateSystem(t){this.coordinateSystem=t}getViewportCenter(){return this.viewportCenter}getViewportCenterProjection(){return this.viewportCenterProjection}getPixelsPerDegree(){return this.pixelsPerDegree}getPixelsPerDegree2(){return this.pixelsPerDegree2}getPixelsPerMeter(){return this.pixelsPerMeter}calculateLnglatOffset(t,r,i,a){const{pixelsPerMeter:u,pixelsPerDegree:f,pixelsPerDegree2:m}=o({latitude:t[1],zoom:r,scale:i,flipY:a,highPrecision:!0});let _=this.cameraService.getViewMatrix();const b=this.cameraService.getProjectionMatrix();let A=po.multiply([],b,_);const C=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,r));this.viewportCenterProjection=ra.fF([],[C[0],C[1],0,1],A),_=this.cameraService.getViewMatrixUncentered()||_,A=po.multiply([],b,_),A=po.multiply([],A,s),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=u,this.pixelsPerDegree=f,this.pixelsPerDegree2=m}}class g extends wa.EventEmitter{constructor(...t){super(...t),(0,D.Z)(this,"renderMap",new Map),(0,D.Z)(this,"enable",!1),(0,D.Z)(this,"renderEnable",!1),(0,D.Z)(this,"cacheLogs",{})}setEnable(t){this.enable=!!t}log(t,r){if(!this.enable)return;const i=t.split(".");let a=null;i.forEach((u,f)=>{a!==null?(a[u]||(a[u]={}),f!==i.length-1&&(a=a[u])):(this.cacheLogs[u]||(this.cacheLogs[u]={}),f!==i.length-1&&(a=this.cacheLogs[u])),f===i.length-1&&(a[u]=(0,_e.Z)((0,_e.Z)({time:Date.now()},a[u]),r))})}getLog(t){switch(typeof t){case"string":return this.cacheLogs[t];case"object":return t.map(r=>this.cacheLogs[r]).filter(r=>r!==void 0);case"undefined":return this.cacheLogs}}removeLog(t){delete this.cacheLogs[t]}generateRenderUid(){return this.renderEnable?ws():""}renderDebug(t){this.renderEnable=t}renderStart(t){if(!this.renderEnable||!this.enable)return;const r=this.renderMap.get(t)||{};this.renderMap.set(t,(0,_e.Z)((0,_e.Z)({},r),{},{renderUid:t,renderStart:Date.now()}))}renderEnd(t){if(!this.renderEnable||!this.enable)return;const r=this.renderMap.get(t);if(r){const i=r.renderStart,a=Date.now();this.emit("renderEnd",(0,_e.Z)((0,_e.Z)({},r),{},{renderEnd:a,renderDuration:a-i})),this.renderMap.delete(t)}}destroy(){this.cacheLogs=null,this.renderMap.clear()}}var y=H(11553),E=H.n(y);const w={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"};class M extends oc(){get mapService(){return this.container.mapService}constructor(t){super(),(0,D.Z)(this,"indragging",!1),(0,D.Z)(this,"hammertime",void 0),(0,D.Z)(this,"lastClickTime",0),(0,D.Z)(this,"lastClickXY",[-1,-1]),(0,D.Z)(this,"clickTimer",void 0),(0,D.Z)(this,"$containter",void 0),(0,D.Z)(this,"onDrag",r=>{const i=this.interactionEvent(r);i.type=w[i.type],i.type==="dragging"?this.indragging=!0:this.indragging=!1,this.emit(He.Drag,i)}),(0,D.Z)(this,"onHammer",r=>{r.srcEvent.stopPropagation();const i=this.interactionEvent(r);this.emit(He.Hover,i)}),(0,D.Z)(this,"onTouch",r=>{const i=r.touches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchstart"})}),(0,D.Z)(this,"onTouchEnd",r=>{if(r.changedTouches.length>0){const i=r.changedTouches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchend"})}}),(0,D.Z)(this,"onTouchMove",r=>{const i=r.changedTouches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchmove"})}),(0,D.Z)(this,"onHover",r=>{const{clientX:i,clientY:a}=r;let u=i,f=a;const m=r.type,_=this.mapService.getMapContainer();if(_){const{top:A,left:C}=_.getBoundingClientRect();u=u-C-_.clientLeft,f=f-A-_.clientTop}const b=this.mapService.containerToLngLat([u,f]);if(m==="click"){this.isDoubleTap(u,f,b);return}if(m==="touch"){this.isDoubleTap(u,f,b);return}m!=="click"&&m!=="dblclick"&&this.emit(He.Hover,{x:u,y:f,lngLat:b,type:m,target:r})}),this.container=t}init(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}destroy(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(He.Hover)}triggerHover({x:t,y:r}){this.emit(He.Hover,{x:t,y:r})}triggerSelect(t){this.emit(He.Select,{featureId:t})}triggerActive(t){this.emit(He.Active,{featureId:t})}addEventListenerOnMap(){const t=this.mapService.getMapContainer();if(t){const r=new(E()).Manager(t);r.add(new(E()).Tap({event:"dblclick",taps:2})),r.add(new(E()).Tap({event:"click"})),r.add(new(E()).Pan({threshold:0,pointers:0})),r.add(new(E()).Press({})),r.on("dblclick click",this.onHammer),r.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("touchstart",this.onTouch),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("mousemove",this.onHover),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=r}}removeEventListenerOnMap(){const t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("touchstart",this.onTouch),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}interactionEvent(t){const{type:r,pointerType:i}=t;let a,u;i==="touch"?(u=Math.floor(t.pointers[0].clientY),a=Math.floor(t.pointers[0].clientX)):(u=Math.floor(t.srcEvent.y),a=Math.floor(t.srcEvent.x));const f=this.mapService.getMapContainer();if(f){const{top:_,left:b}=f.getBoundingClientRect();a-=b,u-=_}const m=this.mapService.containerToLngLat([a,u]);return{x:a,y:u,lngLat:m,type:r,target:t.srcEvent}}isDoubleTap(t,r,i){const a=new Date().getTime();let u="click";a-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-r)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),u="dblclick",this.emit(He.Hover,{x:t,y:r,lngLat:i,type:u})):(this.lastClickTime=a,this.lastClickXY=[t,r],this.clickTimer=setTimeout(()=>{u="click",this.emit(He.Hover,{x:t,y:r,lngLat:i,type:u})},400))}}let L=0;function k(e){let t=e;if(typeof e=="string"&&(t=document.getElementById(e)),t){const r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id=`l7-scene-${L++}`,r.classList.add("l7-scene"),t.appendChild(r),r}return null}function Z(e){var t;let r=!0;if((e==null||(t=e.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement){var i;let u=e==null||(i=e.target)===null||i===void 0?void 0:i.target;for(;u;){var a;const f=Array.from(u.classList);if(f.includes("l7-marker")||f.includes("l7-popup")){r=!1;break}u=(a=u)===null||a===void 0?void 0:a.parentElement}}return r}let q=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({});class te{constructor(t){var r=this;(0,D.Z)(this,"pickedColors",void 0),(0,D.Z)(this,"pickedTileLayers",[]),(0,D.Z)(this,"pickingFBO",void 0),(0,D.Z)(this,"width",0),(0,D.Z)(this,"height",0),(0,D.Z)(this,"alreadyInPicking",!1),(0,D.Z)(this,"pickBufferScale",1),(0,D.Z)(this,"pickFromPickingFBO",function(){var i=(0,Xt.Z)(function*(a,{x:u,y:f,lngLat:m,type:_,target:b}){var A;let C=!1;const{readPixels:R,readPixelsAsync:U,getViewportSize:X,queryVerdorInfo:ee}=r.rendererService,{width:xe,height:ke}=X(),{enableHighlight:Ne,enableSelect:it}=a.getLayerConfig(),gt=u*Xo,rr=f*Xo;if(gt>xe-1*Xo||gt<0||rr>ke-1*Xo||rr<0)return!1;let Kt;if(ee()==="WebGPU"?Kt=yield U({x:Math.floor(gt/r.pickBufferScale),y:Math.floor((ke-(f+1)*Xo)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:r.pickingFBO}):Kt=R({x:Math.floor(gt/r.pickBufferScale),y:Math.floor((ke-(f+1)*Xo)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:r.pickingFBO}),r.pickedColors=Kt,Kt[0]!==0||Kt[1]!==0||Kt[2]!==0){const tr=Es(Kt),Tn=a.layerPickService.getFeatureById(tr);tr!==a.getCurrentPickId()&&_==="mousemove"&&(_="mouseenter");const fi={x:u,y:f,type:_,lngLat:m,featureId:tr,feature:Tn,target:b};Tn&&(C=!0,a.setCurrentPickId(tr),r.triggerHoverOnLayer(a,fi))}else{const tr={x:u,y:f,lngLat:m,type:a.getCurrentPickId()!==null&&_==="mousemove"?"mouseout":"un"+_,featureId:null,target:b,feature:null};r.triggerHoverOnLayer(a,(0,_e.Z)((0,_e.Z)({},tr),{},{type:"unpick"})),r.triggerHoverOnLayer(a,tr),a.setCurrentPickId(null)}if(Ne&&a.layerPickService.highlightPickedFeature(Kt),it&&_==="click"&&((A=Kt)===null||A===void 0?void 0:A.toString())!==[0,0,0,0].toString()){const tr=Es(Kt);a.getCurrentSelectedId()===null||tr!==a.getCurrentSelectedId()?(a.layerPickService.selectFeature(Kt),a.setCurrentSelectedId(tr)):(a.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),a.setCurrentSelectedId(null))}return C});return function(a,u){return i.apply(this,arguments)}}()),this.container=t}get mapService(){return this.container.mapService}get rendererService(){return this.container.rendererService}get configService(){return this.container.globalConfigService}get interactionService(){return this.container.interactionService}get layerService(){return this.container.layerService}init(t){const{createTexture2D:r,createFramebuffer:i,getViewportSize:a}=this.rendererService;let{width:u,height:f}=a();this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,u=Math.round(u/this.pickBufferScale),f=Math.round(f/this.pickBufferScale);const m=r({width:u,height:f,usage:q.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=i({color:m,depth:!0,width:u,height:f}),this.interactionService.on(He.Hover,this.pickingAllLayer.bind(this))}boxPickLayer(t,r,i){var a=this;return(0,Xt.Z)(function*(){const{useFramebufferAsync:u,clear:f}=a.rendererService;a.resizePickingFBO(),t.hooks.beforePickingEncode.call(),yield u(a.pickingFBO,(0,Xt.Z)(function*(){f({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0})})),t.hooks.afterPickingEncode.call();const m=yield a.pickBox(t,r);i(m)})()}pickBox(t,r){var i=this;return(0,Xt.Z)(function*(){const[a,u,f,m]=r.map(ke=>{const Ne=ke<0?0:ke;return Math.floor(Ne*Xo/i.pickBufferScale)}),{readPixelsAsync:_,getViewportSize:b}=i.rendererService,{width:A,height:C}=b();if(a>(A-1)*Xo/i.pickBufferScale||f<0||u>(C-1)*Xo/i.pickBufferScale||m<0)return[];const R=Math.min(A/i.pickBufferScale,f)-a,U=Math.min(C/i.pickBufferScale,m)-u,X=yield _({x:a,y:Math.floor(C/i.pickBufferScale-(m+1)),width:R,height:U,data:new Uint8Array(R*U*4),framebuffer:i.pickingFBO}),ee=[],xe={};for(let ke=0;ke<X.length/4;ke=ke+1){const Ne=X.slice(ke*4,ke*4+4),it=Es(Ne);if(it!==-1&&!xe[it]){const gt=t.layerPickService.getFeatureById(it);ee.push((0,_e.Z)((0,_e.Z)({},gt),{},{pickedFeatureIdx:it})),xe[it]=!0}}return ee})()}handleCursor(t,r){const{cursor:i="",cursorEnabled:a}=t.getLayerConfig();if(a){const f=this.mapService.getType()==="amap"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),m=f==null?void 0:f.style.getPropertyValue("cursor");r==="unmousemove"&&m!==""?f==null||f.style.setProperty("cursor",""):r==="mousemove"&&(f==null||f.style.setProperty("cursor",i))}}destroy(){this.pickingFBO.destroy(),this.pickingFBO=null}pickingAllLayer(t){var r=this;return(0,Xt.Z)(function*(){!r.layerService.needPick(t.type)||!r.isPickingAllLayer()||(r.alreadyInPicking=!0,yield r.pickingLayers(t),r.layerService.renderLayers(),r.alreadyInPicking=!1)})()}isPickingAllLayer(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}resizePickingFBO(){const{getViewportSize:t}=this.rendererService,{width:r,height:i}=t();(this.width!==r||this.height!==i)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(i/this.pickBufferScale)}),this.width=r,this.height=i)}pickingLayers(t){var r=this;return(0,Xt.Z)(function*(){const{clear:i,useFramebufferAsync:a}=r.rendererService;r.resizePickingFBO();const u=r.layerService.getRenderList();for(const f of u.filter(m=>m.needPick(t.type)).reverse()){yield a(r.pickingFBO,(0,Xt.Z)(function*(){i({framebuffer:r.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),f.layerPickService.pickRender(t)}));const m=yield r.pickFromPickingFBO(f,t);if(r.layerService.pickedLayerId=m?+f.id:-1,m&&!f.getLayerConfig().enablePropagation)break}})()}triggerHoverOnLayer(t,r){Z(r)&&(this.handleCursor(t,r.type),t.emit(r.type,r))}}class ye{constructor(t=!0){(0,D.Z)(this,"autoStart",void 0),(0,D.Z)(this,"startTime",0),(0,D.Z)(this,"oldTime",0),(0,D.Z)(this,"running",!1),(0,D.Z)(this,"elapsedTime",0),this.autoStart=t}start(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const r=(typeof performance=="undefined"?Date:performance).now();t=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=t}return t}}const{throttle:Te}=Kn;class Ge extends wa.EventEmitter{get renderService(){return this.container.rendererService}get mapService(){return this.container.mapService}get debugService(){return this.container.debugService}constructor(t){super(),(0,D.Z)(this,"pickedLayerId",-1),(0,D.Z)(this,"clock",new ye),(0,D.Z)(this,"alreadyInRendering",!1),(0,D.Z)(this,"layers",[]),(0,D.Z)(this,"layerList",[]),(0,D.Z)(this,"layerRenderID",void 0),(0,D.Z)(this,"sceneInited",!1),(0,D.Z)(this,"animateInstanceCount",0),(0,D.Z)(this,"shaderPicking",!0),(0,D.Z)(this,"enableRender",!0),(0,D.Z)(this,"reRender",Te(()=>{this.renderLayers()},32)),(0,D.Z)(this,"throttleRenderLayers",Te(()=>{this.renderLayers()},16)),this.container=t}needPick(t){return this.updateLayerRenderList(),this.layerList.some(r=>r.needPick(t))}add(t){this.layers.push(t),this.sceneInited&&t.init().then(()=>{this.renderLayers()})}addMask(t){this.sceneInited&&t.init().then(()=>{this.renderLayers()})}initLayers(){var t=this;return(0,Xt.Z)(function*(){t.sceneInited=!0,t.layers.forEach(function(){var r=(0,Xt.Z)(function*(i){i.startInit||(yield i.init(),t.updateLayerRenderList())});return function(i){return r.apply(this,arguments)}}())})()}getSceneInited(){return this.sceneInited}getRenderList(){return this.layerList}getLayers(){return this.layers}getLayer(t){return this.layers.find(r=>r.id===t)}getLayerByName(t){return this.layers.find(r=>r.name===t)}remove(t,r){var i=this;return(0,Xt.Z)(function*(){r?r.layerChildren=r.layerChildren.filter(a=>a!==t):i.layers=i.layers.filter(a=>a!==t),t.destroy(),i.reRender(),i.emit("layerChange",i.layers)})()}removeAllLayers(){var t=this;return(0,Xt.Z)(function*(){t.destroy(),t.reRender()})()}setEnableRender(t){this.enableRender=t}renderLayers(){var t=this;return(0,Xt.Z)(function*(){if(t.alreadyInRendering||!t.enableRender)return;t.updateLayerRenderList();const r=t.debugService.generateRenderUid();t.debugService.renderStart(r),t.alreadyInRendering=!0,t.clear();for(const i of t.layerList)i.prerender();t.renderService.beginFrame();for(const i of t.layerList){const{enableMask:a}=i.getLayerConfig();i.masks.filter(u=>u.inited).length>0&&a&&t.renderMask(i.masks),i.getLayerConfig().enableMultiPassRenderer?yield i.renderMultiPass():i.render()}t.renderService.endFrame(),t.debugService.renderEnd(r),t.alreadyInRendering=!1})()}renderMask(t){let r=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});const i=t.length>1?kt.MULTIPLE:kt.SINGLE;for(const a of t)a.render({isStencil:!0,stencilType:i,stencilIndex:r++})}beforeRenderData(t){var r=this;return(0,Xt.Z)(function*(){(yield t.hooks.beforeRenderData.promise())&&r.renderLayers()})()}renderTileLayerMask(t){let r=0;const{enableMask:i=!0}=t.getLayerConfig();let a=t.tileMask?1:0;const u=t.masks.filter(m=>m.inited);a=a+(i?u.length:1);const f=a>1?kt.MULTIPLE:kt.SINGLE;if((t.tileMask||u.length&&i)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),u.length&&i)for(const m of u)m.render({isStencil:!0,stencilType:f,stencilIndex:r++});t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:f,stencilIndex:r++,stencilOperation:hr.OR})}renderTileLayer(t){var r=this;return(0,Xt.Z)(function*(){r.renderTileLayerMask(t),t.getLayerConfig().enableMultiPassRenderer?yield t.renderMultiPass():yield t.render()})()}updateLayerRenderList(){this.layerList=[],this.layers.filter(t=>t.inited).filter(t=>t.isVisible()).sort((t,r)=>t.zIndex-r.zIndex).forEach(t=>{this.layerList.push(t)})}destroy(){this.layers.forEach(t=>{t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}startAnimate(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}stopAnimate(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}getOESTextureFloat(){return this.renderService.extensionObject.OES_texture_float}enableShaderPick(){this.shaderPicking=!0}disableShaderPick(){this.shaderPicking=!1}getShaderPickStat(){return this.shaderPicking}clear(){const t=ti(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}runRender(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}stopRender(){window.cancelAnimationFrame(this.layerRenderID)}}var Le=H(38334);const{isNil:nt}=Kn;class ft{constructor(t){(0,D.Z)(this,"name",void 0),(0,D.Z)(this,"type",void 0),(0,D.Z)(this,"scale",void 0),(0,D.Z)(this,"descriptor",void 0),(0,D.Z)(this,"featureBufferLayout",[]),(0,D.Z)(this,"needRescale",!1),(0,D.Z)(this,"needRemapping",!1),(0,D.Z)(this,"needRegenerateVertices",!1),(0,D.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,D.Z)(this,"vertexAttribute",void 0),(0,D.Z)(this,"defaultCallback",r=>{if(r.length===0){var i;return((i=this.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return r.map((a,u)=>{var f;return((f=this.scale)===null||f===void 0?void 0:f.scalers[u].func)(a)})}),this.setProps(t)}setProps(t){Object.assign(this,t)}mapping(t){var r;if((r=this.scale)!==null&&r!==void 0&&r.callback){var i;const a=(i=this.scale)===null||i===void 0?void 0:i.callback(...t);if(!nt(a))return[a]}return this.defaultCallback(t)}resetDescriptor(){this.descriptor&&(this.descriptor.buffer.data=[])}}const Pt=["buffer","update","name"],Ut=["buffer","update","name"],er={[O.FLOAT]:4,[O.UNSIGNED_BYTE]:1,[O.UNSIGNED_SHORT]:2};class Ar{constructor(t){(0,D.Z)(this,"attributesAndIndices",void 0),(0,D.Z)(this,"attributes",[]),(0,D.Z)(this,"triangulation",void 0),(0,D.Z)(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}registerStyleAttribute(t){let r=this.getLayerStyleAttribute(t.name||"");return r?r.setProps(t):(r=new ft(t),this.attributes.push(r)),r}unRegisterStyleAttribute(t){const r=this.attributes.findIndex(i=>i.name===t);r>-1&&this.attributes.splice(r,1)}updateScaleAttribute(t){this.attributes.forEach(r=>{var i;const a=r.name,u=(i=r.scale)===null||i===void 0?void 0:i.field;(t[a]||u&&t[u])&&(r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0)})}updateStyleAttribute(t,r,i){let a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute((0,_e.Z)((0,_e.Z)({},r),{},{name:t})));const{scale:u}=r;u&&a&&(a.scale=u,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}getLayerStyleAttributes(){return this.attributes}getLayerStyleAttribute(t){return this.attributes.find(r=>r.name===t)}getLayerAttributeScale(t){var r;const i=this.getLayerStyleAttribute(t),a=i==null||(r=i.scale)===null||r===void 0?void 0:r.scalers;return a&&a[0]?a[0].func:null}updateAttributeByFeatureRange(t,r,i=0,a,u){const f=this.attributes.find(m=>m.name===t);if(f&&f.descriptor){const{descriptor:m}=f,{update:_,buffer:b,size:A=0}=m,C=er[b.type||O.FLOAT];if(_){const{elements:R,sizePerElement:U}=this.featureLayout,X=R.slice(i,a);if(!X.length)return;const{offset:ee}=X[0],xe=ee*A*C,ke=X.map(({featureIdx:Ne,vertices:it,normals:gt},rr)=>{const Kt=it.length/U,Rt=[];for(let tr=0;tr<Kt;tr++){const Tn=gt?gt.slice(tr*3,tr*3+3):[];Rt.push(..._(r[Ne],Ne,it.slice(tr*U,tr*U+U),rr,Tn))}return Rt}).flat();f.vertexAttribute.updateBuffer({data:ke,offset:xe}),u==null||u.emit(`legend:${t}`,u.getLegend(t))}}}createAttributesAndIndices(t,r,i,a){this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);const u=this.attributes.map(ee=>(ee.resetDescriptor(),ee.descriptor));let f=0,m=0;const _=[];let b=3;t.forEach((ee,xe)=>{const{indices:ke,vertices:Ne,normals:it,size:gt,indexes:rr,count:Kt}=this.triangulation(ee,i);typeof Kt=="number"&&(m+=Kt),ke.forEach(tr=>{_.push(tr+f)}),b=gt;const Rt=Ne.length/gt;this.featureLayout.sizePerElement=b,this.featureLayout.elements.push({featureIdx:xe,vertices:Ne,normals:it,offset:f}),f+=Rt;for(let tr=0;tr<Rt;tr++){const Tn=(it==null?void 0:it.slice(tr*3,tr*3+3))||[],fi=Ne.slice(tr*gt,tr*gt+gt);let An=0;rr&&rr[tr]!==void 0&&(An=rr[tr]),u.forEach((ui,Xi)=>{ui&&ui.update&&ui.buffer.data.push(...ui.update(ee,xe,fi,tr,Tn,An))})}});const{createAttribute:A,createBuffer:C,createElements:R}=this.rendererService,U={};u.forEach((ee,xe)=>{if(ee){const{buffer:ke,update:Ne,name:it}=ee,gt=(0,Le.Z)(ee,Pt),rr=A((0,_e.Z)({buffer:C(ke)},gt));U[ee.name||""]=rr,this.attributes[xe].vertexAttribute=rr}});const X=R({data:_,type:O.UNSIGNED_INT,count:_.length});return this.attributesAndIndices={attributes:U,elements:X,count:m},Object.values(this.attributes).filter(ee=>ee.scale).forEach(ee=>{const xe=ee.name;a==null||a.emit(`legend:${xe}`,a.getLegend(xe))}),this.attributesAndIndices}createAttributes(t,r){this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);const i=this.attributes.map(A=>(A.resetDescriptor(),A.descriptor));let a=0;const u=[];let f=3;t.forEach((A,C)=>{const{indices:R,vertices:U,normals:X,size:ee,indexes:xe}=this.triangulation(A);R.forEach(Ne=>{u.push(Ne+a)}),f=ee;const ke=U.length/ee;this.featureLayout.sizePerElement=f,this.featureLayout.elements.push({featureIdx:C,vertices:U,normals:X,offset:a}),a+=ke;for(let Ne=0;Ne<ke;Ne++){const it=(X==null?void 0:X.slice(Ne*3,Ne*3+3))||[],gt=U.slice(Ne*ee,Ne*ee+ee);let rr=0;xe&&xe[Ne]!==void 0&&(rr=xe[Ne]),i.forEach((Kt,Rt)=>{Kt&&Kt.update&&Kt.buffer.data.push(...Kt.update(A,C,gt,Ne,it,rr))})}});const{createAttribute:m,createBuffer:_}=this.rendererService,b={};return i.forEach((A,C)=>{if(A){const{buffer:R,update:U,name:X}=A,ee=(0,Le.Z)(A,Ut),xe=m((0,_e.Z)({buffer:_(R)},ee));b[A.name||""]=xe,this.attributes[C].vertexAttribute=xe}}),{attributes:b}}clearAllAttributes(){var t;this.attributes.forEach(r=>{r.vertexAttribute&&r.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}var Nr=H(14224);function yn(e,t,r,i){function a(u){return u instanceof r?u:new r(function(f){f(u)})}return new(r||(r=Promise))(function(u,f){function m(A){try{b(i.next(A))}catch(C){f(C)}}function _(A){try{b(i.throw(A))}catch(C){f(C)}}function b(A){A.done?u(A.value):a(A.value).then(m,_)}b((i=i.apply(e,t||[])).next())})}function en(e,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,a,u,f;return f={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function m(b){return function(A){return _([b,A])}}function _(b){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,a&&(u=b[0]&2?a.return:b[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,b[1])).done)return u;switch(a=0,u&&(b=[b[0]&2,u.value]),b[0]){case 0:case 1:u=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,a=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!u||b[1]>u[0]&&b[1]<u[3])){r.label=b[1];break}if(b[0]===6&&r.label<u[1]){r.label=u[1],u=b;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(b);break}u[2]&&r.ops.pop(),r.trys.pop();continue}b=t.call(e,r)}catch(A){b=[6,A],a=0}finally{i=u=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function En(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),a,u=[],f;try{for(;(t===void 0||t-- >0)&&!(a=i.next()).done;)u.push(a.value)}catch(m){f={error:m}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(f)throw f.error}}return u}function tn(e,t,r){if(r||arguments.length===2)for(var i=0,a=t.length,u;i<a;i++)(u||!(i in t))&&(u||(u=Array.prototype.slice.call(t,0,i)),u[i]=t[i]);return e.concat(u||Array.prototype.slice.call(t))}function si(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kn={exports:{}},hn={exports:{}},hi={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1===0}e.exports=t.default})(hi,hi.exports);var Bn={},Ci={exports:{}},Sn={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];var u=i.pop();return r.call(this,i,u)}},e.exports=t.default})(Sn,Sn.exports);var bi={};Object.defineProperty(bi,"__esModule",{value:!0}),bi.fallback=So,bi.wrap=$o;var Po=bi.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,na=bi.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ko=bi.hasNextTick=typeof Nr=="object"&&typeof Nr.nextTick=="function";function So(e){setTimeout(e,0)}function $o(e){return function(t){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];return e(function(){return t.apply(void 0,r)})}}var ia;Po?ia=queueMicrotask:na?ia=setImmediate:Ko?ia=Nr.nextTick:ia=So,bi.default=$o(ia),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=_;var r=Sn.exports,i=m(r),a=bi,u=m(a),f=Bn;function m(C){return C&&C.__esModule?C:{default:C}}function _(C){return(0,f.isAsync)(C)?function(){for(var R=[],U=arguments.length;U--;)R[U]=arguments[U];var X=R.pop(),ee=C.apply(this,R);return b(ee,X)}:(0,i.default)(function(R,U){var X;try{X=C.apply(this,R)}catch(ee){return U(ee)}if(X&&typeof X.then=="function")return b(X,U);U(null,X)})}function b(C,R){return C.then(function(U){A(R,null,U)},function(U){A(R,U&&U.message?U:new Error(U))})}function A(C,R,U){try{C(R,U)}catch(X){(0,u.default)(function(ee){throw ee},X)}}e.exports=t.default}(Ci,Ci.exports),Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.isAsyncIterable=Bn.isAsyncGenerator=Bn.isAsync=void 0;var Ha=Ci.exports,Os=qa(Ha);function qa(e){return e&&e.__esModule?e:{default:e}}function ms(e){return e[Symbol.toStringTag]==="AsyncFunction"}function fa(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function Ka(e){return typeof e[Symbol.asyncIterator]=="function"}function Ei(e){if(typeof e!="function")throw new Error("expected a function");return ms(e)?(0,Os.default)(e):e}Bn.default=Ei,Bn.isAsync=ms,Bn.isAsyncGenerator=fa,Bn.isAsyncIterable=Ka;var ji={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(i,a){if(a===void 0&&(a=i.length),!a)throw new Error("arity is undefined");function u(){for(var f=this,m=[],_=arguments.length;_--;)m[_]=arguments[_];return typeof m[a-1]=="function"?i.apply(this,m):new Promise(function(b,A){m[a-1]=function(C){for(var R=[],U=arguments.length-1;U-- >0;)R[U]=arguments[U+1];if(C)return A(C);b(R.length>1?R:R[0])},i.apply(f,m)})}return u}e.exports=t.default})(ji,ji.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=hi.exports,i=_(r),a=Bn,u=_(a),f=ji.exports,m=_(f);function _(b){return b&&b.__esModule?b:{default:b}}t.default=(0,m.default)(function(b,A,C){var R=(0,i.default)(A)?[]:{};b(A,function(U,X,ee){(0,u.default)(U)(function(xe){for(var ke,Ne=[],it=arguments.length-1;it-- >0;)Ne[it]=arguments[it+1];Ne.length<2&&(ke=Ne,Ne=ke[0]),R[X]=Ne,ee(xe)})},function(U){return C(U,R)})},3),e.exports=t.default}(hn,hn.exports);var qi={exports:{}},Ri={exports:{}},vs={exports:{}},Ma={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(i){function a(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];if(i!==null){var m=i;i=null,m.apply(this,u)}}return Object.assign(a,i),a}e.exports=t.default})(Ma,Ma.exports);var vo={exports:{}},oa={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=t.default})(oa,oa.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=A;var r=hi.exports,i=f(r),a=oa.exports,u=f(a);function f(C){return C&&C.__esModule?C:{default:C}}function m(C){var R=-1,U=C.length;return function(){return++R<U?{value:C[R],key:R}:null}}function _(C){var R=-1;return function(){var X=C.next();return X.done?null:(R++,{value:X.value,key:R})}}function b(C){var R=C?Object.keys(C):[],U=-1,X=R.length;return function ee(){var xe=R[++U];return xe==="__proto__"?ee():U<X?{value:C[xe],key:xe}:null}}function A(C){if((0,i.default)(C))return m(C);var R=(0,u.default)(C);return R?_(R):b(C)}e.exports=t.default}(vo,vo.exports);var Oa={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(i){return function(){for(var a=[],u=arguments.length;u--;)a[u]=arguments[u];if(i===null)throw new Error("Callback was already called.");var f=i;i=null,f.apply(this,a)}}e.exports=t.default})(Oa,Oa.exports);var Ui={exports:{}},Iu={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={};t.default=r,e.exports=t.default})(Iu,Iu.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=Iu.exports,i=a(r);function a(f){return f&&f.__esModule?f:{default:f}}function u(f,m,_,b){var A=!1,C=!1,R=!1,U=0,X=0;function ee(){U>=m||R||A||(R=!0,f.next().then(function(Ne){var it=Ne.value,gt=Ne.done;if(!(C||A)){if(R=!1,gt){A=!0,U<=0&&b(null);return}U++,_(it,X,xe),X++,ee()}}).catch(ke))}function xe(Ne,it){if(U-=1,!C){if(Ne)return ke(Ne);if(Ne===!1){A=!0,C=!0;return}if(it===i.default||A&&U<=0)return A=!0,b(null);ee()}}function ke(Ne){C||(R=!1,A=!0,b(Ne))}ee()}e.exports=t.default}(Ui,Ui.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Ma.exports,i=U(r),a=vo.exports,u=U(a),f=Oa.exports,m=U(f),_=Bn,b=Ui.exports,A=U(b),C=Iu.exports,R=U(C);function U(X){return X&&X.__esModule?X:{default:X}}t.default=function(X){return function(ee,xe,ke){if(ke=(0,i.default)(ke),X<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!ee)return ke(null);if((0,_.isAsyncGenerator)(ee))return(0,A.default)(ee,X,xe,ke);if((0,_.isAsyncIterable)(ee))return(0,A.default)(ee[Symbol.asyncIterator](),X,xe,ke);var Ne=(0,u.default)(ee),it=!1,gt=!1,rr=0,Kt=!1;function Rt(Tn,fi){if(!gt)if(rr-=1,Tn)it=!0,ke(Tn);else if(Tn===!1)it=!0,gt=!0;else{if(fi===R.default||it&&rr<=0)return it=!0,ke(null);Kt||tr()}}function tr(){for(Kt=!0;rr<X&&!it;){var Tn=Ne();if(Tn===null){it=!0,rr<=0&&ke(null);return}rr+=1,xe(Tn.value,Tn.key,(0,m.default)(Rt))}Kt=!1}tr()}},e.exports=t.default}(vs,vs.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=vs.exports,i=_(r),a=Bn,u=_(a),f=ji.exports,m=_(f);function _(A){return A&&A.__esModule?A:{default:A}}function b(A,C,R,U){return(0,i.default)(C)(A,(0,u.default)(R),U)}t.default=(0,m.default)(b,4),e.exports=t.default}(Ri,Ri.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Ri.exports,i=f(r),a=ji.exports,u=f(a);function f(_){return _&&_.__esModule?_:{default:_}}function m(_,b,A){return(0,i.default)(_,1,b,A)}t.default=(0,u.default)(m,3),e.exports=t.default}(qi,qi.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=m;var r=hn.exports,i=f(r),a=qi.exports,u=f(a);function f(_){return _&&_.__esModule?_:{default:_}}function m(_,b){return(0,i.default)(u.default,_,b)}e.exports=t.default}(kn,kn.exports);var js=si(kn.exports),gs=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var t=arguments,r=[],i=0;i<arguments.length;i++)r[i]=t[i];return this.args=r,js(this.tasks)},e.prototype.tap=function(t,r){var i=this;this.tasks.push(function(a){r.apply(void 0,tn([],En(i.args),!1)),a(null,t)})},e}(),Qo={exports:{}},vl={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=hi.exports,i=xe(r),a=Iu.exports,u=xe(a),f=Ri.exports,m=xe(f),_=Ma.exports,b=xe(_),A=Oa.exports,C=xe(A),R=Bn,U=xe(R),X=ji.exports,ee=xe(X);function xe(gt){return gt&&gt.__esModule?gt:{default:gt}}function ke(gt,rr,Kt){Kt=(0,b.default)(Kt);var Rt=0,tr=0,Tn=gt.length,fi=!1;Tn===0&&Kt(null);function An(ui,Xi){ui===!1&&(fi=!0),fi!==!0&&(ui?Kt(ui):(++tr===Tn||Xi===u.default)&&Kt(null))}for(;Rt<Tn;Rt++)rr(gt[Rt],Rt,(0,C.default)(An))}function Ne(gt,rr,Kt){return(0,m.default)(gt,1/0,rr,Kt)}function it(gt,rr,Kt){var Rt=(0,i.default)(gt)?ke:Ne;return Rt(gt,(0,U.default)(rr),Kt)}t.default=(0,ee.default)(it,3),e.exports=t.default})(vl,vl.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=m;var r=vl.exports,i=f(r),a=hn.exports,u=f(a);function f(_){return _&&_.__esModule?_:{default:_}}function m(_,b){return(0,u.default)(i.default,_,b)}e.exports=t.default}(Qo,Qo.exports);var gl=si(Qo.exports),bp=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return gl(this.tasks)},e.prototype.tapPromise=function(t,r){var i=this;this.tasks.push(function(a){return yn(i,void 0,void 0,function(){return en(this,function(u){switch(u.label){case 0:return[4,r()];case 1:return u.sent(),a(null,t),[2]}})})})},e}(),Yc={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=Ma.exports,i=A(r),a=Oa.exports,u=A(a),f=Bn,m=A(f),_=ji.exports,b=A(_);function A(R){return R&&R.__esModule?R:{default:R}}function C(R,U){if(U=(0,i.default)(U),!Array.isArray(R))return U(new Error("First argument to waterfall must be an array of functions"));if(!R.length)return U();var X=0;function ee(ke){var Ne=(0,m.default)(R[X++]);Ne.apply(void 0,ke.concat([(0,u.default)(xe)]))}function xe(ke){for(var Ne=[],it=arguments.length-1;it-- >0;)Ne[it]=arguments[it+1];if(ke!==!1){if(ke||X===R.length)return U.apply(void 0,[ke].concat(Ne));ee(Ne)}}ee([])}t.default=(0,b.default)(C),e.exports=t.default})(Yc,Yc.exports);var qh=si(Yc.exports),Eh=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return qh(this.tasks)},e.prototype.tap=function(t,r){this.tasks.length===0?this.tasks.push(function(i){var a=r();i(a?null:!1,a)}):this.tasks.push(function(i,a){var u=r.apply(void 0,tn([],En(i),!1));a(u?null:!1,t)})},e}(),Kh=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return js(this.tasks)},e.prototype.tap=function(t,r){this.tasks.push(function(i){var a=r();i(a,t)})},e}(),hd=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],i=0;i<arguments.length;i++)r[i]=t[i];return this.args=r,js(this.tasks)},e.prototype.tapPromise=function(t,r){var i=this;this.tasks.push(function(a){return yn(i,void 0,void 0,function(){return en(this,function(u){switch(u.label){case 0:return[4,r.apply(void 0,tn([],En(this.args),!1))];case 1:return u.sent(),a(null,t),[2]}})})})},e}(),Bf=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],i=0;i<arguments.length;i++)r[i]=t[i];return this.args=r,js(this.tasks)},e.prototype.tapPromise=function(t,r){var i=this;this.tasks.push(function(a){return yn(i,void 0,void 0,function(){var u;return en(this,function(f){switch(f.label){case 0:return[4,r.apply(void 0,tn([],En(this.args),!1))];case 1:return u=f.sent(),a(u,t),[2]}})})})},e}(),Ep=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return qh(this.tasks)},e.prototype.tapPromise=function(t,r){this.tasks.length===0?this.tasks.push(function(i){r().then(function(a){i(null,a)})}):this.tasks.push(function(i,a){r(i).then(function(u){a(null,u)})})},e}(),fd=H(28766),pd=H.n(fd);class qc extends wa.EventEmitter{get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get controlService(){return this.container.controlService}get configService(){return this.container.globalConfigService}get map(){return this.container.mapService}get coordinateSystemService(){return this.container.coordinateSystemService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get cameraService(){return this.container.cameraService}get interactionService(){return this.container.interactionService}get pickingService(){return this.container.pickingService}get shaderModuleService(){return this.container.shaderModuleService}get markerService(){return this.container.markerService}get popupService(){return this.container.popupService}constructor(t){super(),(0,D.Z)(this,"destroyed",!1),(0,D.Z)(this,"loaded",!1),(0,D.Z)(this,"id",void 0),(0,D.Z)(this,"inited",!1),(0,D.Z)(this,"rendering",!1),(0,D.Z)(this,"$container",void 0),(0,D.Z)(this,"canvas",void 0),(0,D.Z)(this,"markerContainer",void 0),(0,D.Z)(this,"resizeDetector",void 0),(0,D.Z)(this,"hooks",void 0),(0,D.Z)(this,"handleWindowResized",()=>{this.emit("resize"),this.$container&&(this.initContainer(),this.coordinateSystemService.needRefresh=!0,this.render())}),(0,D.Z)(this,"handleMapCameraChanged",r=>{this.cameraService.update(r),this.render()}),this.container=t,this.hooks={init:new hd},this.id=t.id}init(t){var r=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",()=>this.render()),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Xt.Z)(function*(){r.debugService.log("map.mapInitStart",{type:r.map.version}),yield new Promise(i=>{r.map.onCameraChanged(a=>{r.cameraService.init(),r.cameraService.update(a),i()}),r.map.init()}),r.map.onCameraChanged(r.handleMapCameraChanged),r.map.addMarkerContainer(),r.markerService.addMarkers(),r.markerService.addMarkerLayers(),r.popupService.initPopup(),r.interactionService.init(),r.interactionService.on(He.Drag,r.addSceneEvent.bind(r))})),this.hooks.init.tapPromise("initRenderer",(0,Xt.Z)(function*(){var i;const a=((i=r.map)===null||i===void 0?void 0:i.getOverlayContainer())||void 0;if(a?r.$container=a:r.$container=k(r.configService.getSceneConfig(r.id).id||""),r.$container){const{canvas:f}=t;if(r.canvas=f||Mi("canvas","",r.$container),r.setCanvas(),yield r.rendererService.init(r.canvas,r.configService.getSceneConfig(r.id),t.gl),r.registerContextLost(),r.initContainer(),r.resizeDetector=pd()({strategy:"scroll"}),r.resizeDetector.listenTo(r.$container,r.handleWindowResized),window.matchMedia){var u;(u=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||u===void 0||u.addListener(r.handleWindowResized.bind("screen"))}}else console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");r.pickingService.init(r.id)})),this.render()}registerContextLost(){const t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",()=>this.emit("webglcontextlost"))}addLayer(t){this.layerService.sceneService=this,this.layerService.add(t)}addMask(t){this.layerService.sceneService=this,this.layerService.addMask(t)}render(){var t=this;return(0,Xt.Z)(function*(){t.rendering||t.destroyed||(t.rendering=!0,t.inited?(yield t.layerService.initLayers(),yield t.layerService.renderLayers()):(yield t.hooks.init.promise(),t.destroyed&&t.destroy(),yield t.layerService.initLayers(),t.layerService.renderLayers(),t.controlService.addControls(),t.loaded=!0,t.emit("loaded"),t.inited=!0),t.rendering=!1)})()}addFontFace(t,r){this.fontService.addFontFace(t,r)}getSceneContainer(){return this.$container}exportPng(t){var r=this;return(0,Xt.Z)(function*(){var i;const a=(i=r.$container)===null||i===void 0?void 0:i.getElementsByTagName("canvas")[0];return yield r.render(),t==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png")})()}getSceneConfig(){return this.configService.getSceneConfig(this.id)}getPointSizeRange(){return this.rendererService.getPointSizeRange()}addMarkerContainer(){const t=this.$container.parentElement;t!==null&&(this.markerContainer=Mi("div","l7-marker-container",t))}getMarkerContainer(){return this.markerContainer}destroy(){var t;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(()=>{var r;(r=this.$container)===null||r===void 0||r.removeChild(this.canvas),this.canvas=null,this.rendererService.destroy()}),(t=this.$container)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$container),this.emit("destroy")}initContainer(){var t,r;const i=Xo,a=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,u=((r=this.$container)===null||r===void 0?void 0:r.clientHeight)||300,f=this.canvas;f&&(f.width=a*i,f.height=u*i),this.rendererService.viewport({x:0,y:0,width:i*a,height:i*u})}setCanvas(){var t,r;const i=Xo,a=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,u=((r=this.$container)===null||r===void 0?void 0:r.clientHeight)||300,f=this.canvas;f.width=a*i,f.height=u*i,f.style.width="100%",f.style.height="100%"}addSceneEvent(t){this.emit(t.type,t)}}const{uniq:Tp}=Kn,$h="#define PI 3.14159265359",Th=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Ff=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,dd=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,md=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float activeType = v_PickingResult.a;
  if(activeType > 0.0) {
    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;
    highLightColor = highLightColor * COLOR_SCALE;
    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));
    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  }
  else {
    return color;
  }

  
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,Ap=`layout(location = ATTRIBUTE_LOCATION_PICKING_COLOR) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  if(u_PickingStage == PICKING_HIGHLIGHT) {
    if(isVertexPicked(pickingColor)) {
       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);
       return;
    }
    if(isVertexSelected(pickingColor)) {
     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);
      return;
    }

  } else {
      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);
      return;
  }

  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));

  // // Stores the picking color so that the fragment shader can render it during picking
  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Nf=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_activeMix;
};`,vd=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Uf=`#define TILE_SIZE (512.0)
#define PI (3.1415926536)
#define WORLD_SCALE (TILE_SIZE / (PI * 2.0))
#define EARTH_CIRCUMFERENCE (40.03e6)

#define COORDINATE_SYSTEM_LNGLAT (1.0) // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET (2.0) // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE (3.0)
#define COORDINATE_SYSTEM_IDENTITY (4.0)
#define COORDINATE_SYSTEM_METER_OFFSET (5.0)

#pragma include "scene_uniforms"

const vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)));
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}

// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1.0, 1.0);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
      u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01 ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}

vec4 project_position(vec4 position, vec2 position64xyLow) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(
      vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w)
    );
  }
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
    u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01
  ) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  return position;
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_XY_LOW);
}

vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance;
  }

  return pixel * 2.0 * u_FocalDistance;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, 19.0 - u_Zoom) * u_FocalDistance;
  }

  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
    return meter;
  } else {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;

}

float project_pixel(float pixel) {
  return pixel * u_FocalDistance;
}

vec2 project_pixel(vec2 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec3 project_pixel(vec3 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}

bool isEqual(float a, float b) {
  return a < b + 0.001 && a > b - 0.001;
}

`,Sp=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,kf=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};
`,gd=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Qh=/precision\s+(high|low|medium)p\s+float/,wp=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,zf=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,Cp=/void\s+main\s*\([^)]*\)\s*\{\n?/;class Jh{constructor(){(0,D.Z)(this,"moduleCache",{}),(0,D.Z)(this,"rawContentCache",{})}registerBuiltinModules(){this.destroy(),this.registerModule("common",{vs:$h,fs:$h}),this.registerModule("decode",{vs:Ff,fs:""}),this.registerModule("scene_uniforms",{vs:kf,fs:kf}),this.registerModule("picking_uniforms",{vs:Nf,fs:Nf}),this.registerModule("projection",{vs:Uf,fs:Uf}),this.registerModule("project",{vs:vd,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:gd}),this.registerModule("lighting",{vs:dd,fs:""}),this.registerModule("light",{vs:Th,fs:""}),this.registerModule("picking",{vs:Ap,fs:md}),this.registerModule("rotation_2d",{vs:Sp,fs:""})}registerModule(t,r){r.vs=r.vs.replace(/\r\n/g,`
`),r.fs=r.fs.replace(/\r\n/g,`
`);const{vs:i,fs:a,uniforms:u,defines:f,inject:m}=r,{content:_,uniforms:b}=oo(i),{content:A,uniforms:C}=oo(a);this.rawContentCache[t]={fs:A,defines:f,inject:m,uniforms:(0,_e.Z)((0,_e.Z)((0,_e.Z)({},b),C),u),vs:_}}getModule(t){let r=this.rawContentCache[t].vs,i=this.rawContentCache[t].fs;const{defines:a={},inject:u={}}=this.rawContentCache[t];let f={};u["vs:#decl"]&&(r=u["vs:#decl"]+r,f=oo(u["vs:#decl"]).uniforms),u["vs:#main-start"]&&(r=r.replace(Cp,ee=>ee+u["vs:#main-start"])),u["fs:#decl"]&&(i=u["fs:#decl"]+i),r=Rp(a)+r;const{content:_,includeList:b}=this.processModule(r,[],"vs"),{content:A,includeList:C}=this.processModule(i,[],"fs"),R=Tp(b.concat(C).concat(t)).reduce((ee,xe)=>(0,_e.Z)((0,_e.Z)({},ee),this.rawContentCache[xe].uniforms),(0,_e.Z)({},f)),U=(Qh.test(A)?"":wp)+_,X=(Qh.test(A)?"":wp)+A;return this.moduleCache[t]={vs:U.trim(),fs:X.trim(),uniforms:R},this.moduleCache[t]}destroy(){this.moduleCache={},this.rawContentCache={}}processModule(t,r,i){return{content:t.replace(zf,(u,f)=>{const _=f.split(" ")[0].replace(/"/g,"");if(r.indexOf(_)>-1)return"";const b=this.rawContentCache[_][i];r.push(_);const{content:A}=this.processModule(b,r,i);return A}),includeList:r}}}function Rp(e){return Object.keys(e).reduce((r,i)=>r+`#define ${i.toUpperCase()} ${e[i]}
`,`
`)}class Ah{constructor(){(0,D.Z)(this,"shaderModuleService",void 0),(0,D.Z)(this,"rendererService",void 0),(0,D.Z)(this,"cameraService",void 0),(0,D.Z)(this,"mapService",void 0),(0,D.Z)(this,"interactionService",void 0),(0,D.Z)(this,"layerService",void 0),(0,D.Z)(this,"config",void 0)}getName(){return""}getType(){return ni.Normal}init(t,r){this.config=r,this.rendererService=t.getContainer().rendererService,this.cameraService=t.getContainer().cameraService,this.mapService=t.getContainer().mapService,this.interactionService=t.getContainer().interactionService,this.layerService=t.getContainer().layerService,this.shaderModuleService=t.getContainer().shaderModuleService}render(t){}}class um extends Ah{getName(){return"clear"}init(t,r){super.init(t,r)}render(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}class Tv{constructor(t){(0,D.Z)(this,"passes",[]),(0,D.Z)(this,"layer",void 0),(0,D.Z)(this,"renderFlag",void 0),(0,D.Z)(this,"width",0),(0,D.Z)(this,"height",0),this.postProcessor=t}setLayer(t){this.layer=t}setRenderFlag(t){this.renderFlag=t}getRenderFlag(){return this.renderFlag}getPostProcessor(){return this.postProcessor}render(){var t=this;return(0,Xt.Z)(function*(){for(const r of t.passes)yield r.render(t.layer);yield t.postProcessor.render(t.layer)})()}resize(t,r){(this.width!==t||this.height!==r)&&(this.postProcessor.resize(t,r),this.width=t,this.height=r)}add(t,r){t.getType()===ni.PostProcessing?this.postProcessor.add(t,this.layer,r):(t.init(this.layer,r),this.passes.push(t))}insert(t,r,i){t.init(this.layer,r),this.passes.splice(i,0,t)}destroy(){this.passes.length=0}}class lm extends Ah{constructor(...t){var r;super(...t),r=this,(0,D.Z)(this,"pickingFBO",void 0),(0,D.Z)(this,"layer",void 0),(0,D.Z)(this,"width",0),(0,D.Z)(this,"height",0),(0,D.Z)(this,"alreadyInRendering",!1),(0,D.Z)(this,"pickFromPickingFBO",({x:i,y:a,lngLat:u,type:f})=>{if(!this.layer.isVisible()||!this.layer.needPick(f))return;const{getViewportSize:m,readPixelsAsync:_,useFramebuffer:b}=this.rendererService,{width:A,height:C}=m(),{enableHighlight:R,enableSelect:U}=this.layer.getLayerConfig(),X=i*Xo,ee=a*Xo;if(X>A||X<0||ee>C||ee<0)return;let xe;b(this.pickingFBO,(0,Xt.Z)(function*(){var ke;if(xe=yield _({x:Math.round(X),y:Math.round(C-(a+1)*Xo),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO}),xe[0]!==0||xe[1]!==0||xe[2]!==0){const Ne=Es(xe),it=r.layer.getSource().getFeatureById(Ne),gt={x:i,y:a,type:f,lngLat:u,featureId:Ne,feature:it};it&&(r.layer.setCurrentPickId(Ne),r.triggerHoverOnLayer(gt))}else{const Ne={x:i,y:a,lngLat:u,type:r.layer.getCurrentPickId()===null?"un"+f:"mouseout",featureId:null,feature:null};r.triggerHoverOnLayer((0,_e.Z)((0,_e.Z)({},Ne),{},{type:"unpick"})),r.triggerHoverOnLayer(Ne),r.layer.setCurrentPickId(null)}R&&r.highlightPickedFeature(xe),U&&f==="click"&&((ke=xe)===null||ke===void 0?void 0:ke.toString())!==[0,0,0,0].toString()&&r.selectFeature(xe)}))})}getType(){return ni.Normal}getName(){return"pixelPicking"}init(t,r){super.init(t,r),this.layer=t;const{createTexture2D:i,createFramebuffer:a,getViewportSize:u}=this.rendererService,{width:f,height:m}=u(),_=i({width:f,height:m,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=a({color:_}),this.interactionService.on(He.Hover,this.pickFromPickingFBO),this.interactionService.on(He.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(He.Active,this.highlightFeatureHandle.bind(this))}render(t){if(this.alreadyInRendering)return;const{getViewportSize:r,useFramebuffer:i,clear:a}=this.rendererService,{width:u,height:f}=r();this.alreadyInRendering=!0,(this.width!==u||this.height!==f)&&(this.pickingFBO.resize({width:u,height:f}),this.width=u,this.height=f),i(this.pickingFBO,()=>{a({framebuffer:this.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});const m=this.layer.multiPassRenderer.getRenderFlag();this.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),this.layer.multiPassRenderer.setRenderFlag(m),this.alreadyInRendering=!1})}triggerHoverOnLayer(t){this.layer.emit(t.type,t)}highlightPickedFeature(t){const[r,i,a]=t;this.layer.hooks.beforeHighlight.call([r,i,a]),this.layerService.renderLayers()}selectFeature(t){const[r,i,a]=t;this.layer.hooks.beforeSelect.call([r,i,a]),this.layerService.renderLayers()}selectFeatureHandle({featureId:t}){const r=Ns(t);this.selectFeature(new Uint8Array(r))}highlightFeatureHandle({featureId:t}){const r=Ns(t);this.highlightPickedFeature(new Uint8Array(r))}}class Av{constructor(t){(0,D.Z)(this,"passes",[]),(0,D.Z)(this,"readFBO",void 0),(0,D.Z)(this,"writeFBO",void 0),this.rendererService=t,this.init()}getReadFBO(){return this.readFBO}getWriteFBO(){return this.writeFBO}getCurrentFBOTex(){const{getViewportSize:t,createTexture2D:r}=this.rendererService,{width:i,height:a}=t();return r({x:0,y:0,width:i,height:a,copy:!0})}getReadFBOTex(){var t=this;const{useFramebuffer:r}=this.rendererService;return new Promise(i=>{r(this.readFBO,(0,Xt.Z)(function*(){i(t.getCurrentFBOTex())}))})}renderBloomPass(t,r){var i=this;return(0,Xt.Z)(function*(){const a=yield i.getReadFBOTex();let u=0;for(;u<4;)yield r.render(t,a),i.swap(),u++})()}render(t){var r=this;return(0,Xt.Z)(function*(){for(let i=0;i<r.passes.length;i++){const a=r.passes[i];a.setRenderToScreen(r.isLastEnabledPass(i)),a.getName()==="bloom"?yield r.renderBloomPass(t,a):(yield a.render(t),i!==r.passes.length-1&&r.swap())}})()}resize(t,r){this.readFBO.resize({width:t,height:r}),this.writeFBO.resize({width:t,height:r})}add(t,r,i){t.init(r,i),this.passes.push(t)}insert(t,r,i,a){t.init(i,a),this.passes.splice(r,0,t)}getPostProcessingPassByName(t){return this.passes.find(r=>r.getName()===t)}init(){const{createFramebuffer:t,createTexture2D:r}=this.rendererService;this.readFBO=t({color:r({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,usage:q.RENDER_TARGET})}),this.writeFBO=t({color:r({width:1,height:1,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,usage:q.RENDER_TARGET})})}isLastEnabledPass(t){for(let r=t+1;r<this.passes.length;r++)if(this.passes[r].isEnabled())return!1;return!0}swap(){const t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}class cm extends Ah{getType(){return ni.Normal}getName(){return"render"}init(t,r){super.init(t,r)}render(t){const{useFramebuffer:r,clear:i}=this.rendererService,a=t.multiPassRenderer.getPostProcessor().getReadFBO();r(a,()=>{i({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(u=>{u.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}const Gg=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Ip=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:Jo}=Kn;class zl extends fo{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:Ip,fs:Gg});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,_e.Z)((0,_e.Z)({},i),{},{u_ViewportSize:[a,u]})}}convertOptionsToUniforms(t){const r={};return Jo(t.bloomRadius)||(r.u_radius=t.bloomRadius),Jo(t.bloomIntensity)||(r.u_intensity=t.bloomIntensity),Jo(t.bloomBaseRadio)||(r.u_baseRadio=t.bloomBaseRadio),r}}const Yg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Sh=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:hm}=Kn;class Sv extends fo{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:Sh,fs:Yg});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,_e.Z)((0,_e.Z)({},i),{},{u_ViewportSize:[a,u]})}}convertOptionsToUniforms(t){const r={};return hm(t.blurRadius)||(r.u_BlurDir=[t.blurRadius,0]),r}}const _d=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,fc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:yd}=Kn;class Mp extends fo{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:fc,fs:_d});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,_e.Z)((0,_e.Z)({},i),{},{u_ViewportSize:[a,u]})}}convertOptionsToUniforms(t){const r={};return yd(t.blurRadius)||(r.u_BlurDir=[0,t.blurRadius]),r}}const xd=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,bd=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class fm extends fo{setupShaders(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:bd,fs:xd});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("colorhalftone-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,_e.Z)((0,_e.Z)({},i),{},{u_ViewportSize:[a,u]})}}}const wv=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Op=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class Cv extends fo{setupShaders(){return this.shaderModuleService.registerModule("copy-pass",{vs:Op,fs:wv}),this.shaderModuleService.getModule("copy-pass")}}const Rv=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Iv=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class Mv extends fo{setupShaders(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Iv,fs:Rv});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("hexagonalpixelate-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,_e.Z)((0,_e.Z)({},i),{},{u_ViewportSize:[a,u]})}}}const Ov=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Mu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class Ed extends fo{setupShaders(){this.shaderModuleService.registerModule("ink-pass",{vs:Mu,fs:Ov});const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("ink-pass"),{width:a,height:u}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:(0,_e.Z)((0,_e.Z)({},i),{},{u_ViewportSize:[a,u]})}}}const Pv=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,pc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class qg extends fo{setupShaders(){return this.shaderModuleService.registerModule("noise-pass",{vs:pc,fs:Pv}),this.shaderModuleService.getModule("noise-pass")}}const Lv=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ef=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`;class Vf extends fo{setupShaders(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Lv,fs:ef}),this.shaderModuleService.getModule("sepia-pass")}}const tf=new Wg;let Zf=0;function jf(){const e=new Jh,t=new g,r=new Ia,i=new p(r),a=new gv,u=new Yh,f=new ld,m=new cd,_=new Wc,b={id:`${Zf++}`,globalConfigService:tf,shaderModuleService:e,debugService:t,cameraService:r,coordinateSystemService:i,fontService:a,iconService:u,markerService:f,popupService:m,controlService:_,customRenderService:{}},A=new Ge(b);b.layerService=A;const C=new qc(b);b.sceneService=C;const R=new M(b);b.interactionService=R;const U=new te(b);b.pickingService=U;const X={clear:new um,pixelPicking:new lm,render:new cm};b.normalPassFactory=xe=>X[xe];const ee={copy:new Cv,bloom:new zl,blurH:new Sv,blurV:new Mp,noise:new qg,sepia:new Vf,colorHalftone:new fm,hexagonalPixelate:new Mv,ink:new Ed};return b.postProcessingPass=ee,b.postProcessingPassFactory=xe=>ee[xe],b}function Hf(e){const t=(0,_e.Z)({},e);return t.postProcessor=new Av(t.rendererService),t.multiPassRenderer=new Tv(t.postProcessor),t.styleAttributeService=new Ar(t.rendererService),t}const Pp=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];let Ps=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({});var pm=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),dm=(e,t,r,i)=>pm(void 0,null,function*(){return new Promise((a,u)=>{t({x:e.x,y:e.y,z:e.z},(f,m)=>{if(f||m.length===0){u(f);return}m&&Zr([{data:m,bands:[0]}],r,i,(_,b)=>{_?u(_):b&&a(b)})})})}),mm=(e,t)=>pm(void 0,null,function*(){return new Promise((r,i)=>{t({x:e.x,y:e.y,z:e.z},(a,u)=>{if(a||!u){i(a);return}u instanceof ArrayBuffer?mi(u,(f,m)=>{f&&i(f),r(m)}):u instanceof HTMLImageElement?r(u):i(a)})})});function Kc(e,t){return Array.isArray(e)?typeof e[0]=="string"?e.map(r=>mn(r,t)):e.map(r=>({url:mn(r.url,t),bands:r.bands||[0]})):mn(e,t)}function Dv(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(t=>({url:t,bands:[0]})):e}function Td(e,t){e.xhrCancel=()=>{t.map(r=>{r.abort()})}}var vm=Object.defineProperty,Bv=Object.defineProperties,gm=Object.getOwnPropertyDescriptors,_m=Object.getOwnPropertySymbols,Fv=Object.prototype.hasOwnProperty,ym=Object.prototype.propertyIsEnumerable,xm=(e,t,r)=>t in e?vm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Xf=(e,t)=>{for(var r in t||(t={}))Fv.call(t,r)&&xm(e,r,t[r]);if(_m)for(var r of _m(t))ym.call(t,r)&&xm(e,r,t[r]);return e},bm=(e,t)=>Bv(e,gm(t)),Lp=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),Kg=(e,t,r,i,a)=>Lp(void 0,null,function*(){const u=Dv(t.url);if(u.length>1){const{rasterFiles:f,xhrList:m,errList:_}=yield Nv(u,t);if(Td(e,m),_.length>0){r(_,null);return}Zr(f,i,a,r)}else{const f=qn(t,(m,_)=>{if(m)r(m);else if(_){const b=[{data:_,bands:u[0].bands}];Zr(b,i,a,r)}});Td(e,[f])}});function Nv(e,t){return Lp(this,null,function*(){const r=[],i=[],a=[];for(let u=0;u<e.length;u++){const f=e[u],m=bm(Xf({},t),{url:f.url}),_=f.bands,{err:b,data:A,xhr:C}=yield Rr(bm(Xf({},m),{type:"arrayBuffer"}));b&&a.push(b),i.push(C),r.push({data:A,bands:_})}return{rasterFiles:r,xhrList:i,errList:a}})}var $g=Object.defineProperty,Qg=Object.defineProperties,Jg=Object.getOwnPropertyDescriptors,Uv=Object.getOwnPropertySymbols,e_=Object.prototype.hasOwnProperty,t_=Object.prototype.propertyIsEnumerable,kv=(e,t,r)=>t in e?$g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ad=(e,t)=>{for(var r in t||(t={}))e_.call(t,r)&&kv(e,r,t[r]);if(Uv)for(var r of Uv(t))t_.call(t,r)&&kv(e,r,t[r]);return e},Vl=(e,t)=>Qg(e,Jg(t)),Dp=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),zv=(e,t,r,i)=>Dp(void 0,null,function*(){const{format:a=Em,operation:u,requestParameters:f={}}=i,m=Vl(Ad({},f),{url:Kc(e,t)});return new Promise((_,b)=>{Kg(r,m,(A,C)=>{A?b(A):C&&_(C)},a,u)})}),Wf=(e,t,r,i)=>Dp(void 0,null,function*(){let a;const u=Array.isArray(e)?e[0]:e;return i.wmtsOptions?a=((i==null?void 0:i.getURLFromTemplate)||Cn)(u,Ad(Ad({},t),i.wmtsOptions)):a=((i==null?void 0:i.getURLFromTemplate)||mn)(u,t),new Promise((f,m)=>{var _;const b=ro(Vl(Ad({},i==null?void 0:i.requestParameters),{url:a,type:((_=i==null?void 0:i.requestParameters)==null?void 0:_.type)||"arrayBuffer"}),(A,C)=>{A?m(A):C&&f(C)},i.transformResponse);r.xhrCancel=()=>b.cancel()})}),Em=()=>({rasterData:new Uint8Array([0]),width:1,height:1}),Zb=Object.defineProperty,jb=Object.defineProperties,Hb=Object.getOwnPropertyDescriptors,n0=Object.getOwnPropertySymbols,Xb=Object.prototype.hasOwnProperty,Wb=Object.prototype.propertyIsEnumerable,i0=(e,t,r)=>t in e?Zb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,o0=(e,t)=>{for(var r in t||(t={}))Xb.call(t,r)&&i0(e,r,t[r]);if(n0)for(var r of n0(t))Wb.call(t,r)&&i0(e,r,t[r]);return e},Gb=(e,t)=>jb(e,Hb(t)),Yb={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},c4=[Ps.ARRAYBUFFER,Ps.RGB];function qb(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function Kb(e,t={}){if(qb(e))throw new Error("tile server url is error");const{extent:r=[1/0,1/0,-1/0,-1/0],coordinates:i}=t;let a=(t==null?void 0:t.dataType)||Ps.IMAGE;a===Ps.RGB&&(a=Ps.ARRAYBUFFER);const u=(_,b)=>{switch(a){case Ps.IMAGE:return Wf(e,_,b,t);case Ps.CUSTOMIMAGE:case Ps.CUSTOMTERRAINRGB:return mm(b,t==null?void 0:t.getCustomData);case Ps.ARRAYBUFFER:return zv(e,_,b,t);case Ps.CUSTOMARRAYBUFFER:case Ps.CUSTOMRGB:return dm(b,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||Em,t==null?void 0:t.operation);default:return Wf(e,_,b,t)}},f=Gb(o0(o0({},Yb),t),{getTileData:u}),m=In(i,r);return{data:e,dataArray:[{_id:1,coordinates:m}],tilesetOptions:f,isTile:!0}}var $b=Object.defineProperty,Qb=Object.defineProperties,Jb=Object.getOwnPropertyDescriptors,Vv=Object.getOwnPropertySymbols,a0=Object.prototype.hasOwnProperty,s0=Object.prototype.propertyIsEnumerable,u0=(e,t,r)=>t in e?$b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,eE=(e,t)=>{for(var r in t||(t={}))a0.call(t,r)&&u0(e,r,t[r]);if(Vv)for(var r of Vv(t))s0.call(t,r)&&u0(e,r,t[r]);return e},tE=(e,t)=>Qb(e,Jb(t)),rE=(e,t)=>{var r={};for(var i in e)a0.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&Vv)for(var i of Vv(e))t.indexOf(i)<0&&s0.call(e,i)&&(r[i]=e[i]);return r};function nE(e,t){const r=t,{extent:i=[121.168,30.2828,121.384,30.4219],coordinates:a,width:u,height:f}=r,m=rE(r,["extent","coordinates","width","height"]);e.length<2&&console.warn("RGB\u89E3\u6790\u9700\u89812\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");const[_,b]=m.bands||[0,1],A=[e[_],e[b]],C=[];for(let X=0;X<A[0].length;X++)C.push((A[1][X]-A[0][X])/(A[1][X]+A[0][X]));const R=In(a,i);return{_id:1,dataArray:[tE(eE({_id:1,data:C,width:u,height:f},m),{coordinates:R})]}}var iE=Object.defineProperty,oE=Object.defineProperties,aE=Object.getOwnPropertyDescriptors,Zv=Object.getOwnPropertySymbols,l0=Object.prototype.hasOwnProperty,c0=Object.prototype.propertyIsEnumerable,h0=(e,t,r)=>t in e?iE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sE=(e,t)=>{for(var r in t||(t={}))l0.call(t,r)&&h0(e,r,t[r]);if(Zv)for(var r of Zv(t))c0.call(t,r)&&h0(e,r,t[r]);return e},uE=(e,t)=>oE(e,aE(t)),lE=(e,t)=>{var r={};for(var i in e)l0.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&Zv)for(var i of Zv(e))t.indexOf(i)<0&&c0.call(e,i)&&(r[i]=e[i]);return r};function cE(e,t){const r=t,{extent:i,coordinates:a,width:u,height:f}=r,m=lE(r,["extent","coordinates","width","height"]);e.length<3&&console.warn("RGB\u89E3\u6790\u9700\u8981\u4E09\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");const[_,b,A]=m.bands||[0,1,2],C=[e[_],e[b],e[A]],R=[],[U,X]=(m==null?void 0:m.countCut)||[2,98],ee=(m==null?void 0:m.RMinMax)||fr(C[0],U,X),xe=(m==null?void 0:m.GMinMax)||fr(C[1],U,X),ke=(m==null?void 0:m.BMinMax)||fr(C[2],U,X);for(let gt=0;gt<C[0].length;gt++)R.push(Math.max(0,C[0][gt]-ee[0])),R.push(Math.max(0,C[1][gt]-xe[0])),R.push(Math.max(0,C[2][gt]-ke[0]));const Ne=In(a,i);return{_id:1,dataArray:[uE(sE({_id:1,data:R,width:u,height:f,rMinMax:ee,gMinMax:xe,bMinMax:ke},m),{coordinates:Ne})]}}var hE=Object.defineProperty,fE=Object.defineProperties,pE=Object.getOwnPropertyDescriptors,jv=Object.getOwnPropertySymbols,f0=Object.prototype.hasOwnProperty,p0=Object.prototype.propertyIsEnumerable,d0=(e,t,r)=>t in e?hE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dE=(e,t)=>{for(var r in t||(t={}))f0.call(t,r)&&d0(e,r,t[r]);if(jv)for(var r of jv(t))p0.call(t,r)&&d0(e,r,t[r]);return e},mE=(e,t)=>fE(e,pE(t)),vE=(e,t)=>{var r={};for(var i in e)f0.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&jv)for(var i of jv(e))t.indexOf(i)<0&&p0.call(e,i)&&(r[i]=e[i]);return r};function gE(e,t){const r=t,{extent:i,coordinates:a,min:u,max:f,width:m,height:_,format:b,operation:A}=r,C=vE(r,["extent","coordinates","min","max","width","height","format","operation"]);let R;if(b===void 0||Fn(e))R=Array.from(e);else{const ee=Array.isArray(e)?e:[e];R=Vr(ee,b,A)}const U=In(a,i);return{_id:1,dataArray:[mE(dE({_id:1,data:R,width:m,height:_},C),{min:u,max:f,coordinates:U})]}}var _E=Object.defineProperty,yE=Object.defineProperties,xE=Object.getOwnPropertyDescriptors,m0=Object.getOwnPropertySymbols,bE=Object.prototype.hasOwnProperty,EE=Object.prototype.propertyIsEnumerable,v0=(e,t,r)=>t in e?_E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,g0=(e,t)=>{for(var r in t||(t={}))bE.call(t,r)&&v0(e,r,t[r]);if(m0)for(var r of m0(t))EE.call(t,r)&&v0(e,r,t[r]);return e},TE=(e,t)=>yE(e,xE(t)),AE=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),SE={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},wE=e=>AE(void 0,null,function*(){return new Promise(t=>{const[r,i,a,u]=e.bounds,f={layers:{testTile:{features:[{type:"Feature",properties:{key:e.x+"/"+e.y+"/"+e.z,x:(r+a)/2,y:(i+u)/2},geometry:{type:"LineString",coordinates:[[a,u],[a,i],[r,i],[r,i]]}}]}}};t(f)})});function CE(e,t){const r=a=>wE(a),i=TE(g0(g0({},SE),t),{getTileData:r});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var RE=H(48096),IE=H.n(RE),ME=Object.defineProperty,_0=Object.getOwnPropertySymbols,OE=Object.prototype.hasOwnProperty,PE=Object.prototype.propertyIsEnumerable,y0=(e,t,r)=>t in e?ME(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,x0=(e,t)=>{for(var r in t||(t={}))OE.call(t,r)&&y0(e,r,t[r]);if(_0)for(var r of _0(t))PE.call(t,r)&&y0(e,r,t[r]);return e};function b0(e,t){const{radius:r=40,maxZoom:i=18,minZoom:a=0,zoom:u=2}=t;if(e.pointIndex){const _=e.pointIndex.getClusters(e.extent,Math.floor(u));return e.dataArray=LE(_),e}const f=new(IE())({radius:r,minZoom:a,maxZoom:i}),m={type:"FeatureCollection",features:[]};return m.features=e.dataArray.map(_=>({type:"Feature",geometry:{type:"Point",coordinates:_.coordinates},properties:x0({},_)})),f.load(m.features),f}function LE(e){return e.map((t,r)=>x0({coordinates:t.geometry.coordinates,_id:r+1},t.properties))}function DE(e){if(e.length===0)throw new Error("max requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function BE(e){if(e.length===0)throw new Error("min requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function E0(e){if(e.length===0)return 0;let t=e[0],r=0,i;for(let a=1;a<e.length;a++)i=t+e[a]*1,Math.abs(t)>=Math.abs(e[a])?r+=t-i+e[a]:r+=e[a]-i+t,t=i;return t+r*1}function FE(e){if(e.length===0)throw new Error("mean requires at least one data point");return E0(e)/e.length}var NE={min:BE,max:DE,mean:FE,sum:E0},UE=Object.defineProperty,T0=Object.getOwnPropertySymbols,kE=Object.prototype.hasOwnProperty,zE=Object.prototype.propertyIsEnumerable,A0=(e,t,r)=>t in e?UE(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Tm=(e,t)=>{for(var r in t||(t={}))kE.call(t,r)&&A0(e,r,t[r]);if(T0)for(var r of T0(t))zE.call(t,r)&&A0(e,r,t[r]);return e},S0=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),{cloneDeep:VE,isFunction:w0,isString:ZE,mergeWith:jE}=Kn;function HE(e,t){if(Array.isArray(t))return t}var XE=class extends wa.EventEmitter{constructor(e,t){super(),this.type="source",this.isTile=!1,this.inited=!1,this.hooks={init:new gs},this.parser={type:"geojson"},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=e,this.initCfg(t),this.init().then(()=>{this.inited=!0,this.emit("update",{type:"inited"})})}getSourceCfg(){return this.cfg}getClusters(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}getClustersLeaves(e){return this.clusterIndex.getLeaves(e,1/0)}getParserType(){return this.parser.type}updateClusterData(e){const{method:t="sum",field:r}=this.clusterOptions;let i=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,i.forEach(a=>{a.id||(a.properties.point_count=1)}),(r||w0(t))&&(i=i.map(a=>{const u=a.id;if(u){const m=this.clusterIndex.getLeaves(u,1/0).map(b=>b.properties);let _;if(ZE(t)&&r){const b=Vn(m,r);_=NE[t](b)}w0(t)&&(_=t(m)),a.properties.stat=_}else a.properties.point_count=1;return a})),this.data=Je("geojson")({type:"FeatureCollection",features:i}),this.executeTrans()}getFeatureById(e){const{type:t="geojson",geometry:r}=this.parser;if(t==="geojson"&&!this.cluster){const i=e<this.originData.features.length?this.originData.features[e]:"null",a=VE(i);if(a!=null&&a.properties&&(this.transforms.length!==0||this.dataArrayChanged)){const u=this.data.dataArray.find(f=>f._id===e);a.properties=u}return a}else return t==="json"&&r?this.data.dataArray.find(i=>i._id===e):e<this.data.dataArray.length?this.data.dataArray[e]:"null"}updateFeaturePropertiesById(e,t){this.data.dataArray=this.data.dataArray.map(r=>r._id===e?Tm(Tm({},r),t):r),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}getFeatureId(e,t){const r=this.data.dataArray.find(i=>i[e]===t);return r==null?void 0:r._id}setData(e,t){this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then(()=>{this.emit("update",{type:"update"})})}reloadAllTile(){var e;(e=this.tileset)==null||e.reloadAll()}reloadTilebyId(e,t,r){var i;(i=this.tileset)==null||i.reloadTileById(e,t,r)}reloadTileByLnglat(e,t,r){var i;(i=this.tileset)==null||i.reloadTileByLnglat(e,t,r)}getTileExtent(e,t){var r;return(r=this.tileset)==null?void 0:r.getTileExtent(e,t)}getTileByZXY(e,t,r){var i;return(i=this.tileset)==null?void 0:i.getTileByZXY(e,t,r)}reloadTileByExtent(e,t){var r;(r=this.tileset)==null||r.reloadTileByExtent(e,t)}destroy(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(e=this.tileset)==null||e.destroy()}processData(){return S0(this,null,function*(){return new Promise((e,t)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),e({})}catch(r){t(r)}})})}initCfg(e){this.cfg=jE(this.cfg,e,HE);const t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=Tm(Tm({},this.clusterOptions),t.clusterOptions)))}init(){return S0(this,null,function*(){this.inited=!1,yield this.processData(),this.inited=!0})}excuteParser(){const e=this.parser,t=e.type||"geojson",r=Je(t);this.data=r(this.originData,e),this.tileset=this.initTileset(),!e.cancelExtent&&(this.extent=xf(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){const{tilesetOptions:e}=this.data;return e?(this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new Ir(Tm({},e))):void 0}executeTrans(){this.transforms.forEach(t=>{const{type:r}=t,i=yt(r)(this.data,t);Object.assign(this.data,i)})}initCluster(){if(!this.cluster)return;const e=this.clusterOptions||{};this.clusterIndex=b0(this.data,e)}caculClusterExtent(e){let t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=ec(qs(this.extent),e)),t[0].concat(t[1])}};function WE(e,t){const{callback:r}=t;return r&&(e.dataArray=e.dataArray.filter(r)),e}var r_=6378e3;function GE(e,t){const r=e.dataArray,{size:i=10}=t,a=i/(2*Math.PI*r_)*(256<<20)/2,{gridHash:u,gridOffset:f}=YE(r,i),m=QE(u,f,t);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:m}}function YE(e,t){let r=1/0,i=-1/0,a;for(const _ of e)a=_.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,i=a>i?a:i);const u=(r+i)/2,f=qE(t,u);if(f.xOffset<=0||f.yOffset<=0)return{gridHash:{},gridOffset:f};const m={};for(const _ of e){const b=_.coordinates[1],A=_.coordinates[0];if(Number.isFinite(b)&&Number.isFinite(A)){const C=Math.floor((b+90)/f.yOffset),R=Math.floor((A+180)/f.xOffset),U=`${C}-${R}`;m[U]=m[U]||{count:0,points:[]},m[U].count+=1,m[U].points.push(_)}}return{gridHash:m,gridOffset:f}}function qE(e,t){const r=KE(e),i=$E(t,e);return{yOffset:r,xOffset:i}}function KE(e){return e/r_*(180/Math.PI)}function $E(e,t){return t/r_*(180/Math.PI)/Math.cos(e*Math.PI/180)}function QE(e,t,r){return Object.keys(e).reduce((i,a,u)=>{const f=a.split("-"),m=parseInt(f[0],10),_=parseInt(f[1],10),b={};if(r.field&&r.method){const A=lu(e[a].points,r.field);b[r.method]=ll[r.method](A)}return Object.assign(b,{_id:u,coordinates:Hr([-180+t.xOffset*(_+.5),-90+t.yOffset*(m+.5)]),rawData:e[a].points,count:e[a].count}),i.push(b),i},[])}var Sd=Math.PI/3,JE=[0,Sd,2*Sd,3*Sd,4*Sd,5*Sd];function e2(e){return e[0]}function t2(e){return e[1]}function r2(){var e=0,t=0,r=1,i=1,a=e2,u=t2,f,m,_;function b(C){var R={},U=[],X,ee=C.length;for(X=0;X<ee;++X)if(!(isNaN(ke=+a.call(null,xe=C[X],X,C))||isNaN(Ne=+u.call(null,xe,X,C)))){var xe,ke,Ne,it=Math.round(Ne=Ne/_),gt=Math.round(ke=ke/m-(it&1)/2),rr=Ne-it;if(Math.abs(rr)*3>1){var Kt=ke-gt,Rt=gt+(ke<gt?-1:1)/2,tr=it+(Ne<it?-1:1),Tn=ke-Rt,fi=Ne-tr;Kt*Kt+rr*rr>Tn*Tn+fi*fi&&(gt=Rt+(it&1?1:-1)/2,it=tr)}var An=gt+"-"+it,ui=R[An];ui?ui.push(xe):(U.push(ui=R[An]=[xe]),ui.x=(gt+(it&1)/2)*m,ui.y=it*_)}return U}function A(C){var R=0,U=0;return JE.map(function(X){var ee=Math.sin(X)*C,xe=-Math.cos(X)*C,ke=ee-R,Ne=xe-U;return R=ee,U=xe,[ke,Ne]})}return b.hexagon=function(C){return"m"+A(C==null?f:+C).join("l")+"z"},b.centers=function(){for(var C=[],R=Math.round(t/_),U=Math.round(e/m),X=R*_;X<i+f;X+=_,++R)for(var ee=U*m+(R&1)*m/2;ee<r+m/2;ee+=m)C.push([ee,X]);return C},b.mesh=function(){var C=A(f).slice(0,4).join("l");return b.centers().map(function(R){return"M"+R+"m"+C}).join("")},b.x=function(C){return arguments.length?(a=C,b):a},b.y=function(C){return arguments.length?(u=C,b):u},b.radius=function(C){return arguments.length?(f=+C,m=f*2*Math.sin(Sd),_=f*1.5,b):f},b.size=function(C){return arguments.length?(e=t=0,r=+C[0],i=+C[1],b):[r-e,i-t]},b.extent=function(C){return arguments.length?(e=+C[0][0],t=+C[0][1],r=+C[1][0],i=+C[1][1],b):[[e,t],[r,i]]},b.radius(1)}var n2=Object.defineProperty,i2=Object.defineProperties,o2=Object.getOwnPropertyDescriptors,C0=Object.getOwnPropertySymbols,a2=Object.prototype.hasOwnProperty,s2=Object.prototype.propertyIsEnumerable,R0=(e,t,r)=>t in e?n2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u2=(e,t)=>{for(var r in t||(t={}))a2.call(t,r)&&R0(e,r,t[r]);if(C0)for(var r of C0(t))s2.call(t,r)&&R0(e,r,t[r]);return e},l2=(e,t)=>i2(e,o2(t)),c2=6378e3;function h2(e,t){const r=e.dataArray,{size:i=10,method:a="sum"}=t,u=i/(2*Math.PI*c2)*(256<<20)/2,f=r.map(A=>{const[C,R]=Hr(A.coordinates);return l2(u2({},A),{coordinates:[C,R]})});return{dataArray:r2().radius(u).x(A=>A.coordinates[0]).y(A=>A.coordinates[1])(f).map((A,C)=>{if(t.field&&a){const R=lu(A,t.field);A[a]=ll[a](R)}return{[t.method]:A[a],count:A.length,rawData:A,coordinates:[A.x,A.y],_id:C}}),radius:u,xOffset:u,yOffset:u,type:"hexagon"}}var f2=Object.defineProperty,I0=Object.getOwnPropertySymbols,p2=Object.prototype.hasOwnProperty,d2=Object.prototype.propertyIsEnumerable,M0=(e,t,r)=>t in e?f2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,O0=(e,t)=>{for(var r in t||(t={}))p2.call(t,r)&&M0(e,r,t[r]);if(I0)for(var r of I0(t))d2.call(t,r)&&M0(e,r,t[r]);return e};function m2(e,t){const{sourceField:r,targetField:i,data:a}=t,u={};return a.forEach(f=>{u[f[r]]=f}),e.dataArray=e.dataArray.map(f=>{const m=f[i];return O0(O0({},f),u[m])}),e}function v2(e,t){const{callback:r}=t;return r&&(e.dataArray=e.dataArray.map(r)),e}var h4=H(1602);Oe("rasterTile",Kb),Oe("mvt",Ct),Oe("geojsonvt",Bl),Oe("testTile",CE),Oe("geojson",ps),Oe("jsonTile",ns),Oe("image",fp),Oe("csv",ts),Oe("json",fu),Oe("raster",gr),Oe("rasterRgb",gE),Oe("rgb",cE),Oe("ndi",nE),Re("cluster",b0),Re("filter",WE),Re("join",m2),Re("map",v2),Re("grid",GE),Re("hexagon",h2);var g2=XE;class _2 extends wa.EventEmitter{getMarkerLayerContainerSize(){}constructor(t){super(),(0,D.Z)(this,"markerOption",void 0),(0,D.Z)(this,"popup",void 0),(0,D.Z)(this,"mapsService",void 0),(0,D.Z)(this,"lngLat",void 0),(0,D.Z)(this,"scene",void 0),(0,D.Z)(this,"added",!1),(0,D.Z)(this,"preLngLat",{lng:0,lat:0}),(0,D.Z)(this,"onMarkerDragStart",r=>{const i=this.mapsService.getContainer();if(!i)return;this.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});const{left:a,top:u}=i.getClientRects()[0],{x:f,y:m}=r;this.preLngLat=this.mapsService.containerToLngLat([f-a,m-u]),this.mapsService.on("mousemove",this.onMarkerDragMove),document.addEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragstart",this.lngLat)}),(0,D.Z)(this,"onMarkerDragMove",r=>{const i=r.lngLat||r.lnglat,{lng:a,lat:u}=this.preLngLat,{lng:f,lat:m}=i,_={lng:this.lngLat.lng+f-a,lat:this.lngLat.lat+m-u};this.setLnglat(_),this.preLngLat=i,this.emit("dragging",_)}),(0,D.Z)(this,"onMarkerDragEnd",()=>{this.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragend",this.lngLat)}),(0,D.Z)(this,"eventHandle",r=>{this.polyfillEvent(r),this.emit(r.type,{target:r,data:this.markerOption.extData,lngLat:this.lngLat})}),(0,D.Z)(this,"touchStartTime",void 0),this.markerOption=(0,_e.Z)((0,_e.Z)({},this.getDefault()),t),Au(["update","onMove","onMapClick","updatePositionWhenZoom"],this),this.init()}getDefault(){return{element:void 0,anchor:Jn.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1,overflowHide:!0}}addTo(t){this.scene=t,this.mapsService=t.mapService;const{element:r}=this.markerOption;return this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}remove(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();const{element:t}=this.markerOption;return t&&la(t),this.popup&&this.popup.remove(),this}setLnglat(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}getLnglat(){return this.lngLat}getElement(){return this.markerOption.element}setElement(t){if(!this.added)return this.once("added",()=>{this.setElement(t)}),this;const{element:r}=this.markerOption;return r&&la(r),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.updateDraggable(),this.update(),this}openPopup(){if(!this.added)return this.once("added",()=>{this.openPopup()}),this;const t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}closePopup(){this.added||this.once("added",()=>{this.closePopup()});const t=this.popup;return t&&t.remove(),this}setPopup(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}togglePopup(){const t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}getPopup(){return this.popup}getOffset(){return this.markerOption.offsets}setDraggable(t){this.markerOption.draggable=t,this.updateDraggable()}getDraggable(){return this.markerOption.draggable}getExtData(){return this.markerOption.extData}setExtData(t){this.markerOption.extData=t}update(){if(!this.mapsService)return;const{element:t,anchor:r}=this.markerOption;this.updatePosition(),sh(t,`${oi[r]}`)}updatePositionWhenZoom(t){if(!this.mapsService)return;const{element:r,offsets:i}=this.markerOption,{lng:a,lat:u}=this.lngLat;if(r){r.style.display="block",r.style.whiteSpace="nowrap";const{containerHeight:f,containerWidth:m,bounds:_}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!_)return;const b=t.map,A=t.center,C=t.zoom,R=b.DE(this.lngLat,C,A);if(R.x=Math.round(R.x+i[0]),R.y=Math.round(R.y-i[1]),Math.abs(_[0][0])>180||Math.abs(_[1][0])>180){if(R.x>m){const U=this.mapsService.lngLatToContainer([a-360,u]);R.x=U.x}if(R.x<0){const U=this.mapsService.lngLatToContainer([a+360,u]);R.x=U.x}}(R.x>m||R.x<0||R.y>f||R.y<0)&&(r.style.display="none"),r.style.left=R.x+"px",r.style.top=R.y+"px",r.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}onMapClick(t){const{element:r}=this.markerOption;this.popup&&r&&this.togglePopup()}getCurrentContainerSize(){const t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}updateDraggable(){const{element:t}=this.markerOption;t==null||t.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(t==null||t.addEventListener("mousedown",this.onMarkerDragStart))}updatePosition(){if(!this.mapsService)return;const{element:t,offsets:r}=this.markerOption,{lng:i,lat:a}=this.lngLat,u=this.mapsService.lngLatToContainer([i,a]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";const{containerHeight:f,containerWidth:m,bounds:_}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!_)return;if(Math.abs(_[0][0])>180||Math.abs(_[1][0])>180){if(u.x>m){const b=this.mapsService.lngLatToContainer([i-360,a]);u.x=b.x}if(u.x<0){const b=this.mapsService.lngLatToContainer([i+360,a]);u.x=b.x}}this.markerOption.overflowHide&&(u.x>m||u.x<0||u.y>f||u.y<0)&&(t.style.display="none"),t.style.left=u.x+r[0]+"px",t.style.top=u.y-r[1]+"px"}}init(){let{element:t}=this.markerOption;const{color:r,anchor:i}=this.markerOption;if(!t){t=Mi("div"),this.markerOption.element=t;const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","48px"),a.setAttributeNS(null,"width","48px"),a.setAttributeNS(null,"viewBox","0 0 1024 1024");const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),u.setAttributeNS(null,"fill",r),a.appendChild(u),t.appendChild(a)}Sa(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(a=>{var u,f;const m=((u=this.markerOption)===null||u===void 0?void 0:u.style)&&((f=this.markerOption)===null||f===void 0?void 0:f.style[a]);t&&(t.style[a]=m)}),bo(t,i,"marker")}registerMarkerEvent(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}unRegisterMarkerEvent(){const t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}polyfillEvent(t){!this.mapsService||this.mapsService.getType()!=="amap"||lh()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}addDragHandler(t){return null}onUp(t){throw new Error("Method not implemented.")}}const{merge:y2}=Kn;class f4 extends null{constructor(t){var r;super(),_defineProperty(this,"markers",[]),_defineProperty(this,"markerLayerOption",void 0),_defineProperty(this,"clusterIndex",void 0),_defineProperty(this,"points",[]),_defineProperty(this,"clusterMarkers",[]),_defineProperty(this,"mapsService",void 0),_defineProperty(this,"scene",void 0),_defineProperty(this,"zoom",void 0),_defineProperty(this,"bbox",void 0),_defineProperty(this,"inited",void 0),_defineProperty(this,"containerSize",void 0),this.markerLayerOption=y2(this.getDefault(),t),bindAll(["update"],this),this.zoom=((r=this.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99}getDefault(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}addTo(t){return this.scene=t,this.mapsService=t.mapService,this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}setContainerSize(){if(!this.mapsService)return;const t=this.mapsService.getContainer();this.containerSize={containerWidth:(t==null?void 0:t.scrollWidth)||0,containerHeight:(t==null?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}getContainerSize(){return this.containerSize}addMarker(t){const r=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),r&&(this.addPoint(t,this.markers.length),this.mapsService)){const i=this.mapsService.getZoom(),a=this.mapsService.getBounds();this.bbox=padBounds(a,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}removeMarker(t){this.markers.indexOf(t);const r=this.markers.indexOf(t);r>-1&&(this.markers.splice(r,1),this.markerLayerOption.cluster&&(this.removePoint(r),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}hide(){this.markers.map(t=>{t.getElement().style.opacity="0"}),this.clusterMarkers.map(t=>{t.getElement().style.opacity="0"})}show(){this.markers.map(t=>{t.getElement().style.opacity="1"}),this.clusterMarkers.map(t=>{t.getElement().style.opacity="1"})}getMarkers(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}getOriginMarkers(){return this.markers}addMarkers(){this.getMarkers().forEach(t=>{t.addTo(this.scene)})}clear(){this.markers.forEach(t=>{t.remove()}),this.clusterMarkers.forEach(t=>{t.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}destroy(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}addPoint(t,r){const{lng:i,lat:a}=t.getLnglat(),u={geometry:{type:"Point",coordinates:[i,a]},properties:_objectSpread(_objectSpread({},t.getExtData()),{},{marker_id:r})};this.points.push(u),this.clusterIndex&&this.clusterIndex.load(this.points)}removePoint(t){const r=this.points.findIndex(i=>i.properties.marker_id===t);r>-1&&this.points.splice(r,1),this.clusterIndex&&this.clusterIndex.load(this.points)}initCluster(){if(!this.markerLayerOption.cluster)return;const{radius:t,minZoom:r=0,maxZoom:i}=this.markerLayerOption.clusterOption;this.clusterIndex=new Supercluster({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}getClusterMarker(t,r){const i=t[0].concat(t[1]),a=this.clusterIndex.getClusters(i,r);this.clusterMarkers.forEach(u=>{u.remove()}),this.clusterMarkers=[],a.forEach(u=>{var f;const{field:m,method:_}=this.markerLayerOption.clusterOption;if((f=u.properties)!==null&&f!==void 0&&f.cluster_id){var b;const C=this.getLeaves((b=u.properties)===null||b===void 0?void 0:b.cluster_id);if(u.properties.clusterData=C,m&&_){const R=C==null?void 0:C.map(xe=>({[m]:xe.properties[m]})),U=Satistics.getColumn(R,m),X=Satistics.getSatByColumn(_,U),ee="point_"+_;u.properties[ee]=X.toFixed(2)}}const A=this.clusterMarker(u);this.clusterMarkers.push(A),A.addTo(this.scene)})}getLeaves(t,r=1/0,i=0){return t?this.clusterIndex.getLeaves(t,r,i):null}clusterMarker(t){const r=this.markerLayerOption.clusterOption,{element:i=this.generateElement.bind(this)}=r;return new Marker({element:i(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]})}normalMarker(t){const r=t.properties.marker_id;return this.markers[r]}update(){if(!this.mapsService||this.markers.length===0)return;const t=this.mapsService.getZoom(),r=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!boundsContains(this.bbox,r))&&(this.bbox=padBounds(r,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}generateElement(t){const r=DOM.create("div","l7-marker-cluster"),i=DOM.create("div","",r),a=DOM.create("span","",i),{field:u,method:f}=this.markerLayerOption.clusterOption;t.properties.point_count=t.properties.point_count||1;const m=u&&f?t.properties["point_"+f]||t.properties[u]:t.properties.point_count;return a.textContent=m,r}}var p4=H(43159);class rf extends oc(){constructor(t){super(),(0,D.Z)(this,"controlOption",void 0),(0,D.Z)(this,"container",void 0),(0,D.Z)(this,"isShow",void 0),(0,D.Z)(this,"sceneContainer",void 0),(0,D.Z)(this,"scene",void 0),(0,D.Z)(this,"mapsService",void 0),(0,D.Z)(this,"renderService",void 0),(0,D.Z)(this,"layerService",void 0),(0,D.Z)(this,"controlService",void 0),(0,D.Z)(this,"configService",void 0),rf.controlCount++,this.controlOption=(0,_e.Z)((0,_e.Z)({},this.getDefault(t)),t||{})}getOptions(){return this.controlOption}setOptions(t){const r=this.getDefault(t);Object.entries(t).forEach(([i,a])=>{a===void 0&&(t[i]=r[i])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,_e.Z)((0,_e.Z)({},this.controlOption),t)}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),Sa(this.container,"l7-control");const{className:r,style:i}=this.controlOption;return r&&this.setClassName(r),i&&this.setStyle(i),this.insertContainer(),this.emit("add",this),this}remove(){if(!this.mapsService)return this;la(this.container),this.onRemove(),this.emit("remove",this)}onAdd(){return Mi("div")}onRemove(){}show(){const t=this.container;As(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}hide(){const t=this.container;Sa(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}getDefault(t){return{position:Qe.TOPRIGHT,name:`${rf.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){const r=this.mapsService.getContainer();r!==null&&r.focus()}}setPosition(t=Qe.TOPLEFT){const r=this.controlService;return r&&r.removeControl(this),this.controlOption.position=t,r&&r.addControl(this,this.sceneContainer),this}setClassName(t){const r=this.container,{className:i}=this.controlOption;i&&As(r,i),t&&Sa(r,t)}setStyle(t){const r=this.container;t?r.setAttribute("style",t):r.removeAttribute("style")}insertContainer(){const t=this.controlOption.position,r=this.container;if(t instanceof Element)t.appendChild(r);else{const i=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?i.insertBefore(r,i.firstChild):i.appendChild(r)}}checkUpdateOption(t,r){return r.some(i=>i in t)}}(0,D.Z)(rf,"controlCount",0);class Hv extends rf{constructor(...t){super(...t),(0,D.Z)(this,"isDisable",!1),(0,D.Z)(this,"button",void 0),(0,D.Z)(this,"buttonText",void 0),(0,D.Z)(this,"buttonIcon",void 0)}setIsDisable(t){if(this.isDisable=t,t){var r;(r=this.button)===null||r===void 0||r.setAttribute("disabled","true")}else{var i;(i=this.button)===null||i===void 0||i.removeAttribute("disabled")}}createButton(t=""){return Mi("button",`l7-button-control ${t}`)}onAdd(){this.button=this.createButton(),this.isDisable=!1;const{title:t,btnText:r,btnIcon:i}=this.controlOption;return this.setBtnTitle(t),this.setBtnText(r),this.setBtnIcon(i),this.button}onRemove(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}setOptions(t){const{title:r,btnText:i,btnIcon:a}=t;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(r),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(a),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(i),super.setOptions(t)}setBtnTitle(t){var r;(r=this.button)===null||r===void 0||r.setAttribute("title",t!=null?t:"")}setBtnIcon(t){if(this.buttonIcon&&la(this.buttonIcon),t){var r;const u=(r=this.button)===null||r===void 0?void 0:r.firstChild;if(u){var i;(i=this.button)===null||i===void 0||i.insertBefore(t,u)}else{var a;(a=this.button)===null||a===void 0||a.appendChild(t)}this.buttonIcon=t}}setBtnText(t){if(this.button)if(As(this.button,"l7-button-control--row"),As(this.button,"l7-button-control--column"),t){let i=this.buttonText;if(!i){var r;i=Mi("div","l7-button-control__text"),(r=this.button)===null||r===void 0||r.appendChild(i),this.buttonText=i}i.innerText=t,Sa(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(la(this.buttonText),this.buttonText=void 0)}}class Am extends wa.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(t,r){super(),(0,D.Z)(this,"popperDOM",void 0),(0,D.Z)(this,"contentDOM",void 0),(0,D.Z)(this,"button",void 0),(0,D.Z)(this,"option",void 0),(0,D.Z)(this,"isShow",!1),(0,D.Z)(this,"content",void 0),(0,D.Z)(this,"timeout",null),(0,D.Z)(this,"show",()=>this.isShow||!this.contentDOM.innerHTML?this:(this.resetPopperPosition(),As(this.popperDOM,"l7-popper-hide"),this.isShow=!0,this.option.unique&&Am.conflictPopperList.forEach(i=>{i!==this&&i.isShow&&i.hide()}),this.emit("show"),window.addEventListener("pointerdown",this.onPopperUnClick),this)),(0,D.Z)(this,"hide",()=>this.isShow?(Sa(this.popperDOM,"l7-popper-hide"),this.isShow=!1,this.emit("hide"),window.removeEventListener("pointerdown",this.onPopperUnClick),this):this),(0,D.Z)(this,"setHideTimeout",()=>{this.timeout||(this.timeout=window.setTimeout(()=>{this.isShow&&(this.hide(),this.timeout=null)},300))}),(0,D.Z)(this,"clearHideTimeout",()=>{this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null)}),(0,D.Z)(this,"onBtnClick",()=>{this.isShow?this.hide():this.show()}),(0,D.Z)(this,"onPopperUnClick",i=>{Fh(i.target,[".l7-button-control",".l7-popper-content"])||this.hide()}),(0,D.Z)(this,"onBtnMouseLeave",()=>{this.setHideTimeout()}),(0,D.Z)(this,"onBtnMouseMove",()=>{this.clearHideTimeout(),!this.isShow&&this.show()}),this.button=t,this.option=r,this.init(),r.unique&&Am.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(sl(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}init(){const{trigger:t}=this.option;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}destroy(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),la(this.popperDOM)}resetPopperPosition(){const t={},{container:r,offset:i=[0,0],placement:a}=this.option,[u,f]=i,m=this.button.getBoundingClientRect(),_=r.getBoundingClientRect(),{left:b,right:A,top:C,bottom:R}=uh(m,_);let U=!1,X=!1;/^(left|right)/.test(a)?(a.includes("left")?t.right=`${m.width+A}px`:a.includes("right")&&(t.left=`${m.width+b}px`),a.includes("start")?t.top=`${C}px`:a.includes("end")?t.bottom=`${R}px`:(t.top=`${C+m.height/2}px`,X=!0,t.transform=`translate(${u}px, calc(${f}px - 50%))`)):/^(top|bottom)/.test(a)&&(a.includes("top")?t.bottom=`${m.height+R}px`:a.includes("bottom")&&(t.top=`${m.height+C}px`),a.includes("start")?t.left=`${b}px`:a.includes("end")?t.right=`${A}px`:(t.left=`${b+m.width/2}px`,U=!0,t.transform=`translate(calc(${u}px - 50%), ${f}px)`)),t.transform=`translate(calc(${u}px - ${U?"50%":"0%"}), calc(${f}px - ${X?"50%":"0%"})`;const ee=a.split("-");ee.length&&Sa(this.popperDOM,ee.map(xe=>`l7-popper-${xe}`).join(" ")),al(this.popperDOM,op(t))}createPopper(){const{container:t,className:r="",content:i}=this.option,a=Mi("div",`l7-popper l7-popper-hide ${r}`),u=Mi("div","l7-popper-content"),f=Mi("div","l7-popper-arrow");return a.appendChild(u),a.appendChild(f),t.appendChild(a),this.popperDOM=a,this.contentDOM=u,i&&this.setContent(i),a}}(0,D.Z)(Am,"conflictPopperList",[]);const x2={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"};class b2 extends Hv{constructor(...t){super(...t),(0,D.Z)(this,"popper",void 0)}getPopper(){return this.popper}hide(){this.popper.hide(),super.hide()}getDefault(t){var r;const i=super.getDefault(t),a=(r=t==null?void 0:t.position)!==null&&r!==void 0?r:i.position;return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{popperPlacement:a instanceof Element?"bottom":x2[a],popperTrigger:"click"})}onAdd(){const t=super.onAdd();return this.initPopper(),t}onRemove(){this.popper.destroy()}initPopper(){const{popperClassName:t,popperPlacement:r,popperTrigger:i}=this.controlOption,a=this.mapsService.getMapContainer();return this.popper=new Am(this.button,{className:t,placement:r,trigger:i,container:a,unique:!0}),this.popper.on("show",()=>{this.emit("popperShow",this)}).on("hide",()=>{this.emit("popperHide",this)}),this.popper}setOptions(t){if(super.setOptions(t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){const r=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(r)}}}var Bp=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(Bp||{});class P0 extends b2{constructor(...t){super(...t),(0,D.Z)(this,"selectValue",[]),(0,D.Z)(this,"optionDOMList",void 0),(0,D.Z)(this,"createNormalOption",r=>{const i=this.selectValue.includes(r.value),a=Mi("div",`l7-select-control-item ${i?Bp.ActiveOptionClassName:""}`);this.getIsMultiple()?a.appendChild(this.createCheckbox(i)):a.appendChild(this.createRadio(i)),r.icon&&a.appendChild(r.icon);const u=Mi("span");return u.innerText=r.text,a.appendChild(u),a}),(0,D.Z)(this,"onItemClick",r=>{if(this.getIsMultiple()){const i=this.selectValue.findIndex(a=>a===r.value);i>-1?this.selectValue.splice(i,1):this.selectValue=[...this.selectValue,r.value]}else this.selectValue=[r.value];this.setSelectValue(this.selectValue)})}setOptions(t){super.setOptions(t);const{options:r}=t;r&&this.popper.setContent(this.getPopperContent(r))}onAdd(){const t=super.onAdd(),{defaultValue:r}=this.controlOption;return r&&(this.selectValue=this.transSelectValue(r)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}getSelectValue(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}setSelectValue(t,r=!0){const i=this.transSelectValue(t);this.optionDOMList.forEach(a=>{const u=a.getAttribute(Bp.OptionValueAttrKey),f=a.querySelector("input[type=checkbox]"),m=a.querySelector("input[type=radio]"),_=i.includes(u),b=(A,C)=>{Sl(a,Bp.ActiveOptionClassName,C),A&&Sc(A,C)};b(f,_),b(m,_)}),this.selectValue=i,r&&this.emit("selectChange",this.getIsMultiple()?i:i[0])}getIsMultiple(){return!1}getPopperContent(t){const r=this.isImageOptions(),i=Mi("div",r?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&Sa(i,"l7-select-control--multiple");const a=t.map((u,f)=>{const m=r?this.createImageOption(u):this.createNormalOption(u);return m.setAttribute(Bp.OptionValueAttrKey,u.value),m.setAttribute(Bp.OptionIndexAttrKey,window.String(f)),m.addEventListener("click",this.onItemClick.bind(this,u)),m});return i.append(...a),this.optionDOMList=a,i}createImageOption(t){const r=this.selectValue.includes(t.value),i=Mi("div",`l7-select-control-item ${r?Bp.ActiveOptionClassName:""}`),a=Mi("img");a.setAttribute("src",t.img),Bh(a),i.appendChild(a);const u=Mi("div","l7-select-control-item-row");this.getIsMultiple()&&i.appendChild(this.createCheckbox(r));const f=Mi("span");return f.innerText=t.text,u.appendChild(f),i.appendChild(u),i}createCheckbox(t){const r=Mi("input");return r.setAttribute("type","checkbox"),t&&Sc(r,!0),r}createRadio(t){const r=Mi("input");return r.setAttribute("type","radio"),t&&Sc(r,!0),r}isImageOptions(){return!!this.controlOption.options.find(t=>t.img)}transSelectValue(t){return Array.isArray(t)?t:[t]}}const nf=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");const r=document.createElementNS("http://www.w3.org/2000/svg","use");return r.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${e}`),t.appendChild(r),t};class E2 extends Hv{constructor(...t){var r;super(...t),r=this,(0,D.Z)(this,"onClick",(0,Xt.Z)(function*(){const{onExport:i}=r.controlOption;i==null||i(yield r.getImage())})),(0,D.Z)(this,"mergeImage",(0,Xt.Z)(function*(...i){var a,u;const{imageType:f}=r.controlOption,{width:m=0,height:_=0}=(a=(u=r.mapsService.getContainer())===null||u===void 0?void 0:u.getBoundingClientRect())!==null&&a!==void 0?a:{},b=document.createElement("canvas");b.width=m,b.height=_;const A=b.getContext("2d");return(yield Promise.all(i.map(R=>new Promise(U=>{const X=new Image;X.onload=()=>{U(X)},X.src=R})))).forEach(R=>{A==null||A.drawImage(R,0,0,m,_)}),b.toDataURL(`image/${f}`)}))}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),t}getDefault(t){return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:nf("l7-icon-export-picture"),imageType:"png"})}getImage(){var t=this;return(0,Xt.Z)(function*(){const r=yield t.mapsService.exportMap("png"),i=yield t.scene.exportPng("png");return t.mergeImage(...[r,i].filter(a=>a))})()}}const L0=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],of=(()=>{if(typeof document=="undefined")return!1;const e=L0[0],t={};for(const r of L0)if((r==null?void 0:r[1])in document){for(const[a,u]of r.entries())t[e[a]]=u;return t}return!1})(),D0={change:of.fullscreenchange,error:of.fullscreenerror};let Zl={request(e=document.documentElement,t){return new Promise((r,i)=>{const a=()=>{Zl.off("change",a),r()};Zl.on("change",a);const u=e[of.requestFullscreen](t);u instanceof Promise&&u.then(a).catch(i)})},exit(){return new Promise((e,t)=>{if(!Zl.isFullscreen){e();return}const r=()=>{Zl.off("change",r),e()};Zl.on("change",r);const i=document[of.exitFullscreen]();i instanceof Promise&&i.then(r).catch(t)})},toggle(e,t){return Zl.isFullscreen?Zl.exit():Zl.request(e,t)},onchange(e){Zl.on("change",e)},onerror(e){Zl.on("error",e)},on(e,t){const r=D0[e];r&&document.addEventListener(r,t,!1)},off(e,t){const r=D0[e];r&&document.removeEventListener(r,t,!1)},raw:of};Object.defineProperties(Zl,{isFullscreen:{get:()=>!!document[of.fullscreenElement]},element:{enumerable:!0,get:()=>{var e;return(e=document[of.fullscreenElement])!==null&&e!==void 0?e:void 0}},isEnabled:{enumerable:!0,get:()=>!!document[of.fullscreenEnabled]}}),of||(Zl={isEnabled:!1});var n_=Zl;class T2 extends Hv{constructor(t){var r;super(t),r=this,(0,D.Z)(this,"isFullscreen",!1),(0,D.Z)(this,"mapContainer",void 0),(0,D.Z)(this,"toggleFullscreen",(0,Xt.Z)(function*(){n_.isEnabled&&(yield n_.toggle(r.mapContainer))})),(0,D.Z)(this,"onClick",()=>{this.toggleFullscreen()}),(0,D.Z)(this,"onFullscreenChange",()=>{this.isFullscreen=!!document.fullscreenElement;const{btnText:i,btnIcon:a,title:u,exitBtnText:f,exitBtnIcon:m,exitTitle:_}=this.controlOption;this.isFullscreen?(this.setBtnTitle(_),this.setBtnText(f),this.setBtnIcon(m)):(this.setBtnTitle(u),this.setBtnText(i),this.setBtnIcon(a)),this.emit("fullscreenChange",this.isFullscreen)}),n_.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316")}setOptions(t){const{exitBtnText:r,exitBtnIcon:i,exitTitle:a}=t;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(r),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(a)),super.setOptions(t)}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),this.mapContainer=gf(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}onRemove(){super.onRemove(),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}getDefault(t){return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{title:"\u5168\u5C4F",btnIcon:nf("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:nf("l7-icon-exit-fullscreen")})}}class A2 extends Hv{constructor(t){var r;super(t),r=this,(0,D.Z)(this,"getGeoLocation",()=>new Promise((i,a)=>{window.navigator.geolocation.getCurrentPosition(({coords:u})=>{const{longitude:f,latitude:m}=u!=null?u:{};!isNaN(f)&&!isNaN(m)?i([f,m]):a()},u=>{a(u)})})),(0,D.Z)(this,"onClick",(0,Xt.Z)(function*(){if(!window.navigator.geolocation)return;const{transform:i}=r.controlOption,a=yield r.getGeoLocation(),u=r.mapsService.getZoom();r.mapsService.setZoomAndCenter(u>15?u:15,i?yield i(a):a)})),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D")}getDefault(t){return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{title:"\u5B9A\u4F4D",btnIcon:nf("l7-icon-reposition")})}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),t}}function B0(e){return Object.keys(e!=null?e:{}).every(t=>["layer","name","img"].includes(t))}class F0 extends P0{constructor(...t){super(...t),(0,D.Z)(this,"onLayerChange",()=>{var r;(r=this.controlOption.layers)!==null&&r!==void 0&&r.length||(this.selectValue=this.getLayerVisible(),this.setOptions({options:this.getLayerOptions()}))}),(0,D.Z)(this,"onLayerVisibleChane",()=>{this.setSelectValue(this.getLayerVisible())}),(0,D.Z)(this,"onSelectChange",()=>{this.layers.forEach(r=>{const i=this.selectValue.includes(r.name),a=r.isVisible();i&&!a&&r.show(),!i&&a&&r.hide()})})}get layers(){const t=this.layerService,{layers:r}=this.controlOption;if(Array.isArray(r)&&r.length){const i=[];return r.forEach(a=>{if(a instanceof Object&&(B0(a)?i.push(a.layer):i.push(a)),typeof a=="string"){const u=t.getLayer(a)||t.getLayerByName(a);u&&i.push(u)}}),i}return t.getLayers()||[]}getDefault(t){var r;return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:nf("l7-icon-layer"),options:[],multiple:(r=t==null?void 0:t.multiple)!==null&&r!==void 0?r:!0})}getLayerVisible(){return this.layers.filter(t=>t.isVisible()).map(t=>t.name)}getLayerOptions(){const{layers:t}=this.controlOption,r=t==null?void 0:t.every(i=>i.img);return t?t==null?void 0:t.map(i=>{if(B0(i))return{text:i.name||i.layer.name,value:i.layer.name,img:r?i.img:void 0};if(typeof i=="string"){const a=this.layerService.getLayer(i)||this.layerService.getLayerByName(i);return{text:a==null?void 0:a.name,value:a==null?void 0:a.name}}return{text:i.name,value:i.name}}):this.layers.map(i=>({text:i.name,value:i.name}))}setOptions(t){const r=this.checkUpdateOption(t,["layers","multiple"]);super.setOptions(t),r&&(this.controlOption.multiple===!1&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}handleSingleSelection(){this.layers.forEach((t,r)=>{r===0?t.show():t.hide()})}onAdd(){var t;return this.controlOption.multiple===!1&&this.handleSingleSelection(),(t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),super.onAdd()}onRemove(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}getIsMultiple(){return this.controlOption.multiple}}class N0 extends rf{getDefault(){return{position:Qe.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}onAdd(){const t=Mi("div","l7-control-logo");return this.setLogoContent(t),t}onRemove(){return null}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["img","href"])&&(sl(this.container),this.setLogoContent(this.container))}setLogoContent(t){const{href:r,img:i}=this.controlOption,a=Mi("img");if(a.setAttribute("src",i),a.setAttribute("aria-label","AntV logo"),Bh(a),r){const u=Mi("a","l7-control-logo-link");u.target="_blank",u.href=r,u.rel="noopener nofollow",u.setAttribute("rel","noopener nofollow"),u.appendChild(a),t.appendChild(u)}else t.appendChild(a)}}const S2={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},w2={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};class C2 extends P0{constructor(...t){super(...t),(0,D.Z)(this,"onMapThemeChange",()=>{this.mapsService.setMapStyle(this.selectValue[0])})}getDefault(t){return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:nf("l7-icon-color"),options:[]})}getStyleOptions(){const t=this.mapsService.getType()==="mapbox"?w2:S2;return Object.entries(this.mapsService.getMapStyleConfig()).filter(([r,i])=>typeof i=="string"&&r!=="blank").map(([r,i])=>{var a;const{text:u,img:f}=(a=t[r])!==null&&a!==void 0?a:{};return{text:u!=null?u:r,value:i,img:f,key:r}})}getMapStyle(){return this.mapsService.getMapStyle()}onAdd(){var t;if((t=this.controlOption.options)!==null&&t!==void 0&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i;const a=this.controlOption.defaultValue;this.controlOption.defaultValue=(r=(i=this.controlOption.options.find(u=>u.key===a))===null||i===void 0?void 0:i.value)!==null&&r!==void 0?r:a}else{const a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",()=>{const u=this.mapsService.getMapStyle();this.controlOption.defaultValue=u,this.setSelectValue(u,!1)})}return this.on("selectChange",this.onMapThemeChange),super.onAdd()}getIsMultiple(){return!1}}class R2 extends rf{constructor(...t){super(...t),(0,D.Z)(this,"location",[0,0]),(0,D.Z)(this,"onMouseMove",r=>{let i=this.location;const a=r.lngLat||r.lnglat,{transform:u}=this.controlOption;a&&(i=[a.lng,a.lat]),this.location=i,u&&(i=u(i)),this.insertLocation2HTML(i),this.emit("locationChange",i)})}getLocation(){return this.location}getDefault(t){return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{position:Qe.BOTTOMLEFT,transform:([r,i])=>[+(+r).toFixed(6),+(+i).toFixed(6)]})}onAdd(){const t=Mi("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}onRemove(){this.mapsService.off("mousemove",this.onMouseMove)}insertLocation2HTML(t){this.container.innerText=t.join(", ")}}class I2 extends rf{constructor(...t){super(...t),(0,D.Z)(this,"mScale",void 0),(0,D.Z)(this,"iScale",void 0),(0,D.Z)(this,"update",()=>{const r=this.mapsService,{maxWidth:i}=this.controlOption,a=r.getSize()[1]/2,u=r.containerToLngLat([0,a]),f=r.containerToLngLat([i,a]),m=Qa([u.lng,u.lat],[f.lng,f.lat]);this.updateScales(m)})}getDefault(t){return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{name:"scale",position:Qe.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}onAdd(){const r=Mi("div","l7-control-scale");this.resetScaleLines(r);const{updateWhenIdle:i}=this.controlOption;return this.mapsService.on(i?"moveend":"mapmove",this.update),this.mapsService.on(i?"zoomend":"zoomchange",this.update),r}onRemove(){const{updateWhenIdle:t}=this.controlOption;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}updateScales(t){const{metric:r,imperial:i}=this.controlOption;r&&t&&this.updateMetric(t),i&&t&&this.updateImperial(t)}resetScaleLines(t){sl(t);const{metric:r,imperial:i,maxWidth:a,lockWidth:u}=this.controlOption;u&&al(t,`width: ${a}px`),r&&(this.mScale=Mi("div","l7-control-scale-line",t)),i&&(this.iScale=Mi("div","l7-control-scale-line",t)),this.update()}updateScale(t,r,i){const{maxWidth:a}=this.controlOption;t.style.width=Math.round(a*i)+"px",t.innerHTML=r}getRoundNum(t){const r=Math.pow(10,(Math.floor(t)+"").length-1);let i=t/r;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,r*i}updateMetric(t){const r=this.getRoundNum(t),i=r<1e3?r+" m":r/1e3+" km";this.updateScale(this.mScale,i,r/t)}updateImperial(t){const r=t*3.2808399;let i,a,u;r>5280?(i=r/5280,a=this.getRoundNum(i),this.updateScale(this.iScale,a+" mi",a/i)):(u=this.getRoundNum(r),this.updateScale(this.iScale,u+" ft",u/r))}}class M2{constructor(){(0,D.Z)(this,"mapService",void 0),(0,D.Z)(this,"fontService",void 0)}apply(t,{styleAttributeService:r,mapService:i,fontService:a}){var u=this;this.mapService=i,this.fontService=a,t.hooks.init.tapPromise("DataMappingPlugin",(0,Xt.Z)(function*(){t.log(ue.MappingStart,Wt.INIT),u.generateMaping(t,{styleAttributeService:r}),t.log(ue.MappingEnd,Wt.INIT)})),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var f=(0,Xt.Z)(function*(m){if(!m)return m;t.dataState.dataMappingNeedUpdate=!1,t.log(ue.MappingStart,Wt.UPDATE);const _=u.generateMaping(t,{styleAttributeService:r});return t.log(ue.MappingEnd,Wt.UPDATE),_});return function(m){return f.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",()=>{const f=t.getSource();if(t.layerModelNeedUpdate||!f||!f.inited)return;const m=r.getLayerStyleAttributes()||[],_=r.getLayerStyleAttribute("filter"),{dataArray:b}=f.data;if(Array.isArray(b)&&b.length===0)return;const A=m.filter(R=>R.needRemapping);let C=b;if(_!=null&&_.needRemapping&&_!==null&&_!==void 0&&_.scale&&(C=b.filter(R=>this.applyAttributeMapping(_,R)[0])),A.length){const R=this.mapping(t,A,C,t.getEncodedData());t.setEncodedData(R)}})}generateMaping(t,{styleAttributeService:r}){const i=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter"),{dataArray:u}=t.getSource().data;let f=u;a!=null&&a.scale&&(f=u.filter(_=>this.applyAttributeMapping(a,_)[0])),f=t.processData(f);const m=this.mapping(t,i,f,void 0);return t.setEncodedData(m),t.emit("dataUpdate",null),!0}mapping(t,r,i,a){const u=r.filter(m=>m.scale!==void 0).filter(m=>m.name!=="filter"),f=i.map((m,_)=>{const b=a?a[_]:{},A=(0,_e.Z)({id:m._id,coordinates:m.coordinates},b);return u.forEach(C=>{let R=this.applyAttributeMapping(C,m);(C.name==="color"||C.name==="stroke")&&(R=R.map(U=>ti(U))),A[C.name]=Array.isArray(R)&&R.length===1?R[0]:R,C.name==="shape"&&(A.shape=this.fontService.getIconFontKey(A[C.name]))}),A});return r.forEach(m=>{m.needRemapping=!1}),this.adjustData2SimpleCoordinates(f),f}adjustData2SimpleCoordinates(t){t.length>0&&this.mapService.version==="SIMPLE"&&t.map(r=>{r.simpleCoordinate||(r.coordinates=this.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}unProjectCoordinates(t){if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){const r=[];return t.map(i=>{const a=[];i.map(u=>{a.push(this.mapService.simpleMapCoord.unproject(u))}),r.push(a)}),r}else{const r=[];return t.map(i=>{r.push(this.mapService.simpleMapCoord.unproject(i))}),r}}applyAttributeMapping(t,r){var i;if(!t.scale)return[];const a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],u=[];return a.forEach(({field:m})=>{var _;(r.hasOwnProperty(m)||((_=t.scale)===null||_===void 0?void 0:_.type)==="variable")&&u.push(r[m])}),t.mapping?t.mapping(u):[]}getArrowPoints(t,r){const i=[r[0]-t[0],r[1]-t[1]],a=Oc(i);return[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4]}}class O2{constructor(){(0,D.Z)(this,"mapService",void 0)}apply(t){var r=this;this.mapService=t.getContainer().mapService,t.hooks.init.tapPromise("DataSourcePlugin",(0,Xt.Z)(function*(){t.log(ue.SourceInitStart,Wt.INIT);let i=t.getSource();if(!i){const{data:a,options:u}=t.sourceOption||t.defaultSourceConfig;i=new g2(a,u),t.setSource(i)}i.inited?(r.updateClusterData(t),t.log(ue.SourceInitEnd,Wt.INIT)):yield new Promise(a=>{i.on("update",u=>{u.type==="inited"&&(r.updateClusterData(t),t.log(ue.SourceInitEnd,Wt.INIT)),a(null)})})})),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Xt.Z)(function*(){const i=r.updateClusterData(t),a=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,i||a}))}updateClusterData(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;const r=t.getSource(),i=r.cluster,{zoom:a=0}=r.clusterOptions,u=this.mapService.getZoom()-1,f=t.dataState.dataSourceNeedUpdate;return i&&f&&r.updateClusterData(Math.floor(u)),i&&Math.abs(t.clusterZoom-u)>=1?(a!==Math.floor(u)&&r.updateClusterData(Math.floor(u)),t.clusterZoom=u,!0):!1}}var P2=H(335),U0=H.n(P2);function k0(e,t){var r,i;if(t===void 0){var a=U0()(e),u;try{for(a.s();!(u=a.n()).done;){var f=u.value;f!=null&&(r===void 0?f>=f&&(r=i=f):(r>f&&(r=f),i<f&&(i=f)))}}catch(C){a.e(C)}finally{a.f()}}else{var m=-1,_=U0()(e),b;try{for(_.s();!(b=_.n()).done;){var A=b.value;(A=t(A,++m,e))!=null&&(r===void 0?A>=A&&(r=i=A):(r>A&&(r=A),i<A&&(i=A)))}}catch(C){_.e(C)}finally{_.f()}}return[r,i]}function z0(e,t,r,i,a){var u=e*e,f=u*e;return((1-3*e+3*u-f)*t+(4-6*u+3*f)*r+(1+3*e+3*u-3*f)*i+f*a)/6}function L2(e){var t=e.length-1;return function(r){var i=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),a=e[i],u=e[i+1],f=i>0?e[i-1]:2*a-u,m=i<t-1?e[i+2]:2*u-a;return z0((r-i/t)*t,f,a,u,m)}}function D2(e){var t=e.length;return function(r){var i=Math.floor(((r%=1)<0?++r:r)*t),a=e[(i+t-1)%t],u=e[i%t],f=e[(i+1)%t],m=e[(i+2)%t];return z0((r-i/t)*t,a,u,f,m)}}function i_(e){return function(){return e}}function V0(e,t){return function(r){return e+r*t}}function B2(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(i){return Math.pow(e+i*t,r)}}function d4(e,t){var r=t-e;return r?V0(e,r>180||r<-180?r-360*Math.round(r/360):r):constant(isNaN(e)?t:e)}function F2(e){return(e=+e)==1?Z0:function(t,r){return r-t?B2(t,r,e):i_(isNaN(t)?r:t)}}function Z0(e,t){var r=t-e;return r?V0(e,r):i_(isNaN(e)?t:e)}var j0=function e(t){var r=F2(t);function i(a,u){var f=r((a=Vt(a)).r,(u=Vt(u)).r),m=r(a.g,u.g),_=r(a.b,u.b),b=Z0(a.opacity,u.opacity);return function(A){return a.r=f(A),a.g=m(A),a.b=_(A),a.opacity=b(A),a+""}}return i.gamma=e,i}(1);function H0(e){return function(t){var r=t.length,i=new Array(r),a=new Array(r),u=new Array(r),f,m;for(f=0;f<r;++f)m=Vt(t[f]),i[f]=m.r||0,a[f]=m.g||0,u[f]=m.b||0;return i=e(i),a=e(a),u=e(u),m.opacity=1,function(_){return m.r=i(_),m.g=a(_),m.b=u(_),m+""}}}var N2=H0(L2),m4=H0(D2);function o_(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function X0(e){return e.length===1&&(e=U2(e)),{left:function(t,r,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var u=i+a>>>1;e(t[u],r)<0?i=u+1:a=u}return i},right:function(t,r,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var u=i+a>>>1;e(t[u],r)>0?a=u:i=u+1}return i}}}function U2(e){return function(t,r){return o_(e(t),r)}}var W0=X0(o_),k2=W0.right,v4=W0.left,Xv=k2,G0=Array.prototype,g4=G0.slice,_4=G0.map,a_=Math.sqrt(50),s_=Math.sqrt(10),u_=Math.sqrt(2);function Y0(e,t,r){var i,a=-1,u,f,m;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((i=t<e)&&(u=e,e=t,t=u),(m=Wv(e,t,r))===0||!isFinite(m))return[];if(m>0)for(e=Math.ceil(e/m),t=Math.floor(t/m),f=new Array(u=Math.ceil(t-e+1));++a<u;)f[a]=(e+a)*m;else for(e=Math.floor(e*m),t=Math.ceil(t*m),f=new Array(u=Math.ceil(e-t+1));++a<u;)f[a]=(e-a)/m;return i&&f.reverse(),f}function Wv(e,t,r){var i=(t-e)/Math.max(0,r),a=Math.floor(Math.log(i)/Math.LN10),u=i/Math.pow(10,a);return a>=0?(u>=a_?10:u>=s_?5:u>=u_?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(u>=a_?10:u>=s_?5:u>=u_?2:1)}function l_(e,t,r){var i=Math.abs(t-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),u=i/a;return u>=a_?a*=10:u>=s_?a*=5:u>=u_&&(a*=2),t<e?-a:a}function y4(){var e=identity,t=extent,r=sturges;function i(a){var u,f=a.length,m,_=new Array(f);for(u=0;u<f;++u)_[u]=e(a[u],u,a);var b=t(_),A=b[0],C=b[1],R=r(_,A,C);Array.isArray(R)||(R=tickStep(A,C,R),R=range(Math.ceil(A/R)*R,C,R));for(var U=R.length;R[0]<=A;)R.shift(),--U;for(;R[U-1]>C;)R.pop(),--U;var X=new Array(U+1),ee;for(u=0;u<=U;++u)ee=X[u]=[],ee.x0=u>0?R[u-1]:A,ee.x1=u<U?R[u]:C;for(u=0;u<f;++u)m=_[u],A<=m&&m<=C&&X[bisect(R,m,0,U)].push(a[u]);return X}return i.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),i):e},i.domain=function(a){return arguments.length?(t=typeof a=="function"?a:constant([a[0],a[1]]),i):t},i.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),i):r},i}function x4(e,t,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-t)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function z2(e){return e===null?NaN:+e}function V2(e,t,r){if(r==null&&(r=z2),!!(i=e.length)){if((t=+t)<=0||i<2)return+r(e[0],0,e);if(t>=1)return+r(e[i-1],i-1,e);var i,a=(i-1)*t,u=Math.floor(a),f=+r(e[u],u,e),m=+r(e[u+1],u+1,e);return f+(m-f)*(a-u)}}var dc="$";function Gv(){}Gv.prototype=q0.prototype={constructor:Gv,has:function(e){return dc+e in this},get:function(e){return this[dc+e]},set:function(e,t){return this[dc+e]=t,this},remove:function(e){var t=dc+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===dc&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===dc&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===dc&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===dc&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===dc&&++e;return e},empty:function(){for(var e in this)if(e[0]===dc)return!1;return!0},each:function(e){for(var t in this)t[0]===dc&&e(this[t],t.slice(1),this)}};function q0(e,t){var r=new Gv;if(e instanceof Gv)e.each(function(m,_){r.set(_,m)});else if(Array.isArray(e)){var i=-1,a=e.length,u;if(t==null)for(;++i<a;)r.set(i,e[i]);else for(;++i<a;)r.set(t(u=e[i],i,e),u)}else if(e)for(var f in e)r.set(f,e[f]);return r}var c_=q0;function b4(){var e=[],t=[],r,i,a;function u(m,_,b,A){if(_>=e.length)return r!=null&&m.sort(r),i!=null?i(m):m;for(var C=-1,R=m.length,U=e[_++],X,ee,xe=map(),ke,Ne=b();++C<R;)(ke=xe.get(X=U(ee=m[C])+""))?ke.push(ee):xe.set(X,[ee]);return xe.each(function(it,gt){A(Ne,gt,u(it,_,b,A))}),Ne}function f(m,_){if(++_>e.length)return m;var b,A=t[_-1];return i!=null&&_>=e.length?b=m.entries():(b=[],m.each(function(C,R){b.push({key:R,values:f(C,_)})})),A!=null?b.sort(function(C,R){return A(C.key,R.key)}):b}return a={object:function(m){return u(m,0,Z2,j2)},map:function(m){return u(m,0,K0,$0)},entries:function(m){return f(u(m,0,K0,$0),0)},key:function(m){return e.push(m),a},sortKeys:function(m){return t[e.length-1]=m,a},sortValues:function(m){return r=m,a},rollup:function(m){return i=m,a}}}function Z2(){return{}}function j2(e,t,r){e[t]=r}function K0(){return map()}function $0(e,t,r){e.set(t,r)}function Yv(){}var Fp=c_.prototype;Yv.prototype=H2.prototype={constructor:Yv,has:Fp.has,add:function(e){return e+="",this[dc+e]=e,this},remove:Fp.remove,clear:Fp.clear,values:Fp.keys,size:Fp.size,empty:Fp.empty,each:Fp.each};function H2(e,t){var r=new Yv;if(e instanceof Yv)e.each(function(u){r.add(u)});else if(e){var i=-1,a=e.length;if(t==null)for(;++i<a;)r.add(e[i]);else for(;++i<a;)r.add(t(e[i],i,e))}return r}var E4=null,Q0=Array.prototype,J0=Q0.map,Np=Q0.slice;function Gf(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function ey(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var ty={name:"implicit"};function qv(){var e=c_(),t=[],r=[],i=ty;function a(u){var f=u+"",m=e.get(f);if(!m){if(i!==ty)return i;e.set(f,m=t.push(u))}return r[(m-1)%r.length]}return a.domain=function(u){if(!arguments.length)return t.slice();t=[],e=c_();for(var f=-1,m=u.length,_,b;++f<m;)e.has(b=(_=u[f])+"")||e.set(b,t.push(_));return a},a.range=function(u){return arguments.length?(r=Np.call(u),a):r.slice()},a.unknown=function(u){return arguments.length?(i=u,a):i},a.copy=function(){return qv(t,r).unknown(i)},Gf.apply(a,arguments),a}function ry(){var e=ordinal().unknown(void 0),t=e.domain,r=e.range,i=[0,1],a,u,f=!1,m=0,_=0,b=.5;delete e.unknown;function A(){var C=t().length,R=i[1]<i[0],U=i[R-0],X=i[1-R];a=(X-U)/Math.max(1,C-m+_*2),f&&(a=Math.floor(a)),U+=(X-U-a*(C-m))*b,u=a*(1-m),f&&(U=Math.round(U),u=Math.round(u));var ee=sequence(C).map(function(xe){return U+a*xe});return r(R?ee.reverse():ee)}return e.domain=function(C){return arguments.length?(t(C),A()):t()},e.range=function(C){return arguments.length?(i=[+C[0],+C[1]],A()):i.slice()},e.rangeRound=function(C){return i=[+C[0],+C[1]],f=!0,A()},e.bandwidth=function(){return u},e.step=function(){return a},e.round=function(C){return arguments.length?(f=!!C,A()):f},e.padding=function(C){return arguments.length?(m=Math.min(1,_=+C),A()):m},e.paddingInner=function(C){return arguments.length?(m=Math.min(1,C),A()):m},e.paddingOuter=function(C){return arguments.length?(_=+C,A()):_},e.align=function(C){return arguments.length?(b=Math.max(0,Math.min(1,C)),A()):b},e.copy=function(){return ry(t(),i).round(f).paddingInner(m).paddingOuter(_).align(b)},initRange.apply(A(),arguments)}function ny(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return ny(t())},e}function T4(){return ny(ry.apply(null,arguments).paddingInner(1))}function A4(e,t){return(isNumberArray(t)?numberArray:iy)(e,t)}function iy(e,t){var r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),u=new Array(r),f;for(f=0;f<i;++f)a[f]=p_(e[f],t[f]);for(;f<r;++f)u[f]=t[f];return function(m){for(f=0;f<i;++f)u[f]=a[f](m);return u}}function X2(e,t){var r=new Date;return e=+e,t=+t,function(i){return r.setTime(e*(1-i)+t*i),r}}function Kv(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function W2(e,t){var r={},i={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=p_(e[a],t[a]):i[a]=t[a];return function(u){for(a in r)i[a]=r[a](u);return i}}var h_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,f_=new RegExp(h_.source,"g");function G2(e){return function(){return e}}function Y2(e){return function(t){return e(t)+""}}function q2(e,t){var r=h_.lastIndex=f_.lastIndex=0,i,a,u,f=-1,m=[],_=[];for(e=e+"",t=t+"";(i=h_.exec(e))&&(a=f_.exec(t));)(u=a.index)>r&&(u=t.slice(r,u),m[f]?m[f]+=u:m[++f]=u),(i=i[0])===(a=a[0])?m[f]?m[f]+=a:m[++f]=a:(m[++f]=null,_.push({i:f,x:Kv(i,a)})),r=f_.lastIndex;return r<t.length&&(u=t.slice(r),m[f]?m[f]+=u:m[++f]=u),m.length<2?_[0]?Y2(_[0].x):G2(t):(t=_.length,function(b){for(var A=0,C;A<t;++A)m[(C=_[A]).i]=C.x(b);return m.join("")})}function K2(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,i=t.slice(),a;return function(u){for(a=0;a<r;++a)i[a]=e[a]*(1-u)+t[a]*u;return i}}function $2(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function p_(e,t){var r=typeof t,i;return t==null||r==="boolean"?i_(t):(r==="number"?Kv:r==="string"?(i=Zo(t))?(t=i,j0):q2:t instanceof Zo?j0:t instanceof Date?X2:$2(t)?K2:Array.isArray(t)?iy:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?W2:Kv)(e,t)}function Q2(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function J2(e){return function(){return e}}function eT(e){return+e}var oy=[0,1];function Ou(e){return e}function d_(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:J2(isNaN(t)?NaN:.5)}function ay(e){var t=e[0],r=e[e.length-1],i;return t>r&&(i=t,t=r,r=i),function(a){return Math.max(t,Math.min(r,a))}}function tT(e,t,r){var i=e[0],a=e[1],u=t[0],f=t[1];return a<i?(i=d_(a,i),u=r(f,u)):(i=d_(i,a),u=r(u,f)),function(m){return u(i(m))}}function rT(e,t,r){var i=Math.min(e.length,t.length)-1,a=new Array(i),u=new Array(i),f=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++f<i;)a[f]=d_(e[f],e[f+1]),u[f]=r(t[f],t[f+1]);return function(m){var _=Xv(e,m,1,i)-1;return u[_](a[_](m))}}function $v(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function m_(){var e=oy,t=oy,r=p_,i,a,u,f=Ou,m,_,b;function A(){return m=Math.min(e.length,t.length)>2?rT:tT,_=b=null,C}function C(R){return isNaN(R=+R)?u:(_||(_=m(e.map(i),t,r)))(i(f(R)))}return C.invert=function(R){return f(a((b||(b=m(t,e.map(i),Kv)))(R)))},C.domain=function(R){return arguments.length?(e=J0.call(R,eT),f===Ou||(f=ay(e)),A()):e.slice()},C.range=function(R){return arguments.length?(t=Np.call(R),A()):t.slice()},C.rangeRound=function(R){return t=Np.call(R),r=Q2,A()},C.clamp=function(R){return arguments.length?(f=R?ay(e):Ou,C):f!==Ou},C.interpolate=function(R){return arguments.length?(r=R,A()):r},C.unknown=function(R){return arguments.length?(u=R,C):u},function(R,U){return i=R,a=U,A()}}function sy(e,t){return m_()(e,t)}var nT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Qv(e){if(!(t=nT.exec(e)))throw new Error("invalid format: "+e);var t;return new v_({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Qv.prototype=v_.prototype;function v_(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}v_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function iT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Jv(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function wd(e){return e=Jv(Math.abs(e)),e?e[1]:NaN}function oT(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(wd(t)/3)))*3-wd(Math.abs(e)))}function aT(e,t){return function(r,i){for(var a=r.length,u=[],f=0,m=e[0],_=0;a>0&&m>0&&(_+m+1>i&&(m=Math.max(1,i-_)),u.push(r.substring(a-=m,a+m)),!((_+=m+1)>i));)m=e[f=(f+1)%e.length];return u.reverse().join(t)}}function sT(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}function uT(e){e:for(var t=e.length,r=1,i=-1,a;r<t;++r)switch(e[r]){case".":i=a=r;break;case"0":i===0&&(i=r),a=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(a+1):e}var uy;function lT(e,t){var r=Jv(e,t);if(!r)return e+"";var i=r[0],a=r[1],u=a-(uy=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=i.length;return u===f?i:u>f?i+new Array(u-f+1).join("0"):u>0?i.slice(0,u)+"."+i.slice(u):"0."+new Array(1-u).join("0")+Jv(e,Math.max(0,t+u-1))[0]}function ly(e,t){var r=Jv(e,t);if(!r)return e+"";var i=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+i:i.length>a+1?i.slice(0,a+1)+"."+i.slice(a+1):i+new Array(a-i.length+2).join("0")}var cy={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:iT,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return ly(e*100,t)},r:ly,s:lT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function hy(e){return e}var fy=Array.prototype.map,py=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function cT(e){var t=e.grouping===void 0||e.thousands===void 0?hy:aT(fy.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?hy:sT(fy.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",m=e.minus===void 0?"-":e.minus+"",_=e.nan===void 0?"NaN":e.nan+"";function b(C){C=Qv(C);var R=C.fill,U=C.align,X=C.sign,ee=C.symbol,xe=C.zero,ke=C.width,Ne=C.comma,it=C.precision,gt=C.trim,rr=C.type;rr==="n"?(Ne=!0,rr="g"):cy[rr]||(it===void 0&&(it=12),gt=!0,rr="g"),(xe||R==="0"&&U==="=")&&(xe=!0,R="0",U="=");var Kt=ee==="$"?r:ee==="#"&&/[boxX]/.test(rr)?"0"+rr.toLowerCase():"",Rt=ee==="$"?i:/[%p]/.test(rr)?f:"",tr=cy[rr],Tn=/[defgprs%]/.test(rr);it=it===void 0?6:/[gprs]/.test(rr)?Math.max(1,Math.min(21,it)):Math.max(0,Math.min(20,it));function fi(An){var ui=Kt,Xi=Rt,ou,Lu,bl;if(rr==="c")Xi=tr(An)+Xi,An="";else{An=+An;var tp=An<0||1/An<0;if(An=isNaN(An)?_:tr(Math.abs(An),it),gt&&(An=uT(An)),tp&&+An==0&&X!=="+"&&(tp=!1),ui=(tp?X==="("?X:m:X==="-"||X==="("?"":X)+ui,Xi=(rr==="s"?py[8+uy/3]:"")+Xi+(tp&&X==="("?")":""),Tn){for(ou=-1,Lu=An.length;++ou<Lu;)if(bl=An.charCodeAt(ou),48>bl||bl>57){Xi=(bl===46?a+An.slice(ou+1):An.slice(ou))+Xi,An=An.slice(0,ou);break}}}Ne&&!xe&&(An=t(An,1/0));var rp=ui.length+An.length+Xi.length,Hl=rp<ke?new Array(ke-rp+1).join(R):"";switch(Ne&&xe&&(An=t(Hl+An,Hl.length?ke-Xi.length:1/0),Hl=""),U){case"<":An=ui+An+Xi+Hl;break;case"=":An=ui+Hl+An+Xi;break;case"^":An=Hl.slice(0,rp=Hl.length>>1)+ui+An+Xi+Hl.slice(rp);break;default:An=Hl+ui+An+Xi;break}return u(An)}return fi.toString=function(){return C+""},fi}function A(C,R){var U=b((C=Qv(C),C.type="f",C)),X=Math.max(-8,Math.min(8,Math.floor(wd(R)/3)))*3,ee=Math.pow(10,-X),xe=py[8+X/3];return function(ke){return U(ee*ke)+xe}}return{format:b,formatPrefix:A}}var eg,g_,dy;hT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function hT(e){return eg=cT(e),g_=eg.format,dy=eg.formatPrefix,eg}function fT(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,wd(t)-wd(e))+1}function pT(e){return Math.max(0,-wd(Math.abs(e)))}function dT(e,t,r,i){var a=l_(e,t,r),u;switch(i=Qv(i==null?",f":i),i.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(u=oT(a,f))&&(i.precision=u),dy(i,f)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(u=fT(a,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=u-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(u=pT(a))&&(i.precision=u-(i.type==="%")*2);break}}return g_(i)}function Sm(e){var t=e.domain;return e.ticks=function(r){var i=t();return Y0(i[0],i[i.length-1],r==null?10:r)},e.tickFormat=function(r,i){var a=t();return dT(a[0],a[a.length-1],r==null?10:r,i)},e.nice=function(r){r==null&&(r=10);var i=t(),a=0,u=i.length-1,f=i[a],m=i[u],_;return m<f&&(_=f,f=m,m=_,_=a,a=u,u=_),_=Wv(f,m,r),_>0?(f=Math.floor(f/_)*_,m=Math.ceil(m/_)*_,_=Wv(f,m,r)):_<0&&(f=Math.ceil(f*_)/_,m=Math.floor(m*_)/_,_=Wv(f,m,r)),_>0?(i[a]=Math.floor(f/_)*_,i[u]=Math.ceil(m/_)*_,t(i)):_<0&&(i[a]=Math.ceil(f*_)/_,i[u]=Math.floor(m*_)/_,t(i)),e},e}function vy(){var e=sy(Ou,Ou);return e.copy=function(){return $v(e,vy())},Gf.apply(e,arguments),Sm(e)}function mT(e){var t;function r(i){return isNaN(i=+i)?t:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=map.call(i,number),r):e.slice()},r.unknown=function(i){return arguments.length?(t=i,r):t},r.copy=function(){return mT(e).unknown(t)},e=arguments.length?map.call(e,number):[0,1],linearish(r)}function gy(e,t){e=e.slice();var r=0,i=e.length-1,a=e[r],u=e[i],f;return u<a&&(f=r,r=i,i=f,f=a,a=u,u=f),e[r]=t.floor(a),e[i]=t.ceil(u),e}function _y(e){return Math.log(e)}function yy(e){return Math.exp(e)}function vT(e){return-Math.log(-e)}function gT(e){return-Math.exp(-e)}function _T(e){return isFinite(e)?+("1e"+e):e<0?0:e}function yT(e){return e===10?_T:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function xT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function xy(e){return function(t){return-e(-t)}}function bT(e){var t=e(_y,yy),r=t.domain,i=10,a,u;function f(){return a=xT(i),u=yT(i),r()[0]<0?(a=xy(a),u=xy(u),e(vT,gT)):e(_y,yy),t}return t.base=function(m){return arguments.length?(i=+m,f()):i},t.domain=function(m){return arguments.length?(r(m),f()):r()},t.ticks=function(m){var _=r(),b=_[0],A=_[_.length-1],C;(C=A<b)&&(R=b,b=A,A=R);var R=a(b),U=a(A),X,ee,xe,ke=m==null?10:+m,Ne=[];if(!(i%1)&&U-R<ke){if(R=Math.round(R)-1,U=Math.round(U)+1,b>0){for(;R<U;++R)for(ee=1,X=u(R);ee<i;++ee)if(xe=X*ee,!(xe<b)){if(xe>A)break;Ne.push(xe)}}else for(;R<U;++R)for(ee=i-1,X=u(R);ee>=1;--ee)if(xe=X*ee,!(xe<b)){if(xe>A)break;Ne.push(xe)}}else Ne=Y0(R,U,Math.min(U-R,ke)).map(u);return C?Ne.reverse():Ne},t.tickFormat=function(m,_){if(_==null&&(_=i===10?".0e":","),typeof _!="function"&&(_=g_(_)),m===1/0)return _;m==null&&(m=10);var b=Math.max(1,i*m/t.ticks().length);return function(A){var C=A/u(Math.round(a(A)));return C*i<i-.5&&(C*=i),C<=b?_(A):""}},t.nice=function(){return r(gy(r(),{floor:function(m){return u(Math.floor(a(m)))},ceil:function(m){return u(Math.ceil(a(m)))}}))},t}function by(){var e=bT(m_()).domain([1,10]);return e.copy=function(){return $v(e,by()).base(e.base())},Gf.apply(e,arguments),e}function Ey(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Ty(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function ET(e){var t=1,r=e(Ey(t),Ty(t));return r.constant=function(i){return arguments.length?e(Ey(t=+i),Ty(t)):t},linearish(r)}function TT(){var e=ET(transformer());return e.copy=function(){return copy(e,TT()).constant(e.constant())},initRange.apply(e,arguments)}function Ay(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function AT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function ST(e){return e<0?-e*e:e*e}function wT(e){var t=e(Ou,Ou),r=1;function i(){return r===1?e(Ou,Ou):r===.5?e(AT,ST):e(Ay(r),Ay(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,i()):r},Sm(t)}function __(){var e=wT(m_());return e.copy=function(){return $v(e,__()).exponent(e.exponent())},Gf.apply(e,arguments),e}function S4(){return __.apply(null,arguments).exponent(.5)}function Sy(){var e=[],t=[],r=[],i;function a(){var f=0,m=Math.max(1,t.length);for(r=new Array(m-1);++f<m;)r[f-1]=V2(e,f/m);return u}function u(f){return isNaN(f=+f)?i:t[Xv(r,f)]}return u.invertExtent=function(f){var m=t.indexOf(f);return m<0?[NaN,NaN]:[m>0?r[m-1]:e[0],m<r.length?r[m]:e[e.length-1]]},u.domain=function(f){if(!arguments.length)return e.slice();e=[];for(var m=0,_=f.length,b;m<_;++m)b=f[m],b!=null&&!isNaN(b=+b)&&e.push(b);return e.sort(o_),a()},u.range=function(f){return arguments.length?(t=Np.call(f),a()):t.slice()},u.unknown=function(f){return arguments.length?(i=f,u):i},u.quantiles=function(){return r.slice()},u.copy=function(){return Sy().domain(e).range(t).unknown(i)},Gf.apply(u,arguments)}function wy(){var e=0,t=1,r=1,i=[.5],a=[0,1],u;function f(_){return _<=_?a[Xv(i,_,0,r)]:u}function m(){var _=-1;for(i=new Array(r);++_<r;)i[_]=((_+1)*t-(_-r)*e)/(r+1);return f}return f.domain=function(_){return arguments.length?(e=+_[0],t=+_[1],m()):[e,t]},f.range=function(_){return arguments.length?(r=(a=Np.call(_)).length-1,m()):a.slice()},f.invertExtent=function(_){var b=a.indexOf(_);return b<0?[NaN,NaN]:b<1?[e,i[0]]:b>=r?[i[r-1],t]:[i[b-1],i[b]]},f.unknown=function(_){return arguments.length&&(u=_),f},f.thresholds=function(){return i.slice()},f.copy=function(){return wy().domain([e,t]).range(a).unknown(u)},Gf.apply(Sm(f),arguments)}function Cy(){var e=[.5],t=[0,1],r,i=1;function a(u){return u<=u?t[Xv(e,u,0,i)]:r}return a.domain=function(u){return arguments.length?(e=Np.call(u),i=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(u){return arguments.length?(t=Np.call(u),i=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(u){var f=t.indexOf(u);return[e[f-1],e[f]]},a.unknown=function(u){return arguments.length?(r=u,a):r},a.copy=function(){return Cy().domain(e).range(t).unknown(r)},Gf.apply(a,arguments)}var y_=new Date,x_=new Date;function Ku(e,t,r,i){function a(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return a.floor=function(u){return e(u=new Date(+u)),u},a.ceil=function(u){return e(u=new Date(u-1)),t(u,1),e(u),u},a.round=function(u){var f=a(u),m=a.ceil(u);return u-f<m-u?f:m},a.offset=function(u,f){return t(u=new Date(+u),f==null?1:Math.floor(f)),u},a.range=function(u,f,m){var _=[],b;if(u=a.ceil(u),m=m==null?1:Math.floor(m),!(u<f)||!(m>0))return _;do _.push(b=new Date(+u)),t(u,m),e(u);while(b<u&&u<f);return _},a.filter=function(u){return Ku(function(f){if(f>=f)for(;e(f),!u(f);)f.setTime(f-1)},function(f,m){if(f>=f)if(m<0)for(;++m<=0;)for(;t(f,-1),!u(f););else for(;--m>=0;)for(;t(f,1),!u(f););})},r&&(a.count=function(u,f){return y_.setTime(+u),x_.setTime(+f),e(y_),e(x_),Math.floor(r(y_,x_))},a.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?a.filter(i?function(f){return i(f)%u===0}:function(f){return a.count(0,f)%u===0}):a}),a}var b_=Ku(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});b_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ku(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};var Cd=b_,w4=b_.range,Ry=Ku(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),CT=Ry,C4=Ry.range,tg=1e3,wm=6e4,Iy=36e5,My=864e5,Oy=6048e5;function Up(e){return Ku(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*wm)/Oy})}var E_=Up(0),rg=Up(1),RT=Up(2),IT=Up(3),Rd=Up(4),MT=Up(5),OT=Up(6),R4=E_.range,I4=rg.range,M4=RT.range,O4=IT.range,P4=Rd.range,L4=MT.range,D4=OT.range,Py=Ku(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*wm)/My},function(e){return e.getDate()-1}),T_=Py,B4=Py.range,Ly=Ku(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tg-e.getMinutes()*wm)},function(e,t){e.setTime(+e+t*Iy)},function(e,t){return(t-e)/Iy},function(e){return e.getHours()}),PT=Ly,F4=Ly.range,Dy=Ku(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tg)},function(e,t){e.setTime(+e+t*wm)},function(e,t){return(t-e)/wm},function(e){return e.getMinutes()}),LT=Dy,N4=Dy.range,By=Ku(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*tg)},function(e,t){return(t-e)/tg},function(e){return e.getUTCSeconds()}),DT=By,U4=By.range,ng=Ku(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});ng.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Ku(function(t){t.setTime(Math.floor(t/e)*e)},function(t,r){t.setTime(+t+r*e)},function(t,r){return(r-t)/e}):ng};var BT=ng,k4=ng.range;function kp(e){return Ku(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/Oy})}var Fy=kp(0),ig=kp(1),FT=kp(2),NT=kp(3),Id=kp(4),UT=kp(5),kT=kp(6),z4=Fy.range,V4=ig.range,Z4=FT.range,j4=NT.range,H4=Id.range,X4=UT.range,W4=kT.range,Ny=Ku(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/My},function(e){return e.getUTCDate()-1}),Uy=Ny,G4=Ny.range,A_=Ku(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});A_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Ku(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};var Cm=A_,Y4=A_.range;function S_(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function w_(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Rm(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function zT(e){var t=e.dateTime,r=e.date,i=e.time,a=e.periods,u=e.days,f=e.shortDays,m=e.months,_=e.shortMonths,b=Im(a),A=Mm(a),C=Im(u),R=Mm(u),U=Im(f),X=Mm(f),ee=Im(m),xe=Mm(m),ke=Im(_),Ne=Mm(_),it={a:tp,A:rp,b:Hl,B:fv,c:null,d:Hy,e:Hy,f:lA,g:yA,G:bA,H:aA,I:sA,j:uA,L:Xy,m:cA,M:hA,p:r4,q:n4,Q:$y,s:Qy,S:fA,u:pA,U:dA,V:mA,w:vA,W:gA,x:null,X:null,y:_A,Y:xA,Z:EA,"%":Ky},gt={a:i4,A:o4,b:a4,B:s4,c:null,d:Gy,e:Gy,f:wA,g:FA,G:UA,H:TA,I:AA,j:SA,L:Yy,m:CA,M:RA,p:u4,q:l4,Q:$y,s:Qy,S:IA,u:MA,U:OA,V:PA,w:LA,W:DA,x:null,X:null,y:BA,Y:NA,Z:kA,"%":Ky},rr={a:fi,A:An,b:ui,B:Xi,c:ou,d:Zy,e:Zy,f:rA,g:Vy,G:zy,H:jy,I:jy,j:QT,L:tA,m:$T,M:JT,p:Tn,q:KT,Q:iA,s:oA,S:eA,u:XT,U:WT,V:GT,w:HT,W:YT,x:Lu,X:bl,y:Vy,Y:zy,Z:qT,"%":nA};it.x=Kt(r,it),it.X=Kt(i,it),it.c=Kt(t,it),gt.x=Kt(r,gt),gt.X=Kt(i,gt),gt.c=Kt(t,gt);function Kt(Hn,so){return function(Ro){var sn=[],El=-1,Ta=0,Xl=Hn.length,Wl,Gp,Vb;for(Ro instanceof Date||(Ro=new Date(+Ro));++El<Xl;)Hn.charCodeAt(El)===37&&(sn.push(Hn.slice(Ta,El)),(Gp=ky[Wl=Hn.charAt(++El)])!=null?Wl=Hn.charAt(++El):Gp=Wl==="e"?" ":"0",(Vb=so[Wl])&&(Wl=Vb(Ro,Gp)),sn.push(Wl),Ta=El+1);return sn.push(Hn.slice(Ta,El)),sn.join("")}}function Rt(Hn,so){return function(Ro){var sn=Rm(1900,void 0,1),El=tr(sn,Hn,Ro+="",0),Ta,Xl;if(El!=Ro.length)return null;if("Q"in sn)return new Date(sn.Q);if("s"in sn)return new Date(sn.s*1e3+("L"in sn?sn.L:0));if(so&&!("Z"in sn)&&(sn.Z=0),"p"in sn&&(sn.H=sn.H%12+sn.p*12),sn.m===void 0&&(sn.m="q"in sn?sn.q:0),"V"in sn){if(sn.V<1||sn.V>53)return null;"w"in sn||(sn.w=1),"Z"in sn?(Ta=w_(Rm(sn.y,0,1)),Xl=Ta.getUTCDay(),Ta=Xl>4||Xl===0?ig.ceil(Ta):ig(Ta),Ta=Uy.offset(Ta,(sn.V-1)*7),sn.y=Ta.getUTCFullYear(),sn.m=Ta.getUTCMonth(),sn.d=Ta.getUTCDate()+(sn.w+6)%7):(Ta=S_(Rm(sn.y,0,1)),Xl=Ta.getDay(),Ta=Xl>4||Xl===0?rg.ceil(Ta):rg(Ta),Ta=T_.offset(Ta,(sn.V-1)*7),sn.y=Ta.getFullYear(),sn.m=Ta.getMonth(),sn.d=Ta.getDate()+(sn.w+6)%7)}else("W"in sn||"U"in sn)&&("w"in sn||(sn.w="u"in sn?sn.u%7:"W"in sn?1:0),Xl="Z"in sn?w_(Rm(sn.y,0,1)).getUTCDay():S_(Rm(sn.y,0,1)).getDay(),sn.m=0,sn.d="W"in sn?(sn.w+6)%7+sn.W*7-(Xl+5)%7:sn.w+sn.U*7-(Xl+6)%7);return"Z"in sn?(sn.H+=sn.Z/100|0,sn.M+=sn.Z%100,w_(sn)):S_(sn)}}function tr(Hn,so,Ro,sn){for(var El=0,Ta=so.length,Xl=Ro.length,Wl,Gp;El<Ta;){if(sn>=Xl)return-1;if(Wl=so.charCodeAt(El++),Wl===37){if(Wl=so.charAt(El++),Gp=rr[Wl in ky?so.charAt(El++):Wl],!Gp||(sn=Gp(Hn,Ro,sn))<0)return-1}else if(Wl!=Ro.charCodeAt(sn++))return-1}return sn}function Tn(Hn,so,Ro){var sn=b.exec(so.slice(Ro));return sn?(Hn.p=A[sn[0].toLowerCase()],Ro+sn[0].length):-1}function fi(Hn,so,Ro){var sn=U.exec(so.slice(Ro));return sn?(Hn.w=X[sn[0].toLowerCase()],Ro+sn[0].length):-1}function An(Hn,so,Ro){var sn=C.exec(so.slice(Ro));return sn?(Hn.w=R[sn[0].toLowerCase()],Ro+sn[0].length):-1}function ui(Hn,so,Ro){var sn=ke.exec(so.slice(Ro));return sn?(Hn.m=Ne[sn[0].toLowerCase()],Ro+sn[0].length):-1}function Xi(Hn,so,Ro){var sn=ee.exec(so.slice(Ro));return sn?(Hn.m=xe[sn[0].toLowerCase()],Ro+sn[0].length):-1}function ou(Hn,so,Ro){return tr(Hn,t,so,Ro)}function Lu(Hn,so,Ro){return tr(Hn,r,so,Ro)}function bl(Hn,so,Ro){return tr(Hn,i,so,Ro)}function tp(Hn){return f[Hn.getDay()]}function rp(Hn){return u[Hn.getDay()]}function Hl(Hn){return _[Hn.getMonth()]}function fv(Hn){return m[Hn.getMonth()]}function r4(Hn){return a[+(Hn.getHours()>=12)]}function n4(Hn){return 1+~~(Hn.getMonth()/3)}function i4(Hn){return f[Hn.getUTCDay()]}function o4(Hn){return u[Hn.getUTCDay()]}function a4(Hn){return _[Hn.getUTCMonth()]}function s4(Hn){return m[Hn.getUTCMonth()]}function u4(Hn){return a[+(Hn.getUTCHours()>=12)]}function l4(Hn){return 1+~~(Hn.getUTCMonth()/3)}return{format:function(Hn){var so=Kt(Hn+="",it);return so.toString=function(){return Hn},so},parse:function(Hn){var so=Rt(Hn+="",!1);return so.toString=function(){return Hn},so},utcFormat:function(Hn){var so=Kt(Hn+="",gt);return so.toString=function(){return Hn},so},utcParse:function(Hn){var so=Rt(Hn+="",!0);return so.toString=function(){return Hn},so}}}var ky={"-":"",_:" ",0:"0"},iu=/^\s*\d+/,VT=/^%/,ZT=/[\\^$*+?|[\]().{}]/g;function wo(e,t,r){var i=e<0?"-":"",a=(i?-e:e)+"",u=a.length;return i+(u<r?new Array(r-u+1).join(t)+a:a)}function jT(e){return e.replace(ZT,"\\$&")}function Im(e){return new RegExp("^(?:"+e.map(jT).join("|")+")","i")}function Mm(e){for(var t={},r=-1,i=e.length;++r<i;)t[e[r].toLowerCase()]=r;return t}function HT(e,t,r){var i=iu.exec(t.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function XT(e,t,r){var i=iu.exec(t.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function WT(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function GT(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function YT(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function zy(e,t,r){var i=iu.exec(t.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function Vy(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function qT(e,t,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function KT(e,t,r){var i=iu.exec(t.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function $T(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function Zy(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function QT(e,t,r){var i=iu.exec(t.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function jy(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function JT(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function eA(e,t,r){var i=iu.exec(t.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function tA(e,t,r){var i=iu.exec(t.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function rA(e,t,r){var i=iu.exec(t.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function nA(e,t,r){var i=VT.exec(t.slice(r,r+1));return i?r+i[0].length:-1}function iA(e,t,r){var i=iu.exec(t.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function oA(e,t,r){var i=iu.exec(t.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function Hy(e,t){return wo(e.getDate(),t,2)}function aA(e,t){return wo(e.getHours(),t,2)}function sA(e,t){return wo(e.getHours()%12||12,t,2)}function uA(e,t){return wo(1+T_.count(Cd(e),e),t,3)}function Xy(e,t){return wo(e.getMilliseconds(),t,3)}function lA(e,t){return Xy(e,t)+"000"}function cA(e,t){return wo(e.getMonth()+1,t,2)}function hA(e,t){return wo(e.getMinutes(),t,2)}function fA(e,t){return wo(e.getSeconds(),t,2)}function pA(e){var t=e.getDay();return t===0?7:t}function dA(e,t){return wo(E_.count(Cd(e)-1,e),t,2)}function Wy(e){var t=e.getDay();return t>=4||t===0?Rd(e):Rd.ceil(e)}function mA(e,t){return e=Wy(e),wo(Rd.count(Cd(e),e)+(Cd(e).getDay()===4),t,2)}function vA(e){return e.getDay()}function gA(e,t){return wo(rg.count(Cd(e)-1,e),t,2)}function _A(e,t){return wo(e.getFullYear()%100,t,2)}function yA(e,t){return e=Wy(e),wo(e.getFullYear()%100,t,2)}function xA(e,t){return wo(e.getFullYear()%1e4,t,4)}function bA(e,t){var r=e.getDay();return e=r>=4||r===0?Rd(e):Rd.ceil(e),wo(e.getFullYear()%1e4,t,4)}function EA(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+wo(t/60|0,"0",2)+wo(t%60,"0",2)}function Gy(e,t){return wo(e.getUTCDate(),t,2)}function TA(e,t){return wo(e.getUTCHours(),t,2)}function AA(e,t){return wo(e.getUTCHours()%12||12,t,2)}function SA(e,t){return wo(1+Uy.count(Cm(e),e),t,3)}function Yy(e,t){return wo(e.getUTCMilliseconds(),t,3)}function wA(e,t){return Yy(e,t)+"000"}function CA(e,t){return wo(e.getUTCMonth()+1,t,2)}function RA(e,t){return wo(e.getUTCMinutes(),t,2)}function IA(e,t){return wo(e.getUTCSeconds(),t,2)}function MA(e){var t=e.getUTCDay();return t===0?7:t}function OA(e,t){return wo(Fy.count(Cm(e)-1,e),t,2)}function qy(e){var t=e.getUTCDay();return t>=4||t===0?Id(e):Id.ceil(e)}function PA(e,t){return e=qy(e),wo(Id.count(Cm(e),e)+(Cm(e).getUTCDay()===4),t,2)}function LA(e){return e.getUTCDay()}function DA(e,t){return wo(ig.count(Cm(e)-1,e),t,2)}function BA(e,t){return wo(e.getUTCFullYear()%100,t,2)}function FA(e,t){return e=qy(e),wo(e.getUTCFullYear()%100,t,2)}function NA(e,t){return wo(e.getUTCFullYear()%1e4,t,4)}function UA(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Id(e):Id.ceil(e),wo(e.getUTCFullYear()%1e4,t,4)}function kA(){return"+0000"}function Ky(){return"%"}function $y(e){return+e}function Qy(e){return Math.floor(+e/1e3)}var Md,Jy,zA,VA,ZA;jA({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function jA(e){return Md=zT(e),Jy=Md.format,zA=Md.parse,VA=Md.utcFormat,ZA=Md.utcParse,Md}var Om=1e3,Pm=Om*60,Lm=Pm*60,Dm=Lm*24,HA=Dm*7,e1=Dm*30,C_=Dm*365;function XA(e){return new Date(e)}function WA(e){return e instanceof Date?+e:+new Date(+e)}function t1(e,t,r,i,a,u,f,m,_){var b=sy(Ou,Ou),A=b.invert,C=b.domain,R=_(".%L"),U=_(":%S"),X=_("%I:%M"),ee=_("%I %p"),xe=_("%a %d"),ke=_("%b %d"),Ne=_("%B"),it=_("%Y"),gt=[[f,1,Om],[f,5,5*Om],[f,15,15*Om],[f,30,30*Om],[u,1,Pm],[u,5,5*Pm],[u,15,15*Pm],[u,30,30*Pm],[a,1,Lm],[a,3,3*Lm],[a,6,6*Lm],[a,12,12*Lm],[i,1,Dm],[i,2,2*Dm],[r,1,HA],[t,1,e1],[t,3,3*e1],[e,1,C_]];function rr(Rt){return(f(Rt)<Rt?R:u(Rt)<Rt?U:a(Rt)<Rt?X:i(Rt)<Rt?ee:t(Rt)<Rt?r(Rt)<Rt?xe:ke:e(Rt)<Rt?Ne:it)(Rt)}function Kt(Rt,tr,Tn,fi){if(Rt==null&&(Rt=10),typeof Rt=="number"){var An=Math.abs(Tn-tr)/Rt,ui=X0(function(Xi){return Xi[2]}).right(gt,An);ui===gt.length?(fi=l_(tr/C_,Tn/C_,Rt),Rt=e):ui?(ui=gt[An/gt[ui-1][2]<gt[ui][2]/An?ui-1:ui],fi=ui[1],Rt=ui[0]):(fi=Math.max(l_(tr,Tn,Rt),1),Rt=m)}return fi==null?Rt:Rt.every(fi)}return b.invert=function(Rt){return new Date(A(Rt))},b.domain=function(Rt){return arguments.length?C(J0.call(Rt,WA)):C().map(XA)},b.ticks=function(Rt,tr){var Tn=C(),fi=Tn[0],An=Tn[Tn.length-1],ui=An<fi,Xi;return ui&&(Xi=fi,fi=An,An=Xi),Xi=Kt(Rt,fi,An,tr),Xi=Xi?Xi.range(fi,An+1):[],ui?Xi.reverse():Xi},b.tickFormat=function(Rt,tr){return tr==null?rr:_(tr)},b.nice=function(Rt,tr){var Tn=C();return(Rt=Kt(Rt,Tn[0],Tn[Tn.length-1],tr))?C(gy(Tn,Rt)):b},b.copy=function(){return $v(b,t1(e,t,r,i,a,u,f,m,_))},b}function GA(){return Gf.apply(t1(Cd,CT,E_,T_,PT,LT,DT,BT,Jy).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function q4(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function og(){var e=0,t=1,r,i,a,u,f=Ou,m=!1,_;function b(A){return isNaN(A=+A)?_:f(a===0?.5:(A=(u(A)-r)*a,m?Math.max(0,Math.min(1,A)):A))}return b.domain=function(A){return arguments.length?(r=u(e=+A[0]),i=u(t=+A[1]),a=r===i?0:1/(i-r),b):[e,t]},b.clamp=function(A){return arguments.length?(m=!!A,b):m},b.interpolator=function(A){return arguments.length?(f=A,b):f},b.unknown=function(A){return arguments.length?(_=A,b):_},function(A){return u=A,r=A(e),i=A(t),a=r===i?0:1/(i-r),b}}function Bm(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function r1(){var e=Sm(og()(Ou));return e.copy=function(){return Bm(e,r1())},ey.apply(e,arguments)}function YA(){var e=loggish(og()).domain([1,10]);return e.copy=function(){return Bm(e,YA()).base(e.base())},initInterpolator.apply(e,arguments)}function qA(){var e=symlogish(og());return e.copy=function(){return Bm(e,qA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function n1(){var e=powish(og());return e.copy=function(){return Bm(e,n1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function K4(){return n1.apply(null,arguments).exponent(.5)}function KA(){var e=[],t=identity;function r(i){if(!isNaN(i=+i))return t((bisect(e,i)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var a=0,u=i.length,f;a<u;++a)f=i[a],f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(ascending),r},r.interpolator=function(i){return arguments.length?(t=i,r):t},r.copy=function(){return KA(t).domain(e)},initInterpolator.apply(r,arguments)}function ag(){var e=0,t=.5,r=1,i,a,u,f,m,_=Ou,b,A=!1,C;function R(U){return isNaN(U=+U)?C:(U=.5+((U=+b(U))-a)*(U<a?f:m),_(A?Math.max(0,Math.min(1,U)):U))}return R.domain=function(U){return arguments.length?(i=b(e=+U[0]),a=b(t=+U[1]),u=b(r=+U[2]),f=i===a?0:.5/(a-i),m=a===u?0:.5/(u-a),R):[e,t,r]},R.clamp=function(U){return arguments.length?(A=!!U,R):A},R.interpolator=function(U){return arguments.length?(_=U,R):_},R.unknown=function(U){return arguments.length?(C=U,R):C},function(U){return b=U,i=U(e),a=U(t),u=U(r),f=i===a?0:.5/(a-i),m=a===u?0:.5/(u-a),R}}function i1(){var e=Sm(ag()(Ou));return e.copy=function(){return Bm(e,i1())},ey.apply(e,arguments)}function $A(){var e=loggish(ag()).domain([.1,1,10]);return e.copy=function(){return copy(e,$A()).base(e.base())},initInterpolator.apply(e,arguments)}function QA(){var e=symlogish(ag());return e.copy=function(){return copy(e,QA()).constant(e.constant())},initInterpolator.apply(e,arguments)}function o1(){var e=powish(ag());return e.copy=function(){return copy(e,o1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function $4(){return o1.apply(null,arguments).exponent(.5)}function a1(e){let t,r=[];function i(a){return a==null?t:a}return i.invert=i,i.domain=i.range=a=>a?(r=a,a):r,i.unknown=a=>a?(t=a,a):t,i.copy=()=>a1(e).unknown(t),i}const{isNil:R_,isString:JA,uniq:eS}=Kn,tS=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,rS={[Ht.LINEAR]:vy,[Ht.POWER]:__,[Ht.LOG]:by,[Ht.IDENTITY]:a1,[Ht.SEQUENTIAL]:r1,[Ht.TIME]:GA,[Ht.QUANTILE]:Sy,[Ht.QUANTIZE]:wy,[Ht.THRESHOLD]:Cy,[Ht.CAT]:qv,[Ht.DIVERGING]:i1};class nS{constructor(){(0,D.Z)(this,"scaleOptions",{})}apply(t,{styleAttributeService:r}){var i=this;t.hooks.init.tapPromise("FeatureScalePlugin",(0,Xt.Z)(function*(){var a;t.log(ue.ScaleInitStart,Wt.INIT),i.scaleOptions=t.getScaleOptions();const u=r.getLayerStyleAttributes(),f=(a=t.getSource())===null||a===void 0?void 0:a.data.dataArray;Array.isArray(f)&&f.length===0||(i.caculateScalesForAttributes(u||[],f),t.log(ue.ScaleInitEnd,Wt.INIT))})),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var a=(0,Xt.Z)(function*(u){if(!u)return u;t.log(ue.ScaleInitStart,Wt.UPDATE),i.scaleOptions=t.getScaleOptions();const f=r.getLayerStyleAttributes(),m=t.getSource().data.dataArray;return Array.isArray(m)&&m.length===0||(i.caculateScalesForAttributes(f||[],m),t.log(ue.ScaleInitEnd,Wt.UPDATE),t.layerModelNeedUpdate=!0),!0});return function(u){return a.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",()=>{if(t.layerModelNeedUpdate)return;this.scaleOptions=t.getScaleOptions();const a=r.getLayerStyleAttributes(),u=t.getSource().data.dataArray;if(!(Array.isArray(u)&&u.length===0)&&a){const f=a.filter(m=>m.needRescale);f.length&&this.caculateScalesForAttributes(f,u)}})}isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}caculateScalesForAttributes(t,r){t.forEach(i=>{if(i.scale){const a=i.scale,u=i.scale.field;a.names=this.parseFields(R_(u)?[]:u);const f=[];a.names.forEach(m=>{var _;f.push(this.createScale(m,i.name,(_=i.scale)===null||_===void 0?void 0:_.values,r))}),f.some(m=>m.type===cn.VARIABLE)?(a.type=cn.VARIABLE,f.forEach(m=>{if(!a.callback&&a.values!=="text"){var _;switch((_=m.option)===null||_===void 0?void 0:_.type){case Ht.LOG:case Ht.LINEAR:case Ht.POWER:if(a.values&&a.values.length>2){const A=m.scale.ticks(a.values.length);m.scale.domain(A)}a.values?m.scale.range(a.values):m.scale.range(m.option.domain);break;case Ht.QUANTILE:case Ht.QUANTIZE:case Ht.THRESHOLD:m.scale.range(a.values);break;case Ht.IDENTITY:break;case Ht.CAT:a.values?m.scale.range(a.values):m.scale.range(m.option.domain);break;case Ht.DIVERGING:case Ht.SEQUENTIAL:m.scale.interpolator(N2(a.values));break}}if(a.values==="text"){var b;m.scale.range((b=m.option)===null||b===void 0?void 0:b.domain)}})):(a.type=cn.CONSTANT,a.defaultValues=f.map((m,_)=>m.scale(a.names[_]))),a.scalers=f.map(m=>({field:m.field,func:m.scale,option:m.option})),i.needRescale=!1}})}parseFields(t){return Array.isArray(t)?t:JA(t)?t.split("*"):[t]}createScale(t,r,i,a){var u,f;const m=this.scaleOptions[r]&&((u=this.scaleOptions[r])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[r]:this.scaleOptions[t],_={field:t,scale:void 0,type:cn.VARIABLE,option:m};if(!a||!a.length)return m&&m.type?_.scale=this.createDefaultScale(m):(_.scale=qv([t]),_.type=cn.CONSTANT),_;const b=(f=a.find(A=>!R_(A[t])))===null||f===void 0?void 0:f[t];if(this.isNumber(t)||R_(b)&&!m)_.scale=qv([t]),_.type=cn.CONSTANT;else{let A=m&&m.type||this.getDefaultType(b);i==="text"&&(A=Ht.CAT),i===void 0&&(A=Ht.IDENTITY);const C=this.createScaleConfig(A,t,m,a);_.scale=this.createDefaultScale(C),_.option=C}return _}getDefaultType(t){let r=Ht.LINEAR;return typeof t=="string"&&(r=tS.test(t)?Ht.TIME:Ht.CAT),r}createScaleConfig(t,r,i,a){const u=(0,_e.Z)((0,_e.Z)({},i),{},{type:t});if(u!=null&&u.domain)return u;let f=[];if(t===Ht.QUANTILE){const m=new Map;a==null||a.forEach(_=>{m.set(_._id,_[r])}),f=Array.from(m.values())}else f=(a==null?void 0:a.map(m=>m[r]))||[];if(t===Ht.CAT||t===Ht.IDENTITY)u.domain=eS(f);else if(t===Ht.QUANTILE)u.domain=f;else if(t===Ht.DIVERGING){const m=k0(f),_=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(m[0]+m[1])/2;u.domain=[m[0],_,m[1]]}else u.domain=k0(f);return u}createDefaultScale({type:t,domain:r,unknown:i,clamp:a,nice:u}){const f=rS[t]();return r&&f.domain&&f.domain(r),i&&f.unknown(i),a!==void 0&&f.clamp&&f.clamp(a),u!==void 0&&f.nice&&f.nice(u),f}}class iS{apply(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",()=>{t.animateStatus&&t.models.forEach(i=>{i.addUniforms((0,_e.Z)({},t.layerModel.getAnimateUniforms()))})})}}class oS{apply(t){t.hooks.afterInit.tap("LayerMaskPlugin",()=>{const{maskLayers:r,enableMask:i}=t.getLayerConfig();!t.tileLayer&&r&&r.length>0&&t.updateLayerConfig({mask:i})})}}class aS{build(t){return(0,Xt.Z)(function*(){t.prepareBuildModel(),yield t.buildModels()})()}initLayerModel(t){var r=this;return(0,Xt.Z)(function*(){yield r.build(t),t.styleNeedUpdate=!1})()}prepareLayerModel(t){var r=this;return(0,Xt.Z)(function*(){yield r.build(t),t.styleNeedUpdate=!1})()}apply(t){var r=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,Xt.Z)(function*(){if(t.getSource().isTile){t.prepareBuildModel();return}t.log(ue.BuildModelStart,Wt.INIT),yield r.initLayerModel(t),t.log(ue.BuildModelEnd,Wt.INIT)})),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,Xt.Z)(function*(a){return!a||t.getSource().isTile?!1:(t.log(ue.BuildModelStart,Wt.UPDATE),yield r.prepareLayerModel(t),t.log(ue.BuildModelEnd,Wt.UPDATE),!0)});return function(a){return i.apply(this,arguments)}}())}}class sS{apply(t){t.hooks.afterInit.tap("LayerStylePlugin",()=>{const{autoFit:r,fitBoundsOptions:i}=t.getLayerConfig();r&&t.fitBounds(i),t.styleNeedUpdate=!1})}}const uS=["type"],s1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},lS={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},cS={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},hS={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function fS(e){const t={u_DirectionalLights:new Array(3).fill((0,_e.Z)({},cS)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,_e.Z)({},hS)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[lS]),e.forEach(r=>{let{type:i="directional"}=r,a=(0,Le.Z)(r,uS);const u=s1[i].lights,f=s1[i].num,m=t[f];t[u][m]=(0,_e.Z)((0,_e.Z)({},t[u][m]),a),t[f]++}),t}class pS{apply(t){t.hooks.beforeRender.tap("LightingPlugin",()=>{const{enableLighting:r}=t.getLayerConfig();r&&t.models.forEach(i=>i.addUniforms((0,_e.Z)({},fS())))})}}function u1(e){return e.map(t=>(typeof t=="string"&&(t=[t,{}]),t))}function l1(e,t,r,i){const a=e.multiPassRenderer;return a.add(i("render")),u1(t).forEach(u=>{const[f,m]=u;a.add(r(f),m)}),a.add(r("copy")),a}class dS{constructor(){(0,D.Z)(this,"enabled",void 0)}apply(t,{rendererService:r,postProcessingPassFactory:i,normalPassFactory:a}){t.hooks.init.tapPromise("MultiPassRendererPlugin",()=>{const{enableMultiPassRenderer:u,passes:f=[]}=t.getLayerConfig();this.enabled=!!u&&t.getLayerConfig().enableMultiPassRenderer!==!1,this.enabled&&(t.multiPassRenderer=l1(t,f,i,a),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",()=>{if(this.enabled){const{width:u,height:f}=r.getViewportSize();t.multiPassRenderer.resize(u,f)}})}}const Yf={POSITION:0,POSITION_64LOW:1,COLOR:2,PICKING_COLOR:3,STROKE:4,OPACITY:5,OFFSETS:6,ROTATION:7,MAX:8};function mS(e){switch(e){case"rotation":return{name:"Rotation",type:Ot.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Yf.ROTATION,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{rotation:r=0}=t;return Array.isArray(r)?[r[0]]:[r]}}};case"stroke":return{name:"stroke",type:Ot.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Yf.STROKE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:4,update:t=>{const{stroke:r=[1,1,1,1]}=t;return r}}};case"opacity":return{name:"opacity",type:Ot.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Yf.OPACITY,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{opacity:r=1}=t;return[r]}}};case"offsets":return{name:"offsets",type:Ot.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Yf.OFFSETS,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const{offsets:r}=t;return r}}};default:return}}const{isNumber:vS}=Kn,Od={NONE:0,ENCODE:1,HIGHLIGHT:2};class gS{constructor(){(0,D.Z)(this,"pickingUniformMap",void 0)}pickOption2Array(){const t=[];return this.pickingUniformMap.forEach(r=>{vS(r)?t.push(r):t.push(...r)}),t}updatePickOption(t,r){Object.keys(t).forEach(f=>{this.pickingUniformMap.set(f,t[f])});const i=r.getLayerConfig().pickingBuffer||0,a=Number(r.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",i),this.pickingUniformMap.set("u_shaderPick",a),r.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(t,{styleAttributeService:r}){this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();r.registerStyleAttribute({name:"pickingColor",type:Ot.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Yf.PICKING_COLOR,buffer:{data:[],type:O.FLOAT},size:3,update:a=>{const{id:u}=a;return i?Ns(u):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();i&&t.isVisible()&&(this.updatePickOption({u_PickingStage:Od.ENCODE},t),t.models.forEach(a=>a.addUniforms({u_PickingStage:Od.ENCODE})))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();i&&t.isVisible()&&(this.updatePickOption({u_PickingStage:Od.HIGHLIGHT},t),t.models.forEach(a=>a.addUniforms({u_PickingStage:Od.HIGHLIGHT})))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",i=>{const{highlightColor:a,activeMix:u=0}=t.getLayerConfig(),f=typeof a=="string"?ti(a):a||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Es(new Uint8Array(i))});const m={u_PickingStage:Od.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:f.map(_=>_*255),u_activeMix:u};this.updatePickOption(m,t),t.models.forEach(_=>_.addUniforms(m))}),t.hooks.beforeSelect.tap("PixelPickingPlugin",i=>{const{selectColor:a,selectMix:u=0}=t.getLayerConfig(),f=typeof a=="string"?ti(a):a||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Es(new Uint8Array(i))});const m={u_PickingStage:Od.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:f.map(_=>_*255),u_activeMix:u,u_CurrentSelectedId:i,u_SelectColor:f.map(_=>_*255)};this.updatePickOption(m,t),t.models.forEach(_=>_.addUniforms(m))})}}const _S=["mvt","geojsonvt","testTile"];function yS(e){const t=e.getSource();return _S.includes(t.parser.type)}class xS{apply(t,{styleAttributeService:r}){t.hooks.init.tapPromise("RegisterStyleAttributePlugin",()=>{yS(t)||this.registerBuiltinAttributes(r,t)})}registerBuiltinAttributes(t,r){if(r.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t)}registerPositionAttribute(t){t.registerStyleAttribute({name:"position",type:Ot.Attribute,descriptor:{name:"a_Position",shaderLocation:Yf.POSITION,buffer:{data:[],type:O.FLOAT},size:3,update:(r,i,a)=>a.length===2?[a[0],a[1],0]:[a[0],a[1],a[2]]}})}registerColorAttribute(t){t.registerStyleAttribute({name:"color",type:Ot.Attribute,descriptor:{name:"a_Color",shaderLocation:Yf.COLOR,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:4,update:r=>{const{color:i}=r;return!i||!i.length?[1,1,1,1]:i}}})}}class bS{constructor(){(0,D.Z)(this,"cameraService",void 0),(0,D.Z)(this,"coordinateSystemService",void 0),(0,D.Z)(this,"rendererService",void 0),(0,D.Z)(this,"mapService",void 0),(0,D.Z)(this,"layerService",void 0)}apply(t,{rendererService:r,mapService:i,layerService:a,coordinateSystemService:u,cameraService:f}){this.rendererService=r,this.mapService=i,this.layerService=a,this.coordinateSystemService=u,this.cameraService=f;let m;this.rendererService.uniformBuffers[0]||(m=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0,label:"renderUniformBuffer"}),this.rendererService.uniformBuffers[0]=m),t.hooks.beforeRender.tap("ShaderUniformPlugin",()=>{const _=t.getLayerConfig().tileOrigin;this.coordinateSystemService.refresh(_);const{width:b,height:A}=this.rendererService.getViewportSize(),{data:C,uniforms:R}=this.generateUBO(b,A);this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]&&this.rendererService.uniformBuffers[0].subData({offset:0,data:C}),this.rendererService.queryVerdorInfo()==="WebGL1"&&t.models.forEach(X=>{X.addUniforms((0,_e.Z)((0,_e.Z)({},R),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}generateUBO(t,r){const i=this.cameraService.getProjectionMatrix(),a=this.cameraService.getViewMatrix(),u=this.cameraService.getViewProjectionMatrix(),f=this.cameraService.getModelMatrix(),m=this.coordinateSystemService.getViewportCenterProjection(),_=this.coordinateSystemService.getPixelsPerDegree(),b=this.cameraService.getZoom(),A=this.coordinateSystemService.getPixelsPerDegree2(),C=this.cameraService.getZoomScale(),R=this.coordinateSystemService.getPixelsPerMeter(),U=this.coordinateSystemService.getCoordinateSystem(),X=this.cameraService.getCameraPosition(),ee=window.devicePixelRatio,xe=this.coordinateSystemService.getViewportCenter(),ke=[t,r],Ne=this.cameraService.getFocalDistance();return{data:[...a,...i,...u,...f,...m,..._,b,...A,C,...R,U,...X,ee,...xe,...ke,Ne,0,0,0],uniforms:{[Ye.ProjectionMatrix]:i,[Ye.ViewMatrix]:a,[Ye.ViewProjectionMatrix]:u,[Ye.Zoom]:b,[Ye.ZoomScale]:C,[Ye.FocalDistance]:Ne,[Ye.CameraPosition]:X,[We.CoordinateSystem]:U,[We.ViewportCenter]:xe,[We.ViewportCenterProjection]:m,[We.PixelsPerDegree]:_,[We.PixelsPerDegree2]:A,[We.PixelsPerMeter]:R,u_ViewportSize:ke,u_ModelMatrix:f,u_DevicePixelRatio:ee}}}}class ES{apply(t){t.hooks.beforeRender.tap("UpdateModelPlugin",()=>{t.layerModel&&t.layerModel.needUpdate().then(r=>{r&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",()=>{t.layerModelNeedUpdate=!1})}}class TS{apply(t,{styleAttributeService:r}){t.hooks.init.tapPromise("UpdateStyleAttributePlugin",()=>{this.initStyleAttribute(t,{styleAttributeService:r})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",()=>{t.layerModelNeedUpdate||t.inited&&this.updateStyleAttribute(t,{styleAttributeService:r})})}updateStyleAttribute(t,{styleAttributeService:r}){const i=r.getLayerStyleAttributes()||[],a=r.getLayerStyleAttribute("filter");if(a&&a.needRegenerateVertices){t.layerModelNeedUpdate=!0,i.forEach(u=>u.needRegenerateVertices=!1);return}i.filter(u=>u.needRegenerateVertices).forEach(u=>{r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex,t),u.needRegenerateVertices=!1})}initStyleAttribute(t,{styleAttributeService:r}){(r.getLayerStyleAttributes()||[]).filter(a=>a.needRegenerateVertices).forEach(a=>{r.updateAttributeByFeatureRange(a.name,t.getEncodedData(),a.featureRange.startIndex,a.featureRange.endIndex),a.needRegenerateVertices=!1})}}function AS(){return[new O2,new xS,new nS,new M2,new sS,new oS,new TS,new ES,new dS,new bS,new iS,new pS,new gS,new aS]}const c1={[Et.additive]:{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE,srcAlpha:1,dstAlpha:1}},[Et.none]:{enable:!1},[Et.normal]:{enable:!0,func:{srcRGB:O.SRC_ALPHA,dstRGB:O.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[Et.subtractive]:{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE,srcAlpha:O.ZERO,dstAlpha:O.ONE_MINUS_SRC_COLOR},equation:{rgb:O.FUNC_SUBTRACT,alpha:O.FUNC_SUBTRACT}},[Et.max]:{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE},equation:{rgb:O.MAX_EXT}},[Et.min]:{enable:!0,func:{srcRGB:O.ONE,dstRGB:O.ONE},equation:{rgb:O.MIN_EXT}}};class SS{constructor(t){(0,D.Z)(this,"layer",void 0),this.layer=t}pickRender(t){const i=this.layer.getContainer().layerService,a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(t);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}pick(t,r){var i=this;return(0,Xt.Z)(function*(){const u=i.layer.getContainer().pickingService;return t.type==="RasterLayer"?i.pickRasterLayer(t,r):(i.pickRender(r),u.pickFromPickingFBO(t,r))})()}pickRasterLayer(t,r,i){const a=this.layer.getContainer(),u=a.pickingService,f=a.mapService,m=this.layer.getSource().extent,_=Rc(r.lngLat,m),b={x:r.x,y:r.y,type:r.type,lngLat:r.lngLat,target:r,rasterValue:null},A=i||t;if(_){const C=this.readRasterValue(t,m,f,r.x,r.y);return b.rasterValue=C,u.triggerHoverOnLayer(A,b),!0}else return b.type=r.type==="mousemove"?"mouseout":"un"+r.type,u.triggerHoverOnLayer(A,(0,_e.Z)((0,_e.Z)({},b),{},{type:"unpick"})),u.triggerHoverOnLayer(A,b),!1}readRasterValue(t,r,i,a,u){const f=t.getSource().data.dataArray[0],[m=0,_=0,b=10,A=-10]=r,C=i.lngLatToContainer([m,_]),R=i.lngLatToContainer([b,A]),U=R.x-C.x,X=C.y-R.y,ee=[(a-C.x)/U,(u-R.y)/X],xe=f.width||1,ke=f.height||1,Ne=Math.floor(ee[0]*xe),it=Math.floor(ee[1]*ke),gt=Math.max(0,it-1)*xe+Ne;return f.data[gt]}selectFeature(t){const r=this.layer,[i,a,u]=t;r.hooks.beforeSelect.call([i,a,u])}highlightPickedFeature(t){const[r,i,a]=t;this.layer.hooks.beforeHighlight.call([r,i,a])}getFeatureById(t){return this.layer.getSource().getFeatureById(t)}}class wS{constructor(t){(0,D.Z)(this,"layer",void 0),(0,D.Z)(this,"rendererService",void 0),(0,D.Z)(this,"colorTexture",void 0),(0,D.Z)(this,"key",void 0),this.layer=t;const r=this.layer.getContainer();this.rendererService=r.rendererService}getColorTexture(t,r){const i=this.getTextureKey(t,r);return this.key===i?this.colorTexture:(this.createColorTexture(t,r),this.key=i,this.colorTexture)}createColorTexture(t,r){const{createTexture2D:i}=this.rendererService,a=this.getColorRampBar(t,r),u=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1,unorm:!0});return this.colorTexture=u,u}setColorTexture(t,r,i){this.key=this.getTextureKey(r,i),this.colorTexture=t}destroy(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}getColorRampBar(t,r){switch(t.type){case"cat":return Du(t);case"quantize":return xc(t);case"custom":return Ts(t,r);case"linear":return bu(t,r);default:return au(t)}}getTextureKey(t,r){var i;return`${t.colors.join("_")}_${t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_")}_${t.type}_${r==null?void 0:r.join("_")}`}}const CS=["passes"],RS=["moduleName","vertexShader","fragmentShader","defines","inject","triangulation","styleOption","pickingEnabled"],{isEqual:I_,isFunction:h1,isNumber:f1,isObject:vu,isPlainObject:IS,isUndefined:MS}=Kn;let p1=0;class qf extends wa.EventEmitter{get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){var t;return(t=this.container)===null||t===void 0?void 0:t.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(t={}){super(),(0,D.Z)(this,"id",`${p1++}`),(0,D.Z)(this,"name",`${p1}`),(0,D.Z)(this,"parent",void 0),(0,D.Z)(this,"coordCenter",void 0),(0,D.Z)(this,"type",void 0),(0,D.Z)(this,"visible",!0),(0,D.Z)(this,"zIndex",0),(0,D.Z)(this,"minZoom",void 0),(0,D.Z)(this,"maxZoom",void 0),(0,D.Z)(this,"inited",!1),(0,D.Z)(this,"layerModelNeedUpdate",!1),(0,D.Z)(this,"pickedFeatureID",null),(0,D.Z)(this,"selectedFeatureID",null),(0,D.Z)(this,"styleNeedUpdate",!1),(0,D.Z)(this,"rendering",void 0),(0,D.Z)(this,"forceRender",!1),(0,D.Z)(this,"clusterZoom",0),(0,D.Z)(this,"layerType",void 0),(0,D.Z)(this,"triangulation",void 0),(0,D.Z)(this,"layerPickService",void 0),(0,D.Z)(this,"textureService",void 0),(0,D.Z)(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,D.Z)(this,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,D.Z)(this,"hooks",{init:new Bf,afterInit:new Kh,beforeRender:new Kh,beforeRenderData:new Ep,afterRender:new gs,beforePickingEncode:new gs,afterPickingEncode:new gs,beforeHighlight:new gs(["pickedColor"]),afterHighlight:new gs,beforeSelect:new gs(["pickedColor"]),afterSelect:new gs,beforeDestroy:new gs,afterDestroy:new gs}),(0,D.Z)(this,"models",[]),(0,D.Z)(this,"multiPassRenderer",void 0),(0,D.Z)(this,"plugins",void 0),(0,D.Z)(this,"startInit",!1),(0,D.Z)(this,"sourceOption",void 0),(0,D.Z)(this,"layerModel",void 0),(0,D.Z)(this,"shapeOption",void 0),(0,D.Z)(this,"tileLayer",void 0),(0,D.Z)(this,"layerChildren",[]),(0,D.Z)(this,"masks",[]),(0,D.Z)(this,"configService",tf),(0,D.Z)(this,"styleAttributeService",void 0),(0,D.Z)(this,"layerSource",void 0),(0,D.Z)(this,"postProcessingPassFactory",void 0),(0,D.Z)(this,"animateOptions",{enable:!1}),(0,D.Z)(this,"container",void 0),(0,D.Z)(this,"encodedData",void 0),(0,D.Z)(this,"currentPickId",null),(0,D.Z)(this,"rawConfig",void 0),(0,D.Z)(this,"needUpdateConfig",void 0),(0,D.Z)(this,"encodeStyleAttribute",{}),(0,D.Z)(this,"enableShaderEncodeStyles",[]),(0,D.Z)(this,"enableDataEncodeStyles",[]),(0,D.Z)(this,"pendingStyleAttributes",[]),(0,D.Z)(this,"scaleOptions",{}),(0,D.Z)(this,"animateStartTime",void 0),(0,D.Z)(this,"animateStatus",!1),(0,D.Z)(this,"isDestroyed",!1),(0,D.Z)(this,"uniformBuffers",[]),(0,D.Z)(this,"encodeDataLength",0),(0,D.Z)(this,"sourceEvent",()=>{this.dataState.dataSourceNeedUpdate=!0;const r=this.getLayerConfig();r&&r.autoFit&&this.fitBounds(r.fitBoundsOptions),this.layerSource.getSourceCfg().autoRender&&setTimeout(()=>{this.reRender()},10)}),this.name=t.name||this.id,this.zIndex=t.zIndex||0,this.rawConfig=t,this.masks=t.maskLayers||[]}addMask(t){this.masks.push(t),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(t){const r=this.masks.indexOf(t);r>-1&&this.masks.splice(r,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(t){this.masks.push(t)}removeMaskLayer(t){const r=this.masks.indexOf(t);r>-1&&this.masks.splice(r,1),t.destroy()}getAttribute(t){return this.styleAttributeService.getLayerStyleAttribute(t)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(t){if(Object.keys(t).map(r=>{r in this.rawConfig&&(this.rawConfig[r]=t[r])}),!this.startInit)this.needUpdateConfig=(0,_e.Z)((0,_e.Z)({},this.needUpdateConfig),t);else{const r=this.container.id;this.configService.setLayerConfig(r,this.id,(0,_e.Z)((0,_e.Z)((0,_e.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}setContainer(t){this.container=t}getContainer(){return this.container}addPlugin(t){return this.plugins.push(t),this}init(){var t=this;return(0,Xt.Z)(function*(){const r=t.container.id;t.startInit=!0,t.configService.setLayerConfig(r,t.id,t.rawConfig),t.layerType=t.rawConfig.layerType;const{enableMultiPassRenderer:i,passes:a}=t.getLayerConfig();i&&a!==null&&a!==void 0&&a.length&&a.length>0&&t.mapService.on("mapAfterFrameChange",()=>{t.renderLayers()}),t.postProcessingPassFactory=t.container.postProcessingPassFactory,t.styleAttributeService=t.container.styleAttributeService,i&&(t.multiPassRenderer=t.container.multiPassRenderer,t.multiPassRenderer.setLayer(t)),t.pendingStyleAttributes.forEach(({attributeName:u,attributeField:f,attributeValues:m,updateOptions:_})=>{t.styleAttributeService.updateStyleAttribute(u,{scale:(0,_e.Z)({field:f},t.splitValuesAndCallbackInAttribute(m,f?void 0:t.getLayerConfig()[u]))},_)}),t.pendingStyleAttributes=[],t.plugins=AS();for(const u of t.plugins)u.apply(t,t.container);t.layerPickService=new SS(t),t.textureService=new wS(t),t.log(ue.LayerInitStart),yield t.hooks.init.promise(),t.log(ue.LayerInitEnd),t.inited=!0,t.emit("inited",{target:t,type:"inited"}),t.emit("add",{target:t,type:"add"}),t.hooks.afterInit.call()})()}log(t,r="init"){var i;if(this.tileLayer||this.isTileLayer)return;const a=`${this.id}.${r}.${t}`,u={id:this.id,type:this.type};(i=this.debugService)===null||i===void 0||i.log(a,u)}updateModelData(t){t.attributes&&t.elements?this.models.map(r=>{r.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}setLayerPickService(t){this.layerPickService=t}prepareBuildModel(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});const{animateOption:t}=this.getLayerConfig();t!=null&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(t,r,i){return this.updateStyleAttribute("color",t,r,i),this}texture(t,r,i){return this.updateStyleAttribute("texture",t,r,i),this}rotate(t,r,i){return this.updateStyleAttribute("rotate",t,r,i),this}size(t,r,i){return this.updateStyleAttribute("size",t,r,i),this}filter(t,r,i){const a=this.updateStyleAttribute("filter",t,r,i);return this.dataState.dataSourceNeedUpdate=a&&this.inited,this}shape(t,r,i){this.shapeOption={field:t,values:r};const a=this.updateStyleAttribute("shape",t,r,i);return this.dataState.dataSourceNeedUpdate=a&&this.inited,this}label(t,r,i){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:r,updateOptions:i}),this}animate(t){let r={};return vu(t)?(r.enable=!0,r=(0,_e.Z)((0,_e.Z)({},r),t)):r.enable=t,this.updateLayerConfig({animateOption:r}),this}source(t,r){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:r},this.clusterZoom=0,this)}setData(t,r){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(t,r)):this.on("inited",()=>{this.dataUpdatelog(),this.layerSource.setData(t,r)}),this}dataUpdatelog(){this.log(ue.SourceInitStart,Wt.UPDATE),this.layerSource.once("update",()=>{this.log(ue.SourceInitEnd,Wt.UPDATE)})}style(t){const{passes:r}=t,i=(0,Le.Z)(t,CS);r&&u1(r).forEach(u=>{const f=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(u[0]);f&&f.updateOptions(u[1])}),i.borderColor&&(i.stroke=i.borderColor),i.borderWidth&&(i.strokeWidth=i.borderWidth);const a=i;return Object.keys(i).forEach(u=>{const f=i[u];Array.isArray(f)&&f.length===2&&!f1(f[0])&&!f1(f[1])&&(a[u]={field:f[0],value:f[1]})}),this.encodeStyle(a),this.updateLayerConfig(a),this}encodeStyle(t){Object.keys(t).forEach(r=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(r)&&IS(t[r])&&(t[r].field||t[r].value)&&!I_(this.encodeStyleAttribute[r],t[r])?(this.encodeStyleAttribute[r]=t[r],this.updateStyleAttribute(r,t[r].field,t[r].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[r]&&(delete this.encodeStyleAttribute[r],this.dataState.dataSourceNeedUpdate=!0)})}scale(t,r){const i=(0,_e.Z)({},this.scaleOptions);if(vu(t)?this.scaleOptions=(0,_e.Z)((0,_e.Z)({},this.scaleOptions),t):this.scaleOptions[t]=r,this.styleAttributeService&&!I_(i,this.scaleOptions)){const a=vu(t)?t:{[t]:r};this.styleAttributeService.updateScaleAttribute(a)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(t={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}renderMultiPass(){var t=this;return(0,Xt.Z)(function*(){t.encodeDataLength<=0&&!t.forceRender||(t.multiPassRenderer&&t.multiPassRenderer.getRenderFlag()?yield t.multiPassRenderer.render():t.renderModels())})()}active(t){const r={};return r.enableHighlight=vu(t)?!0:t,vu(t)?(r.enableHighlight=!0,t.color&&(r.highlightColor=t.color),t.mix&&(r.activeMix=t.mix)):r.enableHighlight=!!t,this.updateLayerConfig(r),this}setActive(t,r){if(vu(t)){const{x:i=0,y:a=0}=t;this.updateLayerConfig({highlightColor:vu(r)?r.color:this.getLayerConfig().highlightColor,activeMix:vu(r)?r.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:vu(r)?r.color:this.getLayerConfig().highlightColor,activeMix:vu(r)?r.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Ns(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}select(t){const r={};return r.enableSelect=vu(t)?!0:t,vu(t)?(r.enableSelect=!0,t.color&&(r.selectColor=t.color),t.mix&&(r.selectMix=t.mix)):r.enableSelect=!!t,this.updateLayerConfig(r),this}setSelect(t,r){if(vu(t)){const{x:i=0,y:a=0}=t;this.updateLayerConfig({selectColor:vu(r)?r.color:this.getLayerConfig().selectColor,selectMix:vu(r)?r.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:vu(r)?r.color:this.getLayerConfig().selectColor,selectMix:vu(r)?r.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ns(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}setBlend(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}setIndex(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(t){this.currentPickId=t}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(t){this.selectedFeatureID=t}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){const t=this.mapService.getZoom(),{visible:r,minZoom:i=-1/0,maxZoom:a=1/0}=this.getLayerConfig();return!!r&&t>=i&&t<a}setMultiPass(t,r){if(this.updateLayerConfig({enableMultiPassRenderer:t}),r&&this.updateLayerConfig({passes:r}),t){const{passes:i=[]}=this.getLayerConfig();this.multiPassRenderer=l1(this,i,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);const{width:a,height:u}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(a,u)}return this}setMinZoom(t){return this.updateLayerConfig({minZoom:t}),this}getMinZoom(){const{minZoom:t}=this.getLayerConfig();return t}getMaxZoom(){const{maxZoom:t}=this.getLayerConfig();return t}get(t){return this.getLayerConfig()[t]}setMaxZoom(t){return this.updateLayerConfig({maxZoom:t}),this}setAutoFit(t){return this.updateLayerConfig({autoFit:t}),this}fitBounds(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;const i=this.getSource().extent;return i.some(u=>Math.abs(u)===1/0)?this:(this.mapService.fitBounds([[i[0],i[1]],[i[2],i[3]]],t),this)}destroy(t=!0){var r,i,a,u,f;if(this.isDestroyed)return;(r=this.layerModel)===null||r===void 0||r.uniformBuffers.forEach(_=>{_.destroy()}),this.layerChildren.map(_=>_.destroy(!1)),this.layerChildren=[];const{maskfence:m}=this.getLayerConfig();m&&(this.masks.map(_=>_.destroy(!1)),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(i=this.multiPassRenderer)===null||i===void 0||i.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(t),(u=this.tileLayer)===null||u===void 0||u.destroy(),this.models=[],(f=this.debugService)===null||f===void 0||f.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var t;this.models.forEach(r=>r.destroy()),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(t=>t.needRescale||t.needRemapping||t.needRegenerateVertices).length}setSource(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){const r=this.mapService.getZoom();this.layerSource.updateClusterData(r)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",({type:r})=>{if(this.coordCenter===void 0){const i=this.layerSource.center;this.coordCenter=i}if(r==="update"){if(this.tileLayer){this.tileLayer.reload();return}this.sourceEvent()}})}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(t){this.encodedData=t,this.encodeDataLength=t.length}getEncodedData(){return this.encodedData}getScale(t){return this.styleAttributeService.getLayerAttributeScale(t)}getLegend(t){var r,i,a;const u=this.styleAttributeService.getLayerStyleAttribute(t);return{type:(i=((u==null||(r=u.scale)===null||r===void 0?void 0:r.scalers)||[])[0])===null||i===void 0||(i=i.option)===null||i===void 0?void 0:i.type,field:u==null||(a=u.scale)===null||a===void 0?void 0:a.field,items:this.getLegendItems(t)}}getLegendItems(t){const r=this.styleAttributeService.getLayerAttributeScale(t);return r?r.invertExtent?r.range().map(a=>({value:r.invertExtent(a),[t]:a})):r.ticks?r.ticks().map(a=>({value:a,[t]:r(a)})):r!=null&&r.domain?r.domain().filter(a=>!MS(a)).map(a=>({value:a,[t]:r(a)})):[]:[]}pick({x:t,y:r}){this.interactionService.triggerHover({x:t,y:r})}boxSelect(t,r){this.pickingService.boxPickLayer(this,t,r)}buildLayerModel(t){var r=this;return(0,Xt.Z)(function*(){const{moduleName:i,vertexShader:a,fragmentShader:u,defines:f,inject:m,triangulation:_,styleOption:b,pickingEnabled:A=!0}=t,C=(0,Le.Z)(t,RS);r.shaderModuleService.registerModule(i,{vs:a,fs:u,defines:f,inject:m});const{vs:R,fs:U,uniforms:X}=r.shaderModuleService.getModule(i),{createModel:ee}=r.rendererService;return new Promise(xe=>{const{attributes:ke,elements:Ne,count:it}=r.styleAttributeService.createAttributesAndIndices(r.encodedData,_,b,r),gt=[...r.layerModel.uniformBuffers,...r.rendererService.uniformBuffers];A&&gt.push(r.getPickingUniformBuffer());const rr=(0,_e.Z)({attributes:ke,uniforms:X,fs:U,vs:R,elements:Ne,blend:c1[Et.normal],uniformBuffers:gt,textures:r.layerModel.textures},C);it&&(rr.count=it);const Kt=ee(rr);xe(Kt)})})()}createAttributes(t){const{triangulation:r}=t,{attributes:i}=this.styleAttributeService.createAttributes(this.encodedData,r);return i}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(t){const{enableHighlight:r=!0,enableSelect:i=!0}=this.getLayerConfig();let a=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&i&&(a=!0),t==="mousemove"&&(r||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(a=!0),this.isVisible()&&a}buildModels(){return(0,Xt.Z)(function*(){throw new Error("Method not implemented.")})()}rebuildModels(){var t=this;return(0,Xt.Z)(function*(){yield t.buildModels()})()}renderMulPass(t){return(0,Xt.Z)(function*(){yield t.render()})()}renderModels(t={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(r=>{r.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t),textures:this.layerModel.textures},(t==null?void 0:t.ispick)||!1)}),this.hooks.afterRender.call(),this)}updateStyleAttribute(t,r,i,a){const u=this.configService.getAttributeConfig(this.id)||{};return I_(u[t],{field:r,values:i})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,{[t]:{field:r,values:i}}),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,_e.Z)({field:r},this.splitValuesAndCallbackInAttribute(i,this.getLayerConfig()[r]))},a):this.pendingStyleAttributes.push({attributeName:t,attributeField:r,attributeValues:i,updateOptions:a}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(t){console.warn("empty fn")}processData(t){return t}getModelType(){throw new Error("Method not implemented.")}getDefaultConfig(){return{}}initLayerModels(){var t=this;return(0,Xt.Z)(function*(){t.models.forEach(i=>i.destroy()),t.models=[],t.uniformBuffers.forEach(i=>{i.destroy()}),t.uniformBuffers=[];const r=t.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0,label:"pickingUniforms"});t.uniformBuffers.push(r),t.models=yield t.layerModel.initModels()})()}getPickingUniformBuffer(){return this.uniformBuffers[0]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(t){return{values:h1(t)?void 0:t,callback:h1(t)?t:void 0}}}function OS(e,t){return{enable:e,mask:255,func:{cmp:O.EQUAL,ref:t?1:0,mask:1}}}function d1(e){return e.maskOperation===hr.OR?{enable:!0,mask:255,func:{cmp:O.ALWAYS,ref:1,mask:255},opFront:{fail:O.KEEP,zfail:O.REPLACE,zpass:O.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===kt.SINGLE||e.stencilIndex===0?O.ALWAYS:O.LESS,ref:e.stencilType===kt.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:O.KEEP,zfail:O.REPLACE,zpass:O.REPLACE}}}const PS={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},sg={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};var LS=H(75734),af=H.n(LS);function m1(e){return Math.max(Math.ceil(e/4)*4,4)}function v1(e,t,r,i=!0){const a=r===3;if(i){e=e.slice();const f=[];for(let m=0;m<e.length;m+=r){f[0]=e[m],f[1]=e[m+1],a&&(f[2]=e[m+2]);const _=Wo(f,!0,{enable:!1,decimal:1});e[m]=_[0],e[m+1]=_[1],a&&(e[m+2]=_[2])}}return af()(e,t,r)}const g1="ATTRIBUTE_LOCATION_";class Co{get attributeLocation(){return(0,_e.Z)({},Yf)}constructor(t){(0,D.Z)(this,"triangulation",void 0),(0,D.Z)(this,"uniformBuffers",[]),(0,D.Z)(this,"textures",[]),(0,D.Z)(this,"createTexture2D",void 0),(0,D.Z)(this,"preStyleAttribute",{}),(0,D.Z)(this,"encodeStyleAttribute",{}),(0,D.Z)(this,"layer",void 0),(0,D.Z)(this,"dataTexture",void 0),(0,D.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,D.Z)(this,"dataTextureTest",void 0),(0,D.Z)(this,"configService",void 0),(0,D.Z)(this,"shaderModuleService",void 0),(0,D.Z)(this,"rendererService",void 0),(0,D.Z)(this,"iconService",void 0),(0,D.Z)(this,"fontService",void 0),(0,D.Z)(this,"styleAttributeService",void 0),(0,D.Z)(this,"mapService",void 0),(0,D.Z)(this,"cameraService",void 0),(0,D.Z)(this,"layerService",void 0),(0,D.Z)(this,"pickingService",void 0),(0,D.Z)(this,"attributeUnifoms",void 0),(0,D.Z)(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();const{createTexture2D:r}=this.rendererService;this.createTexture2D=r}getBlend(){const{blend:t="normal"}=this.layer.getLayerConfig();return c1[Et[t]]}getStencil(t){const{mask:r=!1,maskInside:i=!0,enableMask:a,maskOperation:u=hr.AND}=this.layer.getLayerConfig();if(this.layer.type==="MaskLayer")return d1({isStencil:!0,stencilType:kt.SINGLE});if(t.isStencil)return d1((0,_e.Z)((0,_e.Z)({},t),{},{maskOperation:u}));const f=r||a&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return OS(f,i)}getDefaultStyle(){return{}}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();const i=(0,_e.Z)((0,_e.Z)({},r.uniformsOption),t.uniformsOption);return Object.keys(i).forEach(a=>{typeof i[a]=="boolean"&&(i[a]=i[a]?1:0)}),!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}getAnimateUniforms(){return{}}needUpdate(){return(0,Xt.Z)(function*(){return!1})()}buildModels(){return(0,Xt.Z)(function*(){throw new Error("Method not implemented.")})()}initModels(){return(0,Xt.Z)(function*(){throw new Error("Method not implemented.")})()}clearModels(t=!0){}getAttribute(){throw new Error("Method not implemented.")}prerender(){}render(t){throw new Error("Method not implemented.")}registerBuiltinAttributes(){throw new Error("Method not implemented.")}animateOption2Array(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}startModelAnimate(){const{animateOption:t}=this.layer.getLayerConfig();t.enable&&this.layer.setAnimateStartTime()}getInject(){return DS(this.layer.enableShaderEncodeStyles,this.layer.encodeStyleAttribute)}getDefines(){const t=Object.keys(this.attributeLocation).reduce((r,i)=>{const a=g1+i;return r[a]=this.attributeLocation[i],r},{});return(0,_e.Z)({},t)}getStyleAttribute(){const t={};return this.layer.enableShaderEncodeStyles.forEach(r=>{if(!this.layer.encodeStyleAttribute[r]){const i=this.layer.getLayerConfig()[r];let a=typeof i=="undefined"?PS[r]:i;r==="stroke"&&(a=ti(a)),t["u_"+r]=a}}),t}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach(t=>{const r=mS(t);r&&this.styleAttributeService.registerStyleAttribute(r)})}registerPosition64LowAttribute(t=!0){this.styleAttributeService.registerStyleAttribute({name:"position64Low",type:Ot.Attribute,descriptor:{name:"a_Position64Low",shaderLocation:this.attributeLocation.POSITION_64LOW,buffer:{data:[],type:O.FLOAT},size:2,update:(r,i,a)=>t?[No(a[0]),No(a[1])]:[0,0]}})}updateEncodeAttribute(t,r){this.encodeStyleAttribute[t]=r}initUniformsBuffer(){const t=this.getUniformsBufferInfo(this.getStyleAttribute()),r=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(m1(t.uniformsLength)).fill(0),isUBO:!0,label:"layerModelAttributeUnifoms"}),this.uniformBuffers.push(this.attributeUnifoms)),r.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(m1(r.uniformsLength)).fill(0),isUBO:!0,label:"layerModelCommonUnifoms"}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(t){let r=0;const i=[];return Object.values(t).forEach(a=>{Array.isArray(a)?(i.push(...a),r+=a.length):typeof a=="number"?(i.push(a),r+=1):typeof a=="boolean"&&(i.push(Number(a)),r+=1)}),{uniformsOption:t,uniformsLength:r,uniformsArray:i}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var t,r;const{uniformsArray:i}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:a}=this.getCommonUniformsInfo();(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(i).buffer)}),(r=this.commonUnifoms)===null||r===void 0||r.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)})}}function DS(e,t){const r=[];let i="";e.forEach(f=>{const m=f.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase(),_=g1+m;t[f]?i+=`#define USE_ATTRIBUTE_${m} 0.0 
`:r.push(`  ${sg[f]} u_${f};`),i+=`
#ifdef USE_ATTRIBUTE_${m}
layout(location = ${_}) in ${sg[f]} a_${f.charAt(0).toUpperCase()+f.slice(1)};
#endif 
`});const a=r.length?`
layout(std140) uniform AttributeUniforms {
  ${r.join(`
`)}
};
`:"";i+=a;let u="";return e.forEach(f=>{const m=f.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase();u+=`
  #ifdef USE_ATTRIBUTE_${m}
    ${sg[f]} ${f} = a_${f.charAt(0).toUpperCase()+f.slice(1)};
  #else
    ${sg[f]} ${f} = u_${f};
  #endif
  `}),{"vs:#decl":i,"fs:#decl":a,"vs:#main-start":u}}const _1=100,Q4=36,J4=40;function y1(e){return e/180*Math.acos(-1)}function x1(e){const t=y1(e[0])+Math.PI/2,r=y1(e[1]),i=_1+Math.random()*.4,a=i*Math.cos(r)*Math.cos(t),u=i*Math.cos(r)*Math.sin(t),f=i*Math.sin(r);return[u,f,a]}function e5(e,t){const r=mat4.create(),i=mat4.create(),a=vec3.fromValues(0,1,0),u=vec3.fromValues(0,0,0);t=t||{},e=typeof e!="undefined"?e:1;const m=2+(typeof t.segments!="undefined"?t.segments:32),_=2*m,b=[],A=[],C=[],R=[],U=[],X=[];for(let ee=0;ee<=m;ee++){const xe=ee/m,ke=xe*Math.PI;for(let Ne=0;Ne<=_;Ne++){const it=Ne/_,gt=it*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-ke),mat4.identity(r),mat4.rotateY(r,r,gt),vec3.transformMat4(u,a,i),vec3.transformMat4(u,u,r),vec3.scale(u,u,-e),C.push(u.slice()),R.push(...u.slice()),vec3.normalize(u,u),U.push(...u.slice()),X.push([it,1-xe]),R.push(it,1-xe)}if(ee>0){const Ne=C.length;let it=Ne-2*(_+1);for(;it+_+2<Ne;it++)b.push([it,it+1,it+_+1]),A.push(it,it+1,it+_+1),b.push([it+_+1,it+1,it+_+2]),A.push(it+_+1,it+1,it+_+2)}}return{cells:b,positions:C,uvs:X,positionsArr:R,indicesArr:A,normalArr:U}}var Hi=H(38015);const b1=Hi.Ue(),t5=Hi.Ue(),mc=Hi.Ue(),Fm=Hi.Ue(),ug=Hi.Ue();function E1(e,t,r,i,a){Hi.IH(e,r,i),Hi.Fv(e,e),t=Hi.al(-e[1],e[0]);const u=Hi.al(-r[1],r[0]);return[a/Hi.AK(t,u),t]}function Nm(e,t){return Hi.t8(e,-t[1],t[0])}function lg(e,t,r){return Hi.lu(e,t,r),Hi.Fv(e,e),e}function T1(e,t){return e[0]===t[0]&&e[1]===t[1]}function r5(e){const t=new Map;for(let r=0;r<e.length;r++){const i=e[0].toString()+"-"+e[1].toString();t.get(i)?(e.splice(r,1),r++):t.set(i,i)}return e}class BS{constructor(t={}){(0,D.Z)(this,"complex",void 0),(0,D.Z)(this,"join",void 0),(0,D.Z)(this,"cap",void 0),(0,D.Z)(this,"miterLimit",void 0),(0,D.Z)(this,"thickness",void 0),(0,D.Z)(this,"normal",void 0),(0,D.Z)(this,"lastFlip",-1),(0,D.Z)(this,"miter",Hi.al(0,0)),(0,D.Z)(this,"started",!1),(0,D.Z)(this,"dash",!1),(0,D.Z)(this,"totalDistance",0),(0,D.Z)(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(t){const r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let a=r.startIndex;for(let u=1;u<i;u++){const f=t[u-1],m=t[u],_=u<t.length-1?t[u+1]:null,b=this.simpleSegment(r,a,f,m,_);a+=b}if(this.dash)for(let u=0;u<r.positions.length/6;u++)r.positions[u*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}extrude(t){const r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let a=r.startIndex;for(let u=1;u<i;u++){const f=t[u-1],m=t[u],_=u<t.length-1?t[u+1]:null,b=this.segment(r,a,f,m,_);a+=b}if(this.dash)for(let u=0;u<r.positions.length/6;u++)r.positions[u*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}simpleSegment(t,r,i,a,u){let f=0;const m=t.indices,_=t.positions,b=t.normals,A=Hr([a[0],a[1]]),C=Hr([i[0],i[1]]);lg(mc,A,C);let R=0;if(this.dash&&(R=this.lineSegmentDistance(A,C),this.totalDistance+=R),this.normal||(this.normal=Hi.Ue(),Nm(this.normal,mc)),this.started||(this.started=!0,this.extrusions(_,b,i,this.normal,this.thickness,this.totalDistance-R)),m.push(r+0,r+1,r+2),!u)Nm(this.normal,mc),this.extrusions(_,b,a,this.normal,this.thickness,this.totalDistance),m.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),f+=2;else{const U=Hr([u[0],u[1]]);T1(A,U)&&Hi.IH(U,A,Hi.Fv(U,Hi.$X(U,A,C))),lg(Fm,U,A);const[X,ee]=E1(ug,Hi.Ue(),mc,Fm,this.thickness);let xe=Hi.AK(ug,this.normal)<0?-1:1;this.extrusions(_,b,a,ee,X,this.totalDistance),m.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),xe=-1,Hi.JG(this.normal,ee),f+=2,this.lastFlip=xe}return f}segment(t,r,i,a,u){let f=0;const m=t.indices,_=t.positions,b=t.normals,A=this.cap==="square",C=this.join==="bevel",R=Hr([a[0],a[1]]),U=Hr([i[0],i[1]]);lg(mc,R,U);let X=0;if(this.dash&&(X=this.lineSegmentDistance(R,U),this.totalDistance+=X),this.normal||(this.normal=Hi.Ue(),Nm(this.normal,mc)),!this.started)if(this.started=!0,A){const ee=Hi.Ue(),xe=Hi.Ue();Hi.IH(ee,this.normal,mc),Hi.IH(xe,this.normal,mc),b.push(xe[0],xe[1],0),b.push(ee[0],ee[1],0),_.push(i[0],i[1],i[2]|0,this.totalDistance-X,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),_.push(i[0],i[1],i[2]|0,this.totalDistance-X,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(_,b,i,this.normal,this.thickness,this.totalDistance-X);if(m.push(r+0,r+1,r+2),u){const ee=Hr([u[0],u[1]]);T1(R,ee)&&Hi.IH(ee,R,Hi.Fv(ee,Hi.$X(ee,R,U))),lg(Fm,ee,R);const[xe,ke]=E1(ug,Hi.Ue(),mc,Fm,this.thickness);let Ne=Hi.AK(ug,this.normal)<0?-1:1,it=C;!it&&this.join==="miter"&&xe>this.miterLimit&&(it=!0),it?(b.push(this.normal[0],this.normal[1],0),b.push(ke[0],ke[1],0),_.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ne,a[2]|0),this.complex.indexes.push(this.currentIndex),_.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Ne,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,m.push(...this.lastFlip!==-Ne?[r,r+2,r+3]:[r+2,r+1,r+3]),m.push(r+2,r+3,r+4),Nm(b1,Fm),Hi.JG(this.normal,b1),b.push(this.normal[0],this.normal[1],0),_.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ne,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f+=3):(this.extrusions(_,b,a,ke,xe,this.totalDistance),m.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),Ne=-1,Hi.JG(this.normal,ke),f+=2),this.lastFlip=Ne}else{if(Nm(this.normal,mc),A){const ee=Hi.Ue(),xe=Hi.Ue();Hi.lu(xe,mc,this.normal),Hi.IH(ee,mc,this.normal),b.push(xe[0],xe[1],0),b.push(ee[0],ee[1],0),_.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),_.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(_,b,a,this.normal,this.thickness,this.totalDistance);m.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),f+=2}return f}extrusions(t,r,i,a,u,f){r.push(a[0],a[1],0),r.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,f,-u,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,f,u,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(t,r){const i=r[0]-t[0],a=r[1]-t[1];return Math.sqrt(i*i+a*a)}}let Um=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),km=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function zm(e,t=0){const r=Math.PI*2/e,i=[];for(let u=0;u<e;u++)i.push(r*u+t*Math.PI/12);return i.map(u=>{const f=Math.sin(u+Math.PI/4),m=Math.cos(u+Math.PI/4);return[f,m,0]})}function M_(){return zm(30)}function A1(){return zm(4)}function S1(){return zm(3)}function w1(){return zm(6,1)}function C1(){return zm(5)}const Pd={[km.CIRCLE]:M_,[km.HEXAGON]:w1,[km.TRIANGLE]:S1,[km.SQUARE]:A1,[km.PENTAGON]:C1,[Um.CYLINDER]:M_,[Um.HEXAGONCOLUMN]:w1,[Um.TRIANGLECOLUMN]:S1,[Um.SQUARECOLUMN]:A1,[Um.PENTAGONCOLUMN]:C1};var zo=H(54442);function FS(e){const t=e[0][0],r=e[0][e[0].length-1];t[0]===r[0]&&t[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));const i=e[0].length,a=af().flatten(e),{vertices:u,dimensions:f}=a,m=[],_=[];for(let A=0;A<u.length/f;A++)f===2?m.push(u[A*2],u[A*2+1],1):m.push(u[A*3],u[A*3+1],1);const b=af()(a.vertices,a.holes,a.dimensions);_.push(...b);for(let A=0;A<i;A++){const C=a.vertices.slice(A*f,(A+1)*f);let R=a.vertices.slice((A+1)*f,(A+2)*f);R.length===0&&(R=a.vertices.slice(0,f));const U=m.length/3;m.push(C[0],C[1],1,R[0],R[1],1,C[0],C[1],0,R[0],R[1],0),_.push(...[0,2,1,2,3,1].map(X=>X+U))}return{positions:m,index:_}}function NS(e){const t=af().flatten(e),r=af()(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:r}}function R1(e,t=!1){const r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));const a=e[0].length,u=af().flatten(e),{vertices:f,dimensions:m,holes:_}=u,b=[],A=[],C=[];for(let U=0;U<f.length/m;U++)b.push(f[U*m],f[U*m+1],1,-1,-1),C.push(0,0,1);const R=v1(f,_,m,t);A.push(...R);for(let U=0;U<a;U++){const X=u.vertices.slice(U*m,(U+1)*m);let ee=u.vertices.slice((U+1)*m,(U+2)*m);ee.length===0&&(ee=u.vertices.slice(0,m));const xe=b.length/5;b.push(X[0],X[1],1,0,0,ee[0],ee[1],1,.1,0,X[0],X[1],0,0,.8,ee[0],ee[1],0,.1,.8);const ke=US([ee[0],ee[1],1],[X[0],X[1],0],[X[0],X[1],1],t);C.push(...ke,...ke,...ke,...ke),A.push(...[1,2,0,3,2,1].map(Ne=>Ne+xe))}return{positions:b,index:A,normals:C}}function US(e,t,r,i=!1){const a=zo.Ue(),u=zo.Ue(),f=zo.Ue();i&&(e=Wo(e),t=Wo(t),r=Wo(r));const m=zo.al(...e),_=zo.al(...t),b=zo.al(...r);zo.lu(a,b,_),zo.lu(u,m,_),zo.kC(f,a,u);const A=zo.Ue();return zo.Fv(A,f),A}const cg={};function zp(e){const t=Ja(e.coordinates);return{vertices:[...t,...t,...t,...t],indices:[0,1,2,2,3,0],size:t.length}}function I1(e){const t=Ja(e.coordinates),r=x1(t);return{vertices:[...r,...r,...r,...r],indices:[0,1,2,2,3,0],size:r.length}}function O_(e){const{shape:t}=e,{positions:r,index:i,normals:a}=XS(t,!1);return{vertices:r,indices:i,normals:a,size:5}}function kS(e){const t=Ja(e.coordinates);return{vertices:[...t],indices:[0],size:t.length}}function P_(e){const{coordinates:t}=e,r=new BS({dash:!0,join:"bevel"});let i=t;i[0]&&!Array.isArray(i[0][0])&&(i=[t]),i.forEach(u=>{r.extrude(u)});const a=r.complex;return{vertices:a.positions,indices:a.indices,normals:a.normals,indexes:a.indexes,size:6}}function n5(e){const t=e.coordinates.flat(),r=1,i=1;return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-r,2*i,1,2*i,-i,1,i,-i,1,i,-i,1,-r,-i,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function zS(e){const{coordinates:t}=e,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};const{results:i,totalDistance:a}=VS(t);return i.map(u=>{r.push(u[0],u[1],u[2],u[3],0,a)}),{vertices:r,indices:[],normals:[],size:6,count:i.length}}function i5(e){const{coordinates:t}=e,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],size:4,count:0};const{results:i}=ZS(t);return i.map(a=>{r.push(a[0],a[1],a[2],a[3])}),{vertices:r,indices:[],size:4,count:i.length}}function M1(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function Ld(e,t){return e.length<3&&e.push(0),t!==void 0&&e.push(t),e}function VS(e){let t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());let r=0;if(t.length<2)return{results:t,totalDistance:0};{const i=[],a=Ld(t[0],r);i.push(a);for(let f=1;f<t.length-1;f++){const m=M1(Hr(t[f-1]),Hr(t[f]));r+=m;const _=Ld(t[f],r);i.push(_),i.push(_)}const u=M1(Hr(t[t.length-2]),Hr(t[t.length-1]));return r+=u,i.push(Ld(t[t.length-1],r)),{results:i,totalDistance:r}}}function ZS(e){if(e.length<2)return{results:e};{const t=[],r=Ld(e[0]);t.push(r);for(let i=1;i<e.length-1;i++){const a=Ld(e[i]);t.push(a),t.push(a)}return t.push(Ld(e[e.length-1])),{results:t}}}function Vm(e){const{coordinates:t}=e,r=af().flatten(t),{vertices:i,dimensions:a,holes:u}=r;return{indices:v1(i,u,a),vertices:i,size:a}}function jS(e){const{indices:t,vertices:r,size:i}=Vm(e);return{indices:t,vertices:HS(r),size:i+4}}function HS(e){const t=[],{center:r,radius:i}=bf(e);for(let a=0;a<e.length;a+=2){const u=e[a],f=e[a+1];t.push(u,f,0,...r,i)}return t}function L_(e){const t=e.coordinates,{positions:r,index:i,normals:a}=R1(t,!0);return{vertices:r,indices:i,normals:a,size:5}}function O1(e){const{shape:t}=e,{positions:r,index:i}=GS(t);return{vertices:r,indices:i,size:3}}function hg(e){const t=e.coordinates;return{vertices:[...t[0],0,0,0,...t[1],0,1,0,...t[2],0,1,1,...t[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function D_(e,t){const{segmentNumber:r=30}=t,i=e.coordinates,a=[],u=[];for(let f=0;f<r;f++)a.push(f,1,f,i[0][0],i[0][1],i[1][0],i[1][1],f,-1,f,i[0][0],i[0][1],i[1][0],i[1][1]),f!==r-1&&u.push(...[0,1,2,1,3,2].map(m=>f*2+m));return{vertices:a,indices:u,size:7}}function P1(e){const t=e.coordinates;t.length===2&&t.push(0);const r=fg(-1,1),i=fg(1,1),a=fg(-1,-1),u=fg(1,-1);return{vertices:[...t,...r,...t,...a,...t,...u,...t,...i],indices:[0,1,2,3,0,2],size:5}}function XS(e,t=!1){if(cg&&cg[e])return cg[e];const r=Pd[e]?Pd[e]():Pd.cylinder(),i=R1([r],t);return cg[e]=i,i}function o5(e,t,r=3,i=!1){const a=new Float32Array(e.length/r*3);let u,f,m;const _=vec3.create(),b=vec3.create(),A=vec3.create();for(let C=0,R=t.length;C<R;C+=3){u=t[C+0]*3,f=t[C+1]*3,m=t[C+2]*3;let U=[e[u],e[u+1]],X=[e[f],e[f+1]],ee=[e[m],e[m+1]];i&&(U=lngLatToMeters(U),X=lngLatToMeters(X),ee=lngLatToMeters(ee));const[xe,ke]=U,Ne=vec3.fromValues(xe,ke,e[u+2]),[it,gt]=X,rr=vec3.fromValues(it,gt,e[f+2]),[Kt,Rt]=ee,tr=vec3.fromValues(Kt,Rt,e[m+2]);vec3.sub(_,tr,rr),vec3.sub(b,Ne,rr),vec3.cross(A,_,b),a[u]+=_[0],a[u+1]+=_[1],a[u+2]+=_[2],a[f]+=_[0],a[f+1]+=_[1],a[f+2]+=_[2],a[m]+=_[0],a[m+1]+=_[1],a[m+2]+=_[2]}return WS(a),a}function WS(e){for(let t=0,r=e.length;t<r;t+=3){const i=vec3.fromValues(e[t],e[t+1],e[t+2]),a=vec3.create();vec3.normalize(a,i),e.set(a,t)}}function a5(e){const t=e[0][0],r=e[0][e[0].length-1];return t[0]===r[0]&&t[1]===r[1]}function GS(e){const t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Pd[e]?Pd[e]():Pd.circle();return t.indexOf(e)===-1?NS([r]):FS([r])}function fg(e,t){const r=(e+1)/2,i=(t+1)/2;return[r,i]}function s5(){const e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),{positionsArr:t,indicesArr:r,normalArr:i}=e;return{vertices:t,indices:r,size:5,normals:i}}function u5(){const e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),{positionsArr:t,indicesArr:r,normalArr:i}=e;return{vertices:t,indices:r,size:5,normals:i}}const YS=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor: [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near: 0;
  float u_far: 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }

  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,qS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`;class KS extends Co{constructor(...t){super(...t),(0,D.Z)(this,"cityCenter",void 0),(0,D.Z)(this,"cityMinSize",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getCommonUniformsInfo(){const{opacity:t=1,baseColor:r="rgb(16,16,16)",brightColor:i="rgb(255,176,38)",windowColor:a="rgb(30,60,89)",time:u=0,sweep:f={enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}}=this.layer.getLayerConfig(),m={u_baseColor:ti(r),u_brightColor:ti(i),u_windowColor:ti(a),u_circleSweepColor:[...ti(f.sweepColor).slice(0,3),1],u_cityCenter:f.sweepCenter||this.cityCenter,u_circleSweep:f.enable?1:0,u_cityMinSize:this.cityMinSize*f.sweepRadius,u_circleSweepSpeed:f.sweepSpeed,u_opacity:t,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||u};return this.getUniformsBufferInfo(m)}calCityGeo(){const[t,r,i,a]=this.layer.getSource().extent,u=i-t,f=a-r;this.cityCenter=[(i+t)/2,(a+r)/2],this.cityMinSize=Math.sqrt(Math.pow(u,2)+Math.pow(f,2))/4}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.calCityGeo(),t.initUniformsBuffer(),t.startModelAnimate(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return[yield t.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:qS,fragmentShader:YS,triangulation:L_,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:O.BACK}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ot.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=10}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}class $S extends qf{constructor(...t){super(...t),(0,D.Z)(this,"type","CityBuildingLayer")}buildModels(){var t=this;return(0,Xt.Z)(function*(){t.layerModel=new KS(t),yield t.initLayerModels()})()}setLight(t){this.updateLayerConfig({time:t})}getModelType(){return"citybuilding"}}function L1(e,t){return{type:e.type,field:"value",items:e.positions.map((r,i)=>({[t]:i>=e.colors.length?null:e.colors[i],value:r}))}}const QS=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,JS=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location =  ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage;

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class e3 extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:i}=this.layer.getLayerConfig(),a={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:i||0};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:JS,fragmentShader:QS,defines:t.getDefines(),triangulation:O1,primitive:O.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ot.Attribute,descriptor:{shaderLocation:this.attributeLocation.POS,name:"a_Pos",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:t=>{const r=t.coordinates;return[r[0],r[1],0]}}})}}const t3=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,r3=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

  float lightWeight = calc_lighting(project_pos);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class n3 extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:i}=this.layer.getLayerConfig(),a={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:i||0};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:r3,fragmentShader:t3,defines:t.getDefines(),triangulation:O_,primitive:O.TRIANGLES,depth:{enable:!0}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ot.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ot.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:t=>{const r=t.coordinates;return[r[0],r[1],0]}}})}}function i3(e,t){const r=[],i=[],a=[],u=e+1,f=t+1,m=e/2,_=t/2;for(let b=0;b<f;b++){const A=b-_;for(let C=0;C<u;C++){const R=C-m;i.push(R/m,-A/_,0),a.push(C/e),a.push(1-b/t)}}for(let b=0;b<t;b++)for(let A=0;A<e;A++){const C=A+u*b,R=A+u*(b+1),U=A+1+u*(b+1),X=A+1+u*b;r.push(C,R,X),r.push(R,U,X)}return{vertices:i,indices:r,uvs:a}}const o3=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,a3=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
  float t2 = t * t;
  float one_minus_t = 1.0 - t;
  float one_minus_t2 = one_minus_t * one_minus_t;
  return P0 * one_minus_t2 * one_minus_t +
  P1 * 3.0 * t * one_minus_t2 +
  P2 * 3.0 * t2 * one_minus_t +
  P3 * t2 * t;
}
vec2 toBezier(float t, vec4 p) {
  return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
  vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

  vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
  vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
  inverseP2 = inverseP2 / inverseP2.w;

  float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
  vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b = vec4(0.5, 0.0, 1.0, 0.5);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.0), 1.0);

}
`,s3=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,u3=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
  v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.0);
}
`,l3=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327

void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,c3=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_DIR) in vec2 a_Dir;

layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF (0.3989422804014327)

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 picking_color_placeholder = u_PickingColor;

  v_weight = a_Size;
  float ZERO = 1.0 / 255.0 / 16.0;
  float extrude_x = a_Dir.x * 2.0 - 1.0;
  float extrude_y = a_Dir.y * 2.0 - 1.0;
  vec2 extrude_dir = normalize(vec2(extrude_x, extrude_y));
  float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
  v_extrude = extrude_dir * S;

  vec2 offset = project_pixel(v_extrude * u_radius);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

}
`,{isEqual:h3}=Kn;class D1 extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"colorTexture",void 0),(0,D.Z)(this,"heatmapFramerBuffer",void 0),(0,D.Z)(this,"heatmapTexture",void 0),(0,D.Z)(this,"intensityModel",void 0),(0,D.Z)(this,"colorModel",void 0),(0,D.Z)(this,"shapeType",void 0),(0,D.Z)(this,"preRampColors",void 0),(0,D.Z)(this,"colorModelUniformBuffer",[]),(0,D.Z)(this,"heat3DModelUniformBuffer",[])}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10,DIR:11})}prerender(){const{clear:t,useFramebuffer:r}=this.rendererService;r(this.heatmapFramerBuffer,()=>{t({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.heatmapFramerBuffer}),this.drawIntensityMode()})}render(t){const{rampColors:r}=this.layer.getLayerConfig();h3(this.preRampColors,r)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(t):this.draw3DHeatMap(t)}getUninforms(){throw new Error("Method not implemented.")}initModels(){var t=this;return(0,Xt.Z)(function*(){var r;const{createFramebuffer:i,getViewportSize:a,createTexture2D:u}=t.rendererService,f=t.styleAttributeService.getLayerStyleAttribute("shape"),m=(f==null||(r=f.scale)===null||r===void 0?void 0:r.field)||"heatmap";t.shapeType=m,t.intensityModel=yield t.buildHeatMapIntensity(),t.colorModel=m==="heatmap"?t.buildHeatmap():t.build3dHeatMap();const{width:_,height:b}=a();return t.heatmapTexture=u({width:Math.floor(_/4),height:Math.floor(b/4),wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,min:O.LINEAR,mag:O.LINEAR,usage:q.RENDER_TARGET}),t.heatmapFramerBuffer=i({color:t.heatmapTexture,depth:!0,width:Math.floor(_/4),height:Math.floor(b/4)}),t.updateColorTexture(),[t.intensityModel,t.colorModel]})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Ot.Attribute,descriptor:{name:"a_Dir",shaderLocation:this.attributeLocation.DIR,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=1}=t;return[r]}}})}buildHeatMapIntensity(){var t=this;return(0,Xt.Z)(function*(){return t.uniformBuffers=[t.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],t.layer.triangulation=P1,yield t.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:c3,fragmentShader:l3,triangulation:P1,defines:t.getDefines(),depth:{enable:!1},cull:{enable:!0,face:O.FRONT}})})()}buildHeatmap(){this.shaderModuleService.registerModule("heatmapColor",{vs:u3,fs:s3}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];const{vs:t,fs:r,uniforms:i}=this.shaderModuleService.getModule("heatmapColor"),{createAttribute:a,createElements:u,createBuffer:f,createModel:m}=this.rendererService;return m({vs:t,fs:r,uniformBuffers:[...this.colorModelUniformBuffer,...this.rendererService.uniformBuffers],attributes:{a_Position:a({shaderLocation:this.attributeLocation.POSITION,buffer:f({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:O.FLOAT}),size:3}),a_Uv:a({shaderLocation:this.attributeLocation.UV,buffer:f({data:[0,1,1,1,0,0,1,0],type:O.FLOAT}),size:2})},uniforms:(0,_e.Z)({},i),depth:{enable:!1},elements:u({data:[0,2,1,2,3,1],type:O.UNSIGNED_INT,count:6})})}build3dHeatMap(){const{getViewportSize:t}=this.rendererService,{width:r,height:i}=t(),a=i3(r/4,i/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:a3,fs:o3}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];const{vs:u,fs:f,uniforms:m}=this.shaderModuleService.getModule("heatmap3dColor"),{createAttribute:_,createElements:b,createBuffer:A,createModel:C}=this.rendererService;return C({vs:u,fs:f,attributes:{a_Position:_({shaderLocation:this.attributeLocation.POSITION,buffer:A({data:a.vertices,type:O.FLOAT}),size:3}),a_Uv:_({shaderLocation:this.attributeLocation.UV,buffer:A({data:a.uvs,type:O.FLOAT}),size:2})},primitive:O.TRIANGLES,uniformBuffers:[...this.heat3DModelUniformBuffer,...this.rendererService.uniformBuffers],uniforms:(0,_e.Z)({},m),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:O.SRC_ALPHA,srcAlpha:1,dstRGB:O.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:b({data:a.indices,type:O.UNSIGNED_INT,count:a.indices.length})})}drawIntensityMode(){var t;const{intensity:r=10,radius:i=5}=this.layer.getLayerConfig(),a={u_radius:i,u_intensity:r};this.uniformBuffers[0].subData({offset:0,data:[i,r]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:a,blend:{enable:!0,func:{srcRGB:O.ONE,srcAlpha:1,dstRGB:O.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}drawHeatMap(t){var r;const{opacity:i=1}=this.layer.getLayerConfig(),a={u_opacity:i,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},u=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[i]}),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:a,textures:u,blend:this.getBlend(),stencil:this.getStencil(t)})}draw3DHeatMap(t){var r;const{opacity:i=1}=this.layer.getLayerConfig(),a=po.create();po.invert(a,this.cameraService.getViewProjectionMatrixUncentered());const u={u_opacity:i,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:[...a]};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[...u.u_ViewProjectionMatrixUncentered,...u.u_InverseViewProjectionMatrix,i]});const f=[this.heatmapTexture,this.colorTexture];(r=this.colorModel)===null||r===void 0||r.draw({uniforms:u,textures:f,blend:{enable:!0,func:{srcRGB:O.SRC_ALPHA,srcAlpha:1,dstRGB:O.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}updateColorTexture(){const{createTexture2D:t}=this.rendererService;this.texture&&this.texture.destroy();const{rampColors:r}=this.layer.getLayerConfig(),i=au(r);this.colorTexture=t({data:i.data,usage:q.SAMPLED,width:i.width,height:i.height,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,min:O.NEAREST,mag:O.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=r}}const f3=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,p3=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);

  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class m3 extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:i}=this.layer.getLayerConfig(),a={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:i||0};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:p3,fragmentShader:f3,defines:t.getDefines(),triangulation:O1,depth:{enable:!1},primitive:O.TRIANGLES})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ot.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:t=>{const r=t.coordinates;return[r[0],r[1],0]}}})}}var v3={heatmap:D1,heatmap3d:D1,grid:e3,grid3d:n3,hexagon:m3};class g3 extends qf{constructor(...t){super(...t),(0,D.Z)(this,"type","HeatMapLayer")}buildModels(){var t=this;return(0,Xt.Z)(function*(){const r=t.getModelType();t.layerModel=new v3[r](t),yield t.initLayerModels()})()}prerender(){this.getModelType()==="heatmap"&&this.layerModel&&this.layerModel.prerender()}renderModels(t={}){return this.getModelType()==="heatmap"?(this.layerModel&&this.layerModel.render(t),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(i=>i.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t)})),this.hooks.afterRender.call(),this)}updateModelData(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}getModelType(){var t;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),{shape3d:i}=this.getLayerConfig(),u=this.getSource().data.type,f=(r==null||(t=r.scale)===null||t===void 0?void 0:t.field)||"heatmap";return f==="heatmap"||f==="heatmap3d"?"heatmap":u==="hexagon"?(i==null?void 0:i.indexOf(f))===-1?"hexagon":"grid3d":u==="grid"?(i==null?void 0:i.indexOf(f))===-1?"grid":"grid3d":"heatmap"}getLegend(t){if(this.getModelType()==="heatmap"){if(t!=="color")return{type:void 0,field:void 0,items:[]};const r=this.getLayerConfig().rampColors;return L1(r,t)}else return super.getLegend(t)}}const _3=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,y3=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class x3 extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,brightness:r,contrast:i,saturation:a,gamma:u}=this.layer.getLayerConfig(),f={u_opacity:_n(t,1),u_brightness:_n(r,1),u_contrast:_n(i,1),u_saturation:_n(a,1),u_gamma:_n(u,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(f)}initModels(){var t=this;return(0,Xt.Z)(function*(){return yield t.loadTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}loadTexture(){var t=this;return(0,Xt.Z)(function*(){const{createTexture2D:r}=t.rendererService,a=yield t.layer.getSource().data.images;t.texture=r({data:a[0],width:a[0].width,height:a[0].height,mag:O.LINEAR,min:O.LINEAR})})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:y3,fragmentShader:_3,defines:t.getDefines(),triangulation:hg,primitive:O.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}var b3={image:x3};class B1 extends qf{constructor(...t){super(...t),(0,D.Z)(this,"type","ImageLayer")}buildModels(){var t=this;return(0,Xt.Z)(function*(){const r=t.getModelType();t.layerModel=new b3[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{image:{}}[t]}getModelType(){return"image"}}const E3=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,T3=`#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  if (u_lineDir == 1.0) {
    // \u6B63\u5411
    return mid;
  } else {
    // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
  //  return index / (segmentNumber - 1.);
}
vec2 interpolate(vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x, t), bezier3(y, t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return dir_screenspace.xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if (u_linearColor == 1.0) {
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex / segmentNumber);
  } else {
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source_world = a_Instance.rg; // \u8D77\u59CB\u70B9
  vec2 target_world = a_Instance.ba; // \u7EC8\u70B9

  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  // \u8BA1\u7B97 dashArray \u548C distanceRatio \u8F93\u51FA\u5230\u7247\u5143
  float total_Distance = pixelDistance(source_world, target_world) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 source = project_position(vec4(source_world, 0, 1.), a_Instance64Low.xy);
  vec4 target = project_position(vec4(target_world, 0, 1.), a_Instance64Low.zw);

  vec2 currPos = interpolate(source.xy, target.xy, segmentRatio, thetaOffset);
  vec2 nextPos = interpolate(source.xy, target.xy, nextSegmentRatio, thetaOffset);

  vec2 offset = project_pixel(
    getExtrusionOffset((nextPos.xy - currPos.xy) * indexDir, a_Position.y)
  );

  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    arcDistrance = project_pixel(arcDistrance);

    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance / pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth / linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace(vec4(currPos.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,A3={solid:0,dash:1};class S3 extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",lineType:a="solid",dashArray:u=[10,5],forward:f=!0,lineTexture:m=!1,iconStep:_=100,segmentNumber:b=30}=this.layer.getLayerConfig(),{animateOption:A}=this.layer.getLayerConfig();let C=u;a!=="dash"&&(C=[0,0]),C.length===2&&C.push(0,0);let R=0,U=[0,0,0,0],X=[0,0,0,0];if(t&&r&&(U=ti(t),X=ti(r),R=1),this.rendererService.getDirty()){var ee;(ee=this.texture)===null||ee===void 0||ee.bind()}const xe={u_animate:this.animateOption2Array(A),u_dash_array:C,u_sourceColor:U,u_targetColor:X,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:b,u_lineDir:f?1:-1,u_icon_step:_,u_line_texture:m?1:0,u_textureBlend:i==="normal"?0:1,u_blur:.9,u_line_type:A3[a||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:R};return this.getUniformsBufferInfo(xe)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:E3,vert:T3,type:""}}buildModels(){var t=this;return(0,Xt.Z)(function*(){t.initUniformsBuffer();const{segmentNumber:r=30}=t.layer.getLayerConfig(),{frag:i,vert:a,type:u}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc2d"+u,vertexShader:a,fragmentShader:i,defines:t.getDefines(),inject:t.getInject(),triangulation:D_,depth:{enable:!1},styleOption:{segmentNumber:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ot.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:Ot.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>[No(i[3]),No(i[4]),No(i[5]),No(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:Ot.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{thetaOffset:r=1}=t;return[r]}}})}}const w3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec4 v_dash_array;
in float v_segmentIndex;
in vec2 v_iconMapUV;
in vec4 v_line_data;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,C3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0), a_Instance64Low.xy).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0), a_Instance64Low.zw).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;

    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }


  setPickingColor(a_PickingColor);
}
`,R3={solid:0,dash:1};class F1 extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",lineType:a="solid",dashArray:u=[10,5],lineTexture:f=!1,iconStep:m=100,segmentNumber:_=30,globalArcHeight:b=10}=this.layer.getLayerConfig(),{animateOption:A}=this.layer.getLayerConfig();u.length===2&&u.push(0,0);let C=0,R=[0,0,0,0],U=[0,0,0,0];if(t&&r&&(R=ti(t),U=ti(r),C=1),this.rendererService.getDirty()){var X;(X=this.texture)===null||X===void 0||X.bind()}const ee={u_animate:this.animateOption2Array(A),u_dash_array:u,u_sourceColor:R,u_targetColor:U,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:_1,u_global_height:b,segmentNumber:_,u_line_type:R3[a]||0,u_icon_step:m,u_line_texture:f?1:0,u_textureBlend:i==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:C};return this.getUniformsBufferInfo(ee)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:w3,vert:C3,type:""}}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{segmentNumber:r=30}=t.layer.getLayerConfig(),{frag:i,vert:a,type:u}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc3d"+u,vertexShader:a,fragmentShader:i,defines:t.getDefines(),inject:t.getInject(),triangulation:D_,styleOption:{segmentNumber:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ot.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:Ot.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>[No(i[3]),No(i[4]),No(i[5]),No(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:Ot.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{thetaOffset:r=1}=t;return[r]}}})}}const N1={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},_l=1/2;function I3(e,t){const{width:r=2,height:i=1}=t;return{vertices:[0,_l*e,1*e*r,-(i+_l)*e,1*e*r,(i-_l)*e,0,_l*e,1*e*r,-(i+_l)*e,1*e*r,(i-_l)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function M3(e,t){const{width:r=2,height:i=3}=t;return{vertices:[0,0,1*e*r,1*i,1*e*r,-1*i,0,0,1*e*r,1*i,1*e*r,-1*i],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function O3(e,t){const{width:r=2,height:i=2}=t;return{vertices:[0,i/2,e*r*1,i/2,e*r*1,-i/2,0,-i/2,0,i/2,e*r*1,i/2,e*r*1,-i/2,0,-i/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function P3(e,t){const{width:r=2,height:i=3}=t;return{vertices:[0,0,1*r*e,.5*i,2*r*e,0,1*r*e,-.5*i,0,0,1*r*e,.5*i,2*r*e,0,1*r*e,-.5*i],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function L3(e,t){const{width:r=2,height:i=3}=t;return{vertices:[0,0,2*e*r,1*i,1.5*e*r,0,2*e*r,-1*i,0,0,2*e*r,1*i,1.5*e*r,0,2*e*r,-1*i],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function D3(e,t){const{width:r=2,height:i=2}=t,a=M_(),u=af().flatten([a]),f=af()(u.vertices,u.holes,u.dimensions),m=a.map(_=>[_[0]*r*e,_[1]*i]).flat();return{vertices:[...m,...m],dimensions:2,indices:f.map(_=>_+a.length),outLineIndices:f,normals:[...a.map(_=>[_[1]*i,_[0]*r*e,1]).flat(),...new Array(a.length*3).fill(0)]}}function B3(e,t=0,r){const i=typeof r.source=="object"?r.source.type:r.source,a=typeof r.target=="object"?r.target.type:r.target,{width:u=i?N1[i]:0}=typeof r.source=="object"?r.source:{},{width:f=a?N1[a]:0}=typeof r.target=="object"?r.target:{};return{vertices:[0,_l,1*u,...e,1,_l,-1*f,...e,1,-_l,-1*f,...e,0,-_l,1*u,...e,0,_l,1*u,...e,1,_l,-1*f,...e,1,-_l,-1*f,...e,0,-_l,1*u,...e],outLineIndices:[0,1,2,0,2,3].map(m=>m+t),indices:[4,5,6,4,6,7].map(m=>m+t),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function U1(e,t){const r=typeof e=="object"?e.type:e,i=t==="source"?1:-1,a=typeof e=="object"?e:{};switch(r){case"circle":return D3(i,a);case"triangle":return M3(i,a);case"diamond":return P3(i,a);case"rect":return O3(i,a);case"classic":return L3(i,a);case"halfTriangle":return I3(i,a);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function F3(e){const t=e.coordinates.flat(),r=1,i=1;return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-r,2*i,1,2*i,-i,1,i,-i,1,i,-i,1,-r,-i,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function N3(e,t){return t?U3(e,t):F3(e)}function U3(e,t){const r=e.coordinates.flat(),{target:i="classic",source:a="circle"}=t,u=k1(U1(a,"source"),r,0,0),f=B3(r,u.vertices.length/7,t),m=k1(U1(i,"target"),r,1,u.vertices.length/7+f.vertices.length/7);return{vertices:[...u.vertices,...f.vertices,...m.vertices],indices:[...u.outLineIndices,...f.outLineIndices,...m.outLineIndices,...u.indices,...f.indices,...m.indices],normals:[...u.normals,...f.normals,...m.normals],size:7}}function k1(e,t,r=1,i=0){const a=[],{vertices:u,indices:f,dimensions:m,outLineIndices:_}=e;for(let b=0;b<u.length;b+=m)a.push(r,u[b+1],u[b],...t);return(0,_e.Z)((0,_e.Z)({},e),{},{vertices:a,indices:f.map(b=>b+i),outLineIndices:_.map(b=>b+i)})}const k3=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,z3=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {
  vec2 data = project_pixel(offsets);

  return vec2(data.x, -data.y);
}

vec2 line_dir(vec2 target, vec2 source) {
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}


void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source_world = a_Instance.rg; // \u8D77\u70B9
  vec2 target_world = a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target_world, source_world);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);

  vec2 position = mix(source_world, target_world, a_Position.x);
  vec2 position64Low = mix(a_Instance64Low.rg, a_Instance64Low.ba, a_Position.x);

  float lengthCommon = length(
    project_position(vec4(target_world, 0, 1)) - project_position(vec4(source_world, 0, 1))
  );
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(
    offsetDistances,
    project_pixel(-lengthCommon * 0.2),
    project_pixel(lengthCommon * 0.2)
  );

  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon * 0.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon * 0.2),
    a_Position.x
  );

  vec2 normalsCommon = u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y));

  float gapCommon = -1. * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
      perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0), position64Low);

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));

  setPickingColor(a_PickingColor);
}
`;class V3 extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,NORMAL:12})}getCommonUniformsInfo(){const{gapWidth:t=2,strokeWidth:r=1,strokeOpacity:i=1}=this.layer.getLayerConfig(),a={u_gap_width:t,u_stroke_width:r,u_stroke_opacity:i};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return[yield t.layer.buildLayerModel({moduleName:"flow_line",vertexShader:z3,fragmentShader:k3,defines:t.getDefines(),inject:t.getInject(),triangulation:N3,styleOption:t.layer.getLayerConfig().symbol,primitive:O.TRIANGLES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ot.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:Ot.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>[No(i[3]),No(i[4]),No(i[5]),No(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ot.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a,u)=>u}})}}const Z3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_dash_array;
in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_line_data;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) {
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,j3=`#define LineTypeSolid (0.0)
#define LineTypeDash (1.0)
#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps(float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.0);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(mix(source, target, segmentRatio), sqrt(max(0.0, vertex_height)));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}
float getAngularDist(vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) * sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate(vec2 source, vec2 target, float angularDist, float t) {
  if (abs(angularDist - PI) < 0.001) {
    return (1.0 - t) * source + t * target;
  }
  float a = sin((1.0 - t) * angularDist) / sin(angularDist);
  float b = sin(t * angularDist) / sin(angularDist);
  vec2 sin_source = sin(source);
  vec2 cos_source = cos(source);
  vec2 sin_target = sin(target);
  vec2 cos_target = cos(target);
  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
  float z = a * sin_source.y + b * sin_target.y;
  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));

}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if (u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    total_Distance = total_Distance * 16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if (u_animate.x == Animate) {
    v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0), a_Instance64Low.xy);
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0), a_Instance64Low.zw);

  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if (LineTexture == u_line_texture) {
    float d_arcDistrance = length(source - target);
    d_arcDistrance = project_pixel(d_arcDistrance);

    float d_pixelLen = project_pixel(u_icon_step) / 8.0;
    v_line_data.b = floor(d_arcDistrance / d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth / linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,H3={solid:0,dash:1};class X3 extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",lineType:a="solid",dashArray:u=[10,5],lineTexture:f=!1,iconStep:m=100,segmentNumber:_=30}=this.layer.getLayerConfig(),{animateOption:b}=this.layer.getLayerConfig();if(u.length===2&&u.push(0,0),this.rendererService.getDirty()){var A;(A=this.texture)===null||A===void 0||A.bind()}let C=0,R=[0,0,0,0],U=[0,0,0,0];t&&r&&(R=ti(t),U=ti(r),C=1);let X=this.layer.getLayerAnimateTime();isNaN(X)&&(X=0);const ee={u_animate:this.animateOption2Array(b),u_dash_array:u,u_sourceColor:R,u_targetColor:U,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:_,u_line_type:H3[a]||0,u_icon_step:m,u_line_texture:f?1:0,u_textureBlend:i==="normal"?0:1,u_time:X,u_linearColor:C};return this.getUniformsBufferInfo(ee)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{segmentNumber:r=30}=t.layer.getLayerConfig();return[yield t.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:j3,fragmentShader:Z3,triangulation:D_,styleOption:{segmentNumber:r},defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ot.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:Ot.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>[No(i[3]),No(i[4]),No(i[5]),No(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}})}}let h5=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),z1=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),W3=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),B_=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),f5=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});const G3=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,Y3=`#define Animate (0.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_INDEX) in vec3 a_DistanceAndIndexAndMiter;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec4 a_Normal_Total_Distance;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen; // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * a_Normal;

  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0; // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth / linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    h *= mapboxZoomScale;
    h += u_raisingHeight * mapboxZoomScale;
    if (u_heightfixed > 0.0) {
      lineHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(
    vec4(project_pos.xy + offset, lineHeight + h, 1.0)
  );

  setPickingColor(a_PickingColor);
}
`;class V1 extends Co{constructor(...t){super(...t),(0,D.Z)(this,"textureEventFlag",!1),(0,D.Z)(this,"texture",this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,D.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.textures.length===0&&(this.textures=[this.texture]),this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,DISTANCE_INDEX:10,NORMAL:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",lineType:a="solid",dashArray:u=[10,5,0,0],lineTexture:f=!1,iconStep:m=100,vertexHeightScale:_=20,strokeWidth:b=0,raisingHeight:A=0,heightfixed:C=!1,linearDir:R=z1.VERTICAL,blur:U=[1,1,1,0]}=this.layer.getLayerConfig();let X=u;if(a!=="dash"&&(X=[0,0,0,0]),X.length===2&&X.push(0,0),this.rendererService.getDirty()&&this.texture){var ee;(ee=this.texture)===null||ee===void 0||ee.bind()}const{animateOption:xe}=this.layer.getLayerConfig();let ke=0,Ne=[0,0,0,0],it=[0,0,0,0];t&&r&&(Ne=ti(t),it=ti(r),ke=1);const gt={u_animate:this.animateOption2Array(xe),u_dash_array:X,u_blur:U,u_sourceColor:Ne,u_targetColor:it,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:m,u_heightfixed:Number(C),u_vertexScale:_,u_raisingHeight:Number(A),u_strokeWidth:b,u_textureBlend:i===W3.NORMAL?0:1,u_line_texture:f?1:0,u_linearDir:R===z1.VERTICAL?1:0,u_linearColor:ke,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(gt)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),t.textureEventFlag||(t.textureEventFlag=!0,t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture)),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{depth:r=!1}=t.layer.getLayerConfig(),{frag:i,vert:a,type:u}=t.getShaders();return t.layer.triangulation=P_,[yield t.layer.buildLayerModel({moduleName:"line"+u,vertexShader:a,fragmentShader:i,triangulation:P_,defines:t.getDefines(),inject:t.getInject(),depth:{enable:r}})]})()}getShaders(){return{frag:G3,vert:Y3,type:""}}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Ot.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:this.attributeLocation.DISTANCE_INDEX,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a,u,f)=>f===void 0?[i[3],10,i[4]]:[i[3],f,i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:Ot.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i,a,u)=>[...u,i[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}})}}const q3=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,K3=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color;
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  float lineHeight = a_SizeDistanceAndTotalDistance.y;
  // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
    h *= 2.0 / pow(2.0, 20.0 - u_Zoom);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  gl_PointSize = 10.0;

}
`;class $3 extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,lineType:i="solid",dashArray:a=[10,5,0,0],vertexHeightScale:u=20}=this.layer.getLayerConfig();let f=a;i!=="dash"&&(f=[0,0,0,0]),f.length===2&&f.push(0,0);let m=0,_=[0,0,0,0],b=[0,0,0,0];t&&r&&(_=ti(t),b=ti(r),m=1);const A={u_sourceColor:_,u_targetColor:b,u_dash_array:f,u_vertexScale:u,u_linearColor:m};return this.getUniformsBufferInfo(A)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}getShaders(){return{frag:q3,vert:K3,type:"lineSimpleNormal"}}buildModels(){var t=this;return(0,Xt.Z)(function*(){t.initUniformsBuffer();const{frag:r,vert:i,type:a}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,triangulation:zS,defines:t.getDefines(),inject:t.getInject(),primitive:O.LINES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Ot.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:4,update:(t,r,i)=>{const{size:a=1}=t,u=Array.isArray(a)?[a[0],a[1]]:[a,0];return[u[0],u[1],i[3],i[5]]}}})}}const Q3=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};


in vec2 v_iconMapUV;
in vec4 v_color;
in float v_blur;
in vec4 v_dataset;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }


  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,J3=`#define Animate 0.0
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_MITER_TOTAL) in vec3 a_Distance_Total_Miter;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out vec4 v_dataset;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float a_Distance = a_Distance_Total_Miter.x;
  float a_Miter = a_Distance_Total_Miter.y;
  float a_Total_Distance = a_Distance_Total_Miter.z;

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen; // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if (u_heightfixed < 1.0) {
    // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }

  if (u_animate.x == Animate || u_linearColor == 1.0) {
    d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0) / 2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance; // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen; // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float originSize = a_Size.x; // \u56FA\u5B9A\u9AD8\u5EA6
  if (u_heightfixed < 1.0) {
    originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    if (u_heightfixed > 0.0) {
      wallHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class ew extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:O.NEAREST,min:O.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:12,UV:13,DISTANCE_MITER_TOTAL:15})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:i="normal",heightfixed:a=!1,lineTexture:u=!1,iconStep:f=100,iconStepCount:m=1}=this.layer.getLayerConfig(),{animateOption:_}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var b;(b=this.texture)===null||b===void 0||b.bind()}let A=0,C=[0,0,0,0],R=[0,0,0,0];t&&r&&(C=ti(t),R=ti(r),A=1);const U={u_animate:this.animateOption2Array(_),u_sourceColor:C,u_targetColor:R,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:f,u_heightfixed:Number(a),u_linearColor:A,u_line_texture:u?1:0,u_textureBlend:i==="normal"?0:1,u_iconStepCount:m,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(U)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return(0,Xt.Z)(function*(){return[yield t.layer.buildLayerModel({moduleName:"lineWall",vertexShader:J3,fragmentShader:Q3,triangulation:P_,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ot.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"distanceAndTotalAndMiter",type:Ot.Attribute,descriptor:{name:"a_Distance_Total_Miter",shaderLocation:this.attributeLocation.DISTANCE_MITER_TOTAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i)=>[i[3],i[4],i[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:i}=t,{x:a,y:u}=r[i]||{x:0,y:0};return[a,u]}}})}}var tw={arc:S3,arc3d:F1,greatcircle:X3,wall:ew,line:V1,simple:$3,flowline:V3,earthArc3d:F1};class F_ extends qf{constructor(...t){super(...t),(0,D.Z)(this,"type","LineLayer"),(0,D.Z)(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,D.Z)(this,"arrowInsertCount",0),(0,D.Z)(this,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}})}buildModels(){var t=this;return(0,Xt.Z)(function*(){const r=t.getModelType();t.layerModel=new tw[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[t]}getModelType(){var t;if(this.layerType)return this.layerType;const r=this.styleAttributeService.getLayerStyleAttribute("shape");return(r==null||(t=r.scale)===null||t===void 0?void 0:t.field)||"line"}processData(t){if(this.getModelType()!=="simple")return t;const r=[];return t.map(i=>{if(Array.isArray(i.coordinates)&&Array.isArray(i.coordinates[0])&&Array.isArray(i.coordinates[0][0])){const a=(0,_e.Z)({},i);i.coordinates.map(u=>{r.push((0,_e.Z)((0,_e.Z)({},a),{},{coordinates:u}))})}else r.push(i)}),r}}const rw=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,nw=`
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0 / a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  vec2 offset = project_pixel(u_offsets);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Z1(e){const t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class iw extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const{blend:t,strokeOpacity:r=1,strokeWidth:i=0,stroke:a="#fff"}=this.layer.getLayerConfig(),u={u_stroke_color:ti(a),u_additive:t==="additive"?1:0,u_stroke_opacity:r,u_stroke_width:i};return this.getUniformsBufferInfo(u)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.layer.triangulation=Z1,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:nw,fragmentShader:rw,defines:t.getDefines(),inject:t.getInject(),triangulation:Z1,depth:{enable:!1},primitive:O.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const ow=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,aw=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) +
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    //
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;


  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,
    0,xcos,-xsin,0,
    0,xsin,xcos,0,
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,
    0,1,0,0,
    ysin,0,ycos,0,
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);


  setPickingColor(a_PickingColor);
}
`,{isNumber:sw}=Kn;class uw extends Co{constructor(...t){super(...t),(0,D.Z)(this,"raiseCount",0),(0,D.Z)(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},opacity:r=1,sourceColor:i,targetColor:a,pickLight:u=!1,heightfixed:f=!0,opacityLinear:m={enable:!1,dir:"up"},lightEnable:_=!0}=this.layer.getLayerConfig();let b=0,A=[0,0,0,0],C=[0,0,0,0];if(i&&a&&(A=ti(i),C=ti(a),b=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:X=.01}=t;this.raiseCount+=X,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const R={u_sourceColor:A,u_targetColor:C,u_linearColor:b,u_pickLight:Number(u),u_heightfixed:Number(f),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:sw(r)?r:1,u_opacitylinear:Number(m.enable),u_opacitylinear_dir:m.dir==="up"?1:0,u_lightEnable:Number(_)};return this.getUniformsBufferInfo(R)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{animateOption:{repeat:r=1}}=t.layer.getLayerConfig();return t.raiseRepeat=r,[yield t.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:aw,fragmentShader:ow,triangulation:O_,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:O.FRONT},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:t=>{const{size:r}=t;if(r){let i=[];return Array.isArray(r)&&(i=r.length===2?[r[0],r[0],r[1]]:r),Array.isArray(r)||(i=[r,r,r]),i}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ot.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ot.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:t=>{const r=Ja(t.coordinates);return x1([r[0],r[1]])}}})}}const lw=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,cw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}
`;class hw extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:r=0,blend:i,blur:a=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();const u={u_additive:i==="additive"?1:0,u_stroke_opacity:t,u_stroke_width:r,u_blur:a};return this.getUniformsBufferInfo(u)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.layer.triangulation=I1,[yield t.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:cw,fragmentShader:lw,triangulation:I1,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!0},blend:t.getBlend()})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ot.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a)=>{const[u,f,m]=i,_=zo.al(0,0,1),b=zo.al(u,0,m),A=u>=0?zo.EU(_,b):Math.PI*2-zo.EU(_,b),C=Math.PI*2-Math.asin(f/100),R=po.create();po.rotateY(R,R,A),po.rotateX(R,R,C);const U=zo.al(1,1,0);zo.fF(U,U,R),zo.Fv(U,U);const X=zo.al(-1,1,0);zo.fF(X,X,R),zo.Fv(X,X);const ee=zo.al(-1,-1,0);zo.fF(ee,ee,R),zo.Fv(ee,ee);const xe=zo.al(1,-1,0);zo.fF(xe,xe,R),zo.Fv(xe,xe);const ke=[...U,...X,...ee,...xe],Ne=a%4*3;return[ke[Ne],ke[Ne+1],ke[Ne+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ot.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{shape:r=2}=t;return[this.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}const fw=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,pw=`#define pi (3.1415926535)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec4 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if (x > 0.0 && z > 0.0) {
    return atan(x / z);
  } else if (x > 0.0 && z <= 0.0) {
    return atan(-z / x) + pi / 2.0;
  } else if (x <= 0.0 && z <= 0.0) {
    return pi + atan(x / z); //atan(x/z) +
  } else {
    return atan(z / -x) + pi * 3.0 / 2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y / r);
}

void main() {
  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if (u_heightfixed < 1.0) {
    // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
  } else {
    // \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      offset *= 4.0 / pow(2.0, 21.0 - u_Zoom);
    }
  }

  vec2 positions = a_Extrude.xy;
  vec2 positions64Low = a_Extrude.zw;
  vec4 project_pos = project_position(vec4(positions, 0.0, 1.0), positions64Low);

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if (u_lightEnable > 0.0) {
    // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if (u_linearColor == 1.0) {
    // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a = v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

  if (u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? 1.0 - a_Position.z : a_Position.z;
  }

  gl_Position = project_common_position_to_clipspace(pos);

  setPickingColor(a_PickingColor);
}
`;class j1 extends Co{constructor(...t){super(...t),(0,D.Z)(this,"raiseCount",0),(0,D.Z)(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},sourceColor:r,targetColor:i,pickLight:a=!1,heightfixed:u=!1,opacityLinear:f={enable:!1,dir:"up"},lightEnable:m=!0}=this.layer.getLayerConfig();let _=0,b=[0,0,0,0],A=[0,0,0,0];if(r&&i&&(b=ti(r),A=ti(i),_=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:U=.01}=t;this.raiseCount+=U,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const C={u_pickLight:Number(a),u_heightfixed:Number(u),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:_,u_sourceColor:b,u_targetColor:A,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:f.dir==="up"?1:0,u_lightEnable:Number(m)};return this.getUniformsBufferInfo(C)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{depth:r=!0,animateOption:{repeat:i=1}}=t.layer.getLayerConfig();return t.raiseRepeat=i,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:pw,fragmentShader:fw,triangulation:O_,defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:O.FRONT},depth:{enable:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:t=>{const{size:r}=t;if(r){let i=[];return Array.isArray(r)&&(i=r.length===2?[r[0],r[0],r[1]]:r),Array.isArray(r)||(i=[r,r,r]),i}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ot.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ot.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:4,update:t=>{const r=Ja(t.coordinates);return[r[0],r[1],No(r[0]),No(r[1])]}}})}}const dw=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,mw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class H1 extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:r=0,blend:i,blur:a=0,raisingHeight:u=0,heightfixed:f=!1,unit:m="pixel"}=this.layer.getLayerConfig();let _=this.getAnimateUniforms().u_time;isNaN(_)&&(_=-1);const b={u_blur_height_fixed:[a,Number(u),Number(f)],u_stroke_width:r,u_additive:i==="additive"?1:0,u_stroke_opacity:t,u_size_unit:B_[m],u_time:_,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(b)}getAnimateUniforms(){const{animateOption:t={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),zp)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{frag:r,vert:i,type:a}=t.getShaders();return t.layer.triangulation=zp,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,defines:t.getDefines(),inject:t.getInject(),triangulation:zp,depth:{enable:!1}})]})()}getShaders(){return{frag:dw,vert:mw,type:"pointFill"}}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){const t=this.layer.getLayerConfig().shape2d;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ot.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:(r,i,a,u)=>{const f=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],m=u%4*3;return[f[m],f[m+1],f[m+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:r=>{const{size:i=5}=r;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ot.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:r=>{const{shape:i=2}=r;return[t.indexOf(i)]}}})}}const vw=`in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,gw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed;
  float u_raisingHeight;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0) / 2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if (u_size_unit == 1.0) {
    newSize = newSize * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = extrude.xy * newSize + offsets;

  offset = rotate_matrix(offset, rotation);

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class _w extends Co{constructor(...t){super(...t),(0,D.Z)(this,"meter2coord",1),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"isMeter",!1),(0,D.Z)(this,"radian",0),(0,D.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),this.layerService.throttleRenderLayers();return}this.texture=r({data:this.iconService.getCanvas(),mag:O.LINEAR,min:O.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,UV:11})}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:r=!1,unit:i="pixel"}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var a;(a=this.texture)===null||a===void 0||a.bind()}const u={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(r),u_raisingHeight:Number(t),u_size_unit:B_[i]};return this.getUniformsBufferInfo(u)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),zp)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:gw,fragmentShader:vw,triangulation:zp,depth:{enable:!1},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:O.FRONT}})]})()}clearModels(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{shape:i}=t,{x:a,y:u}=r[i]||{x:-64,y:-64};return[a,u]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ot.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a)=>{const u=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=a%4*3;return[u[f],u[f+1],u[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const yw=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,xw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if (u_heightfixed < 1.0) {
    // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;class X1 extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(()=>{this.layerService.throttleRenderLayers()});return}this.texture=r({data:this.iconService.getCanvas(),mag:O.LINEAR,min:O.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10})}getUninforms(){if(this.rendererService.getDirty()){var t;(t=this.texture)===null||t===void 0||t.bind()}const r=this.getCommonUniformsInfo(),i=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},r.uniformsOption),i.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:r=!1}=this.layer.getLayerConfig(),i={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(t),u_heightfixed:Number(r),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(i)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointImage",vertexShader:xw,fragmentShader:yw,triangulation:kS,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:O.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{shape:i}=t,{x:a,y:u}=r[i]||{x:-64,y:-64};return[a,u]}}})}}const bw=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,Ew=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(project_pos);

  gl_PointSize = a_Size * u_size_scale * 2.0 * u_DevicePixelRatio;
}
`;function W1(e){const t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class G1 extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const t={u_size_scale:.5};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.layer.triangulation=W1,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:Ew,fragmentShader:bw,triangulation:W1,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:O.POINTS,pick:!1})]})()}clearModels(){}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const Tw=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,Aw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2(
    cos(time), sin(time),
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));

  offset = project_pixel(offset);

  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`;class Sw extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10})}getCommonUniformsInfo(){const{blend:t,speed:r=1,unit:i="pixel"}=this.layer.getLayerConfig(),a={u_additive:t==="additive"?1:0,u_size_unit:B_[i],u_speed:r,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(a)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),zp)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:Aw,fragmentShader:Tw,triangulation:zp,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ot.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a)=>{const u=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],f=a%4*3;return[u[f],u[f+1],u[f+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}class ww{constructor(t,r,i){(0,D.Z)(this,"boxCells",[]),(0,D.Z)(this,"xCellCount",void 0),(0,D.Z)(this,"yCellCount",void 0),(0,D.Z)(this,"boxKeys",void 0),(0,D.Z)(this,"bboxes",void 0),(0,D.Z)(this,"width",void 0),(0,D.Z)(this,"height",void 0),(0,D.Z)(this,"xScale",void 0),(0,D.Z)(this,"yScale",void 0),(0,D.Z)(this,"boxUid",void 0);const a=this.boxCells;this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(r/i);for(let u=0;u<this.xCellCount*this.yCellCount;u++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0}insert(t,r,i,a,u){this.forEachCell(r,i,a,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(u)}query(t,r,i,a,u){return this.queryHitTest(t,r,i,a,!1,u)}hitTest(t,r,i,a,u){return this.queryHitTest(t,r,i,a,!0,u)}insertBoxCell(t,r,i,a,u,f){this.boxCells[u].push(f)}queryHitTest(t,r,i,a,u,f){if(i<0||t>this.width||a<0||r>this.height)return u?!1:[];const m=[];if(t<=0&&r<=0&&this.width<=i&&this.height<=a){if(u)return!0;for(let b=0;b<this.boxKeys.length;b++)m.push({key:this.boxKeys[b],x1:this.bboxes[b*4],y1:this.bboxes[b*4+1],x2:this.bboxes[b*4+2],y2:this.bboxes[b*4+3]});return f?m.filter(f):m}const _={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,r,i,a,this.queryCell,m,_,f),u?m.length>0:m}queryCell(t,r,i,a,u,f,m,_){const b=m.seenUids,A=this.boxCells[u];if(A!==null){const C=this.bboxes;for(const R of A)if(!b.box[R]){b.box[R]=!0;const U=R*4;if(t<=C[U+2]&&r<=C[U+3]&&i>=C[U+0]&&a>=C[U+1]&&(!_||_(this.boxKeys[R]))){if(m.hitTest)return f.push(!0),!0;f.push({key:this.boxKeys[R],x1:C[U],y1:C[U+1],x2:C[U+2],y2:C[U+3]})}}}return!1}forEachCell(t,r,i,a,u,f,m,_){const b=this.convertToXCellCoord(t),A=this.convertToYCellCoord(r),C=this.convertToXCellCoord(i),R=this.convertToYCellCoord(a);for(let U=b;U<=C;U++)for(let X=A;X<=R;X++){const ee=this.xCellCount*X+U;if(u.call(this,t,r,i,a,ee,f,m,_))return}}convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}var Cw=ww;class Rw{constructor(t,r){(0,D.Z)(this,"width",void 0),(0,D.Z)(this,"height",void 0),(0,D.Z)(this,"grid",void 0),(0,D.Z)(this,"viewportPadding",100),(0,D.Z)(this,"screenRightBoundary",void 0),(0,D.Z)(this,"screenBottomBoundary",void 0),(0,D.Z)(this,"gridRightBoundary",void 0),(0,D.Z)(this,"gridBottomBoundary",void 0),this.width=t,this.height=r,this.viewportPadding=Math.max(t,r),this.grid=new Cw(t+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}placeCollisionBox(t){const r=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(r,i,a,u)||this.grid.hitTest(r,i,a,u)?{box:[]}:{box:[r,i,a,u]}}insertCollisionBox(t,r){const i={featureIndex:r};this.grid.insert(i,t[0],t[1],t[2],t[3])}project(t,r,i){const a=ra.al(r,i,0,1),u=ra.Ue(),f=po.fromValues(...t);return ra.fF(u,a,f),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(t,r,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&r<this.gridBottomBoundary}}function Y1(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:t,verticalAlign:r}}function q1(e,t,r,i,a){if(!a)return;const u=e[i],f=u.glyph;if(f){const m=t[f].advance*u.scale,_=(e[i].x+m)*a;for(let b=r;b<=i;b++)e[b].x-=_}}function K1(e,t,r,i,a,u,f){const m=(t-r)*a,_=(-i*f+.5)*u;for(const b of e)b.x+=m,b.y+=_}function Iw(e,t,r,i,a,u,f){let _=0,b=-8,A=0;const C=e.positionedGlyphs,R=u==="right"?1:u==="left"?0:.5,U=C.length;r.forEach(ke=>{if(ke.split("").forEach(Ne=>{const it=t[Ne];it&&(C.push({glyph:Ne,x:_,y:b+0,vertical:!1,scale:1,metrics:it}),_+=it.advance+f)}),C.length!==U){const Ne=_-f;A=Math.max(Ne,A),q1(C,t,U,C.length-1,R)}_=0,b-=i+5});const{horizontalAlign:X,verticalAlign:ee}=Y1(a);K1(C,R,X,ee,A,i,r.length);const xe=b- -8;e.top+=-ee*xe,e.bottom=e.top-xe,e.left+=-X*A,e.right=e.left+A}function Mw(e,t,r,i,a,u,f){let _=0,b=-8,A=0;const C=e.positionedGlyphs,R=u==="right"?1:u==="left"?0:.5,U=C.length;r.forEach(ke=>{const Ne=t[ke];if(Ne&&(C.push({glyph:ke,x:Ne.advance/2,y:b+0,vertical:!1,scale:1,metrics:Ne}),_+=Ne.advance+f),C.length!==U){const gt=_-f;A=Math.max(gt,A),q1(C,t,U,C.length-1,R)}_=0,b-=i+5});const{horizontalAlign:X,verticalAlign:ee}=Y1(a);K1(C,R,X,ee,A,i,r.length);const xe=b- -8;e.top+=-ee*xe,e.bottom=e.top-xe,e.left+=-X*A,e.right=e.left+A}function Ow(e,t,r,i,a,u,f=[0,0],m){const _=e.split(`
`),b=[],A={positionedGlyphs:b,top:f[1],bottom:f[1],left:f[0],right:f[0],lineCount:_.length,text:e};return m?Mw(A,t,_,r,i,a,u):Iw(A,t,_,r,i,a,u),b.length?A:!1}function Pw(e,t=[0,0],r){const{positionedGlyphs:i=[]}=e,a=[];for(const u of i){const f=u.metrics,m=4,_=f.advance*u.scale/2,b=r?[u.x+_,u.y]:[0,0],A=r?[0,0]:[u.x+_+t[0],u.y+t[1]],C=(0-m)*u.scale-_+A[0],R=(0-m)*u.scale+A[1],U=C+f.width*u.scale,X=R+f.height*u.scale,ee={x:C,y:R},xe={x:U,y:R},ke={x:C,y:X},Ne={x:U,y:X};a.push({tl:ee,tr:xe,bl:ke,br:Ne,tex:f,glyphOffset:b})}return a}const $1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,Q1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_TEXT_OFFSETS) in vec2 a_textOffsets;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);

  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,{isEqual:Zm}=Kn;function J1(e){const t=this,r=e.id,i=[],a=[];if(!t.glyphInfoMap||!t.glyphInfoMap[r])return{vertices:[],indices:[],size:7};const u=t.glyphInfoMap[r].centroid,f=u.length===2?[u[0],u[1],0]:u;return t.glyphInfoMap[r].glyphQuads.forEach((m,_)=>{i.push(...f,m.tex.x,m.tex.y+m.tex.height,m.tl.x,m.tl.y,...f,m.tex.x+m.tex.width,m.tex.y+m.tex.height,m.tr.x,m.tr.y,...f,m.tex.x+m.tex.width,m.tex.y,m.br.x,m.br.y,...f,m.tex.x,m.tex.y,m.bl.x,m.bl.y),a.push(0+_*4,1+_*4,2+_*4,2+_*4,3+_*4,0+_*4)}),{vertices:i,indices:a,size:7}}class ex extends Co{constructor(...t){var r;super(...t),r=this,(0,D.Z)(this,"glyphInfo",void 0),(0,D.Z)(this,"glyphInfoMap",{}),(0,D.Z)(this,"rawEncodeData",void 0),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"currentZoom",-1),(0,D.Z)(this,"extent",void 0),(0,D.Z)(this,"textureHeight",0),(0,D.Z)(this,"textCount",0),(0,D.Z)(this,"preTextStyle",{}),(0,D.Z)(this,"mapping",(0,Xt.Z)(function*(){r.initGlyph(),r.updateTexture(),yield r.reBuildModel()}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,TEXT_OFFSETS:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){const{stroke:t="#fff",strokeWidth:r=0,halo:i=.5,gamma:a=2,raisingHeight:u=0}=this.layer.getLayerConfig(),f=this.getFontServiceMapping(),m=this.getFontServiceCanvas();f&&Object.keys(f).length!==this.textCount&&m&&(this.updateTexture(),this.textCount=Object.keys(f).length),this.preTextStyle=this.getTextStyle();const _={u_stroke_color:ti(t),u_sdf_map_size:[(m==null?void 0:m.width)||1,(m==null?void 0:m.height)||1],u_raisingHeight:Number(u),u_stroke_width:r,u_gamma_scale:a,u_halo_blur:i};return this.getUniformsBufferInfo(_)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.bindEvent(),t.extent=t.textExtent(),t.rawEncodeData=t.layer.getEncodedData(),t.preTextStyle=t.getTextStyle(),t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{textAllowOverlap:r=!1}=t.layer.getLayerConfig();return t.initGlyph(),t.updateTexture(),r||t.filterGlyphs(),[yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:Q1,fragmentShader:$1,defines:t.getDefines(),inject:t.getInject(),triangulation:J1.bind(t),depth:{enable:!1}})]})()}needUpdate(){var t=this;return(0,Xt.Z)(function*(){const{textAllowOverlap:r=!1,textAnchor:i="center",textOffset:a,padding:u,fontFamily:f,fontWeight:m}=t.getTextStyle();if(!Zm(u,t.preTextStyle.padding)||!Zm(a,t.preTextStyle.textOffset)||!Zm(i,t.preTextStyle.textAnchor)||!Zm(f,t.preTextStyle.fontFamily)||!Zm(m,t.preTextStyle.fontWeight))return yield t.mapping(),!0;if(r)return!1;const _=t.mapService.getZoom(),b=t.mapService.getBounds(),A=zr(t.extent,b);return Math.abs(t.currentZoom-_)>.5||!A||r!==t.preTextStyle.textAllowOverlap?(yield t.reBuildModel(),!0):!1})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Ot.Attribute,descriptor:{shaderLocation:this.attributeLocation.TEXT_OFFSETS,name:"a_textOffsets",buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:2,update:(t,r,i)=>[i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Ot.Attribute,descriptor:{name:"a_tex",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=12}=t;return Array.isArray(r)?[r[0]]:[r]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}textExtent(){const t=this.mapService.getBounds();return ec(t,.5)}initTextFont(){const{fontWeight:t,fontFamily:r}=this.getTextStyle(),i=this.rawEncodeData,a=[];i.forEach(u=>{let{shape:f=""}=u;f=f.toString();for(const m of f)a.indexOf(m)===-1&&a.push(m)}),this.fontService.setFontOptions({characterSet:a,fontWeight:t,fontFamily:r,iconfont:!1})}initIconFontTex(){const{fontWeight:t,fontFamily:r}=this.getTextStyle(),i=this.rawEncodeData,a=[];i.forEach(u=>{let{shape:f=""}=u;f=`${f}`,a.indexOf(f)===-1&&a.push(f)}),this.fontService.setFontOptions({characterSet:a,fontWeight:t,fontFamily:r,iconfont:!0})}getTextStyle(){const{fontWeight:t="400",fontFamily:r="sans-serif",textAllowOverlap:i=!1,padding:a=[0,0],textAnchor:u="center",textOffset:f=[0,0],opacity:m=1,strokeOpacity:_=1,strokeWidth:b=0,stroke:A="#000"}=this.layer.getLayerConfig();return{fontWeight:t,fontFamily:r,textAllowOverlap:i,padding:a,textAnchor:u,textOffset:f,opacity:m,strokeOpacity:_,strokeWidth:b,stroke:A}}generateGlyphLayout(t){const r=this.getFontServiceMapping(),{spacing:i=2,textAnchor:a="center",textOffset:u}=this.layer.getLayerConfig(),f=this.rawEncodeData;this.glyphInfo=f.map(m=>{const{shape:_="",id:b,size:A=1}=m,C=m.textOffset?m.textOffset:u||[0,0],R=m.textAnchor?m.textAnchor:a||"center",U=Ow(_.toString(),r,A,R,"left",i,C,t),X=Pw(U,C,!1);return m.shaping=U,m.glyphQuads=X,m.centroid=Ja(m.coordinates),this.glyphInfoMap[b]={shaping:U,glyphQuads:X,centroid:Ja(m.coordinates)},m})}getFontServiceMapping(){const{fontWeight:t="400",fontFamily:r="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${r}_${t}`)}getFontServiceCanvas(){const{fontWeight:t="400",fontFamily:r="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${r}_${t}`)}filterGlyphs(){const{padding:t=[0,0],textAllowOverlap:r=!1}=this.layer.getLayerConfig();if(r)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();const{width:i,height:a}=this.rendererService.getViewportSize(),u=new Rw(i,a);this.glyphInfo.filter(m=>{const{shaping:_,id:b=0}=m,A=m.centroid,R=m.size/16,U=this.mapService.lngLatToContainer(A),{box:X}=u.placeCollisionBox({x1:_.left*R-t[0],x2:_.right*R+t[0],y1:_.top*R-t[1],y2:_.bottom*R+t[1],anchorPointX:U.x,anchorPointY:U.y});return X&&X.length?(u.insertCollisionBox(X,b),!0):!1}).forEach(m=>{this.glyphInfoMap[m.id]=m})}initGlyph(){const{iconfont:t=!1}=this.layer.getLayerConfig();t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}updateTexture(){const{createTexture2D:t}=this.rendererService,r=this.getFontServiceCanvas();this.textureHeight=r.height,this.texture&&this.texture.destroy(),this.texture=t({data:r,mag:O.LINEAR,min:O.LINEAR,width:r.width,height:r.height}),this.textures=[this.texture]}reBuildModel(){var t=this;return(0,Xt.Z)(function*(){t.filterGlyphs();const r=yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:Q1,fragmentShader:$1,triangulation:J1.bind(t),defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}});t.layer.models=[r]})()}}var Lw={fillImage:_w,fill:H1,radar:Sw,image:X1,normal:G1,simplePoint:iw,extrude:j1,text:ex,earthFill:hw,earthExtrude:uw};class pg extends qf{constructor(...t){super(...t),(0,D.Z)(this,"type","PointLayer"),(0,D.Z)(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,D.Z)(this,"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,D.Z)(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}})}buildModels(){var t=this;return(0,Xt.Z)(function*(){const r=t.getModelType();t.layerModel&&t.layerModel.clearModels(),t.layerModel=new Lw[r](t),yield t.initLayerModels()})()}rebuildModels(){var t=this;return(0,Xt.Z)(function*(){yield t.buildModels()})()}getModelTypeWillEmptyData(){if(this.shapeOption){const{field:t,values:r}=this.shapeOption,{shape2d:i}=this.getLayerConfig(),a=this.iconService.getIconMap();if(t&&(i==null?void 0:i.indexOf(t))!==-1)return"fill";if(r==="text")return"text";if(r&&r instanceof Array){for(const u of r)if(typeof u=="string"&&a.hasOwnProperty(u))return"image"}}return"normal"}getDefaultConfig(){const t=this.getModelType();return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[t]}getModelType(){const t=this.getEncodedData(),{shape2d:r,shape3d:i,billboard:a=!0}=this.getLayerConfig(),u=this.iconService.getIconMap(),f=t.find(m=>m.hasOwnProperty("shape"));if(f){const m=f.shape;return m==="dot"?"normal":m==="simple"?"simplePoint":m==="radar"?"radar":this.layerType==="fillImage"||a===!1?"fillImage":(r==null?void 0:r.indexOf(m))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(i==null?void 0:i.indexOf(m))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":u.hasOwnProperty(m)?"image":"text"}else return this.getModelTypeWillEmptyData()}}function Dw(e){return N_.apply(this,arguments)}function N_(){return N_=(0,Xt.Z)(function*(e){if(window.createImageBitmap){const t=yield fetch(e);return yield createImageBitmap(yield t.blob())}else{const t=new window.Image;return new Promise(r=>{t.onload=()=>r(t),t.src=e,t.crossOrigin="Anonymous"})}}),N_.apply(this,arguments)}const Bw=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,Fw=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,Nw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);

  if (u_heightfixed > 0.0) {
    // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(project_pos);
  v_texture_data = vec2(a_Position.z, lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,Uw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float isSide = a_Position.z;
  float topU = a_uvs[0];
  float topV = 1.0 - a_uvs[1];
  float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);

  if (u_heightfixed > 0.0) {
    // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

 gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if (isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,kw=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if (isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,zw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if (u_heightfixed > 0.0) {
    // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class Vw extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{mapTexture:t,heightfixed:r=!1,raisingHeight:i=0,topsurface:a=!0,sidesurface:u=!0,sourceColor:f,targetColor:m}=this.layer.getLayerConfig();let _=0,b=[1,1,1,1],A=[1,1,1,1];f&&m&&(b=ti(f),A=ti(m),_=1);const C={u_sourceColor:b,u_targetColor:A,u_linearColor:_,u_topsurface:Number(a),u_sidesurface:Number(u),u_heightfixed:Number(r),u_raisingHeight:Number(i)};return t&&this.texture&&(C.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(C)}initModels(){var t=this;return(0,Xt.Z)(function*(){return yield t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{frag:r,vert:i,type:a}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),triangulation:L_})]})()}getShaders(){const{pickLight:t,mapTexture:r}=this.layer.getLayerConfig();return r?{frag:kw,vert:zw,type:"polygonExtrudeTexture"}:t?{frag:Fw,vert:Nw,type:"polygonExtrudePickLight"}:{frag:Bw,vert:Uw,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.textures=[]}registerBuiltinAttributes(){const t=this.layer.getSource().extent,r=t[2]-t[0],i=t[3]-t[1];this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Ot.Attribute,descriptor:{name:"a_uvs",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(a,u,f)=>{const m=f[0],_=f[1];return[(m-t[0])/r,(_-t[1])/i,f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ot.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(a,u,f,m,_)=>_}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:a=>{const{size:u=10}=a;return Array.isArray(u)?[u[0]]:[u]}}})}loadTexture(){var t=this;return(0,Xt.Z)(function*(){const{mapTexture:r}=t.layer.getLayerConfig(),{createTexture2D:i}=t.rendererService;if(t.texture=i({height:1,width:1}),r){const a=yield Dw(r);t.texture=i({data:a,width:a.width,height:a.height,wrapS:O.CLAMP_TO_EDGE,wrapT:O.CLAMP_TO_EDGE,min:O.LINEAR,mag:O.LINEAR})}})()}}const Zw=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,jw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class Hw extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,EXTRUSION_BASE:11})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const t={};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{frag:r,vert:i,type:a}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:r,defines:t.getDefines(),inject:t.getInject(),triangulation:L_,depth:{enable:!0}})]})()}getShaders(){return{frag:Zw,vert:jw,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ot.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(t,r,i,a,u)=>u}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ot.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{size:r=10}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrusionBase",type:Ot.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:this.attributeLocation.EXTRUSION_BASE,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:1,update:t=>{const{extrusionBase:r=0}=t;return[r]}}})}}const Xw=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,Ww=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,Gw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_LINEAR) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}
`,Yw=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  project_pos.z += u_raisingHeight;

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`;class qw extends Co{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,LINEAR:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,opacityLinear:r={enable:!1,dir:"in"}}=this.layer.getLayerConfig(),i={u_raisingHeight:Number(t),u_opacitylinear:Number(r.enable),u_dir:r.dir==="in"?1:0};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){const{frag:r,vert:i,triangulation:a,type:u}=t.getModelParams();return t.initUniformsBuffer(),t.layer.triangulation=a,[yield t.layer.buildLayerModel({moduleName:u,vertexShader:i,fragmentShader:r,defines:t.getDefines(),inject:t.getInject(),triangulation:a,primitive:O.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute();const{opacityLinear:t={enable:!1,dir:"in"}}=this.layer.getLayerConfig();t.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Ot.Attribute,descriptor:{name:"a_linear",shaderLocation:this.attributeLocation.LINEAR,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:3,update:(r,i,a)=>[a[3],a[4],a[5]]}})}getModelParams(){const{opacityLinear:t={enable:!1}}=this.layer.getLayerConfig();return t.enable?{frag:Ww,vert:Gw,type:"polygonLinear",triangulation:jS}:{frag:Xw,vert:Yw,type:"polygonFill",triangulation:Vm}}}const Kw=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,$w=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class Qw extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture1",void 0),(0,D.Z)(this,"texture2",void 0),(0,D.Z)(this,"texture3",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{watercolor:t="#6D99A8",watercolor2:r="#0F121C"}=this.layer.getLayerConfig(),i={u_watercolor:ti(t),u_watercolor2:ti(r),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(i)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:$w,fragmentShader:Kw,defines:t.getDefines(),inject:t.getInject(),triangulation:Vm,primitive:O.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t,r,i;(t=this.texture1)===null||t===void 0||t.destroy(),(r=this.texture2)===null||r===void 0||r.destroy(),(i=this.texture3)===null||i===void 0||i.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[r,i,a,u]=t,f=a-r,m=u-i;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Ot.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:2,update:(_,b,A)=>{const[C,R]=A;return[(C-r)/f,(R-i)/m]}}})}loadTexture(){const{createTexture2D:t}=this.rendererService,r={height:0,width:0};this.texture1=t(r),this.texture2=t(r),this.texture3=t(r),i(u=>{this.texture1=a(u[0]),this.texture2=a(u[1]),this.texture3=a(u[2]),this.layerService.reRender()});function i(u){let f=0;const m=[];["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map(b=>{const A=new Image;A.crossOrigin="",A.src=b,m.push(A),A.onload=()=>{f++,f===3&&u(m)}})}function a(u){return t({data:u,width:u.width,height:u.height,wrapS:O.MIRRORED_REPEAT,wrapT:O.MIRRORED_REPEAT,min:O.LINEAR,mag:O.LINEAR})}}}const Jw=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,eC=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class tC extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{speed:t=.5}=this.layer.getLayerConfig(),r={u_speed:t,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(r)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:eC,fragmentShader:Jw,triangulation:Vm,defines:t.getDefines(),inject:t.getInject(),primitive:O.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[r,i,a,u]=t,f=a-r,m=u-i;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Ot.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.STATIC_DRAW,data:[],type:O.FLOAT},size:2,update:(_,b,A)=>{const[C,R]=A;return[(C-r)/f,(R-i)/m]}}})}loadTexture(){const{waterTexture:t}=this.layer.getLayerConfig(),{createTexture2D:r}=this.rendererService;this.texture=r({height:1,width:1});const i=new Image;i.crossOrigin="",t?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),i.src=t):i.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",i.onload=()=>{this.texture=r({data:i,width:i.width,height:i.height,wrapS:O.MIRRORED_REPEAT,wrapT:O.MIRRORED_REPEAT,min:O.LINEAR,mag:O.LINEAR}),this.layerService.reRender()}}}var rC={fill:qw,line:V1,extrude:Vw,text:ex,point_fill:H1,point_image:X1,point_normal:G1,point_extrude:j1,water:tC,ocean:Qw,extrusion:Hw};class dg extends qf{constructor(...t){super(...t),(0,D.Z)(this,"type","PolygonLayer"),(0,D.Z)(this,"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"])}buildModels(){var t=this;return(0,Xt.Z)(function*(){const r=t.getModelType();t.layerModel=new rC[r](t),yield t.initLayerModels()})()}getModelType(){var t;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),i=r==null||(t=r.scale)===null||t===void 0?void 0:t.field;return i==="fill"||!i?"fill":i==="extrude"?"extrude":i==="extrusion"?"extrusion":i==="water"?"water":i==="ocean"?"ocean":i==="line"?"line":this.getPointModelType()}getPointModelType(){const t=this.getEncodedData(),{shape2d:r,shape3d:i}=this.getLayerConfig(),a=this.iconService.getIconMap(),u=t.find(f=>f.hasOwnProperty("shape"));if(u){const f=u.shape;return f==="dot"?"point_normal":(r==null?void 0:r.indexOf(f))!==-1?"point_fill":(i==null?void 0:i.indexOf(f))!==-1?"point_extrude":a.hasOwnProperty(f)?"point_image":"text"}else return"fill"}}const nC=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,iC=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class tx extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"colorTexture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,clampLow:r=!0,clampHigh:i=!0,noDataValue:a=-9999999,domain:u,rampColors:f}=this.layer.getLayerConfig(),m=u||Eu(f);this.colorTexture=this.layer.textureService.getColorTexture(f,m);const _={u_domain:m,u_opacity:t||1,u_noDataValue:a,u_clampLow:r?1:0,u_clampHigh:(typeof i!="undefined"?i:r)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(_)}getRasterData(t){return(0,Xt.Z)(function*(){if(Array.isArray(t.data))return{data:t.data,width:t.width,height:t.height};{const{rasterData:r,width:i,height:a}=yield t.data;return{data:Array.from(r),width:i,height:a}}})()}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:i,queryVerdorInfo:a}=t.rendererService,u=r.data.dataArray[0],{data:f,width:m,height:_}=yield t.getRasterData(u);return t.texture=i({data:new Float32Array(f),width:m,height:_,format:a()==="WebGL1"?O.LUMINANCE:O.RED,type:O.FLOAT,alignment:1}),[yield t.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:iC,fragmentShader:nC,defines:t.getDefines(),triangulation:hg,primitive:O.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}clearModels(){var t,r;(t=this.texture)===null||t===void 0||t.destroy(),(r=this.colorTexture)===null||r===void 0||r.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{shaderLocation:this.attributeLocation.UV,name:"a_Uv",buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}const oC=["data"],aC=["rasterData"],sC=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,uC=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_rminmax;
  vec2 u_gminmax;
  vec2 u_bminmax;
  float u_opacity;
  float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class lC extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0),(0,D.Z)(this,"dataOption",{})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,noDataValue:r=0}=this.layer.getLayerConfig(),{rMinMax:i=[0,255],gMinMax:a=[0,255],bMinMax:u=[0,255]}=this.dataOption,f={u_rminmax:i,u_gminmax:a,u_bminmax:u,u_opacity:t||1,u_noDataValue:r,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(f)}getRasterData(t){var r=this;return(0,Xt.Z)(function*(){if(Array.isArray(t.data)){const{data:f}=t,m=(0,Le.Z)(t,oC);return r.dataOption=m,(0,_e.Z)({data:f},m)}const i=yield t.data,{rasterData:a}=i,u=(0,Le.Z)(i,aC);return r.dataOption=u,Array.isArray(a)?(0,_e.Z)({data:a},u):(0,_e.Z)({data:Array.from(a)},u)})()}initModels(){var t=this;return(0,Xt.Z)(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:i}=t.rendererService,a=r.data.dataArray[0],{data:u,width:f,height:m}=yield t.getRasterData(a);return t.texture=i({data:new Float32Array(u),width:f,height:m,format:O.RGB,type:O.FLOAT}),[yield t.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:uC,fragmentShader:sC,defines:t.getDefines(),triangulation:hg,primitive:O.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}const cC=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,hC=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec4 u_unpack;
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class fC extends Co{constructor(...t){super(...t),(0,D.Z)(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,clampLow:r=!0,clampHigh:i=!0,noDataValue:a=-9999999,domain:u,rampColors:f,colorTexture:m,rScaler:_=6553.6,gScaler:b=25.6,bScaler:A=.1,offset:C=1e4}=this.layer.getLayerConfig(),R=u||Eu(f);let U=m;m?this.layer.textureService.setColorTexture(m,f,R):U=this.layer.textureService.getColorTexture(f,R);const X={u_unpack:[_,b,A,C],u_domain:R,u_opacity:t||1,u_noDataValue:a,u_clampLow:r,u_clampHigh:typeof i!="undefined"?i:r,u_texture:this.texture,u_colorTexture:U};return this.textures=[this.texture,U],this.getUniformsBufferInfo(X)}initModels(){var t=this;return(0,Xt.Z)(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:i}=t.rendererService,a=yield r.data.images;return t.texture=i({data:a[0],width:a[0].width,height:a[0].height,min:O.LINEAR,mag:O.LINEAR}),[yield t.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:hC,fragmentShader:cC,defines:t.getDefines(),triangulation:hg,primitive:O.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ot.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.DYNAMIC_DRAW,data:[],type:O.FLOAT},size:2,update:(t,r,i)=>[i[3],i[4]]}})}}var pC={raster:tx,rasterRgb:lC,raster3d:tx,rasterTerrainRgb:fC};class mg extends qf{constructor(...t){super(...t),(0,D.Z)(this,"type","RasterLayer")}buildModels(){var t=this;return(0,Xt.Z)(function*(){const r=t.getModelType();t.layerModel=new pC[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[t]}getModelType(){switch(this.layerSource.getParserType()){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}getLegend(t){if(t!=="color")return{type:void 0,field:void 0,items:[]};const r=this.getLayerConfig().rampColors;return L1(r,t)}}class dC{constructor({rendererService:t,layerService:r,parent:i}){(0,D.Z)(this,"tileResource",new Map),(0,D.Z)(this,"rendererService",void 0),(0,D.Z)(this,"layerService",void 0),(0,D.Z)(this,"parent",void 0),(0,D.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=r,this.parent=i}get tiles(){return this.layerTiles}hasTile(t){return this.layerTiles.some(r=>r.key===t)}addTile(t){this.layerTiles.push(t)}getTile(t){return this.layerTiles.find(r=>r.key===t)}getVisibleTileBylngLat(t){return this.layerTiles.find(r=>r.isLoaded&&r.visible&&r.lnglatInBounds(t))}removeTile(t){const r=this.layerTiles.findIndex(a=>a.key===t),i=this.layerTiles.splice(r,1);i[0]&&i[0].destroy()}updateTileVisible(t){const r=this.getTile(t.key);if(t.isVisible)if(t.parent){const i=this.isChildrenLoaded(t.parent);r==null||r.updateVisible(i)}else r==null||r.updateVisible(!0);else if(t.parent){const i=this.isChildrenLoaded(t.parent);r==null||r.updateVisible(!i)}else r==null||r.updateVisible(!1)}isParentLoaded(t){const r=t.parent;if(!r)return!0;const i=this.getTile(r==null?void 0:r.key);return!!(i!=null&&i.isLoaded)}isChildrenLoaded(t){const r=t==null?void 0:t.children;return r.length===0?!0:r.every(i=>{const a=this.getTile(i==null?void 0:i.key);return a?(a==null?void 0:a.isLoaded)===!0:!0})}render(){var t=this;return(0,Xt.Z)(function*(){const i=t.getRenderLayers().map(function(){var a=(0,Xt.Z)(function*(u){yield t.layerService.renderTileLayer(u)});return function(u){return a.apply(this,arguments)}}());yield Promise.all(i)})()}getRenderLayers(){const t=this.layerTiles.filter(i=>i.visible&&i.isLoaded),r=[];return t.map(i=>r.push(...i.getLayers())),r}getLayers(){const t=this.layerTiles.filter(i=>i.isLoaded),r=[];return t.map(i=>r.push(...i.getLayers())),r}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach(t=>t.destroy()),this.tileResource.clear()}}var mC=H(41227);function vC(e,t,r){r===void 0&&(r={});var i=Do(e),a=Do(t),u=mC.union(i.coordinates,a.coordinates);return u.length===0?null:u.length===1?bt(u[0],r.properties):rn(u,r.properties)}var gC=vC;class _C{getCombineFeature(t){let r=null;const i=t[0];return t.map(a=>{const u=bt(a.coordinates);r===null?r=u:r=gC(r,u)}),i&&(r.properties=(0,_e.Z)({},i)),r}}const jm="select",Hm="active";class yC{constructor({layerService:t,tileLayerService:r,parent:i}){(0,D.Z)(this,"layerService",void 0),(0,D.Z)(this,"tileLayerService",void 0),(0,D.Z)(this,"tileSourceService",void 0),(0,D.Z)(this,"parent",void 0),(0,D.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=r,this.parent=i,this.tileSourceService=new _C}pickRender(t){const r=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(r){const i=r.getMainLayer();i==null||i.layerPickService.pickRender(t)}}pick(t,r){var i=this;return(0,Xt.Z)(function*(){const u=i.parent.getContainer().pickingService;if(t.type==="RasterLayer"){const f=i.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(f&&f.getMainLayer()!==void 0){const m=f.getMainLayer();return m.layerPickService.pickRasterLayer(m,r,i.parent)}return!1}return i.pickRender(r),u.pickFromPickingFBO(t,r)})()}selectFeature(t){const[r,i,a]=t,u=this.color2PickId(r,i,a);this.tilePickID.set(jm,u),this.updateHighLight(r,i,a,jm)}highlightPickedFeature(t){const[r,i,a]=t,u=this.color2PickId(r,i,a);this.tilePickID.set(Hm,u),this.updateHighLight(r,i,a,Hm)}updateHighLight(t,r,i,a){this.tileLayerService.tiles.map(u=>{const f=u.getMainLayer();switch(a){case jm:f==null||f.hooks.beforeSelect.call([t,r,i]);break;case Hm:f==null||f.hooks.beforeHighlight.call([t,r,i]);break}})}setPickState(){const t=this.tilePickID.get(jm),r=this.tilePickID.get(Hm);if(t){const[i,a,u]=this.pickId2Color(t);this.updateHighLight(i,a,u,jm);return}if(r){const[i,a,u]=this.pickId2Color(r);this.updateHighLight(i,a,u,Hm);return}}color2PickId(t,r,i){return Es(new Uint8Array([t,r,i]))}pickId2Color(t){return Ns(t)}getFeatureById(t){const r=this.tileLayerService.getTiles().filter(a=>a.visible),i=[];return r.forEach(a=>{i.push(...a.getFeatureById(t))}),i}pickRasterLayer(){return!1}}function xC(e){return e==="PolygonLayer"?dg:e==="LineLayer"?F_:pg}function bC(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}class Vp extends wa.EventEmitter{constructor(t,r){super(),(0,D.Z)(this,"x",void 0),(0,D.Z)(this,"y",void 0),(0,D.Z)(this,"z",void 0),(0,D.Z)(this,"key",void 0),(0,D.Z)(this,"parent",void 0),(0,D.Z)(this,"sourceTile",void 0),(0,D.Z)(this,"visible",!0),(0,D.Z)(this,"layers",[]),(0,D.Z)(this,"isLoaded",!1),(0,D.Z)(this,"tileMaskLayers",[]),(0,D.Z)(this,"tileMask",void 0),this.parent=r,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...t){}lnglatInBounds(t){const[r,i,a,u]=this.sourceTile.bounds,{lng:f,lat:m}=t;return f>=r&&f<=a&&m>=i&&m<=u}getLayerOptions(){var t;const r=this.parent.getLayerConfig();return(0,_e.Z)((0,_e.Z)({},r),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:bC(this.parent.type),mask:r.mask||((t=r.maskLayers)===null||t===void 0?void 0:t.length)!==0&&r.enableMask})}getMaskLayer(){const{maskLayers:t}=this.parent.getLayerConfig(),r=[];return t==null||t.forEach(i=>{if(!i.tileLayer)return r.push(i),i;const u=i.tileLayer.getTile(this.sourceTile.key),f=u==null?void 0:u.getLayers()[0];f&&r.push(f)}),r}addTileMask(){var t=this;return(0,Xt.Z)(function*(){const r=new dg({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[t.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),i=Hf(t.parent.container);r.setContainer(i),yield r.init(),t.tileMask=r;const a=t.getMainLayer();return a!==void 0&&(a.tileMask=r),r})()}addMask(t,r){var i=this;return(0,Xt.Z)(function*(){const a=Hf(i.parent.container);r.setContainer(a),yield r.init(),t.addMask(r),i.tileMaskLayers.push(r)})()}addLayer(t){var r=this;return(0,Xt.Z)(function*(){t.isTileLayer=!0;const i=Hf(r.parent.container);t.setContainer(i),r.layers.push(t),yield t.init()})()}updateVisible(t){this.visible=t,this.updateOptions("visible",t)}updateOptions(t,r){this.layers.forEach(i=>{i.updateLayerConfig({[t]:r})})}getMainLayer(){return this.layers[0]}getFeatures(t){return[]}getFeatureById(t){return[]}destroy(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(r=>r.destroy())}}class EC extends Vp{initTileLayer(){var t=this;return(0,Xt.Z)(function*(){const r=t.getSourceOption(),i=r.data.features[0].properties,a=new F_().source(r.data,r.options).size(1).shape("line").color("red"),u=new pg({minZoom:t.z-1,maxZoom:t.z+1,textAllowOverlap:!0}).source([i],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(t.key).style({stroke:"#fff",strokeWidth:2});yield t.addLayer(a),yield t.addLayer(u),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}class TC extends Vp{initTileLayer(){var t=this;return(0,Xt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),u=new B1((0,_e.Z)({},i)).source(a.data,a.options);r&&Object.keys(r).forEach(f=>{var m,_;const b=f;u[b]((m=r[b])===null||m===void 0?void 0:m.field,(_=r[b])===null||_===void 0?void 0:_.values)}),yield t.addLayer(u),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const AC=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,SC=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class wC extends Co{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,_e.Z)((0,_e.Z)({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,color:r="#000"}=this.layer.getLayerConfig(),i={u_color:ti(r),u_opacity:t||1};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return(0,Xt.Z)(function*(){return t.buildModels()})()}buildModels(){var t=this;return(0,Xt.Z)(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"mask",vertexShader:SC,fragmentShader:AC,defines:t.getDefines(),triangulation:Vm,depth:{enable:!1},pick:!1})]})()}clearModels(t=!0){t&&this.layerService.clear()}registerBuiltinAttributes(){return""}}var CC={fill:wC};class rx extends qf{constructor(...t){super(...t),(0,D.Z)(this,"type","MaskLayer")}buildModels(){var t=this;return(0,Xt.Z)(function*(){const r=t.getModelType();t.layerModel=new CC[r](t),yield t.initLayerModels()})()}getModelType(){return"fill"}}class RC extends Vp{initTileLayer(){var t=this;return(0,Xt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),u=new rx((0,_e.Z)({},i)).source(a.data,a.options);r&&Object.keys(r).forEach(f=>{var m,_;const b=f;u[b]((m=r[b])===null||m===void 0?void 0:m.field,(_=r[b])===null||_===void 0?void 0:_.values)}),yield t.addLayer(u),t.isLoaded=!0})()}getFeatures(t){return t?this.sourceTile.data.getTileData(t):[]}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:r,featureId:i}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:i},transforms:t.transforms}}}}const IC=["rasterData"];class MC extends Vp{initTileLayer(){var t=this;return(0,Xt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),u=new mg((0,_e.Z)({},i)).source(a.data,a.options);r&&Object.keys(r).forEach(f=>{var m,_;const b=f;u[b]((m=r[b])===null||m===void 0?void 0:m.field,(_=r[b])===null||_===void 0?void 0:_.values)}),yield t.addLayer(u),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),r=this.sourceTile.data.data,{rasterData:i}=r,a=(0,Le.Z)(r,IC);return{data:i,options:{parser:(0,_e.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},a),transforms:t.transforms}}}}class OC extends Vp{initTileLayer(){var t=this;return(0,Xt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),u=new mg((0,_e.Z)({},i)).source(a.data,a.options);r&&Object.keys(r).forEach(f=>{var m,_;const b=f;u[b]((m=r[b])===null||m===void 0?void 0:m.field,(_=r[b])===null||_===void 0?void 0:_.values)}),yield t.addLayer(u),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const PC=["rasterData"],LC={positions:[0,1],colors:["#000","#fff"]};class DC extends Vp{constructor(...t){super(...t),(0,D.Z)(this,"colorTexture",void 0)}initTileLayer(){var t=this;return(0,Xt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=t.getSourceOption(),{rampColors:u,domain:f}=t.getLayerOptions();t.colorTexture=t.parent.textureService.getColorTexture(u,f);const m=new mg((0,_e.Z)((0,_e.Z)({},i),{},{colorTexture:t.colorTexture})).source(a.data,a.options);r&&Object.keys(r).forEach(_=>{var b,A;const C=_;m[C]((b=r[C])===null||b===void 0?void 0:b.field,(A=r[C])===null||A===void 0?void 0:A.values)}),yield t.addLayer(m),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),r=this.sourceTile.data.data,{rasterData:i}=r,a=(0,Le.Z)(r,PC);return{data:i,options:{parser:(0,_e.Z)({type:"raster",extent:this.sourceTile.bounds},a),transforms:t.transforms}}}styleUpdate(...t){const{rampColors:r=LC,domain:i}=t;this.colorTexture=this.parent.textureService.getColorTexture(r,i||Eu(r)),this.layers.forEach(a=>a.style({colorTexture:this.colorTexture}))}destroy(){this.layers.forEach(t=>t.destroy())}}class vg extends Vp{initTileLayer(){var t=this;return(0,Xt.Z)(function*(){const r=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),a=xC(t.parent.type),u=t.getSourceOption();if(!u){t.isLoaded=!0,t.emit("loaded");return}const f=new a((0,_e.Z)({},i)).source(u.data,u.options);Object.keys(r).forEach(m=>{var _,b;const A=m;f[A]((_=r[A])===null||_===void 0?void 0:_.field,(b=r[A])===null||b===void 0?void 0:b.values)}),yield t.addLayer(f),i.tileMask&&(yield t.addTileMask()),t.setLayerMinMaxZoom(f),t.isLoaded=!0,t.emit("loaded")})()}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:r="defaultLayer",featureId:i="id"}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:i},transforms:t.transforms}}}setLayerMinMaxZoom(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(t){return this.sourceTile.data.getTileData(t)}getFeatureById(t){const r=this.getMainLayer();return r?r.getSource().data.dataArray.filter(a=>a._id===t):[]}}function BC(e){switch(e.type){case"PolygonLayer":return vg;case"LineLayer":return vg;case"PointLayer":return vg;case"TileDebugLayer":return EC;case"MaskLayer":return RC;case"RasterLayer":const{dataType:r}=e.getSource().parser;switch(r){case Ps.RGB:case Ps.CUSTOMRGB:return MC;case Ps.ARRAYBUFFER:case Ps.CUSTOMARRAYBUFFER:return DC;case Ps.TERRAINRGB:case Ps.CUSTOMTERRAINRGB:return OC;default:return TC}default:return vg}}const FC=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],{debounce:NC}=Kn;class UC{constructor(t){(0,D.Z)(this,"parent",void 0),(0,D.Z)(this,"tileLayerService",void 0),(0,D.Z)(this,"mapService",void 0),(0,D.Z)(this,"layerService",void 0),(0,D.Z)(this,"rendererService",void 0),(0,D.Z)(this,"pickingService",void 0),(0,D.Z)(this,"tilePickService",void 0),(0,D.Z)(this,"tilesetManager",void 0),(0,D.Z)(this,"initedTileset",!1),(0,D.Z)(this,"lastViewStates",void 0),(0,D.Z)(this,"mapchange",()=>{var i;if(this.parent.isVisible()===!1)return;const{latLonBounds:a,zoom:u}=this.getCurrentView();this.lastViewStates&&this.lastViewStates.zoom===u&&this.lastViewStates.latLonBounds.toString()===a.toString()||(this.lastViewStates={zoom:u,latLonBounds:a},(i=this.tilesetManager)===null||i===void 0||i.throttleUpdate(u,a))}),(0,D.Z)(this,"viewchange",NC(this.mapchange,24)),this.parent=t;const r=this.parent.getContainer();this.rendererService=r.rendererService,this.layerService=r.layerService,this.mapService=r.mapService,this.pickingService=r.pickingService,this.tileLayerService=new dC({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new yC({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}initTileSetManager(){var t;const r=this.parent.getSource();if(this.tilesetManager=r.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()===!1)return;const{latLonBounds:i,zoom:a}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(a,i)}getCurrentView(){const t=this.mapService.getBounds(),r=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:r,zoom:i}}bindTilesetEvent(){this.tilesetManager.on("tile-loaded",t=>{}),this.tilesetManager.on("tile-unload",t=>{this.tileUnLoad(t)}),this.tilesetManager.on("tile-error",(t,r)=>{this.tileError(t)}),this.tilesetManager.on("tile-update",()=>{this.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(t){return this.tileLayerService.getTile(t)}tileLoaded(t){}tileError(t){console.warn("error:",t)}destroy(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}reload(){var t;this.tilesetManager.clear();const{latLonBounds:r,zoom:i}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(i,r)}tileUnLoad(t){this.tileLayerService.removeTile(t.key)}tileUpdate(){var t=this;return(0,Xt.Z)(function*(){if(!t.tilesetManager)return;const r=t.parent.getMinZoom(),i=t.parent.getMaxZoom(),a=t.tilesetManager.tiles.filter(u=>u.isLoaded).filter(u=>u.isVisibleChange).filter(u=>u.data).filter(u=>u.z>=r&&u.z<i);yield Promise.all(a.map(function(){var u=(0,Xt.Z)(function*(f){if(t.tileLayerService.hasTile(f.key))t.tileLayerService.updateTileVisible(f),t.tilePickService.setPickState(),t.layerService.reRender();else{const m=BC(t.parent),_=new m(f,t.parent);yield _.initTileLayer(),t.tilePickService.setPickState(),_.getLayers().length!==0&&(t.tileLayerService.addTile(_),t.tileLayerService.updateTileVisible(f),t.layerService.reRender())}});return function(f){return u.apply(this,arguments)}}())),t.tilesetManager.isLoaded&&t.parent.emit("tiles-loaded",t.tilesetManager.currentTiles)})()}setPickState(t){}pickRender(t){this.tilePickService.pickRender(t)}selectFeature(t){this.tilePickService.selectFeature(t)}highlightPickedFeature(t){this.tilePickService.highlightPickedFeature(t)}proxy(t){FC.forEach(r=>{const i=t[r].bind(t);t[r]=(...a)=>(i(...a),this.getLayers().map(u=>{u[r](...a)}),r==="style"&&this.getTiles().forEach(u=>u.styleUpdate(...a)),t)})}}class _5 extends null{constructor(...t){super(...t),_defineProperty(this,"isMoving",!1),_defineProperty(this,"maskLayer",void 0),_defineProperty(this,"move",r=>{switch(r.stopPropagation(),r.type){case"touchcancel":case"touchend":case"mouseup":{var i;this.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(a=>{document.removeEventListener(a,this.move)}),(i=this.scene)===null||i===void 0||i.render();break}case"mousedown":case"touchstart":this.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach(a=>{document.addEventListener(a,this.move)});case"mousemove":case"touchmove":{if(this.isMoving)if(this.controlOption.orientation==="vertical"){let a;if("pageX"in r?a=r.pageX:r.touches&&r.touches.length&&r.touches[0].pageX?a=r.touches[0].pageX:r.changedTouches&&r.changedTouches.length&&(a=r.changedTouches[0].pageX),!a)break;const u=this.getContainerDOMRect(),f=this.getContainerSize(),m=f[0],_=(u==null?void 0:u.left)||0,b=a-_+window.scrollX-document.documentElement.clientLeft,A=m-Math.min(Math.max(0,m-b),m),C=A/m;this.setOptions({ratio:C}),this.emit("moving",{size:[A,f[1]],ratio:[C,0]})}else{let a;if("pageY"in r?a=r.pageY:r.touches&&r.touches.length&&r.touches[0].pageY?a=r.touches[0].pageY:r.changedTouches&&r.changedTouches.length&&(a=r.changedTouches[0].pageY),!a)break;const u=this.getContainerDOMRect(),f=this.getContainerSize(),m=f[1],_=(u==null?void 0:u.top)||0,b=a-_+window.scrollY-document.documentElement.clientTop,A=m-Math.min(Math.max(0,m-b),m),C=A/m;this.setOptions({ratio:C}),this.emit("moving",{size:[f[0],A],ratio:[0,C]})}break}default:break}}),_defineProperty(this,"getMaskLayer",()=>(console.log(this.getMaskGeoData()),new PolygonLayer({visible:!1}).source(this.getMaskGeoData()).shape("fill").color("red").style({opacity:.1}))),_defineProperty(this,"updateMask",()=>{var r;if(!this.mapsService)return;const i=this.getMaskGeoData();(r=this.maskLayer)===null||r===void 0||r.setData(i)})}getDefault(){return _objectSpread(_objectSpread({},super.getDefault()),{},{layers:[],rightLayers:[],ratio:.5,orientation:"vertical"})}onAdd(){const t=DOM.create("div","l7-control-swipe");DOM.create("button","l7-control-swipe__button",t);const{orientation:r="vertical",ratio:i=.5}=this.controlOption;return r==="horizontal"?(t.style.top=i*100+"%",t.style.left=""):(t.style.left=i*100+"%",t.style.top=""),t.classList.add(r),t}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd();const{className:r,style:i,layers:a,rightLayers:u}=this.controlOption;r&&this.setClassName(r),i&&this.setStyle(i),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.registerEvent();const f=createLayerContainer(t);return this.maskLayer.setContainer(f),this.scene.addLayer(this.maskLayer),this.addMaskToLayers(a,!1),this.addMaskToLayers(u,!0),this.emit("add",this),this}onRemove(){if(this.maskLayer){var t;const{layers:r,rightLayers:i}=this.controlOption;this.removeMaskFromLayers(r),this.removeMaskFromLayers(i),(t=this.layerService)===null||t===void 0||t.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}show(){var t;const r=this.container;DOM.removeClass(r,"l7-control-swipe_hide");const{layers:i,rightLayers:a}=this.controlOption;i.forEach(u=>u.enableMask()),a.forEach(u=>u.enableMask()),(t=this.scene)===null||t===void 0||t.render(),this.isShow=!0,this.emit("show",this)}hide(){var t;const r=this.container;DOM.addClass(r,"l7-control-swipe_hide");const{layers:i,rightLayers:a}=this.controlOption;i.forEach(u=>u.disableMask()),a.forEach(u=>u.disableMask()),(t=this.scene)===null||t===void 0||t.render(),this.isShow=!1,this.emit("hide",this)}setOptions(t){const r=_objectSpread(_objectSpread({},this.controlOption),t);if(t.className&&this.setClassName(t.className),t.style&&this.setStyle(t.style),(t.orientation||t.ratio!==void 0)&&this.setOrientationAndRatio(r.orientation,r.ratio),t.layers){const i=t.layers,a=this.controlOption.layers;this.setLayers(i,a,!1)}if(t.rightLayers){const i=t.rightLayers,a=this.controlOption.rightLayers;this.setLayers(i,a,!0)}this.controlOption=r,this.updateMask()}registerEvent(){this.container.addEventListener("mousedown",this.move),this.container.addEventListener("touchstart",this.move),this.mapsService.on("camerachange",this.updateMask)}unRegisterEvent(){var t;this.container.removeEventListener("mousedown",this.move),this.container.removeEventListener("touchstart",this.move),(t=this.mapsService)===null||t===void 0||t.off("camerachange",this.updateMask)}setOrientationAndRatio(t="vertical",r=.5){this.container.classList.remove("horizontal","vertical"),this.container.classList.add(t),t==="horizontal"?(this.container.style.top=r*100+"%",this.container.style.left=""):(this.container.style.left=r*100+"%",this.container.style.top="")}setLayers(t,r,i=!1){const a=t.filter(f=>r.includes(f)===!1),u=r.filter(f=>t.includes(f)===!1);this.addMaskToLayers(a,i),this.removeMaskFromLayers(u)}addMaskToLayers(t,r){t.forEach(i=>{i.updateLayerConfig({maskInside:!r}),i.addMask(this.maskLayer)})}removeMaskFromLayers(t){t.forEach(r=>{r.updateLayerConfig({maskInside:!0}),r.removeMask(this.maskLayer)})}getMaskGeoData(){const{ratio:t=.5,orientation:r="vertical"}=this.controlOption,i=r==="vertical",[a,u]=this.getBounds(),[f,m]=a,[_,b]=u;let A;if(i){const R=f+(_-f)*t;A=[[f,b],[R,b],[R,m],a,[f,b]]}else{const R=this.getContainerSize(),X=this.mapsService.containerToLngLat([R[0],R[1]*t]).lat;A=[[f,b],u,[_,X],[f,X],[f,b]]}return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[A]}}]}}getContainerDOMRect(){var t;return(t=this.mapsService.getContainer())===null||t===void 0?void 0:t.getBoundingClientRect()}getContainerSize(){return this.mapsService.getSize()}getBounds(){return this.mapsService.getBounds()}addLayer(t,r=!1){const i=Array.isArray(t)?t:[t];if(r){const a=this.controlOption.rightLayers.concat(...i);this.setOptions({rightLayers:a})}else{const a=this.controlOption.layers.concat(...i);this.setOptions({layers:a})}}removeLayer(t){const r=Array.isArray(t)?t:[t],i=this.controlOption.layers.filter(u=>r.includes(u)),a=this.controlOption.rightLayers.filter(u=>r.includes(u));this.setOptions({layers:i,rightLayers:a})}removeLayers(){this.setOptions({layers:[],rightLayers:[]})}}class kC extends rf{constructor(...t){super(...t),(0,D.Z)(this,"disabled",void 0),(0,D.Z)(this,"zoomInButton",void 0),(0,D.Z)(this,"zoomOutButton",void 0),(0,D.Z)(this,"zoomNumDiv",void 0),(0,D.Z)(this,"zoomIn",()=>{!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}),(0,D.Z)(this,"zoomOut",()=>{!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}),(0,D.Z)(this,"updateDisabled",()=>{const r=this.mapsService;this.zoomInButton.removeAttribute("disabled"),this.zoomOutButton.removeAttribute("disabled"),(this.disabled||r.getZoom()<=r.getMinZoom())&&this.zoomOutButton.setAttribute("disabled","true"),this.controlOption.showZoom&&this.zoomNumDiv&&(this.zoomNumDiv.innerText=String(Math.floor(r.getZoom()))),(this.disabled||r.getZoom()>=r.getMaxZoom())&&this.zoomInButton.setAttribute("disabled","true")})}getDefault(t){return(0,_e.Z)((0,_e.Z)({},super.getDefault(t)),{},{position:Qe.BOTTOMRIGHT,name:"zoom",zoomInText:nf("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:nf("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}onAdd(){const t=Mi("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}onRemove(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}disable(){return this.disabled=!0,this.updateDisabled(),this}enable(){return this.disabled=!1,this.updateDisabled(),this}resetButtonGroup(t){sl(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}createButton(t,r,i,a,u){const f=Mi("button",i,a);return typeof t=="string"?f.innerHTML=t:f.append(t),f.title=r,u&&f.addEventListener("click",u),f}}class nx extends wa.EventEmitter{get lngLat(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}}set lngLat(t){this.popupOption.lngLat=t}constructor(t){super(),(0,D.Z)(this,"popupOption",void 0),(0,D.Z)(this,"mapsService",void 0),(0,D.Z)(this,"sceneService",void 0),(0,D.Z)(this,"layerService",void 0),(0,D.Z)(this,"scene",void 0),(0,D.Z)(this,"closeButton",void 0),(0,D.Z)(this,"container",void 0),(0,D.Z)(this,"content",void 0),(0,D.Z)(this,"contentTitle",void 0),(0,D.Z)(this,"contentPanel",void 0),(0,D.Z)(this,"tip",void 0),(0,D.Z)(this,"isShow",!0),(0,D.Z)(this,"onMouseMove",i=>{var a;const u=this.mapsService.getMapContainer(),{left:f=0,top:m=0}=(a=u==null?void 0:u.getBoundingClientRect())!==null&&a!==void 0?a:{};this.setPopupPosition(i.clientX-f,i.clientY-m)}),(0,D.Z)(this,"updateLngLatPosition",()=>{if(!this.mapsService||this.popupOption.followCursor)return;const{lng:i,lat:a}=this.lngLat,{x:u,y:f}=this.mapsService.lngLatToContainer([i,a]);this.setPopupPosition(u,f)}),(0,D.Z)(this,"updateLngLatPositionWhenZoom",i=>{if(!this.mapsService||this.popupOption.followCursor)return;const a=i.map,u=a.getSize();u.x=u.x/2,u.y=u.y/2;const f=i.center,m=i.zoom,_=a.DE(this.lngLat,m,f);_.x=Math.round(_.x),_.y=Math.round(_.y),this.setPopupPosition(_.x,_.y,!0)}),(0,D.Z)(this,"onKeyDown",i=>{i.keyCode===27&&this.remove()}),(0,D.Z)(this,"onCloseButtonClick",i=>{i.stopPropagation&&i.stopPropagation(),this.hide()}),(0,D.Z)(this,"updatePosition",(i,a=!0)=>{const u=!!this.lngLat,{className:f,style:m,maxWidth:_,anchor:b,stopPropagation:A}=this.popupOption;if(!this.mapsService||!u||!this.content)return;const C=this.mapsService.getMarkerContainer();if(!this.container&&C&&(this.container=Mi("div",`l7-popup ${f!=null?f:""} ${this.isShow?"":"l7-popup-hide"}`,C),m&&this.container.setAttribute("style",m),this.tip=Mi("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(R=>{this.container.addEventListener(R,U=>{U.stopPropagation()})}),this.container.style.whiteSpace="nowrap"),a?this.updateLngLatPositionWhenZoom(i):this.updateLngLatPosition(),sh(this.container,`${oi[b]}`),bo(this.container,b,"popup"),_){const{width:R}=this.container.getBoundingClientRect();R>parseFloat(_)&&(this.container.style.width=_)}else this.container.style.removeProperty("width")}),(0,D.Z)(this,"updateWhenZoom",i=>{this.updatePosition(i,!0)}),(0,D.Z)(this,"update",()=>{this.updatePosition(null,!1)}),this.popupOption=(0,_e.Z)((0,_e.Z)({},this.getDefault(t!=null?t:{})),t);const{lngLat:r}=this.popupOption;r&&(this.lngLat=r)}getIsShow(){return this.isShow}addTo(t){this.mapsService=t.mapService,this.sceneService=t.sceneService,this.layerService=t.layerService,this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();const{html:r,text:i,title:a}=this.popupOption;return r?this.setHTML(r):i&&this.setText(i),a&&this.setTitle(a),this.emit("open"),this}remove(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&la(this.content),this.container&&(la(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}getOptions(){return this.popupOption}setOptions(t){this.show();const{className:r}=this.popupOption;if(this.popupOption=(0,_e.Z)((0,_e.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","lngLat","offsets"])&&(this.container&&(la(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["className"])){var i;r&&this.container.classList.remove(r!=null?r:""),this.container.classList.add((i=t.className)!==null&&i!==void 0?i:"")}if(this.checkUpdateOption(t,["style"])){var a;al(this.container,(a=t.style)!==null&&a!==void 0?a:"")}return this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}open(){return this.addTo(this.scene),this}close(){return this.remove(),this}show(){if(!this.isShow)return this.container&&As(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}hide(){if(this.isShow)return this.container&&Sa(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}setHTML(t){return this.popupOption.html=t,this.setDOMContent(t)}setText(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}setTitle(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=Mi("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),sl(this.contentTitle),wc(this.contentTitle,t)):this.contentTitle&&(la(this.contentTitle),this.contentTitle=void 0)}panToPopup(){const{lng:t,lat:r}=this.lngLat;return this.popupOption.autoPan&&this.mapsService.panTo([t,r]),this}setLngLat(t){return this.setLnglat(t)}setLnglat(t){return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(()=>{this.panToPopup()},0),this}getLnglat(){return this.lngLat}setMaxWidth(t){return this.popupOption.maxWidth=t,this.update(),this}isOpen(){return!!this.mapsService}getDefault(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Jn.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}setDOMContent(t){return this.show(),this.createContent(),wc(this.contentPanel,t),this.update(),this}updateCloseOnClick(t){const r=this.mapsService;r&&(r==null||r.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(()=>{r==null||r.on("click",this.onCloseButtonClick)}))}updateCloseOnEsc(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}updateFollowCursor(t){var r;const i=(r=this.mapsService)===null||r===void 0?void 0:r.getContainer();i&&(i==null||i.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(i==null||i.addEventListener("mousemove",this.onMouseMove)))}createContent(){if(this.content&&la(this.content),this.contentTitle=void 0,this.content=Mi("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){const t=nf("l7-icon-guanbi");Sa(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",()=>{this.hide()}),t.addEventListener("pointerup",r=>{r.stopPropagation()}),t.addEventListener("pointerdown",r=>{r.stopPropagation()}),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=Mi("div","l7-popup-content__panel",this.content)}setPopupPosition(t,r,i=!1){if(this.container){const{offsets:a}=this.popupOption;this.container.style.left=t+a[0]+"px",this.container.style.top=r-a[1]+"px",i?this.container.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":this.container.style.transition=""}}checkUpdateOption(t,r){return r.some(i=>i in t)}}const{get:zC}=Kn;class y5 extends null{constructor(...t){super(...t),_defineProperty(this,"layerClickCountByFrame",0),_defineProperty(this,"layerConfigMap",new WeakMap),_defineProperty(this,"displayFeatureInfo",void 0),_defineProperty(this,"onLayerClick",(r,i)=>{requestAnimationFrame(()=>{if(this.popupOption.closeOnClick&&this.layerClickCountByFrame++,this.isShow&&this.isSameFeature(r,i.featureId))this.hide();else{const{title:a,content:u}=this.getLayerInfoFrag(r,i);this.setDOMContent(u),this.setLnglat(i.lngLat),this.setTitle(a),this.setDisplayFeatureInfo({layer:r,featureId:i.featureId}),this.show()}})}),_defineProperty(this,"onSceneClick",()=>{this.layerClickCountByFrame=0,requestAnimationFrame(()=>{this.layerClickCountByFrame||this.hide()})}),_defineProperty(this,"onLayerHide",()=>{this.hide(),this.setDisplayFeatureInfo(void 0)}),_defineProperty(this,"updateCloseOnClick",()=>{})}get layerConfigItems(){var t;const{config:r,items:i}=this.popupOption;return(t=r!=null?r:i)!==null&&t!==void 0?t:[]}addTo(t){return super.addTo(t),this.bindLayerEvent(),this.hide(),this}remove(){return super.remove(),this.unbindLayerEvent(),this}setOptions(t){this.unbindLayerEvent();const r=_objectSpread({},t),i=r.trigger||this.popupOption.trigger,a=r.items||this.popupOption.items,u=(a==null?void 0:a.length)===0;r.followCursor=i==="hover"&&!u;const f=this.isShow;return super.setOptions(r),this.bindLayerEvent(),(u||!f)&&this.hide(),this}getDefault(t){const r=t.trigger!=="click";return _objectSpread(_objectSpread({},super.getDefault(t)),{},{trigger:"hover",followCursor:r,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}bindLayerEvent(){const{trigger:t,closeOnClick:r}=this.popupOption;this.layerConfigItems.forEach(i=>{var a;const u=this.getLayerByConfig(i);if(!u)return;const f=_objectSpread({},i);if(t==="hover"){const A=this.onLayerMouseMove.bind(this,u),C=this.onLayerMouseOut.bind(this,u);f.onMouseMove=A,f.onMouseOut=C,u==null||u.on("mousemove",A),u==null||u.on("mouseout",C)}else{var m;const A=this.onLayerClick.bind(this,u);f.onClick=A,u==null||u.on("click",A);const C=(m=this.mapsService)===null||m===void 0?void 0:m.getMapContainer();C&&r&&C.addEventListener("click",this.onSceneClick)}const _=u==null||(a=u.getSource)===null||a===void 0?void 0:a.call(u),b=this.onSourceUpdate.bind(this);_==null||_.on("update",b),f.onSourceUpdate=b,this.layerConfigMap.set(u,f)})}unbindLayerEvent(){this.layerConfigItems.forEach(t=>{var r;const i=this.getLayerByConfig(t),a=i&&this.layerConfigMap.get(i);if(!a)return;const{onMouseMove:u,onMouseOut:f,onClick:m,onSourceUpdate:_}=a;if(u&&i.off("mousemove",u),f&&i.off("mouseout",f),m&&i.off("click",m),_){var b;i==null||(b=i.getSource())===null||b===void 0||b.off("update",_)}const A=(r=this.mapsService)===null||r===void 0?void 0:r.getMapContainer();A&&A.removeEventListener("click",this.onSceneClick)})}onLayerMouseMove(t,r){if(!this.isSameFeature(t,r.featureId)){const{title:i,content:a}=this.getLayerInfoFrag(t,r);this.setDOMContent(a),this.setTitle(i),this.setDisplayFeatureInfo({layer:t,featureId:r.featureId}),this.show()}}onLayerMouseOut(t,r){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}onSourceUpdate(){this.hide(),this.setDisplayFeatureInfo(void 0)}getLayerInfoFrag(t,r){const i=this.layerConfigMap.get(t);let a;const u=document.createDocumentFragment();if(i){let f=r.feature;f.type==="Feature"&&"properties"in f&&"geometry"in f&&(f=f.properties);const{title:m,fields:_,customContent:b}=i;if(m){a=document.createDocumentFragment();const A=m instanceof Function?m(f):m;DOM.appendElementType(a,A)}if(b){const A=b instanceof Function?b(f):b;DOM.appendElementType(u,A)}else _!=null&&_.length&&(_==null||_.forEach(A=>{var C,R;const{field:U,formatField:X,formatValue:ee,getValue:xe}=typeof A=="string"?{field:A}:A,ke=DOM.create("div","l7-layer-popup__row"),Ne=xe?xe(r.feature):zC(f,U),it=(C=X instanceof Function?X(U,f):X)!==null&&C!==void 0?C:U;let gt=(R=ee instanceof Function?ee(Ne,f):ee)!==null&&R!==void 0?R:Ne;const rr=DOM.create("span","l7-layer-popup__key",ke);DOM.appendElementType(rr,it),DOM.appendElementType(rr,document.createTextNode("\uFF1A"));const Kt=DOM.create("span","l7-layer-popup__value",ke);Array.isArray(gt)&&gt.every(Rt=>!(Rt instanceof Object))&&(gt=gt.map(Rt=>String(Rt)).join(",")),DOM.appendElementType(Kt,gt),u.appendChild(ke)}))}return{title:a,content:u}}getLayerByConfig(t){const r=t.layer;if(r instanceof Object)return r;if(typeof r=="string")return this.layerService.getLayer(r)||this.layerService.getLayerByName(r)}isSameFeature(t,r){const i=this.displayFeatureInfo;return i&&t===i.layer&&r===i.featureId}setDisplayFeatureInfo(t){const r=this.displayFeatureInfo;r&&r.layer.off("hide",this.onLayerHide),t&&t.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=t}}function VC(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(t||(t=document),!!t)){var a=t.head||t.getElementsByTagName("head")[0];if(!a){a=t.createElement("head");var u=t.body||t.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(a,u):t.documentElement.appendChild(a)}var f=t.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(t.createTextNode(e)),a.appendChild(f),f}}VC(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font:
    12px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  box-sizing: border-box;
}
.l7-control-container {
  font:
    12px/1.5 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: flex;
  justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  align-items: flex-end;
}
.l7-control-container .l7-column {
  flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 6px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  align-items: flex-start;
}
.l7-popper.l7-popper-end {
  align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: flex;
  align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: flex;
  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  flex-direction: column;
  justify-content: center;
  box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: flex;
  flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: flex;
  align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);var ZC=H(79801),jC=H.n(ZC),HC=class{constructor(e,t){const{buffer:r,offset:i,stride:a,normalized:u,size:f,divisor:m}=t;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:a||0,normalized:u||!1,divisor:m||0},f&&(this.attribute.size=f)}get(){return this.attribute}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}},XC={[O.POINTS]:"points",[O.LINES]:"lines",[O.LINE_LOOP]:"line loop",[O.LINE_STRIP]:"line strip",[O.TRIANGLES]:"triangles",[O.TRIANGLE_FAN]:"triangle fan",[O.TRIANGLE_STRIP]:"triangle strip"},ix={[O.STATIC_DRAW]:"static",[O.DYNAMIC_DRAW]:"dynamic",[O.STREAM_DRAW]:"stream"},U_={[O.BYTE]:"int8",[O.INT]:"int32",[O.UNSIGNED_BYTE]:"uint8",[O.UNSIGNED_SHORT]:"uint16",[O.UNSIGNED_INT]:"uint32",[O.FLOAT]:"float"},WC={[O.ALPHA]:"alpha",[O.LUMINANCE]:"luminance",[O.LUMINANCE_ALPHA]:"luminance alpha",[O.RGB]:"rgb",[O.RGBA]:"rgba",[O.RGBA4]:"rgba4",[O.RGB5_A1]:"rgb5 a1",[O.RGB565]:"rgb565",[O.DEPTH_COMPONENT]:"depth",[O.DEPTH_STENCIL]:"depth stencil"},GC={[O.DONT_CARE]:"dont care",[O.NICEST]:"nice",[O.FASTEST]:"fast"},ox={[O.NEAREST]:"nearest",[O.LINEAR]:"linear",[O.LINEAR_MIPMAP_LINEAR]:"mipmap",[O.NEAREST_MIPMAP_LINEAR]:"nearest mipmap linear",[O.LINEAR_MIPMAP_NEAREST]:"linear mipmap nearest",[O.NEAREST_MIPMAP_NEAREST]:"nearest mipmap nearest"},ax={[O.REPEAT]:"repeat",[O.CLAMP_TO_EDGE]:"clamp",[O.MIRRORED_REPEAT]:"mirror"},YC={[O.NONE]:"none",[O.BROWSER_DEFAULT_WEBGL]:"browser"},qC={[O.NEVER]:"never",[O.ALWAYS]:"always",[O.LESS]:"less",[O.LEQUAL]:"lequal",[O.GREATER]:"greater",[O.GEQUAL]:"gequal",[O.EQUAL]:"equal",[O.NOTEQUAL]:"notequal"},sx={[O.FUNC_ADD]:"add",[O.MIN_EXT]:"min",[O.MAX_EXT]:"max",[O.FUNC_SUBTRACT]:"subtract",[O.FUNC_REVERSE_SUBTRACT]:"reverse subtract"},gg={[O.ZERO]:"zero",[O.ONE]:"one",[O.SRC_COLOR]:"src color",[O.ONE_MINUS_SRC_COLOR]:"one minus src color",[O.SRC_ALPHA]:"src alpha",[O.ONE_MINUS_SRC_ALPHA]:"one minus src alpha",[O.DST_COLOR]:"dst color",[O.ONE_MINUS_DST_COLOR]:"one minus dst color",[O.DST_ALPHA]:"dst alpha",[O.ONE_MINUS_DST_ALPHA]:"one minus dst alpha",[O.CONSTANT_COLOR]:"constant color",[O.ONE_MINUS_CONSTANT_COLOR]:"one minus constant color",[O.CONSTANT_ALPHA]:"constant alpha",[O.ONE_MINUS_CONSTANT_ALPHA]:"one minus constant alpha",[O.SRC_ALPHA_SATURATE]:"src alpha saturate"},KC={[O.NEVER]:"never",[O.ALWAYS]:"always",[O.LESS]:"less",[O.LEQUAL]:"lequal",[O.GREATER]:"greater",[O.GEQUAL]:"gequal",[O.EQUAL]:"equal",[O.NOTEQUAL]:"notequal"},Dd={[O.ZERO]:"zero",[O.KEEP]:"keep",[O.REPLACE]:"replace",[O.INVERT]:"invert",[O.INCR]:"increment",[O.DECR]:"decrement",[O.INCR_WRAP]:"increment wrap",[O.DECR_WRAP]:"decrement wrap"},$C={[O.FRONT]:"front",[O.BACK]:"back"},QC=class{constructor(e,t){this.isDestroyed=!1;const{data:r,usage:i,type:a}=t;this.buffer=e.buffer({data:r,usage:ix[i||O.STATIC_DRAW],type:U_[a||O.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){this.buffer.subdata(e,t)}},JC=class{constructor(e,t){const{data:r,usage:i,type:a,count:u}=t;this.elements=e.elements({data:r,usage:ix[i||O.STATIC_DRAW],type:U_[a||O.UNSIGNED_BYTE],count:u})}get(){return this.elements}subData({data:e}){this.elements.subdata(e)}destroy(){}},eR=class{constructor(e,t){const{width:r,height:i,color:a,colors:u}=t,f={width:r,height:i};Array.isArray(u)&&(f.colors=u.map(m=>m.get())),a&&typeof a!="boolean"&&(f.color=a.get()),this.framebuffer=e.framebuffer(f)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:e,height:t}){this.framebuffer.resize(e,t)}},vc=H(54663),Bd=H(22355),tR=H(63777),fn=H(15767),ux=H(73983),Ie;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(Ie||(Ie={}));var Qi;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"})(Qi||(Qi={}));var Ti;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Ti||(Ti={}));var Xm;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Xm||(Xm={}));var yl;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(yl||(yl={}));var Di;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Di||(Di={}));var Hs;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(Hs||(Hs={}));var $u;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})($u||($u={}));var Xa;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(Xa||(Xa={}));var Ls;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Ls||(Ls={}));var ss;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(ss||(ss={}));var Lo;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(Lo||(Lo={}));var $c;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})($c||($c={}));var Zp;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(Zp||(Zp={}));var lx;(function(e){e.LOADED="loaded"})(lx||(lx={}));var Pi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Pi||(Pi={}));var gu;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(gu||(gu={}));var Xs;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(Xs||(Xs={}));var Pa;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(Pa||(Pa={}));function x5(e,t,r,i){var a=Pi.TEXTURE_2D,u=1,f=gu.SAMPLED;return{dimension:a,format:e,width:t,height:r,depthOrArrayLayers:u,mipLevelCount:i,usage:f}}var La;(function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"})(La||(La={}));var Qc;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(Qc||(Qc={}));var Fd;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Fd||(Fd={}));var _g;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(_g||(_g={}));var cr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(cr||(cr={}));var gn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(gn||(gn={}));function b5(e){return e}var an;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(an||(an={}));function Nn(e,t,r){return e<<16|t<<8|r}var et;(function(e){e[e.ALPHA=Nn(cr.U8,gn.A,an.None)]="ALPHA",e[e.U8_LUMINANCE=Nn(cr.U8,gn.A,an.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=Nn(cr.F16,gn.A,an.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=Nn(cr.F32,gn.A,an.Luminance)]="F32_LUMINANCE",e[e.F16_R=Nn(cr.F16,gn.R,an.None)]="F16_R",e[e.F16_RG=Nn(cr.F16,gn.RG,an.None)]="F16_RG",e[e.F16_RGB=Nn(cr.F16,gn.RGB,an.None)]="F16_RGB",e[e.F16_RGBA=Nn(cr.F16,gn.RGBA,an.None)]="F16_RGBA",e[e.F32_R=Nn(cr.F32,gn.R,an.None)]="F32_R",e[e.F32_RG=Nn(cr.F32,gn.RG,an.None)]="F32_RG",e[e.F32_RGB=Nn(cr.F32,gn.RGB,an.None)]="F32_RGB",e[e.F32_RGBA=Nn(cr.F32,gn.RGBA,an.None)]="F32_RGBA",e[e.U8_R=Nn(cr.U8,gn.R,an.None)]="U8_R",e[e.U8_R_NORM=Nn(cr.U8,gn.R,an.Normalized)]="U8_R_NORM",e[e.U8_RG=Nn(cr.U8,gn.RG,an.None)]="U8_RG",e[e.U8_RG_NORM=Nn(cr.U8,gn.RG,an.Normalized)]="U8_RG_NORM",e[e.U8_RGB=Nn(cr.U8,gn.RGB,an.None)]="U8_RGB",e[e.U8_RGB_NORM=Nn(cr.U8,gn.RGB,an.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=Nn(cr.U8,gn.RGB,an.sRGB|an.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=Nn(cr.U8,gn.RGBA,an.None)]="U8_RGBA",e[e.U8_RGBA_NORM=Nn(cr.U8,gn.RGBA,an.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=Nn(cr.U8,gn.RGBA,an.sRGB|an.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=Nn(cr.U16,gn.R,an.None)]="U16_R",e[e.U16_R_NORM=Nn(cr.U16,gn.R,an.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=Nn(cr.U16,gn.RG,an.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=Nn(cr.U16,gn.RGBA,an.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=Nn(cr.U16,gn.RGBA,an.None)]="U16_RGBA",e[e.U16_RGB=Nn(cr.U16,gn.RGB,an.None)]="U16_RGB",e[e.U16_RG=Nn(cr.U16,gn.RG,an.None)]="U16_RG",e[e.U32_R=Nn(cr.U32,gn.R,an.None)]="U32_R",e[e.U32_RG=Nn(cr.U32,gn.RG,an.None)]="U32_RG",e[e.U32_RGB=Nn(cr.U32,gn.RGB,an.None)]="U32_RGB",e[e.U32_RGBA=Nn(cr.U32,gn.RGBA,an.None)]="U32_RGBA",e[e.S8_R=Nn(cr.S8,gn.R,an.None)]="S8_R",e[e.S8_R_NORM=Nn(cr.S8,gn.R,an.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=Nn(cr.S8,gn.RG,an.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=Nn(cr.S8,gn.RGB,an.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=Nn(cr.S8,gn.RGBA,an.Normalized)]="S8_RGBA_NORM",e[e.S16_R=Nn(cr.S16,gn.R,an.None)]="S16_R",e[e.S16_RG=Nn(cr.S16,gn.RG,an.None)]="S16_RG",e[e.S16_RG_NORM=Nn(cr.S16,gn.RG,an.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=Nn(cr.S16,gn.RGB,an.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=Nn(cr.S16,gn.RGBA,an.None)]="S16_RGBA",e[e.S16_RGBA_NORM=Nn(cr.S16,gn.RGBA,an.Normalized)]="S16_RGBA_NORM",e[e.S32_R=Nn(cr.S32,gn.R,an.None)]="S32_R",e[e.S32_RG=Nn(cr.S32,gn.RG,an.None)]="S32_RG",e[e.S32_RGB=Nn(cr.S32,gn.RGB,an.None)]="S32_RGB",e[e.S32_RGBA=Nn(cr.S32,gn.RGBA,an.None)]="S32_RGBA",e[e.U16_RGBA_5551=Nn(cr.U16_PACKED_5551,gn.RGBA,an.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=Nn(cr.U16_PACKED_565,gn.RGB,an.Normalized)]="U16_RGB_565",e[e.BC1=Nn(cr.BC1,gn.RGBA,an.Normalized)]="BC1",e[e.BC1_SRGB=Nn(cr.BC1,gn.RGBA,an.Normalized|an.sRGB)]="BC1_SRGB",e[e.BC2=Nn(cr.BC2,gn.RGBA,an.Normalized)]="BC2",e[e.BC2_SRGB=Nn(cr.BC2,gn.RGBA,an.Normalized|an.sRGB)]="BC2_SRGB",e[e.BC3=Nn(cr.BC3,gn.RGBA,an.Normalized)]="BC3",e[e.BC3_SRGB=Nn(cr.BC3,gn.RGBA,an.Normalized|an.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=Nn(cr.BC4_UNORM,gn.R,an.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=Nn(cr.BC4_SNORM,gn.R,an.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=Nn(cr.BC5_UNORM,gn.RG,an.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=Nn(cr.BC5_SNORM,gn.RG,an.Normalized)]="BC5_SNORM",e[e.D24=Nn(cr.D24,gn.R,an.Depth)]="D24",e[e.D24_S8=Nn(cr.D24S8,gn.RG,an.Depth|an.Stencil)]="D24_S8",e[e.D32F=Nn(cr.D32F,gn.R,an.Depth)]="D32F",e[e.D32F_S8=Nn(cr.D32FS8,gn.RG,an.Depth|an.Stencil)]="D32F_S8",e[e.U8_RGB_RT=Nn(cr.U8,gn.RGB,an.RenderTarget|an.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=Nn(cr.U8,gn.RGBA,an.RenderTarget|an.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=Nn(cr.U8,gn.RGBA,an.RenderTarget|an.Normalized|an.sRGB)]="U8_RGBA_RT_SRGB"})(et||(et={}));function yg(e){return e>>>8&255}function wh(e){return e>>>16&255}function Nd(e){return e&255}function cx(e){switch(e){case cr.F32:case cr.U32:case cr.S32:return 4;case cr.U16:case cr.S16:case cr.F16:return 2;case cr.U8:case cr.S8:return 1;default:throw new Error("whoops")}}function hx(e){return cx(wh(e))}function E5(e){return yg(e)}function rR(e){var t=cx(wh(e)),r=yg(e);return t*r}function T5(e,t){return e&4294967040|t}function A5(e,t){return e&4294902015|t<<8}function fx(e){var t=Nd(e);if(t&an.Depth)return La.Depth;if(t&an.Normalized)return La.Float;var r=wh(e);if(r===cr.F16||r===cr.F32)return La.Float;if(r===cr.U8||r===cr.U16||r===cr.U32)return La.Uint;if(r===cr.S8||r===cr.S16||r===cr.S32)return La.Sint;throw new Error("whoops")}function vi(e,t){if(t===void 0&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function jp(e){if(e!=null)return e;throw new Error("Missing object")}function px(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function dx(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function mx(e){var t=e.r,r=e.g,i=e.b,a=e.a;return{r:t,g:r,b:i,a}}function Wm(e,t,r,i){return i===void 0&&(i=1),{r:e,g:t,b:r,a:i}}var xg=Wm(0,0,0,0),S5=Wm(0,0,0,1),nR=Wm(1,1,1,0),w5=Wm(1,1,1,1),Ud=!0;function C5(e,t){t===void 0&&(t=Ud),t&&(e[10]=-e[10],e[14]=-e[14])}function R5(e,t){t===void 0&&(t=Ud),t&&(e[10]=-e[10],e[14]=-e[14]+1)}function iR(e,t){if(t===void 0&&(t=Ud),t)switch(e){case Ti.LESS:return Ti.GREATER;case Ti.LEQUAL:return Ti.GEQUAL;case Ti.GEQUAL:return Ti.LEQUAL;case Ti.GREATER:return Ti.LESS;default:return e}else return e}function I5(e,t){return t===void 0&&(t=Ud),t?1-e:e}function M5(e,t){return t===void 0&&(t=Ud),t?-e:e}function O5(e,t,r,i){if(i===void 0&&(i=Ud),r=iR(r,i),r===Ti.LESS)return e<t;if(r===Ti.LEQUAL)return e<=t;if(r===Ti.GREATER)return e>t;if(r===Ti.GEQUAL)return e>=t;throw new Error("whoops")}function bg(e){return!!(e&&!(e&e-1))}function Kf(e,t){return e!=null?e:t}function oR(e){return e===void 0?null:e}function P5(e,t,r){e.length=t,e.fill(r)}function Eg(e,t){var r=t-1;return e+r&~r}function L5(e,t){return((e+t-1)/t|0)*t}function aR(e,t,r){for(var i=0,a=e.length;i<a;){var u=i+(a-i>>>1),f=r(t,e[u]);f<0?a=u:i=u+1}return i}function D5(e,t,r){var i=aR(e,t,r);e.splice(i,0,t)}function B5(e,t,r){return r?e|=t:e&=~t,e}function sR(e,t){for(var r=new Array(e),i=0;i<e;i++)r[i]=t();return r}function uR(e,t){t===void 0&&(t=1);var r=e.split(`
`);return r.map(function(i,a){return"".concat(lR(""+(t+a),4," "),"  ").concat(i)}).join(`
`)}function lR(e,t,r){for(r===void 0&&(r="0");e.length<t;)e="".concat(r).concat(e);return e}function F5(e,t){for(var r=[],i=e;i<e+t;i++)r.push(i);return r}function vx(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function Tg(e,t){return e===void 0&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function gx(e,t){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),vx(e.rgbBlendState,t.rgbBlendState),vx(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function k_(e,t){e.length!==t.length&&(e.length=t.length);for(var r=0;r<t.length;r++)e[r]=gx(e[r],t[r])}function cR(e,t){t.attachmentsState!==void 0&&k_(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&dx(e.blendConstant,t.blendConstant),e.depthCompare=Kf(t.depthCompare,e.depthCompare),e.depthWrite=Kf(t.depthWrite,e.depthWrite),e.stencilWrite=Kf(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&Tg(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&Tg(e.stencilBack,t.stencilBack),e.cullMode=Kf(t.cullMode,e.cullMode),e.frontFace=Kf(t.frontFace,e.frontFace),e.polygonOffset=Kf(t.polygonOffset,e.polygonOffset),e.polygonOffsetFactor=Kf(t.polygonOffsetFactor,e.polygonOffsetFactor),e.polygonOffsetUnits=Kf(t.polygonOffsetUnits,e.polygonOffsetUnits)}function kd(e){var t=Object.assign({},e);return t.attachmentsState=[],k_(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&mx(t.blendConstant),t.stencilFront=Tg(void 0,e.stencilFront),t.stencilBack=Tg(void 0,e.stencilBack),t}function hR(e,t){t.channelWriteMask!==void 0&&(e.channelWriteMask=t.channelWriteMask),t.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=t.rgbBlendMode),t.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=t.alphaBlendMode),t.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=t.rgbBlendSrcFactor),t.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=t.alphaBlendSrcFactor),t.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=t.rgbBlendDstFactor),t.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=t.alphaBlendDstFactor)}var _x={blendMode:Hs.ADD,blendSrcFactor:Di.ONE,blendDstFactor:Di.ZERO},Hp={attachmentsState:[{channelWriteMask:Xs.ALL,rgbBlendState:_x,alphaBlendState:_x}],blendConstant:mx(xg),depthWrite:!0,depthCompare:Ti.LEQUAL,stencilWrite:!1,stencilFront:{compare:Ti.ALWAYS,passOp:Pa.KEEP,depthFailOp:Pa.KEEP,failOp:Pa.KEEP},stencilBack:{compare:Ti.ALWAYS,passOp:Pa.KEEP,depthFailOp:Pa.KEEP,failOp:Pa.KEEP},cullMode:yl.NONE,frontFace:Xm.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};function fR(e,t){e===void 0&&(e=null),t===void 0&&(t=Hp);var r=kd(t);return e!==null&&cR(r,e),r}var N5=fR({depthCompare:Ti.ALWAYS,depthWrite:!1},Hp);function U5(e,t){return e.attachmentsState===void 0&&(e.attachmentsState=[],k_(e.attachmentsState,Hp.attachmentsState)),hR(e.attachmentsState[0],t),e}var yx={texture:null,sampler:null,formatKind:La.Float,dimension:Pi.TEXTURE_2D};function $f(e,t,r){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1;return!0}function zd(e,t){for(var r=Array(e.length),i=0;i<e.length;i++)r[i]=t(e[i]);return r}function pR(e,t){return e.texture===t.texture&&e.binding===t.binding}function xx(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function dR(e,t){return e===null?t===null:t===null?!1:e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison}function mR(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],!(e.samplerBindings.length!==t.samplerBindings.length||!$f(e.samplerBindings,t.samplerBindings,dR)||!$f(e.uniformBufferBindings,t.uniformBufferBindings,xx)||!$f(e.storageBufferBindings,t.storageBufferBindings,xx)||!$f(e.storageTextureBindings,t.storageTextureBindings,pR))}function bx(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function vR(e,t){return!(!bx(e.rgbBlendState,t.rgbBlendState)||!bx(e.alphaBlendState,t.alphaBlendState)||e.channelWriteMask!==t.channelWriteMask)}function Ag(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function gR(e,t){return!$f(e.attachmentsState,t.attachmentsState,vR)||e.blendConstant&&t.blendConstant&&!px(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!Ag(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!Ag(e.stencilBack,t.stencilBack)?!1:e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilWrite===t.stencilWrite&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset&&e.polygonOffsetFactor===t.polygonOffsetFactor&&e.polygonOffsetUnits===t.polygonOffsetUnits}function Ex(e,t){return e.id===t.id}function _R(e,t){return e===t}function yR(e,t){return!(e.topology!==t.topology||e.inputLayout!==t.inputLayout||e.sampleCount!==t.sampleCount||e.megaStateDescriptor&&t.megaStateDescriptor&&!gR(e.megaStateDescriptor,t.megaStateDescriptor)||!Ex(e.program,t.program)||!$f(e.colorAttachmentFormats,t.colorAttachmentFormats,_R)||e.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function xR(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function bR(e,t){return(0,vc.Z)(e)?(0,vc.Z)(t):(0,vc.Z)(t)?!1:e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&$f(e.attributes,t.attributes,xR)}function ER(e,t){return!(e.indexBufferFormat!==t.indexBufferFormat||!$f(e.vertexBufferDescriptors,t.vertexBufferDescriptors,bR)||!Ex(e.program,t.program))}function k5(e,t){return e.addressModeU===t.addressModeU&&e.addressModeV===t.addressModeV&&e.minFilter===t.minFilter&&e.magFilter===t.magFilter&&e.mipmapFilter===t.mipmapFilter&&e.lodMinClamp===t.lodMinClamp&&e.lodMaxClamp===t.lodMaxClamp&&e.maxAnisotropy===t.maxAnisotropy&&e.compareFunction===t.compareFunction}function TR(e){var t=e.sampler,r=e.texture,i=e.dimension,a=e.formatKind,u=e.comparison;return{sampler:t,texture:r,dimension:i,formatKind:a,comparison:u}}function Tx(e){var t=e.buffer,r=e.size,i=e.binding,a=e.offset;return{binding:i,buffer:t,offset:a,size:r}}function AR(e){var t=e.binding,r=e.texture;return{binding:t,texture:r}}function SR(e){var t=e.samplerBindings&&zd(e.samplerBindings,TR),r=e.uniformBufferBindings&&zd(e.uniformBufferBindings,Tx),i=e.storageBufferBindings&&zd(e.storageBufferBindings,Tx),a=e.storageTextureBindings&&zd(e.storageTextureBindings,AR);return{samplerBindings:t,uniformBufferBindings:r,storageBufferBindings:i,storageTextureBindings:a,pipeline:e.pipeline}}function wR(e){var t=e.inputLayout,r=e.program,i=e.topology,a=e.megaStateDescriptor&&kd(e.megaStateDescriptor),u=e.colorAttachmentFormats.slice(),f=e.depthStencilAttachmentFormat,m=e.sampleCount;return{inputLayout:t,megaStateDescriptor:a,program:r,topology:i,colorAttachmentFormats:u,depthStencilAttachmentFormat:f,sampleCount:m}}function CR(e){var t=e.shaderLocation,r=e.format,i=e.offset,a=e.divisor;return{shaderLocation:t,format:r,offset:i,divisor:a}}function RR(e){if((0,vc.Z)(e))return e;var t=e.arrayStride,r=e.stepMode,i=zd(e.attributes,CR);return{arrayStride:t,stepMode:r,attributes:i}}function IR(e){var t=zd(e.vertexBufferDescriptors,RR),r=e.indexBufferFormat,i=e.program;return{vertexBufferDescriptors:t,indexBufferFormat:r,program:i}}var ki,MR=/([^[]*)(\[[0-9]+\])?/;function OR(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var t=e.match(MR);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:!!t[2]}}function Qu(){var e=null;return function(t,r,i){var a=e!==i;return a&&(t.uniform1i(r,i),e=i),a}}function Da(e,t,r,i){var a=null,u=null;return function(f,m,_){var b=t(_,r),A=b.length,C=!1;if(a===null)a=new Float32Array(A),u=A,C=!0;else{vi(u===A,"Uniform length cannot change.");for(var R=0;R<A;++R)if(b[R]!==a[R]){C=!0;break}}return C&&(i(f,e,m,b),a.set(b)),C}}function Pu(e,t,r,i){e[t](r,i)}function sf(e,t,r,i){e[t](r,!1,i)}var PR={},LR={},DR={},Ax=[0];function z_(e,t,r,i){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(Ax[0]=e,e=Ax);var a=e.length;if(e instanceof r)return e;var u=i[a];u||(u=new r(a),i[a]=u);for(var f=0;f<a;f++)u[f]=e[f];return u}function jl(e,t){return z_(e,t,Float32Array,PR)}function Qf(e,t){return z_(e,t,Int32Array,LR)}function Sg(e,t){return z_(e,t,Uint32Array,DR)}var BR=(ki={},ki[Ie.FLOAT]=Da.bind(null,"uniform1fv",jl,1,Pu),ki[Ie.FLOAT_VEC2]=Da.bind(null,"uniform2fv",jl,2,Pu),ki[Ie.FLOAT_VEC3]=Da.bind(null,"uniform3fv",jl,3,Pu),ki[Ie.FLOAT_VEC4]=Da.bind(null,"uniform4fv",jl,4,Pu),ki[Ie.INT]=Da.bind(null,"uniform1iv",Qf,1,Pu),ki[Ie.INT_VEC2]=Da.bind(null,"uniform2iv",Qf,2,Pu),ki[Ie.INT_VEC3]=Da.bind(null,"uniform3iv",Qf,3,Pu),ki[Ie.INT_VEC4]=Da.bind(null,"uniform4iv",Qf,4,Pu),ki[Ie.BOOL]=Da.bind(null,"uniform1iv",Qf,1,Pu),ki[Ie.BOOL_VEC2]=Da.bind(null,"uniform2iv",Qf,2,Pu),ki[Ie.BOOL_VEC3]=Da.bind(null,"uniform3iv",Qf,3,Pu),ki[Ie.BOOL_VEC4]=Da.bind(null,"uniform4iv",Qf,4,Pu),ki[Ie.FLOAT_MAT2]=Da.bind(null,"uniformMatrix2fv",jl,4,sf),ki[Ie.FLOAT_MAT3]=Da.bind(null,"uniformMatrix3fv",jl,9,sf),ki[Ie.FLOAT_MAT4]=Da.bind(null,"uniformMatrix4fv",jl,16,sf),ki[Ie.UNSIGNED_INT]=Da.bind(null,"uniform1uiv",Sg,1,Pu),ki[Ie.UNSIGNED_INT_VEC2]=Da.bind(null,"uniform2uiv",Sg,2,Pu),ki[Ie.UNSIGNED_INT_VEC3]=Da.bind(null,"uniform3uiv",Sg,3,Pu),ki[Ie.UNSIGNED_INT_VEC4]=Da.bind(null,"uniform4uiv",Sg,4,Pu),ki[Ie.FLOAT_MAT2x3]=Da.bind(null,"uniformMatrix2x3fv",jl,6,sf),ki[Ie.FLOAT_MAT2x4]=Da.bind(null,"uniformMatrix2x4fv",jl,8,sf),ki[Ie.FLOAT_MAT3x2]=Da.bind(null,"uniformMatrix3x2fv",jl,6,sf),ki[Ie.FLOAT_MAT3x4]=Da.bind(null,"uniformMatrix3x4fv",jl,12,sf),ki[Ie.FLOAT_MAT4x2]=Da.bind(null,"uniformMatrix4x2fv",jl,8,sf),ki[Ie.FLOAT_MAT4x3]=Da.bind(null,"uniformMatrix4x3fv",jl,12,sf),ki[Ie.SAMPLER_2D]=Qu,ki[Ie.SAMPLER_CUBE]=Qu,ki[Ie.SAMPLER_3D]=Qu,ki[Ie.SAMPLER_2D_SHADOW]=Qu,ki[Ie.SAMPLER_2D_ARRAY]=Qu,ki[Ie.SAMPLER_2D_ARRAY_SHADOW]=Qu,ki[Ie.SAMPLER_CUBE_SHADOW]=Qu,ki[Ie.INT_SAMPLER_2D]=Qu,ki[Ie.INT_SAMPLER_3D]=Qu,ki[Ie.INT_SAMPLER_CUBE]=Qu,ki[Ie.INT_SAMPLER_2D_ARRAY]=Qu,ki[Ie.UNSIGNED_INT_SAMPLER_2D]=Qu,ki[Ie.UNSIGNED_INT_SAMPLER_3D]=Qu,ki[Ie.UNSIGNED_INT_SAMPLER_CUBE]=Qu,ki[Ie.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Qu,ki);function Sx(e,t,r){var i=BR[r.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(r.type));return i().bind(null,e,t)}var FR={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function NR(e){return Object.prototype.toString.call(e)in FR}function Gm(e,t){return"#define ".concat(e," ").concat(t)}function UR(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(r,i,a){var u=Number(a);return t[i]=isNaN(u)?a:u,""}),t}function kR(e,t){var r=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(i,a,u){var f=Number(a);return r.push({location:isNaN(f)?t[a]:f,name:u}),""}),r}function z5(e){var t=[],r=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(i,a,u){var f=[];return u.trim().replace(`\r
`,`
`).split(`
`).forEach(function(m){var _=__read(m.trim().split(/\s+/),2),b=_[0],A=_[1];f.push({type:b.trim(),name:A.replace(";","").trim()})}),r.push({type:a.trim(),uniforms:f}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(i,a){return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(u){var f=u.trim().split(" "),m=f[0]||"",_=f[1]||"",b=_.indexOf("[")>-1;if(_=_.replace(";","").replace("[","").trim(),!m.startsWith("#")){if(m){var A=r.find(function(U){return m===U.type});if(A)if(b)for(var C=function(U){A.uniforms.forEach(function(X){t.push("".concat(_,"[").concat(U,"].").concat(X.name))})},R=0;R<5;R++)C(R);else A.uniforms.forEach(function(U){t.push("".concat(_,".").concat(U.name))})}_&&t.push(_)}}),""}),t}function Cx(e){if(e===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(t!==null){var r=parseInt(t[1],10);if(!Number.isNaN(r))return r}return null}function Rx(e){var t="",r=e;return[r,t]}function Jf(e,t,r,i,a){var u;i===void 0&&(i=null),a===void 0&&(a=!0);var f=e.glslVersion==="#version 100",m=t==="frag"&&((u=r.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||u===void 0?void 0:u.length)>1,_=r.replace(`\r
`,`
`).split(`
`).map(function(Kt){return Kt.replace(/[/][/].*$/,"")}).filter(function(Kt){var Rt=!Kt||/^\s+$/.test(Kt);return!Rt}),b="";i!==null&&(b=Object.keys(i).map(function(Kt){return Gm(Kt,i[Kt])}).join(`
`));var A=_.find(function(Kt){return Kt.startsWith("precision")})||"precision mediump float;",C=a?_.filter(function(Kt){return!Kt.startsWith("precision")}).join(`
`):_.join(`
`),R="";if(e.viewportOrigin===Qc.UPPER_LEFT&&(R+="".concat(Gm("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Fd.ZERO&&(R+="".concat(Gm("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var U=0,X=0,ee=0;C=C.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(Kt,Rt,tr,Tn){var fi=tr?"".concat(tr,", "):"";return"layout(".concat(fi,"set = ").concat(U,", binding = ").concat(X++,") uniform ").concat(Tn)}),U++,X=0,vi(e.separateSamplerTextures),C=C.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(Kt,Rt,tr,Tn,fi){var An=Cx(tr);An===null&&(An=X++);var ui=(0,fn.CR)(Rx(Tn),2),Xi=ui[0],ou=ui[1];return t==="frag"?`
layout(set = `.concat(U,", binding = ").concat(An*2+0,") uniform texture").concat(Xi," T_").concat(fi,`;
layout(set = `).concat(U,", binding = ").concat(An*2+1,") uniform sampler").concat(ou," S_").concat(fi,";").trim():""}),C=C.replace(t==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(Kt,Rt){return"layout(location = ".concat(ee++,") ").concat(Rt)}),R+="".concat(Gm("gl_VertexID","gl_VertexIndex"),`
`),R+="".concat(Gm("gl_InstanceID","gl_InstanceIndex"),`
`),A=A.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var xe=0;C=C.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(Kt,Rt,tr,Tn,fi){var An=Cx(tr);return An===null&&(An=xe++),"uniform sampler".concat(Tn," ").concat(fi,"; // BINDING=").concat(An)})}if(C=C.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,function(Kt,Rt,tr){return"SAMPLER_".concat(Rt,"(P_").concat(tr,")")}),C=C.replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,function(Kt,Rt,tr){return"PP_SAMPLER_".concat(Rt,"(P_").concat(tr,")")}),C=C.replace(/\bPU_TEXTURE\((.*?)\)/g,function(Kt,Rt){return"TEXTURE(P_".concat(Rt,")")}),e.separateSamplerTextures)C=C.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(Kt,Rt,tr){var Tn=(0,fn.CR)(Rx(Rt),2),fi=Tn[0],An=Tn[1];return"texture".concat(fi," T_P_").concat(tr,", sampler").concat(An," S_P_").concat(tr)}),C=C.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(Kt,Rt,tr){return"T_".concat(tr,", S_").concat(tr)}),C=C.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(Kt,Rt,tr){return"sampler".concat(Rt,"(T_").concat(tr,", S_").concat(tr,")")}),C=C.replace(/\bTEXTURE\((.*?)\)/g,function(Kt,Rt){return"T_".concat(Rt)});else{var ke=[];C=C.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(Kt,Rt,tr){return"sampler".concat(Rt," P_").concat(tr)}),C=C.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(Kt,Rt,tr){return tr}),C=C.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(Kt,Rt,tr){return ke.push([tr,Rt]),tr}),f&&ke.forEach(function(Kt){var Rt=(0,fn.CR)(Kt,2),tr=Rt[0],Tn=Rt[1];C=C.replace(new RegExp("texture\\(".concat(tr),"g"),function(){return"texture".concat(Tn,"(").concat(tr)})}),C=C.replace(/\bTEXTURE\((.*?)\)/g,function(Kt,Rt){return Rt})}var Ne="".concat(f?"":e.glslVersion,`
`).concat(f&&m?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(f&&t==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(a?A:"",`
`).concat(R||"").concat(b?b+`
`:"",`
`).concat(C,`
`).trim();if(e.explicitBindingLocations&&t==="frag"&&(Ne=Ne.replace(/^\b(out)\b/g,function(Kt,Rt){return"layout(location = 0) ".concat(Rt)})),f){if(t==="frag"&&(Ne=Ne.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(Kt,Rt,tr){return"varying ".concat(Rt," ").concat(tr,`;
`)})),t==="vert"&&(Ne=Ne.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(Kt,Rt,tr){return"varying ".concat(Rt," ").concat(tr,`;
`)}),Ne=Ne.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(Kt,Rt,tr){return"attribute ".concat(Rt," ").concat(tr,`;
`)})),Ne=Ne.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(Kt,Rt){return Rt.trim().replace(/^.*$/gm,function(tr){var Tn=tr.trim();return Tn.startsWith("#")?Tn:tr?"uniform ".concat(Tn):""})}),t==="frag")if(m){var it=[];Ne=Ne.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(Kt,Rt){return it.push(Rt),"vec4 ".concat(Rt,`;
`)});var gt=Ne.lastIndexOf("}");Ne=Ne.substring(0,gt)+`
    `.concat(it.map(function(Kt,Rt){return"gl_FragData[".concat(Rt,"] = ").concat(Kt,`;
    `)}).join(`
`))+Ne.substring(gt)}else{var rr;if(Ne=Ne.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(Kt,Rt,tr){return rr=tr,"".concat(Rt," ").concat(tr,`;
`)}),rr){var gt=Ne.lastIndexOf("}");Ne=Ne.substring(0,gt)+`
  gl_FragColor = vec4(`.concat(rr,`);
`)+Ne.substring(gt)}}Ne=Ne.replace(/^\s*layout\((.*)\)/gm,"")}return Ne}function V5(e,t,r,i){i===void 0&&(i=null);var a=Jf(e,"vert",t,i),u=Jf(e,"frag",r,i);return{vert:t,frag:r,preprocessedVert:a,preprocessedFrag:u}}var gc=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this)||this;return u.id=i,u.device=a,u.device.resourceCreationTracker!==null&&u.device.resourceCreationTracker.trackResourceCreated(u),u}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(ux.Z),zR=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;f.type=Qi.Bindings;var m=u.uniformBufferBindings,_=u.samplerBindings;return f.uniformBufferBindings=m||[],f.samplerBindings=_||[],f.bindingLayouts=f.createBindingLayouts(),f}return t.prototype.createBindingLayouts=function(){var r=0,i=0,a=[],u=this.uniformBufferBindings.length,f=this.samplerBindings.length;return a.push({firstUniformBuffer:r,numUniformBuffers:u,firstSampler:i,numSamplers:f}),r+=u,i+=f,{numUniformBuffers:r,numSamplers:i,bindingLayoutTables:a}},t}(gc),Ym;function wn(e){return Ym!==void 0?Ym:typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?(Ym=!0,!0):(Ym=!!(e&&e._version===2),Ym)}function Ix(e){var t=wh(e);switch(t){case cr.BC1:case cr.BC2:case cr.BC3:case cr.BC4_UNORM:case cr.BC4_SNORM:case cr.BC5_UNORM:case cr.BC5_SNORM:return!0;default:return!1}}function Mx(e){var t=Nd(e);if(t&an.Normalized)return!1;var r=wh(e);return r===cr.S8||r===cr.S16||r===cr.S32||r===cr.U8||r===cr.U16||r===cr.U32}function VR(e){switch(e){case $c.STATIC:return Ie.STATIC_DRAW;case $c.DYNAMIC:return Ie.DYNAMIC_DRAW}}function Ox(e){if(e&Lo.INDEX)return Ie.ELEMENT_ARRAY_BUFFER;if(e&Lo.VERTEX)return Ie.ARRAY_BUFFER;if(e&Lo.UNIFORM)return Ie.UNIFORM_BUFFER}function ZR(e){switch(e){case ss.TRIANGLES:return Ie.TRIANGLES;case ss.POINTS:return Ie.POINTS;case ss.TRIANGLE_STRIP:return Ie.TRIANGLE_STRIP;case ss.LINES:return Ie.LINES;case ss.LINE_STRIP:return Ie.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function jR(e){switch(e){case cr.U8:return Ie.UNSIGNED_BYTE;case cr.U16:return Ie.UNSIGNED_SHORT;case cr.U32:return Ie.UNSIGNED_INT;case cr.S8:return Ie.BYTE;case cr.S16:return Ie.SHORT;case cr.S32:return Ie.INT;case cr.F16:return Ie.HALF_FLOAT;case cr.F32:return Ie.FLOAT;default:throw new Error("whoops")}}function HR(e){switch(e){case gn.R:return 1;case gn.RG:return 2;case gn.RGB:return 3;case gn.RGBA:return 4;default:return 1}}function XR(e){var t=wh(e),r=yg(e),i=Nd(e),a=jR(t),u=HR(r),f=!!(i&an.Normalized);return{size:u,type:a,normalized:f}}function WR(e){switch(e){case et.U8_R:return Ie.UNSIGNED_BYTE;case et.U16_R:return Ie.UNSIGNED_SHORT;case et.U32_R:return Ie.UNSIGNED_INT;default:throw new Error("whoops")}}function qm(e){switch(e){case $u.CLAMP_TO_EDGE:return Ie.CLAMP_TO_EDGE;case $u.REPEAT:return Ie.REPEAT;case $u.MIRRORED_REPEAT:return Ie.MIRRORED_REPEAT;default:throw new Error("whoops")}}function wg(e,t){if(t===Ls.LINEAR&&e===Xa.BILINEAR)return Ie.LINEAR_MIPMAP_LINEAR;if(t===Ls.LINEAR&&e===Xa.POINT)return Ie.NEAREST_MIPMAP_LINEAR;if(t===Ls.NEAREST&&e===Xa.BILINEAR)return Ie.LINEAR_MIPMAP_NEAREST;if(t===Ls.NEAREST&&e===Xa.POINT)return Ie.NEAREST_MIPMAP_NEAREST;if(t===Ls.NO_MIP&&e===Xa.BILINEAR)return Ie.LINEAR;if(t===Ls.NO_MIP&&e===Xa.POINT)return Ie.NEAREST;throw new Error("Unknown texture filter mode")}function Vd(e,t){t===void 0&&(t=0);var r=e;return r.gl_buffer_pages[t/r.pageByteSize|0]}function Zd(e){var t=e;return t.gl_texture}function V_(e){var t=e;return t.gl_sampler}function Km(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function Px(e,t){for(var r=[];;){var i=t.exec(e);if(!i)break;r.push(i)}return r}function ep(e){return e.blendMode==Hs.ADD&&e.blendSrcFactor==Di.ONE&&e.blendDstFactor===Di.ZERO}function GR(e){switch(e){case _g.OcclusionConservative:return Ie.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function YR(e){if(e===Pi.TEXTURE_2D)return Ie.TEXTURE_2D;if(e===Pi.TEXTURE_2D_ARRAY)return Ie.TEXTURE_2D_ARRAY;if(e===Pi.TEXTURE_CUBE_MAP)return Ie.TEXTURE_CUBE_MAP;if(e===Pi.TEXTURE_3D)return Ie.TEXTURE_3D;throw new Error("whoops")}function Z_(e,t,r,i){return!(e%r!==0||t%i!==0)}var qR=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;f.type=Qi.Buffer;var m=u.viewOrSize,_=u.usage,b=u.hint,A=b===void 0?$c.STATIC:b,C=a.uniformBufferMaxPageByteSize,R=a.gl,U=_&Lo.UNIFORM;U||(wn(R)?R.bindVertexArray(null):a.OES_vertex_array_object.bindVertexArrayOES(null));var X=(0,Bd.Z)(m)?Eg(m,4):Eg(m.byteLength,4);f.gl_buffer_pages=[];var ee;if(U){for(var xe=X;xe>0;)f.gl_buffer_pages.push(f.createBufferPage(Math.min(xe,C),_,A)),xe-=C;ee=C}else f.gl_buffer_pages.push(f.createBufferPage(X,_,A)),ee=X;return f.pageByteSize=ee,f.byteSize=X,f.usage=_,f.gl_target=Ox(_),(0,Bd.Z)(m)||f.setSubData(0,new Uint8Array(m.buffer)),U||(wn(R)?R.bindVertexArray(f.device.currentBoundVAO):a.OES_vertex_array_object.bindVertexArrayOES(f.device.currentBoundVAO)),f}return t.prototype.setSubData=function(r,i,a,u){a===void 0&&(a=0),u===void 0&&(u=i.byteLength-a);for(var f=this.device.gl,m=this.pageByteSize,_=r+u,b=r,A=r%m;b<_;){var C=wn(f)?f.COPY_WRITE_BUFFER:this.gl_target,R=Vd(this,b);if(R.ubo)return;f.bindBuffer(C,R),wn(f)?f.bufferSubData(C,A,i,a,Math.min(_-b,m)):f.bufferSubData(C,A,i),b+=m,A=0,a+=m,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var r=0;r<this.gl_buffer_pages.length;r++)this.gl_buffer_pages[r].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[r]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(r,i,a){var u=this.device.gl,f=i&Lo.UNIFORM;if(!wn(u)&&f)return{ubo:!0};var m=this.device.ensureResourceExists(u.createBuffer()),_=Ox(i),b=VR(a);return u.bindBuffer(_,m),u.bufferData(_,r,b),m},t}(gc),KR=function(e){(0,fn.ZT)(t,e);function t(r){var i,a,u,f,m=r.id,_=r.device,b=r.descriptor,A,C=e.call(this,{id:m,device:_})||this;C.type=Qi.InputLayout;var R=b.vertexBufferDescriptors,U=b.indexBufferFormat,X=b.program;vi(U===et.U16_R||U===et.U32_R||U===null);var ee=U!==null?WR(U):null,xe=U!==null?hx(U):null,ke=C.device.gl,Ne=C.device.ensureResourceExists(wn(ke)?ke.createVertexArray():_.OES_vertex_array_object.createVertexArrayOES());wn(ke)?ke.bindVertexArray(Ne):_.OES_vertex_array_object.bindVertexArrayOES(Ne),ke.bindBuffer(ke.ARRAY_BUFFER,Vd(C.device.fallbackVertexBuffer));try{for(var it=(0,fn.XA)(b.vertexBufferDescriptors),gt=it.next();!gt.done;gt=it.next()){var rr=gt.value,Kt=rr.stepMode,Rt=rr.attributes;try{for(var tr=(u=void 0,(0,fn.XA)(Rt)),Tn=tr.next();!Tn.done;Tn=tr.next()){var fi=Tn.value,An=fi.shaderLocation,ui=fi.format,Xi=fi.divisor,ou=Xi===void 0?1:Xi,Lu=wn(ke)?An:(A=X.attributes[An])===null||A===void 0?void 0:A.location,bl=XR(ui);if(fi.vertexFormat=bl,!(0,vc.Z)(Lu)){Mx(ui);var tp=bl.size,rp=bl.type,Hl=bl.normalized;ke.vertexAttribPointer(Lu,tp,rp,Hl,0,0),Kt===Zp.INSTANCE&&(wn(ke)?ke.vertexAttribDivisor(Lu,ou):_.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Lu,ou)),ke.enableVertexAttribArray(Lu)}}}catch(fv){u={error:fv}}finally{try{Tn&&!Tn.done&&(f=tr.return)&&f.call(tr)}finally{if(u)throw u.error}}}}catch(fv){i={error:fv}}finally{try{gt&&!gt.done&&(a=it.return)&&a.call(it)}finally{if(i)throw i.error}}return wn(ke)?ke.bindVertexArray(null):_.OES_vertex_array_object.bindVertexArrayOES(null),C.vertexBufferDescriptors=R,C.vao=Ne,C.indexBufferFormat=U,C.indexBufferType=ee,C.indexBufferCompByteSize=xe,C.program=X,C}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(wn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(gc),j_=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=r.fake,m=e.call(this,{id:i,device:a})||this;m.type=Qi.Texture,u=(0,fn.pi)({dimension:Pi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},u);var _=m.device.gl,b,A,C=m.clampmipLevelCount(u);if(m.immutable=u.usage===gu.RENDER_TARGET,m.pixelStore=u.pixelStore,m.format=u.format,m.dimension=u.dimension,m.formatKind=fx(u.format),m.width=u.width,m.height=u.height,m.depthOrArrayLayers=u.depthOrArrayLayers,m.mipmaps=C>=1,!f){A=m.device.ensureResourceExists(_.createTexture());var R=m.device.translateTextureType(u.format),U=m.device.translateTextureInternalFormat(u.format);if(m.device.setActiveTexture(_.TEXTURE0),m.device.currentTextures[0]=null,m.preprocessImage(),u.dimension===Pi.TEXTURE_2D){if(b=Ie.TEXTURE_2D,_.bindTexture(b,A),m.immutable)if(wn(_))_.texStorage2D(b,C,U,u.width,u.height);else{var X=(U===Ie.DEPTH_COMPONENT||m.isNPOT(),0);(m.format===et.D32F||m.format===et.D24_S8)&&!wn(_)&&!a.WEBGL_depth_texture||(_.texImage2D(b,X,U,u.width,u.height,0,U,R,null),m.mipmaps&&(m.mipmaps=!1,_.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MIN_FILTER,Ie.LINEAR),_.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_S,Ie.CLAMP_TO_EDGE),_.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_T,Ie.CLAMP_TO_EDGE)))}vi(u.depthOrArrayLayers===1)}else if(u.dimension===Pi.TEXTURE_2D_ARRAY)b=Ie.TEXTURE_2D_ARRAY,_.bindTexture(b,A),m.immutable&&wn(_)&&_.texStorage3D(b,C,U,u.width,u.height,u.depthOrArrayLayers);else if(u.dimension===Pi.TEXTURE_3D)b=Ie.TEXTURE_3D,_.bindTexture(b,A),m.immutable&&wn(_)&&_.texStorage3D(b,C,U,u.width,u.height,u.depthOrArrayLayers);else if(u.dimension===Pi.TEXTURE_CUBE_MAP)b=Ie.TEXTURE_CUBE_MAP,_.bindTexture(b,A),m.immutable&&wn(_)&&_.texStorage2D(b,C,U,u.width,u.height),vi(u.depthOrArrayLayers===6);else throw new Error("whoops")}return m.gl_texture=A,m.gl_target=b,m.mipLevelCount=C,m}return t.prototype.setImageData=function(r,i){i===void 0&&(i=0);var a=this.device.gl;Ix(this.format);var u=this.gl_target===Ie.TEXTURE_3D||this.gl_target===Ie.TEXTURE_2D_ARRAY,f=this.gl_target===Ie.TEXTURE_CUBE_MAP,m=NR(r[0]);this.device.setActiveTexture(a.TEXTURE0),this.device.currentTextures[0]=null;var _=r[0],b,A;m?(b=this.width,A=this.height):(b=_.width,A=_.height,this.width=b,this.height=A),a.bindTexture(this.gl_target,this.gl_texture);var C=this.device.translateTextureFormat(this.format),R=wn(a)?this.device.translateInternalTextureFormat(this.format):C,U=this.device.translateTextureType(this.format);this.preprocessImage();for(var X=0;X<this.depthOrArrayLayers;X++){var ee=r[X],xe=this.gl_target;f&&(xe=Ie.TEXTURE_CUBE_MAP_POSITIVE_X+X%6),this.immutable?a.texSubImage2D(xe,i,0,0,b,A,C,U,ee):wn(a)?u?a.texImage3D(xe,i,R,b,A,this.depthOrArrayLayers,0,C,U,ee):a.texImage2D(xe,i,R,b,A,0,C,U,ee):m?a.texImage2D(xe,i,C,b,A,0,C,U,ee):a.texImage2D(xe,i,C,C,U,ee)}this.mipmaps&&this.generateMipmap(u)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Zd(this))},t.prototype.clampmipLevelCount=function(r){if(r.dimension===Pi.TEXTURE_2D_ARRAY&&r.depthOrArrayLayers>1){var i=wh(r.format);if(i===cr.BC1)for(var a=r.width,u=r.height,f=0;f<r.mipLevelCount;f++){if(a<=2||u<=2)return f-1;a=Math.max(a/2|0,1),u=Math.max(u/2|0,1)}}return r.mipLevelCount},t.prototype.preprocessImage=function(){var r=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&r.pixelStorei(Ie.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&r.pixelStorei(Ie.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&r.pixelStorei(Ie.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(r){r===void 0&&(r=!1);var i=this.device.gl;return!wn(i)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(i.bindTexture(this.gl_target,this.gl_texture),r?(i.texParameteri(this.gl_target,Ie.TEXTURE_BASE_LEVEL,0),i.texParameteri(this.gl_target,Ie.TEXTURE_MAX_LEVEL,Math.log2(this.width)),i.texParameteri(this.gl_target,Ie.TEXTURE_MIN_FILTER,Ie.LINEAR_MIPMAP_LINEAR),i.texParameteri(this.gl_target,Ie.TEXTURE_MAG_FILTER,Ie.LINEAR)):i.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MIN_FILTER,Ie.NEAREST_MIPMAP_LINEAR),i.generateMipmap(this.gl_target),i.bindTexture(this.gl_target,null)),this)},t.prototype.isNPOT=function(){var r=this.device.gl;return wn(r)?!1:!bg(this.width)||!bg(this.height)},t}(gc),$R=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;f.type=Qi.RenderTarget,f.gl_renderbuffer=null,f.texture=null;var m=f.device.gl,_=u.format,b=u.width,A=u.height,C=u.sampleCount,R=C===void 0?1:C,U=u.texture,X=!1;if((_===et.D32F||_===et.D24_S8)&&U&&!wn(m)&&!a.WEBGL_depth_texture&&(U.destroy(),f.texture=null,X=!0),!X&&U)f.texture=U;else{f.gl_renderbuffer=f.device.ensureResourceExists(m.createRenderbuffer()),m.bindRenderbuffer(m.RENDERBUFFER,f.gl_renderbuffer);var ee=f.device.translateTextureInternalFormat(_,!0);wn(m)&&R>1?m.renderbufferStorageMultisample(Ie.RENDERBUFFER,R,ee,b,A):m.renderbufferStorage(Ie.RENDERBUFFER,ee,b,A)}return f.format=_,f.width=b,f.height=A,f.sampleCount=R,f}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(gc),xl;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(xl||(xl={}));var QR=function(e){(0,fn.ZT)(t,e);function t(r,i){var a=r.id,u=r.device,f=r.descriptor,m=e.call(this,{id:a,device:u})||this;m.rawVertexGLSL=i,m.type=Qi.Program,m.uniformSetters={},m.attributes=[];var _=m.device.gl;return m.descriptor=f,m.gl_program=m.device.ensureResourceExists(_.createProgram()),m.gl_shader_vert=null,m.gl_shader_frag=null,m.compileState=xl.NeedsCompile,m.tryCompileProgram(),m}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){vi(this.compileState===xl.NeedsCompile);var r=this.descriptor,i=r.vertex,a=r.fragment,u=this.device.gl;i!=null&&i.glsl&&(a!=null&&a.glsl)&&(this.gl_shader_vert=this.compileShader(i.postprocess?i.postprocess(i.glsl):i.glsl,u.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(a.postprocess?a.postprocess(a.glsl):a.glsl,u.FRAGMENT_SHADER),u.attachShader(this.gl_program,this.gl_shader_vert),u.attachShader(this.gl_program,this.gl_shader_frag),u.linkProgram(this.gl_program),this.compileState=xl.Compiling,wn(u)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var r,i=this.device.gl,a=i.getProgramParameter(this.gl_program,i.ACTIVE_ATTRIBUTES),u=UR(this.descriptor.vertex.glsl),f=kR(this.rawVertexGLSL,u),m=function(A){var C=i.getActiveAttrib(_.gl_program,A),R=C.name,U=C.type,X=C.size,ee=i.getAttribLocation(_.gl_program,R),xe=(r=f.find(function(ke){return ke.name===R}))===null||r===void 0?void 0:r.location;ee>=0&&!(0,vc.Z)(xe)&&(_.attributes[xe]={name:R,location:ee,type:U,size:X})},_=this,b=0;b<a;b++)m(b)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var r=this.device.gl,i=r.getProgramParameter(this.gl_program,r.ACTIVE_UNIFORMS),a=0;a<i;a++){var u=r.getActiveUniform(this.gl_program,a),f=OR(u.name).name,m=r.getUniformLocation(this.gl_program,f);if(this.uniformSetters[f]=Sx(r,m,u),u&&u.size>1)for(var _=0;_<u.size;_++)m=r.getUniformLocation(this.gl_program,"".concat(f,"[").concat(_,"]")),this.uniformSetters["".concat(f,"[").concat(_,"]")]=Sx(r,m,u)}},t.prototype.compileShader=function(r,i){var a=this.device.gl,u=this.device.ensureResourceExists(a.createShader(i));return a.shaderSource(u,r),a.compileShader(u),u},t.prototype.setUniformsLegacy=function(r){r===void 0&&(r={});var i=this.device.gl;if(!wn(i)){var a=!1;for(var u in r){a||(i.useProgram(this.gl_program),a=!0);var f=r[u],m=this.uniformSetters[u];if(m){var _=f;_ instanceof j_&&(_=_.textureIndex),m(_)}}}return this},t}(gc),JR=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;f.type=Qi.QueryPool;var m=f.device.gl;if(wn(m)){var _=u.elemCount,b=u.type;f.gl_query=sR(_,function(){return f.device.ensureResourceExists(m.createQuery())}),f.gl_query_type=GR(b)}return f}return t.prototype.queryResultOcclusion=function(r){var i=this.device.gl;if(wn(i)){var a=this.gl_query[r];return i.getQueryParameter(a,i.QUERY_RESULT_AVAILABLE)?!!i.getQueryParameter(a,i.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var r=this.device.gl;if(wn(r))for(var i=0;i<this.gl_query.length;i++)r.deleteQuery(this.gl_query[i])},t}(gc),eI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this,{id:i,device:a})||this;return u.type=Qi.Readback,u.gl_pbo=null,u.gl_sync=null,u}return t.prototype.clientWaitAsync=function(r,i,a){i===void 0&&(i=0),a===void 0&&(a=10);var u=this.device.gl;return new Promise(function(f,m){function _(){var b=u.clientWaitSync(r,i,0);if(b==u.WAIT_FAILED){m();return}if(b==u.TIMEOUT_EXPIRED){setTimeout(_,(0,tR.Z)(a,0,u.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}f()}_()})},t.prototype.getBufferSubDataAsync=function(r,i,a,u,f,m){return(0,fn.mG)(this,void 0,void 0,function(){var _;return(0,fn.Jh)(this,function(b){switch(b.label){case 0:return _=this.device.gl,wn(_)?(this.gl_sync=_.fenceSync(_.SYNC_GPU_COMMANDS_COMPLETE,0),_.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return b.sent(),_.bindBuffer(r,i),_.getBufferSubData(r,a,u,f,m),_.bindBuffer(r,null),[2,u];case 2:return[2]}})})},t.prototype.readTexture=function(r,i,a,u,f,m,_,b){return _===void 0&&(_=0),b===void 0&&(b=m.byteLength||0),(0,fn.mG)(this,void 0,void 0,function(){var A,C,R,U,X;return(0,fn.Jh)(this,function(ee){return A=this.device.gl,C=r,R=this.device.translateTextureFormat(C.format),U=this.device.translateTextureType(C.format),X=rR(C.format),wn(A)?(this.gl_pbo=this.device.ensureResourceExists(A.createBuffer()),A.bindBuffer(A.PIXEL_PACK_BUFFER,this.gl_pbo),A.bufferData(A.PIXEL_PACK_BUFFER,b,A.STREAM_READ),A.bindBuffer(A.PIXEL_PACK_BUFFER,null),A.bindFramebuffer(Ie.READ_FRAMEBUFFER,this.device.readbackFramebuffer),A.framebufferTexture2D(Ie.READ_FRAMEBUFFER,Ie.COLOR_ATTACHMENT0,Ie.TEXTURE_2D,C.gl_texture,0),A.bindBuffer(A.PIXEL_PACK_BUFFER,this.gl_pbo),A.readPixels(i,a,u,f,R,U,_*X),A.bindBuffer(A.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(A.PIXEL_PACK_BUFFER,this.gl_pbo,0,m,_,0)]):[2,this.readTextureSync(r,i,a,u,f,m,_,b)]})})},t.prototype.readTextureSync=function(r,i,a,u,f,m,_,b){b===void 0&&(b=m.byteLength||0);var A=this.device.gl,C=r,R=this.device.translateTextureType(C.format);return A.bindFramebuffer(Ie.FRAMEBUFFER,this.device.readbackFramebuffer),A.framebufferTexture2D(Ie.FRAMEBUFFER,Ie.COLOR_ATTACHMENT0,Ie.TEXTURE_2D,C.gl_texture,0),A.pixelStorei(A.PACK_ALIGNMENT,4),A.readPixels(i,a,u,f,A.RGBA,R,m),m},t.prototype.readBuffer=function(r,i,a,u,f){return(0,fn.mG)(this,void 0,void 0,function(){var m;return(0,fn.Jh)(this,function(_){return m=this.device.gl,wn(m)?[2,this.getBufferSubDataAsync(m.ARRAY_BUFFER,Vd(r,i),i,a,u,f)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),wn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(gc),tI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f,m,_=e.call(this,{id:i,device:a})||this;return _.type=Qi.RenderPipeline,_.drawMode=ZR((f=u.topology)!==null&&f!==void 0?f:ss.TRIANGLES),_.program=u.program,_.inputLayout=u.inputLayout,_.megaState=(0,fn.pi)((0,fn.pi)({},kd(Hp)),u.megaStateDescriptor),_.colorAttachmentFormats=u.colorAttachmentFormats.slice(),_.depthStencilAttachmentFormat=u.depthStencilAttachmentFormat,_.sampleCount=(m=u.sampleCount)!==null&&m!==void 0?m:1,_}return t}(gc),rI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;return f.type=Qi.ComputePipeline,f.descriptor=u,f}return t}(gc),nI=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},e.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},e.prototype.checkForLeaks=function(){var t,r;try{for(var i=(0,fn.XA)(this.liveObjects.values()),a=i.next();!a.done;a=i.next()){var u=a.value;console.warn("Object leaked:",u,"Creation stack:",this.creationStacks.get(u))}}catch(f){t={error:f}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},e.prototype.setResourceLeakCheck=function(t,r){r?this.liveObjects.add(t):this.liveObjects.delete(t)},e}(),iI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f,m,_=e.call(this,{id:i,device:a})||this;_.type=Qi.Sampler;var b=_.device.gl;if(wn(b)){var A=_.device.ensureResourceExists(b.createSampler());b.samplerParameteri(A,Ie.TEXTURE_WRAP_S,qm(u.addressModeU)),b.samplerParameteri(A,Ie.TEXTURE_WRAP_T,qm(u.addressModeV)),b.samplerParameteri(A,Ie.TEXTURE_WRAP_R,qm((f=u.addressModeW)!==null&&f!==void 0?f:u.addressModeU)),b.samplerParameteri(A,Ie.TEXTURE_MIN_FILTER,wg(u.minFilter,u.mipmapFilter)),b.samplerParameteri(A,Ie.TEXTURE_MAG_FILTER,wg(u.magFilter,Ls.NO_MIP)),u.lodMinClamp!==void 0&&b.samplerParameterf(A,Ie.TEXTURE_MIN_LOD,u.lodMinClamp),u.lodMaxClamp!==void 0&&b.samplerParameterf(A,Ie.TEXTURE_MAX_LOD,u.lodMaxClamp),u.compareFunction!==void 0&&(b.samplerParameteri(A,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.samplerParameteri(A,b.TEXTURE_COMPARE_FUNC,u.compareFunction));var C=(m=u.maxAnisotropy)!==null&&m!==void 0?m:1;C>1&&_.device.EXT_texture_filter_anisotropic!==null&&(vi(u.minFilter===Xa.BILINEAR&&u.magFilter===Xa.BILINEAR&&u.mipmapFilter===Ls.LINEAR),b.samplerParameterf(A,_.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C)),_.gl_sampler=A}else _.descriptor=u;return _}return t.prototype.setTextureParameters=function(r,i,a){var u,f=this.device.gl,m=this.descriptor;this.isNPOT(i,a)?f.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_MIN_FILTER,Ie.LINEAR):f.texParameteri(r,Ie.TEXTURE_MIN_FILTER,wg(m.minFilter,m.mipmapFilter)),f.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_S,qm(m.addressModeU)),f.texParameteri(Ie.TEXTURE_2D,Ie.TEXTURE_WRAP_T,qm(m.addressModeV)),f.texParameteri(r,Ie.TEXTURE_MAG_FILTER,wg(m.magFilter,Ls.NO_MIP));var _=(u=m.maxAnisotropy)!==null&&u!==void 0?u:1;_>1&&this.device.EXT_texture_filter_anisotropic!==null&&(vi(m.minFilter===Xa.BILINEAR&&m.magFilter===Xa.BILINEAR&&m.mipmapFilter===Ls.LINEAR),f.texParameteri(r,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,_))},t.prototype.destroy=function(){e.prototype.destroy.call(this),wn(this.device.gl)&&this.device.gl.deleteSampler(V_(this))},t.prototype.isNPOT=function(r,i){return!bg(r)||!bg(i)},t}(gc),oI=function(){function e(){}return e.prototype.dispatchWorkgroups=function(t,r,i){},e.prototype.dispatchWorkgroupsIndirect=function(t,r){},e.prototype.setPipeline=function(t){},e.prototype.setBindings=function(t){},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e}(),aI=function(e){(0,fn.ZT)(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type=Qi.RenderBundle,r.commands=[],r}return t.prototype.push=function(r){this.commands.push(r)},t.prototype.replay=function(){this.commands.forEach(function(r){return r()})},t}(gc),Lx=65536,sI=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,uI=function(){function e(t,r){r===void 0&&(r={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=kd(Hp),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Qc.LOWER_LEFT,this.clipSpaceNearZ=Fd.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=jp(t.getContextAttributes()),wn(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),wn(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new j_({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Pi.TEXTURE_2D,mipLevelCount:1,usage:gu.RENDER_TARGET,format:this.contextAttributes.alpha===!1?et.U8_RGB_RT:et.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=La.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Pi.TEXTURE_2D,La.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Pi.TEXTURE_2D,La.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Lo.VERTEX,hint:$c.STATIC}),wn(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Pi.TEXTURE_2D_ARRAY,La.Float),this.fallbackTexture3D=this.createFallbackTexture(Pi.TEXTURE_3D,La.Float),this.fallbackTextureCube=this.createFallbackTexture(Pi.TEXTURE_CUBE_MAP,La.Float)),this.currentMegaState.depthCompare=Ti.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=Xs.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),r.shaderDebug&&(this.shaderDebug=!0),r.trackResources&&(this.resourceCreationTracker=new nI)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(t,r){var i=t===Pi.TEXTURE_CUBE_MAP?6:1,a=r===La.Depth?et.D32F:et.U8_RGBA_NORM,u=this.createTexture({dimension:t,format:a,usage:gu.SAMPLED,width:1,height:1,depthOrArrayLayers:i,mipLevelCount:1});return r===La.Float&&u.setImageData([new Uint8Array(4*i)]),Zd(u)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(Ie.MAX_VERTEX_ATTRIBS),wn(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(Ie.MAX_UNIFORM_BLOCK_SIZE),Lx),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var r=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=r?(0,fn.ev)([],(0,fn.CR)(r),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=Lx;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(i,a){return i-a})},e.prototype.configureSwapChain=function(t,r,i){var a=this.scTexture;a.width=t,a.height=r,this.scPlatformFramebuffer=oR(i)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(t,r){switch(r===void 0&&(r=!1),t){case et.ALPHA:return Ie.ALPHA;case et.U8_LUMINANCE:case et.F16_LUMINANCE:case et.F32_LUMINANCE:return Ie.LUMINANCE;case et.F16_R:return Ie.R16F;case et.F16_RG:return Ie.RG16F;case et.F16_RGB:return Ie.RGB16F;case et.F16_RGBA:return Ie.RGBA16F;case et.F32_R:return Ie.R32F;case et.F32_RG:return Ie.RG32F;case et.F32_RGB:return Ie.RGB32F;case et.F32_RGBA:return wn(this.gl)?Ie.RGBA32F:r?this.WEBGL_color_buffer_float.RGBA32F_EXT:Ie.RGBA;case et.U8_R_NORM:return Ie.R8;case et.U8_RG_NORM:return Ie.RG8;case et.U8_RGB_NORM:case et.U8_RGB_RT:return Ie.RGB8;case et.U8_RGB_SRGB:return Ie.SRGB8;case et.U8_RGBA_NORM:case et.U8_RGBA_RT:return wn(this.gl)?Ie.RGBA8:r?Ie.RGBA4:Ie.RGBA;case et.U8_RGBA:return Ie.RGBA;case et.U8_RGBA_SRGB:case et.U8_RGBA_RT_SRGB:return Ie.SRGB8_ALPHA8;case et.U16_R:return Ie.R16UI;case et.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case et.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case et.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case et.U16_RGBA_5551:return Ie.RGB5_A1;case et.U16_RGB_565:return Ie.RGB565;case et.U32_R:return Ie.R32UI;case et.S8_RGBA_NORM:return Ie.RGBA8_SNORM;case et.S8_RG_NORM:return Ie.RG8_SNORM;case et.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case et.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case et.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case et.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case et.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case et.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case et.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case et.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case et.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case et.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case et.D32F_S8:return wn(this.gl)?Ie.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?Ie.DEPTH_STENCIL:Ie.DEPTH_COMPONENT16;case et.D24_S8:return wn(this.gl)?Ie.DEPTH24_STENCIL8:this.WEBGL_depth_texture?Ie.DEPTH_STENCIL:Ie.DEPTH_COMPONENT16;case et.D32F:return wn(this.gl)?Ie.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?Ie.DEPTH_COMPONENT:Ie.DEPTH_COMPONENT16;case et.D24:return wn(this.gl)?Ie.DEPTH_COMPONENT24:this.WEBGL_depth_texture?Ie.DEPTH_COMPONENT:Ie.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(t){var r=wh(t);switch(r){case cr.U8:return Ie.UNSIGNED_BYTE;case cr.U16:return Ie.UNSIGNED_SHORT;case cr.U32:return Ie.UNSIGNED_INT;case cr.S8:return Ie.BYTE;case cr.F16:return Ie.HALF_FLOAT;case cr.F32:return Ie.FLOAT;case cr.U16_PACKED_5551:return Ie.UNSIGNED_SHORT_5_5_5_1;case cr.D32F:return wn(this.gl)?Ie.FLOAT:this.WEBGL_depth_texture?Ie.UNSIGNED_INT:Ie.UNSIGNED_BYTE;case cr.D24:return wn(this.gl)?Ie.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Ie.UNSIGNED_SHORT:Ie.UNSIGNED_BYTE;case cr.D24S8:return wn(this.gl)?Ie.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Ie.UNSIGNED_INT_24_8_WEBGL:Ie.UNSIGNED_BYTE;case cr.D32FS8:return Ie.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(t){switch(t){case et.F32_R:return Ie.R32F;case et.F32_RG:return Ie.RG32F;case et.F32_RGB:return Ie.RGB32F;case et.F32_RGBA:return Ie.RGBA32F;case et.F16_R:return Ie.R16F;case et.F16_RG:return Ie.RG16F;case et.F16_RGB:return Ie.RGB16F;case et.F16_RGBA:return Ie.RGBA16F}return this.translateTextureFormat(t)},e.prototype.translateTextureFormat=function(t){if(Ix(t)||t===et.F32_LUMINANCE||t===et.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var r=wn(this.gl)||!wn(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case et.D24_S8:case et.D32F_S8:return r?Ie.DEPTH_STENCIL:Ie.RGBA;case et.D24:case et.D32F:return r?Ie.DEPTH_COMPONENT:Ie.RGBA}var i=Mx(t),a=yg(t);switch(a){case gn.A:return Ie.ALPHA;case gn.R:return i?Ie.RED_INTEGER:Ie.RED;case gn.RG:return i?Ie.RG_INTEGER:Ie.RG;case gn.RGB:return i?Ie.RGB_INTEGER:Ie.RGB;case gn.RGBA:return Ie.RGBA}},e.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},e.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(wn(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},e.prototype.programCompiled=function(t){vi(t.compileState!==xl.NeedsCompile),t.compileState===xl.Compiling&&(t.compileState=xl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},e.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},e.prototype.ensureResourceExists=function(t){if(t===null){var r=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(r))}else return t},e.prototype.createBuffer=function(t){return new qR({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new j_({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new iI({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){return new $R({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTargetFromTexture=function(t){var r=t,i=r.format,a=r.width,u=r.height,f=r.mipLevelCount;return vi(f===1),this.createRenderTarget({format:i,width:a,height:u,sampleCount:1,texture:t})},e.prototype.createProgram=function(t){var r,i,a,u=(r=t.vertex)===null||r===void 0?void 0:r.glsl;return!((i=t.vertex)===null||i===void 0)&&i.glsl&&(t.vertex.glsl=Jf(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((a=t.fragment)===null||a===void 0)&&a.glsl&&(t.fragment.glsl=Jf(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,u)},e.prototype.createProgramSimple=function(t,r){var i=new QR({id:this.getNextUniqueId(),device:this,descriptor:t},r);return i},e.prototype.createBindings=function(t){return new zR({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new KR({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new tI({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePass=function(){return new oI},e.prototype.createComputePipeline=function(t){return new rI({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createReadback=function(){return new eI({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(t,r){return new JR({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.formatRenderPassDescriptor=function(t){var r,i,a,u,f,m,_=t.colorAttachment;t.depthClearValue=(r=t.depthClearValue)!==null&&r!==void 0?r:"load",t.stencilClearValue=(i=t.stencilClearValue)!==null&&i!==void 0?i:"load";for(var b=0;b<_.length;b++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[b]=(a=t.colorAttachmentLevel[b])!==null&&a!==void 0?a:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[b]=(u=t.colorResolveToLevel[b])!==null&&u!==void 0?u:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[b]=(f=t.colorClearColor[b])!==null&&f!==void 0?f:"load",t.colorStore||(t.colorStore=[]),t.colorStore[b]=(m=t.colorStore[b])!==null&&m!==void 0?m:!1},e.prototype.createRenderBundle=function(){return new aI({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(t){this.renderBundle=t},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(t){t.forEach(function(r){r.replay()})},e.prototype.createRenderPass=function(t){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var r=t.colorAttachment,i=t.colorAttachmentLevel,a=t.colorClearColor,u=t.colorResolveTo,f=t.colorResolveToLevel,m=t.depthStencilAttachment,_=t.depthClearValue,b=t.stencilClearValue,A=t.depthStencilResolveTo,C=u&&u.length===1&&u[0]===this.scTexture;this.setRenderPassParametersBegin(r.length,C);for(var R=0;R<r.length;R++)this.setRenderPassParametersColor(R,r[R],i[R],u[R],f[R],C);this.setRenderPassParametersDepthStencil(m,A,C),this.validateCurrentAttachments();for(var R=0;R<r.length;R++){var U=a[R];U!=="load"&&this.setRenderPassParametersClearColor(R,U.r,U.g,U.b,U.a)}return this.setRenderPassParametersClearDepthStencil(_,b),this},e.prototype.submitPass=function(t){vi(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(t,r,i,a,u,f){var m=this.gl,_=t,b=a;if(vi(b.mipLevelCount===1),vi(_.mipLevelCount===1),wn(m))_===this.scTexture?m.bindFramebuffer(m.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(m.bindFramebuffer(m.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(m.DRAW_FRAMEBUFFER,m.COLOR_ATTACHMENT0,_,0)),m.bindFramebuffer(m.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(m.READ_FRAMEBUFFER,m.COLOR_ATTACHMENT0,b,0),m.blitFramebuffer(u,f,u+b.width,f+b.height,r,i,r+b.width,i+b.height,m.COLOR_BUFFER_BIT,m.LINEAR),m.bindFramebuffer(m.READ_FRAMEBUFFER,null),m.bindFramebuffer(m.DRAW_FRAMEBUFFER,null);else if(_===this.scTexture){var A=this.createRenderTargetFromTexture(a);this.submitBlitRenderPass(A,_)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(t,r,i){switch(t){case et.BC1_SRGB:case et.BC2_SRGB:case et.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?Z_(r,i,4,4):!1;case et.BC1:case et.BC2:case et.BC3:return this.WEBGL_compressed_texture_s3tc!==null?Z_(r,i,4,4):!1;case et.BC4_UNORM:case et.BC4_SNORM:case et.BC5_UNORM:case et.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?Z_(r,i,4,4):!1;case et.U16_R_NORM:case et.U16_RG_NORM:case et.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case et.F32_R:case et.F32_RG:case et.F32_RGB:case et.F32_RGBA:return this.OES_texture_float_linear!==null;case et.F16_R:case et.F16_RG:case et.F16_RGB:case et.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(t){var r=this.gl;if(t.compileState===xl.NeedsCompile)throw new Error("whoops");if(t.compileState===xl.Compiling){var i=void 0;return this.KHR_parallel_shader_compile!==null?i=r.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):i=!0,i&&this.programCompiled(t),i}return t.compileState===xl.NeedsBind||t.compileState===xl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===Qi.Buffer)for(var i=t.gl_buffer_pages,a=0;a<i.length;a++)Km(i[a],"".concat(r," Page ").concat(a));else if(t.type===Qi.Texture)Km(Zd(t),r);else if(t.type===Qi.Sampler)Km(V_(t),r);else if(t.type===Qi.RenderTarget){var u=t.gl_renderbuffer;u!==null&&Km(u,r)}else t.type===Qi.InputLayout&&Km(t.vao,r)},e.prototype.setResourceLeakCheck=function(t,r){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,r)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e.prototype.programPatched=function(t,r){vi(this.shaderDebug)},e.prototype.getBufferData=function(t,r,i){i===void 0&&(i=0);var a=this.gl;wn(a)&&(a.bindBuffer(a.COPY_READ_BUFFER,Vd(t,i*4)),a.getBufferSubData(a.COPY_READ_BUFFER,i*4,r))},e.prototype.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].drawCallCount+=t},e.prototype.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].bufferUploadCount+=t},e.prototype.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].textureBindCount+=t},e.prototype.debugGroupStatisticsTriangles=function(t){for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].triangleCount+=t},e.prototype.reportShaderError=function(t,r){var i=this.gl,a=i.getShaderParameter(t,i.COMPILE_STATUS);if(!a){console.error(uR(r));var u=i.getExtension("WEBGL_debug_shaders");u&&console.error(u.getTranslatedShaderSource(t)),console.error(i.getShaderInfoLog(t))}return a},e.prototype.checkProgramCompilationForErrors=function(t){var r=this.gl,i=t.gl_program;if(!r.getProgramParameter(i,r.LINK_STATUS)){var a=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,a.vertex.glsl)||!this.reportShaderError(t.gl_shader_frag,a.fragment.glsl))return;console.error(r.getProgramInfoLog(t.gl_program))}},e.prototype.bindFramebufferAttachment=function(t,r,i,a){var u=this.gl;if((0,vc.Z)(i))u.framebufferRenderbuffer(t,r,u.RENDERBUFFER,null);else if(i.type===Qi.RenderTarget)i.gl_renderbuffer!==null?u.framebufferRenderbuffer(t,r,u.RENDERBUFFER,i.gl_renderbuffer):i.texture!==null&&u.framebufferTexture2D(t,r,Ie.TEXTURE_2D,Zd(i.texture),a);else if(i.type===Qi.Texture){var f=Zd(i);i.dimension===Pi.TEXTURE_2D?u.framebufferTexture2D(t,r,Ie.TEXTURE_2D,f,a):wn(u)&&(i.dimension,Pi.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(t,r){var i=this.gl,a=(0,vc.Z)(r)?an.Depth|an.Stencil:Nd(r.format),u=!!(a&an.Depth),f=!!(a&an.Stencil);if(u&&f){var m=wn(this.gl)||!wn(this.gl)&&!!this.WEBGL_depth_texture;m?this.bindFramebufferAttachment(t,i.DEPTH_STENCIL_ATTACHMENT,r,0):this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,r,0)}else u?(this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,i.STENCIL_ATTACHMENT,null,0)):f&&(this.bindFramebufferAttachment(t,i.STENCIL_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var t=-1,r=-1,i=-1,a=0;a<this.currentColorAttachments.length;a++){var u=this.currentColorAttachments[a];u!==null&&(t===-1?(t=u.sampleCount,r=u.width,i=u.height):(vi(t===u.sampleCount),vi(r===u.width),vi(i===u.height)))}this.currentDepthStencilAttachment&&(t===-1?t=this.currentDepthStencilAttachment.sampleCount:(vi(t===this.currentDepthStencilAttachment.sampleCount),vi(r===this.currentDepthStencilAttachment.width),vi(i===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},e.prototype.setRenderPassParametersBegin=function(t,r){r===void 0&&(r=!1);var i=this.gl;if(r)i.bindFramebuffer(Ie.FRAMEBUFFER,null);else if(wn(i)?i.bindFramebuffer(Ie.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||i.bindFramebuffer(Ie.FRAMEBUFFER,this.renderPassDrawFramebuffer),wn(i)?i.drawBuffers([Ie.COLOR_ATTACHMENT0,Ie.COLOR_ATTACHMENT1,Ie.COLOR_ATTACHMENT2,Ie.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([Ie.COLOR_ATTACHMENT0_WEBGL,Ie.COLOR_ATTACHMENT1_WEBGL,Ie.COLOR_ATTACHMENT2_WEBGL,Ie.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var a=t;a<this.currentColorAttachments.length;a++){var u=wn(i)?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,f=wn(i)?Ie.COLOR_ATTACHMENT0:Ie.COLOR_ATTACHMENT0_WEBGL;i.framebufferRenderbuffer(u,f+a,Ie.RENDERBUFFER,null),i.framebufferTexture2D(u,f+a,Ie.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},e.prototype.setRenderPassParametersColor=function(t,r,i,a,u,f){f===void 0&&(f=!1);var m=this.gl,_=wn(m);(this.currentColorAttachments[t]!==r||this.currentColorAttachmentLevels[t]!==i)&&(this.currentColorAttachments[t]=r,this.currentColorAttachmentLevels[t]=i,!f&&(_||!_&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(_?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,(_?Ie.COLOR_ATTACHMENT0:Ie.COLOR_ATTACHMENT0_WEBGL)+t,r,i),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[t]!==a||this.currentColorResolveToLevels[t]!==u)&&(this.currentColorResolveTos[t]=a,this.currentColorResolveToLevels[t]=u,a!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(t,r,i){i===void 0&&(i=!1);var a=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,!i&&!this.inBlitRenderPass&&this.bindFramebufferDepthStencilAttachment(wn(a)?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==r&&(this.currentDepthStencilResolveTo=r,r&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(t,r,i,a,u){var f=this.gl;if(this.OES_draw_buffers_indexed!==null){var m=this.currentMegaState.attachmentsState[t];m&&m.channelWriteMask!==Xs.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),m.channelWriteMask=Xs.ALL)}else{var m=this.currentMegaState.attachmentsState[0];m&&m.channelWriteMask!==Xs.ALL&&(f.colorMask(!0,!0,!0,!0),m.channelWriteMask=Xs.ALL)}this.setScissorRectEnabled(!1),wn(f)?f.clearBufferfv(f.COLOR,t,[r,i,a,u]):(f.clearColor(r,i,a,u),f.clear(f.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(t,r){t===void 0&&(t="load"),r===void 0&&(r="load");var i=this.gl;t!=="load"&&(vi(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(i.depthMask(!0),this.currentMegaState.depthWrite=!0),wn(i)?i.clearBufferfv(i.DEPTH,0,[t]):(i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT))),r!=="load"&&(vi(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(i.enable(i.STENCIL_TEST),i.stencilMask(255),this.currentMegaState.stencilWrite=!0),wn(i)?i.clearBufferiv(i.STENCIL,0,[r]):(i.clearStencil(r),i.clear(i.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(t){var r=this,i;if(this.renderBundle){this.renderBundle.push(function(){return r.setBindings(t)});return}var a=this.gl,u=t,f=u.uniformBufferBindings,m=u.samplerBindings,_=u.bindingLayouts;vi(0<_.bindingLayoutTables.length);var b=_.bindingLayoutTables[0];vi(f.length>=b.numUniformBuffers),vi(m.length>=b.numSamplers);for(var A=0;A<f.length;A++){var C=f[A];if(C.size!==0){var R=b.firstUniformBuffer+A,U=C.buffer,X=C.offset||0,ee=C.size||U.byteSize;if(U!==this.currentUniformBuffers[R]||X!==this.currentUniformBufferByteOffsets[R]||ee!==this.currentUniformBufferByteSizes[R]){var xe=X%U.pageByteSize,ke=U.gl_buffer_pages[X/U.pageByteSize|0];vi(xe+ee<=U.pageByteSize),wn(a)&&a.bindBufferRange(a.UNIFORM_BUFFER,R,ke,xe,ee),this.currentUniformBuffers[R]=U,this.currentUniformBufferByteOffsets[R]=X,this.currentUniformBufferByteSizes[R]=ee}}}for(var A=0;A<b.numSamplers;A++){var C=m[A],Ne=b.firstSampler+A,it=C!==null&&C.sampler!==null?V_(C.sampler):null,gt=C!==null&&C.texture!==null?Zd(C.texture):null;if(this.currentSamplers[Ne]!==it&&(wn(a)&&a.bindSampler(Ne,it),this.currentSamplers[Ne]=it),this.currentTextures[Ne]!==gt){if(this.setActiveTexture(a.TEXTURE0+Ne),gt!==null){var rr=jp(C).texture,Kt=rr.gl_target,Rt=rr.width,tr=rr.height;C.texture.textureIndex=Ne,a.bindTexture(Kt,gt),wn(a)||(i=C.sampler)===null||i===void 0||i.setTextureParameters(Kt,Rt,tr),this.debugGroupStatisticsTextureBind()}else{var Tn=(0,fn.pi)((0,fn.pi)({},C),yx),fi=Tn.dimension,An=Tn.formatKind,Kt=YR(fi);a.bindTexture(Kt,this.getFallbackTexture((0,fn.pi)({gl_target:Kt,formatKind:An},Tn)))}this.currentTextures[Ne]=gt}}},e.prototype.setViewport=function(t,r,i,a){var u=this.gl;u.viewport(t,r,i,a)},e.prototype.setScissorRect=function(t,r,i,a){var u=this.gl;this.setScissorRectEnabled(!0),u.scissor(t,r,i,a)},e.prototype.applyAttachmentStateIndexed=function(t,r,i){var a=this.gl,u=this.OES_draw_buffers_indexed;r.channelWriteMask!==i.channelWriteMask&&(u.colorMaskiOES(t,!!(i.channelWriteMask&Xs.RED),!!(i.channelWriteMask&Xs.GREEN),!!(i.channelWriteMask&Xs.BLUE),!!(i.channelWriteMask&Xs.ALPHA)),r.channelWriteMask=i.channelWriteMask);var f=r.rgbBlendState.blendMode!==i.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==i.alphaBlendState.blendMode,m=r.rgbBlendState.blendSrcFactor!==i.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==i.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==i.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==i.alphaBlendState.blendDstFactor;(m||f)&&(ep(r.rgbBlendState)&&ep(r.alphaBlendState)?u.enableiOES(t,a.BLEND):ep(i.rgbBlendState)&&ep(i.alphaBlendState)&&u.disableiOES(t,a.BLEND)),f&&(u.blendEquationSeparateiOES(t,i.rgbBlendState.blendMode,i.alphaBlendState.blendMode),r.rgbBlendState.blendMode=i.rgbBlendState.blendMode,r.alphaBlendState.blendMode=i.alphaBlendState.blendMode),m&&(u.blendFuncSeparateiOES(t,i.rgbBlendState.blendSrcFactor,i.rgbBlendState.blendDstFactor,i.alphaBlendState.blendSrcFactor,i.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=i.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=i.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=i.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=i.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(t,r){var i=this.gl;t.channelWriteMask!==r.channelWriteMask&&(i.colorMask(!!(r.channelWriteMask&Xs.RED),!!(r.channelWriteMask&Xs.GREEN),!!(r.channelWriteMask&Xs.BLUE),!!(r.channelWriteMask&Xs.ALPHA)),t.channelWriteMask=r.channelWriteMask);var a=t.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,u=t.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(u||a)&&(ep(t.rgbBlendState)&&ep(t.alphaBlendState)?i.enable(i.BLEND):ep(r.rgbBlendState)&&ep(r.alphaBlendState)&&i.disable(i.BLEND)),a&&(i.blendEquationSeparate(r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),t.rgbBlendState.blendMode=r.rgbBlendState.blendMode,t.alphaBlendState.blendMode=r.alphaBlendState.blendMode),u&&(i.blendFuncSeparate(r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(t){var r=this.gl,i=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var a=0;a<t.attachmentsState.length;a++)this.applyAttachmentStateIndexed(a,i.attachmentsState[0],t.attachmentsState[0]);else vi(t.attachmentsState.length===1),this.applyAttachmentState(i.attachmentsState[0],t.attachmentsState[0]);px(i.blendConstant,t.blendConstant)||(r.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),dx(i.blendConstant,t.blendConstant)),i.depthCompare!==t.depthCompare&&(r.depthFunc(t.depthCompare),i.depthCompare=t.depthCompare),!!i.depthWrite!=!!t.depthWrite&&(r.depthMask(t.depthWrite),i.depthWrite=t.depthWrite),!!i.stencilWrite!=!!t.stencilWrite&&(r.stencilMask(t.stencilWrite?255:0),i.stencilWrite=t.stencilWrite);var u=!1;if(!Ag(i.stencilFront,t.stencilFront)){u=!0;var f=t.stencilFront,m=f.passOp,_=f.failOp,b=f.depthFailOp,A=f.compare;(i.stencilFront.passOp!==m||i.stencilFront.failOp!==_||i.stencilFront.depthFailOp!==b)&&(r.stencilOpSeparate(r.FRONT,_,b,m),i.stencilFront.passOp=m,i.stencilFront.failOp=_,i.stencilFront.depthFailOp=b),i.stencilFront.compare!==A&&(this.setStencilReference(0),i.stencilFront.compare=A)}if(!Ag(i.stencilBack,t.stencilBack)){u=!0;var C=t.stencilBack,m=C.passOp,_=C.failOp,b=C.depthFailOp,A=C.compare;(i.stencilBack.passOp!==m||i.stencilBack.failOp!==_||i.stencilBack.depthFailOp!==b)&&(r.stencilOpSeparate(r.BACK,_,b,m),i.stencilBack.passOp=m,i.stencilBack.failOp=_,i.stencilBack.depthFailOp=b),i.stencilBack.compare!==A&&(this.setStencilReference(0),i.stencilBack.compare=A)}(i.stencilFront.mask!==t.stencilFront.mask||i.stencilBack.mask!==t.stencilBack.mask)&&(u=!0,i.stencilFront.mask=t.stencilFront.mask,i.stencilBack.mask=t.stencilBack.mask),u&&this.applyStencil(),i.cullMode!==t.cullMode&&(i.cullMode===yl.NONE?r.enable(r.CULL_FACE):t.cullMode===yl.NONE&&r.disable(r.CULL_FACE),t.cullMode===yl.BACK?r.cullFace(r.BACK):t.cullMode===yl.FRONT?r.cullFace(r.FRONT):t.cullMode===yl.FRONT_AND_BACK&&r.cullFace(r.FRONT_AND_BACK),i.cullMode=t.cullMode),i.frontFace!==t.frontFace&&(r.frontFace(t.frontFace),i.frontFace=t.frontFace),i.polygonOffset!==t.polygonOffset&&(t.polygonOffset?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),i.polygonOffset=t.polygonOffset),(i.polygonOffsetFactor!==t.polygonOffsetFactor||i.polygonOffsetUnits!==t.polygonOffsetUnits)&&(r.polygonOffset(t.polygonOffsetFactor,t.polygonOffsetUnits),i.polygonOffsetFactor=t.polygonOffsetFactor,i.polygonOffsetUnits=t.polygonOffsetUnits)},e.prototype.validatePipelineFormats=function(t){for(var r=0;r<this.currentColorAttachments.length;r++)var i=this.currentColorAttachments[r];this.currentDepthStencilAttachment&&vi(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&vi(this.currentSampleCount===t.sampleCount)},e.prototype.setPipeline=function(t){var r=this;if(this.renderBundle){this.renderBundle.push(function(){return r.setPipeline(t)});return}this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var i=this.currentPipeline.program;if(this.useProgram(i),i.compileState===xl.NeedsBind){var a=this.gl,u=i.gl_program,f=i.descriptor,m=Px(f.vertex.glsl,sI);if(wn(a))for(var _=0;_<m.length;_++){var b=(0,fn.CR)(m[_],2),A=b[1],C=a.getUniformBlockIndex(u,A);C!==-1&&C!==4294967295&&a.uniformBlockBinding(u,C,_)}for(var R=Px(f.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),_=0;_<R.length;_++){var U=(0,fn.CR)(R[_],3),X=U[1],ee=U[2],xe=a.getUniformLocation(u,X);a.uniform1i(xe,parseInt(ee))}i.compileState=xl.ReadyToUse}},e.prototype.setVertexInput=function(t,r,i){var a,u,f=this,m;if(this.renderBundle){this.renderBundle.push(function(){return f.setVertexInput(t,r,i)});return}if(t!==null){vi(this.currentPipeline.inputLayout===t);var _=t;this.bindVAO(_.vao);for(var b=this.gl,A=0;A<_.vertexBufferDescriptors.length;A++){var C=_.vertexBufferDescriptors[A],R=C.arrayStride,U=C.attributes;try{for(var X=(a=void 0,(0,fn.XA)(U)),ee=X.next();!ee.done;ee=X.next()){var xe=ee.value,ke=xe.shaderLocation,Ne=xe.offset,it=wn(b)?ke:(m=_.program.attributes[ke])===null||m===void 0?void 0:m.location;if(!(0,vc.Z)(it)){var gt=r[A];if(gt===null)continue;var rr=xe.vertexFormat;b.bindBuffer(b.ARRAY_BUFFER,Vd(gt.buffer));var Kt=(gt.offset||0)+Ne;b.vertexAttribPointer(it,rr.size,rr.type,rr.normalized,R,Kt)}}}catch(tr){a={error:tr}}finally{try{ee&&!ee.done&&(u=X.return)&&u.call(X)}finally{if(a)throw a.error}}}if(vi(i!==null==(_.indexBufferFormat!==null)),i!==null){var Rt=i.buffer;vi(Rt.usage===Lo.INDEX),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,Vd(Rt)),this.currentIndexBufferByteOffset=i.offset||0}else this.currentIndexBufferByteOffset=null}else vi(this.currentPipeline.inputLayout===null),vi(i===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},e.prototype.draw=function(t,r,i,a){var u,f=this;if(this.renderBundle){this.renderBundle.push(function(){return f.draw(t,r,i,a)});return}var m=this.gl,_=this.currentPipeline;if(r){var b=[_.drawMode,i||0,t,r];wn(m)?m.drawArraysInstanced.apply(m,(0,fn.ev)([],(0,fn.CR)(b),!1)):(u=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(u,(0,fn.ev)([],(0,fn.CR)(b),!1))}else m.drawArrays(_.drawMode,i,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndexed=function(t,r,i,a,u){var f,m=this;if(this.renderBundle){this.renderBundle.push(function(){return m.drawIndexed(t,r,i,a,u)});return}var _=this.gl,b=this.currentPipeline,A=jp(b.inputLayout),C=jp(this.currentIndexBufferByteOffset)+i*A.indexBufferCompByteSize;if(r){var R=[b.drawMode,t,A.indexBufferType,C,r];wn(_)?_.drawElementsInstanced.apply(_,(0,fn.ev)([],(0,fn.CR)(R),!1)):(f=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(f,(0,fn.ev)([],(0,fn.CR)(R),!1))}else _.drawElements(b.drawMode,t,A.indexBufferType,C);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndirect=function(t,r){},e.prototype.drawIndexedIndirect=function(t,r){},e.prototype.beginOcclusionQuery=function(t){var r=this.gl;if(wn(r)){var i=this.currentRenderPassDescriptor.occlusionQueryPool;r.beginQuery(i.gl_query_type,i.gl_query[t])}},e.prototype.endOcclusionQuery=function(){var t=this.gl;if(wn(t)){var r=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(r.gl_query_type)}},e.prototype.pipelineQueryReady=function(t){var r=t;return this.queryProgramReady(r.program)},e.prototype.pipelineForceReady=function(t){},e.prototype.endPass=function(){for(var t=this.gl,r=wn(t),i=this.currentColorResolveTos.length===1&&this.currentColorResolveTos[0]===this.scTexture,a=!1,u=0;u<this.currentColorAttachments.length;u++){var f=this.currentColorAttachments[u];if(f!==null){var m=this.currentColorResolveTos[u],_=!1;m!==null&&(vi(f.width===m.width&&f.height===m.height),this.setScissorRectEnabled(!1),i||(r&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&r&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,f,this.currentColorAttachmentLevels[u])),_=!0,i||(m===this.scTexture?t.bindFramebuffer(r?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(r?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(r?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,m.gl_texture,this.currentColorResolveToLevels[u]))),i||(r?(t.blitFramebuffer(0,0,f.width,f.height,0,0,m.width,m.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(f,m)),a=!0),this.currentRenderPassDescriptor.colorStore[u]||!i&&!_&&(t.bindFramebuffer(r?Ie.READ_FRAMEBUFFER:Ie.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(r?Ie.READ_FRAMEBUFFER:Ie.FRAMEBUFFER,t.COLOR_ATTACHMENT0,f,this.currentColorAttachmentLevels[u])),i||t.bindFramebuffer(r?Ie.READ_FRAMEBUFFER:Ie.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var b=this.currentDepthStencilAttachment;if(b){var A=this.currentDepthStencilResolveTo,_=!1;A&&(vi(b.width===A.width&&b.height===A.height),this.setScissorRectEnabled(!1),i||(t.bindFramebuffer(r?Ie.READ_FRAMEBUFFER:Ie.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(r?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(r?Ie.READ_FRAMEBUFFER:Ie.FRAMEBUFFER,b),this.bindFramebufferDepthStencilAttachment(r?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,A))),_=!0,i||(r&&t.blitFramebuffer(0,0,b.width,b.height,0,0,A.width,A.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(r?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,null)),a=!0),!i&&!this.currentRenderPassDescriptor.depthStencilStore&&(_||(t.bindFramebuffer(r?Ie.READ_FRAMEBUFFER:Ie.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(r?Ie.READ_FRAMEBUFFER:Ie.FRAMEBUFFER,b),_=!0),r&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),!i&&_&&t.bindFramebuffer(r?Ie.READ_FRAMEBUFFER:Ie.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}!i&&!a&&t.bindFramebuffer(r?Ie.DRAW_FRAMEBUFFER:Ie.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var r=this.gl;t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),this.currentScissorEnabled=t}},e.prototype.applyStencil=function(){(0,vc.Z)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(Ie.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(Ie.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(t){var r=t.gl_target,i=t.formatKind;if(r===Ie.TEXTURE_2D)return i===La.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===Ie.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===Ie.TEXTURE_3D)return this.fallbackTexture3D;if(r===Ie.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(t,r){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:Lo.VERTEX|Lo.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Zp.VERTEX,attributes:[{format:et.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:ss.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[et.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:kd(Hp)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var i=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var a=this.createRenderPass({colorAttachment:[t],colorResolveTo:[r],colorClearColor:[nR]}),u=this.getCanvas(),f=u.width,m=u.height;a.setPipeline(this.blitRenderPipeline),a.setBindings(this.blitBindings),a.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),a.setViewport(0,0,f,m),this.gl.disable(this.gl.BLEND),a.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=i,this.inBlitRenderPass=!1},e}(),lI=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return(0,fn.mG)(this,void 0,void 0,function(){var r,i,a,u,f,m,_,b,A,C,R,U,X;return(0,fn.Jh)(this,function(ee){return r=this.pluginOptions,i=r.targets,a=r.xrCompatible,u=r.antialias,f=u===void 0?!1:u,m=r.preserveDrawingBuffer,_=m===void 0?!1:m,b=r.premultipliedAlpha,A=b===void 0?!0:b,C=r.shaderDebug,R=r.trackResources,U={antialias:f,preserveDrawingBuffer:_,stencil:!0,premultipliedAlpha:A,xrCompatible:a},this.handleContextEvents(t),i.includes("webgl2")&&(X=t.getContext("webgl2",U)||t.getContext("experimental-webgl2",U)),!X&&i.includes("webgl1")&&(X=t.getContext("webgl",U)||t.getContext("experimental-webgl",U)),[2,new uI(X,{shaderDebug:C,trackResources:R})]})})},e.prototype.handleContextEvents=function(t){var r=this.pluginOptions,i=r.onContextLost,a=r.onContextRestored,u=r.onContextCreationError;u&&t.addEventListener("webglcontextcreationerror",u,!1),i&&t.addEventListener("webglcontextlost",i,!1),a&&t.addEventListener("webglcontextrestored",a,!1)},e}();let Ba;const Dx=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&Dx.decode();let $m=null;function Cg(){return($m===null||$m.byteLength===0)&&($m=new Uint8Array(Ba.memory.buffer)),$m}function Rg(e,t){return e=e>>>0,Dx.decode(Cg().subarray(e,e+t))}const uf=new Array(128).fill(void 0);uf.push(void 0,null,!0,!1);let Qm=uf.length;function cI(e){Qm===uf.length&&uf.push(uf.length+1);const t=Qm;return Qm=uf[t],uf[t]=e,t}function Ig(e){return uf[e]}function hI(e){e<132||(uf[e]=Qm,Qm=e)}function fI(e){const t=Ig(e);return hI(e),t}let jd=0;const Mg=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},pI=typeof Mg.encodeInto=="function"?function(e,t){return Mg.encodeInto(e,t)}:function(e,t){const r=Mg.encode(e);return t.set(r),{read:e.length,written:r.length}};function Og(e,t,r){if(r===void 0){const m=Mg.encode(e),_=t(m.length,1)>>>0;return Cg().subarray(_,_+m.length).set(m),jd=m.length,_}let i=e.length,a=t(i,1)>>>0;const u=Cg();let f=0;for(;f<i;f++){const m=e.charCodeAt(f);if(m>127)break;u[a+f]=m}if(f!==i){f!==0&&(e=e.slice(f)),a=r(a,i,i=f+e.length*3,1)>>>0;const m=Cg().subarray(a+f,a+i),_=pI(e,m);f+=_.written}return jd=f,a}let Jm=null;function Pg(){return(Jm===null||Jm.byteLength===0)&&(Jm=new Int32Array(Ba.memory.buffer)),Jm}function dI(e,t,r){let i,a;try{const m=Ba.__wbindgen_add_to_stack_pointer(-16),_=Og(e,Ba.__wbindgen_malloc,Ba.__wbindgen_realloc),b=jd,A=Og(t,Ba.__wbindgen_malloc,Ba.__wbindgen_realloc),C=jd;Ba.glsl_compile(m,_,b,A,C,r);var u=Pg()[m/4+0],f=Pg()[m/4+1];return i=u,a=f,Rg(u,f)}finally{Ba.__wbindgen_add_to_stack_pointer(16),Ba.__wbindgen_free(i,a,1)}}class ev{static __wrap(t){t=t>>>0;const r=Object.create(ev.prototype);return r.__wbg_ptr=t,r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();Ba.__wbg_wgslcomposer_free(t)}constructor(){const t=Ba.wgslcomposer_new();return ev.__wrap(t)}load_composable(t){const r=Og(t,Ba.__wbindgen_malloc,Ba.__wbindgen_realloc),i=jd;Ba.wgslcomposer_load_composable(this.__wbg_ptr,r,i)}wgsl_compile(t){let r,i;try{const f=Ba.__wbindgen_add_to_stack_pointer(-16),m=Og(t,Ba.__wbindgen_malloc,Ba.__wbindgen_realloc),_=jd;Ba.wgslcomposer_wgsl_compile(f,this.__wbg_ptr,m,_);var a=Pg()[f/4+0],u=Pg()[f/4+1];return r=a,i=u,Rg(a,u)}finally{Ba.__wbindgen_add_to_stack_pointer(16),Ba.__wbindgen_free(r,i,1)}}}function mI(e,t){return r0(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const r=yield e.arrayBuffer();return yield WebAssembly.instantiate(r,t)}else{const r=yield WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}})}function vI(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,r){const i=Rg(t,r);return cI(i)},e.wbg.__wbindgen_object_drop_ref=function(t){fI(t)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(Ig(t))},e.wbg.__wbg_log_576ca876af0d4a77=function(t,r){console.log(Ig(t),Ig(r))},e.wbg.__wbindgen_throw=function(t,r){throw new Error(Rg(t,r))},e}function gI(e,t){return Ba=e.exports,Bx.__wbindgen_wasm_module=t,Jm=null,$m=null,Ba}function Bx(e){return r0(this,null,function*(){if(Ba!==void 0)return Ba;const t=vI();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:i}=yield mI(yield e,t);return gI(r,i)})}var Ds;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(Ds||(Ds={}));var H_;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(H_||(H_={}));function _I(e){var t=0;return e&gu.SAMPLED&&(t|=Ds.TEXTURE_BINDING|Ds.COPY_DST|Ds.COPY_SRC),e&gu.STORAGE&&(t|=Ds.TEXTURE_BINDING|Ds.STORAGE_BINDING|Ds.COPY_SRC|Ds.COPY_DST),e&gu.RENDER_TARGET&&(t|=Ds.RENDER_ATTACHMENT|Ds.TEXTURE_BINDING|Ds.COPY_SRC|Ds.COPY_DST),t}function X_(e){if(e===et.U8_R_NORM)return"r8unorm";if(e===et.S8_R_NORM)return"r8snorm";if(e===et.U8_RG_NORM)return"rg8unorm";if(e===et.S8_RG_NORM)return"rg8snorm";if(e===et.U32_R)return"r32uint";if(e===et.S32_R)return"r32sint";if(e===et.F32_R)return"r32float";if(e===et.U16_RG)return"rg16uint";if(e===et.S16_RG)return"rg16sint";if(e===et.F16_RG)return"rg16float";if(e===et.U8_RGBA_RT)return"bgra8unorm";if(e===et.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===et.U8_RGBA_NORM)return"rgba8unorm";if(e===et.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===et.S8_RGBA_NORM)return"rgba8snorm";if(e===et.U32_RG)return"rg32uint";if(e===et.S32_RG)return"rg32sint";if(e===et.F32_RG)return"rg32float";if(e===et.U16_RGBA)return"rgba16uint";if(e===et.S16_RGBA)return"rgba16sint";if(e===et.F16_RGBA)return"rgba16float";if(e===et.F32_RGBA)return"rgba32float";if(e===et.U32_RGBA)return"rgba32uint";if(e===et.S32_RGBA)return"rgba32sint";if(e===et.D24)return"depth24plus";if(e===et.D24_S8)return"depth24plus-stencil8";if(e===et.D32F)return"depth32float";if(e===et.D32F_S8)return"depth32float-stencil8";if(e===et.BC1)return"bc1-rgba-unorm";if(e===et.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===et.BC2)return"bc2-rgba-unorm";if(e===et.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===et.BC3)return"bc3-rgba-unorm";if(e===et.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===et.BC4_SNORM)return"bc4-r-snorm";if(e===et.BC4_UNORM)return"bc4-r-unorm";if(e===et.BC5_SNORM)return"bc5-rg-snorm";if(e===et.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function yI(e){if(e===Pi.TEXTURE_2D)return"2d";if(e===Pi.TEXTURE_CUBE_MAP)return"2d";if(e===Pi.TEXTURE_2D_ARRAY)return"2d";if(e===Pi.TEXTURE_3D)return"3d";throw new Error("whoops")}function xI(e){if(e===Pi.TEXTURE_2D)return"2d";if(e===Pi.TEXTURE_CUBE_MAP)return"cube";if(e===Pi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Pi.TEXTURE_3D)return"3d";throw new Error("whoops")}function bI(e){var t=0;return e&Lo.INDEX&&(t|=GPUBufferUsage.INDEX),e&Lo.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&Lo.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&Lo.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&Lo.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&Lo.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|=GPUBufferUsage.COPY_DST,t}function W_(e){if(e===$u.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===$u.REPEAT)return"repeat";if(e===$u.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function Fx(e){if(e===Xa.BILINEAR)return"linear";if(e===Xa.POINT)return"nearest";throw new Error("whoops")}function EI(e){if(e===Ls.LINEAR)return"linear";if(e===Ls.NEAREST)return"nearest";if(e===Ls.NO_MIP)return"nearest";throw new Error("whoops")}function Hd(e){var t=e;return t.gpuBuffer}function TI(e){var t=e;return t.gpuSampler}function AI(e){var t=e;return t.querySet}function SI(e){if(e===_g.OcclusionConservative)return"occlusion";throw new Error("whoops")}function wI(e){switch(e){case ss.TRIANGLES:return"triangle-list";case ss.POINTS:return"point-list";case ss.TRIANGLE_STRIP:return"triangle-strip";case ss.LINES:return"line-list";case ss.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function CI(e){if(e===yl.NONE)return"none";if(e===yl.FRONT)return"front";if(e===yl.BACK)return"back";throw new Error("whoops")}function RI(e){if(e===Xm.CCW)return"ccw";if(e===Xm.CW)return"cw";throw new Error("whoops")}function II(e,t){return{topology:wI(e),cullMode:CI(t.cullMode),frontFace:RI(t.frontFace)}}function Nx(e){if(e===Di.ZERO)return"zero";if(e===Di.ONE)return"one";if(e===Di.SRC)return"src";if(e===Di.ONE_MINUS_SRC)return"one-minus-src";if(e===Di.DST)return"dst";if(e===Di.ONE_MINUS_DST)return"one-minus-dst";if(e===Di.SRC_ALPHA)return"src-alpha";if(e===Di.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Di.DST_ALPHA)return"dst-alpha";if(e===Di.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Di.CONST)return"constant";if(e===Di.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Di.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function MI(e){if(e===Hs.ADD)return"add";if(e===Hs.SUBSTRACT)return"subtract";if(e===Hs.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===Hs.MIN)return"min";if(e===Hs.MAX)return"max";throw new Error("whoops")}function Ux(e){return{operation:MI(e.blendMode),srcFactor:Nx(e.blendSrcFactor),dstFactor:Nx(e.blendDstFactor)}}function kx(e){return e.blendMode===Hs.ADD&&e.blendSrcFactor===Di.ONE&&e.blendDstFactor===Di.ZERO}function OI(e){if(!(kx(e.rgbBlendState)&&kx(e.alphaBlendState)))return{color:Ux(e.rgbBlendState),alpha:Ux(e.alphaBlendState)}}function PI(e,t){return{format:X_(t),blend:OI(e),writeMask:e.channelWriteMask}}function LI(e,t){return t.attachmentsState.map(function(r,i){return PI(r,e[i])})}function Lg(e){if(e===Ti.NEVER)return"never";if(e===Ti.LESS)return"less";if(e===Ti.EQUAL)return"equal";if(e===Ti.LEQUAL)return"less-equal";if(e===Ti.GREATER)return"greater";if(e===Ti.NOTEQUAL)return"not-equal";if(e===Ti.GEQUAL)return"greater-equal";if(e===Ti.ALWAYS)return"always";throw new Error("whoops")}function Xd(e){if(e===Pa.KEEP)return"keep";if(e===Pa.REPLACE)return"replace";if(e===Pa.ZERO)return"zero";if(e===Pa.DECREMENT_CLAMP)return"decrement-clamp";if(e===Pa.DECREMENT_WRAP)return"decrement-wrap";if(e===Pa.INCREMENT_CLAMP)return"increment-clamp";if(e===Pa.INCREMENT_WRAP)return"increment-wrap";if(e===Pa.INVERT)return"invert";throw new Error("whoops")}function DI(e,t){if(!(0,vc.Z)(e))return{format:X_(e),depthWriteEnabled:!!t.depthWrite,depthCompare:Lg(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:Lg(t.stencilFront.compare),passOp:Xd(t.stencilFront.passOp),failOp:Xd(t.stencilFront.failOp),depthFailOp:Xd(t.stencilFront.depthFailOp)},stencilBack:{compare:Lg(t.stencilBack.compare),passOp:Xd(t.stencilBack.passOp),failOp:Xd(t.stencilBack.failOp),depthFailOp:Xd(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}function BI(e){if(e!==null){if(e===et.U16_R)return"uint16";if(e===et.U32_R)return"uint32";throw new Error("whoops")}}function FI(e){if(e===Zp.VERTEX)return"vertex";if(e===Zp.INSTANCE)return"instance";throw new Error("whoops")}function NI(e){if(e===et.U8_R)return"uint8x2";if(e===et.U8_RG)return"uint8x2";if(e===et.U8_RGB)return"uint8x4";if(e===et.U8_RGBA)return"uint8x4";if(e===et.U8_RG_NORM)return"unorm8x2";if(e===et.U8_RGBA_NORM)return"unorm8x4";if(e===et.S8_RGB_NORM)return"snorm8x4";if(e===et.S8_RGBA_NORM)return"snorm8x4";if(e===et.U16_RG_NORM)return"unorm16x2";if(e===et.U16_RGBA_NORM)return"unorm16x4";if(e===et.S16_RG_NORM)return"snorm16x2";if(e===et.S16_RGBA_NORM)return"snorm16x4";if(e===et.S16_RG)return"uint16x2";if(e===et.F16_RG)return"float16x2";if(e===et.F16_RGBA)return"float16x4";if(e===et.F32_R)return"float32";if(e===et.F32_RG)return"float32x2";if(e===et.F32_RGB)return"float32x3";if(e===et.F32_RGBA)return"float32x4";throw"whoops"}function UI(e){var t=wh(e);switch(t){case cr.BC1:case cr.BC2:case cr.BC3:case cr.BC4_SNORM:case cr.BC4_UNORM:case cr.BC5_SNORM:case cr.BC5_UNORM:return!0;default:return!1}}function kI(e){var t=wh(e);switch(t){case cr.BC1:case cr.BC2:case cr.BC3:case cr.BC4_SNORM:case cr.BC4_UNORM:case cr.BC5_SNORM:case cr.BC5_UNORM:return 4;default:return 1}}function zx(e,t,r,i){switch(r===void 0&&(r=!1),e){case et.S8_R:case et.S8_R_NORM:case et.S8_RG_NORM:case et.S8_RGB_NORM:case et.S8_RGBA_NORM:{var a=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t);return i&&a.set(new Int8Array(i)),a}case et.U8_R:case et.U8_R_NORM:case et.U8_RG:case et.U8_RG_NORM:case et.U8_RGB:case et.U8_RGB_NORM:case et.U8_RGB_SRGB:case et.U8_RGBA:case et.U8_RGBA_NORM:case et.U8_RGBA_SRGB:{var u=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return i&&u.set(new Uint8Array(i)),u}case et.S16_R:case et.S16_RG:case et.S16_RG_NORM:case et.S16_RGB_NORM:case et.S16_RGBA:case et.S16_RGBA_NORM:{var f=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return i&&f.set(new Int16Array(i)),f}case et.U16_R:case et.U16_RGB:case et.U16_RGBA_5551:case et.U16_RGBA_NORM:case et.U16_RG_NORM:case et.U16_R_NORM:{var m=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return i&&m.set(new Uint16Array(i)),m}case et.S32_R:{var _=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return i&&_.set(new Int32Array(i)),_}case et.U32_R:case et.U32_RG:{var b=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return i&&b.set(new Uint32Array(i)),b}case et.F32_R:case et.F32_RG:case et.F32_RGB:case et.F32_RGBA:{var A=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return i&&A.set(new Float32Array(i)),A}}var C=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return i&&C.set(new Uint8Array(i)),C}function zI(e){var t=(e&32768)>>15,r=(e&31744)>>10,i=e&1023;return r===0?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):r==31?i?NaN:(t?-1:1)*(1/0):(t?-1:1)*Math.pow(2,r-15)*(1+i/Math.pow(2,10))}function Vx(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var Jc=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this)||this;return u.id=i,u.device=a,u}return t.prototype.destroy=function(){},t}(ux.Z),VI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f,m,_=e.call(this,{id:i,device:a})||this;_.type=Qi.Bindings;var b=u.pipeline;vi(!!b);var A=u.uniformBufferBindings,C=u.storageBufferBindings,R=u.samplerBindings,U=u.storageTextureBindings;_.numUniformBuffers=(A==null?void 0:A.length)||0;var X=[[],[],[],[]],ee=0;if(A&&A.length)for(var xe=0;xe<A.length;xe++){var ke=u.uniformBufferBindings[xe],Ne=ke.binding,it=ke.size,gt=ke.offset,rr=ke.buffer,Kt={buffer:Hd(rr),offset:gt!=null?gt:0,size:it};X[0].push({binding:Ne!=null?Ne:ee++,resource:Kt})}if(R&&R.length){ee=0;for(var xe=0;xe<R.length;xe++){var Rt=(0,fn.pi)((0,fn.pi)({},R[xe]),yx),Ne=u.samplerBindings[xe],tr=Ne.texture!==null?Ne.texture:_.device.getFallbackTexture(Rt);Rt.dimension=tr.dimension,Rt.formatKind=fx(tr.format);var Tn=tr.gpuTextureView;if(X[1].push({binding:(f=Ne.textureBinding)!==null&&f!==void 0?f:ee++,resource:Tn}),Ne.samplerBinding!==-1){var fi=Ne.sampler!==null?Ne.sampler:_.device.getFallbackSampler(Rt),An=TI(fi);X[1].push({binding:(m=Ne.samplerBinding)!==null&&m!==void 0?m:ee++,resource:An})}}}if(C&&C.length){ee=0;for(var xe=0;xe<C.length;xe++){var ui=u.storageBufferBindings[xe],Ne=ui.binding,it=ui.size,gt=ui.offset,rr=ui.buffer,Kt={buffer:Hd(rr),offset:gt!=null?gt:0,size:it};X[2].push({binding:Ne!=null?Ne:ee++,resource:Kt})}}if(U&&U.length){ee=0;for(var xe=0;xe<U.length;xe++){var Xi=u.storageTextureBindings[xe],Ne=Xi.binding,tr=Xi.texture,Tn=tr.gpuTextureView;X[3].push({binding:Ne!=null?Ne:ee++,resource:Tn})}}var ou=X.findLastIndex(function(Lu){return!!Lu.length});return _.gpuBindGroup=X.map(function(Lu,bl){return bl<=ou&&_.device.device.createBindGroup({layout:b.getBindGroupLayout(bl),entries:Lu})}),_}return t}(Jc),ZI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;f.type=Qi.Buffer;var m=u.usage,_=u.viewOrSize,b=!!(m&Lo.MAP_READ);f.usage=bI(m),b&&(f.usage=Lo.MAP_READ|Lo.COPY_DST);var A=!(0,Bd.Z)(_);if(f.view=(0,Bd.Z)(_)?null:_,f.size=(0,Bd.Z)(_)?Eg(_,4):Eg(_.byteLength,4),(0,Bd.Z)(_))f.gpuBuffer=f.device.device.createBuffer({usage:f.usage,size:f.size,mappedAtCreation:b?A:!1});else{f.gpuBuffer=f.device.device.createBuffer({usage:f.usage,size:f.size,mappedAtCreation:!0});var C=_&&_.constructor||Float32Array;new C(f.gpuBuffer.getMappedRange()).set(_),f.gpuBuffer.unmap()}return f}return t.prototype.setSubData=function(r,i,a,u){a===void 0&&(a=0),u===void 0&&(u=0);var f=this.gpuBuffer;u=u||i.byteLength,u=Math.min(u,this.size-r);var m=i.byteOffset+a,_=m+u,b=u+3&-4;if(b!==u){var A=new Uint8Array(i.buffer.slice(m,_));i=new Uint8Array(b),i.set(A),a=0,m=0,_=b,u=b}for(var C=1024*1024*15,R=0;_-(m+R)>C;)this.device.device.queue.writeBuffer(f,r+R,i.buffer,m+R,C),R+=C;this.device.device.queue.writeBuffer(f,r+R,i.buffer,m+R,u-R)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(Jc),Zx=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(t,r,i){this.gpuComputePassEncoder.dispatchWorkgroups(t,r,i)},e.prototype.dispatchWorkgroupsIndirect=function(t,r){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,r)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(t){vi(this.gpuComputePassEncoder===null),this.frameCommandEncoder=t,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(t){var r=t,i=jp(r.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(i)},e.prototype.setBindings=function(t){var r=this,i=t;i.gpuBindGroup.forEach(function(a,u){a&&r.gpuComputePassEncoder.setBindGroup(u,i.gpuBindGroup[u])})},e.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},e}(),jI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;f.type=Qi.ComputePipeline,f.gpuComputePipeline=null,f.descriptor=u;var m=u.program,_=m.computeStage;if(_===null)return f;var b={layout:"auto",compute:(0,fn.pi)({},_)};return f.gpuComputePipeline=f.device.device.createComputePipeline(b),f.name!==void 0&&(f.gpuComputePipeline.label=f.name),f}return t.prototype.getBindGroupLayout=function(r){return this.gpuComputePipeline.getBindGroupLayout(r)},t}(Jc),HI=function(e){(0,fn.ZT)(t,e);function t(r){var i,a,u,f,m=r.id,_=r.device,b=r.descriptor,A=e.call(this,{id:m,device:_})||this;A.type=Qi.InputLayout;var C=[];try{for(var R=(0,fn.XA)(b.vertexBufferDescriptors),U=R.next();!U.done;U=R.next()){var X=U.value,ee=X.arrayStride,xe=X.stepMode,ke=X.attributes;C.push({arrayStride:ee,stepMode:FI(xe),attributes:[]});try{for(var Ne=(u=void 0,(0,fn.XA)(ke)),it=Ne.next();!it.done;it=Ne.next()){var gt=it.value,rr=gt.shaderLocation,Kt=gt.format,Rt=gt.offset;C[C.length-1].attributes.push({shaderLocation:rr,format:NI(Kt),offset:Rt})}}catch(tr){u={error:tr}}finally{try{it&&!it.done&&(f=Ne.return)&&f.call(Ne)}finally{if(u)throw u.error}}}}catch(tr){i={error:tr}}finally{try{U&&!U.done&&(a=R.return)&&a.call(R)}finally{if(i)throw i.error}}return A.indexFormat=BI(b.indexBufferFormat),A.buffers=C,A}return t}(Jc),jx=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;return f.type=Qi.Program,f.vertexStage=null,f.fragmentStage=null,f.computeStage=null,f.descriptor=u,u.vertex&&(f.vertexStage=f.createShaderStage(u.vertex,"vertex")),u.fragment&&(f.fragmentStage=f.createShaderStage(u.fragment,"fragment")),u.compute&&(f.computeStage=f.createShaderStage(u.compute,"compute")),f}return t.prototype.setUniformsLegacy=function(r){},t.prototype.createShaderStage=function(r,i){var a,u,f=r.glsl,m=r.wgsl,_=r.entryPoint,b=r.postprocess,A=!1,C=m;if(!C)try{C=this.device.glsl_compile(f,i,A)}catch(ke){throw console.error(ke,f),new Error("whoops")}var R=function(ke){if(!C.includes(ke))return"continue";C=C.replace("var T_".concat(ke,": texture_2d<f32>;"),"var T_".concat(ke,": texture_depth_2d;")),C=C.replace(new RegExp("textureSample\\(T_".concat(ke,"(.*)\\);$"),"gm"),function(Ne,it){return"vec4<f32>(textureSample(T_".concat(ke).concat(it,"), 0.0, 0.0, 0.0);")})};try{for(var U=(0,fn.XA)(["u_TextureFramebufferDepth"]),X=U.next();!X.done;X=U.next()){var ee=X.value;R(ee)}}catch(ke){a={error:ke}}finally{try{X&&!X.done&&(u=U.return)&&u.call(U)}finally{if(a)throw a.error}}b&&(C=b(C));var xe=this.device.device.createShaderModule({code:C});return{module:xe,entryPoint:_||"main"}},t}(Jc),XI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;f.type=Qi.QueryPool;var m=u.elemCount,_=u.type;return f.querySet=f.device.device.createQuerySet({type:SI(_),count:m}),f.resolveBuffer=f.device.device.createBuffer({size:m*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),f.cpuBuffer=f.device.device.createBuffer({size:m*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),f.results=null,f}return t.prototype.queryResultOcclusion=function(r){return this.results===null?null:this.results[r]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(Jc),WI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this,{id:i,device:a})||this;return u.type=Qi.Readback,u}return t.prototype.readTexture=function(r,i,a,u,f,m,_,b){return _===void 0&&(_=0),(0,fn.mG)(this,void 0,void 0,function(){var A,C,R,U,X,ee,xe,ke;return(0,fn.Jh)(this,function(Ne){return A=r,C=0,R=Vx(A.gpuTextureformat),U=Math.ceil(u/R.width)*R.length,X=Math.ceil(U/256)*256,ee=X*f,xe=this.device.createBuffer({usage:Lo.STORAGE|Lo.MAP_READ|Lo.COPY_DST,hint:$c.STATIC,viewOrSize:ee}),ke=this.device.device.createCommandEncoder(),ke.copyTextureToBuffer({texture:A.gpuTexture,mipLevel:0,origin:{x:i,y:a,z:Math.max(C,0)}},{buffer:xe.gpuBuffer,offset:0,bytesPerRow:X},{width:u,height:f,depthOrArrayLayers:1}),this.device.device.queue.submit([ke.finish()]),[2,this.readBuffer(xe,0,m.byteLength===ee?m:null,_,ee,A.format,!0,!1,U,X,f)]})})},t.prototype.readTextureSync=function(r,i,a,u,f,m,_,b){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(r,i,a,u,f,m,_,b,A,C,R){var U=this;i===void 0&&(i=0),a===void 0&&(a=null),f===void 0&&(f=0),m===void 0&&(m=et.U8_RGB),_===void 0&&(_=!1),A===void 0&&(A=0),C===void 0&&(C=0),R===void 0&&(R=0);var X=r,ee=f||X.size,xe=a||X.view,ke=xe&&xe.constructor&&xe.constructor.BYTES_PER_ELEMENT||hx(m),Ne=X;if(!(X.usage&Lo.MAP_READ&&X.usage&Lo.COPY_DST)){var it=this.device.device.createCommandEncoder();Ne=this.device.createBuffer({usage:Lo.STORAGE|Lo.MAP_READ|Lo.COPY_DST,hint:$c.STATIC,viewOrSize:ee}),it.copyBufferToBuffer(X.gpuBuffer,i,Ne.gpuBuffer,0,ee),this.device.device.queue.submit([it.finish()])}return new Promise(function(gt,rr){Ne.gpuBuffer.mapAsync(H_.READ,i,ee).then(function(){var Kt=Ne.gpuBuffer.getMappedRange(i,ee),Rt=xe;if(_)Rt===null?Rt=zx(m,ee,!0,Kt):Rt=zx(m,Rt.buffer,void 0,Kt);else if(Rt===null)switch(ke){case 1:Rt=new Uint8Array(ee),Rt.set(new Uint8Array(Kt));break;case 2:Rt=U.getHalfFloatAsFloatRGBAArrayBuffer(ee/2,Kt);break;case 4:Rt=new Float32Array(ee/4),Rt.set(new Float32Array(Kt));break}else switch(ke){case 1:Rt=new Uint8Array(Rt.buffer),Rt.set(new Uint8Array(Kt));break;case 2:Rt=U.getHalfFloatAsFloatRGBAArrayBuffer(ee/2,Kt,xe);break;case 4:var tr=xe&&xe.constructor||Float32Array;Rt=new tr(Rt.buffer),Rt.set(new tr(Kt));break}if(A!==C){ke===1&&!_&&(A*=2,C*=2);for(var Tn=new Uint8Array(Rt.buffer),fi=A,An=0,ui=1;ui<R;++ui){An=ui*C;for(var Xi=0;Xi<A;++Xi)Tn[fi++]=Tn[An++]}ke!==0&&!_?Rt=new Float32Array(Tn.buffer,0,fi/4):Rt=new Uint8Array(Tn.buffer,0,fi)}Ne.gpuBuffer.unmap(),gt(Rt)},function(Kt){return rr(Kt)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(r,i,a){a||(a=new Float32Array(r));for(var u=new Uint16Array(i);r--;)a[r]=zI(u[r]);return a},t}(Jc),Hx=function(){function e(t){this.device=t,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var t;return((t=this.renderBundle)===null||t===void 0?void 0:t.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(t,r){return vi(r<t.mipLevelCount),t.mipLevelCount===1?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:r,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(t){var r,i,a,u,f,m;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var _=t.colorAttachment.length;this.gfxColorAttachment.length=_,this.gfxColorResolveTo.length=_;for(var b=0;b<t.colorAttachment.length;b++){var A=t.colorAttachment[b],C=t.colorResolveTo[b];if(A===null&&C!==null&&(A=C,C=null),this.gfxColorAttachment[b]=A,this.gfxColorResolveTo[b]=C,this.gfxColorAttachmentLevel[b]=((r=t.colorAttachmentLevel)===null||r===void 0?void 0:r[b])||0,this.gfxColorResolveToLevel[b]=((i=t.colorResolveToLevel)===null||i===void 0?void 0:i[b])||0,A!==null){this.gpuColorAttachments[b]===void 0&&(this.gpuColorAttachments[b]={});var R=this.gpuColorAttachments[b];R.view=this.getTextureView(A,((a=this.gfxColorAttachmentLevel)===null||a===void 0?void 0:a[b])||0);var U=(f=(u=t.colorClearColor)===null||u===void 0?void 0:u[b])!==null&&f!==void 0?f:"load";U==="load"?R.loadOp="load":(R.loadOp="clear",R.clearValue=U),R.storeOp=!((m=t.colorStore)===null||m===void 0)&&m[b]?"store":"discard",R.resolveTarget=void 0,C!==null&&(A.sampleCount>1?R.resolveTarget=this.getTextureView(C,this.gfxColorResolveToLevel[b]):R.storeOp="store")}else{this.gpuColorAttachments.length=b,this.gfxColorAttachment.length=b,this.gfxColorResolveTo.length=b;break}}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var X=t.depthStencilAttachment,R=this.gpuDepthStencilAttachment;R.view=X.gpuTextureView;var ee=!!(Nd(X.format)&an.Depth);ee?(t.depthClearValue==="load"?R.depthLoadOp="load":(R.depthLoadOp="clear",R.depthClearValue=t.depthClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?R.depthStoreOp="store":R.depthStoreOp="discard"):(R.depthLoadOp=void 0,R.depthStoreOp=void 0);var xe=!!(Nd(X.format)&an.Stencil);xe?(t.stencilClearValue==="load"?R.stencilLoadOp="load":(R.stencilLoadOp="clear",R.stencilClearValue=t.stencilClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?R.stencilStoreOp="store":R.stencilStoreOp="discard"):(R.stencilLoadOp=void 0,R.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,vc.Z)(t.occlusionQueryPool)?void 0:AI(t.occlusionQueryPool)},e.prototype.beginRenderPass=function(t,r){vi(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.frameCommandEncoder=t,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(t,r){var i=this.device.swapChainHeight;return i-t-r},e.prototype.setViewport=function(t,r,i,a,u,f){u===void 0&&(u=0),f===void 0&&(f=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(r,a),i,a,u,f)},e.prototype.setScissorRect=function(t,r,i,a){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(r,a),i,a)},e.prototype.setPipeline=function(t){var r=t,i=jp(r.gpuRenderPipeline);this.getEncoder().setPipeline(i)},e.prototype.setVertexInput=function(t,r,i){if(t!==null){var a=this.getEncoder(),u=t;i!==null&&a.setIndexBuffer(Hd(i.buffer),jp(u.indexFormat),i.offset);for(var f=0;f<r.length;f++){var m=r[f];m!==null&&a.setVertexBuffer(f,Hd(m.buffer),m.offset)}}},e.prototype.setBindings=function(t){var r=t,i=this.getEncoder();r.gpuBindGroup.forEach(function(a,u){a&&i.setBindGroup(u,r.gpuBindGroup[u])})},e.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},e.prototype.draw=function(t,r,i,a){this.getEncoder().draw(t,r,i,a)},e.prototype.drawIndexed=function(t,r,i,a,u){this.getEncoder().drawIndexed(t,r,i,a,u)},e.prototype.drawIndirect=function(t,r){this.getEncoder().drawIndirect(Hd(t),r)},e.prototype.drawIndexedIndirect=function(t,r){this.getEncoder().drawIndexedIndirect(Hd(t),r)},e.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},e.prototype.beginBundle=function(t){this.renderBundle=t},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(t){this.gpuRenderPassEncoder.executeBundles(t.map(function(r){return r.renderBundle}))},e.prototype.finish=function(){var t;(t=this.gpuRenderPassEncoder)===null||t===void 0||t.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var i=this.gfxColorAttachment[r],a=this.gfxColorResolveTo[r];i!==null&&a!==null&&i.sampleCount===1&&this.copyAttachment(a,this.gfxColorAttachmentLevel[r],i,this.gfxColorResolveToLevel[r])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(t,r,i,a){vi(i.sampleCount===1);var u={texture:i.gpuTexture,mipLevel:a},f={texture:t.gpuTexture,mipLevel:r};vi(i.width>>>a===t.width>>>r),vi(i.height>>>a===t.height>>>r),vi(!!(i.usage&Ds.COPY_SRC)),vi(!!(t.usage&Ds.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(u,f,[t.width,t.height,1])},e}(),GI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=e.call(this,{id:i,device:a})||this;return f.type=Qi.RenderPipeline,f.isCreatingAsync=!1,f.gpuRenderPipeline=null,f.descriptor=u,f.device.createRenderPipelineInternal(f,!1),f}return t.prototype.getBindGroupLayout=function(r){return this.gpuRenderPipeline.getBindGroupLayout(r)},t}(Jc),YI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f,m,_=e.call(this,{id:i,device:a})||this;_.type=Qi.Sampler;var b=u.lodMinClamp,A=u.mipmapFilter===Ls.NO_MIP?u.lodMinClamp:u.lodMaxClamp,C=(f=u.maxAnisotropy)!==null&&f!==void 0?f:1;return C>1&&vi(u.minFilter===Xa.BILINEAR&&u.magFilter===Xa.BILINEAR&&u.mipmapFilter===Ls.LINEAR),_.gpuSampler=_.device.device.createSampler({addressModeU:W_(u.addressModeU),addressModeV:W_(u.addressModeV),addressModeW:W_((m=u.addressModeW)!==null&&m!==void 0?m:u.addressModeU),lodMinClamp:b,lodMaxClamp:A,minFilter:Fx(u.minFilter),magFilter:Fx(u.magFilter),mipmapFilter:EI(u.mipmapFilter),compare:u.compareFunction!==void 0?Lg(u.compareFunction):void 0,maxAnisotropy:C}),_}return t}(Jc),Dg=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=r.descriptor,f=r.skipCreate,m=r.sampleCount,_=e.call(this,{id:i,device:a})||this;_.type=Qi.Texture,_.flipY=!1;var b=u.format,A=u.dimension,C=u.width,R=u.height,U=u.depthOrArrayLayers,X=u.mipLevelCount,ee=u.usage,xe=u.pixelStore;return _.flipY=!!(xe!=null&&xe.unpackFlipY),_.device.createTextureShared({format:b,dimension:A!=null?A:Pi.TEXTURE_2D,width:C,height:R,depthOrArrayLayers:U!=null?U:1,mipLevelCount:X!=null?X:1,usage:ee,sampleCount:m!=null?m:1},_,f),_}return t.prototype.textureFromImageBitmapOrCanvas=function(r,i,a){for(var u=i[0].width,f=i[0].height,m={size:{width:u,height:f,depthOrArrayLayers:a},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},_=r.createTexture(m),b=0;b<i.length;b++)r.queue.copyExternalImageToTexture({source:i[b],flipY:this.flipY},{texture:_,origin:[0,0,b]},[u,f]);return[_,u,f]},t.prototype.isImageBitmapOrCanvases=function(r){var i=r[0];return i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof OffscreenCanvas},t.prototype.isVideo=function(r){var i=r[0];return i instanceof HTMLVideoElement},t.prototype.setImageData=function(r,i){var a,u=this,f=this.device.device,m,_,b;if(this.isImageBitmapOrCanvases(r))a=(0,fn.CR)(this.textureFromImageBitmapOrCanvas(f,r,this.depthOrArrayLayers),3),m=a[0],_=a[1],b=a[2];else if(this.isVideo(r))m=f.importExternalTexture({source:r[0]});else{var A=Vx(this.gpuTextureformat),C=Math.ceil(this.width/A.width)*A.length;r.forEach(function(R){f.queue.writeTexture({texture:u.gpuTexture},R,{bytesPerRow:C},{width:u.width,height:u.height})})}this.width=_,this.height=b,m&&(this.gpuTexture=m),this.gpuTextureView=this.gpuTexture.createView({dimension:xI(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(Jc),qI=function(e){(0,fn.ZT)(t,e);function t(r){var i=r.id,a=r.device,u=e.call(this,{id:i,device:a})||this;return u.type=Qi.RenderBundle,u.renderBundleEncoder=u.device.device.createRenderBundleEncoder({colorFormats:[u.device.swapChainFormat]}),u}return t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(Jc),KI=function(){function e(t,r,i,a,u,f){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Ds.RENDER_ATTACHMENT|Ds.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Qc.UPPER_LEFT,this.clipSpaceNearZ=Fd.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=r,this.canvas=i,this.canvasContext=a,this.glsl_compile=u,this.WGSLComposer=f,this.fallbackTexture2D=this.createFallbackTexture(Pi.TEXTURE_2D,La.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Pi.TEXTURE_2D,La.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Pi.TEXTURE_2D_ARRAY,La.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Pi.TEXTURE_3D,La.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Pi.TEXTURE_CUBE_MAP,La.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:$u.REPEAT,addressModeV:$u.REPEAT,minFilter:Xa.POINT,magFilter:Xa.POINT,mipmapFilter:Ls.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:$u.REPEAT,addressModeV:$u.REPEAT,minFilter:Xa.POINT,magFilter:Xa.POINT,mipmapFilter:Ls.NEAREST,compareFunction:Ti.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(m){console.error(m.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(t,r){this.swapChainWidth===t&&this.swapChainHeight===r||(this.swapChainWidth=t,this.swapChainHeight=r)},e.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),r=t.createView(),i=new Dg({id:0,device:this,descriptor:{format:et.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Pi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return i.depthOrArrayLayers=1,i.sampleCount=1,i.gpuTexture=t,i.gpuTextureView=r,i.name="Onscreen",this.setResourceName(i,"Onscreen Texture"),i},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){vi(this.frameCommandEncoderPool.length===0)},e.prototype.endFrame=function(){vi(this.frameCommandEncoderPool.every(function(t){return t!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(t){return t.finish()})),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(t){return new ZI({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new Dg({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new YI({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){var r=new Dg({id:this.getNextUniqueId(),device:this,descriptor:(0,fn.pi)((0,fn.pi)({},t),{dimension:Pi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:gu.RENDER_TARGET}),sampleCount:t.sampleCount});return r.depthOrArrayLayers=1,r.type=Qi.RenderTarget,r},e.prototype.createRenderTargetFromTexture=function(t){var r=t,i=r.format,a=r.width,u=r.height,f=r.depthOrArrayLayers,m=r.sampleCount,_=r.mipLevelCount,b=r.gpuTexture,A=r.gpuTextureView,C=r.usage;vi(!!(C&Ds.RENDER_ATTACHMENT));var R=new Dg({id:this.getNextUniqueId(),device:this,descriptor:{format:i,width:a,height:u,depthOrArrayLayers:f,dimension:Pi.TEXTURE_2D,mipLevelCount:_,usage:C},skipCreate:!0});return R.depthOrArrayLayers=f,R.sampleCount=m,R.gpuTexture=b,R.gpuTextureView=A,R},e.prototype.createProgram=function(t){var r,i;return!((r=t.vertex)===null||r===void 0)&&r.glsl&&(t.vertex.glsl=Jf(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((i=t.fragment)===null||i===void 0)&&i.glsl&&(t.fragment.glsl=Jf(this.queryVendorInfo(),"frag",t.fragment.glsl)),new jx({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createProgramSimple=function(t){return new jx({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTextureShared=function(t,r,i){var a={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},u=t.mipLevelCount,f=X_(t.format),m=yI(t.dimension),_=_I(t.usage);if(r.gpuTextureformat=f,r.dimension=t.dimension,r.format=t.format,r.width=t.width,r.height=t.height,r.depthOrArrayLayers=t.depthOrArrayLayers,r.mipLevelCount=u,r.usage=_,r.sampleCount=t.sampleCount,!i){var b=this.device.createTexture({size:a,mipLevelCount:u,format:f,dimension:m,sampleCount:t.sampleCount,usage:_}),A=b.createView();r.gpuTexture=b,r.gpuTextureView=A}},e.prototype.getFallbackSampler=function(t){var r=t.formatKind;return r===La.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(t){var r=t.dimension,i=t.formatKind;if(r===Pi.TEXTURE_2D)return i===La.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===Pi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===Pi.TEXTURE_3D)return this.fallbackTexture3D;if(r===Pi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(t,r){var i=t===Pi.TEXTURE_CUBE_MAP?6:1,a=r===La.Float?et.U8_RGBA_NORM:et.D24;return this.createTexture({dimension:t,format:a,usage:gu.SAMPLED,width:1,height:1,depthOrArrayLayers:i,mipLevelCount:1})},e.prototype.createBindings=function(t){return new VI({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new HI({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePipeline=function(t){return new jI({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new GI({id:this.getNextUniqueId(),device:this,descriptor:(0,fn.pi)({},t)})},e.prototype.createQueryPool=function(t,r){return new XI({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.createRenderPipelineInternal=function(t,r){var i;if(t.gpuRenderPipeline===null){var a=t.descriptor,u=a.program,f=u.vertexStage,m=u.fragmentStage;if(!(f===null||m===null)){var _=a.megaStateDescriptor||{},b=_.stencilBack,A=_.stencilFront,C=(0,fn._T)(_,["stencilBack","stencilFront"]),R=kd(Hp);a.megaStateDescriptor=(0,fn.pi)((0,fn.pi)((0,fn.pi)({},R),{stencilBack:(0,fn.pi)((0,fn.pi)({},R.stencilBack),b),stencilFront:(0,fn.pi)((0,fn.pi)({},R.stencilFront),A)}),C);var U=a.megaStateDescriptor.attachmentsState[0];a.colorAttachmentFormats.forEach(function(gt,rr){a.megaStateDescriptor.attachmentsState[rr]||(a.megaStateDescriptor.attachmentsState[rr]=gx(void 0,U))});var X=II((i=a.topology)!==null&&i!==void 0?i:ss.TRIANGLES,a.megaStateDescriptor),ee=LI(a.colorAttachmentFormats,a.megaStateDescriptor),xe=DI(a.depthStencilAttachmentFormat,a.megaStateDescriptor),ke=void 0;a.inputLayout!==null&&(ke=a.inputLayout.buffers);var Ne=a.sampleCount,it={layout:"auto",vertex:(0,fn.pi)((0,fn.pi)({},f),{buffers:ke}),primitive:X,depthStencil:xe,multisample:{count:Ne},fragment:(0,fn.pi)((0,fn.pi)({},m),{targets:ee})};t.gpuRenderPipeline=this.device.createRenderPipeline(it)}}},e.prototype.createReadback=function(){return new WI({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new qI({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(t){var r=this.renderPassPool.pop();r===void 0&&(r=new Hx(this));var i=this.frameCommandEncoderPool.pop();return i===void 0&&(i=this.device.createCommandEncoder()),r.beginRenderPass(i,t),r},e.prototype.createComputePass=function(){var t=this.computePassPool.pop();t===void 0&&(t=new Zx);var r=this.frameCommandEncoderPool.pop();return r===void 0&&(r=this.device.createCommandEncoder()),t.beginComputePass(r),t},e.prototype.submitPass=function(t){var r=t;r instanceof Hx?(this.frameCommandEncoderPool.push(r.frameCommandEncoder),r.finish(),this.renderPassPool.push(r)):r instanceof Zx&&(this.frameCommandEncoderPool.push(r.frameCommandEncoder),r.finish(),this.computePassPool.push(r))},e.prototype.copySubTexture2D=function(t,r,i,a,u,f,m){var _=this.device.createCommandEncoder(),b=t,A=a,C={texture:A.gpuTexture,origin:[u,f,0],mipLevel:0,aspect:"all"},R={texture:b.gpuTexture,origin:[r,i,0],mipLevel:0,aspect:"all"};vi(!!(A.usage&Ds.COPY_SRC)),vi(!!(b.usage&Ds.COPY_DST)),_.copyTextureToTexture(C,R,[A.width,A.height,m||1]),this.device.queue.submit([_.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(t,r,i){if(UI(t)){if(!this.featureTextureCompressionBC)return!1;var a=kI(t);return r%a!==0||i%a!==0?!1:this.featureTextureCompressionBC}switch(t){case et.U16_RGBA_NORM:return!1;case et.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){var r=t;return r.descriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===Qi.Buffer){var i=t;i.gpuBuffer.label=r}else if(t.type===Qi.Texture){var i=t;i.gpuTexture.label=r,i.gpuTextureView.label=r}else if(t.type===Qi.RenderTarget){var i=t;i.gpuTexture.label=r,i.gpuTextureView.label=r}else if(t.type===Qi.Sampler){var i=t;i.gpuSampler.label=r}else if(t.type===Qi.RenderPipeline){var i=t;i.gpuRenderPipeline!==null&&(i.gpuRenderPipeline.label=r)}},e.prototype.setResourceLeakCheck=function(t,r){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(t){},e.prototype.pipelineQueryReady=function(t){var r=t;return r.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(t){var r=t;this.createRenderPipelineInternal(r,!1)},e}(),$I=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return(0,fn.mG)(this,void 0,void 0,function(){var r,i,a,u,f,m,_,b;return(0,fn.Jh)(this,function(A){switch(A.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];r=null,A.label=1;case 1:return A.trys.push([1,3,,4]),i=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:i})];case 2:return r=A.sent(),[3,4];case 3:return a=A.sent(),console.log(a),[3,4];case 4:return r===null?[2,null]:(u=["depth32float-stencil8","texture-compression-bc","float32-filterable"],f=u.filter(function(C){return r.features.has(C)}),[4,r.requestDevice({requiredFeatures:f})]);case 5:if(m=A.sent(),m&&(_=this.pluginOptions.onContextLost,m.lost.then(function(){_&&_()})),m===null)return[2,null];if(b=t.getContext("webgpu"),!b)return[2,null];A.label=6;case 6:return A.trys.push([6,8,,9]),[4,Bx(this.pluginOptions.shaderCompilerPath)];case 7:return A.sent(),[3,9];case 8:return A.sent(),[3,9];case 9:return[2,new KI(r,m,t,b,dI,ev&&new ev)]}})})},e}(),QI=Object.defineProperty,JI=Object.defineProperties,eM=Object.getOwnPropertyDescriptors,Xx=Object.getOwnPropertySymbols,tM=Object.prototype.hasOwnProperty,rM=Object.prototype.propertyIsEnumerable,Wx=(e,t,r)=>t in e?QI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tv=(e,t)=>{for(var r in t||(t={}))tM.call(t,r)&&Wx(e,r,t[r]);if(Xx)for(var r of Xx(t))rM.call(t,r)&&Wx(e,r,t[r]);return e},nM=(e,t)=>JI(e,eM(t)),{isPlainObject:iM,isTypedArray:oM}=Kn,aM=class{constructor(e,t){this.destroyed=!1,this.uniforms={},this.reGl=e;const{vs:r,fs:i,attributes:a,uniforms:u,primitive:f,count:m,elements:_,depth:b,cull:A,instances:C}=t,R={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:Qc.LOWER_LEFT,clipSpaceNearZ:Fd.NEGATIVE_ONE,supportMRT:!1},U={};this.options=t,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(Ne=>{U[Ne]=e.prop(Ne)}));const X={};Object.keys(a).forEach(Ne=>{X[Ne]=a[Ne].get()});const ee=ha(Jf(R,"frag",i,null,!1)),xe=ha(Jf(R,"vert",r,null,!1)),ke={attributes:X,frag:ee,uniforms:U,vert:xe,colorMask:e.prop("colorMask"),lineWidth:1,blend:{enable:e.prop("blend.enable"),func:e.prop("blend.func"),equation:e.prop("blend.equation"),color:e.prop("blend.color")},stencil:{enable:e.prop("stencil.enable"),mask:e.prop("stencil.mask"),func:e.prop("stencil.func"),opFront:e.prop("stencil.opFront"),opBack:e.prop("stencil.opBack")},primitive:XC[f===void 0?O.TRIANGLES:f]};C&&(ke.instances=C),m?ke.count=m:_&&(ke.elements=_.get()),this.initDepthDrawParams({depth:b},ke),this.initCullDrawParams({cull:A},ke),this.drawCommand=e(ke),this.drawParams=ke}updateAttributesAndElements(e,t){const r={};Object.keys(e).forEach(i=>{r[i]=e[i].get()}),this.drawParams.attributes=r,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(e){const t={};Object.keys(e).forEach(r=>{t[r]=e[r].get()}),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}addUniforms(e){this.uniforms=tv(tv({},this.uniforms),this.extractUniforms(e))}draw(e,t){if(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)return;const r=tv(tv({},this.uniforms),this.extractUniforms(e.uniforms||{})),i={};Object.keys(r).forEach(a=>{const u=typeof r[a];u==="boolean"||u==="number"||Array.isArray(r[a])||r[a].BYTES_PER_ELEMENT?i[a]=r[a]:i[a]=r[a].get()}),i.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),i.stencil=this.getStencilDrawParams(e),i.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(i)}destroy(){var e,t;(t=(e=this.drawParams)==null?void 0:e.elements)==null||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(r=>{r==null||r.destroy()}),this.destroyed=!0}initDepthDrawParams({depth:e},t){e&&(t.depth={enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:qC[e.func||O.LESS],range:e.range||[0,1]})}getBlendDrawParams({blend:e}){const{enable:t,func:r,equation:i,color:a=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:gg[r&&r.srcRGB||O.SRC_ALPHA],srcAlpha:gg[r&&r.srcAlpha||O.SRC_ALPHA],dstRGB:gg[r&&r.dstRGB||O.ONE_MINUS_SRC_ALPHA],dstAlpha:gg[r&&r.dstAlpha||O.ONE_MINUS_SRC_ALPHA]},equation:{rgb:sx[i&&i.rgb||O.FUNC_ADD],alpha:sx[i&&i.alpha||O.FUNC_ADD]},color:a}}getStencilDrawParams({stencil:e}){const{enable:t,mask:r=-1,func:i={cmp:O.ALWAYS,ref:0,mask:-1},opFront:a={fail:O.KEEP,zfail:O.KEEP,zpass:O.KEEP},opBack:u={fail:O.KEEP,zfail:O.KEEP,zpass:O.KEEP}}=e||{};return{enable:!!t,mask:r,func:nM(tv({},i),{cmp:KC[i.cmp]}),opFront:{fail:Dd[a.fail],zfail:Dd[a.zfail],zpass:Dd[a.zpass]},opBack:{fail:Dd[u.fail],zfail:Dd[u.zfail],zpass:Dd[u.zpass]}}}getColorMaskDrawParams({stencil:e},t){return e!=null&&e.enable&&e.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:e},t){if(e){const{enable:r,face:i=O.BACK}=e;t.cull={enable:!!r,face:$C[i]}}}extractUniforms(e){const t={};return Object.keys(e).forEach(r=>{this.extractUniformsRecursively(r,e[r],t,"")}),t}extractUniformsRecursively(e,t,r,i){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||oM(t)||t===""||"resize"in t){r[`${i&&i+"."}${e}`]=t;return}iM(t)&&Object.keys(t).forEach(a=>{this.extractUniformsRecursively(a,t[a],r,`${i&&i+"."}${e}`)}),Array.isArray(t)&&t.forEach((a,u)=>{Object.keys(a).forEach(f=>{this.extractUniformsRecursively(f,a[f],r,`${i&&i+"."}${e}[${u}]`)})})}},sM=class{constructor(e,t){this.isDestroy=!1;const{data:r,type:i=O.UNSIGNED_BYTE,width:a,height:u,flipY:f=!1,format:m=O.RGBA,mipmap:_=!1,wrapS:b=O.CLAMP_TO_EDGE,wrapT:A=O.CLAMP_TO_EDGE,aniso:C=0,alignment:R=1,premultiplyAlpha:U=!1,mag:X=O.NEAREST,min:ee=O.NEAREST,colorSpace:xe=O.BROWSER_DEFAULT_WEBGL,x:ke=0,y:Ne=0,copy:it=!1}=t;this.width=a,this.height=u;const gt={width:a,height:u,type:U_[i],format:WC[m],wrapS:ax[b],wrapT:ax[A],mag:ox[X],min:ox[ee],alignment:R,flipY:f,colorSpace:YC[xe],premultiplyAlpha:U,aniso:C,x:ke,y:Ne,copy:it};r&&(gt.data=r),typeof _=="number"?gt.mipmap=GC[_]:typeof _=="boolean"&&(gt.mipmap=_),this.texture=e.texture(gt)}get(){return this.texture}update(e={}){this.texture(e)}bind(){this.texture._texture.bind()}resize({width:e,height:t}){this.texture.resize(e,t),this.width=e,this.height=t}getSize(){return[this.width,this.height]}destroy(){var e;this.isDestroy||(e=this.texture)==null||e.destroy(),this.isDestroy=!0}},G_=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),uM=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>"WebGL1",this.createModel=e=>new aM(this.gl,e),this.createAttribute=e=>new HC(this.gl,e),this.createBuffer=e=>new QC(this.gl,e),this.createElements=e=>new JC(this.gl,e),this.createTexture2D=e=>new sM(this.gl,e),this.createFramebuffer=e=>new eR(this.gl,e),this.useFramebuffer=(e,t)=>{this.gl({framebuffer:e?e.get():null})(t)},this.useFramebufferAsync=(e,t)=>G_(this,null,function*(){this.gl({framebuffer:e?e.get():null})(t)}),this.clear=e=>{var t;const{color:r,depth:i,stencil:a,framebuffer:u=null}=e,f={color:r,depth:i,stencil:a};f.framebuffer=u===null?u:u.get(),(t=this.gl)==null||t.clear(f)},this.viewport=({x:e,y:t,width:r,height:i})=>{this.gl._gl.viewport(e,t,r,i),this.width=r,this.height=i,this.gl._refresh()},this.readPixels=e=>{const{framebuffer:t,x:r,y:i,width:a,height:u}=e,f={x:r,y:i,width:a,height:u};return t&&(f.framebuffer=t.get()),this.gl.read(f)},this.readPixelsAsync=e=>G_(this,null,function*(){return this.readPixels(e)}),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>{var e;return(e=this.canvas)==null?void 0:e.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var e,t,r;this.canvas=null,(r=(t=(e=this.gl)==null?void 0:e._gl)==null?void 0:t.getExtension("WEBGL_lose_context"))==null||r.loseContext(),this.gl.destroy(),this.gl=null}}init(e,t,r){return G_(this,null,function*(){this.canvas=e,r?this.gl=r:this.gl=yield new Promise((i,a)=>{jC()({canvas:this.canvas,attributes:{alpha:!0,antialias:t.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,stencil:t.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:(u,f)=>{(u||!f)&&a(u),i(f)}})}),this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")}})}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){const e=this.getGLContext();e.disable(e.CULL_FACE)}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}},lM=class{constructor(e,t){const{buffer:r,offset:i,stride:a,normalized:u,size:f,divisor:m,shaderLocation:_}=t;this.buffer=r,this.attribute={shaderLocation:_,buffer:r.get(),offset:i||0,stride:a||0,normalized:u||!1,divisor:m||0},f&&(this.attribute.size=f)}get(){return this.buffer}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}},Bg={[O.FLOAT]:Float32Array,[O.UNSIGNED_BYTE]:Uint8Array,[O.SHORT]:Int16Array,[O.UNSIGNED_SHORT]:Uint16Array,[O.INT]:Int32Array,[O.UNSIGNED_INT]:Uint32Array},cM={[O.POINTS]:ss.POINTS,[O.LINES]:ss.LINES,[O.LINE_LOOP]:ss.LINES,[O.LINE_STRIP]:ss.LINE_STRIP,[O.TRIANGLES]:ss.TRIANGLES,[O.TRIANGLE_FAN]:ss.TRIANGLES,[O.TRIANGLE_STRIP]:ss.TRIANGLE_STRIP},hM={1:et.F32_R,2:et.F32_RG,3:et.F32_RGB,4:et.F32_RGBA},fM={[O.STATIC_DRAW]:$c.STATIC,[O.DYNAMIC_DRAW]:$c.DYNAMIC,[O.STREAM_DRAW]:$c.DYNAMIC},Gx={[O.REPEAT]:$u.REPEAT,[O.CLAMP_TO_EDGE]:$u.CLAMP_TO_EDGE,[O.MIRRORED_REPEAT]:$u.MIRRORED_REPEAT},pM={[O.NEVER]:Ti.NEVER,[O.ALWAYS]:Ti.ALWAYS,[O.LESS]:Ti.LESS,[O.LEQUAL]:Ti.LEQUAL,[O.GREATER]:Ti.GREATER,[O.GEQUAL]:Ti.GEQUAL,[O.EQUAL]:Ti.EQUAL,[O.NOTEQUAL]:Ti.NOTEQUAL},dM={[O.FRONT]:yl.FRONT,[O.BACK]:yl.BACK},Yx={[O.FUNC_ADD]:Hs.ADD,[O.MIN_EXT]:Hs.MIN,[O.MAX_EXT]:Hs.MAX,[O.FUNC_SUBTRACT]:Hs.SUBSTRACT,[O.FUNC_REVERSE_SUBTRACT]:Hs.REVERSE_SUBSTRACT},Fg={[O.ZERO]:Di.ZERO,[O.ONE]:Di.ONE,[O.SRC_COLOR]:Di.SRC,[O.ONE_MINUS_SRC_COLOR]:Di.ONE_MINUS_SRC,[O.SRC_ALPHA]:Di.SRC_ALPHA,[O.ONE_MINUS_SRC_ALPHA]:Di.ONE_MINUS_SRC_ALPHA,[O.DST_COLOR]:Di.DST,[O.ONE_MINUS_DST_COLOR]:Di.ONE_MINUS_DST,[O.DST_ALPHA]:Di.DST_ALPHA,[O.ONE_MINUS_DST_ALPHA]:Di.ONE_MINUS_DST_ALPHA,[O.CONSTANT_COLOR]:Di.CONST,[O.ONE_MINUS_CONSTANT_COLOR]:Di.ONE_MINUS_CONSTANT,[O.CONSTANT_ALPHA]:Di.CONST,[O.ONE_MINUS_CONSTANT_ALPHA]:Di.ONE_MINUS_CONSTANT,[O.SRC_ALPHA_SATURATE]:Di.SRC_ALPHA_SATURATE},Wd={[O.REPLACE]:Pa.REPLACE,[O.KEEP]:Pa.KEEP,[O.ZERO]:Pa.ZERO,[O.INVERT]:Pa.INVERT,[O.INCR]:Pa.INCREMENT_CLAMP,[O.DECR]:Pa.DECREMENT_CLAMP,[O.INCR_WRAP]:Pa.INCREMENT_WRAP,[O.DECR_WRAP]:Pa.DECREMENT_WRAP},mM={[O.ALWAYS]:Ti.ALWAYS,[O.EQUAL]:Ti.EQUAL,[O.GEQUAL]:Ti.GEQUAL,[O.GREATER]:Ti.GREATER,[O.LEQUAL]:Ti.LEQUAL,[O.LESS]:Ti.LESS,[O.NEVER]:Ti.NEVER,[O.NOTEQUAL]:Ti.NOTEQUAL},vM={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Ng(e){return Object.prototype.toString.call(e)in vM}function gM(e,t){const r=e.length,i=Math.ceil(r/3),a=r+i,u=new Float32Array(a);for(let f=0;f<a;f+=4)u[f]=e[f/4*3],u[f+1]=e[f/4*3+1],u[f+2]=e[f/4*3+2],u[f+3]=t;return u}var _M=class{constructor(e,t){this.isDestroyed=!1;const{data:r,usage:i,type:a,isUBO:u,label:f}=t;let m;Ng(r)?m=r:m=new Bg[this.type||O.FLOAT](r),this.type=a,this.size=m.byteLength,this.buffer=e.createBuffer({viewOrSize:m,usage:u?Lo.UNIFORM:Lo.VERTEX,hint:fM[i||O.STATIC_DRAW]}),f&&e.setResourceName(this.buffer,f)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){let r;Ng(e)?r=e:r=new Bg[this.type||O.FLOAT](e),this.buffer.setSubData(t,new Uint8Array(r.buffer))}};function go(e,t=0){return e+=t,e+=e<<10,e+=e>>>6,e>>>0}function qx(e){return e+=e<<3,e^=e>>>11,e+=e<<15,e>>>0}function Kx(){return 0}var yM=class{constructor(){this.keys=[],this.values=[]}},Ug=class{constructor(e,t){this.keyEqualFunc=e,this.keyHashFunc=t,this.buckets=new Map}findBucketIndex(e,t){for(let r=0;r<e.keys.length;r++)if(this.keyEqualFunc(t,e.keys[r]))return r;return-1}findBucket(e){const t=this.keyHashFunc(e);return this.buckets.get(t)}get(e){const t=this.findBucket(e);if(t===void 0)return null;const r=this.findBucketIndex(t,e);return r<0?null:t.values[r]}add(e,t){const r=this.keyHashFunc(e);this.buckets.get(r)===void 0&&this.buckets.set(r,new yM);const i=this.buckets.get(r);i.keys.push(e),i.values.push(t)}delete(e){const t=this.findBucket(e);if(t===void 0)return;const r=this.findBucketIndex(t,e);r!==-1&&(t.keys.splice(r,1),t.values.splice(r,1))}clear(){this.buckets.clear()}size(){let e=0;for(const t of this.buckets.values())e+=t.values.length;return e}*values(){for(const e of this.buckets.values())for(let t=e.values.length-1;t>=0;t--)yield e.values[t]}};function $x(e,t){return e=go(e,t.blendMode),e=go(e,t.blendSrcFactor),e=go(e,t.blendDstFactor),e}function xM(e,t){return e=$x(e,t.rgbBlendState),e=$x(e,t.alphaBlendState),e=go(e,t.channelWriteMask),e}function bM(e,t){return e=go(e,t.r<<24|t.g<<16|t.b<<8|t.a),e}function EM(e,t){var r,i,a,u,f,m,_,b;for(let A=0;A<t.attachmentsState.length;A++)e=xM(e,t.attachmentsState[A]);return e=bM(e,t.blendConstant||xg),e=go(e,t.depthCompare),e=go(e,t.depthWrite?1:0),e=go(e,(r=t.stencilFront)==null?void 0:r.compare),e=go(e,(i=t.stencilFront)==null?void 0:i.passOp),e=go(e,(a=t.stencilFront)==null?void 0:a.failOp),e=go(e,(u=t.stencilFront)==null?void 0:u.depthFailOp),e=go(e,(f=t.stencilBack)==null?void 0:f.compare),e=go(e,(m=t.stencilBack)==null?void 0:m.passOp),e=go(e,(_=t.stencilBack)==null?void 0:_.failOp),e=go(e,(b=t.stencilBack)==null?void 0:b.depthFailOp),e=go(e,t.stencilWrite?1:0),e=go(e,t.cullMode),e=go(e,t.frontFace?1:0),e=go(e,t.polygonOffset?1:0),e}function TM(e){let t=0;t=go(t,e.program.id),e.inputLayout!==null&&(t=go(t,e.inputLayout.id)),t=EM(t,e.megaStateDescriptor);for(let r=0;r<e.colorAttachmentFormats.length;r++)t=go(t,e.colorAttachmentFormats[r]||0);return t=go(t,e.depthStencilAttachmentFormat||0),qx(t)}function AM(e){let t=0;if(e.samplerBindings)for(let r=0;r<e.samplerBindings.length;r++){const i=e.samplerBindings[r];i!==null&&i.texture!==null&&(t=go(t,i.texture.id))}if(e.uniformBufferBindings)for(let r=0;r<e.uniformBufferBindings.length;r++){const i=e.uniformBufferBindings[r];i!==null&&i.buffer!==null&&(t=go(t,i.buffer.id),t=go(t,i.binding),t=go(t,i.offset),t=go(t,i.size))}if(e.storageBufferBindings)for(let r=0;r<e.storageBufferBindings.length;r++){const i=e.storageBufferBindings[r];i!==null&&i.buffer!==null&&(t=go(t,i.buffer.id),t=go(t,i.binding),t=go(t,i.offset),t=go(t,i.size))}if(e.storageTextureBindings)for(let r=0;r<e.storageTextureBindings.length;r++){const i=e.storageTextureBindings[r];i!==null&&i.texture!==null&&(t=go(t,i.texture.id),t=go(t,i.binding))}return qx(t)}function SM(e,t){var r,i,a,u;return((r=e.vertex)==null?void 0:r.glsl)===((i=t.vertex)==null?void 0:i.glsl)&&((a=e.fragment)==null?void 0:a.glsl)===((u=t.fragment)==null?void 0:u.glsl)}function wM(e){var t,r;return{vertex:{glsl:(t=e.vertex)==null?void 0:t.glsl},fragment:{glsl:(r=e.fragment)==null?void 0:r.glsl}}}var CM=class{constructor(e){this.device=e,this.bindingsCache=new Ug(mR,AM),this.renderPipelinesCache=new Ug(yR,TM),this.inputLayoutsCache=new Ug(ER,Kx),this.programCache=new Ug(SM,Kx)}createBindings(e){var t;let r=this.bindingsCache.get(e);if(r===null){const i=SR(e);i.uniformBufferBindings=(t=i.uniformBufferBindings)==null?void 0:t.filter(({size:a})=>a&&a>0),r=this.device.createBindings(i),this.bindingsCache.add(i,r)}return r}createRenderPipeline(e){let t=this.renderPipelinesCache.get(e);if(t===null){const r=wR(e);r.colorAttachmentFormats=r.colorAttachmentFormats.filter(i=>i),t=this.device.createRenderPipeline(r),this.renderPipelinesCache.add(r,t)}return t}createInputLayout(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter(r=>!!r);let t=this.inputLayoutsCache.get(e);if(t===null){const r=IR(e);t=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,t)}return t}createProgram(e){let t=this.programCache.get(e);if(t===null){const r=wM(e);t=this.device.createProgram(e),this.programCache.add(r,t)}return t}destroy(){for(const e of this.bindingsCache.values())e.destroy();for(const e of this.renderPipelinesCache.values())e.destroy();for(const e of this.inputLayoutsCache.values())e.destroy();for(const e of this.programCache.values())e.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}},RM=class{constructor(e,t){const{data:r,type:i,count:a=0}=t;let u;Ng(r)?u=r:u=new Bg[this.type||O.UNSIGNED_INT](r),this.type=i,this.count=a,this.indexBuffer=e.createBuffer({viewOrSize:u,usage:Lo.INDEX})}get(){return this.indexBuffer}subData({data:e}){let t;Ng(e)?t=e:t=new Bg[this.type||O.UNSIGNED_INT](e),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}destroy(){this.indexBuffer.destroy()}};function Qx(e){return!!(e&&e.texture)}var Jx=class{constructor(e,t){this.device=e,this.options=t,this.isDestroy=!1;const{wrapS:r=O.CLAMP_TO_EDGE,wrapT:i=O.CLAMP_TO_EDGE,aniso:a,mag:u=O.NEAREST,min:f=O.NEAREST}=t;this.createTexture(t),this.sampler=e.createSampler({addressModeU:Gx[r],addressModeV:Gx[i],minFilter:f===O.NEAREST?Xa.POINT:Xa.BILINEAR,magFilter:u===O.NEAREST?Xa.POINT:Xa.BILINEAR,mipmapFilter:Ls.NO_MIP,maxAnisotropy:a})}createTexture(e){const{type:t=O.UNSIGNED_BYTE,width:r,height:i,flipY:a=!1,format:u=O.RGBA,alignment:f=1,usage:m=q.SAMPLED,unorm:_=!1,label:b}=e;let{data:A}=e;this.width=r,this.height=i;let C=et.U8_RGBA_RT;if(t===O.UNSIGNED_BYTE&&u===O.RGBA)C=_?et.U8_RGBA_NORM:et.U8_RGBA_RT;else if(t===O.UNSIGNED_BYTE&&u===O.LUMINANCE)C=et.U8_LUMINANCE;else if(t===O.FLOAT&&u===O.LUMINANCE)C=et.F32_LUMINANCE;else if(t===O.FLOAT&&u===O.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(A&&(A=gM(A,0)),C=et.F32_RGBA):C=et.F32_RGB;else if(t===O.FLOAT&&u===O.RGBA)C=et.F32_RGBA;else if(t===O.FLOAT&&u===O.RED)C=et.F32_R;else throw new Error(`create texture error, type: ${t}, format: ${u}`);this.texture=this.device.createTexture({format:C,width:r,height:i,usage:m===q.SAMPLED?gu.SAMPLED:gu.RENDER_TARGET,pixelStore:{unpackFlipY:a,packAlignment:f},mipLevelCount:1}),b&&this.device.setResourceName(this.texture,b),A&&this.texture.setImageData([A])}get(){return this.texture}update(e){const{data:t}=e;this.texture.setImageData([t])}bind(){}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&this.destroy(),this.options.width=e,this.options.height=t,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var e;!this.isDestroy&&!this.texture.destroyed&&((e=this.texture)==null||e.destroy()),this.isDestroy=!0}},eb=class{constructor(e,t){this.device=e,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(e=!1){const{width:t,height:r,color:i}=this.options;i&&(Qx(i)?(e&&i.resize({width:t,height:r}),this.colorTexture=i.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i.width,this.height=i.height):t&&r&&(this.colorTexture=this.device.createTexture({format:et.U8_RGBA_RT,usage:gu.RENDER_TARGET,width:t,height:r}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=t,this.height=r))}createDepthRenderTarget(e=!1){const{width:t,height:r,depth:i}=this.options;i&&(Qx(i)?(e&&i.resize({width:t,height:r}),this.depthTexture=i.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i.width,this.height=i.height):t&&r&&(this.depthTexture=this.device.createTexture({format:et.D24_S8,usage:gu.RENDER_TARGET,width:t,height:r}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=t,this.height=r))}get(){return this.colorRenderTarget}destroy(){var e,t;(e=this.colorRenderTarget)==null||e.destroy(),(t=this.depthRenderTarget)==null||t.destroy()}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=e,this.options.height=t,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}},IM=Object.defineProperty,MM=Object.defineProperties,OM=Object.getOwnPropertyDescriptors,tb=Object.getOwnPropertySymbols,PM=Object.prototype.hasOwnProperty,LM=Object.prototype.propertyIsEnumerable,rb=(e,t,r)=>t in e?IM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Xp=(e,t)=>{for(var r in t||(t={}))PM.call(t,r)&&rb(e,r,t[r]);if(tb)for(var r of tb(t))LM.call(t,r)&&rb(e,r,t[r]);return e},DM=(e,t)=>MM(e,OM(t)),{isPlainObject:BM,isTypedArray:FM,isNil:nb}=Kn,NM=class{constructor(e,t,r){this.device=e,this.options=t,this.service=r,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];const{vs:i,fs:a,attributes:u,uniforms:f,count:m,elements:_,diagnosticDerivativeUniformityEnabled:b}=t;this.options=t;const A=b?"":this.service.viewportOrigin===Qc.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=r.renderCache.createProgram({vertex:{glsl:i},fragment:{glsl:a,postprocess:X=>A+X}}),f&&(this.uniforms=this.extractUniforms(f));const C=[];let R=0;Object.keys(u).forEach(X=>{const ee=u[X],xe=ee.get();this.vertexBuffers.push(xe.get());const{offset:ke=0,stride:Ne=0,size:it=1,divisor:gt=0,shaderLocation:rr=0}=ee.attribute;C.push({arrayStride:Ne||it*4,stepMode:Zp.VERTEX,attributes:[{format:hM[it],shaderLocation:rr,offset:ke,divisor:gt}]}),R=xe.size/it}),m||(this.options.count=R),_&&(this.indexBuffer=_.get());const U=r.renderCache.createInputLayout({vertexBufferDescriptors:C,indexBufferFormat:_?et.U32_R:null,program:this.program});this.inputLayout=U,this.pipeline=this.createPipeline(t)}createPipeline(e,t){var r;const{primitive:i=O.TRIANGLES,depth:a,cull:u,blend:f,stencil:m}=e,_=this.initDepthDrawParams({depth:a}),b=!!(_&&_.enable),A=this.initCullDrawParams({cull:u}),C=!!(A&&A.enable),R=this.getBlendDrawParams({blend:f}),U=!!(R&&R.enable),X=this.getStencilDrawParams({stencil:m}),ee=!!(X&&X.enable),xe=this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:cM[i],colorAttachmentFormats:[et.U8_RGBA_RT],depthStencilAttachmentFormat:et.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:Xs.ALL,rgbBlendState:{blendMode:Hs.ADD,blendSrcFactor:Di.ONE,blendDstFactor:Di.ZERO},alphaBlendState:{blendMode:Hs.ADD,blendSrcFactor:Di.ONE,blendDstFactor:Di.ZERO}}:{channelWriteMask:ee&&X.opFront.zpass===Pa.REPLACE?Xs.NONE:Xs.ALL,rgbBlendState:{blendMode:U&&R.equation.rgb||Hs.ADD,blendSrcFactor:U&&R.func.srcRGB||Di.SRC_ALPHA,blendDstFactor:U&&R.func.dstRGB||Di.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:U&&R.equation.alpha||Hs.ADD,blendSrcFactor:U&&R.func.srcAlpha||Di.ONE,blendDstFactor:U&&R.func.dstAlpha||Di.ONE}}],blendConstant:U?xg:void 0,depthWrite:b,depthCompare:b&&_.func||Ti.LESS,cullMode:C&&A.face||yl.NONE,stencilWrite:ee,stencilFront:{compare:ee?X.func.cmp:Ti.ALWAYS,passOp:X.opFront.zpass,failOp:X.opFront.fail,depthFailOp:X.opFront.zfail,mask:X.opFront.mask},stencilBack:{compare:ee?X.func.cmp:Ti.ALWAYS,passOp:X.opBack.zpass,failOp:X.opBack.fail,depthFailOp:X.opBack.zfail,mask:X.opBack.mask}}});return ee&&!nb((r=m==null?void 0:m.func)==null?void 0:r.ref)&&(xe.stencilFuncReference=m.func.ref),xe}updateAttributesAndElements(){}updateAttributes(){}addUniforms(e){this.uniforms=Xp(Xp({},this.uniforms),this.extractUniforms(e))}draw(e,t){const r=Xp(Xp({},this.options),e),{count:i=0,instances:a,elements:u,uniforms:f={},uniformBuffers:m,textures:_}=r;this.uniforms=Xp(Xp({},this.uniforms),this.extractUniforms(f));const{renderPass:b,currentFramebuffer:A,width:C,height:R}=this.service;this.pipeline=this.createPipeline(r,t);const U=this.service.device,X=U.swapChainHeight;if(U.swapChainHeight=(A==null?void 0:A.height)||R,b.setViewport(0,0,(A==null?void 0:A.width)||C,(A==null?void 0:A.height)||R),U.swapChainHeight=X,b.setPipeline(this.pipeline),nb(this.pipeline.stencilFuncReference)||b.setStencilReference(this.pipeline.stencilFuncReference),b.setVertexInput(this.inputLayout,this.vertexBuffers.map(ee=>({buffer:ee})),u?{buffer:this.indexBuffer,offset:0}:null),m&&(this.bindings=U.createBindings({pipeline:this.pipeline,uniformBufferBindings:m.map((ee,xe)=>{const ke=ee;return{binding:xe,buffer:ke.get(),size:ke.size}}),samplerBindings:_==null?void 0:_.map(ee=>({texture:ee.texture,sampler:ee.sampler}))})),this.bindings&&(b.setBindings(this.bindings),Object.keys(this.uniforms).forEach(ee=>{const xe=this.uniforms[ee];xe instanceof Jx?this.uniforms[ee]=xe.get():xe instanceof eb&&(this.uniforms[ee]=xe.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),u){const ee=u.count;ee===0?b.draw(i,a):b.drawIndexed(ee,a)}else b.draw(i,a)}destroy(){var e,t,r;(e=this.vertexBuffers)==null||e.forEach(i=>i.destroy()),(t=this.indexBuffer)==null||t.destroy(),(r=this.bindings)==null||r.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:e}){if(e)return{enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:pM[e.func||O.LESS],range:e.range||[0,1]}}getBlendDrawParams({blend:e}){const{enable:t,func:r,equation:i,color:a=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:Fg[r&&r.srcRGB||O.SRC_ALPHA],srcAlpha:Fg[r&&r.srcAlpha||O.SRC_ALPHA],dstRGB:Fg[r&&r.dstRGB||O.ONE_MINUS_SRC_ALPHA],dstAlpha:Fg[r&&r.dstAlpha||O.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Yx[i&&i.rgb||O.FUNC_ADD],alpha:Yx[i&&i.alpha||O.FUNC_ADD]},color:a}}getStencilDrawParams({stencil:e}){const{enable:t,mask:r=4294967295,func:i={cmp:O.ALWAYS,ref:0,mask:4294967295},opFront:a={fail:O.KEEP,zfail:O.KEEP,zpass:O.KEEP},opBack:u={fail:O.KEEP,zfail:O.KEEP,zpass:O.KEEP}}=e||{};return{enable:!!t,mask:r,func:DM(Xp({},i),{cmp:mM[i.cmp]}),opFront:{fail:Wd[a.fail],zfail:Wd[a.zfail],zpass:Wd[a.zpass],mask:i.mask},opBack:{fail:Wd[u.fail],zfail:Wd[u.zfail],zpass:Wd[u.zpass],mask:i.mask}}}initCullDrawParams({cull:e}){if(e){const{enable:t,face:r=O.BACK}=e;return{enable:!!t,face:dM[r]}}}extractUniforms(e){const t={};return Object.keys(e).forEach(r=>{this.extractUniformsRecursively(r,e[r],t,"")}),t}extractUniformsRecursively(e,t,r,i){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||FM(t)||t===""||"resize"in t){r[`${i&&i+"."}${e}`]=t;return}BM(t)&&Object.keys(t).forEach(a=>{this.extractUniformsRecursively(a,t[a],r,`${i&&i+"."}${e}`)}),Array.isArray(t)&&t.forEach((a,u)=>{Object.keys(a).forEach(f=>{this.extractUniformsRecursively(f,a[f],r,`${i&&i+"."}${e}[${u}]`)})})}};function UM(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}var Y_=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),{isUndefined:kg}=Kn,kM=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=e=>new NM(this.device,e,this),this.createAttribute=e=>new lM(this.device,e),this.createBuffer=e=>new _M(this.device,e),this.createElements=e=>new RM(this.device,e),this.createTexture2D=e=>new Jx(this.device,e),this.createFramebuffer=e=>new eb(this.device,e),this.useFramebuffer=(e,t)=>{this.currentFramebuffer=e,this.beginFrame(),t(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(e,t)=>Y_(this,null,function*(){this.currentFramebuffer=e,this.preRenderPass=this.renderPass,this.beginFrame(),yield t(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass}),this.clear=e=>{const{color:t,depth:r,stencil:i,framebuffer:a=null}=e;if(a)a.clearOptions={color:t,depth:r,stencil:i};else{const u=this.queryVerdorInfo();if(u==="WebGL1"){const f=this.getGLContext();kg(i)?kg(r)||(f.clearDepth(r),f.clear(f.DEPTH_BUFFER_BIT)):(f.clearStencil(i),f.clear(f.STENCIL_BUFFER_BIT))}else if(u==="WebGL2"){const f=this.getGLContext();kg(i)?kg(r)||f.clearBufferfv(f.DEPTH,0,[r]):f.clearBufferiv(f.STENCIL,0,[i])}}},this.viewport=({width:e,height:t})=>{this.swapChain.configureSwapChain(e,t),this.createMainColorDepthRT(e,t),this.width=e,this.height=t},this.readPixels=e=>{const{framebuffer:t,x:r,y:i,width:a,height:u}=e,f=this.device.createReadback(),m=t.colorTexture,_=f.readTextureSync(m,r,this.viewportOrigin===Qc.LOWER_LEFT?i:this.height-i,a,u,new Uint8Array(a*u*4));if(this.viewportOrigin!==Qc.LOWER_LEFT)for(let b=0;b<_.length;b+=4){const A=_[b];_[b]=_[b+2],_[b+2]=A}return f.destroy(),_},this.readPixelsAsync=e=>Y_(this,null,function*(){const{framebuffer:t,x:r,y:i,width:a,height:u}=e,f=this.device.createReadback(),m=t.colorTexture,_=yield f.readTexture(m,r,this.viewportOrigin===Qc.LOWER_LEFT?i:this.height-i,a,u,new Uint8Array(a*u*4));if(this.viewportOrigin!==Qc.LOWER_LEFT)for(let b=0;b<_.length;b+=4){const A=_[b];_[b]=_[b+2],_[b+2]=A}return f.destroy(),_}),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>{var e;return(e=this.canvas)==null?void 0:e.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var e;this.canvas=null,(e=this.uniformBuffers)==null||e.forEach(t=>{t.destroy()}),this.device.destroy(),this.renderCache.destroy()}}init(e,t){return Y_(this,null,function*(){const{enableWebGPU:r,shaderCompilerPath:i,antialias:a}=t;this.canvas=e;const f=yield(r?new $I({shaderCompilerPath:i}):new lI({targets:["webgl2","webgl1"],antialias:a,onContextLost(_){console.warn("context lost",_)},onContextCreationError(_){console.warn("context creation error",_)},onContextRestored(_){console.warn("context restored",_)}})).createSwapChain(e);f.configureSwapChain(e.width,e.height),this.device=f.getDevice(),this.swapChain=f,this.renderCache=new CM(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;const m=this.device.gl;this.extensionObject={OES_texture_float:!UM(m)&&this.device.OES_texture_float},this.createMainColorDepthRT(e.width,e.height)})}createMainColorDepthRT(e,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:et.U8_RGBA_RT,width:e,height:t,usage:gu.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:et.D24_S8,width:e,height:t,usage:gu.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();const{currentFramebuffer:e,swapChain:t,mainColorRT:r,mainDepthRT:i}=this,a=e?e.colorRenderTarget:r,u=e?null:t.getOnscreenTexture(),f=e?e.depthRenderTarget:i,{color:m=[0,0,0,0],depth:_=1,stencil:b=0}=(e==null?void 0:e.clearOptions)||{},A=a?Wm(m[0]*255,m[1]*255,m[2]*255,m[3]):xg,C=f?_:void 0,R=f?b:void 0,U=this.device.createRenderPass({colorAttachment:[a],colorResolveTo:[u],colorClearColor:[A],colorStore:[!0],depthStencilAttachment:f,depthClearValue:C,stencilClearValue:R});this.renderPass=U}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){const e=this.device.gl;return e.getParameter(e.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}},q_=["selectstart","selecting","selectend"],zM=class extends wa.EventEmitter{constructor(e,t={}){super(),this.isEnable=!1,this.onDragStart=r=>{this.box.style.display="block",this.startEvent=this.endEvent=r,this.syncBoxBound(),this.emit("selectstart",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=r=>{this.endEvent=r,this.syncBoxBound(),this.emit("selecting",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=r=>{this.endEvent=r,this.box.style.display="none",this.emit("selectend",this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=e,this.options=t}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;const{className:e}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){const t=Mi("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}disable(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}syncBoxBound(){const{x:e,y:t}=this.startEvent,{x:r,y:i}=this.endEvent,a=Math.min(e,r),u=Math.min(t,i),f=Math.abs(e-r),m=Math.abs(t-i);this.box.style.top=`${u}px`,this.box.style.left=`${a}px`,this.box.style.width=`${f}px`,this.box.style.height=`${m}px`}getLngLatBox(){const{lngLat:{lng:e,lat:t}}=this.startEvent,{lngLat:{lng:r,lat:i}}=this.endEvent;return tc([[e,t],[r,i]])}},VM=Object.defineProperty,ZM=Object.defineProperties,jM=Object.getOwnPropertyDescriptors,ib=Object.getOwnPropertySymbols,HM=Object.prototype.hasOwnProperty,XM=Object.prototype.propertyIsEnumerable,ob=(e,t,r)=>t in e?VM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,WM=(e,t)=>{for(var r in t||(t={}))HM.call(t,r)&&ob(e,r,t[r]);if(ib)for(var r of ib(t))XM.call(t,r)&&ob(e,r,t[r]);return e},GM=(e,t)=>ZM(e,jM(t)),rv=(e,t,r)=>new Promise((i,a)=>{var u=_=>{try{m(r.next(_))}catch(b){a(b)}},f=_=>{try{m(r.throw(_))}catch(b){a(b)}},m=_=>_.done?i(_.value):Promise.resolve(_.value).then(u,f);m((r=r.apply(e,t)).next())}),YM=class{constructor(e){const{id:t,map:r,renderer:i="device"}=e,a=jf();this.container=a,r.setContainer(a,t),i==="regl"?a.rendererService=new uM:a.rendererService=new kM,this.sceneService=a.sceneService,this.mapService=a.mapService,this.iconService=a.iconService,this.fontService=a.fontService,this.controlService=a.controlService,this.layerService=a.layerService,this.debugService=a.debugService,this.debugService.setEnable(e.debug),this.markerService=a.markerService,this.interactionService=a.interactionService,this.popupService=a.popupService,this.boxSelect=new zM(this,{}),this.initComponent(t),this.sceneService.init(e),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(e){return rv(this,null,function*(){return this.sceneService.exportPng(e)})}exportMap(e){return rv(this,null,function*(){return this.sceneService.exportPng(e)})}registerRenderService(e){this.sceneService.loaded?new e(this).init():this.on("loaded",()=>{new e(this).init()})}setBgColor(e){this.mapService.setBgColor(e)}addLayer(e){this.loaded?this.preAddLayer(e):this.once("loaded",()=>{this.preAddLayer(e)})}preAddLayer(e){const t=Hf(this.container);if(e.setContainer(t),this.sceneService.addLayer(e),e.inited){this.initTileLayer(e);const r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",()=>{this.initTileLayer(e);const r=this.initMask(e);this.addMask(r,e.id)})}initMask(e){const{mask:t,maskfence:r,maskColor:i="#000",maskOpacity:a=0}=e.getLayerConfig();return!t||!r?void 0:new rx().source(r).shape("fill").style({color:i,opacity:a})}addMask(e,t){if(!e)return;const r=this.getLayer(t);if(r){const i=Hf(this.container);e.setContainer(i),r.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(e){return this.layerService.getLayer(e)}getLayerByName(e){return this.layerService.getLayerByName(e)}removeLayer(e,t){return rv(this,null,function*(){yield this.layerService.remove(e,t)})}removeAllLayer(){return rv(this,null,function*(){yield this.layerService.removeAllLayers()})}render(){this.sceneService.render()}setEnableRender(e){this.layerService.setEnableRender(e)}addIconFont(e,t){this.fontService.addIconFont(e,t)}addIconFonts(e){e.forEach(([t,r])=>{this.fontService.addIconFont(t,r)})}addFontFace(e,t){this.fontService.once("fontloaded",r=>{this.emit("fontloaded",r)}),this.fontService.addFontFace(e,t)}addImage(e,t){return rv(this,null,function*(){yield this.iconService.addImage(e,t)})}hasImage(e){return this.iconService.hasImage(e)}removeImage(e){this.iconService.removeImage(e)}addIconFontGlyphs(e,t){this.fontService.addIconGlyphs(t)}addControl(e){this.controlService.addControl(e,this.container)}removeControl(e){this.controlService.removeControl(e)}getControlByName(e){return this.controlService.getControlByName(e)}addMarker(e){this.markerService.addMarker(e)}addMarkerLayer(e){this.markerService.addMarkerLayer(e)}removeMarkerLayer(e){this.markerService.removeMarkerLayer(e)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}addPopup(e){this.popupService.addPopup(e)}removePopup(e){this.popupService.removePopup(e)}on(e,t){var r;q_.includes(e)?(r=this.boxSelect)==null||r.on(e,t):Pp.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}once(e,t){var r;q_.includes(e)?(r=this.boxSelect)==null||r.once(e,t):Pp.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}emit(e,t){Pp.indexOf(e)===-1?this.mapService.on(e,t):this.sceneService.emit(e,t)}off(e,t){var r;q_.includes(e)?(r=this.boxSelect)==null||r.off(e,t):Pp.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}getZoom(){return this.mapService.getZoom()}getCenter(e){return this.mapService.getCenter(e)}setCenter(e,t){return this.mapService.setCenter(e,t)}getPitch(){return this.mapService.getPitch()}setPitch(e){return this.mapService.setPitch(e)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(e){this.mapService.setRotation(e)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(e){this.mapService.panTo(e)}panBy(e,t){this.mapService.panBy(e,t)}getContainer(){return this.mapService.getContainer()}setZoom(e){this.mapService.setZoom(e)}fitBounds(e,t){const{fitBoundsOptions:r,animate:i}=this.sceneService.getSceneConfig();this.mapService.fitBounds(e,t||GM(WM({},r),{animate:i}))}setZoomAndCenter(e,t){this.mapService.setZoomAndCenter(e,t)}setMapStyle(e){this.mapService.setMapStyle(e)}setMapStatus(e){this.mapService.setMapStatus(e)}pixelToLngLat(e){return this.mapService.pixelToLngLat(e)}lngLatToPixel(e){return this.mapService.lngLatToPixel(e)}containerToLngLat(e){return this.mapService.containerToLngLat(e)}lngLatToContainer(e){return this.mapService.lngLatToContainer(e)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(e){this.container.postProcessingPass.name=new e}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(e=!0){this.boxSelect.enable(),e&&this.boxSelect.once("selectend",()=>{this.disableBoxSelect()})}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(e,t){Ue.REGISTERED_PROTOCOLS[e]=t}static removeProtocol(e){delete Ue.REGISTERED_PROTOCOLS[e]}getProtocol(e){return Ue.REGISTERED_PROTOCOLS[e]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(e){this.controlService.init({container:gf(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){const{logoVisible:e,logoPosition:t}=this.sceneService.getSceneConfig();e&&this.addControl(new N0({position:t}))}initTileLayer(e){e.getSource().isTile&&(e.tileLayer=new UC(e))}},Z5="2.22.5";function nv(e){"@babel/helpers - typeof";return nv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nv(e)}function ab(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function j5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ab(Object(r),!0).forEach(function(i){qM(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ab(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function qM(e,t,r){return t=KM(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KM(e){var t=$M(e,"string");return nv(t)==="symbol"?t:String(t)}function $M(e,t){if(nv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(nv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function H5(e,t){return tO(e)||eO(e,t)||JM(e,t)||QM()}function QM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JM(e,t){if(e){if(typeof e=="string")return sb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sb(e,t)}}function sb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function eO(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,f,m=[],_=!0,b=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);_=!0);}catch(A){b=!0,a=A}finally{try{if(!_&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw a}}return m}}function tO(e){if(Array.isArray(e))return e}var X5=null,W5=null;class rO{constructor(t){(0,D.Z)(this,"configService",void 0),(0,D.Z)(this,"config",void 0),this.config=t}setContainer(t,r){this.configService=t.globalConfigService,t.mapConfig=(0,_e.Z)((0,_e.Z)({},this.config),{},{id:r}),t.mapService=new(this.getServiceConstructor())(t)}getServiceConstructor(){throw new Error("Method not implemented.")}}var nO=H(86463),iv=H.n(nO),ub=H(59129),lb=H(76920),iO=H(70837),oO=H(37083),aO=H(74063),zg=H(88145),_c=H(52521);function ov(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vg(e,t){var r=ra.fF([],t,e);return ra.bA(r,r,1/r[3]),r}function G5(e,t){var r=e%t;return r<0?t+r:r}function Y5(e,t,r){return r*t+(1-r)*e}function Wp(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var eh=Math.PI,cb=eh/4,lf=eh/180,hb=180/eh,K_=512,$_=4003e4,sO=1.5;function fb(e){return Math.pow(2,e)}function uO(e){return Math.log2(e)}function Zg(e,t){var r=(0,_c.Z)(e,2),i=r[0],a=r[1];Wp(Number.isFinite(i)&&Number.isFinite(t)),Wp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),t*=K_;var u=i*lf,f=a*lf,m=t*(u+eh)/(2*eh),_=t*(eh-Math.log(Math.tan(cb+f*.5)))/(2*eh);return[m,_]}function Q_(e,t){var r=(0,_c.Z)(e,2),i=r[0],a=r[1];t*=K_;var u=i/t*(2*eh)-eh,f=2*(Math.atan(Math.exp(eh-a/t*(2*eh)))-cb);return[u*hb,f*hb]}function q5(e){var t=e.latitude;assert(Number.isFinite(t));var r=Math.cos(t*lf);return uO($_*r)-9}function pb(e){var t=e.latitude,r=e.longitude,i=e.zoom,a=e.scale,u=e.highPrecision,f=u===void 0?!1:u;a=a!==void 0?a:fb(i),Wp(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(a));var m={},_=K_*a,b=Math.cos(t*lf),A=_/360,C=A/b,R=_/$_/b;if(m.pixelsPerMeter=[R,-R,R],m.metersPerPixel=[1/R,-1/R,1/R],m.pixelsPerDegree=[A,-C,R],m.degreesPerPixel=[1/A,-1/C,1/R],f){var U=lf*Math.tan(t*lf)/b,X=A*U/2,ee=_/$_*U,xe=ee/C*R;m.pixelsPerDegree2=[0,-X,ee],m.pixelsPerMeter2=[xe,0,xe]}return m}function K5(e,t){var r=_slicedToArray(e,3),i=r[0],a=r[1],u=r[2],f=_slicedToArray(t,3),m=f[0],_=f[1],b=f[2],A=1,C=pb({longitude:i,latitude:a,scale:A,highPrecision:!0}),R=C.pixelsPerMeter,U=C.pixelsPerMeter2,X=Zg(e,A);X[0]+=m*(R[0]+U[0]*_),X[1]+=_*(R[1]+U[1]*_);var ee=Q_(X,A),xe=(u||0)+(b||0);return Number.isFinite(u)||Number.isFinite(b)?[ee[0],ee[1],xe]:ee}function lO(e){var t=e.height,r=e.pitch,i=e.bearing,a=e.altitude,u=e.center,f=u===void 0?null:u,m=e.flipY,_=m===void 0?!1:m,b=ov();return po.translate(b,b,[0,0,-a]),po.scale(b,b,[1,1,1/t]),po.rotateX(b,b,-r*lf),po.rotateZ(b,b,i*lf),_&&po.scale(b,b,[1,-1,1]),f&&po.translate(b,b,zo.tk([],f)),b}function cO(e){var t=e.width,r=e.height,i=e.altitude,a=i===void 0?sO:i,u=e.pitch,f=u===void 0?0:u,m=e.nearZMultiplier,_=m===void 0?1:m,b=e.farZMultiplier,A=b===void 0?1:b,C=f*lf,R=Math.atan(.5/a),U=Math.sin(R)*a/Math.sin(Math.PI/2-C-R),X=Math.cos(Math.PI/2-C)*U+a;return{fov:2*Math.atan(r/2/a),aspect:t/r,focalDistance:a,near:_,far:X*A}}function hO(e){var t=e.width,r=e.height,i=e.pitch,a=e.altitude,u=e.nearZMultiplier,f=e.farZMultiplier,m=cO({width:t,height:r,altitude:a,pitch:i,nearZMultiplier:u,farZMultiplier:f}),_=m.fov,b=m.aspect,A=m.near,C=m.far,R=po.perspective([],_,b,A,C);return R}function fO(e,t){var r=(0,_c.Z)(e,3),i=r[0],a=r[1],u=r[2],f=u===void 0?0:u;return Wp(Number.isFinite(i)&&Number.isFinite(a)&&Number.isFinite(f)),Vg(t,[i,a,f,1])}function db(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,_c.Z)(e,3),a=i[0],u=i[1],f=i[2];if(Wp(Number.isFinite(a)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(f)){var m=Vg(t,[a,u,f,1]);return m}var _=Vg(t,[a,u,0,1]),b=Vg(t,[a,u,1,1]),A=_[2],C=b[2],R=A===C?0:((r||0)-A)/(C-A);return Hi.t7([],_,b,R)}var mb=ov(),pO=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width,i=t.height,a=t.viewMatrix,u=a===void 0?mb:a,f=t.projectionMatrix,m=f===void 0?mb:f;(0,ub.Z)(this,e),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=m;var _=ov();po.multiply(_,_,this.projectionMatrix),po.multiply(_,_,this.viewMatrix),this.viewProjectionMatrix=_;var b=ov();po.scale(b,b,[this.width/2,-this.height/2,1]),po.translate(b,b,[1,-1,0]),po.multiply(b,b,this.viewProjectionMatrix);var A=po.invert(ov(),b);if(!A)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=A,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,lb.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&po.equals(r.projectionMatrix,this.projectionMatrix)&&po.equals(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.topLeft,u=a===void 0?!0:a,f=this.projectPosition(r),m=fO(f,this.pixelProjectionMatrix),_=(0,_c.Z)(m,2),b=_[0],A=_[1],C=u?A:this.height-A;return r.length===2?[b,C]:[b,C,m[2]]}},{key:"unproject",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.topLeft,u=a===void 0?!0:a,f=i.targetZ,m=(0,_c.Z)(r,3),_=m[0],b=m[1],A=m[2],C=u?b:this.height-b,R=f&&f*this.pixelsPerMeter,U=db([_,C,A],this.pixelUnprojectionMatrix,R),X=this.unprojectPosition(U),ee=(0,_c.Z)(X,3),xe=ee[0],ke=ee[1],Ne=ee[2];return Number.isFinite(A)?[xe,ke,Ne]:Number.isFinite(f)?[xe,ke,f]:[xe,ke]}},{key:"projectPosition",value:function(r){var i=this.projectFlat(r),a=(0,_c.Z)(i,2),u=a[0],f=a[1],m=(r[2]||0)*this.pixelsPerMeter;return[u,f,m]}},{key:"unprojectPosition",value:function(r){var i=this.unprojectFlat(r),a=(0,_c.Z)(i,2),u=a[0],f=a[1],m=(r[2]||0)/this.pixelsPerMeter;return[u,f,m]}},{key:"projectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function dO(e){var t=e.width,r=e.height,i=e.bounds,a=e.minExtent,u=a===void 0?0:a,f=e.maxZoom,m=f===void 0?24:f,_=e.padding,b=_===void 0?0:_,A=e.offset,C=A===void 0?[0,0]:A,R=(0,_c.Z)(i,2),U=(0,_c.Z)(R[0],2),X=U[0],ee=U[1],xe=(0,_c.Z)(R[1],2),ke=xe[0],Ne=xe[1];if(Number.isFinite(b)){var it=b;b={top:it,bottom:it,left:it,right:it}}else Wp(Number.isFinite(b.top)&&Number.isFinite(b.bottom)&&Number.isFinite(b.left)&&Number.isFinite(b.right));var gt=new J_({width:t,height:r,longitude:0,latitude:0,zoom:0}),rr=gt.project([X,Ne]),Kt=gt.project([ke,ee]),Rt=[Math.max(Math.abs(Kt[0]-rr[0]),u),Math.max(Math.abs(Kt[1]-rr[1]),u)],tr=[t-b.left-b.right-Math.abs(C[0])*2,r-b.top-b.bottom-Math.abs(C[1])*2];Wp(tr[0]>0&&tr[1]>0);var Tn=tr[0]/Rt[0],fi=tr[1]/Rt[1],An=(b.right-b.left)/2/Tn,ui=(b.bottom-b.top)/2/fi,Xi=[(Kt[0]+rr[0])/2+An,(Kt[1]+rr[1])/2+ui],ou=gt.unproject(Xi),Lu=gt.zoom+Math.log2(Math.abs(Math.min(Tn,fi)));return{longitude:ou[0],latitude:ou[1],zoom:Math.min(Lu,m)}}var J_=function(e){(0,aO.Z)(t,e);function t(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=i.width,u=i.height,f=i.latitude,m=f===void 0?0:f,_=i.longitude,b=_===void 0?0:_,A=i.zoom,C=A===void 0?0:A,R=i.pitch,U=R===void 0?0:R,X=i.bearing,ee=X===void 0?0:X,xe=i.altitude,ke=xe===void 0?1.5:xe,Ne=i.nearZMultiplier,it=i.farZMultiplier;(0,ub.Z)(this,t),a=a||1,u=u||1;var gt=fb(C);ke=Math.max(.75,ke);var rr=Zg([b,m],gt);rr[2]=0;var Kt=hO({width:a,height:u,pitch:U,bearing:ee,altitude:ke,nearZMultiplier:Ne||1/u,farZMultiplier:it||1.01}),Rt=lO({height:u,center:rr,pitch:U,bearing:ee,altitude:ke,flipY:!0});return r=(0,iO.Z)(this,(0,oO.Z)(t).call(this,{width:a,height:u,viewMatrix:Rt,projectionMatrix:Kt})),r.latitude=m,r.longitude=b,r.zoom=C,r.pitch=U,r.bearing=ee,r.altitude=ke,r.scale=gt,r.center=rr,r.pixelsPerMeter=pb((0,zg.Z)((0,zg.Z)(r))).pixelsPerMeter[2],Object.freeze((0,zg.Z)((0,zg.Z)(r))),r}return(0,lb.Z)(t,[{key:"projectFlat",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Zg(i,a)}},{key:"unprojectFlat",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Q_(i,a)}},{key:"getMapCenterByLngLatPosition",value:function(i){var a=i.lngLat,u=i.pos,f=db(u,this.pixelUnprojectionMatrix),m=Zg(a,this.scale),_=Hi.IH([],m,Hi.tk([],f)),b=Hi.IH([],this.center,_);return Q_(b,this.scale)}},{key:"getLocationAtPoint",value:function(i){var a=i.lngLat,u=i.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:u})}},{key:"fitBounds",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=this.width,f=this.height,m=dO(Object.assign({width:u,height:f,bounds:i},a)),_=m.longitude,b=m.latitude,A=m.zoom;return new t({width:u,height:f,longitude:_,latitude:b,zoom:A})}}]),t}(pO);class mO{constructor(){(0,D.Z)(this,"viewport",new J_)}syncWithMapCamera(t){const{center:r,zoom:i,pitch:a,bearing:u,viewportHeight:f,viewportWidth:m}=t,_={width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing};this.viewport=new J_((0,_e.Z)((0,_e.Z)({},_),{},{width:m,height:f,longitude:r&&r[0],latitude:r&&r[1],zoom:i,pitch:a,bearing:u}))}getZoom(){return this.viewport.zoom}getZoomScale(){return Math.pow(2,this.getZoom())}getCenter(){return[this.viewport.longitude,this.viewport.latitude]}getProjectionMatrix(){return this.viewport.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewport.viewMatrix}getViewMatrixUncentered(){return this.viewport.viewMatrixUncentered}getViewProjectionMatrix(){return this.viewport.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewport.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(t,r){return this.viewport.projectFlat(t,r)}}class vO{constructor(t){(0,D.Z)(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const r=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}project(t){const r=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[r,i]}unproject(t){const r=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[r,i]}}const gO={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},vb={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},_O=12;class yO{constructor(t){(0,D.Z)(this,"version","DEFAUlTMAP"),(0,D.Z)(this,"map",void 0),(0,D.Z)(this,"simpleMapCoord",new vO),(0,D.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,D.Z)(this,"config",void 0),(0,D.Z)(this,"configService",void 0),(0,D.Z)(this,"coordinateSystemService",void 0),(0,D.Z)(this,"eventEmitter",void 0),(0,D.Z)(this,"markerContainer",void 0),(0,D.Z)(this,"cameraChangedCallback",void 0),(0,D.Z)(this,"$mapContainer",void 0),(0,D.Z)(this,"handleCameraChanged",r=>{const{lat:i,lng:a}=this.map.getCenter();this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:this.map.getBearing(),center:[a,i],viewportHeight:this.map.transform.height,pitch:this.map.getPitch(),viewportWidth:this.map.transform.width,zoom:this.map.getZoom(),cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new wa.EventEmitter}setBgColor(t){this.bgColor=t}addMarkerContainer(){const t=this.map.getCanvasContainer();this.markerContainer=Mi("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}on(t,r){pn.indexOf(t)!==-1?this.eventEmitter.on(t,r):this.map.on(vb[t]||t,r)}off(t,r){this.map.off(vb[t]||t,r),this.eventEmitter.off(t,r)}getContainer(){return this.map.getContainer()}getMapCanvasContainer(){return this.map.getCanvasContainer()}getSize(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();const t=this.map.transform;return[t.width,t.height]}getType(){return"default"}getZoom(){return this.map.getZoom()}setZoom(t){return this.map.setZoom(t)}getCenter(){return this.map.getCenter()}setCenter(t){this.map.setCenter(t)}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getBearing()}getBounds(){return this.map.getBounds().toArray()}getMinZoom(){return this.map.getMinZoom()}getMaxZoom(){return this.map.getMaxZoom()}setRotation(t){this.map.setBearing(t)}zoomIn(t,r){this.map.zoomIn(t,r)}zoomOut(t,r){this.map.zoomOut(t,r)}setPitch(t){return this.map.setPitch(t)}panTo(t){this.map.panTo(t)}panBy(t=0,r=0){this.map.panBy([t,r])}fitBounds(t,r){this.map.fitBounds(t,r)}setMaxZoom(t){this.map.setMaxZoom(t)}setMinZoom(t){this.map.setMinZoom(t)}setMapStatus(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}setZoomAndCenter(t,r){this.map.flyTo({zoom:t,center:r})}setMapStyle(t){var r;(r=this.map)===null||r===void 0||r.setStyle(this.getMapStyleValue(t))}meterToCoord(t,r){return 1}pixelToLngLat(t){return this.map.unproject(t)}lngLatToPixel(t){return this.map.project(t)}containerToLngLat(t){return this.map.unproject(t)}lngLatToContainer(t){return this.map.project(t)}getMapStyle(){try{var t;const r=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(r)?r==null?void 0:r.replace(/\/\w+$/,"").replace(/sprites/,"styles"):r}catch(r){return""}}getMapStyleConfig(){return gO}getMapStyleValue(t){var r;return(r=this.getMapStyleConfig()[t])!==null&&r!==void 0?r:t}destroy(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...r){this.eventEmitter.emit(t,...r)}once(t,...r){this.eventEmitter.once(t,...r)}getMapContainer(){return this.$mapContainer}exportMap(t){var r;const i=(r=this.map)===null||r===void 0?void 0:r.getCanvas();return t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png")}onCameraChanged(t){this.cameraChangedCallback=t}creatMapContainer(t){let r=t;return typeof t=="string"&&(r=document.getElementById(t)),r}updateView(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>_O&&t?this.coordinateSystemService.setCoordinateSystem(Ee.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Ee.LNGLAT)}}const xO=["id","attributionControl","style","token","rotation","mapInstance"];function bO(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(t||(t=document),!!t)){var a=t.head||t.getElementsByTagName("head")[0];if(!a){a=t.createElement("head");var u=t.body||t.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(a,u):t.documentElement.appendChild(a)}var f=t.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(t.createTextNode(e)),a.appendChild(f),f}}bO(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=iv();let EO=0;const gb="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg";class TO extends yO{constructor(...t){super(...t),(0,D.Z)(this,"version","MAPBOX"),(0,D.Z)(this,"viewport",void 0)}getType(){return"mapbox"}lngLatToCoord(t,r={x:0,y:0,z:0}){const{x:i,y:a}=this.lngLatToMercator(t,0);return[i-r.x,a-r.y]}lngLatToMercator(t,r){const{x:i=0,y:a=0,z:u=0}=window.mapboxgl.MercatorCoordinate.fromLngLat(t,r);return{x:i,y:a,z:u}}getModelMatrix(t,r,i,a=[1,1,1],u={x:0,y:0,z:0}){const f=window.mapboxgl.MercatorCoordinate.fromLngLat(t,r),m=f.meterInMercatorCoordinateUnits(),_=po.create();return po.translate(_,_,zo.al(f.x-u.x,f.y-u.y,f.z||0-u.z)),po.scale(_,_,zo.al(m*a[0],-m*a[1],m*a[2])),po.rotateX(_,_,i[0]),po.rotateY(_,_,i[1]),po.rotateZ(_,_,i[2]),_}init(){var t=this;return(0,Xt.Z)(function*(){const r=t.config,{id:i="map",attributionControl:a=!1,style:u="light",token:f=gb,rotation:m=0,mapInstance:_}=r,b=(0,Le.Z)(r,xO);t.viewport=new mO,!_&&!window.mapboxgl&&console.error(t.configService.getSceneWarninfo("SDK")),f===gb&&u!=="blank"&&!window.mapboxgl.accessToken&&!_&&console.warn(t.configService.getSceneWarninfo("MapToken")),!_&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=f),_?(t.map=_,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(i),t.map=new window.mapboxgl.Map((0,_e.Z)({container:t.$mapContainer,style:t.getMapStyleValue(u),attributionControl:a,bearing:m},b))),t.map.on("load",()=>{t.handleCameraChanged()}),t.map.on("move",t.handleCameraChanged),t.handleCameraChanged()})()}destroy(){var t;(t=this.$mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...r){this.eventEmitter.emit(t,...r)}once(t,...r){this.eventEmitter.once(t,...r)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){var t;return(t=this.getMapContainer())===null||t===void 0?void 0:t.querySelector(".mapboxgl-canvas-container")}meterToCoord(t,r){const i=new(iv()).LngLat(t[0],t[1]),a=new(iv()).LngLat(r[0],r[1]),u=i.distanceTo(a),f=iv().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),m=iv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),{x:_,y:b}=f,{x:A,y:C}=m;return Math.sqrt(Math.pow(_-A,2)+Math.pow(b-C,2))*4194304*2/u}exportMap(t){const r=this.map.getCanvas();return t==="jpg"?r==null?void 0:r.toDataURL("image/jpeg"):r==null?void 0:r.toDataURL("image/png")}creatMapContainer(t){let r=t;typeof t=="string"&&(r=document.getElementById(t));const i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_mapbox_div"+EO++,r.appendChild(i),i}}function AO(e,t){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(t||(t=document),!!t)){var a=t.head||t.getElementsByTagName("head")[0];if(!a){a=t.createElement("head");var u=t.body||t.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(a,u):t.documentElement.appendChild(a)}var f=t.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(t.createTextNode(e)),a.appendChild(f),f}}AO(`.mapboxgl-ctrl-logo {
  display: none !important;
}
`);class SO extends rO{getServiceConstructor(){return TO}}function av(e){"@babel/helpers - typeof";return av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},av(e)}function _b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function yb(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_b(Object(r),!0).forEach(function(i){wO(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_b(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function wO(e,t,r){return t=CO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function CO(e){var t=RO(e,"string");return av(t)==="symbol"?t:String(t)}function RO(e,t){if(av(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(av(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function IO(e,t){return LO(e)||PO(e,t)||OO(e,t)||MO()}function MO(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OO(e,t){if(e){if(typeof e=="string")return xb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xb(e,t)}}function xb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function PO(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,f,m=[],_=!0,b=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);_=!0);}catch(A){b=!0,a=A}finally{try{if(!_&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw a}}return m}}function LO(e){if(Array.isArray(e))return e}var DO=ze.memo(function(e){var t=e.style,r=e.className,i=e.map,a=e.option,u=e.onSceneLoaded,f=(0,ze.createRef)(),m=(0,ze.useState)(),_=IO(m,2),b=_[0],A=_[1];return(0,ze.useEffect)(function(){var C=new YM(yb(yb({id:f.current},a),{},{map:new SO(i)}));return C.on("loaded",function(){A(C),u&&u(C)}),function(){C.destroy()}},[]),(0,ze.useEffect)(function(){b&&i.style&&b.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,ze.useEffect)(function(){b&&i.zoom&&b.setZoom(i.zoom)},[i.zoom]),(0,ze.useEffect)(function(){b&&i.center&&b.setCenter(i.center)},[JSON.stringify(i.center)]),(0,ze.useEffect)(function(){b&&i.pitch!==void 0&&b.setPitch(i.pitch||0)},[i.pitch]),(0,ze.useEffect)(function(){b&&i.rotation&&b.setRotation(i.rotation)},[i.rotation]),ze.createElement(qe.Provider,{value:b},(0,ze.createElement)("div",{ref:f,style:t,className:r},b&&e.children))}),BO=DO;function sv(e){"@babel/helpers - typeof";return sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sv(e)}function bb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function $5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bb(Object(r),!0).forEach(function(i){FO(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bb(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function FO(e,t,r){return t=NO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function NO(e){var t=UO(e,"string");return sv(t)==="symbol"?t:String(t)}function UO(e,t){if(sv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(sv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Q5(e,t){return ZO(e)||VO(e,t)||zO(e,t)||kO()}function kO(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zO(e,t){if(e){if(typeof e=="string")return Eb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Eb(e,t)}}function Eb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function VO(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,f,m=[],_=!0,b=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);_=!0);}catch(A){b=!0,a=A}finally{try{if(!_&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw a}}return m}}function ZO(e){if(Array.isArray(e))return e}var J5=null,eL=null;function uv(e){"@babel/helpers - typeof";return uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uv(e)}function Tb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function tL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Tb(Object(r),!0).forEach(function(i){jO(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tb(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function jO(e,t,r){return t=HO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HO(e){var t=XO(e,"string");return uv(t)==="symbol"?t:String(t)}function XO(e,t){if(uv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(uv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function rL(e,t){return qO(e)||YO(e,t)||GO(e,t)||WO()}function WO(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GO(e,t){if(e){if(typeof e=="string")return Ab(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ab(e,t)}}function Ab(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function YO(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,f,m=[],_=!0,b=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);_=!0);}catch(A){b=!0,a=A}finally{try{if(!_&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw a}}return m}}function qO(e){if(Array.isArray(e))return e}var nL=null,iL=null;function lv(e){"@babel/helpers - typeof";return lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lv(e)}function Sb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function oL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Sb(Object(r),!0).forEach(function(i){KO(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sb(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function KO(e,t,r){return t=$O(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $O(e){var t=QO(e,"string");return lv(t)==="symbol"?t:String(t)}function QO(e,t){if(lv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(lv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function aL(e,t){return rP(e)||tP(e,t)||eP(e,t)||JO()}function JO(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eP(e,t){if(e){if(typeof e=="string")return wb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wb(e,t)}}function wb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function tP(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,f,m=[],_=!0,b=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);_=!0);}catch(A){b=!0,a=A}finally{try{if(!_&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw a}}return m}}function rP(e){if(Array.isArray(e))return e}var sL=null,uL=null;function lL(e,t){return aP(e)||oP(e,t)||iP(e,t)||nP()}function nP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iP(e,t){if(e){if(typeof e=="string")return Cb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cb(e,t)}}function Cb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function oP(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,f,m=[],_=!0,b=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);_=!0);}catch(A){b=!0,a=A}finally{try{if(!_&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw a}}return m}}function aP(e){if(Array.isArray(e))return e}var cL=null;function cv(e){"@babel/helpers - typeof";return cv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cv(e)}var hL=null;function Rb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function fL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Rb(Object(r),!0).forEach(function(i){sP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rb(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function sP(e,t,r){return t=uP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uP(e){var t=lP(e,"string");return cv(t)==="symbol"?t:String(t)}function lP(e,t){if(cv(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(cv(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pL(e,t){if(e==null)return{};var r=cP(e,t),i,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)i=u[a],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function cP(e,t){if(e==null)return{};var r={},i=Object.keys(e),a,u;for(u=0;u<i.length;u++)a=i[u],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}var dL={exportImage:E2,fullscreen:T2,geoLocate:A2,layer:F0,layerSwitch:F0,logo:N0,mapTheme:C2,mouseLocation:R2,zoom:kC,scale:I2},mL=null,Ib=H(30967);function Mb(e,t){return dP(e)||pP(e,t)||fP(e,t)||hP()}function hP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fP(e,t){if(e){if(typeof e=="string")return Ob(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ob(e,t)}}function Ob(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function pP(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,f,m=[],_=!0,b=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);_=!0);}catch(A){b=!0,a=A}finally{try{if(!_&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw a}}return m}}function dP(e){if(Array.isArray(e))return e}var Pb=ze.useEffect,Lb=ze.useState,mP=/\B([A-Z])/g,vP=function(t){return t.replace(mP,"-$1").toLowerCase()};function vL(e){var t=e.className,r=e.style,i=e.children,a=e.position,u=Lb(),f=Mb(u,2),m=f[0],_=f[1],b=useSceneValue(),A=Lb(function(){return document.createElement("div")}),C=Mb(A,1),R=C[0];return Pb(function(){var U=new Control({position:a});return U.onAdd=function(){if(t&&(R.className=t),r){var X=Object.keys(r).map(function(ee){return"".concat(vP(ee),":").concat(r[ee])}).join(";");R.style.cssText=X}return R},U.onRemove=function(){},_(U),b.addControl(U),function(){b.removeControl(U)}},[]),Pb(function(){m&&m.setPosition(a||"bottomleft")},[a]),createPortal(i,R)}var Db=(0,ze.createContext)({});function gL(){return useContext(Db)}var gP=ze.memo(function(t){var r=t.layer,i=t.active;return r.active(i.option),null},pa()),_P=ze.memo(function(t){var r=t.layer,i=t.animate;return r.animate(i),null},pa()),yP=ze.memo(function(t){var r=t.layer,i=t.color;return i.field?r.color(i.field,i.values):r.color(i.values),null},pa()),xP=ze.memo(function(t){var r=t.layer,i=t.filter;return i.field&&r.filter(i.field,i.values),null},pa()),bP=ze.memo(function(t){var r=t.layer,i=t.scale;return r.scale(i.values),null},pa()),EP=ze.memo(function(t){var r=t.layer,i=t.select;return r.select(i.option),null},pa()),TP=ze.memo(function(t){var r=t.layer,i=t.shape;return i.field?r.shape(i.field,i.values):r.shape(i.values),null},pa()),AP=ze.memo(function(t){var r=t.layer,i=t.size;return i.field?r.size(i.field,i.values):r.size(i.values),null},pa()),SP=["data"];function wP(e,t){if(e==null)return{};var r=CP(e,t),i,a;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(a=0;a<u.length;a++)i=u[a],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function CP(e,t){if(e==null)return{};var r={},i=Object.keys(e),a,u;for(u=0;u<i.length;u++)a=i[u],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}var RP=ze.memo(function(t){var r=t.layer,i=t.source,a=i.data,u=wP(i,SP);return r.inited?r.setData(a,u):r.source(a,u),u.autoFit&&r.fitBounds(u&&u.fitBoundsOptions),null},pa()),_L=ze.useEffect,IP=ze.memo(function(t){var r=t.layer,i=t.style;return r.style(i),null},pa());function MP(e,t){return DP(e)||LP(e,t)||PP(e,t)||OP()}function OP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PP(e,t){if(e){if(typeof e=="string")return Bb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bb(e,t)}}function Bb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function LP(e,t){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,a,u,f,m=[],_=!0,b=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;_=!1}else for(;!(_=(i=u.call(r)).done)&&(m.push(i.value),m.length!==t);_=!0);}catch(A){b=!0,a=A}finally{try{if(!_&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(b)throw a}}return m}}function DP(e){if(Array.isArray(e))return e}var hv=ze.useEffect,BP=ze.useState;function Fb(e,t){var r=t.source,i=t.color,a=t.shape,u=t.style,f=t.size,m=t.scale,_=t.active,b=t.select,A=t.filter,C=t.animate,R=t.options,U=t.onLayerLoaded,X=v(),ee=BP(function(){var Ne;switch(e){case"polygonLayer":Ne=new dg(R);break;case"lineLayer":Ne=new F_(R);break;case"pointLayer":Ne=new pg(R);break;case"heatmapLayer":Ne=new g3(R);break;case"rasterLayer":Ne=new mg(R);break;case"imageLayer":Ne=new B1(R);break;case"citybuildingLayer":Ne=new $S(R);break;default:Ne=new dg(R)}return Ne.on("inited",function(){U&&U(Ne,X)}),Ne}),xe=MP(ee,1),ke=xe[0];return hv(function(){return X.addLayer(ke),function(){X.removeLayer(ke)}},[]),hv(function(){ke.inited&&R&&ke.updateLayerConfig(R)},[R==null?void 0:R.minZoom,R==null?void 0:R.maxZoom,R==null?void 0:R.visible]),hv(function(){ke.inited&&(R!=null&&R.zIndex)&&ke.setIndex(R.zIndex)},[R==null?void 0:R.zIndex]),hv(function(){ke.inited&&(R!=null&&R.blend)&&ke.setBlend(R.blend)},[R==null?void 0:R.blend]),hv(function(){X.render()}),ze.createElement(Db.Provider,{value:ke},ze.createElement(RP,{layer:ke,source:r}),m&&ze.createElement(bP,{layer:ke,scale:m}),i&&ze.createElement(yP,{layer:ke,color:i}),f&&ze.createElement(AP,{layer:ke,size:f}),a&&ze.createElement(TP,{layer:ke,shape:a}),u&&ze.createElement(IP,{layer:ke,style:u}),_&&ze.createElement(gP,{layer:ke,active:_}),b&&ze.createElement(EP,{layer:ke,select:b}),A&&ze.createElement(xP,{layer:ke,filter:A}),C&&ze.createElement(_P,{layer:ke,animate:C}),t.children)}var yL=null,xL=null,FP=ze.memo(function(t){return Fb("pointLayer",t)}),NP=ze.memo(function(t){return Fb("heatmapLayer",t)}),bL=null,EL=null,TL=null,AL=ze.useEffect,SL=null,wL=null;function Gd(e){"@babel/helpers - typeof";return Gd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gd(e)}function Nb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,i)}return r}function jg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Nb(Object(r),!0).forEach(function(i){UP(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nb(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function UP(e,t,r){return t=kb(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kP(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ub(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,kb(i.key),i)}}function zP(e,t,r){return t&&Ub(e.prototype,t),r&&Ub(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function kb(e){var t=VP(e,"string");return Gd(t)==="symbol"?t:String(t)}function VP(e,t){if(Gd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Gd(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ZP(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&e0(e,t)}function e0(e,t){return e0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},e0(e,t)}function jP(e){var t=WP();return function(){var i=Hg(e),a;if(t){var u=Hg(this).constructor;a=Reflect.construct(i,arguments,u)}else a=i.apply(this,arguments);return HP(this,a)}}function HP(e,t){if(t&&(Gd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return XP(e)}function XP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function WP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Hg(e){return Hg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Hg(e)}var CL=function(e){ZP(r,e);var t=jP(r);function r(i){var a;return kP(this,r),a=t.call(this,i),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return zP(r,[{key:"componentDidMount",value:function(){var a,u=this.props,f=u.lnglat,m=u.children,_=u.option,b=u.lngLat,A=new nx(jg(jg({},_),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));f&&A.setLnglat(f),b&&A.setLnglat(b),m&&A.setHTML(this.el),this.popup=A,this.scene.addPopup(A)}},{key:"componentDidUpdate",value:function(a){var u,f,m,_,b,A,C=Array.isArray(a.lnglat)?a.lnglat:[a==null||(u=a.lnglat)===null||u===void 0?void 0:u.lng,a==null||(f=a.lnglat)===null||f===void 0?void 0:f.lat],R=Array.isArray(this.props.lnglat)?this.props.lnglat:[(m=this.props)===null||m===void 0||(_=m.lnglat)===null||_===void 0?void 0:_.lng,(b=this.props)===null||b===void 0||(A=b.lnglat)===null||A===void 0?void 0:A.lat],U=C.toString()!==R.toString();if(U){var X;this.popup.remove(),this.popup=new nx(jg(jg({},this.props.option),{},{stopPropagation:(X=this.props.option)===null||X===void 0?void 0:X.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return ze.createElement(qe.Consumer,{},function(u){return u&&(a.scene=u),(0,Ib.createPortal)(a.props.children,a.el)})}}]),r}(ze.PureComponent);function Yd(e){"@babel/helpers - typeof";return Yd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yd(e)}function GP(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zb(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,qP(i.key),i)}}function YP(e,t,r){return t&&zb(e.prototype,t),r&&zb(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function qP(e){var t=KP(e,"string");return Yd(t)==="symbol"?t:String(t)}function KP(e,t){if(Yd(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Yd(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $P(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&t0(e,t)}function t0(e,t){return t0=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},t0(e,t)}function QP(e){var t=t4();return function(){var i=Xg(e),a;if(t){var u=Xg(this).constructor;a=Reflect.construct(i,arguments,u)}else a=i.apply(this,arguments);return JP(this,a)}}function JP(e,t){if(t&&(Yd(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return e4(e)}function e4(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function t4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Xg(e){return Xg=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Xg(e)}var RL=function(e){$P(r,e);var t=QP(r);function r(i){var a;return GP(this,r),a=t.call(this,i),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return YP(r,[{key:"componentDidMount",value:function(){var a=this.props,u=a.lnglat,f=a.children,m=a.option,_=a.onMarkerLoaded,b=new _2(m);u&&b.setLnglat(u),f&&b.setElement(this.el),this.marker=b,_&&_(b),this.scene.addMarker(b)}},{key:"componentDidUpdate",value:function(a){var u,f=JSON.stringify(a==null?void 0:a.lnglat)!==JSON.stringify((u=this.props)===null||u===void 0?void 0:u.lnglat);f&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return ze.createElement(qe.Consumer,{},function(u){return u&&(a.scene=u),(0,Ib.createPortal)(a.props.children,a.el)})}}]),r}(ze.PureComponent),IL=ze.useEffect,ML=null,OL=null,PL=ze.useEffect,LL=null},1602:function(){},47903:function(pr){pr.exports=Gt;function Gt(qe,v){var at=qe&&qe.type,G;if(at==="FeatureCollection")for(G=0;G<qe.features.length;G++)Gt(qe.features[G],v);else if(at==="GeometryCollection")for(G=0;G<qe.geometries.length;G++)Gt(qe.geometries[G],v);else if(at==="Feature")Gt(qe.geometry,v);else if(at==="Polygon")H(qe.coordinates,v);else if(at==="MultiPolygon")for(G=0;G<qe.coordinates.length;G++)H(qe.coordinates[G],v);return qe}function H(qe,v){if(qe.length!==0){ze(qe[0],v);for(var at=1;at<qe.length;at++)ze(qe[at],!v)}}function ze(qe,v){for(var at=0,G=0,Je=0,Oe=qe.length,yt=Oe-1;Je<Oe;yt=Je++){var Re=(qe[Je][0]-qe[yt][0])*(qe[yt][1]+qe[Je][1]),zt=at+Re;G+=Math.abs(at)>=Math.abs(Re)?at-zt+Re:Re-zt+at,at=zt}at+G>=0!=!!v&&qe.reverse()}},96542:function(pr){"use strict";pr.exports=Gt;function Gt(H,ze){this.x=H,this.y=ze}Gt.prototype={clone:function(){return new Gt(this.x,this.y)},add:function(H){return this.clone()._add(H)},sub:function(H){return this.clone()._sub(H)},multByPoint:function(H){return this.clone()._multByPoint(H)},divByPoint:function(H){return this.clone()._divByPoint(H)},mult:function(H){return this.clone()._mult(H)},div:function(H){return this.clone()._div(H)},rotate:function(H){return this.clone()._rotate(H)},rotateAround:function(H,ze){return this.clone()._rotateAround(H,ze)},matMult:function(H){return this.clone()._matMult(H)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(H){return this.x===H.x&&this.y===H.y},dist:function(H){return Math.sqrt(this.distSqr(H))},distSqr:function(H){var ze=H.x-this.x,qe=H.y-this.y;return ze*ze+qe*qe},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(H){return Math.atan2(this.y-H.y,this.x-H.x)},angleWith:function(H){return this.angleWithSep(H.x,H.y)},angleWithSep:function(H,ze){return Math.atan2(this.x*ze-this.y*H,this.x*H+this.y*ze)},_matMult:function(H){var ze=H[0]*this.x+H[1]*this.y,qe=H[2]*this.x+H[3]*this.y;return this.x=ze,this.y=qe,this},_add:function(H){return this.x+=H.x,this.y+=H.y,this},_sub:function(H){return this.x-=H.x,this.y-=H.y,this},_mult:function(H){return this.x*=H,this.y*=H,this},_div:function(H){return this.x/=H,this.y/=H,this},_multByPoint:function(H){return this.x*=H.x,this.y*=H.y,this},_divByPoint:function(H){return this.x/=H.x,this.y/=H.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var H=this.y;return this.y=this.x,this.x=-H,this},_rotate:function(H){var ze=Math.cos(H),qe=Math.sin(H),v=ze*this.x-qe*this.y,at=qe*this.x+ze*this.y;return this.x=v,this.y=at,this},_rotateAround:function(H,ze){var qe=Math.cos(H),v=Math.sin(H),at=ze.x+qe*(this.x-ze.x)-v*(this.y-ze.y),G=ze.y+v*(this.x-ze.x)+qe*(this.y-ze.y);return this.x=at,this.y=G,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Gt.convert=function(H){return H instanceof Gt?H:Array.isArray(H)?new Gt(H[0],H[1]):H}},25865:function(pr){"use strict";pr.exports=H,pr.exports.default=H;var Gt=1e20;function H(G,Je,Oe,yt,Re,zt){this.fontSize=G||24,this.buffer=Je===void 0?3:Je,this.cutoff=yt||.25,this.fontFamily=Re||"sans-serif",this.fontWeight=zt||"normal",this.radius=Oe||8;var ct=this.size=this.fontSize+this.buffer*2,st=ct+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=ct,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(st*st),this.gridInner=new Float64Array(st*st),this.f=new Float64Array(st),this.z=new Float64Array(st+1),this.v=new Uint16Array(st),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(ct/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ze(G,Je,Oe,yt,Re,zt,ct){zt.fill(Gt,0,Je*Oe),ct.fill(0,0,Je*Oe);for(var st=(Je-yt)/2,qt=0;qt<Re;qt++)for(var Yt=0;Yt<yt;Yt++){var ir=(qt+st)*Je+Yt+st,or=G.data[4*(qt*yt+Yt)+3]/255;if(or===1)zt[ir]=0,ct[ir]=Gt;else if(or===0)zt[ir]=Gt,ct[ir]=0;else{var Sr=Math.max(0,.5-or),_r=Math.max(0,or-.5);zt[ir]=Sr*Sr,ct[ir]=_r*_r}}}function qe(G,Je,Oe,yt,Re,zt,ct){for(var st=0;st<Je*Oe;st++){var qt=Math.sqrt(yt[st])-Math.sqrt(Re[st]);G[st]=Math.round(255-255*(qt/zt+ct))}}H.prototype._draw=function(G,Je){var Oe=this.ctx.measureText(G),yt=Oe.width,Re=2*this.buffer,zt,ct,st,qt,Yt,ir,or,Sr;Je&&this.useMetrics?(Yt=Math.floor(Oe.actualBoundingBoxAscent),Sr=this.buffer+Math.ceil(Oe.actualBoundingBoxAscent),ir=this.buffer,or=this.buffer,ct=Math.min(this.size,Math.ceil(Oe.actualBoundingBoxRight-Oe.actualBoundingBoxLeft)),qt=Math.min(this.size-ir,Math.ceil(Oe.actualBoundingBoxAscent+Oe.actualBoundingBoxDescent)),zt=ct+Re,st=qt+Re,this.ctx.textBaseline="alphabetic"):(zt=ct=this.size,st=qt=this.size,Yt=19*this.fontSize/24,ir=or=0,Sr=this.middle,this.ctx.textBaseline="middle");var _r;ct&&qt&&(this.ctx.clearRect(or,ir,ct,qt),this.ctx.fillText(G,this.buffer,Sr),_r=this.ctx.getImageData(or,ir,ct,qt));var Gr=new Uint8ClampedArray(zt*st);return ze(_r,zt,st,ct,qt,this.gridOuter,this.gridInner),v(this.gridOuter,zt,st,this.f,this.v,this.z),v(this.gridInner,zt,st,this.f,this.v,this.z),qe(Gr,zt,st,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Gr,metrics:{width:ct,height:qt,sdfWidth:zt,sdfHeight:st,top:Yt,left:0,advance:yt}}},H.prototype.draw=function(G){return this._draw(G,!1).data},H.prototype.drawWithMetrics=function(G){return this._draw(G,!0)};function v(G,Je,Oe,yt,Re,zt){for(var ct=0;ct<Je;ct++)at(G,ct,Je,Oe,yt,Re,zt);for(var st=0;st<Oe;st++)at(G,st*Je,1,Je,yt,Re,zt)}function at(G,Je,Oe,yt,Re,zt,ct){var st,qt,Yt,ir;for(zt[0]=0,ct[0]=-Gt,ct[1]=Gt,st=0;st<yt;st++)Re[st]=G[Je+st*Oe];for(st=1,qt=0,Yt=0;st<yt;st++){do ir=zt[qt],Yt=(Re[st]-Re[ir]+st*st-ir*ir)/(st-ir)/2;while(Yt<=ct[qt]&&--qt>-1);qt++,zt[qt]=st,ct[qt]=Yt,ct[qt+1]=Gt}for(st=0,qt=0;st<yt;st++){for(;ct[qt+1]<st;)qt++;ir=zt[qt],G[Je+st*Oe]=Re[ir]+(st-ir)*(st-ir)}}},99996:function(pr,Gt,H){pr.exports.VectorTile=H(14253),H(35752),H(143)},14253:function(pr,Gt,H){"use strict";var ze=H(143);pr.exports=qe;function qe(at,G){this.layers=at.readFields(v,{},G)}function v(at,G,Je){if(at===3){var Oe=new ze(Je,Je.readVarint()+Je.pos);Oe.length&&(G[Oe.name]=Oe)}}},35752:function(pr,Gt,H){"use strict";var ze=H(96542);pr.exports=qe;function qe(Oe,yt,Re,zt,ct){this.properties={},this.extent=Re,this.type=0,this._pbf=Oe,this._geometry=-1,this._keys=zt,this._values=ct,Oe.readFields(v,this,yt)}function v(Oe,yt,Re){Oe==1?yt.id=Re.readVarint():Oe==2?at(Re,yt):Oe==3?yt.type=Re.readVarint():Oe==4&&(yt._geometry=Re.pos)}function at(Oe,yt){for(var Re=Oe.readVarint()+Oe.pos;Oe.pos<Re;){var zt=yt._keys[Oe.readVarint()],ct=yt._values[Oe.readVarint()];yt.properties[zt]=ct}}qe.types=["Unknown","Point","LineString","Polygon"],qe.prototype.loadGeometry=function(){var Oe=this._pbf;Oe.pos=this._geometry;for(var yt=Oe.readVarint()+Oe.pos,Re=1,zt=0,ct=0,st=0,qt=[],Yt;Oe.pos<yt;){if(zt<=0){var ir=Oe.readVarint();Re=ir&7,zt=ir>>3}if(zt--,Re===1||Re===2)ct+=Oe.readSVarint(),st+=Oe.readSVarint(),Re===1&&(Yt&&qt.push(Yt),Yt=[]),Yt.push(new ze(ct,st));else if(Re===7)Yt&&Yt.push(Yt[0].clone());else throw new Error("unknown command "+Re)}return Yt&&qt.push(Yt),qt},qe.prototype.bbox=function(){var Oe=this._pbf;Oe.pos=this._geometry;for(var yt=Oe.readVarint()+Oe.pos,Re=1,zt=0,ct=0,st=0,qt=1/0,Yt=-1/0,ir=1/0,or=-1/0;Oe.pos<yt;){if(zt<=0){var Sr=Oe.readVarint();Re=Sr&7,zt=Sr>>3}if(zt--,Re===1||Re===2)ct+=Oe.readSVarint(),st+=Oe.readSVarint(),ct<qt&&(qt=ct),ct>Yt&&(Yt=ct),st<ir&&(ir=st),st>or&&(or=st);else if(Re!==7)throw new Error("unknown command "+Re)}return[qt,ir,Yt,or]},qe.prototype.toGeoJSON=function(Oe,yt,Re){var zt=this.extent*Math.pow(2,Re),ct=this.extent*Oe,st=this.extent*yt,qt=this.loadGeometry(),Yt=qe.types[this.type],ir,or;function Sr(vn){for(var ii=0;ii<vn.length;ii++){var Yn=vn[ii],xt=180-(Yn.y+st)*360/zt;vn[ii]=[(Yn.x+ct)*360/zt-180,360/Math.PI*Math.atan(Math.exp(xt*Math.PI/180))-90]}}switch(this.type){case 1:var _r=[];for(ir=0;ir<qt.length;ir++)_r[ir]=qt[ir][0];qt=_r,Sr(qt);break;case 2:for(ir=0;ir<qt.length;ir++)Sr(qt[ir]);break;case 3:for(qt=G(qt),ir=0;ir<qt.length;ir++)for(or=0;or<qt[ir].length;or++)Sr(qt[ir][or]);break}qt.length===1?qt=qt[0]:Yt="Multi"+Yt;var Gr={type:"Feature",geometry:{type:Yt,coordinates:qt},properties:this.properties};return"id"in this&&(Gr.id=this.id),Gr};function G(Oe){var yt=Oe.length;if(yt<=1)return[Oe];for(var Re=[],zt,ct,st=0;st<yt;st++){var qt=Je(Oe[st]);qt!==0&&(ct===void 0&&(ct=qt<0),ct===qt<0?(zt&&Re.push(zt),zt=[Oe[st]]):zt.push(Oe[st]))}return zt&&Re.push(zt),Re}function Je(Oe){for(var yt=0,Re=0,zt=Oe.length,ct=zt-1,st,qt;Re<zt;ct=Re++)st=Oe[Re],qt=Oe[ct],yt+=(qt.x-st.x)*(st.y+qt.y);return yt}},143:function(pr,Gt,H){"use strict";var ze=H(35752);pr.exports=qe;function qe(G,Je){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=G,this._keys=[],this._values=[],this._features=[],G.readFields(v,this,Je),this.length=this._features.length}function v(G,Je,Oe){G===15?Je.version=Oe.readVarint():G===1?Je.name=Oe.readString():G===5?Je.extent=Oe.readVarint():G===2?Je._features.push(Oe.pos):G===3?Je._keys.push(Oe.readString()):G===4&&Je._values.push(at(Oe))}function at(G){for(var Je=null,Oe=G.readVarint()+G.pos;G.pos<Oe;){var yt=G.readVarint()>>3;Je=yt===1?G.readString():yt===2?G.readFloat():yt===3?G.readDouble():yt===4?G.readVarint64():yt===5?G.readVarint():yt===6?G.readSVarint():yt===7?G.readBoolean():null}return Je}qe.prototype.feature=function(G){if(G<0||G>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[G];var Je=this._pbf.readVarint()+this._pbf.pos;return new ze(this._pbf,Je,this.extent,this._keys,this._values)}},57228:function(pr,Gt,H){"use strict";H.d(Gt,{Z:function(){return W}});var ze=H(75271),qe=H(22217),v=H(49975),at=H(89519),G=H(47490),Je=H(82187),Oe=H.n(Je),yt=H(71305),Re=H(94212),zt=H(90029),st=he=>{const{value:ae,formatter:Me,precision:je,decimalSeparator:ut,groupSeparator:St="",prefixCls:bt}=he;let Lr;if(typeof Me=="function")Lr=Me(ae);else{const Cr=String(ae),On=Cr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!On||Cr==="-")Lr=Cr;else{const Xr=On[1];let xn=On[2]||"0",Yr=On[4]||"";xn=xn.replace(/\B(?=(\d{3})+(?!\d))/g,St),typeof je=="number"&&(Yr=Yr.padEnd(je,"0").slice(0,je>0?je:0)),Yr&&(Yr=`${ut}${Yr}`),Lr=[ze.createElement("span",{key:"int",className:`${bt}-content-value-int`},Xr,xn),Yr&&ze.createElement("span",{key:"decimal",className:`${bt}-content-value-decimal`},Yr)]}}return ze.createElement("span",{className:`${bt}-content-value`},Lr)},qt=H(25519),Yt=H(24410),ir=H(83509);const or=he=>{const{componentCls:ae,marginXXS:Me,padding:je,colorTextDescription:ut,titleFontSize:St,colorTextHeading:bt,contentFontSize:Lr,fontFamily:Cr}=he;return{[ae]:Object.assign(Object.assign({},(0,qt.Wf)(he)),{[`${ae}-title`]:{marginBottom:Me,color:ut,fontSize:St},[`${ae}-skeleton`]:{paddingTop:je},[`${ae}-content`]:{color:bt,fontSize:Lr,fontFamily:Cr,[`${ae}-content-value`]:{display:"inline-block",direction:"ltr"},[`${ae}-content-prefix, ${ae}-content-suffix`]:{display:"inline-block"},[`${ae}-content-prefix`]:{marginInlineEnd:Me},[`${ae}-content-suffix`]:{marginInlineStart:Me}}})}},Sr=he=>{const{fontSizeHeading3:ae,fontSize:Me}=he;return{titleFontSize:Me,contentFontSize:ae}};var _r=(0,Yt.I$)("Statistic",he=>{const ae=(0,ir.IX)(he,{});return[or(ae)]},Sr),Gr=function(he,ae){var Me={};for(var je in he)Object.prototype.hasOwnProperty.call(he,je)&&ae.indexOf(je)<0&&(Me[je]=he[je]);if(he!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ut=0,je=Object.getOwnPropertySymbols(he);ut<je.length;ut++)ae.indexOf(je[ut])<0&&Object.prototype.propertyIsEnumerable.call(he,je[ut])&&(Me[je[ut]]=he[je[ut]]);return Me},ii=he=>{const{prefixCls:ae,className:Me,rootClassName:je,style:ut,valueStyle:St,value:bt=0,title:Lr,valueRender:Cr,prefix:On,suffix:Xr,loading:xn=!1,formatter:Yr,precision:rn,decimalSeparator:Kr=".",groupSeparator:Qn=",",onMouseEnter:Ur,onMouseLeave:Mn}=he,$r=Gr(he,["prefixCls","className","rootClassName","style","valueStyle","value","title","valueRender","prefix","suffix","loading","formatter","precision","decimalSeparator","groupSeparator","onMouseEnter","onMouseLeave"]),{getPrefixCls:un,direction:zi,className:gi,style:_o}=(0,Re.dj)("statistic"),Ii=un("statistic",ae),[ie,Wi,Ji]=_r(Ii),to=ze.createElement(st,{decimalSeparator:Kr,groupSeparator:Qn,prefixCls:Ii,formatter:Yr,precision:rn,value:bt}),aa=Oe()(Ii,{[`${Ii}-rtl`]:zi==="rtl"},gi,Me,je,Wi,Ji),ea=(0,yt.Z)($r,{aria:!0,data:!0});return ie(ze.createElement("div",Object.assign({},ea,{className:aa,style:Object.assign(Object.assign({},_o),ut),onMouseEnter:Ur,onMouseLeave:Mn}),Lr&&ze.createElement("div",{className:`${Ii}-title`},Lr),ze.createElement(zt.Z,{paragraph:!1,loading:xn,className:`${Ii}-skeleton`},ze.createElement("div",{style:St,className:`${Ii}-content`},On&&ze.createElement("span",{className:`${Ii}-content-prefix`},On),Cr?Cr(to):to,Xr&&ze.createElement("span",{className:`${Ii}-content-suffix`},Xr)))))};const Yn=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function xt(he,ae){let Me=he;const je=/\[[^\]]*]/g,ut=(ae.match(je)||[]).map(Cr=>Cr.slice(1,-1)),St=ae.replace(je,"[]"),bt=Yn.reduce((Cr,On)=>{let[Xr,xn]=On;if(Cr.includes(Xr)){const Yr=Math.floor(Me/xn);return Me-=Yr*xn,Cr.replace(new RegExp(`${Xr}+`,"g"),rn=>{const Kr=rn.length;return Yr.toString().padStart(Kr,"0")})}return Cr},St);let Lr=0;return bt.replace(je,()=>{const Cr=ut[Lr];return Lr+=1,Cr})}function Pe(he,ae,Me){const{format:je=""}=ae,ut=new Date(he).getTime(),St=Date.now(),bt=Math.max(Me?ut-St:St-ut,0);return xt(bt,je)}var Ft=function(he,ae){var Me={};for(var je in he)Object.prototype.hasOwnProperty.call(he,je)&&ae.indexOf(je)<0&&(Me[je]=he[je]);if(he!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ut=0,je=Object.getOwnPropertySymbols(he);ut<je.length;ut++)ae.indexOf(je[ut])<0&&Object.prototype.propertyIsEnumerable.call(he,je[ut])&&(Me[je[ut]]=he[je[ut]]);return Me};function tt(he){return new Date(he).getTime()}var wr=he=>{const{value:ae,format:Me="HH:mm:ss",onChange:je,onFinish:ut,type:St}=he,bt=Ft(he,["value","format","onChange","onFinish","type"]),Lr=St==="countdown",Cr=(0,at.Z)(),On=(0,qe.zX)(()=>{const Yr=Date.now(),rn=tt(ae);Cr();const Kr=Lr?rn-Yr:Yr-rn;return je==null||je(Kr),Lr&&rn<Yr?(ut==null||ut(),!1):!0});ze.useEffect(()=>{let Yr;const rn=()=>v.Z.cancel(Yr),Kr=()=>{Yr=(0,v.Z)(()=>{On()&&Kr()})};return Kr(),rn},[ae,Lr]);const Xr=(Yr,rn)=>Pe(Yr,Object.assign(Object.assign({},rn),{format:Me}),Lr),xn=Yr=>(0,G.Tm)(Yr,{title:void 0});return ze.createElement(ii,Object.assign({},bt,{value:ae,valueRender:xn,formatter:Xr}))};const $=he=>ze.createElement(wr,Object.assign({},he,{type:"countdown"}));var me=ze.memo($);ii.Timer=wr,ii.Countdown=me;var W=ii},20300:function(pr,Gt,H){"use strict";var ze=H(56906);pr.exports=function(at){at=at||{};var G=at.reporter,Je=ze.getOption(at,"async",!0),Oe=ze.getOption(at,"auto",!0);Oe&&!Je&&(G&&G.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),Je=!0);var yt=qe(),Re,zt=!1;function ct(_r,Gr){!zt&&Oe&&Je&&yt.size()===0&&Yt(),yt.add(_r,Gr)}function st(){for(zt=!0;yt.size();){var _r=yt;yt=qe(),_r.process()}zt=!1}function qt(_r){zt||(_r===void 0&&(_r=Je),Re&&(or(Re),Re=null),_r?Yt():st())}function Yt(){Re=Sr(st)}function ir(){yt={},batchSize=0,topLevel=0,bottomLevel=0}function or(_r){var Gr=clearTimeout;return Gr(_r)}function Sr(_r){var Gr=function(vn){return setTimeout(vn,0)};return Gr(_r)}return{add:ct,force:qt}};function qe(){var v={},at=0,G=0,Je=0;function Oe(zt,ct){ct||(ct=zt,zt=0),zt>G?G=zt:zt<Je&&(Je=zt),v[zt]||(v[zt]=[]),v[zt].push(ct),at++}function yt(){for(var zt=Je;zt<=G;zt++)for(var ct=v[zt],st=0;st<ct.length;st++){var qt=ct[st];qt()}}function Re(){return at}return{add:Oe,process:yt,size:Re}}},56906:function(pr){"use strict";var Gt=pr.exports={};Gt.getOption=H;function H(ze,qe,v){var at=ze[qe];return at==null&&v!==void 0?v:at}},75734:function(pr){"use strict";pr.exports=Gt,pr.exports.default=Gt;function Gt(W,he,ae){ae=ae||2;var Me=he&&he.length,je=Me?he[0]*ae:W.length,ut=H(W,0,je,ae,!0),St=[];if(!ut||ut.next===ut.prev)return St;var bt,Lr,Cr,On,Xr,xn,Yr;if(Me&&(ut=Oe(W,he,ut,ae)),W.length>80*ae){bt=Cr=W[0],Lr=On=W[1];for(var rn=ae;rn<je;rn+=ae)Xr=W[rn],xn=W[rn+1],Xr<bt&&(bt=Xr),xn<Lr&&(Lr=xn),Xr>Cr&&(Cr=Xr),xn>On&&(On=xn);Yr=Math.max(Cr-bt,On-Lr),Yr=Yr!==0?32767/Yr:0}return qe(ut,St,ae,bt,Lr,Yr,0),St}function H(W,he,ae,Me,je){var ut,St;if(je===me(W,he,ae,Me)>0)for(ut=he;ut<ae;ut+=Me)St=Jt(ut,W[ut],W[ut+1],St);else for(ut=ae-Me;ut>=he;ut-=Me)St=Jt(ut,W[ut],W[ut+1],St);return St&&Gr(St,St.next)&&(wr(St),St=St.next),St}function ze(W,he){if(!W)return W;he||(he=W);var ae=W,Me;do if(Me=!1,!ae.steiner&&(Gr(ae,ae.next)||_r(ae.prev,ae,ae.next)===0)){if(wr(ae),ae=he=ae.prev,ae===ae.next)break;Me=!0}else ae=ae.next;while(Me||ae!==he);return he}function qe(W,he,ae,Me,je,ut,St){if(W){!St&&ut&&st(W,Me,je,ut);for(var bt=W,Lr,Cr;W.prev!==W.next;){if(Lr=W.prev,Cr=W.next,ut?at(W,Me,je,ut):v(W)){he.push(Lr.i/ae|0),he.push(W.i/ae|0),he.push(Cr.i/ae|0),wr(W),W=Cr.next,bt=Cr.next;continue}if(W=Cr,W===bt){St?St===1?(W=G(ze(W),he,ae),qe(W,he,ae,Me,je,ut,2)):St===2&&Je(W,he,ae,Me,je,ut):qe(ze(W),he,ae,Me,je,ut,1);break}}}}function v(W){var he=W.prev,ae=W,Me=W.next;if(_r(he,ae,Me)>=0)return!1;for(var je=he.x,ut=ae.x,St=Me.x,bt=he.y,Lr=ae.y,Cr=Me.y,On=je<ut?je<St?je:St:ut<St?ut:St,Xr=bt<Lr?bt<Cr?bt:Cr:Lr<Cr?Lr:Cr,xn=je>ut?je>St?je:St:ut>St?ut:St,Yr=bt>Lr?bt>Cr?bt:Cr:Lr>Cr?Lr:Cr,rn=Me.next;rn!==he;){if(rn.x>=On&&rn.x<=xn&&rn.y>=Xr&&rn.y<=Yr&&or(je,bt,ut,Lr,St,Cr,rn.x,rn.y)&&_r(rn.prev,rn,rn.next)>=0)return!1;rn=rn.next}return!0}function at(W,he,ae,Me){var je=W.prev,ut=W,St=W.next;if(_r(je,ut,St)>=0)return!1;for(var bt=je.x,Lr=ut.x,Cr=St.x,On=je.y,Xr=ut.y,xn=St.y,Yr=bt<Lr?bt<Cr?bt:Cr:Lr<Cr?Lr:Cr,rn=On<Xr?On<xn?On:xn:Xr<xn?Xr:xn,Kr=bt>Lr?bt>Cr?bt:Cr:Lr>Cr?Lr:Cr,Qn=On>Xr?On>xn?On:xn:Xr>xn?Xr:xn,Ur=Yt(Yr,rn,he,ae,Me),Mn=Yt(Kr,Qn,he,ae,Me),$r=W.prevZ,un=W.nextZ;$r&&$r.z>=Ur&&un&&un.z<=Mn;){if($r.x>=Yr&&$r.x<=Kr&&$r.y>=rn&&$r.y<=Qn&&$r!==je&&$r!==St&&or(bt,On,Lr,Xr,Cr,xn,$r.x,$r.y)&&_r($r.prev,$r,$r.next)>=0||($r=$r.prevZ,un.x>=Yr&&un.x<=Kr&&un.y>=rn&&un.y<=Qn&&un!==je&&un!==St&&or(bt,On,Lr,Xr,Cr,xn,un.x,un.y)&&_r(un.prev,un,un.next)>=0))return!1;un=un.nextZ}for(;$r&&$r.z>=Ur;){if($r.x>=Yr&&$r.x<=Kr&&$r.y>=rn&&$r.y<=Qn&&$r!==je&&$r!==St&&or(bt,On,Lr,Xr,Cr,xn,$r.x,$r.y)&&_r($r.prev,$r,$r.next)>=0)return!1;$r=$r.prevZ}for(;un&&un.z<=Mn;){if(un.x>=Yr&&un.x<=Kr&&un.y>=rn&&un.y<=Qn&&un!==je&&un!==St&&or(bt,On,Lr,Xr,Cr,xn,un.x,un.y)&&_r(un.prev,un,un.next)>=0)return!1;un=un.nextZ}return!0}function G(W,he,ae){var Me=W;do{var je=Me.prev,ut=Me.next.next;!Gr(je,ut)&&vn(je,Me,Me.next,ut)&&Pe(je,ut)&&Pe(ut,je)&&(he.push(je.i/ae|0),he.push(Me.i/ae|0),he.push(ut.i/ae|0),wr(Me),wr(Me.next),Me=W=ut),Me=Me.next}while(Me!==W);return ze(Me)}function Je(W,he,ae,Me,je,ut){var St=W;do{for(var bt=St.next.next;bt!==St.prev;){if(St.i!==bt.i&&Sr(St,bt)){var Lr=tt(St,bt);St=ze(St,St.next),Lr=ze(Lr,Lr.next),qe(St,he,ae,Me,je,ut,0),qe(Lr,he,ae,Me,je,ut,0);return}bt=bt.next}St=St.next}while(St!==W)}function Oe(W,he,ae,Me){var je=[],ut,St,bt,Lr,Cr;for(ut=0,St=he.length;ut<St;ut++)bt=he[ut]*Me,Lr=ut<St-1?he[ut+1]*Me:W.length,Cr=H(W,bt,Lr,Me,!1),Cr===Cr.next&&(Cr.steiner=!0),je.push(ir(Cr));for(je.sort(yt),ut=0;ut<je.length;ut++)ae=Re(je[ut],ae);return ae}function yt(W,he){return W.x-he.x}function Re(W,he){var ae=zt(W,he);if(!ae)return he;var Me=tt(ae,W);return ze(Me,Me.next),ze(ae,ae.next)}function zt(W,he){var ae=he,Me=W.x,je=W.y,ut=-1/0,St;do{if(je<=ae.y&&je>=ae.next.y&&ae.next.y!==ae.y){var bt=ae.x+(je-ae.y)*(ae.next.x-ae.x)/(ae.next.y-ae.y);if(bt<=Me&&bt>ut&&(ut=bt,St=ae.x<ae.next.x?ae:ae.next,bt===Me))return St}ae=ae.next}while(ae!==he);if(!St)return null;var Lr=St,Cr=St.x,On=St.y,Xr=1/0,xn;ae=St;do Me>=ae.x&&ae.x>=Cr&&Me!==ae.x&&or(je<On?Me:ut,je,Cr,On,je<On?ut:Me,je,ae.x,ae.y)&&(xn=Math.abs(je-ae.y)/(Me-ae.x),Pe(ae,W)&&(xn<Xr||xn===Xr&&(ae.x>St.x||ae.x===St.x&&ct(St,ae)))&&(St=ae,Xr=xn)),ae=ae.next;while(ae!==Lr);return St}function ct(W,he){return _r(W.prev,W,he.prev)<0&&_r(he.next,W,W.next)<0}function st(W,he,ae,Me){var je=W;do je.z===0&&(je.z=Yt(je.x,je.y,he,ae,Me)),je.prevZ=je.prev,je.nextZ=je.next,je=je.next;while(je!==W);je.prevZ.nextZ=null,je.prevZ=null,qt(je)}function qt(W){var he,ae,Me,je,ut,St,bt,Lr,Cr=1;do{for(ae=W,W=null,ut=null,St=0;ae;){for(St++,Me=ae,bt=0,he=0;he<Cr&&(bt++,Me=Me.nextZ,!!Me);he++);for(Lr=Cr;bt>0||Lr>0&&Me;)bt!==0&&(Lr===0||!Me||ae.z<=Me.z)?(je=ae,ae=ae.nextZ,bt--):(je=Me,Me=Me.nextZ,Lr--),ut?ut.nextZ=je:W=je,je.prevZ=ut,ut=je;ae=Me}ut.nextZ=null,Cr*=2}while(St>1);return W}function Yt(W,he,ae,Me,je){return W=(W-ae)*je|0,he=(he-Me)*je|0,W=(W|W<<8)&16711935,W=(W|W<<4)&252645135,W=(W|W<<2)&858993459,W=(W|W<<1)&1431655765,he=(he|he<<8)&16711935,he=(he|he<<4)&252645135,he=(he|he<<2)&858993459,he=(he|he<<1)&1431655765,W|he<<1}function ir(W){var he=W,ae=W;do(he.x<ae.x||he.x===ae.x&&he.y<ae.y)&&(ae=he),he=he.next;while(he!==W);return ae}function or(W,he,ae,Me,je,ut,St,bt){return(je-St)*(he-bt)>=(W-St)*(ut-bt)&&(W-St)*(Me-bt)>=(ae-St)*(he-bt)&&(ae-St)*(ut-bt)>=(je-St)*(Me-bt)}function Sr(W,he){return W.next.i!==he.i&&W.prev.i!==he.i&&!xt(W,he)&&(Pe(W,he)&&Pe(he,W)&&Ft(W,he)&&(_r(W.prev,W,he.prev)||_r(W,he.prev,he))||Gr(W,he)&&_r(W.prev,W,W.next)>0&&_r(he.prev,he,he.next)>0)}function _r(W,he,ae){return(he.y-W.y)*(ae.x-he.x)-(he.x-W.x)*(ae.y-he.y)}function Gr(W,he){return W.x===he.x&&W.y===he.y}function vn(W,he,ae,Me){var je=Yn(_r(W,he,ae)),ut=Yn(_r(W,he,Me)),St=Yn(_r(ae,Me,W)),bt=Yn(_r(ae,Me,he));return!!(je!==ut&&St!==bt||je===0&&ii(W,ae,he)||ut===0&&ii(W,Me,he)||St===0&&ii(ae,W,Me)||bt===0&&ii(ae,he,Me))}function ii(W,he,ae){return he.x<=Math.max(W.x,ae.x)&&he.x>=Math.min(W.x,ae.x)&&he.y<=Math.max(W.y,ae.y)&&he.y>=Math.min(W.y,ae.y)}function Yn(W){return W>0?1:W<0?-1:0}function xt(W,he){var ae=W;do{if(ae.i!==W.i&&ae.next.i!==W.i&&ae.i!==he.i&&ae.next.i!==he.i&&vn(ae,ae.next,W,he))return!0;ae=ae.next}while(ae!==W);return!1}function Pe(W,he){return _r(W.prev,W,W.next)<0?_r(W,he,W.next)>=0&&_r(W,W.prev,he)>=0:_r(W,he,W.prev)<0||_r(W,W.next,he)<0}function Ft(W,he){var ae=W,Me=!1,je=(W.x+he.x)/2,ut=(W.y+he.y)/2;do ae.y>ut!=ae.next.y>ut&&ae.next.y!==ae.y&&je<(ae.next.x-ae.x)*(ut-ae.y)/(ae.next.y-ae.y)+ae.x&&(Me=!Me),ae=ae.next;while(ae!==W);return Me}function tt(W,he){var ae=new $(W.i,W.x,W.y),Me=new $(he.i,he.x,he.y),je=W.next,ut=he.prev;return W.next=he,he.prev=W,ae.next=je,je.prev=ae,Me.next=ae,ae.prev=Me,ut.next=Me,Me.prev=ut,Me}function Jt(W,he,ae,Me){var je=new $(W,he,ae);return Me?(je.next=Me.next,je.prev=Me,Me.next.prev=je,Me.next=je):(je.prev=je,je.next=je),je}function wr(W){W.next.prev=W.prev,W.prev.next=W.next,W.prevZ&&(W.prevZ.nextZ=W.nextZ),W.nextZ&&(W.nextZ.prevZ=W.prevZ)}function $(W,he,ae){this.i=W,this.x=he,this.y=ae,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Gt.deviation=function(W,he,ae,Me){var je=he&&he.length,ut=je?he[0]*ae:W.length,St=Math.abs(me(W,0,ut,ae));if(je)for(var bt=0,Lr=he.length;bt<Lr;bt++){var Cr=he[bt]*ae,On=bt<Lr-1?he[bt+1]*ae:W.length;St-=Math.abs(me(W,Cr,On,ae))}var Xr=0;for(bt=0;bt<Me.length;bt+=3){var xn=Me[bt]*ae,Yr=Me[bt+1]*ae,rn=Me[bt+2]*ae;Xr+=Math.abs((W[xn]-W[rn])*(W[Yr+1]-W[xn+1])-(W[xn]-W[Yr])*(W[rn+1]-W[xn+1]))}return St===0&&Xr===0?0:Math.abs((Xr-St)/St)};function me(W,he,ae,Me){for(var je=0,ut=he,St=ae-Me;ut<ae;ut+=Me)je+=(W[St]-W[ut])*(W[ut+1]+W[St+1]),St=ut;return je}Gt.flatten=function(W){for(var he=W[0][0].length,ae={vertices:[],holes:[],dimensions:he},Me=0,je=0;je<W.length;je++){for(var ut=0;ut<W[je].length;ut++)for(var St=0;St<he;St++)ae.vertices.push(W[je][ut][St]);je>0&&(Me+=W[je-1].length,ae.holes.push(Me))}return ae}},91895:function(pr){"use strict";var Gt=pr.exports={};Gt.isIE=function(H){function ze(){var v=navigator.userAgent.toLowerCase();return v.indexOf("msie")!==-1||v.indexOf("trident")!==-1||v.indexOf(" edge/")!==-1}if(!ze())return!1;if(!H)return!0;var qe=function(){var v,at=3,G=document.createElement("div"),Je=G.getElementsByTagName("i");do G.innerHTML="<!--[if gt IE "+ ++at+"]><i></i><![endif]-->";while(Je[0]);return at>4?at:v}();return H===qe},Gt.isLegacyOpera=function(){return!!window.opera}},10219:function(pr){"use strict";var Gt=pr.exports={};Gt.forEach=function(H,ze){for(var qe=0;qe<H.length;qe++){var v=ze(H[qe]);if(v)return v}}},90153:function(pr,Gt,H){"use strict";var ze=H(91895);pr.exports=function(qe){qe=qe||{};var v=qe.reporter,at=qe.batchProcessor,G=qe.stateHandler.getState;if(!v)throw new Error("Missing required dependency: reporter.");function Je(ct,st){function qt(){st(ct)}if(ze.isIE(8))G(ct).object={proxy:qt},ct.attachEvent("onresize",qt);else{var Yt=Re(ct);if(!Yt)throw new Error("Element is not detectable by this strategy.");Yt.contentDocument.defaultView.addEventListener("resize",qt)}}function Oe(ct){var st=qe.important?" !important; ":"; ";return(ct.join(st)+st).trim()}function yt(ct,st,qt){qt||(qt=st,st=ct,ct=null),ct=ct||{};var Yt=ct.debug;function ir(or,Sr){var _r=Oe(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),Gr=!1,vn=window.getComputedStyle(or),ii=or.offsetWidth,Yn=or.offsetHeight;G(or).startSize={width:ii,height:Yn};function xt(){function Pe(){if(vn.position==="static"){or.style.setProperty("position","relative",ct.important?"important":"");var Jt=function(wr,$,me,W){function he(Me){return Me.replace(/[^-\d\.]/g,"")}var ae=me[W];ae!=="auto"&&he(ae)!=="0"&&(wr.warn("An element that is positioned static has style."+W+"="+ae+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+W+" will be set to 0. Element: ",$),$.style.setProperty(W,"0",ct.important?"important":""))};Jt(v,or,vn,"top"),Jt(v,or,vn,"right"),Jt(v,or,vn,"bottom"),Jt(v,or,vn,"left")}}function Ft(){Gr||Pe();function Jt($,me){if(!$.contentDocument){var W=G($);W.checkForObjectDocumentTimeoutId&&window.clearTimeout(W.checkForObjectDocumentTimeoutId),W.checkForObjectDocumentTimeoutId=setTimeout(function(){W.checkForObjectDocumentTimeoutId=0,Jt($,me)},100);return}me($.contentDocument)}var wr=this;Jt(wr,function(me){Sr(or)})}vn.position!==""&&(Pe(vn),Gr=!0);var tt=document.createElement("object");tt.style.cssText=_r,tt.tabIndex=-1,tt.type="text/html",tt.setAttribute("aria-hidden","true"),tt.onload=Ft,ze.isIE()||(tt.data="about:blank"),G(or)&&(or.appendChild(tt),G(or).object=tt,ze.isIE()&&(tt.data="about:blank"))}at?at.add(xt):xt()}ze.isIE(8)?qt(st):ir(st,qt)}function Re(ct){return G(ct).object}function zt(ct){if(G(ct)){var st=Re(ct);st&&(ze.isIE(8)?ct.detachEvent("onresize",st.proxy):ct.removeChild(st),G(ct).checkForObjectDocumentTimeoutId&&window.clearTimeout(G(ct).checkForObjectDocumentTimeoutId),delete G(ct).object)}}return{makeDetectable:yt,addListener:Je,uninstall:zt}}},21762:function(pr,Gt,H){"use strict";var ze=H(10219).forEach;pr.exports=function(qe){qe=qe||{};var v=qe.reporter,at=qe.batchProcessor,G=qe.stateHandler.getState,Je=qe.stateHandler.hasState,Oe=qe.idHandler;if(!at)throw new Error("Missing required dependency: batchProcessor");if(!v)throw new Error("Missing required dependency: reporter.");var yt=qt(),Re="erd_scroll_detection_scrollbar_style",zt="erd_scroll_detection_container";function ct(xt){Yt(xt,Re,zt)}ct(window.document);function st(xt){var Pe=qe.important?" !important; ":"; ";return(xt.join(Pe)+Pe).trim()}function qt(){var xt=500,Pe=500,Ft=document.createElement("div");Ft.style.cssText=st(["position: absolute","width: "+xt*2+"px","height: "+Pe*2+"px","visibility: hidden","margin: 0","padding: 0"]);var tt=document.createElement("div");tt.style.cssText=st(["position: absolute","width: "+xt+"px","height: "+Pe+"px","overflow: scroll","visibility: none","top: "+-xt*3+"px","left: "+-Pe*3+"px","visibility: hidden","margin: 0","padding: 0"]),tt.appendChild(Ft),document.body.insertBefore(tt,document.body.firstChild);var Jt=xt-tt.clientWidth,wr=Pe-tt.clientHeight;return document.body.removeChild(tt),{width:Jt,height:wr}}function Yt(xt,Pe,Ft){function tt(me,W){W=W||function(ae){xt.head.appendChild(ae)};var he=xt.createElement("style");return he.innerHTML=me,he.id=Pe,W(he),he}if(!xt.getElementById(Pe)){var Jt=Ft+"_animation",wr=Ft+"_animation_active",$=`/* Created by the element-resize-detector library. */
`;$+="."+Ft+" > div::-webkit-scrollbar { "+st(["display: none"])+` }

`,$+="."+wr+" { "+st(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+Jt,"animation-name: "+Jt])+` }
`,$+="@-webkit-keyframes "+Jt+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,$+="@keyframes "+Jt+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",tt($)}}function ir(xt){xt.className+=" "+zt+"_animation_active"}function or(xt,Pe,Ft){if(xt.addEventListener)xt.addEventListener(Pe,Ft);else if(xt.attachEvent)xt.attachEvent("on"+Pe,Ft);else return v.error("[scroll] Don't know how to add event listeners.")}function Sr(xt,Pe,Ft){if(xt.removeEventListener)xt.removeEventListener(Pe,Ft);else if(xt.detachEvent)xt.detachEvent("on"+Pe,Ft);else return v.error("[scroll] Don't know how to remove event listeners.")}function _r(xt){return G(xt).container.childNodes[0].childNodes[0].childNodes[0]}function Gr(xt){return G(xt).container.childNodes[0].childNodes[0].childNodes[1]}function vn(xt,Pe){var Ft=G(xt).listeners;if(!Ft.push)throw new Error("Cannot add listener to an element that is not detectable.");G(xt).listeners.push(Pe)}function ii(xt,Pe,Ft){Ft||(Ft=Pe,Pe=xt,xt=null),xt=xt||{};function tt(){if(xt.debug){var Ur=Array.prototype.slice.call(arguments);if(Ur.unshift(Oe.get(Pe),"Scroll: "),v.log.apply)v.log.apply(null,Ur);else for(var Mn=0;Mn<Ur.length;Mn++)v.log(Ur[Mn])}}function Jt(Ur){function Mn($r){var un=$r.getRootNode&&$r.getRootNode().contains($r);return $r===$r.ownerDocument.body||$r.ownerDocument.body.contains($r)||un}return!Mn(Ur)||window.getComputedStyle(Ur)===null}function wr(Ur){var Mn=G(Ur).container.childNodes[0],$r=window.getComputedStyle(Mn);return!$r.width||$r.width.indexOf("px")===-1}function $(){var Ur=window.getComputedStyle(Pe),Mn={};return Mn.position=Ur.position,Mn.width=Pe.offsetWidth,Mn.height=Pe.offsetHeight,Mn.top=Ur.top,Mn.right=Ur.right,Mn.bottom=Ur.bottom,Mn.left=Ur.left,Mn.widthCSS=Ur.width,Mn.heightCSS=Ur.height,Mn}function me(){var Ur=$();G(Pe).startSize={width:Ur.width,height:Ur.height},tt("Element start size",G(Pe).startSize)}function W(){G(Pe).listeners=[]}function he(){if(tt("storeStyle invoked."),!G(Pe)){tt("Aborting because element has been uninstalled");return}var Ur=$();G(Pe).style=Ur}function ae(Ur,Mn,$r){G(Ur).lastWidth=Mn,G(Ur).lastHeight=$r}function Me(Ur){return _r(Ur).childNodes[0]}function je(){return 2*yt.width+1}function ut(){return 2*yt.height+1}function St(Ur){return Ur+10+je()}function bt(Ur){return Ur+10+ut()}function Lr(Ur){return Ur*2+je()}function Cr(Ur){return Ur*2+ut()}function On(Ur,Mn,$r){var un=_r(Ur),zi=Gr(Ur),gi=St(Mn),_o=bt($r),Ii=Lr(Mn),ie=Cr($r);un.scrollLeft=gi,un.scrollTop=_o,zi.scrollLeft=Ii,zi.scrollTop=ie}function Xr(){var Ur=G(Pe).container;if(!Ur){Ur=document.createElement("div"),Ur.className=zt,Ur.style.cssText=st(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),G(Pe).container=Ur,ir(Ur),Pe.appendChild(Ur);var Mn=function(){G(Pe).onRendered&&G(Pe).onRendered()};or(Ur,"animationstart",Mn),G(Pe).onAnimationStart=Mn}return Ur}function xn(){function Ur(){var uo=G(Pe).style;if(uo.position==="static"){Pe.style.setProperty("position","relative",xt.important?"important":"");var lo=function(ot,z,K,de){function Fe(Nt){return Nt.replace(/[^-\d\.]/g,"")}var Ce=K[de];Ce!=="auto"&&Fe(Ce)!=="0"&&(ot.warn("An element that is positioned static has style."+de+"="+Ce+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+de+" will be set to 0. Element: ",z),z.style[de]=0)};lo(v,Pe,uo,"top"),lo(v,Pe,uo,"right"),lo(v,Pe,uo,"bottom"),lo(v,Pe,uo,"left")}}function Mn(uo,lo,ot,z){return uo=uo?uo+"px":"0",lo=lo?lo+"px":"0",ot=ot?ot+"px":"0",z=z?z+"px":"0",["left: "+uo,"top: "+lo,"right: "+z,"bottom: "+ot]}if(tt("Injecting elements"),!G(Pe)){tt("Aborting because element has been uninstalled");return}Ur();var $r=G(Pe).container;$r||($r=Xr());var un=yt.width,zi=yt.height,gi=st(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),_o=st(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(Mn(-(1+un),-(1+zi),-zi,-un))),Ii=st(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),ie=st(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),Wi=st(["position: absolute","left: 0","top: 0"]),Ji=st(["position: absolute","width: 200%","height: 200%"]),to=document.createElement("div"),aa=document.createElement("div"),ea=document.createElement("div"),Bs=document.createElement("div"),Vo=document.createElement("div"),Ws=document.createElement("div");to.dir="ltr",to.style.cssText=gi,to.className=zt,aa.className=zt,aa.style.cssText=_o,ea.style.cssText=Ii,Bs.style.cssText=Wi,Vo.style.cssText=ie,Ws.style.cssText=Ji,ea.appendChild(Bs),Vo.appendChild(Ws),aa.appendChild(ea),aa.appendChild(Vo),to.appendChild(aa),$r.appendChild(to);function _u(){var uo=G(Pe);uo&&uo.onExpand?uo.onExpand():tt("Aborting expand scroll handler: element has been uninstalled")}function Do(){var uo=G(Pe);uo&&uo.onShrink?uo.onShrink():tt("Aborting shrink scroll handler: element has been uninstalled")}or(ea,"scroll",_u),or(Vo,"scroll",Do),G(Pe).onExpandScroll=_u,G(Pe).onShrinkScroll=Do}function Yr(){function Ur(Ii,ie,Wi){var Ji=Me(Ii),to=St(ie),aa=bt(Wi);Ji.style.setProperty("width",to+"px",xt.important?"important":""),Ji.style.setProperty("height",aa+"px",xt.important?"important":"")}function Mn(Ii){var ie=Pe.offsetWidth,Wi=Pe.offsetHeight,Ji=ie!==G(Pe).lastWidth||Wi!==G(Pe).lastHeight;tt("Storing current size",ie,Wi),ae(Pe,ie,Wi),at.add(0,function(){if(Ji){if(!G(Pe)){tt("Aborting because element has been uninstalled");return}if(!$r()){tt("Aborting because element container has not been initialized");return}if(xt.debug){var aa=Pe.offsetWidth,ea=Pe.offsetHeight;(aa!==ie||ea!==Wi)&&v.warn(Oe.get(Pe),"Scroll: Size changed before updating detector elements.")}Ur(Pe,ie,Wi)}}),at.add(1,function(){if(!G(Pe)){tt("Aborting because element has been uninstalled");return}if(!$r()){tt("Aborting because element container has not been initialized");return}On(Pe,ie,Wi)}),Ji&&Ii&&at.add(2,function(){if(!G(Pe)){tt("Aborting because element has been uninstalled");return}if(!$r()){tt("Aborting because element container has not been initialized");return}Ii()})}function $r(){return!!G(Pe).container}function un(){function Ii(){return G(Pe).lastNotifiedWidth===void 0}tt("notifyListenersIfNeeded invoked");var ie=G(Pe);if(Ii()&&ie.lastWidth===ie.startSize.width&&ie.lastHeight===ie.startSize.height)return tt("Not notifying: Size is the same as the start size, and there has been no notification yet.");if(ie.lastWidth===ie.lastNotifiedWidth&&ie.lastHeight===ie.lastNotifiedHeight)return tt("Not notifying: Size already notified");tt("Current size not notified, notifying..."),ie.lastNotifiedWidth=ie.lastWidth,ie.lastNotifiedHeight=ie.lastHeight,ze(G(Pe).listeners,function(Wi){Wi(Pe)})}function zi(){if(tt("startanimation triggered."),wr(Pe)){tt("Ignoring since element is still unrendered...");return}tt("Element rendered.");var Ii=_r(Pe),ie=Gr(Pe);(Ii.scrollLeft===0||Ii.scrollTop===0||ie.scrollLeft===0||ie.scrollTop===0)&&(tt("Scrollbars out of sync. Updating detector elements..."),Mn(un))}function gi(){if(tt("Scroll detected."),wr(Pe)){tt("Scroll event fired while unrendered. Ignoring...");return}Mn(un)}if(tt("registerListenersAndPositionElements invoked."),!G(Pe)){tt("Aborting because element has been uninstalled");return}G(Pe).onRendered=zi,G(Pe).onExpand=gi,G(Pe).onShrink=gi;var _o=G(Pe).style;Ur(Pe,_o.width,_o.height)}function rn(){if(tt("finalizeDomMutation invoked."),!G(Pe)){tt("Aborting because element has been uninstalled");return}var Ur=G(Pe).style;ae(Pe,Ur.width,Ur.height),On(Pe,Ur.width,Ur.height)}function Kr(){Ft(Pe)}function Qn(){tt("Installing..."),W(),me(),at.add(0,he),at.add(1,xn),at.add(2,Yr),at.add(3,rn),at.add(4,Kr)}tt("Making detectable..."),Jt(Pe)?(tt("Element is detached"),Xr(),tt("Waiting until element is attached..."),G(Pe).onRendered=function(){tt("Element is now attached"),Qn()}):Qn()}function Yn(xt){var Pe=G(xt);Pe&&(Pe.onExpandScroll&&Sr(_r(xt),"scroll",Pe.onExpandScroll),Pe.onShrinkScroll&&Sr(Gr(xt),"scroll",Pe.onShrinkScroll),Pe.onAnimationStart&&Sr(Pe.container,"animationstart",Pe.onAnimationStart),Pe.container&&xt.removeChild(Pe.container))}return{makeDetectable:ii,addListener:vn,uninstall:Yn,initDocument:ct}}},28766:function(pr,Gt,H){"use strict";var ze=H(10219).forEach,qe=H(12167),v=H(49315),at=H(36179),G=H(49806),Je=H(34880),Oe=H(91895),yt=H(20300),Re=H(55619),zt=H(90153),ct=H(21762);function st(or){return Array.isArray(or)||or.length!==void 0}function qt(or){if(Array.isArray(or))return or;var Sr=[];return ze(or,function(_r){Sr.push(_r)}),Sr}function Yt(or){return or&&or.nodeType===1}pr.exports=function(or){or=or||{};var Sr;if(or.idHandler)Sr={get:function(Me){return or.idHandler.get(Me,!0)},set:or.idHandler.set};else{var _r=at(),Gr=G({idGenerator:_r,stateHandler:Re});Sr=Gr}var vn=or.reporter;if(!vn){var ii=vn===!1;vn=Je(ii)}var Yn=ir(or,"batchProcessor",yt({reporter:vn})),xt={};xt.callOnAdd=!!ir(or,"callOnAdd",!0),xt.debug=!!ir(or,"debug",!1);var Pe=v(Sr),Ft=qe({stateHandler:Re}),tt,Jt=ir(or,"strategy","object"),wr=ir(or,"important",!1),$={reporter:vn,batchProcessor:Yn,stateHandler:Re,idHandler:Sr,important:wr};if(Jt==="scroll"&&(Oe.isLegacyOpera()?(vn.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),Jt="object"):Oe.isIE(9)&&(vn.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),Jt="object")),Jt==="scroll")tt=ct($);else if(Jt==="object")tt=zt($);else throw new Error("Invalid strategy name: "+Jt);var me={};function W(Me,je,ut){function St(xn){var Yr=Pe.get(xn);ze(Yr,function(Kr){Kr(xn)})}function bt(xn,Yr,rn){Pe.add(Yr,rn),xn&&rn(Yr)}if(ut||(ut=je,je=Me,Me={}),!je)throw new Error("At least one element required.");if(!ut)throw new Error("Listener required.");if(Yt(je))je=[je];else if(st(je))je=qt(je);else return vn.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");var Lr=0,Cr=ir(Me,"callOnAdd",xt.callOnAdd),On=ir(Me,"onReady",function(){}),Xr=ir(Me,"debug",xt.debug);ze(je,function(Yr){Re.getState(Yr)||(Re.initState(Yr),Sr.set(Yr));var rn=Sr.get(Yr);if(Xr&&vn.log("Attaching listener to element",rn,Yr),!Ft.isDetectable(Yr)){if(Xr&&vn.log(rn,"Not detectable."),Ft.isBusy(Yr)){Xr&&vn.log(rn,"System busy making it detectable"),bt(Cr,Yr,ut),me[rn]=me[rn]||[],me[rn].push(function(){Lr++,Lr===je.length&&On()});return}return Xr&&vn.log(rn,"Making detectable..."),Ft.markBusy(Yr,!0),tt.makeDetectable({debug:Xr,important:wr},Yr,function(Qn){if(Xr&&vn.log(rn,"onElementDetectable"),Re.getState(Qn)){Ft.markAsDetectable(Qn),Ft.markBusy(Qn,!1),tt.addListener(Qn,St),bt(Cr,Qn,ut);var Ur=Re.getState(Qn);if(Ur&&Ur.startSize){var Mn=Qn.offsetWidth,$r=Qn.offsetHeight;(Ur.startSize.width!==Mn||Ur.startSize.height!==$r)&&St(Qn)}me[rn]&&ze(me[rn],function(un){un()})}else Xr&&vn.log(rn,"Element uninstalled before being detectable.");delete me[rn],Lr++,Lr===je.length&&On()})}Xr&&vn.log(rn,"Already detecable, adding listener."),bt(Cr,Yr,ut),Lr++}),Lr===je.length&&On()}function he(Me){if(!Me)return vn.error("At least one element is required.");if(Yt(Me))Me=[Me];else if(st(Me))Me=qt(Me);else return vn.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");ze(Me,function(je){Pe.removeAllListeners(je),tt.uninstall(je),Re.cleanState(je)})}function ae(Me){tt.initDocument&&tt.initDocument(Me)}return{listenTo:W,removeListener:Pe.removeListener,removeAllListeners:Pe.removeAllListeners,uninstall:he,initDocument:ae}};function ir(or,Sr,_r){var Gr=or[Sr];return Gr==null&&_r!==void 0?_r:Gr}},12167:function(pr){"use strict";pr.exports=function(Gt){var H=Gt.stateHandler.getState;function ze(G){var Je=H(G);return Je&&!!Je.isDetectable}function qe(G){H(G).isDetectable=!0}function v(G){return!!H(G).busy}function at(G,Je){H(G).busy=!!Je}return{isDetectable:ze,markAsDetectable:qe,isBusy:v,markBusy:at}}},36179:function(pr){"use strict";pr.exports=function(){var Gt=1;function H(){return Gt++}return{generate:H}}},49806:function(pr){"use strict";pr.exports=function(Gt){var H=Gt.idGenerator,ze=Gt.stateHandler.getState;function qe(at){var G=ze(at);return G&&G.id!==void 0?G.id:null}function v(at){var G=ze(at);if(!G)throw new Error("setId required the element to have a resize detection state.");var Je=H.generate();return G.id=Je,Je}return{get:qe,set:v}}},49315:function(pr){"use strict";pr.exports=function(Gt){var H={};function ze(G){var Je=Gt.get(G);return Je===void 0?[]:H[Je]||[]}function qe(G,Je){var Oe=Gt.get(G);H[Oe]||(H[Oe]=[]),H[Oe].push(Je)}function v(G,Je){for(var Oe=ze(G),yt=0,Re=Oe.length;yt<Re;++yt)if(Oe[yt]===Je){Oe.splice(yt,1);break}}function at(G){var Je=ze(G);Je&&(Je.length=0)}return{get:ze,add:qe,removeListener:v,removeAllListeners:at}}},34880:function(pr){"use strict";pr.exports=function(Gt){function H(){}var ze={log:H,warn:H,error:H};if(!Gt&&window.console){var qe=function(v,at){v[at]=function(){var Je=console[at];if(Je.apply)Je.apply(console,arguments);else for(var Oe=0;Oe<arguments.length;Oe++)Je(arguments[Oe])}};qe(ze,"log"),qe(ze,"warn"),qe(ze,"error")}return ze}},55619:function(pr){"use strict";var Gt="_erd";function H(v){return v[Gt]={},ze(v)}function ze(v){return v[Gt]}function qe(v){delete v[Gt]}pr.exports={initState:H,getState:ze,cleanState:qe}},11312:function(pr){"use strict";var Gt=Object.prototype.hasOwnProperty,H="~";function ze(){}Object.create&&(ze.prototype=Object.create(null),new ze().__proto__||(H=!1));function qe(Je,Oe,yt){this.fn=Je,this.context=Oe,this.once=yt||!1}function v(Je,Oe,yt,Re,zt){if(typeof yt!="function")throw new TypeError("The listener must be a function");var ct=new qe(yt,Re||Je,zt),st=H?H+Oe:Oe;return Je._events[st]?Je._events[st].fn?Je._events[st]=[Je._events[st],ct]:Je._events[st].push(ct):(Je._events[st]=ct,Je._eventsCount++),Je}function at(Je,Oe){--Je._eventsCount===0?Je._events=new ze:delete Je._events[Oe]}function G(){this._events=new ze,this._eventsCount=0}G.prototype.eventNames=function(){var Oe=[],yt,Re;if(this._eventsCount===0)return Oe;for(Re in yt=this._events)Gt.call(yt,Re)&&Oe.push(H?Re.slice(1):Re);return Object.getOwnPropertySymbols?Oe.concat(Object.getOwnPropertySymbols(yt)):Oe},G.prototype.listeners=function(Oe){var yt=H?H+Oe:Oe,Re=this._events[yt];if(!Re)return[];if(Re.fn)return[Re.fn];for(var zt=0,ct=Re.length,st=new Array(ct);zt<ct;zt++)st[zt]=Re[zt].fn;return st},G.prototype.listenerCount=function(Oe){var yt=H?H+Oe:Oe,Re=this._events[yt];return Re?Re.fn?1:Re.length:0},G.prototype.emit=function(Oe,yt,Re,zt,ct,st){var qt=H?H+Oe:Oe;if(!this._events[qt])return!1;var Yt=this._events[qt],ir=arguments.length,or,Sr;if(Yt.fn){switch(Yt.once&&this.removeListener(Oe,Yt.fn,void 0,!0),ir){case 1:return Yt.fn.call(Yt.context),!0;case 2:return Yt.fn.call(Yt.context,yt),!0;case 3:return Yt.fn.call(Yt.context,yt,Re),!0;case 4:return Yt.fn.call(Yt.context,yt,Re,zt),!0;case 5:return Yt.fn.call(Yt.context,yt,Re,zt,ct),!0;case 6:return Yt.fn.call(Yt.context,yt,Re,zt,ct,st),!0}for(Sr=1,or=new Array(ir-1);Sr<ir;Sr++)or[Sr-1]=arguments[Sr];Yt.fn.apply(Yt.context,or)}else{var _r=Yt.length,Gr;for(Sr=0;Sr<_r;Sr++)switch(Yt[Sr].once&&this.removeListener(Oe,Yt[Sr].fn,void 0,!0),ir){case 1:Yt[Sr].fn.call(Yt[Sr].context);break;case 2:Yt[Sr].fn.call(Yt[Sr].context,yt);break;case 3:Yt[Sr].fn.call(Yt[Sr].context,yt,Re);break;case 4:Yt[Sr].fn.call(Yt[Sr].context,yt,Re,zt);break;default:if(!or)for(Gr=1,or=new Array(ir-1);Gr<ir;Gr++)or[Gr-1]=arguments[Gr];Yt[Sr].fn.apply(Yt[Sr].context,or)}}return!0},G.prototype.on=function(Oe,yt,Re){return v(this,Oe,yt,Re,!1)},G.prototype.once=function(Oe,yt,Re){return v(this,Oe,yt,Re,!0)},G.prototype.removeListener=function(Oe,yt,Re,zt){var ct=H?H+Oe:Oe;if(!this._events[ct])return this;if(!yt)return at(this,ct),this;var st=this._events[ct];if(st.fn)st.fn===yt&&(!zt||st.once)&&(!Re||st.context===Re)&&at(this,ct);else{for(var qt=0,Yt=[],ir=st.length;qt<ir;qt++)(st[qt].fn!==yt||zt&&!st[qt].once||Re&&st[qt].context!==Re)&&Yt.push(st[qt]);Yt.length?this._events[ct]=Yt.length===1?Yt[0]:Yt:at(this,ct)}return this},G.prototype.removeAllListeners=function(Oe){var yt;return Oe?(yt=H?H+Oe:Oe,this._events[yt]&&at(this,yt)):(this._events=new ze,this._eventsCount=0),this},G.prototype.off=G.prototype.removeListener,G.prototype.addListener=G.prototype.on,G.prefixed=H,G.EventEmitter=G,pr.exports=G},11553:function(pr,Gt,H){var ze;(function(qe,v,at,G){"use strict";var Je=["","webkit","Moz","MS","ms","o"],Oe=v.createElement("div"),yt="function",Re=Math.round,zt=Math.abs,ct=Date.now;function st(re,pe,Ke){return setTimeout(vn(re,Ke),pe)}function qt(re,pe,Ke){return Array.isArray(re)?(Yt(re,Ke[pe],Ke),!0):!1}function Yt(re,pe,Ke){var Vt;if(re)if(re.forEach)re.forEach(pe,Ke);else if(re.length!==G)for(Vt=0;Vt<re.length;)pe.call(Ke,re[Vt],Vt,re),Vt++;else for(Vt in re)re.hasOwnProperty(Vt)&&pe.call(Ke,re[Vt],Vt,re)}function ir(re,pe,Ke){var Vt="DEPRECATED METHOD: "+pe+`
`+Ke+` AT 
`;return function(){var yr=new Error("get-stack-trace"),dn=yr&&yr.stack?yr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Si=qe.console&&(qe.console.warn||qe.console.log);return Si&&Si.call(qe.console,Vt,dn),re.apply(this,arguments)}}var or;typeof Object.assign!="function"?or=function(pe){if(pe===G||pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(pe),Vt=1;Vt<arguments.length;Vt++){var yr=arguments[Vt];if(yr!==G&&yr!==null)for(var dn in yr)yr.hasOwnProperty(dn)&&(Ke[dn]=yr[dn])}return Ke}:or=Object.assign;var Sr=ir(function(pe,Ke,Vt){for(var yr=Object.keys(Ke),dn=0;dn<yr.length;)(!Vt||Vt&&pe[yr[dn]]===G)&&(pe[yr[dn]]=Ke[yr[dn]]),dn++;return pe},"extend","Use `assign`."),_r=ir(function(pe,Ke){return Sr(pe,Ke,!0)},"merge","Use `assign`.");function Gr(re,pe,Ke){var Vt=pe.prototype,yr;yr=re.prototype=Object.create(Vt),yr.constructor=re,yr._super=Vt,Ke&&or(yr,Ke)}function vn(re,pe){return function(){return re.apply(pe,arguments)}}function ii(re,pe){return typeof re==yt?re.apply(pe&&pe[0]||G,pe):re}function Yn(re,pe){return re===G?pe:re}function xt(re,pe,Ke){Yt(Jt(pe),function(Vt){re.addEventListener(Vt,Ke,!1)})}function Pe(re,pe,Ke){Yt(Jt(pe),function(Vt){re.removeEventListener(Vt,Ke,!1)})}function Ft(re,pe){for(;re;){if(re==pe)return!0;re=re.parentNode}return!1}function tt(re,pe){return re.indexOf(pe)>-1}function Jt(re){return re.trim().split(/\s+/g)}function wr(re,pe,Ke){if(re.indexOf&&!Ke)return re.indexOf(pe);for(var Vt=0;Vt<re.length;){if(Ke&&re[Vt][Ke]==pe||!Ke&&re[Vt]===pe)return Vt;Vt++}return-1}function $(re){return Array.prototype.slice.call(re,0)}function me(re,pe,Ke){for(var Vt=[],yr=[],dn=0;dn<re.length;){var Si=pe?re[dn][pe]:re[dn];wr(yr,Si)<0&&Vt.push(re[dn]),yr[dn]=Si,dn++}return Ke&&(pe?Vt=Vt.sort(function(ua,Ho){return ua[pe]>Ho[pe]}):Vt=Vt.sort()),Vt}function W(re,pe){for(var Ke,Vt,yr=pe[0].toUpperCase()+pe.slice(1),dn=0;dn<Je.length;){if(Ke=Je[dn],Vt=Ke?Ke+yr:pe,Vt in re)return Vt;dn++}return G}var he=1;function ae(){return he++}function Me(re){var pe=re.ownerDocument||re;return pe.defaultView||pe.parentWindow||qe}var je=/mobile|tablet|ip(ad|hone|od)|android/i,ut="ontouchstart"in qe,St=W(qe,"PointerEvent")!==G,bt=ut&&je.test(navigator.userAgent),Lr="touch",Cr="pen",On="mouse",Xr="kinect",xn=25,Yr=1,rn=2,Kr=4,Qn=8,Ur=1,Mn=2,$r=4,un=8,zi=16,gi=Mn|$r,_o=un|zi,Ii=gi|_o,ie=["x","y"],Wi=["clientX","clientY"];function Ji(re,pe){var Ke=this;this.manager=re,this.callback=pe,this.element=re.element,this.target=re.options.inputTarget,this.domHandler=function(Vt){ii(re.options.enable,[re])&&Ke.handler(Vt)},this.init()}Ji.prototype={handler:function(){},init:function(){this.evEl&&xt(this.element,this.evEl,this.domHandler),this.evTarget&&xt(this.target,this.evTarget,this.domHandler),this.evWin&&xt(Me(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Pe(this.element,this.evEl,this.domHandler),this.evTarget&&Pe(this.target,this.evTarget,this.domHandler),this.evWin&&Pe(Me(this.element),this.evWin,this.domHandler)}};function to(re){var pe,Ke=re.options.inputClass;return Ke?pe=Ke:St?pe=P:bt?pe=rt:ut?pe=Qt:pe=Nt,new pe(re,aa)}function aa(re,pe,Ke){var Vt=Ke.pointers.length,yr=Ke.changedPointers.length,dn=pe&Yr&&Vt-yr===0,Si=pe&(Kr|Qn)&&Vt-yr===0;Ke.isFirst=!!dn,Ke.isFinal=!!Si,dn&&(re.session={}),Ke.eventType=pe,ea(re,Ke),re.emit("hammer.input",Ke),re.recognize(Ke),re.session.prevInput=Ke}function ea(re,pe){var Ke=re.session,Vt=pe.pointers,yr=Vt.length;Ke.firstInput||(Ke.firstInput=Ws(pe)),yr>1&&!Ke.firstMultiple?Ke.firstMultiple=Ws(pe):yr===1&&(Ke.firstMultiple=!1);var dn=Ke.firstInput,Si=Ke.firstMultiple,jo=Si?Si.center:dn.center,ua=pe.center=_u(Vt);pe.timeStamp=ct(),pe.deltaTime=pe.timeStamp-dn.timeStamp,pe.angle=ot(jo,ua),pe.distance=lo(jo,ua),Bs(Ke,pe),pe.offsetDirection=uo(pe.deltaX,pe.deltaY);var Ho=Do(pe.deltaTime,pe.deltaX,pe.deltaY);pe.overallVelocityX=Ho.x,pe.overallVelocityY=Ho.y,pe.overallVelocity=zt(Ho.x)>zt(Ho.y)?Ho.x:Ho.y,pe.scale=Si?K(Si.pointers,Vt):1,pe.rotation=Si?z(Si.pointers,Vt):0,pe.maxPointers=Ke.prevInput?pe.pointers.length>Ke.prevInput.maxPointers?pe.pointers.length:Ke.prevInput.maxPointers:pe.pointers.length,Vo(Ke,pe);var xs=re.element;Ft(pe.srcEvent.target,xs)&&(xs=pe.srcEvent.target),pe.target=xs}function Bs(re,pe){var Ke=pe.center,Vt=re.offsetDelta||{},yr=re.prevDelta||{},dn=re.prevInput||{};(pe.eventType===Yr||dn.eventType===Kr)&&(yr=re.prevDelta={x:dn.deltaX||0,y:dn.deltaY||0},Vt=re.offsetDelta={x:Ke.x,y:Ke.y}),pe.deltaX=yr.x+(Ke.x-Vt.x),pe.deltaY=yr.y+(Ke.y-Vt.y)}function Vo(re,pe){var Ke=re.lastInterval||pe,Vt=pe.timeStamp-Ke.timeStamp,yr,dn,Si,jo;if(pe.eventType!=Qn&&(Vt>xn||Ke.velocity===G)){var ua=pe.deltaX-Ke.deltaX,Ho=pe.deltaY-Ke.deltaY,xs=Do(Vt,ua,Ho);dn=xs.x,Si=xs.y,yr=zt(xs.x)>zt(xs.y)?xs.x:xs.y,jo=uo(ua,Ho),re.lastInterval=pe}else yr=Ke.velocity,dn=Ke.velocityX,Si=Ke.velocityY,jo=Ke.direction;pe.velocity=yr,pe.velocityX=dn,pe.velocityY=Si,pe.direction=jo}function Ws(re){for(var pe=[],Ke=0;Ke<re.pointers.length;)pe[Ke]={clientX:Re(re.pointers[Ke].clientX),clientY:Re(re.pointers[Ke].clientY)},Ke++;return{timeStamp:ct(),pointers:pe,center:_u(pe),deltaX:re.deltaX,deltaY:re.deltaY}}function _u(re){var pe=re.length;if(pe===1)return{x:Re(re[0].clientX),y:Re(re[0].clientY)};for(var Ke=0,Vt=0,yr=0;yr<pe;)Ke+=re[yr].clientX,Vt+=re[yr].clientY,yr++;return{x:Re(Ke/pe),y:Re(Vt/pe)}}function Do(re,pe,Ke){return{x:pe/re||0,y:Ke/re||0}}function uo(re,pe){return re===pe?Ur:zt(re)>=zt(pe)?re<0?Mn:$r:pe<0?un:zi}function lo(re,pe,Ke){Ke||(Ke=ie);var Vt=pe[Ke[0]]-re[Ke[0]],yr=pe[Ke[1]]-re[Ke[1]];return Math.sqrt(Vt*Vt+yr*yr)}function ot(re,pe,Ke){Ke||(Ke=ie);var Vt=pe[Ke[0]]-re[Ke[0]],yr=pe[Ke[1]]-re[Ke[1]];return Math.atan2(yr,Vt)*180/Math.PI}function z(re,pe){return ot(pe[1],pe[0],Wi)+ot(re[1],re[0],Wi)}function K(re,pe){return lo(pe[0],pe[1],Wi)/lo(re[0],re[1],Wi)}var de={mousedown:Yr,mousemove:rn,mouseup:Kr},Fe="mousedown",Ce="mousemove mouseup";function Nt(){this.evEl=Fe,this.evWin=Ce,this.pressed=!1,Ji.apply(this,arguments)}Gr(Nt,Ji,{handler:function(pe){var Ke=de[pe.type];Ke&Yr&&pe.button===0&&(this.pressed=!0),Ke&rn&&pe.which!==1&&(Ke=Kr),this.pressed&&(Ke&Kr&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[pe],changedPointers:[pe],pointerType:On,srcEvent:pe}))}});var Bt={pointerdown:Yr,pointermove:rn,pointerup:Kr,pointercancel:Qn,pointerout:Qn},sr={2:Lr,3:Cr,4:On,5:Xr},It="pointerdown",B="pointermove pointerup pointercancel";qe.MSPointerEvent&&!qe.PointerEvent&&(It="MSPointerDown",B="MSPointerMove MSPointerUp MSPointerCancel");function P(){this.evEl=It,this.evWin=B,Ji.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Gr(P,Ji,{handler:function(pe){var Ke=this.store,Vt=!1,yr=pe.type.toLowerCase().replace("ms",""),dn=Bt[yr],Si=sr[pe.pointerType]||pe.pointerType,jo=Si==Lr,ua=wr(Ke,pe.pointerId,"pointerId");dn&Yr&&(pe.button===0||jo)?ua<0&&(Ke.push(pe),ua=Ke.length-1):dn&(Kr|Qn)&&(Vt=!0),!(ua<0)&&(Ke[ua]=pe,this.callback(this.manager,dn,{pointers:Ke,changedPointers:[pe],pointerType:Si,srcEvent:pe}),Vt&&Ke.splice(ua,1))}});var V={touchstart:Yr,touchmove:rn,touchend:Kr,touchcancel:Qn},Y="touchstart",ce="touchstart touchmove touchend touchcancel";function Se(){this.evTarget=Y,this.evWin=ce,this.started=!1,Ji.apply(this,arguments)}Gr(Se,Ji,{handler:function(pe){var Ke=V[pe.type];if(Ke===Yr&&(this.started=!0),!!this.started){var Vt=Ue.call(this,pe,Ke);Ke&(Kr|Qn)&&Vt[0].length-Vt[1].length===0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:Vt[0],changedPointers:Vt[1],pointerType:Lr,srcEvent:pe})}}});function Ue(re,pe){var Ke=$(re.touches),Vt=$(re.changedTouches);return pe&(Kr|Qn)&&(Ke=me(Ke.concat(Vt),"identifier",!0)),[Ke,Vt]}var Q={touchstart:Yr,touchmove:rn,touchend:Kr,touchcancel:Qn},ve="touchstart touchmove touchend touchcancel";function rt(){this.evTarget=ve,this.targetIds={},Ji.apply(this,arguments)}Gr(rt,Ji,{handler:function(pe){var Ke=Q[pe.type],Vt=wt.call(this,pe,Ke);Vt&&this.callback(this.manager,Ke,{pointers:Vt[0],changedPointers:Vt[1],pointerType:Lr,srcEvent:pe})}});function wt(re,pe){var Ke=$(re.touches),Vt=this.targetIds;if(pe&(Yr|rn)&&Ke.length===1)return Vt[Ke[0].identifier]=!0,[Ke,Ke];var yr,dn,Si=$(re.changedTouches),jo=[],ua=this.target;if(dn=Ke.filter(function(Ho){return Ft(Ho.target,ua)}),pe===Yr)for(yr=0;yr<dn.length;)Vt[dn[yr].identifier]=!0,yr++;for(yr=0;yr<Si.length;)Vt[Si[yr].identifier]&&jo.push(Si[yr]),pe&(Kr|Qn)&&delete Vt[Si[yr].identifier],yr++;if(jo.length)return[me(dn.concat(jo),"identifier",!0),jo]}var nr=2500,_t=25;function Qt(){Ji.apply(this,arguments);var re=vn(this.handler,this);this.touch=new rt(this.manager,re),this.mouse=new Nt(this.manager,re),this.primaryTouch=null,this.lastTouches=[]}Gr(Qt,Ji,{handler:function(pe,Ke,Vt){var yr=Vt.pointerType==Lr,dn=Vt.pointerType==On;if(!(dn&&Vt.sourceCapabilities&&Vt.sourceCapabilities.firesTouchEvents)){if(yr)Br.call(this,Ke,Vt);else if(dn&&Mt.call(this,Vt))return;this.callback(pe,Ke,Vt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Br(re,pe){re&Yr?(this.primaryTouch=pe.changedPointers[0].identifier,Fr.call(this,pe)):re&(Kr|Qn)&&Fr.call(this,pe)}function Fr(re){var pe=re.changedPointers[0];if(pe.identifier===this.primaryTouch){var Ke={x:pe.clientX,y:pe.clientY};this.lastTouches.push(Ke);var Vt=this.lastTouches,yr=function(){var dn=Vt.indexOf(Ke);dn>-1&&Vt.splice(dn,1)};setTimeout(yr,nr)}}function Mt(re){for(var pe=re.srcEvent.clientX,Ke=re.srcEvent.clientY,Vt=0;Vt<this.lastTouches.length;Vt++){var yr=this.lastTouches[Vt],dn=Math.abs(pe-yr.x),Si=Math.abs(Ke-yr.y);if(dn<=_t&&Si<=_t)return!0}return!1}var Dr=W(Oe.style,"touchAction"),Er=Dr!==G,Rr="compute",zn="auto",jr="manipulation",qn="none",Li="pan-x",ei="pan-y",Ai=Bi();function di(re,pe){this.manager=re,this.set(pe)}di.prototype={set:function(re){re==Rr&&(re=this.compute()),Er&&this.manager.element.style&&Ai[re]&&(this.manager.element.style[Dr]=re),this.actions=re.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var re=[];return Yt(this.manager.recognizers,function(pe){ii(pe.options.enable,[pe])&&(re=re.concat(pe.getTouchAction()))}),Aa(re.join(" "))},preventDefaults:function(re){var pe=re.srcEvent,Ke=re.offsetDirection;if(this.manager.session.prevented){pe.preventDefault();return}var Vt=this.actions,yr=tt(Vt,qn)&&!Ai[qn],dn=tt(Vt,ei)&&!Ai[ei],Si=tt(Vt,Li)&&!Ai[Li];if(yr){var jo=re.pointers.length===1,ua=re.distance<2,Ho=re.deltaTime<250;if(jo&&ua&&Ho)return}if(!(Si&&dn)&&(yr||dn&&Ke&gi||Si&&Ke&_o))return this.preventSrc(pe)},preventSrc:function(re){this.manager.session.prevented=!0,re.preventDefault()}};function Aa(re){if(tt(re,qn))return qn;var pe=tt(re,Li),Ke=tt(re,ei);return pe&&Ke?qn:pe||Ke?pe?Li:ei:tt(re,jr)?jr:zn}function Bi(){if(!Er)return!1;var re={},pe=qe.CSS&&qe.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){re[Ke]=pe?qe.CSS.supports("touch-action",Ke):!0}),re}var ro=1,mi=2,Jn=4,oi=8,bo=oi,Fs=16,eo=32;function co(re){this.options=or({},this.defaults,re||{}),this.id=ae(),this.manager=null,this.options.enable=Yn(this.options.enable,!0),this.state=ro,this.simultaneous={},this.requireFail=[]}co.prototype={defaults:{},set:function(re){return or(this.options,re),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(re){if(qt(re,"recognizeWith",this))return this;var pe=this.simultaneous;return re=Gi(re,this),pe[re.id]||(pe[re.id]=re,re.recognizeWith(this)),this},dropRecognizeWith:function(re){return qt(re,"dropRecognizeWith",this)?this:(re=Gi(re,this),delete this.simultaneous[re.id],this)},requireFailure:function(re){if(qt(re,"requireFailure",this))return this;var pe=this.requireFail;return re=Gi(re,this),wr(pe,re)===-1&&(pe.push(re),re.requireFailure(this)),this},dropRequireFailure:function(re){if(qt(re,"dropRequireFailure",this))return this;re=Gi(re,this);var pe=wr(this.requireFail,re);return pe>-1&&this.requireFail.splice(pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(re){return!!this.simultaneous[re.id]},emit:function(re){var pe=this,Ke=this.state;function Vt(yr){pe.manager.emit(yr,re)}Ke<oi&&Vt(pe.options.event+yu(Ke)),Vt(pe.options.event),re.additionalEvent&&Vt(re.additionalEvent),Ke>=oi&&Vt(pe.options.event+yu(Ke))},tryEmit:function(re){if(this.canEmit())return this.emit(re);this.state=eo},canEmit:function(){for(var re=0;re<this.requireFail.length;){if(!(this.requireFail[re].state&(eo|ro)))return!1;re++}return!0},recognize:function(re){var pe=or({},re);if(!ii(this.options.enable,[this,pe])){this.reset(),this.state=eo;return}this.state&(bo|Fs|eo)&&(this.state=ro),this.state=this.process(pe),this.state&(mi|Jn|oi|Fs)&&this.tryEmit(pe)},process:function(re){},getTouchAction:function(){},reset:function(){}};function yu(re){return re&Fs?"cancel":re&oi?"end":re&Jn?"move":re&mi?"start":""}function _s(re){return re==zi?"down":re==un?"up":re==Mn?"left":re==$r?"right":""}function Gi(re,pe){var Ke=pe.manager;return Ke?Ke.get(re):re}function sa(){co.apply(this,arguments)}Gr(sa,co,{defaults:{pointers:1},attrTest:function(re){var pe=this.options.pointers;return pe===0||re.pointers.length===pe},process:function(re){var pe=this.state,Ke=re.eventType,Vt=pe&(mi|Jn),yr=this.attrTest(re);return Vt&&(Ke&Qn||!yr)?pe|Fs:Vt||yr?Ke&Kr?pe|oi:pe&mi?pe|Jn:mi:eo}});function no(){sa.apply(this,arguments),this.pX=null,this.pY=null}Gr(no,sa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ii},getTouchAction:function(){var re=this.options.direction,pe=[];return re&gi&&pe.push(ei),re&_o&&pe.push(Li),pe},directionTest:function(re){var pe=this.options,Ke=!0,Vt=re.distance,yr=re.direction,dn=re.deltaX,Si=re.deltaY;return yr&pe.direction||(pe.direction&gi?(yr=dn===0?Ur:dn<0?Mn:$r,Ke=dn!=this.pX,Vt=Math.abs(re.deltaX)):(yr=Si===0?Ur:Si<0?un:zi,Ke=Si!=this.pY,Vt=Math.abs(re.deltaY))),re.direction=yr,Ke&&Vt>pe.threshold&&yr&pe.direction},attrTest:function(re){return sa.prototype.attrTest.call(this,re)&&(this.state&mi||!(this.state&mi)&&this.directionTest(re))},emit:function(re){this.pX=re.deltaX,this.pY=re.deltaY;var pe=_s(re.direction);pe&&(re.additionalEvent=this.options.event+pe),this._super.emit.call(this,re)}});function yo(){sa.apply(this,arguments)}Gr(yo,sa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[qn]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.scale-1)>this.options.threshold||this.state&mi)},emit:function(re){if(re.scale!==1){var pe=re.scale<1?"in":"out";re.additionalEvent=this.options.event+pe}this._super.emit.call(this,re)}});function Fa(){co.apply(this,arguments),this._timer=null,this._input=null}Gr(Fa,co,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[zn]},process:function(re){var pe=this.options,Ke=re.pointers.length===pe.pointers,Vt=re.distance<pe.threshold,yr=re.deltaTime>pe.time;if(this._input=re,!Vt||!Ke||re.eventType&(Kr|Qn)&&!yr)this.reset();else if(re.eventType&Yr)this.reset(),this._timer=st(function(){this.state=bo,this.tryEmit()},pe.time,this);else if(re.eventType&Kr)return bo;return eo},reset:function(){clearTimeout(this._timer)},emit:function(re){this.state===bo&&(re&&re.eventType&Kr?this.manager.emit(this.options.event+"up",re):(this._input.timeStamp=ct(),this.manager.emit(this.options.event,this._input)))}});function Ki(){sa.apply(this,arguments)}Gr(Ki,sa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[qn]},attrTest:function(re){return this._super.attrTest.call(this,re)&&(Math.abs(re.rotation)>this.options.threshold||this.state&mi)}});function Wa(){sa.apply(this,arguments)}Gr(Wa,sa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:gi|_o,pointers:1},getTouchAction:function(){return no.prototype.getTouchAction.call(this)},attrTest:function(re){var pe=this.options.direction,Ke;return pe&(gi|_o)?Ke=re.overallVelocity:pe&gi?Ke=re.overallVelocityX:pe&_o&&(Ke=re.overallVelocityY),this._super.attrTest.call(this,re)&&pe&re.offsetDirection&&re.distance>this.options.threshold&&re.maxPointers==this.options.pointers&&zt(Ke)>this.options.velocity&&re.eventType&Kr},emit:function(re){var pe=_s(re.offsetDirection);pe&&this.manager.emit(this.options.event+pe,re),this.manager.emit(this.options.event,re)}});function Na(){co.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Gr(Na,co,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[jr]},process:function(re){var pe=this.options,Ke=re.pointers.length===pe.pointers,Vt=re.distance<pe.threshold,yr=re.deltaTime<pe.time;if(this.reset(),re.eventType&Yr&&this.count===0)return this.failTimeout();if(Vt&&yr&&Ke){if(re.eventType!=Kr)return this.failTimeout();var dn=this.pTime?re.timeStamp-this.pTime<pe.interval:!0,Si=!this.pCenter||lo(this.pCenter,re.center)<pe.posThreshold;this.pTime=re.timeStamp,this.pCenter=re.center,!Si||!dn?this.count=1:this.count+=1,this._input=re;var jo=this.count%pe.taps;if(jo===0)return this.hasRequireFailures()?(this._timer=st(function(){this.state=bo,this.tryEmit()},pe.interval,this),mi):bo}return eo},failTimeout:function(){return this._timer=st(function(){this.state=eo},this.options.interval,this),eo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==bo&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function xu(re,pe){return pe=pe||{},pe.recognizers=Yn(pe.recognizers,xu.defaults.preset),new Bo(re,pe)}xu.VERSION="2.0.7",xu.defaults={domEvents:!1,touchAction:Rr,enable:!0,inputTarget:null,inputClass:null,preset:[[Ki,{enable:!1}],[yo,{enable:!1},["rotate"]],[Wa,{direction:gi}],[no,{direction:gi},["swipe"]],[Na],[Na,{event:"doubletap",taps:2},["tap"]],[Fa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ys=1,yc=2;function Bo(re,pe){this.options=or({},xu.defaults,pe||{}),this.options.inputTarget=this.options.inputTarget||re,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=re,this.input=to(this),this.touchAction=new di(this,this.options.touchAction),Yi(this,!0),Yt(this.options.recognizers,function(Ke){var Vt=this.add(new Ke[0](Ke[1]));Ke[2]&&Vt.recognizeWith(Ke[2]),Ke[3]&&Vt.requireFailure(Ke[3])},this)}Bo.prototype={set:function(re){return or(this.options,re),re.touchAction&&this.touchAction.update(),re.inputTarget&&(this.input.destroy(),this.input.target=re.inputTarget,this.input.init()),this},stop:function(re){this.session.stopped=re?yc:ys},recognize:function(re){var pe=this.session;if(!pe.stopped){this.touchAction.preventDefaults(re);var Ke,Vt=this.recognizers,yr=pe.curRecognizer;(!yr||yr&&yr.state&bo)&&(yr=pe.curRecognizer=null);for(var dn=0;dn<Vt.length;)Ke=Vt[dn],pe.stopped!==yc&&(!yr||Ke==yr||Ke.canRecognizeWith(yr))?Ke.recognize(re):Ke.reset(),!yr&&Ke.state&(mi|Jn|oi)&&(yr=pe.curRecognizer=Ke),dn++}},get:function(re){if(re instanceof co)return re;for(var pe=this.recognizers,Ke=0;Ke<pe.length;Ke++)if(pe[Ke].options.event==re)return pe[Ke];return null},add:function(re){if(qt(re,"add",this))return this;var pe=this.get(re.options.event);return pe&&this.remove(pe),this.recognizers.push(re),re.manager=this,this.touchAction.update(),re},remove:function(re){if(qt(re,"remove",this))return this;if(re=this.get(re),re){var pe=this.recognizers,Ke=wr(pe,re);Ke!==-1&&(pe.splice(Ke,1),this.touchAction.update())}return this},on:function(re,pe){if(re!==G&&pe!==G){var Ke=this.handlers;return Yt(Jt(re),function(Vt){Ke[Vt]=Ke[Vt]||[],Ke[Vt].push(pe)}),this}},off:function(re,pe){if(re!==G){var Ke=this.handlers;return Yt(Jt(re),function(Vt){pe?Ke[Vt]&&Ke[Vt].splice(wr(Ke[Vt],pe),1):delete Ke[Vt]}),this}},emit:function(re,pe){this.options.domEvents&&$a(re,pe);var Ke=this.handlers[re]&&this.handlers[re].slice();if(!(!Ke||!Ke.length)){pe.type=re,pe.preventDefault=function(){pe.srcEvent.preventDefault()};for(var Vt=0;Vt<Ke.length;)Ke[Vt](pe),Vt++}},destroy:function(){this.element&&Yi(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Yi(re,pe){var Ke=re.element;if(Ke.style){var Vt;Yt(re.options.cssProps,function(yr,dn){Vt=W(Ke.style,dn),pe?(re.oldCssProps[Vt]=Ke.style[Vt],Ke.style[Vt]=yr):Ke.style[Vt]=re.oldCssProps[Vt]||""}),pe||(re.oldCssProps={})}}function $a(re,pe){var Ke=v.createEvent("Event");Ke.initEvent(re,!0,!0),Ke.gesture=pe,pe.target.dispatchEvent(Ke)}or(xu,{INPUT_START:Yr,INPUT_MOVE:rn,INPUT_END:Kr,INPUT_CANCEL:Qn,STATE_POSSIBLE:ro,STATE_BEGAN:mi,STATE_CHANGED:Jn,STATE_ENDED:oi,STATE_RECOGNIZED:bo,STATE_CANCELLED:Fs,STATE_FAILED:eo,DIRECTION_NONE:Ur,DIRECTION_LEFT:Mn,DIRECTION_RIGHT:$r,DIRECTION_UP:un,DIRECTION_DOWN:zi,DIRECTION_HORIZONTAL:gi,DIRECTION_VERTICAL:_o,DIRECTION_ALL:Ii,Manager:Bo,Input:Ji,TouchAction:di,TouchInput:rt,MouseInput:Nt,PointerEventInput:P,TouchMouseInput:Qt,SingleTouchInput:Se,Recognizer:co,AttrRecognizer:sa,Tap:Na,Pan:no,Swipe:Wa,Pinch:yo,Rotate:Ki,Press:Fa,on:xt,off:Pe,each:Yt,merge:_r,extend:Sr,assign:or,inherit:Gr,bindFn:vn,prefixed:W});var Zo=typeof qe!="undefined"?qe:typeof self!="undefined"?self:{};Zo.Hammer=xu,ze=function(){return xu}.call(Gt,H,Gt,pr),ze!==G&&(pr.exports=ze)})(window,document,"Hammer")},45170:function(pr,Gt,H){var ze=H(13807);function qe(v,at){var G=v==null?0:v.length;return!!G&&ze(v,at,0)>-1}pr.exports=qe},94936:function(pr){function Gt(H,ze,qe){for(var v=-1,at=H==null?0:H.length;++v<at;)if(qe(ze,H[v]))return!0;return!1}pr.exports=Gt},54527:function(pr){function Gt(H,ze,qe){return H===H&&(qe!==void 0&&(H=H<=qe?H:qe),ze!==void 0&&(H=H>=ze?H:ze)),H}pr.exports=Gt},92504:function(pr){function Gt(H,ze,qe,v){for(var at=H.length,G=qe+(v?1:-1);v?G--:++G<at;)if(ze(H[G],G,H))return G;return-1}pr.exports=Gt},13807:function(pr,Gt,H){var ze=H(92504),qe=H(99940),v=H(3729);function at(G,Je,Oe){return Je===Je?v(G,Je,Oe):ze(G,qe,Oe)}pr.exports=at},70525:function(pr){function Gt(H,ze,qe,v){for(var at=qe-1,G=H.length;++at<G;)if(v(H[at],ze))return at;return-1}pr.exports=Gt},99940:function(pr){function Gt(H){return H!==H}pr.exports=Gt},66868:function(pr,Gt,H){var ze=H(75697),qe=H(13807),v=H(70525),at=H(58792),G=H(47165),Je=Array.prototype,Oe=Je.splice;function yt(Re,zt,ct,st){var qt=st?v:qe,Yt=-1,ir=zt.length,or=Re;for(Re===zt&&(zt=G(zt)),ct&&(or=ze(Re,at(ct)));++Yt<ir;)for(var Sr=0,_r=zt[Yt],Gr=ct?ct(_r):_r;(Sr=qt(or,Gr,Sr,st))>-1;)or!==Re&&Oe.call(or,Sr,1),Oe.call(Re,Sr,1);return Re}pr.exports=yt},95453:function(pr,Gt,H){var ze=H(78188),qe=H(45170),v=H(94936),at=H(29880),G=H(17319),Je=H(79967),Oe=200;function yt(Re,zt,ct){var st=-1,qt=qe,Yt=Re.length,ir=!0,or=[],Sr=or;if(ct)ir=!1,qt=v;else if(Yt>=Oe){var _r=zt?null:G(Re);if(_r)return Je(_r);ir=!1,qt=at,Sr=new ze}else Sr=zt?[]:or;e:for(;++st<Yt;){var Gr=Re[st],vn=zt?zt(Gr):Gr;if(Gr=ct||Gr!==0?Gr:0,ir&&vn===vn){for(var ii=Sr.length;ii--;)if(Sr[ii]===vn)continue e;zt&&Sr.push(vn),or.push(Gr)}else qt(Sr,vn,ct)||(Sr!==or&&Sr.push(vn),or.push(Gr))}return or}pr.exports=yt},17319:function(pr,Gt,H){var ze=H(81956),qe=H(43226),v=H(79967),at=1/0,G=ze&&1/v(new ze([,-0]))[1]==at?function(Je){return new ze(Je)}:qe;pr.exports=G},3729:function(pr){function Gt(H,ze,qe){for(var v=qe-1,at=H.length;++v<at;)if(H[v]===ze)return v;return-1}pr.exports=Gt},35636:function(pr,Gt,H){var ze=H(54527),qe=H(12448);function v(at,G,Je){return Je===void 0&&(Je=G,G=void 0),Je!==void 0&&(Je=qe(Je),Je=Je===Je?Je:0),G!==void 0&&(G=qe(G),G=G===G?G:0),ze(qe(at),G,Je)}pr.exports=v},66292:function(pr,Gt,H){var ze=H(36838),qe=H(76668),v=H(12448),at="Expected a function",G=Math.max,Je=Math.min;function Oe(yt,Re,zt){var ct,st,qt,Yt,ir,or,Sr=0,_r=!1,Gr=!1,vn=!0;if(typeof yt!="function")throw new TypeError(at);Re=v(Re)||0,ze(zt)&&(_r=!!zt.leading,Gr="maxWait"in zt,qt=Gr?G(v(zt.maxWait)||0,Re):qt,vn="trailing"in zt?!!zt.trailing:vn);function ii(me){var W=ct,he=st;return ct=st=void 0,Sr=me,Yt=yt.apply(he,W),Yt}function Yn(me){return Sr=me,ir=setTimeout(Ft,Re),_r?ii(me):Yt}function xt(me){var W=me-or,he=me-Sr,ae=Re-W;return Gr?Je(ae,qt-he):ae}function Pe(me){var W=me-or,he=me-Sr;return or===void 0||W>=Re||W<0||Gr&&he>=qt}function Ft(){var me=qe();if(Pe(me))return tt(me);ir=setTimeout(Ft,xt(me))}function tt(me){return ir=void 0,vn&&ct?ii(me):(ct=st=void 0,Yt)}function Jt(){ir!==void 0&&clearTimeout(ir),Sr=0,ct=or=st=ir=void 0}function wr(){return ir===void 0?Yt:tt(qe())}function $(){var me=qe(),W=Pe(me);if(ct=arguments,st=this,or=me,W){if(ir===void 0)return Yn(or);if(Gr)return clearTimeout(ir),ir=setTimeout(Ft,Re),ii(or)}return ir===void 0&&(ir=setTimeout(Ft,Re)),Yt}return $.cancel=Jt,$.flush=wr,$}pr.exports=Oe},98071:function(pr,Gt,H){var ze=H(80732),qe=H(55073),v="[object Boolean]";function at(G){return G===!0||G===!1||qe(G)&&ze(G)==v}pr.exports=at},31223:function(pr,Gt,H){var ze=H(6620);function qe(v,at){return ze(v,at)}pr.exports=qe},46207:function(pr){function Gt(H){return H==null}pr.exports=Gt},59933:function(pr,Gt,H){var ze=H(80732),qe=H(55073),v="[object Number]";function at(G){return typeof G=="number"||qe(G)&&ze(G)==v}pr.exports=at},89300:function(pr){function Gt(H){return H===void 0}pr.exports=Gt},53954:function(pr,Gt,H){var ze=H(97254),qe=H(77991),v=qe(function(at,G,Je,Oe){ze(at,G,Je,Oe)});pr.exports=v},43226:function(pr){function Gt(){}pr.exports=Gt},25066:function(pr,Gt,H){var ze=H(5125),qe=H(20396),v=ze(qe);pr.exports=v},20396:function(pr,Gt,H){var ze=H(66868);function qe(v,at){return v&&v.length&&at&&at.length?ze(v,at):v}pr.exports=qe},38209:function(pr,Gt,H){var ze=H(66292),qe=H(36838),v="Expected a function";function at(G,Je,Oe){var yt=!0,Re=!0;if(typeof G!="function")throw new TypeError(v);return qe(Oe)&&(yt="leading"in Oe?!!Oe.leading:yt,Re="trailing"in Oe?!!Oe.trailing:Re),ze(G,Je,{leading:yt,maxWait:Je,trailing:Re})}pr.exports=at},4363:function(pr,Gt,H){var ze=H(95453);function qe(v){return v&&v.length?ze(v):[]}pr.exports=qe},53274:function(pr,Gt,H){var ze=H(8389),qe=0;function v(at){var G=++qe;return ze(at)+G}pr.exports=v},86463:function(pr){(function(Gt,H){pr.exports=H()})(this,function(){"use strict";var Gt,H,ze;function qe(v,at){if(!Gt)Gt=at;else if(!H)H=at;else{var G="var sharedChunk = {}; ("+Gt+")(sharedChunk); ("+H+")(sharedChunk);",Je={};Gt(Je),ze=at(Je),typeof window!="undefined"&&(ze.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}return qe(["exports"],function(v){"use strict";function at(n,o){return n(o={exports:{}},o.exports),o.exports}var G=Je;function Je(n,o,s,p){this.cx=3*n,this.bx=3*(s-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=p,this.p2x=s,this.p2y=p}Je.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},Je.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},Je.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},Je.prototype.solveCurveX=function(n,o){var s,p,g,y,E;for(o===void 0&&(o=1e-6),g=n,E=0;E<8;E++){if(y=this.sampleCurveX(g)-n,Math.abs(y)<o)return g;var w=this.sampleCurveDerivativeX(g);if(Math.abs(w)<1e-6)break;g-=y/w}if((g=n)<(s=0))return s;if(g>(p=1))return p;for(;s<p;){if(y=this.sampleCurveX(g),Math.abs(y-n)<o)return g;n>y?s=g:p=g,g=.5*(p-s)+s}return g},Je.prototype.solve=function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))};var Oe=yt;function yt(n,o){this.x=n,this.y=o}yt.prototype={clone:function(){return new yt(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,o){return this.clone()._rotateAround(n,o)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var o=n.x-this.x,s=n.y-this.y;return o*o+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,o){return Math.atan2(this.x*o-this.y*n,this.x*n+this.y*o)},_matMult:function(n){var o=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=o,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var o=Math.cos(n),s=Math.sin(n),p=s*this.x+o*this.y;return this.x=o*this.x-s*this.y,this.y=p,this},_rotateAround:function(n,o){var s=Math.cos(n),p=Math.sin(n),g=o.y+p*(this.x-o.x)+s*(this.y-o.y);return this.x=o.x+s*(this.x-o.x)-p*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yt.convert=function(n){return n instanceof yt?n:Array.isArray(n)?new yt(n[0],n[1]):n};var Re=typeof self!="undefined"?self:{},zt=Math.pow(2,53)-1;function ct(n,o,s,p){var g=new G(n,o,s,p);return function(y){return g.solve(y)}}var st=ct(.25,.1,.25,1);function qt(n,o,s){return Math.min(s,Math.max(o,n))}function Yt(n,o,s){var p=s-o,g=((n-o)%p+p)%p+o;return g===o?s:g}function ir(n){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];for(var p=0,g=o;p<g.length;p+=1){var y=g[p];for(var E in y)n[E]=y[E]}return n}var or=1;function Sr(){return or++}function _r(){return function n(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Gr(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function vn(n,o){n.forEach(function(s){o[s]&&(o[s]=o[s].bind(o))})}function ii(n,o){return n.indexOf(o,n.length-o.length)!==-1}function Yn(n,o,s){var p={};for(var g in n)p[g]=o.call(s||this,n[g],g,n);return p}function xt(n,o,s){var p={};for(var g in n)o.call(s||this,n[g],g,n)&&(p[g]=n[g]);return p}function Pe(n){return Array.isArray(n)?n.map(Pe):typeof n=="object"&&n?Yn(n,Pe):n}var Ft={};function tt(n){Ft[n]||(typeof console!="undefined"&&console.warn(n),Ft[n]=!0)}function Jt(n,o,s){return(s.y-n.y)*(o.x-n.x)>(o.y-n.y)*(s.x-n.x)}function wr(n){for(var o=0,s=0,p=n.length,g=p-1,y=void 0,E=void 0;s<p;g=s++)o+=((E=n[g]).x-(y=n[s]).x)*(y.y+E.y);return o}function $(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function me(n){var o={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,g,y,E){var w=y||E;return o[g]=!w||w.toLowerCase(),""}),o["max-age"]){var s=parseInt(o["max-age"],10);isNaN(s)?delete o["max-age"]:o["max-age"]=s}return o}var W=null;function he(n){if(W==null){var o=n.navigator?n.navigator.userAgent:null;W=!!n.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return W}function ae(n){try{var o=Re[n];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var Me,je,ut,St,bt=Re.performance&&Re.performance.now?Re.performance.now.bind(Re.performance):Date.now.bind(Date),Lr=Re.requestAnimationFrame||Re.mozRequestAnimationFrame||Re.webkitRequestAnimationFrame||Re.msRequestAnimationFrame,Cr=Re.cancelAnimationFrame||Re.mozCancelAnimationFrame||Re.webkitCancelAnimationFrame||Re.msCancelAnimationFrame,On={now:bt,frame:function(n){var o=Lr(n);return{cancel:function(){return Cr(o)}}},getImageData:function(n,o){o===void 0&&(o=0);var s=Re.document.createElement("canvas"),p=s.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return s.width=n.width,s.height=n.height,p.drawImage(n,0,0,n.width,n.height),p.getImageData(-o,-o,n.width+2*o,n.height+2*o)},resolveURL:function(n){return Me||(Me=Re.document.createElement("a")),Me.href=n,Me.href},hardwareConcurrency:Re.navigator&&Re.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Re.devicePixelRatio},get prefersReducedMotion(){return!!Re.matchMedia&&(je==null&&(je=Re.matchMedia("(prefers-reduced-motion: reduce)")),je.matches)}},Xr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},xn={supported:!1,testSupport:function(n){!Yr&&St&&(rn?Kr(n):ut=n)}},Yr=!1,rn=!1;function Kr(n){var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,St),n.isContextLost())return;xn.supported=!0}catch(s){}n.deleteTexture(o),Yr=!0}Re.document&&((St=Re.document.createElement("img")).onload=function(){ut&&Kr(ut),ut=null,rn=!0},St.onerror=function(){Yr=!0,ut=null},St.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Qn="01",Ur=function(n,o){this._transformRequestFn=n,this._customAccessToken=o,this._createSkuToken()};function Mn(n){return n.indexOf("mapbox:")===0}Ur.prototype._createSkuToken=function(){var n=function(){for(var o="",s=0;s<10;s++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qn,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt},Ur.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ur.prototype.transformRequest=function(n,o){return this._transformRequestFn&&this._transformRequestFn(n,o)||{url:n}},Ur.prototype.normalizeStyleURL=function(n,o){if(!Mn(n))return n;var s=gi(n);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||o)},Ur.prototype.normalizeGlyphsURL=function(n,o){if(!Mn(n))return n;var s=gi(n);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||o)},Ur.prototype.normalizeSourceURL=function(n,o){if(!Mn(n))return n;var s=gi(n);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||o)},Ur.prototype.normalizeSpriteURL=function(n,o,s,p){var g=gi(n);return Mn(n)?(g.path="/styles/v1"+g.path+"/sprite"+o+s,this._makeAPIURL(g,this._customAccessToken||p)):(g.path+=""+o+s,_o(g))},Ur.prototype.normalizeTileURL=function(n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Mn(n))return n;var s=gi(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(On.devicePixelRatio>=2||o===512?"@2x":"")+(xn.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var p=this._customAccessToken||function(g){for(var y=0,E=g;y<E.length;y+=1){var w=E[y].match(/^access_token=(.*)$/);if(w)return w[1]}return null}(s.params)||Xr.ACCESS_TOKEN;return Xr.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,p)},Ur.prototype.canonicalizeTileURL=function(n,o){var s=gi(n);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return n;var p="mapbox://tiles/";p+=s.path.replace("/v4/","");var g=s.params;return o&&(g=g.filter(function(y){return!y.match(/^access_token=/)})),g.length&&(p+="?"+g.join("&")),p},Ur.prototype.canonicalizeTileset=function(n,o){for(var s=!!o&&Mn(o),p=[],g=0,y=n.tiles||[];g<y.length;g+=1){var E=y[g];un(E)?p.push(this.canonicalizeTileURL(E,s)):p.push(E)}return p},Ur.prototype._makeAPIURL=function(n,o){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=gi(Xr.API_URL);if(n.protocol=p.protocol,n.authority=p.authority,n.protocol==="http"){var g=n.params.indexOf("secure");g>=0&&n.params.splice(g,1)}if(p.path!=="/"&&(n.path=""+p.path+n.path),!Xr.REQUIRE_ACCESS_TOKEN)return _o(n);if(!(o=o||Xr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return n.params=n.params.filter(function(y){return y.indexOf("access_token")===-1}),n.params.push("access_token="+o),_o(n)};var $r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function un(n){return $r.test(n)}var zi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gi(n){var o=n.match(zi);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function _o(n){var o=n.params.length?"?"+n.params.join("&"):"";return n.protocol+"://"+n.authority+n.path+o}function Ii(n){if(!n)return null;var o=n.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(Re.atob(o[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var ie=function(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ie.prototype.getStorageKey=function(n){var o,s=Ii(Xr.ACCESS_TOKEN);return o=s&&s.u?Re.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(p,g){return String.fromCharCode(+("0x"+g))})):Xr.ACCESS_TOKEN||"",n?"mapbox.eventData."+n+":"+o:"mapbox.eventData:"+o},ie.prototype.fetchEventData=function(){var n=ae("localStorage"),o=this.getStorageKey(),s=this.getStorageKey("uuid");if(n)try{var p=Re.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var g=Re.localStorage.getItem(s);g&&(this.anonId=g)}catch(y){tt("Unable to read from LocalStorage")}},ie.prototype.saveEventData=function(){var n=ae("localStorage"),o=this.getStorageKey(),s=this.getStorageKey("uuid");if(n)try{Re.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Re.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){tt("Unable to write to LocalStorage")}},ie.prototype.processRequests=function(n){},ie.prototype.postEvent=function(n,o,s,p){var g=this;if(Xr.EVENTS_URL){var y=gi(Xr.EVENTS_URL);y.params.push("access_token="+(p||Xr.ACCESS_TOKEN||""));var E={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Qn,userId:this.anonId},w=o?ir(E,o):E,M={url:_o(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=It(M,function(L){g.pendingRequest=null,s(L),g.saveEventData(),g.processRequests(p)})}},ie.prototype.queueRequest=function(n,o){this.queue.push(n),this.processRequests(o)};var Wi,Ji,to=function(n){function o(){n.call(this,"map.load"),this.success={},this.skuToken=""}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(s,p,g,y){this.skuToken=g;var E=!(!y&&!Xr.ACCESS_TOKEN),w=Array.isArray(s)&&s.some(function(M){return Mn(M)||un(M)});Xr.EVENTS_URL&&E&&w&&this.queueRequest({id:p,timestamp:Date.now()},y)},o.prototype.processRequests=function(s){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var g=this.queue.shift(),y=g.id,E=g.timestamp;y&&this.success[y]||(this.anonId||this.fetchEventData(),Gr(this.anonId)||(this.anonId=_r()),this.postEvent(E,{skuToken:this.skuToken},function(w){w||y&&(p.success[y]=!0)},s))}},o}(ie),aa=new(function(n){function o(s){n.call(this,"appUserTurnstile"),this._customAccessToken=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(s,p){Xr.EVENTS_URL&&Xr.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(g){return Mn(g)||un(g)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(s){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var g=Ii(Xr.ACCESS_TOKEN),y=g?g.u:Xr.ACCESS_TOKEN,E=y!==this.eventData.tokenU;Gr(this.anonId)||(this.anonId=_r(),E=!0);var w=this.queue.shift();if(this.eventData.lastSuccess){var M=new Date(this.eventData.lastSuccess),L=new Date(w),k=(w-this.eventData.lastSuccess)/864e5;E=E||k>=1||k<-1||M.getDate()!==L.getDate()}else E=!0;if(!E)return this.processRequests();this.postEvent(w,{"enabled.telemetry":!1},function(Z){Z||(p.eventData.lastSuccess=w,p.eventData.tokenU=y)},s)}},o}(ie)),ea=aa.postTurnstileEvent.bind(aa),Bs=new to,Vo=Bs.postMapLoadEvent.bind(Bs),Ws=500,_u=50;function Do(){Re.caches&&!Wi&&(Wi=Re.caches.open("mapbox-tiles"))}function uo(n){var o=n.indexOf("?");return o<0?n:n.slice(0,o)}var lo,ot=1/0;function z(){return lo==null&&(lo=Re.OffscreenCanvas&&new Re.OffscreenCanvas(1,1).getContext("2d")&&typeof Re.createImageBitmap=="function"),lo}var K={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(K);var de=function(n){function o(s,p,g){p===401&&un(g)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),n.call(this,s),this.status=p,this.url=g,this.name=this.constructor.name,this.message=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Fe=$()?function(){return self.worker&&self.worker.referrer}:function(){return(Re.location.protocol==="blob:"?Re.parent:Re).location.href},Ce,Nt,Bt=function(n,o){if(!(/^file:/.test(s=n.url)||/^file:/.test(Fe())&&!/^\w+:/.test(s))){if(Re.fetch&&Re.Request&&Re.AbortController&&Re.Request.prototype.hasOwnProperty("signal"))return function(p,g){var y,E=new Re.AbortController,w=new Re.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:Fe(),signal:E.signal}),M=!1,L=!1,k=(y=w.url).indexOf("sku=")>0&&un(y);p.type==="json"&&w.headers.set("Accept","application/json");var Z=function(te,ye,Te){if(!L){if(te&&te.message!=="SecurityError"&&tt(te),ye&&Te)return q(ye);var Ge=Date.now();Re.fetch(w).then(function(Le){if(Le.ok){var nt=k?Le.clone():null;return q(Le,nt,Ge)}return g(new de(Le.statusText,Le.status,p.url))}).catch(function(Le){Le.code!==20&&g(new Error(Le.message))})}},q=function(te,ye,Te){(p.type==="arrayBuffer"?te.arrayBuffer():p.type==="json"?te.json():te.text()).then(function(Ge){L||(ye&&Te&&function(Le,nt,ft){if(Do(),Wi){var Pt={status:nt.status,statusText:nt.statusText,headers:new Re.Headers};nt.headers.forEach(function(er,Ar){return Pt.headers.set(Ar,er)});var Ut=me(nt.headers.get("Cache-Control")||"");Ut["no-store"]||(Ut["max-age"]&&Pt.headers.set("Expires",new Date(ft+1e3*Ut["max-age"]).toUTCString()),new Date(Pt.headers.get("Expires")).getTime()-ft<42e4||function(er,Ar){if(Ji===void 0)try{new Response(new ReadableStream),Ji=!0}catch(Nr){Ji=!1}Ji?Ar(er.body):er.blob().then(Ar)}(nt,function(er){var Ar=new Re.Response(er,Pt);Do(),Wi&&Wi.then(function(Nr){return Nr.put(uo(Le.url),Ar)}).catch(function(Nr){return tt(Nr.message)})}))}}(w,ye,Te),M=!0,g(null,Ge,te.headers.get("Cache-Control"),te.headers.get("Expires")))}).catch(function(Ge){L||g(new Error(Ge.message))})};return k?function(te,ye){if(Do(),!Wi)return ye(null);var Te=uo(te.url);Wi.then(function(Ge){Ge.match(Te).then(function(Le){var nt=function(ft){if(!ft)return!1;var Pt=new Date(ft.headers.get("Expires")||0),Ut=me(ft.headers.get("Cache-Control")||"");return Pt>Date.now()&&!Ut["no-cache"]}(Le);Ge.delete(Te),nt&&Ge.put(Te,Le.clone()),ye(null,Le,nt)}).catch(ye)}).catch(ye)}(w,Z):Z(null,null),{cancel:function(){L=!0,M||E.abort()}}}(n,o);if($()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,o,void 0,!0)}var s;return function(p,g){var y=new Re.XMLHttpRequest;for(var E in y.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(y.responseType="arraybuffer"),p.headers)y.setRequestHeader(E,p.headers[E]);return p.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=p.credentials==="include",y.onerror=function(){g(new Error(y.statusText))},y.onload=function(){if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){var w=y.response;if(p.type==="json")try{w=JSON.parse(y.response)}catch(M){return g(M)}g(null,w,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else g(new de(y.statusText,y.status,p.url))},y.send(p.body),{cancel:function(){return y.abort()}}}(n,o)},sr=function(n,o){return Bt(ir(n,{type:"arrayBuffer"}),o)},It=function(n,o){return Bt(ir(n,{method:"POST"}),o)},B="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ce=[],Nt=0;var P=function(n,o){if(xn.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Nt>=Xr.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:n,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ce.push(s),s}Nt++;var p=!1,g=function(){if(!p)for(p=!0,Nt--;Ce.length&&Nt<Xr.MAX_PARALLEL_IMAGE_REQUESTS;){var E=Ce.shift();E.cancelled||(E.cancel=P(E.requestParameters,E.callback).cancel)}},y=sr(n,function(E,w,M,L){g(),E?o(E):w&&(z()?function(k,Z){var q=new Re.Blob([new Uint8Array(k)],{type:"image/png"});Re.createImageBitmap(q).then(function(te){Z(null,te)}).catch(function(te){Z(new Error("Could not load image because of "+te.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(w,o):function(k,Z,q,te){var ye=new Re.Image,Te=Re.URL;ye.onload=function(){Z(null,ye),Te.revokeObjectURL(ye.src),ye.onload=null,Re.requestAnimationFrame(function(){ye.src=B})},ye.onerror=function(){return Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ge=new Re.Blob([new Uint8Array(k)],{type:"image/png"});ye.cacheControl=q,ye.expires=te,ye.src=k.byteLength?Te.createObjectURL(Ge):B}(w,o,M,L))});return{cancel:function(){y.cancel(),g()}}};function V(n,o,s){s[n]&&s[n].indexOf(o)!==-1||(s[n]=s[n]||[],s[n].push(o))}function Y(n,o,s){if(s&&s[n]){var p=s[n].indexOf(o);p!==-1&&s[n].splice(p,1)}}var ce=function(n,o){o===void 0&&(o={}),ir(this,o),this.type=n},Se=function(n){function o(s,p){p===void 0&&(p={}),n.call(this,"error",ir({error:s},p))}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(ce),Ue=function(){};Ue.prototype.on=function(n,o){return this._listeners=this._listeners||{},V(n,o,this._listeners),this},Ue.prototype.off=function(n,o){return Y(n,o,this._listeners),Y(n,o,this._oneTimeListeners),this},Ue.prototype.once=function(n,o){return this._oneTimeListeners=this._oneTimeListeners||{},V(n,o,this._oneTimeListeners),this},Ue.prototype.fire=function(n,o){typeof n=="string"&&(n=new ce(n,o||{}));var s=n.type;if(this.listens(s)){n.target=this;for(var p=0,g=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];p<g.length;p+=1)g[p].call(this,n);for(var y=0,E=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];y<E.length;y+=1){var w=E[y];Y(s,w,this._oneTimeListeners),w.call(this,n)}var M=this._eventedParent;M&&(ir(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),M.fire(n))}else n instanceof Se&&console.error(n.error);return this},Ue.prototype.listens=function(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)},Ue.prototype.setEventedParent=function(n,o){return this._eventedParent=n,this._eventedParentData=o,this};var Q={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ve=function(n,o,s,p){this.message=(n?n+": ":"")+s,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function rt(n){var o=n.value;return o?[new ve(n.key,o,"constants have been deprecated as of v8")]:[]}function wt(n){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];for(var p=0,g=o;p<g.length;p+=1){var y=g[p];for(var E in y)n[E]=y[E]}return n}function nr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function _t(n){if(Array.isArray(n))return n.map(_t);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){var o={};for(var s in n)o[s]=_t(n[s]);return o}return nr(n)}var Qt=function(n){function o(s,p){n.call(this,p),this.message=p,this.key=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Error),Br=function(n,o){o===void 0&&(o=[]),this.parent=n,this.bindings={};for(var s=0,p=o;s<p.length;s+=1){var g=p[s];this.bindings[g[0]]=g[1]}};Br.prototype.concat=function(n){return new Br(this,n)},Br.prototype.get=function(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(n+" not found in scope.")},Br.prototype.has=function(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)};var Fr={kind:"null"},Mt={kind:"number"},Dr={kind:"string"},Er={kind:"boolean"},Rr={kind:"color"},zn={kind:"object"},jr={kind:"value"},qn={kind:"collator"},Li={kind:"formatted"},ei={kind:"resolvedImage"};function Ai(n,o){return{kind:"array",itemType:n,N:o}}function di(n){if(n.kind==="array"){var o=di(n.itemType);return typeof n.N=="number"?"array<"+o+", "+n.N+">":n.itemType.kind==="value"?"array":"array<"+o+">"}return n.kind}var Aa=[Fr,Mt,Dr,Er,Rr,Li,zn,Ai(jr),ei];function Bi(n,o){if(o.kind==="error")return null;if(n.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Bi(n.itemType,o.itemType))&&(typeof n.N!="number"||n.N===o.N))return null}else{if(n.kind===o.kind)return null;if(n.kind==="value"){for(var s=0,p=Aa;s<p.length;s+=1)if(!Bi(p[s],o))return null}}return"Expected "+di(n)+" but found "+di(o)+" instead."}function ro(n,o){return o.some(function(s){return s.kind===n.kind})}function mi(n,o){return o.some(function(s){return s==="null"?n===null:s==="array"?Array.isArray(n):s==="object"?n&&!Array.isArray(n)&&typeof n=="object":s===typeof n})}var Jn=at(function(n,o){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(w){return(w=Math.round(w))<0?0:w>255?255:w}function g(w){return p(w[w.length-1]==="%"?parseFloat(w)/100*255:parseInt(w))}function y(w){return(M=w[w.length-1]==="%"?parseFloat(w)/100:parseFloat(w))<0?0:M>1?1:M;var M}function E(w,M,L){return L<0?L+=1:L>1&&(L-=1),6*L<1?w+(M-w)*L*6:2*L<1?M:3*L<2?w+(M-w)*(2/3-L)*6:w}try{o.parseCSSColor=function(w){var M,L=w.replace(/ /g,"").toLowerCase();if(L in s)return s[L].slice();if(L[0]==="#")return L.length===4?(M=parseInt(L.substr(1),16))>=0&&M<=4095?[(3840&M)>>4|(3840&M)>>8,240&M|(240&M)>>4,15&M|(15&M)<<4,1]:null:L.length===7&&(M=parseInt(L.substr(1),16))>=0&&M<=16777215?[(16711680&M)>>16,(65280&M)>>8,255&M,1]:null;var k=L.indexOf("("),Z=L.indexOf(")");if(k!==-1&&Z+1===L.length){var q=L.substr(0,k),te=L.substr(k+1,Z-(k+1)).split(","),ye=1;switch(q){case"rgba":if(te.length!==4)return null;ye=y(te.pop());case"rgb":return te.length!==3?null:[g(te[0]),g(te[1]),g(te[2]),ye];case"hsla":if(te.length!==4)return null;ye=y(te.pop());case"hsl":if(te.length!==3)return null;var Te=(parseFloat(te[0])%360+360)%360/360,Ge=y(te[1]),Le=y(te[2]),nt=Le<=.5?Le*(Ge+1):Le+Ge-Le*Ge,ft=2*Le-nt;return[p(255*E(ft,nt,Te+1/3)),p(255*E(ft,nt,Te)),p(255*E(ft,nt,Te-1/3)),ye];default:return null}}return null}}catch(w){}}).parseCSSColor,oi=function(n,o,s,p){p===void 0&&(p=1),this.r=n,this.g=o,this.b=s,this.a=p};oi.parse=function(n){if(n){if(n instanceof oi)return n;if(typeof n=="string"){var o=Jn(n);if(o)return new oi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},oi.prototype.toString=function(){var n=this.toArray(),o=n[1],s=n[2],p=n[3];return"rgba("+Math.round(n[0])+","+Math.round(o)+","+Math.round(s)+","+p+")"},oi.prototype.toArray=function(){var n=this.a;return n===0?[0,0,0,0]:[255*this.r/n,255*this.g/n,255*this.b/n,n]},oi.black=new oi(0,0,0,1),oi.white=new oi(1,1,1,1),oi.transparent=new oi(0,0,0,0),oi.red=new oi(1,0,0,1);var bo=function(n,o,s){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};bo.prototype.compare=function(n,o){return this.collator.compare(n,o)},bo.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Fs=function(n,o,s,p,g){this.text=n,this.image=o,this.scale=s,this.fontStack=p,this.textColor=g},eo=function(n){this.sections=n};eo.fromString=function(n){return new eo([new Fs(n,null,null,null,null)])},eo.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(n){return n.text.length!==0||n.image&&n.image.name.length!==0})},eo.factory=function(n){return n instanceof eo?n:eo.fromString(n)},eo.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(n){return n.text}).join("")},eo.prototype.serialize=function(){for(var n=["format"],o=0,s=this.sections;o<s.length;o+=1){var p=s[o];if(p.image)n.push(["image",p.image.name]);else{n.push(p.text);var g={};p.fontStack&&(g["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(g["font-scale"]=p.scale),p.textColor&&(g["text-color"]=["rgba"].concat(p.textColor.toArray())),n.push(g)}}return n};var co=function(n){this.name=n.name,this.available=n.available};function yu(n,o,s,p){return typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof s=="number"&&s>=0&&s<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[n,o,s,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[n,o,s,p]:[n,o,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function _s(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof oi||n instanceof bo||n instanceof eo||n instanceof co)return!0;if(Array.isArray(n)){for(var o=0,s=n;o<s.length;o+=1)if(!_s(s[o]))return!1;return!0}if(typeof n=="object"){for(var p in n)if(!_s(n[p]))return!1;return!0}return!1}function Gi(n){if(n===null)return Fr;if(typeof n=="string")return Dr;if(typeof n=="boolean")return Er;if(typeof n=="number")return Mt;if(n instanceof oi)return Rr;if(n instanceof bo)return qn;if(n instanceof eo)return Li;if(n instanceof co)return ei;if(Array.isArray(n)){for(var o,s=n.length,p=0,g=n;p<g.length;p+=1){var y=Gi(g[p]);if(o){if(o===y)continue;o=jr;break}o=y}return Ai(o||jr,s)}return zn}function sa(n){var o=typeof n;return n===null?"":o==="string"||o==="number"||o==="boolean"?String(n):n instanceof oi||n instanceof eo||n instanceof co?n.toString():JSON.stringify(n)}co.prototype.toString=function(){return this.name},co.fromString=function(n){return n?new co({name:n,available:!1}):null},co.prototype.serialize=function(){return["image",this.name]};var no=function(n,o){this.type=n,this.value=o};no.parse=function(n,o){if(n.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(!_s(n[1]))return o.error("invalid value");var s=n[1],p=Gi(s),g=o.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new no(p,s)},no.prototype.evaluate=function(){return this.value},no.prototype.eachChild=function(){},no.prototype.outputDefined=function(){return!0},no.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof oi?["rgba"].concat(this.value.toArray()):this.value instanceof eo?this.value.serialize():this.value};var yo=function(n){this.name="ExpressionEvaluationError",this.message=n};yo.prototype.toJSON=function(){return this.message};var Fa={string:Dr,number:Mt,boolean:Er,object:zn},Ki=function(n,o){this.type=n,this.args=o};Ki.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var s,p=1,g=n[0];if(g==="array"){var y,E;if(n.length>2){var w=n[1];if(typeof w!="string"||!(w in Fa)||w==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);y=Fa[w],p++}else y=jr;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);E=n[2],p++}s=Ai(y,E)}else s=Fa[g];for(var M=[];p<n.length;p++){var L=o.parse(n[p],p,jr);if(!L)return null;M.push(L)}return new Ki(s,M)},Ki.prototype.evaluate=function(n){for(var o=0;o<this.args.length;o++){var s=this.args[o].evaluate(n);if(!Bi(this.type,Gi(s)))return s;if(o===this.args.length-1)throw new yo("Expected value to be of type "+di(this.type)+", but found "+di(Gi(s))+" instead.")}return null},Ki.prototype.eachChild=function(n){this.args.forEach(n)},Ki.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},Ki.prototype.serialize=function(){var n=this.type,o=[n.kind];if(n.kind==="array"){var s=n.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){o.push(s.kind);var p=n.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(g){return g.serialize()}))};var Wa=function(n){this.type=Li,this.sections=n};Wa.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var s=n[1];if(!Array.isArray(s)&&typeof s=="object")return o.error("First argument must be an image or text section.");for(var p=[],g=!1,y=1;y<=n.length-1;++y){var E=n[y];if(g&&typeof E=="object"&&!Array.isArray(E)){g=!1;var w=null;if(E["font-scale"]&&!(w=o.parse(E["font-scale"],1,Mt)))return null;var M=null;if(E["text-font"]&&!(M=o.parse(E["text-font"],1,Ai(Dr))))return null;var L=null;if(E["text-color"]&&!(L=o.parse(E["text-color"],1,Rr)))return null;var k=p[p.length-1];k.scale=w,k.font=M,k.textColor=L}else{var Z=o.parse(n[y],1,jr);if(!Z)return null;var q=Z.type.kind;if(q!=="string"&&q!=="value"&&q!=="null"&&q!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:Z,scale:null,font:null,textColor:null})}}return new Wa(p)},Wa.prototype.evaluate=function(n){return new eo(this.sections.map(function(o){var s=o.content.evaluate(n);return Gi(s)===ei?new Fs("",s,null,null,null):new Fs(sa(s),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))},Wa.prototype.eachChild=function(n){for(var o=0,s=this.sections;o<s.length;o+=1){var p=s[o];n(p.content),p.scale&&n(p.scale),p.font&&n(p.font),p.textColor&&n(p.textColor)}},Wa.prototype.outputDefined=function(){return!1},Wa.prototype.serialize=function(){for(var n=["format"],o=0,s=this.sections;o<s.length;o+=1){var p=s[o];n.push(p.content.serialize());var g={};p.scale&&(g["font-scale"]=p.scale.serialize()),p.font&&(g["text-font"]=p.font.serialize()),p.textColor&&(g["text-color"]=p.textColor.serialize()),n.push(g)}return n};var Na=function(n){this.type=ei,this.input=n};Na.parse=function(n,o){if(n.length!==2)return o.error("Expected two arguments.");var s=o.parse(n[1],1,Dr);return s?new Na(s):o.error("No image name provided.")},Na.prototype.evaluate=function(n){var o=this.input.evaluate(n),s=co.fromString(o);return s&&n.availableImages&&(s.available=n.availableImages.indexOf(o)>-1),s},Na.prototype.eachChild=function(n){n(this.input)},Na.prototype.outputDefined=function(){return!1},Na.prototype.serialize=function(){return["image",this.input.serialize()]};var xu={"to-boolean":Er,"to-color":Rr,"to-number":Mt,"to-string":Dr},ys=function(n,o){this.type=n,this.args=o};ys.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var s=n[0];if((s==="to-boolean"||s==="to-string")&&n.length!==2)return o.error("Expected one argument.");for(var p=xu[s],g=[],y=1;y<n.length;y++){var E=o.parse(n[y],y,jr);if(!E)return null;g.push(E)}return new ys(p,g)},ys.prototype.evaluate=function(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){for(var o,s,p=0,g=this.args;p<g.length;p+=1){if(s=null,(o=g[p].evaluate(n))instanceof oi)return o;if(typeof o=="string"){var y=n.parseColor(o);if(y)return y}else if(Array.isArray(o)&&!(s=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":yu(o[0],o[1],o[2],o[3])))return new oi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new yo(s||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var E=null,w=0,M=this.args;w<M.length;w+=1){if((E=M[w].evaluate(n))===null)return 0;var L=Number(E);if(!isNaN(L))return L}throw new yo("Could not convert "+JSON.stringify(E)+" to number.")}return this.type.kind==="formatted"?eo.fromString(sa(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?co.fromString(sa(this.args[0].evaluate(n))):sa(this.args[0].evaluate(n))},ys.prototype.eachChild=function(n){this.args.forEach(n)},ys.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},ys.prototype.serialize=function(){if(this.type.kind==="formatted")return new Wa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Na(this.args[0]).serialize();var n=["to-"+this.type.kind];return this.eachChild(function(o){n.push(o.serialize())}),n};var yc=["Unknown","Point","LineString","Polygon"],Bo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Bo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Bo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?yc[this.feature.type]:this.feature.type:null},Bo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Bo.prototype.canonicalID=function(){return this.canonical},Bo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Bo.prototype.parseColor=function(n){var o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=oi.parse(n)),o};var Yi=function(n,o,s,p){this.name=n,this.type=o,this._evaluate=s,this.args=p};Yi.prototype.evaluate=function(n){return this._evaluate(n,this.args)},Yi.prototype.eachChild=function(n){this.args.forEach(n)},Yi.prototype.outputDefined=function(){return!1},Yi.prototype.serialize=function(){return[this.name].concat(this.args.map(function(n){return n.serialize()}))},Yi.parse=function(n,o){var s,p=n[0],g=Yi.definitions[p];if(!g)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var y=Array.isArray(g)?g[0]:g.type,E=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,w=E.filter(function(En){var tn=En[0];return!Array.isArray(tn)||tn.length===n.length-1}),M=null,L=0,k=w;L<k.length;L+=1){var Z=k[L],q=Z[0],te=Z[1];M=new Du(o.registry,o.path,null,o.scope);for(var ye=[],Te=!1,Ge=1;Ge<n.length;Ge++){var Le=n[Ge],nt=Array.isArray(q)?q[Ge-1]:q.type,ft=M.parse(Le,1+ye.length,nt);if(!ft){Te=!0;break}ye.push(ft)}if(!Te)if(Array.isArray(q)&&q.length!==ye.length)M.error("Expected "+q.length+" arguments, but found "+ye.length+" instead.");else{for(var Pt=0;Pt<ye.length;Pt++){var Ut=Array.isArray(q)?q[Pt]:q.type,er=ye[Pt];M.concat(Pt+1).checkSubtype(Ut,er.type)}if(M.errors.length===0)return new Yi(p,y,te,ye)}}if(w.length===1)(s=o.errors).push.apply(s,M.errors);else{for(var Ar=(w.length?w:E).map(function(En){var tn;return tn=En[0],Array.isArray(tn)?"("+tn.map(di).join(", ")+")":"("+di(tn.type)+"...)"}).join(" | "),Nr=[],yn=1;yn<n.length;yn++){var en=o.parse(n[yn],1+Nr.length);if(!en)return null;Nr.push(di(en.type))}o.error("Expected arguments of type "+Ar+", but found ("+Nr.join(", ")+") instead.")}return null},Yi.register=function(n,o){for(var s in Yi.definitions=o,o)n[s]=Yi};var $a=function(n,o,s){this.type=qn,this.locale=s,this.caseSensitive=n,this.diacriticSensitive=o};function Zo(n,o){n[0]=Math.min(n[0],o[0]),n[1]=Math.min(n[1],o[1]),n[2]=Math.max(n[2],o[0]),n[3]=Math.max(n[3],o[1])}function re(n,o){return!(n[0]<=o[0]||n[2]>=o[2]||n[1]<=o[1]||n[3]>=o[3])}function pe(n,o){var s=(180+n[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,g=Math.pow(2,o.z);return[Math.round(s*g*8192),Math.round(p*g*8192)]}function Ke(n,o,s){return o[1]>n[1]!=s[1]>n[1]&&n[0]<(s[0]-o[0])*(n[1]-o[1])/(s[1]-o[1])+o[0]}function Vt(n,o){for(var s,p,g,y,E,w,M,L=!1,k=0,Z=o.length;k<Z;k++)for(var q=o[k],te=0,ye=q.length;te<ye-1;te++){if((y=(s=n)[0]-(p=q[te])[0])*(M=s[1]-(g=q[te+1])[1])-(w=s[0]-g[0])*(E=s[1]-p[1])==0&&y*w<=0&&E*M<=0)return!1;Ke(n,q[te],q[te+1])&&(L=!L)}return L}function yr(n,o){for(var s=0;s<o.length;s++)if(Vt(n,o[s]))return!0;return!1}function dn(n,o,s,p){var g=p[0]-s[0],y=p[1]-s[1],E=(n[0]-s[0])*y-g*(n[1]-s[1]),w=(o[0]-s[0])*y-g*(o[1]-s[1]);return E>0&&w<0||E<0&&w>0}function Si(n,o,s){for(var p=0,g=s;p<g.length;p+=1)for(var y=g[p],E=0;E<y.length-1;++E)if((Z=[(k=y[E+1])[0]-(L=y[E])[0],k[1]-L[1]])[0]*(q=[(M=o)[0]-(w=n)[0],M[1]-w[1]])[1]-Z[1]*q[0]!=0&&dn(w,M,L,k)&&dn(L,k,w,M))return!0;var w,M,L,k,Z,q;return!1}function jo(n,o){for(var s=0;s<n.length;++s)if(!Vt(n[s],o))return!1;for(var p=0;p<n.length-1;++p)if(Si(n[p],n[p+1],o))return!1;return!0}function ua(n,o){for(var s=0;s<o.length;s++)if(jo(n,o[s]))return!0;return!1}function Ho(n,o,s){for(var p=[],g=0;g<n.length;g++){for(var y=[],E=0;E<n[g].length;E++){var w=pe(n[g][E],s);Zo(o,w),y.push(w)}p.push(y)}return p}function xs(n,o,s){for(var p=[],g=0;g<n.length;g++){var y=Ho(n[g],o,s);p.push(y)}return p}function bs(n,o,s,p){if(n[0]<s[0]||n[0]>s[2]){var g=.5*p,y=n[0]-s[0]>g?-p:s[0]-n[0]>g?p:0;y===0&&(y=n[0]-s[2]>g?-p:s[2]-n[0]>g?p:0),n[0]+=y}Zo(o,n)}function th(n,o,s,p){for(var g=8192*Math.pow(2,p.z),y=[8192*p.x,8192*p.y],E=[],w=0,M=n;w<M.length;w+=1)for(var L=0,k=M[w];L<k.length;L+=1){var Z=k[L],q=[Z.x+y[0],Z.y+y[1]];bs(q,o,s,g),E.push(q)}return E}function Ch(n,o,s,p){for(var g,y=8192*Math.pow(2,p.z),E=[8192*p.x,8192*p.y],w=[],M=0,L=n;M<L.length;M+=1){for(var k=[],Z=0,q=L[M];Z<q.length;Z+=1){var te=q[Z],ye=[te.x+E[0],te.y+E[1]];Zo(o,ye),k.push(ye)}w.push(k)}if(o[2]-o[0]<=y/2){(g=o)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(var Te=0,Ge=w;Te<Ge.length;Te+=1)for(var Le=0,nt=Ge[Te];Le<nt.length;Le+=1)bs(nt[Le],o,s,y)}return w}$a.parse=function(n,o){if(n.length!==2)return o.error("Expected one argument.");var s=n[1];if(typeof s!="object"||Array.isArray(s))return o.error("Collator options argument must be an object.");var p=o.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Er);if(!p)return null;var g=o.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Er);if(!g)return null;var y=null;return s.locale&&!(y=o.parse(s.locale,1,Dr))?null:new $a(p,g,y)},$a.prototype.evaluate=function(n){return new bo(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)},$a.prototype.eachChild=function(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)},$a.prototype.outputDefined=function(){return!1},$a.prototype.serialize=function(){var n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]};var ti=function(n,o){this.type=Er,this.geojson=n,this.geometries=o};function Es(n){if(n instanceof Yi&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ti)return!1;var o=!0;return n.eachChild(function(s){o&&!Es(s)&&(o=!1)}),o}function Ns(n){if(n instanceof Yi&&n.name==="feature-state")return!1;var o=!0;return n.eachChild(function(s){o&&!Ns(s)&&(o=!1)}),o}function au(n,o){if(n instanceof Yi&&o.indexOf(n.name)>=0)return!1;var s=!0;return n.eachChild(function(p){s&&!au(p,o)&&(s=!1)}),s}ti.parse=function(n,o){if(n.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(_s(n[1])){var s=n[1];if(s.type==="FeatureCollection")for(var p=0;p<s.features.length;++p){var g=s.features[p].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ti(s,s.features[p].geometry)}else if(s.type==="Feature"){var y=s.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ti(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new ti(s,s)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ti.prototype.evaluate=function(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,s){var p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(s.type==="Polygon"){var E=Ho(s.coordinates,g,y),w=th(o.geometry(),p,g,y);if(!re(p,g))return!1;for(var M=0,L=w;M<L.length;M+=1)if(!Vt(L[M],E))return!1}if(s.type==="MultiPolygon"){var k=xs(s.coordinates,g,y),Z=th(o.geometry(),p,g,y);if(!re(p,g))return!1;for(var q=0,te=Z;q<te.length;q+=1)if(!yr(te[q],k))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,s){var p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(s.type==="Polygon"){var E=Ho(s.coordinates,g,y),w=Ch(o.geometry(),p,g,y);if(!re(p,g))return!1;for(var M=0,L=w;M<L.length;M+=1)if(!jo(L[M],E))return!1}if(s.type==="MultiPolygon"){var k=xs(s.coordinates,g,y),Z=Ch(o.geometry(),p,g,y);if(!re(p,g))return!1;for(var q=0,te=Z;q<te.length;q+=1)if(!ua(te[q],k))return!1}return!0}(n,this.geometries)}return!1},ti.prototype.eachChild=function(){},ti.prototype.outputDefined=function(){return!0},ti.prototype.serialize=function(){return["within",this.geojson]};var bu=function(n,o){this.type=o.type,this.name=n,this.boundExpression=o};bu.parse=function(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var s=n[1];return o.scope.has(s)?new bu(s,o.scope.get(s)):o.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},bu.prototype.evaluate=function(n){return this.boundExpression.evaluate(n)},bu.prototype.eachChild=function(){},bu.prototype.outputDefined=function(){return!1},bu.prototype.serialize=function(){return["var",this.name]};var Du=function(n,o,s,p,g){o===void 0&&(o=[]),p===void 0&&(p=new Br),g===void 0&&(g=[]),this.registry=n,this.path=o,this.key=o.map(function(y){return"["+y+"]"}).join(""),this.scope=p,this.errors=g,this.expectedType=s};function xc(n,o){for(var s,p=n.length-1,g=0,y=p,E=0;g<=y;)if((s=n[E=Math.floor((g+y)/2)])<=o){if(E===p||o<n[E+1])return E;g=E+1}else{if(!(s>o))throw new yo("Input is not a number.");y=E-1}return 0}Du.prototype.parse=function(n,o,s,p,g){return g===void 0&&(g={}),o?this.concat(o,s,p)._parse(n,g):this._parse(n,g)},Du.prototype._parse=function(n,o){function s(L,k,Z){return Z==="assert"?new Ki(k,[L]):Z==="coerce"?new ys(k,[L]):L}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=n[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var g=this.registry[p];if(g){var y=g.parse(n,this);if(!y)return null;if(this.expectedType){var E=this.expectedType,w=y.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||w.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(E,w))return null}else y=s(y,E,o.typeAnnotation||"coerce");else y=s(y,E,o.typeAnnotation||"assert")}if(!(y instanceof no)&&y.type.kind!=="resolvedImage"&&function L(k){if(k instanceof bu)return L(k.boundExpression);if(k instanceof Yi&&k.name==="error"||k instanceof $a||k instanceof ti)return!1;var Z=k instanceof ys||k instanceof Ki,q=!0;return k.eachChild(function(te){q=Z?q&&L(te):q&&te instanceof no}),!!q&&Es(k)&&au(k,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(y)){var M=new Bo;try{y=new no(y.type,y.evaluate(M))}catch(L){return this.error(L.message),null}}return y}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof n+" instead.")},Du.prototype.concat=function(n,o,s){var p=typeof n=="number"?this.path.concat(n):this.path,g=s?this.scope.concat(s):this.scope;return new Du(this.registry,p,o||null,g,this.errors)},Du.prototype.error=function(n){for(var o=[],s=arguments.length-1;s-- >0;)o[s]=arguments[s+1];var p=""+this.key+o.map(function(g){return"["+g+"]"}).join("");this.errors.push(new Qt(p,n))},Du.prototype.checkSubtype=function(n,o){var s=Bi(n,o);return s&&this.error(s),s};var Ts=function(n,o,s){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(var p=0,g=s;p<g.length;p+=1){var y=g[p],E=y[1];this.labels.push(y[0]),this.outputs.push(E)}};function Eo(n,o,s){return n*(1-s)+o*s}Ts.parse=function(n,o){if(n.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");var s=o.parse(n[1],1,Mt);if(!s)return null;var p=[],g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(var y=1;y<n.length;y+=2){var E=y===1?-1/0:n[y],w=n[y+1],M=y,L=y+1;if(typeof E!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=E)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);var k=o.parse(w,L,g);if(!k)return null;g=g||k.type,p.push([E,k])}return new Ts(g,s,p)},Ts.prototype.evaluate=function(n){var o=this.labels,s=this.outputs;if(o.length===1)return s[0].evaluate(n);var p=this.input.evaluate(n);if(p<=o[0])return s[0].evaluate(n);var g=o.length;return p>=o[g-1]?s[g-1].evaluate(n):s[xc(o,p)].evaluate(n)},Ts.prototype.eachChild=function(n){n(this.input);for(var o=0,s=this.outputs;o<s.length;o+=1)n(s[o])},Ts.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Ts.prototype.serialize=function(){for(var n=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n};var Eu=Object.freeze({__proto__:null,number:Eo,color:function(n,o,s){return new oi(Eo(n.r,o.r,s),Eo(n.g,o.g,s),Eo(n.b,o.b,s),Eo(n.a,o.a,s))},array:function(n,o,s){return n.map(function(p,g){return Eo(p,o[g],s)})}}),Bu=6/29*3*(6/29),rh=Math.PI/180,cf=180/Math.PI;function nh(n){return n>.008856451679035631?Math.pow(n,1/3):n/Bu+4/29}function Rh(n){return n>6/29?n*n*n:Bu*(n-4/29)}function Ih(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Mh(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function hf(n){var o=Mh(n.r),s=Mh(n.g),p=Mh(n.b),g=nh((.4124564*o+.3575761*s+.1804375*p)/.95047),y=nh((.2126729*o+.7151522*s+.072175*p)/1);return{l:116*y-16,a:500*(g-y),b:200*(y-nh((.0193339*o+.119192*s+.9503041*p)/1.08883)),alpha:n.a}}function ff(n){var o=(n.l+16)/116,s=isNaN(n.a)?o:o+n.a/500,p=isNaN(n.b)?o:o-n.b/200;return o=1*Rh(o),s=.95047*Rh(s),p=1.08883*Rh(p),new oi(Ih(3.2404542*s-1.5371385*o-.4985314*p),Ih(-.969266*s+1.8760108*o+.041556*p),Ih(.0556434*s-.2040259*o+1.0572252*p),n.alpha)}function np(n,o,s){var p=o-n;return n+s*(p>180||p<-180?p-360*Math.round(p/360):p)}var bc={forward:hf,reverse:ff,interpolate:function(n,o,s){return{l:Eo(n.l,o.l,s),a:Eo(n.a,o.a,s),b:Eo(n.b,o.b,s),alpha:Eo(n.alpha,o.alpha,s)}}},pa={forward:function(n){var o=hf(n),s=o.l,p=o.a,g=o.b,y=Math.atan2(g,p)*cf;return{h:y<0?y+360:y,c:Math.sqrt(p*p+g*g),l:s,alpha:n.a}},reverse:function(n){var o=n.h*rh,s=n.c;return ff({l:n.l,a:Math.cos(o)*s,b:Math.sin(o)*s,alpha:n.alpha})},interpolate:function(n,o,s){return{h:np(n.h,o.h,s),c:Eo(n.c,o.c,s),l:Eo(n.l,o.l,s),alpha:Eo(n.alpha,o.alpha,s)}}},pf=Object.freeze({__proto__:null,lab:bc,hcl:pa}),Ua=function(n,o,s,p,g){this.type=n,this.operator=o,this.interpolation=s,this.input=p,this.labels=[],this.outputs=[];for(var y=0,E=g;y<E.length;y+=1){var w=E[y],M=w[1];this.labels.push(w[0]),this.outputs.push(M)}};function Tl(n,o,s,p){var g=p-s,y=n-s;return g===0?0:o===1?y/g:(Math.pow(o,y)-1)/(Math.pow(o,g)-1)}Ua.interpolationFactor=function(n,o,s,p){var g=0;if(n.name==="exponential")g=Tl(o,n.base,s,p);else if(n.name==="linear")g=Tl(o,1,s,p);else if(n.name==="cubic-bezier"){var y=n.controlPoints;g=new G(y[0],y[1],y[2],y[3]).solve(Tl(o,1,s,p))}return g},Ua.parse=function(n,o){var s=n[0],p=n[1],g=n[2],y=n.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var E=p[1];if(typeof E!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:E}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var w=p.slice(1);if(w.length!==4||w.some(function(Ge){return typeof Ge!="number"||Ge<0||Ge>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:w}}if(n.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(g=o.parse(g,2,Mt)))return null;var M=[],L=null;s==="interpolate-hcl"||s==="interpolate-lab"?L=Rr:o.expectedType&&o.expectedType.kind!=="value"&&(L=o.expectedType);for(var k=0;k<y.length;k+=2){var Z=y[k],q=y[k+1],te=k+3,ye=k+4;if(typeof Z!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',te);if(M.length&&M[M.length-1][0]>=Z)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',te);var Te=o.parse(q,ye,L);if(!Te)return null;L=L||Te.type,M.push([Z,Te])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new Ua(L,s,p,g,M):o.error("Type "+di(L)+" is not interpolatable.")},Ua.prototype.evaluate=function(n){var o=this.labels,s=this.outputs;if(o.length===1)return s[0].evaluate(n);var p=this.input.evaluate(n);if(p<=o[0])return s[0].evaluate(n);var g=o.length;if(p>=o[g-1])return s[g-1].evaluate(n);var y=xc(o,p),E=Ua.interpolationFactor(this.interpolation,p,o[y],o[y+1]),w=s[y].evaluate(n),M=s[y+1].evaluate(n);return this.operator==="interpolate"?Eu[this.type.kind.toLowerCase()](w,M,E):this.operator==="interpolate-hcl"?pa.reverse(pa.interpolate(pa.forward(w),pa.forward(M),E)):bc.reverse(bc.interpolate(bc.forward(w),bc.forward(M),E))},Ua.prototype.eachChild=function(n){n(this.input);for(var o=0,s=this.outputs;o<s.length;o+=1)n(s[o])},Ua.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Ua.prototype.serialize=function(){var n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,n,this.input.serialize()],s=0;s<this.labels.length;s++)o.push(this.labels[s],this.outputs[s].serialize());return o};var Ju=function(n,o){this.type=n,this.args=o};Ju.parse=function(n,o){if(n.length<2)return o.error("Expectected at least one argument.");var s=null,p=o.expectedType;p&&p.kind!=="value"&&(s=p);for(var g=[],y=0,E=n.slice(1);y<E.length;y+=1){var w=o.parse(E[y],1+g.length,s,void 0,{typeAnnotation:"omit"});if(!w)return null;s=s||w.type,g.push(w)}var M=p&&g.some(function(L){return Bi(p,L.type)});return new Ju(M?jr:s,g)},Ju.prototype.evaluate=function(n){for(var o,s=null,p=0,g=0,y=this.args;g<y.length&&(p++,(s=y[g].evaluate(n))&&s instanceof co&&!s.available&&(o||(o=s.name),s=null,p===this.args.length&&(s=o)),s===null);g+=1);return s},Ju.prototype.eachChild=function(n){this.args.forEach(n)},Ju.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},Ju.prototype.serialize=function(){var n=["coalesce"];return this.eachChild(function(o){n.push(o.serialize())}),n};var Us=function(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o};Us.prototype.evaluate=function(n){return this.result.evaluate(n)},Us.prototype.eachChild=function(n){for(var o=0,s=this.bindings;o<s.length;o+=1)n(s[o][1]);n(this.result)},Us.parse=function(n,o){if(n.length<4)return o.error("Expected at least 3 arguments, but found "+(n.length-1)+" instead.");for(var s=[],p=1;p<n.length-1;p+=2){var g=n[p];if(typeof g!="string")return o.error("Expected string, but found "+typeof g+" instead.",p);if(/[^a-zA-Z0-9_]/.test(g))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var y=o.parse(n[p+1],p+1);if(!y)return null;s.push([g,y])}var E=o.parse(n[n.length-1],n.length-1,o.expectedType,s);return E?new Us(s,E):null},Us.prototype.outputDefined=function(){return this.result.outputDefined()},Us.prototype.serialize=function(){for(var n=["let"],o=0,s=this.bindings;o<s.length;o+=1){var p=s[o];n.push(p[0],p[1].serialize())}return n.push(this.result.serialize()),n};var el=function(n,o,s){this.type=n,this.index=o,this.input=s};el.parse=function(n,o){if(n.length!==3)return o.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1,Mt),p=o.parse(n[2],2,Ai(o.expectedType||jr));return s&&p?new el(p.type.itemType,s,p):null},el.prototype.evaluate=function(n){var o=this.index.evaluate(n),s=this.input.evaluate(n);if(o<0)throw new yo("Array index out of bounds: "+o+" < 0.");if(o>=s.length)throw new yo("Array index out of bounds: "+o+" > "+(s.length-1)+".");if(o!==Math.floor(o))throw new yo("Array index must be an integer, but found "+o+" instead.");return s[o]},el.prototype.eachChild=function(n){n(this.index),n(this.input)},el.prototype.outputDefined=function(){return!1},el.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Gs=function(n,o){this.type=Er,this.needle=n,this.haystack=o};Gs.parse=function(n,o){if(n.length!==3)return o.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1,jr),p=o.parse(n[2],2,jr);return s&&p?ro(s.type,[Er,Dr,Mt,Fr,jr])?new Gs(s,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+di(s.type)+" instead"):null},Gs.prototype.evaluate=function(n){var o=this.needle.evaluate(n),s=this.haystack.evaluate(n);if(!s)return!1;if(!mi(o,["boolean","string","number","null"]))throw new yo("Expected first argument to be of type boolean, string, number or null, but found "+di(Gi(o))+" instead.");if(!mi(s,["string","array"]))throw new yo("Expected second argument to be of type array or string, but found "+di(Gi(s))+" instead.");return s.indexOf(o)>=0},Gs.prototype.eachChild=function(n){n(this.needle),n(this.haystack)},Gs.prototype.outputDefined=function(){return!0},Gs.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Fu=function(n,o,s){this.type=Mt,this.needle=n,this.haystack=o,this.fromIndex=s};Fu.parse=function(n,o){if(n.length<=2||n.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1,jr),p=o.parse(n[2],2,jr);if(!s||!p)return null;if(!ro(s.type,[Er,Dr,Mt,Fr,jr]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+di(s.type)+" instead");if(n.length===4){var g=o.parse(n[3],3,Mt);return g?new Fu(s,p,g):null}return new Fu(s,p)},Fu.prototype.evaluate=function(n){var o=this.needle.evaluate(n),s=this.haystack.evaluate(n);if(!mi(o,["boolean","string","number","null"]))throw new yo("Expected first argument to be of type boolean, string, number or null, but found "+di(Gi(o))+" instead.");if(!mi(s,["string","array"]))throw new yo("Expected second argument to be of type array or string, but found "+di(Gi(s))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(n);return s.indexOf(o,p)}return s.indexOf(o)},Fu.prototype.eachChild=function(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)},Fu.prototype.outputDefined=function(){return!1},Fu.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ks=function(n,o,s,p,g,y){this.inputType=n,this.type=o,this.input=s,this.cases=p,this.outputs=g,this.otherwise=y};ks.parse=function(n,o){if(n.length<5)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if(n.length%2!=1)return o.error("Expected an even number of arguments.");var s,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var g={},y=[],E=2;E<n.length-1;E+=2){var w=n[E],M=n[E+1];Array.isArray(w)||(w=[w]);var L=o.concat(E);if(w.length===0)return L.error("Expected at least one branch label.");for(var k=0,Z=w;k<Z.length;k+=1){var q=Z[k];if(typeof q!="number"&&typeof q!="string")return L.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return L.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof q=="number"&&Math.floor(q)!==q)return L.error("Numeric branch labels must be integer values.");if(s){if(L.checkSubtype(s,Gi(q)))return null}else s=Gi(q);if(g[String(q)]!==void 0)return L.error("Branch labels must be unique.");g[String(q)]=y.length}var te=o.parse(M,E,p);if(!te)return null;p=p||te.type,y.push(te)}var ye=o.parse(n[1],1,jr);if(!ye)return null;var Te=o.parse(n[n.length-1],n.length-1,p);return Te?ye.type.kind!=="value"&&o.concat(1).checkSubtype(s,ye.type)?null:new ks(s,p,ye,g,y,Te):null},ks.prototype.evaluate=function(n){var o=this.input.evaluate(n);return(Gi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)},ks.prototype.eachChild=function(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)},ks.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})&&this.otherwise.outputDefined()},ks.prototype.serialize=function(){for(var n=this,o=["match",this.input.serialize()],s=[],p={},g=0,y=Object.keys(this.cases).sort();g<y.length;g+=1){var E=y[g];(Z=p[this.cases[E]])===void 0?(p[this.cases[E]]=s.length,s.push([this.cases[E],[E]])):s[Z][1].push(E)}for(var w=function(te){return n.inputType.kind==="number"?Number(te):te},M=0,L=s;M<L.length;M+=1){var k=L[M],Z=k[0],q=k[1];o.push(q.length===1?w(q[0]):q.map(w)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Nu=function(n,o,s){this.type=n,this.branches=o,this.otherwise=s};Nu.parse=function(n,o){if(n.length<4)return o.error("Expected at least 3 arguments, but found only "+(n.length-1)+".");if(n.length%2!=0)return o.error("Expected an odd number of arguments.");var s;o.expectedType&&o.expectedType.kind!=="value"&&(s=o.expectedType);for(var p=[],g=1;g<n.length-1;g+=2){var y=o.parse(n[g],g,Er);if(!y)return null;var E=o.parse(n[g+1],g+1,s);if(!E)return null;p.push([y,E]),s=s||E.type}var w=o.parse(n[n.length-1],n.length-1,s);return w?new Nu(s,p,w):null},Nu.prototype.evaluate=function(n){for(var o=0,s=this.branches;o<s.length;o+=1){var p=s[o],g=p[1];if(p[0].evaluate(n))return g.evaluate(n)}return this.otherwise.evaluate(n)},Nu.prototype.eachChild=function(n){for(var o=0,s=this.branches;o<s.length;o+=1){var p=s[o],g=p[1];n(p[0]),n(g)}n(this.otherwise)},Nu.prototype.outputDefined=function(){return this.branches.every(function(n){return n[1].outputDefined()})&&this.otherwise.outputDefined()},Nu.prototype.serialize=function(){var n=["case"];return this.eachChild(function(o){n.push(o.serialize())}),n};var tl=function(n,o,s,p){this.type=n,this.input=o,this.beginIndex=s,this.endIndex=p};function df(n,o){return n==="=="||n==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function mf(n,o,s,p){return p.compare(o,s)===0}function $i(n,o,s){var p=n!=="=="&&n!=="!=";return function(){function g(y,E,w){this.type=Er,this.lhs=y,this.rhs=E,this.collator=w,this.hasUntypedArgument=y.type.kind==="value"||E.type.kind==="value"}return g.parse=function(y,E){if(y.length!==3&&y.length!==4)return E.error("Expected two or three arguments.");var w=y[0],M=E.parse(y[1],1,jr);if(!M)return null;if(!df(w,M.type))return E.concat(1).error('"'+w+`" comparisons are not supported for type '`+di(M.type)+"'.");var L=E.parse(y[2],2,jr);if(!L)return null;if(!df(w,L.type))return E.concat(2).error('"'+w+`" comparisons are not supported for type '`+di(L.type)+"'.");if(M.type.kind!==L.type.kind&&M.type.kind!=="value"&&L.type.kind!=="value")return E.error("Cannot compare types '"+di(M.type)+"' and '"+di(L.type)+"'.");p&&(M.type.kind==="value"&&L.type.kind!=="value"?M=new Ki(L.type,[M]):M.type.kind!=="value"&&L.type.kind==="value"&&(L=new Ki(M.type,[L])));var k=null;if(y.length===4){if(M.type.kind!=="string"&&L.type.kind!=="string"&&M.type.kind!=="value"&&L.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(!(k=E.parse(y[3],3,qn)))return null}return new g(M,L,k)},g.prototype.evaluate=function(y){var E=this.lhs.evaluate(y),w=this.rhs.evaluate(y);if(p&&this.hasUntypedArgument){var M=Gi(E),L=Gi(w);if(M.kind!==L.kind||M.kind!=="string"&&M.kind!=="number")throw new yo('Expected arguments for "'+n+'" to be (string, string) or (number, number), but found ('+M.kind+", "+L.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var k=Gi(E),Z=Gi(w);if(k.kind!=="string"||Z.kind!=="string")return o(y,E,w)}return this.collator?s(y,E,w,this.collator.evaluate(y)):o(y,E,w)},g.prototype.eachChild=function(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)},g.prototype.outputDefined=function(){return!0},g.prototype.serialize=function(){var y=[n];return this.eachChild(function(E){y.push(E.serialize())}),y},g}()}tl.parse=function(n,o){if(n.length<=2||n.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1,jr),p=o.parse(n[2],2,Mt);if(!s||!p)return null;if(!ro(s.type,[Ai(jr),Dr,jr]))return o.error("Expected first argument to be of type array or string, but found "+di(s.type)+" instead");if(n.length===4){var g=o.parse(n[3],3,Mt);return g?new tl(s.type,s,p,g):null}return new tl(s.type,s,p)},tl.prototype.evaluate=function(n){var o=this.input.evaluate(n),s=this.beginIndex.evaluate(n);if(!mi(o,["string","array"]))throw new yo("Expected first argument to be of type array or string, but found "+di(Gi(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(n);return o.slice(s,p)}return o.slice(s)},tl.prototype.eachChild=function(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)},tl.prototype.outputDefined=function(){return!1},tl.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ip=$i("==",function(n,o,s){return o===s},mf),ih=$i("!=",function(n,o,s){return o!==s},function(n,o,s,p){return!mf(0,o,s,p)}),Oh=$i("<",function(n,o,s){return o<s},function(n,o,s,p){return p.compare(o,s)<0}),Fo=$i(">",function(n,o,s){return o>s},function(n,o,s,p){return p.compare(o,s)>0}),Ph=$i("<=",function(n,o,s){return o<=s},function(n,o,s,p){return p.compare(o,s)<=0}),vf=$i(">=",function(n,o,s){return o>=s},function(n,o,s,p){return p.compare(o,s)>=0}),us=function(n,o,s,p,g){this.type=Dr,this.number=n,this.locale=o,this.currency=s,this.minFractionDigits=p,this.maxFractionDigits=g};us.parse=function(n,o){if(n.length!==3)return o.error("Expected two arguments.");var s=o.parse(n[1],1,Mt);if(!s)return null;var p=n[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var g=null;if(p.locale&&!(g=o.parse(p.locale,1,Dr)))return null;var y=null;if(p.currency&&!(y=o.parse(p.currency,1,Dr)))return null;var E=null;if(p["min-fraction-digits"]&&!(E=o.parse(p["min-fraction-digits"],1,Mt)))return null;var w=null;return p["max-fraction-digits"]&&!(w=o.parse(p["max-fraction-digits"],1,Mt))?null:new us(s,g,y,E,w)},us.prototype.evaluate=function(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))},us.prototype.eachChild=function(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)},us.prototype.outputDefined=function(){return!1},us.prototype.serialize=function(){var n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]};var Uu=function(n){this.type=Mt,this.input=n};Uu.parse=function(n,o){if(n.length!==2)return o.error("Expected 1 argument, but found "+(n.length-1)+" instead.");var s=o.parse(n[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+di(s.type)+" instead."):new Uu(s):null},Uu.prototype.evaluate=function(n){var o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new yo("Expected value to be of type string or array, but found "+di(Gi(o))+" instead.")},Uu.prototype.eachChild=function(n){n(this.input)},Uu.prototype.outputDefined=function(){return!1},Uu.prototype.serialize=function(){var n=["length"];return this.eachChild(function(o){n.push(o.serialize())}),n};var Tu={"==":ip,"!=":ih,">":Fo,"<":Oh,">=":vf,"<=":Ph,array:Ki,at:el,boolean:Ki,case:Nu,coalesce:Ju,collator:$a,format:Wa,image:Na,in:Gs,"index-of":Fu,interpolate:Ua,"interpolate-hcl":Ua,"interpolate-lab":Ua,length:Uu,let:Us,literal:no,match:ks,number:Ki,"number-format":us,object:Ki,slice:tl,step:Ts,string:Ki,"to-boolean":ys,"to-color":ys,"to-number":ys,"to-string":ys,var:bu,within:ti};function rl(n,o){var s=o[0],p=o[1],g=o[2],y=o[3];s=s.evaluate(n),p=p.evaluate(n),g=g.evaluate(n);var E=y?y.evaluate(n):1,w=yu(s,p,g,E);if(w)throw new yo(w);return new oi(s/255*E,p/255*E,g/255*E,E)}function oh(n,o){return n in o}function Gl(n,o){var s=o[n];return s===void 0?null:s}function su(n){return{type:n}}function Ec(n){return{result:"success",value:n}}function nl(n){return{result:"error",value:n}}function ku(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Lh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Tc(n){return!!n.expression&&n.expression.interpolated}function Kn(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function ah(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function gf(n){return n}function zu(n,o,s){return n!==void 0?n:o!==void 0?o:s!==void 0?s:void 0}function Yl(n,o,s,p,g){return zu(typeof s===g?p[s]:void 0,n.default,o.default)}function Dh(n,o,s){if(Kn(s)!=="number")return zu(n.default,o.default);var p=n.stops.length;if(p===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[p-1][0])return n.stops[p-1][1];var g=xc(n.stops.map(function(y){return y[0]}),s);return n.stops[g][1]}function Mi(n,o,s){var p=n.base!==void 0?n.base:1;if(Kn(s)!=="number")return zu(n.default,o.default);var g=n.stops.length;if(g===1||s<=n.stops[0][0])return n.stops[0][1];if(s>=n.stops[g-1][0])return n.stops[g-1][1];var y=xc(n.stops.map(function(Z){return Z[0]}),s),E=function(Z,q,te,ye){var Te=ye-te,Ge=Z-te;return Te===0?0:q===1?Ge/Te:(Math.pow(q,Ge)-1)/(Math.pow(q,Te)-1)}(s,p,n.stops[y][0],n.stops[y+1][0]),w=n.stops[y][1],M=n.stops[y+1][1],L=Eu[o.type]||gf;if(n.colorSpace&&n.colorSpace!=="rgb"){var k=pf[n.colorSpace];L=function(Z,q){return k.reverse(k.interpolate(k.forward(Z),k.forward(q),E))}}return typeof w.evaluate=="function"?{evaluate:function(){for(var Z=[],q=arguments.length;q--;)Z[q]=arguments[q];var te=w.evaluate.apply(void 0,Z),ye=M.evaluate.apply(void 0,Z);if(te!==void 0&&ye!==void 0)return L(te,ye,E)}}:L(w,M,E)}function la(n,o,s){return o.type==="color"?s=oi.parse(s):o.type==="formatted"?s=eo.fromString(s.toString()):o.type==="resolvedImage"?s=co.fromString(s.toString()):Kn(s)===o.type||o.type==="enum"&&o.values[s]||(s=void 0),zu(s,n.default,o.default)}Yi.register(Tu,{error:[{kind:"error"},[Dr],function(n,o){throw new yo(o[0].evaluate(n))}],typeof:[Dr,[jr],function(n,o){return di(Gi(o[0].evaluate(n)))}],"to-rgba":[Ai(Mt,4),[Rr],function(n,o){return o[0].evaluate(n).toArray()}],rgb:[Rr,[Mt,Mt,Mt],rl],rgba:[Rr,[Mt,Mt,Mt,Mt],rl],has:{type:Er,overloads:[[[Dr],function(n,o){return oh(o[0].evaluate(n),n.properties())}],[[Dr,zn],function(n,o){var s=o[1];return oh(o[0].evaluate(n),s.evaluate(n))}]]},get:{type:jr,overloads:[[[Dr],function(n,o){return Gl(o[0].evaluate(n),n.properties())}],[[Dr,zn],function(n,o){var s=o[1];return Gl(o[0].evaluate(n),s.evaluate(n))}]]},"feature-state":[jr,[Dr],function(n,o){return Gl(o[0].evaluate(n),n.featureState||{})}],properties:[zn,[],function(n){return n.properties()}],"geometry-type":[Dr,[],function(n){return n.geometryType()}],id:[jr,[],function(n){return n.id()}],zoom:[Mt,[],function(n){return n.globals.zoom}],"heatmap-density":[Mt,[],function(n){return n.globals.heatmapDensity||0}],"line-progress":[Mt,[],function(n){return n.globals.lineProgress||0}],accumulated:[jr,[],function(n){return n.globals.accumulated===void 0?null:n.globals.accumulated}],"+":[Mt,su(Mt),function(n,o){for(var s=0,p=0,g=o;p<g.length;p+=1)s+=g[p].evaluate(n);return s}],"*":[Mt,su(Mt),function(n,o){for(var s=1,p=0,g=o;p<g.length;p+=1)s*=g[p].evaluate(n);return s}],"-":{type:Mt,overloads:[[[Mt,Mt],function(n,o){var s=o[1];return o[0].evaluate(n)-s.evaluate(n)}],[[Mt],function(n,o){return-o[0].evaluate(n)}]]},"/":[Mt,[Mt,Mt],function(n,o){var s=o[1];return o[0].evaluate(n)/s.evaluate(n)}],"%":[Mt,[Mt,Mt],function(n,o){var s=o[1];return o[0].evaluate(n)%s.evaluate(n)}],ln2:[Mt,[],function(){return Math.LN2}],pi:[Mt,[],function(){return Math.PI}],e:[Mt,[],function(){return Math.E}],"^":[Mt,[Mt,Mt],function(n,o){var s=o[1];return Math.pow(o[0].evaluate(n),s.evaluate(n))}],sqrt:[Mt,[Mt],function(n,o){return Math.sqrt(o[0].evaluate(n))}],log10:[Mt,[Mt],function(n,o){return Math.log(o[0].evaluate(n))/Math.LN10}],ln:[Mt,[Mt],function(n,o){return Math.log(o[0].evaluate(n))}],log2:[Mt,[Mt],function(n,o){return Math.log(o[0].evaluate(n))/Math.LN2}],sin:[Mt,[Mt],function(n,o){return Math.sin(o[0].evaluate(n))}],cos:[Mt,[Mt],function(n,o){return Math.cos(o[0].evaluate(n))}],tan:[Mt,[Mt],function(n,o){return Math.tan(o[0].evaluate(n))}],asin:[Mt,[Mt],function(n,o){return Math.asin(o[0].evaluate(n))}],acos:[Mt,[Mt],function(n,o){return Math.acos(o[0].evaluate(n))}],atan:[Mt,[Mt],function(n,o){return Math.atan(o[0].evaluate(n))}],min:[Mt,su(Mt),function(n,o){return Math.min.apply(Math,o.map(function(s){return s.evaluate(n)}))}],max:[Mt,su(Mt),function(n,o){return Math.max.apply(Math,o.map(function(s){return s.evaluate(n)}))}],abs:[Mt,[Mt],function(n,o){return Math.abs(o[0].evaluate(n))}],round:[Mt,[Mt],function(n,o){var s=o[0].evaluate(n);return s<0?-Math.round(-s):Math.round(s)}],floor:[Mt,[Mt],function(n,o){return Math.floor(o[0].evaluate(n))}],ceil:[Mt,[Mt],function(n,o){return Math.ceil(o[0].evaluate(n))}],"filter-==":[Er,[Dr,jr],function(n,o){var s=o[0],p=o[1];return n.properties()[s.value]===p.value}],"filter-id-==":[Er,[jr],function(n,o){var s=o[0];return n.id()===s.value}],"filter-type-==":[Er,[Dr],function(n,o){var s=o[0];return n.geometryType()===s.value}],"filter-<":[Er,[Dr,jr],function(n,o){var s=o[0],p=o[1],g=n.properties()[s.value],y=p.value;return typeof g==typeof y&&g<y}],"filter-id-<":[Er,[jr],function(n,o){var s=o[0],p=n.id(),g=s.value;return typeof p==typeof g&&p<g}],"filter->":[Er,[Dr,jr],function(n,o){var s=o[0],p=o[1],g=n.properties()[s.value],y=p.value;return typeof g==typeof y&&g>y}],"filter-id->":[Er,[jr],function(n,o){var s=o[0],p=n.id(),g=s.value;return typeof p==typeof g&&p>g}],"filter-<=":[Er,[Dr,jr],function(n,o){var s=o[0],p=o[1],g=n.properties()[s.value],y=p.value;return typeof g==typeof y&&g<=y}],"filter-id-<=":[Er,[jr],function(n,o){var s=o[0],p=n.id(),g=s.value;return typeof p==typeof g&&p<=g}],"filter->=":[Er,[Dr,jr],function(n,o){var s=o[0],p=o[1],g=n.properties()[s.value],y=p.value;return typeof g==typeof y&&g>=y}],"filter-id->=":[Er,[jr],function(n,o){var s=o[0],p=n.id(),g=s.value;return typeof p==typeof g&&p>=g}],"filter-has":[Er,[jr],function(n,o){return o[0].value in n.properties()}],"filter-has-id":[Er,[],function(n){return n.id()!==null&&n.id()!==void 0}],"filter-type-in":[Er,[Ai(Dr)],function(n,o){return o[0].value.indexOf(n.geometryType())>=0}],"filter-id-in":[Er,[Ai(jr)],function(n,o){return o[0].value.indexOf(n.id())>=0}],"filter-in-small":[Er,[Dr,Ai(jr)],function(n,o){var s=o[0];return o[1].value.indexOf(n.properties()[s.value])>=0}],"filter-in-large":[Er,[Dr,Ai(jr)],function(n,o){var s=o[0],p=o[1];return function(g,y,E,w){for(;E<=w;){var M=E+w>>1;if(y[M]===g)return!0;y[M]>g?w=M-1:E=M+1}return!1}(n.properties()[s.value],p.value,0,p.value.length-1)}],all:{type:Er,overloads:[[[Er,Er],function(n,o){var s=o[1];return o[0].evaluate(n)&&s.evaluate(n)}],[su(Er),function(n,o){for(var s=0,p=o;s<p.length;s+=1)if(!p[s].evaluate(n))return!1;return!0}]]},any:{type:Er,overloads:[[[Er,Er],function(n,o){var s=o[1];return o[0].evaluate(n)||s.evaluate(n)}],[su(Er),function(n,o){for(var s=0,p=o;s<p.length;s+=1)if(p[s].evaluate(n))return!0;return!1}]]},"!":[Er,[Er],function(n,o){return!o[0].evaluate(n)}],"is-supported-script":[Er,[Dr],function(n,o){var s=n.globals&&n.globals.isSupportedScript;return!s||s(o[0].evaluate(n))}],upcase:[Dr,[Dr],function(n,o){return o[0].evaluate(n).toUpperCase()}],downcase:[Dr,[Dr],function(n,o){return o[0].evaluate(n).toLowerCase()}],concat:[Dr,su(jr),function(n,o){return o.map(function(s){return sa(s.evaluate(n))}).join("")}],"resolved-locale":[Dr,[qn],function(n,o){return o[0].evaluate(n).resolvedLocale()}]});var Sa=function(n,o){this.expression=n,this._warningHistory={},this._evaluator=new Bo,this._defaultValue=o?function(s){return s.type==="color"&&ah(s.default)?new oi(0,0,0,0):s.type==="color"?oi.parse(s.default)||null:s.default===void 0?null:s.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function As(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Tu}function Al(n,o){var s=new Du(Tu,[],o?function(g){var y={color:Rr,string:Dr,number:Mt,enum:Dr,boolean:Er,formatted:Li,resolvedImage:ei};return g.type==="array"?Ai(y[g.value]||jr,g.length):y[g.type]}(o):void 0),p=s.parse(n,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Ec(new Sa(p,o)):nl(s.errors)}Sa.prototype.evaluateWithoutErrorHandling=function(n,o,s,p,g,y){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=s,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)},Sa.prototype.evaluate=function(n,o,s,p,g,y){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=s||null,this._evaluator.canonical=p,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null;try{var E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new yo("Expected value to be one of "+Object.keys(this._enumValues).map(function(w){return JSON.stringify(w)}).join(", ")+", but found "+JSON.stringify(E)+" instead.");return E}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console!="undefined"&&console.warn(w.message)),this._defaultValue}};var il=function(n,o){this.kind=n,this._styleExpression=o,this.isStateDependent=n!=="constant"&&!Ns(o.expression)};il.prototype.evaluateWithoutErrorHandling=function(n,o,s,p,g,y){return this._styleExpression.evaluateWithoutErrorHandling(n,o,s,p,g,y)},il.prototype.evaluate=function(n,o,s,p,g,y){return this._styleExpression.evaluate(n,o,s,p,g,y)};var Sl=function(n,o,s,p){this.kind=n,this.zoomStops=s,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!Ns(o.expression),this.interpolationType=p};function Ac(n,o){if((n=Al(n,o)).result==="error")return n;var s=n.value.expression,p=Es(s);if(!p&&!ku(o))return nl([new Qt("","data expressions not supported")]);var g=au(s,["zoom"]);if(!g&&!Lh(o))return nl([new Qt("","zoom expressions not supported")]);var y=function E(w){var M=null;if(w instanceof Us)M=E(w.result);else if(w instanceof Ju)for(var L=0,k=w.args;L<k.length&&!(M=E(k[L]));L+=1);else(w instanceof Ts||w instanceof Ua)&&w.input instanceof Yi&&w.input.name==="zoom"&&(M=w);return M instanceof Qt||w.eachChild(function(Z){var q=E(Z);q instanceof Qt?M=q:!M&&q?M=new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):M&&q&&M!==q&&(M=new Qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),M}(s);return y||g?y instanceof Qt?nl([y]):y instanceof Ua&&!Tc(o)?nl([new Qt("",'"interpolate" expressions cannot be used with this property')]):Ec(y?new Sl(p?"camera":"composite",n.value,y.labels,y instanceof Ua?y.interpolation:void 0):new il(p?"constant":"source",n.value)):nl([new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Sl.prototype.evaluateWithoutErrorHandling=function(n,o,s,p,g,y){return this._styleExpression.evaluateWithoutErrorHandling(n,o,s,p,g,y)},Sl.prototype.evaluate=function(n,o,s,p,g,y){return this._styleExpression.evaluate(n,o,s,p,g,y)},Sl.prototype.interpolationFactor=function(n,o,s){return this.interpolationType?Ua.interpolationFactor(this.interpolationType,n,o,s):0};var ql=function(n,o){this._parameters=n,this._specification=o,wt(this,function s(p,g){var y,E,w,M=g.type==="color",L=p.stops&&typeof p.stops[0][0]=="object",k=L||!(L||p.property!==void 0),Z=p.type||(Tc(g)?"exponential":"interval");if(M&&((p=wt({},p)).stops&&(p.stops=p.stops.map(function(en){return[en[0],oi.parse(en[1])]})),p.default=oi.parse(p.default?p.default:g.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!pf[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(Z==="exponential")y=Mi;else if(Z==="interval")y=Dh;else if(Z==="categorical"){y=Yl,E=Object.create(null);for(var q=0,te=p.stops;q<te.length;q+=1){var ye=te[q];E[ye[0]]=ye[1]}w=typeof p.stops[0][0]}else{if(Z!=="identity")throw new Error('Unknown function type "'+Z+'"');y=la}if(L){for(var Te={},Ge=[],Le=0;Le<p.stops.length;Le++){var nt=p.stops[Le],ft=nt[0].zoom;Te[ft]===void 0&&(Te[ft]={zoom:ft,type:p.type,property:p.property,default:p.default,stops:[]},Ge.push(ft)),Te[ft].stops.push([nt[0].value,nt[1]])}for(var Pt=[],Ut=0,er=Ge;Ut<er.length;Ut+=1){var Ar=er[Ut];Pt.push([Te[Ar].zoom,s(Te[Ar],g)])}var Nr={name:"linear"};return{kind:"composite",interpolationType:Nr,interpolationFactor:Ua.interpolationFactor.bind(void 0,Nr),zoomStops:Pt.map(function(en){return en[0]}),evaluate:function(en,En){var tn=en.zoom;return Mi({stops:Pt,base:p.base},g,tn).evaluate(tn,En)}}}if(k){var yn=Z==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:yn,interpolationFactor:Ua.interpolationFactor.bind(void 0,yn),zoomStops:p.stops.map(function(en){return en[0]}),evaluate:function(en){return y(p,g,en.zoom,E,w)}}}return{kind:"source",evaluate:function(en,En){var tn=En&&En.properties?En.properties[p.property]:void 0;return tn===void 0?zu(p.default,g.default):y(p,g,tn,E,w)}}}(this._parameters,this._specification))};function Ys(n){var o=n.key,s=n.value,p=n.valueSpec||{},g=n.objectElementValidators||{},y=n.style,E=n.styleSpec,w=[],M=Kn(s);if(M!=="object")return[new ve(o,s,"object expected, "+M+" found")];for(var L in s){var k=L.split(".")[0],Z=p[k]||p["*"],q=void 0;if(g[k])q=g[k];else if(p[k])q=yi;else if(g["*"])q=g["*"];else{if(!p["*"]){w.push(new ve(o,s[L],'unknown property "'+L+'"'));continue}q=yi}w=w.concat(q({key:(o&&o+".")+L,value:s[L],valueSpec:Z,style:y,styleSpec:E,object:s,objectKey:L},s))}for(var te in p)g[te]||p[te].required&&p[te].default===void 0&&s[te]===void 0&&w.push(new ve(o,s,'missing required property "'+te+'"'));return w}function sh(n){var o=n.value,s=n.valueSpec,p=n.style,g=n.styleSpec,y=n.key,E=n.arrayElementValidator||yi;if(Kn(o)!=="array")return[new ve(y,o,"array expected, "+Kn(o)+" found")];if(s.length&&o.length!==s.length)return[new ve(y,o,"array length "+s.length+" expected, length "+o.length+" found")];if(s["min-length"]&&o.length<s["min-length"])return[new ve(y,o,"array length at least "+s["min-length"]+" expected, length "+o.length+" found")];var w={type:s.value,values:s.values};g.$version<7&&(w.function=s.function),Kn(s.value)==="object"&&(w=s.value);for(var M=[],L=0;L<o.length;L++)M=M.concat(E({array:o,arrayIndex:L,value:o[L],valueSpec:w,style:p,styleSpec:g,key:y+"["+L+"]"}));return M}function _f(n){var o=n.key,s=n.value,p=n.valueSpec,g=Kn(s);return g==="number"&&s!=s&&(g="NaN"),g!=="number"?[new ve(o,s,"number expected, "+g+" found")]:"minimum"in p&&s<p.minimum?[new ve(o,s,s+" is less than the minimum value "+p.minimum)]:"maximum"in p&&s>p.maximum?[new ve(o,s,s+" is greater than the maximum value "+p.maximum)]:[]}function yf(n){var o,s,p,g=n.valueSpec,y=nr(n.value.type),E={},w=y!=="categorical"&&n.value.property===void 0,M=!w,L=Kn(n.value.stops)==="array"&&Kn(n.value.stops[0])==="array"&&Kn(n.value.stops[0][0])==="object",k=Ys({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(te){if(y==="identity")return[new ve(te.key,te.value,'identity function may not have a "stops" property')];var ye=[],Te=te.value;return ye=ye.concat(sh({key:te.key,value:Te,valueSpec:te.valueSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:Z})),Kn(Te)==="array"&&Te.length===0&&ye.push(new ve(te.key,Te,"array must have at least one stop")),ye},default:function(te){return yi({key:te.key,value:te.value,valueSpec:g,style:te.style,styleSpec:te.styleSpec})}}});return y==="identity"&&w&&k.push(new ve(n.key,n.value,'missing required property "property"')),y==="identity"||n.value.stops||k.push(new ve(n.key,n.value,'missing required property "stops"')),y==="exponential"&&n.valueSpec.expression&&!Tc(n.valueSpec)&&k.push(new ve(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(M&&!ku(n.valueSpec)?k.push(new ve(n.key,n.value,"property functions not supported")):w&&!Lh(n.valueSpec)&&k.push(new ve(n.key,n.value,"zoom functions not supported"))),y!=="categorical"&&!L||n.value.property!==void 0||k.push(new ve(n.key,n.value,'"property" property is required')),k;function Z(te){var ye=[],Te=te.value,Ge=te.key;if(Kn(Te)!=="array")return[new ve(Ge,Te,"array expected, "+Kn(Te)+" found")];if(Te.length!==2)return[new ve(Ge,Te,"array length 2 expected, length "+Te.length+" found")];if(L){if(Kn(Te[0])!=="object")return[new ve(Ge,Te,"object expected, "+Kn(Te[0])+" found")];if(Te[0].zoom===void 0)return[new ve(Ge,Te,"object stop key must have zoom")];if(Te[0].value===void 0)return[new ve(Ge,Te,"object stop key must have value")];if(p&&p>nr(Te[0].zoom))return[new ve(Ge,Te[0].zoom,"stop zoom values must appear in ascending order")];nr(Te[0].zoom)!==p&&(p=nr(Te[0].zoom),s=void 0,E={}),ye=ye.concat(Ys({key:Ge+"[0]",value:Te[0],valueSpec:{zoom:{}},style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:_f,value:q}}))}else ye=ye.concat(q({key:Ge+"[0]",value:Te[0],valueSpec:{},style:te.style,styleSpec:te.styleSpec},Te));return As(_t(Te[1]))?ye.concat([new ve(Ge+"[1]",Te[1],"expressions are not allowed in function stops.")]):ye.concat(yi({key:Ge+"[1]",value:Te[1],valueSpec:g,style:te.style,styleSpec:te.styleSpec}))}function q(te,ye){var Te=Kn(te.value),Ge=nr(te.value),Le=te.value!==null?te.value:ye;if(o){if(Te!==o)return[new ve(te.key,Le,Te+" stop domain type must match previous stop domain type "+o)]}else o=Te;if(Te!=="number"&&Te!=="string"&&Te!=="boolean")return[new ve(te.key,Le,"stop domain value must be a number, string, or boolean")];if(Te!=="number"&&y!=="categorical"){var nt="number expected, "+Te+" found";return ku(g)&&y===void 0&&(nt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ve(te.key,Le,nt)]}return y!=="categorical"||Te!=="number"||isFinite(Ge)&&Math.floor(Ge)===Ge?y!=="categorical"&&Te==="number"&&s!==void 0&&Ge<s?[new ve(te.key,Le,"stop domain values must appear in ascending order")]:(s=Ge,y==="categorical"&&Ge in E?[new ve(te.key,Le,"stop domain values must be unique")]:(E[Ge]=!0,[])):[new ve(te.key,Le,"integer expected, found "+Ge)]}}function ol(n){var o=(n.expressionContext==="property"?Ac:Al)(_t(n.value),n.valueSpec);if(o.result==="error")return o.value.map(function(p){return new ve(""+n.key+p.key,n.value,p.message)});var s=o.value.expression||o.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!s.outputDefined())return[new ve(n.key,n.value,'Invalid data expression for "'+n.propertyKey+'". Output values must be contained as literals within the expression.')];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Ns(s))return[new ve(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Ns(s))return[new ve(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!au(s,["zoom","feature-state"]))return[new ve(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Es(s))return[new ve(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xo(n){var o=n.key,s=n.value,p=n.valueSpec,g=[];return Array.isArray(p.values)?p.values.indexOf(nr(s))===-1&&g.push(new ve(o,s,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(p.values).indexOf(nr(s))===-1&&g.push(new ve(o,s,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(s)+" found")),g}function al(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(var o=0,s=n.slice(1);o<s.length;o+=1){var p=s[o];if(!al(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}ql.deserialize=function(n){return new ql(n._parameters,n._specification)},ql.serialize=function(n){return{_parameters:n._parameters,_specification:n._specification}};var Kl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wl(n){if(n==null)return{filter:function(){return!0},needGeometry:!1};al(n)||(n=uh(n));var o=Al(n,Kl);if(o.result==="error")throw new Error(o.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,p,g){return o.value.evaluate(s,p,{},g)},needGeometry:function s(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var g=1;g<p.length;g++)if(s(p[g]))return!0;return!1}(n)}}function op(n,o){return n<o?-1:n>o?1:0}function uh(n){if(!n)return!0;var o,s=n[0];return n.length<=1?s!=="any":s==="=="?Sc(n[1],n[2],"=="):s==="!="?wc(Sc(n[1],n[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Sc(n[1],n[2],s):s==="any"?(o=n.slice(1),["any"].concat(o.map(uh))):s==="all"?["all"].concat(n.slice(1).map(uh)):s==="none"?["all"].concat(n.slice(1).map(uh).map(wc)):s==="in"?sl(n[1],n.slice(2)):s==="!in"?wc(sl(n[1],n.slice(2))):s==="has"?Bh(n[1]):s==="!has"?wc(Bh(n[1])):s!=="within"||n}function Sc(n,o,s){switch(n){case"$type":return["filter-type-"+s,o];case"$id":return["filter-id-"+s,o];default:return["filter-"+s,n,o]}}function sl(n,o){if(o.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(s){return typeof s!=typeof o[0]})?["filter-in-large",n,["literal",o.sort(op)]]:["filter-in-small",n,["literal",o]]}}function Bh(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function wc(n){return["!",n]}function Fh(n){return al(_t(n.value))?ol(wt({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(s){var p=s.value,g=s.key;if(Kn(p)!=="array")return[new ve(g,p,"array expected, "+Kn(p)+" found")];var y,E=s.styleSpec,w=[];if(p.length<1)return[new ve(g,p,"filter array must have at least 1 element")];switch(w=w.concat(Xo({key:g+"[0]",value:p[0],valueSpec:E.filter_operator,style:s.style,styleSpec:s.styleSpec})),nr(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&nr(p[1])==="$type"&&w.push(new ve(g,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&w.push(new ve(g,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(y=Kn(p[1]))!=="string"&&w.push(new ve(g+"[1]",p[1],"string expected, "+y+" found"));for(var M=2;M<p.length;M++)y=Kn(p[M]),nr(p[1])==="$type"?w=w.concat(Xo({key:g+"["+M+"]",value:p[M],valueSpec:E.geometry_type,style:s.style,styleSpec:s.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&w.push(new ve(g+"["+M+"]",p[M],"string, number, or boolean expected, "+y+" found"));break;case"any":case"all":case"none":for(var L=1;L<p.length;L++)w=w.concat(o({key:g+"["+L+"]",value:p[L],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":y=Kn(p[1]),p.length!==2?w.push(new ve(g,p,'filter array for "'+p[0]+'" operator must have 2 elements')):y!=="string"&&w.push(new ve(g+"[1]",p[1],"string expected, "+y+" found"));break;case"within":y=Kn(p[1]),p.length!==2?w.push(new ve(g,p,'filter array for "'+p[0]+'" operator must have 2 elements')):y!=="object"&&w.push(new ve(g+"[1]",p[1],"object expected, "+y+" found"))}return w}(n)}function Cc(n,o){var s=n.key,p=n.style,g=n.styleSpec,y=n.value,E=n.objectKey,w=g[o+"_"+n.layerType];if(!w)return[];var M=E.match(/^(.*)-transition$/);if(o==="paint"&&M&&w[M[1]]&&w[M[1]].transition)return yi({key:s,value:y,valueSpec:g.transition,style:p,styleSpec:g});var L,k=n.valueSpec||w[E];if(!k)return[new ve(s,y,'unknown property "'+E+'"')];if(Kn(y)==="string"&&ku(k)&&!k.tokens&&(L=/^{([^}]+)}$/.exec(y)))return[new ve(s,y,'"'+E+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(L[1])+" }`.")];var Z=[];return n.layerType==="symbol"&&(E==="text-field"&&p&&!p.glyphs&&Z.push(new ve(s,y,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&ah(_t(y))&&nr(y.type)==="identity"&&Z.push(new ve(s,y,'"text-font" does not support identity functions'))),Z.concat(yi({key:n.key,value:y,valueSpec:k,style:p,styleSpec:g,expressionContext:"property",propertyType:o,propertyKey:E}))}function Nh(n){return Cc(n,"paint")}function $l(n){return Cc(n,"layout")}function Ql(n){var o=[],s=n.value,p=n.key,g=n.style,y=n.styleSpec;s.type||s.ref||o.push(new ve(p,s,'either "type" or "ref" is required'));var E,w=nr(s.type),M=nr(s.ref);if(s.id)for(var L=nr(s.id),k=0;k<n.arrayIndex;k++){var Z=g.layers[k];nr(Z.id)===L&&o.push(new ve(p,s.id,'duplicate layer id "'+s.id+'", previously used at line '+Z.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(ye){ye in s&&o.push(new ve(p,s[ye],'"'+ye+'" is prohibited for ref layers'))}),g.layers.forEach(function(ye){nr(ye.id)===M&&(E=ye)}),E?E.ref?o.push(new ve(p,s.ref,"ref cannot reference another ref layer")):w=nr(E.type):o.push(new ve(p,s.ref,'ref layer "'+M+'" not found'));else if(w!=="background")if(s.source){var q=g.sources&&g.sources[s.source],te=q&&nr(q.type);q?te==="vector"&&w==="raster"?o.push(new ve(p,s.source,'layer "'+s.id+'" requires a raster source')):te==="raster"&&w!=="raster"?o.push(new ve(p,s.source,'layer "'+s.id+'" requires a vector source')):te!=="vector"||s["source-layer"]?te==="raster-dem"&&w!=="hillshade"?o.push(new ve(p,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!s.paint||!s.paint["line-gradient"]||te==="geojson"&&q.lineMetrics||o.push(new ve(p,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new ve(p,s,'layer "'+s.id+'" must specify a "source-layer"')):o.push(new ve(p,s.source,'source "'+s.source+'" not found'))}else o.push(new ve(p,s,'missing required property "source"'));return o=o.concat(Ys({key:p,value:s,valueSpec:y.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return yi({key:p+".type",value:s.type,valueSpec:y.layer.type,style:n.style,styleSpec:n.styleSpec,object:s,objectKey:"type"})},filter:Fh,layout:function(ye){return Ys({layer:s,key:ye.key,value:ye.value,style:ye.style,styleSpec:ye.styleSpec,objectElementValidators:{"*":function(Te){return $l(wt({layerType:w},Te))}}})},paint:function(ye){return Ys({layer:s,key:ye.key,value:ye.value,style:ye.style,styleSpec:ye.styleSpec,objectElementValidators:{"*":function(Te){return Nh(wt({layerType:w},Te))}}})}}}))}function Cl(n){var o=n.value,s=n.key,p=Kn(o);return p!=="string"?[new ve(s,o,"string expected, "+p+" found")]:[]}var mo={promoteId:function(n){var o=n.key,s=n.value;if(Kn(s)==="string")return Cl({key:o,value:s});var p=[];for(var g in s)p.push.apply(p,Cl({key:o+"."+g,value:s[g]}));return p}};function lh(n){var o=n.value,s=n.key,p=n.styleSpec,g=n.style;if(!o.type)return[new ve(s,o,'"type" is required')];var y,E=nr(o.type);switch(E){case"vector":case"raster":case"raster-dem":return Ys({key:s,value:o,valueSpec:p["source_"+E.replace("-","_")],style:n.style,styleSpec:p,objectElementValidators:mo});case"geojson":if(y=Ys({key:s,value:o,valueSpec:p.source_geojson,style:g,styleSpec:p,objectElementValidators:mo}),o.cluster)for(var w in o.clusterProperties){var M=o.clusterProperties[w],L=M[0],k=typeof L=="string"?[L,["accumulated"],["get",w]]:L;y.push.apply(y,ol({key:s+"."+w+".map",value:M[1],expressionContext:"cluster-map"})),y.push.apply(y,ol({key:s+"."+w+".reduce",value:k,expressionContext:"cluster-reduce"}))}return y;case"video":return Ys({key:s,value:o,valueSpec:p.source_video,style:g,styleSpec:p});case"image":return Ys({key:s,value:o,valueSpec:p.source_image,style:g,styleSpec:p});case"canvas":return[new ve(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xo({key:s+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:p})}}function Au(n){var o=n.value,s=n.styleSpec,p=s.light,g=n.style,y=[],E=Kn(o);if(o===void 0)return y;if(E!=="object")return y.concat([new ve("light",o,"object expected, "+E+" found")]);for(var w in o){var M=w.match(/^(.*)-transition$/);y=y.concat(M&&p[M[1]]&&p[M[1]].transition?yi({key:w,value:o[w],valueSpec:s.transition,style:g,styleSpec:s}):p[w]?yi({key:w,value:o[w],valueSpec:p[w],style:g,styleSpec:s}):[new ve(w,o[w],'unknown property "'+w+'"')])}return y}var Rl={"*":function(){return[]},array:sh,boolean:function(n){var o=n.value,s=n.key,p=Kn(o);return p!=="boolean"?[new ve(s,o,"boolean expected, "+p+" found")]:[]},number:_f,color:function(n){var o=n.key,s=n.value,p=Kn(s);return p!=="string"?[new ve(o,s,"color expected, "+p+" found")]:Jn(s)===null?[new ve(o,s,'color expected, "'+s+'" found')]:[]},constants:rt,enum:Xo,filter:Fh,function:yf,layer:Ql,object:Ys,source:lh,light:Au,string:Cl,formatted:function(n){return Cl(n).length===0?[]:ol(n)},resolvedImage:function(n){return Cl(n).length===0?[]:ol(n)}};function yi(n){var o=n.value,s=n.valueSpec,p=n.styleSpec;return s.expression&&ah(nr(o))?yf(n):s.expression&&As(_t(o))?ol(n):s.type&&Rl[s.type]?Rl[s.type](n):Ys(wt({},n,{valueSpec:s.type?p[s.type]:s}))}function ho(n){var o=n.value,s=n.key,p=Cl(n);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new ve(s,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new ve(s,o,'"glyphs" url must include a "{range}" token'))),p}function ls(n,o){o===void 0&&(o=Q);var s=[];return s=s.concat(yi({key:"",value:n,valueSpec:o.$root,styleSpec:o,style:n,objectElementValidators:{glyphs:ho,"*":function(){return[]}}})),n.constants&&(s=s.concat(rt({key:"constants",value:n.constants,style:n,styleSpec:o}))),No(s)}function No(n){return[].concat(n).sort(function(o,s){return o.line-s.line})}function Vu(n){return function(){for(var o=[],s=arguments.length;s--;)o[s]=arguments[s];return No(n.apply(this,o))}}ls.source=Vu(lh),ls.light=Vu(Au),ls.layer=Vu(Ql),ls.filter=Vu(Fh),ls.paintProperty=Vu(Nh),ls.layoutProperty=Vu($l);var Rc=ls,xf=Rc.light,Ic=Rc.paintProperty,ch=Rc.layoutProperty;function Zu(n,o){var s=!1;if(o&&o.length)for(var p=0,g=o;p<g.length;p+=1)n.fire(new Se(new Error(g[p].message))),s=!0;return s}var Wo=Io;function Io(n,o,s){var p=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var g=new Int32Array(this.arrayBuffer);n=g[0],this.d=(o=g[1])+2*(s=g[2]);for(var y=0;y<this.d*this.d;y++){var E=g[3+y],w=g[3+y+1];p.push(E===w?null:g.subarray(E,w))}var M=g[3+p.length+1];this.keys=g.subarray(g[3+p.length],M),this.bboxes=g.subarray(M),this.insert=this._insertReadonly}else{this.d=o+2*s;for(var L=0;L<this.d*this.d;L++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=n,this.padding=s,this.scale=o/n,this.uid=0;var k=s/o*n;this.min=-k,this.max=n+k}Io.prototype.insert=function(n,o,s,p,g){this._forEachCell(o,s,p,g,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(g)},Io.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Io.prototype._insertCell=function(n,o,s,p,g,y){this.cells[g].push(y)},Io.prototype.query=function(n,o,s,p,g){var y=this.min,E=this.max;if(n<=y&&o<=y&&E<=s&&E<=p&&!g)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(n,o,s,p,this._queryCell,w,{},g),w},Io.prototype._queryCell=function(n,o,s,p,g,y,E,w){var M=this.cells[g];if(M!==null)for(var L=this.keys,k=this.bboxes,Z=0;Z<M.length;Z++){var q=M[Z];if(E[q]===void 0){var te=4*q;(w?w(k[te+0],k[te+1],k[te+2],k[te+3]):n<=k[te+2]&&o<=k[te+3]&&s>=k[te+0]&&p>=k[te+1])?(E[q]=!0,y.push(L[q])):E[q]=!1}}},Io.prototype._forEachCell=function(n,o,s,p,g,y,E,w){for(var M=this._convertToCellCoord(n),L=this._convertToCellCoord(o),k=this._convertToCellCoord(s),Z=this._convertToCellCoord(p),q=M;q<=k;q++)for(var te=L;te<=Z;te++){var ye=this.d*te+q;if((!w||w(this._convertFromCellCoord(q),this._convertFromCellCoord(te),this._convertFromCellCoord(q+1),this._convertFromCellCoord(te+1)))&&g.call(this,n,o,s,p,ye,y,E,w))return}},Io.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Io.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Io.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,o=3+this.cells.length+1+1,s=0,p=0;p<this.cells.length;p++)s+=this.cells[p].length;var g=new Int32Array(o+s+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var y=o,E=0;E<n.length;E++){var w=n[E];g[3+E]=y,g.set(w,y),y+=w.length}return g[3+n.length]=y,g.set(this.keys,y),g[3+n.length+1]=y+=this.keys.length,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer};var Jl=Re.ImageData,Uh=Re.ImageBitmap,Go={};function Hr(n,o,s){s===void 0&&(s={}),Object.defineProperty(o,"_classRegistryKey",{value:n,writeable:!1}),Go[n]={klass:o,omit:s.omit||[],shallow:s.shallow||[]}}for(var Ss in Hr("Object",Object),Wo.serialize=function(n,o){var s=n.toArrayBuffer();return o&&o.push(s),{buffer:s}},Wo.deserialize=function(n){return new Wo(n.buffer)},Hr("Grid",Wo),Hr("Color",oi),Hr("Error",Error),Hr("ResolvedImage",co),Hr("StylePropertyFunction",ql),Hr("StyleExpression",Sa,{omit:["_evaluator"]}),Hr("ZoomDependentExpression",Sl),Hr("ZoomConstantExpression",il),Hr("CompoundExpression",Yi,{omit:["_evaluate"]}),Tu)Tu[Ss]._classRegistryKey||Hr("Expression_"+Ss,Tu[Ss]);function hh(n){return n&&typeof ArrayBuffer!="undefined"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Mc(n){return Uh&&n instanceof Uh}function Qa(n,o){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(hh(n)||Mc(n))return o&&o.push(n),n;if(ArrayBuffer.isView(n)){var s=n;return o&&o.push(s.buffer),s}if(n instanceof Jl)return o&&o.push(n.data.buffer),n;if(Array.isArray(n)){for(var p=[],g=0,y=n;g<y.length;g+=1)p.push(Qa(y[g],o));return p}if(typeof n=="object"){var E=n.constructor,w=E._classRegistryKey;if(!w)throw new Error("can't serialize object of unregistered class");var M=E.serialize?E.serialize(n,o):{};if(!E.serialize){for(var L in n)if(n.hasOwnProperty(L)&&!(Go[w].omit.indexOf(L)>=0)){var k=n[L];M[L]=Go[w].shallow.indexOf(L)>=0?k:Qa(k,o)}n instanceof Error&&(M.message=n.message)}if(M.$name)throw new Error("$name property is reserved for worker serialization logic.");return w!=="Object"&&(M.$name=w),M}throw new Error("can't serialize object of type "+typeof n)}function io(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||hh(n)||Mc(n)||ArrayBuffer.isView(n)||n instanceof Jl)return n;if(Array.isArray(n))return n.map(io);if(typeof n=="object"){var o=n.$name||"Object",s=Go[o].klass;if(!s)throw new Error("can't deserialize unregistered class "+o);if(s.deserialize)return s.deserialize(n);for(var p=Object.create(s.prototype),g=0,y=Object.keys(n);g<y.length;g+=1){var E=y[g];if(E!=="$name"){var w=n[E];p[E]=Go[o].shallow.indexOf(E)>=0?w:io(w)}}return p}throw new Error("can't deserialize object of type "+typeof n)}var ec=function(){this.first=!0};ec.prototype.update=function(n,o){var s=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=o),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=s,!0))};var zr={"Latin-1 Supplement":function(n){return n>=128&&n<=255},Arabic:function(n){return n>=1536&&n<=1791},"Arabic Supplement":function(n){return n>=1872&&n<=1919},"Arabic Extended-A":function(n){return n>=2208&&n<=2303},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},Khmer:function(n){return n>=6016&&n<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Arabic Presentation Forms-A":function(n){return n>=64336&&n<=65023},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Arabic Presentation Forms-B":function(n){return n>=65136&&n<=65279},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};function qs(n){for(var o=0,s=n;o<s.length;o+=1)if(Oc(s[o].charCodeAt(0)))return!0;return!1}function Oc(n){return!(n!==746&&n!==747&&(n<4352||!(zr["Bopomofo Extended"](n)||zr.Bopomofo(n)||zr["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||zr["CJK Compatibility Ideographs"](n)||zr["CJK Compatibility"](n)||zr["CJK Radicals Supplement"](n)||zr["CJK Strokes"](n)||!(!zr["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||zr["CJK Unified Ideographs Extension A"](n)||zr["CJK Unified Ideographs"](n)||zr["Enclosed CJK Letters and Months"](n)||zr["Hangul Compatibility Jamo"](n)||zr["Hangul Jamo Extended-A"](n)||zr["Hangul Jamo Extended-B"](n)||zr["Hangul Jamo"](n)||zr["Hangul Syllables"](n)||zr.Hiragana(n)||zr["Ideographic Description Characters"](n)||zr.Kanbun(n)||zr["Kangxi Radicals"](n)||zr["Katakana Phonetic Extensions"](n)||zr.Katakana(n)&&n!==12540||!(!zr["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!zr["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||zr["Unified Canadian Aboriginal Syllabics"](n)||zr["Unified Canadian Aboriginal Syllabics Extended"](n)||zr["Vertical Forms"](n)||zr["Yijing Hexagram Symbols"](n)||zr["Yi Syllables"](n)||zr["Yi Radicals"](n))))}function Pc(n){return!(Oc(n)||function(o){return!!(zr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||zr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||zr["Letterlike Symbols"](o)||zr["Number Forms"](o)||zr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||zr["Control Pictures"](o)&&o!==9251||zr["Optical Character Recognition"](o)||zr["Enclosed Alphanumerics"](o)||zr["Geometric Shapes"](o)||zr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||zr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||zr["CJK Symbols and Punctuation"](o)||zr.Katakana(o)||zr["Private Use Area"](o)||zr["CJK Compatibility Forms"](o)||zr["Small Form Variants"](o)||zr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(n))}function Ks(n){return n>=1424&&n<=2303||zr["Arabic Presentation Forms-A"](n)||zr["Arabic Presentation Forms-B"](n)}function cs(n,o){return!(!o&&Ks(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||zr.Khmer(n))}function kh(n){for(var o=0,s=n;o<s.length;o+=1)if(Ks(s[o].charCodeAt(0)))return!0;return!1}var fh=null,hs="unavailable",Ja=null,bf=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(hs="error"),fh&&fh(n)};function tc(){zh.fire(new ce("pluginStateChange",{pluginStatus:hs,pluginURL:Ja}))}var zh=new Ue,Ef=function(){return hs},ws=function(){if(hs!=="deferred"||!Ja)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");hs="loading",tc(),Ja&&sr({url:Ja},function(n){n?bf(n):(hs="loaded",tc())})},$s={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return hs==="loaded"||$s.applyArabicShaping!=null},isLoading:function(){return hs==="loading"},setState:function(n){hs=n.pluginStatus,Ja=n.pluginURL},isParsed:function(){return $s.applyArabicShaping!=null&&$s.processBidirectionalText!=null&&$s.processStyledBidirectionalText!=null},getPluginURL:function(){return Ja}},$n=function(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ec,this.transition={})};$n.prototype.isSupportedScript=function(n){return function(o,s){for(var p=0,g=o;p<g.length;p+=1)if(!cs(g[p].charCodeAt(0),s))return!1;return!0}(n,$s.isLoaded())},$n.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},$n.prototype.getCrossfadeParameters=function(){var n=this.zoom,o=n-Math.floor(n),s=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*o}};var zs=function(n,o){this.property=n,this.value=o,this.expression=function(s,p){if(ah(s))return new ql(s,p);if(As(s)){var g=Ac(s,p);if(g.result==="error")throw new Error(g.value.map(function(E){return E.key+": "+E.message}).join(", "));return g.value}var y=s;return typeof s=="string"&&p.type==="color"&&(y=oi.parse(s)),{kind:"constant",evaluate:function(){return y}}}(o===void 0?n.specification.default:o,n.specification)};zs.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},zs.prototype.possiblyEvaluate=function(n,o,s){return this.property.possiblyEvaluate(this,n,o,s)};var Vs=function(n){this.property=n,this.value=new zs(n,void 0)};Vs.prototype.transitioned=function(n,o){return new Il(this.property,this.value,o,ir({},n.transition,this.transition),n.now)},Vs.prototype.untransitioned=function(){return new Il(this.property,this.value,null,{},0)};var da=function(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)};da.prototype.getValue=function(n){return Pe(this._values[n].value.value)},da.prototype.setValue=function(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Vs(this._values[n].property)),this._values[n].value=new zs(this._values[n].property,o===null?void 0:Pe(o))},da.prototype.getTransition=function(n){return Pe(this._values[n].transition)},da.prototype.setTransition=function(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Vs(this._values[n].property)),this._values[n].transition=Pe(o)||void 0},da.prototype.serialize=function(){for(var n={},o=0,s=Object.keys(this._values);o<s.length;o+=1){var p=s[o],g=this.getValue(p);g!==void 0&&(n[p]=g);var y=this.getTransition(p);y!==void 0&&(n[p+"-transition"]=y)}return n},da.prototype.transitioned=function(n,o){for(var s=new ju(this._properties),p=0,g=Object.keys(this._values);p<g.length;p+=1){var y=g[p];s._values[y]=this._values[y].transitioned(n,o._values[y])}return s},da.prototype.untransitioned=function(){for(var n=new ju(this._properties),o=0,s=Object.keys(this._values);o<s.length;o+=1){var p=s[o];n._values[p]=this._values[p].untransitioned()}return n};var Il=function(n,o,s,p,g){this.property=n,this.value=o,this.begin=g+p.delay||0,this.end=this.begin+p.duration||0,n.specification.transition&&(p.delay||p.duration)&&(this.prior=s)};Il.prototype.possiblyEvaluate=function(n,o,s){var p=n.now||0,g=this.value.possiblyEvaluate(n,o,s),y=this.prior;if(y){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return y.possiblyEvaluate(n,o,s);var E=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(n,o,s),g,function(w){if(w<=0)return 0;if(w>=1)return 1;var M=w*w,L=M*w;return 4*(w<.5?L:3*(w-M)+L-.75)}(E))}return g};var ju=function(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)};ju.prototype.possiblyEvaluate=function(n,o,s){for(var p=new rc(this._properties),g=0,y=Object.keys(this._values);g<y.length;g+=1){var E=y[g];p._values[E]=this._values[E].possiblyEvaluate(n,o,s)}return p},ju.prototype.hasTransition=function(){for(var n=0,o=Object.keys(this._values);n<o.length;n+=1)if(this._values[o[n]].prior)return!0;return!1};var Qs=function(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)};Qs.prototype.getValue=function(n){return Pe(this._values[n].value)},Qs.prototype.setValue=function(n,o){this._values[n]=new zs(this._values[n].property,o===null?void 0:Pe(o))},Qs.prototype.serialize=function(){for(var n={},o=0,s=Object.keys(this._values);o<s.length;o+=1){var p=s[o],g=this.getValue(p);g!==void 0&&(n[p]=g)}return n},Qs.prototype.possiblyEvaluate=function(n,o,s){for(var p=new rc(this._properties),g=0,y=Object.keys(this._values);g<y.length;g+=1){var E=y[g];p._values[E]=this._values[E].possiblyEvaluate(n,o,s)}return p};var es=function(n,o,s){this.property=n,this.value=o,this.parameters=s};es.prototype.isConstant=function(){return this.value.kind==="constant"},es.prototype.constantOr=function(n){return this.value.kind==="constant"?this.value.value:n},es.prototype.evaluate=function(n,o,s,p){return this.property.evaluate(this.value,this.parameters,n,o,s,p)};var rc=function(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)};rc.prototype.get=function(n){return this._values[n]};var bn=function(n){this.specification=n};bn.prototype.possiblyEvaluate=function(n,o){return n.expression.evaluate(o)},bn.prototype.interpolate=function(n,o,s){var p=Eu[this.specification.type];return p?p(n,o,s):n};var ln=function(n,o){this.specification=n,this.overrides=o};ln.prototype.possiblyEvaluate=function(n,o,s,p){return new es(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},s,p)}:n.expression,o)},ln.prototype.interpolate=function(n,o,s){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new es(this,{kind:"constant",value:void 0},n.parameters);var p=Eu[this.specification.type];return p?new es(this,{kind:"constant",value:p(n.value.value,o.value.value,s)},n.parameters):n},ln.prototype.evaluate=function(n,o,s,p,g,y){return n.kind==="constant"?n.value:n.evaluate(o,s,p,g,y)};var fs=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(s,p,g,y){if(s.value===void 0)return new es(this,{kind:"constant",value:void 0},p);if(s.expression.kind==="constant"){var E=s.expression.evaluate(p,null,{},g,y),w=s.property.specification.type==="resolvedImage"&&typeof E!="string"?E.name:E,M=this._calculate(w,w,w,p);return new es(this,{kind:"constant",value:M},p)}if(s.expression.kind==="camera"){var L=this._calculate(s.expression.evaluate({zoom:p.zoom-1}),s.expression.evaluate({zoom:p.zoom}),s.expression.evaluate({zoom:p.zoom+1}),p);return new es(this,{kind:"constant",value:L},p)}return new es(this,s.expression,p)},o.prototype.evaluate=function(s,p,g,y,E,w){if(s.kind==="source"){var M=s.evaluate(p,g,y,E,w);return this._calculate(M,M,M,p)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(p.zoom)-1},g,y),s.evaluate({zoom:Math.floor(p.zoom)},g,y),s.evaluate({zoom:Math.floor(p.zoom)+1},g,y),p):s.value},o.prototype._calculate=function(s,p,g,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:s,to:p}:{from:g,to:p}},o.prototype.interpolate=function(s){return s},o}(ln),Ga=function(n){this.specification=n};Ga.prototype.possiblyEvaluate=function(n,o,s,p){if(n.value!==void 0){if(n.expression.kind==="constant"){var g=n.expression.evaluate(o,null,{},s,p);return this._calculate(g,g,g,o)}return this._calculate(n.expression.evaluate(new $n(Math.floor(o.zoom-1),o)),n.expression.evaluate(new $n(Math.floor(o.zoom),o)),n.expression.evaluate(new $n(Math.floor(o.zoom+1),o)),o)}},Ga.prototype._calculate=function(n,o,s,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:o}:{from:s,to:o}},Ga.prototype.interpolate=function(n){return n};var uu=function(n){this.specification=n};uu.prototype.possiblyEvaluate=function(n,o,s,p){return!!n.expression.evaluate(o,null,{},s,p)},uu.prototype.interpolate=function(){return!1};var xo=function(n){for(var o in this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],n){var s=n[o];s.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new zs(s,void 0),g=this.defaultTransitionablePropertyValues[o]=new Vs(s);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};Hr("DataDrivenProperty",ln),Hr("DataConstantProperty",bn),Hr("CrossFadedDataDrivenProperty",fs),Hr("CrossFadedProperty",Ga),Hr("ColorRampProperty",uu);var Zs=function(n){function o(s,p){if(n.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),p.layout&&(this._unevaluatedLayout=new Qs(p.layout)),p.paint)){for(var g in this._transitionablePaint=new da(p.paint),s.paint)this.setPaintProperty(g,s.paint[g],{validate:!1});for(var y in s.layout)this.setLayoutProperty(y,s.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new rc(p.paint)}}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},o.prototype.setLayoutProperty=function(s,p,g){g===void 0&&(g={}),p!=null&&this._validate(ch,"layers."+this.id+".layout."+s,s,p,g)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,p):this.visibility=p)},o.prototype.getPaintProperty=function(s){return ii(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)},o.prototype.setPaintProperty=function(s,p,g){if(g===void 0&&(g={}),p!=null&&this._validate(Ic,"layers."+this.id+".paint."+s,s,p,g))return!1;if(ii(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-11),p||void 0),!1;var y=this._transitionablePaint._values[s],E=y.property.specification["property-type"]==="cross-faded-data-driven",w=y.value.isDataDriven(),M=y.value;this._transitionablePaint.setValue(s,p),this._handleSpecialPaintPropertyUpdate(s);var L=this._transitionablePaint._values[s].value;return L.isDataDriven()||w||E||this._handleOverridablePaintPropertyUpdate(s,M,L)},o.prototype._handleSpecialPaintPropertyUpdate=function(s){},o.prototype._handleOverridablePaintPropertyUpdate=function(s,p,g){return!1},o.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(s,p){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,p)},o.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),xt(s,function(p,g){return!(p===void 0||g==="layout"&&!Object.keys(p).length||g==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(s,p,g,y,E){return E===void 0&&(E={}),(!E||E.validate!==!1)&&Zu(this,s.call(Rc,{key:p,layerType:this.type,objectKey:g,value:y,styleSpec:Q,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var s in this.paint._values){var p=this.paint.get(s);if(p instanceof es&&ku(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(Ue),Su={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},nc=function(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Vi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ma(n,o){o===void 0&&(o=1);var s=0,p=0;return{members:n.map(function(g){var y=Su[g.type].BYTES_PER_ELEMENT,E=s=Vh(s,Math.max(o,y)),w=g.components||1;return p=Math.max(p,y),s+=y*w,{name:g.name,type:g.type,components:w,offset:E}}),size:Vh(s,Math.max(p,o)),alignment:o}}function Vh(n,o){return Math.ceil(n/o)*o}Vi.serialize=function(n,o){return n._trim(),o&&(n.isTransferred=!0,o.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}},Vi.deserialize=function(n){var o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},Vi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Vi.prototype.clear=function(){this.length=0},Vi.prototype.resize=function(n){this.reserve(n),this.length=n},Vi.prototype.reserve=function(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},Vi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ul=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p){var g=this.length;return this.resize(g+1),this.emplace(g,s,p)},o.prototype.emplace=function(s,p,g){var y=2*s;return this.int16[y+0]=p,this.int16[y+1]=g,s},o}(Vi);ul.prototype.bytesPerElement=4,Hr("StructArrayLayout2i4",ul);var Lc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y){var E=this.length;return this.resize(E+1),this.emplace(E,s,p,g,y)},o.prototype.emplace=function(s,p,g,y,E){var w=4*s;return this.int16[w+0]=p,this.int16[w+1]=g,this.int16[w+2]=y,this.int16[w+3]=E,s},o}(Vi);Lc.prototype.bytesPerElement=8,Hr("StructArrayLayout4i8",Lc);var Hu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E,w){var M=this.length;return this.resize(M+1),this.emplace(M,s,p,g,y,E,w)},o.prototype.emplace=function(s,p,g,y,E,w,M){var L=6*s;return this.int16[L+0]=p,this.int16[L+1]=g,this.int16[L+2]=y,this.int16[L+3]=E,this.int16[L+4]=w,this.int16[L+5]=M,s},o}(Vi);Hu.prototype.bytesPerElement=12,Hr("StructArrayLayout2i4i12",Hu);var Cs=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E,w){var M=this.length;return this.resize(M+1),this.emplace(M,s,p,g,y,E,w)},o.prototype.emplace=function(s,p,g,y,E,w,M){var L=4*s,k=8*s;return this.int16[L+0]=p,this.int16[L+1]=g,this.uint8[k+4]=y,this.uint8[k+5]=E,this.uint8[k+6]=w,this.uint8[k+7]=M,s},o}(Vi);Cs.prototype.bytesPerElement=8,Hr("StructArrayLayout2i4ub8",Cs);var ll=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p){var g=this.length;return this.resize(g+1),this.emplace(g,s,p)},o.prototype.emplace=function(s,p,g){var y=2*s;return this.float32[y+0]=p,this.float32[y+1]=g,s},o}(Vi);ll.prototype.bytesPerElement=8,Hr("StructArrayLayout2f8",ll);var lu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E,w,M,L,k,Z){var q=this.length;return this.resize(q+1),this.emplace(q,s,p,g,y,E,w,M,L,k,Z)},o.prototype.emplace=function(s,p,g,y,E,w,M,L,k,Z,q){var te=10*s;return this.uint16[te+0]=p,this.uint16[te+1]=g,this.uint16[te+2]=y,this.uint16[te+3]=E,this.uint16[te+4]=w,this.uint16[te+5]=M,this.uint16[te+6]=L,this.uint16[te+7]=k,this.uint16[te+8]=Z,this.uint16[te+9]=q,s},o}(Vi);lu.prototype.bytesPerElement=20,Hr("StructArrayLayout10ui20",lu);var Zh=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E,w,M,L,k,Z,q,te){var ye=this.length;return this.resize(ye+1),this.emplace(ye,s,p,g,y,E,w,M,L,k,Z,q,te)},o.prototype.emplace=function(s,p,g,y,E,w,M,L,k,Z,q,te,ye){var Te=12*s;return this.int16[Te+0]=p,this.int16[Te+1]=g,this.int16[Te+2]=y,this.int16[Te+3]=E,this.uint16[Te+4]=w,this.uint16[Te+5]=M,this.uint16[Te+6]=L,this.uint16[Te+7]=k,this.int16[Te+8]=Z,this.int16[Te+9]=q,this.int16[Te+10]=te,this.int16[Te+11]=ye,s},o}(Vi);Zh.prototype.bytesPerElement=24,Hr("StructArrayLayout4i4ui4i24",Zh);var ic=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g){var y=this.length;return this.resize(y+1),this.emplace(y,s,p,g)},o.prototype.emplace=function(s,p,g,y){var E=3*s;return this.float32[E+0]=p,this.float32[E+1]=g,this.float32[E+2]=y,s},o}(Vi);ic.prototype.bytesPerElement=12,Hr("StructArrayLayout3f12",ic);var wa=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},o.prototype.emplace=function(s,p){return this.uint32[1*s+0]=p,s},o}(Vi);wa.prototype.bytesPerElement=4,Hr("StructArrayLayout1ul4",wa);var oc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E,w,M,L,k){var Z=this.length;return this.resize(Z+1),this.emplace(Z,s,p,g,y,E,w,M,L,k)},o.prototype.emplace=function(s,p,g,y,E,w,M,L,k,Z){var q=10*s,te=5*s;return this.int16[q+0]=p,this.int16[q+1]=g,this.int16[q+2]=y,this.int16[q+3]=E,this.int16[q+4]=w,this.int16[q+5]=M,this.uint32[te+3]=L,this.uint16[q+8]=k,this.uint16[q+9]=Z,s},o}(Vi);oc.prototype.bytesPerElement=20,Hr("StructArrayLayout6i1ul2ui20",oc);var cu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E,w){var M=this.length;return this.resize(M+1),this.emplace(M,s,p,g,y,E,w)},o.prototype.emplace=function(s,p,g,y,E,w,M){var L=6*s;return this.int16[L+0]=p,this.int16[L+1]=g,this.int16[L+2]=y,this.int16[L+3]=E,this.int16[L+4]=w,this.int16[L+5]=M,s},o}(Vi);cu.prototype.bytesPerElement=12,Hr("StructArrayLayout2i2i2i12",cu);var ka=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E){var w=this.length;return this.resize(w+1),this.emplace(w,s,p,g,y,E)},o.prototype.emplace=function(s,p,g,y,E,w){var M=4*s,L=8*s;return this.float32[M+0]=p,this.float32[M+1]=g,this.float32[M+2]=y,this.int16[L+6]=E,this.int16[L+7]=w,s},o}(Vi);ka.prototype.bytesPerElement=16,Hr("StructArrayLayout2f1f2i16",ka);var ph=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y){var E=this.length;return this.resize(E+1),this.emplace(E,s,p,g,y)},o.prototype.emplace=function(s,p,g,y,E){var w=12*s,M=3*s;return this.uint8[w+0]=p,this.uint8[w+1]=g,this.float32[M+1]=y,this.float32[M+2]=E,s},o}(Vi);ph.prototype.bytesPerElement=12,Hr("StructArrayLayout2ub2f12",ph);var hu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g){var y=this.length;return this.resize(y+1),this.emplace(y,s,p,g)},o.prototype.emplace=function(s,p,g,y){var E=3*s;return this.uint16[E+0]=p,this.uint16[E+1]=g,this.uint16[E+2]=y,s},o}(Vi);hu.prototype.bytesPerElement=6,Hr("StructArrayLayout3ui6",hu);var Rs=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E,w,M,L,k,Z,q,te,ye,Te,Ge,Le,nt){var ft=this.length;return this.resize(ft+1),this.emplace(ft,s,p,g,y,E,w,M,L,k,Z,q,te,ye,Te,Ge,Le,nt)},o.prototype.emplace=function(s,p,g,y,E,w,M,L,k,Z,q,te,ye,Te,Ge,Le,nt,ft){var Pt=24*s,Ut=12*s,er=48*s;return this.int16[Pt+0]=p,this.int16[Pt+1]=g,this.uint16[Pt+2]=y,this.uint16[Pt+3]=E,this.uint32[Ut+2]=w,this.uint32[Ut+3]=M,this.uint32[Ut+4]=L,this.uint16[Pt+10]=k,this.uint16[Pt+11]=Z,this.uint16[Pt+12]=q,this.float32[Ut+7]=te,this.float32[Ut+8]=ye,this.uint8[er+36]=Te,this.uint8[er+37]=Ge,this.uint8[er+38]=Le,this.uint32[Ut+10]=nt,this.int16[Pt+22]=ft,s},o}(Vi);Rs.prototype.bytesPerElement=48,Hr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Rs);var dh=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y,E,w,M,L,k,Z,q,te,ye,Te,Ge,Le,nt,ft,Pt,Ut,er,Ar,Nr,yn,en,En,tn,si){var kn=this.length;return this.resize(kn+1),this.emplace(kn,s,p,g,y,E,w,M,L,k,Z,q,te,ye,Te,Ge,Le,nt,ft,Pt,Ut,er,Ar,Nr,yn,en,En,tn,si)},o.prototype.emplace=function(s,p,g,y,E,w,M,L,k,Z,q,te,ye,Te,Ge,Le,nt,ft,Pt,Ut,er,Ar,Nr,yn,en,En,tn,si,kn){var hn=34*s,hi=17*s;return this.int16[hn+0]=p,this.int16[hn+1]=g,this.int16[hn+2]=y,this.int16[hn+3]=E,this.int16[hn+4]=w,this.int16[hn+5]=M,this.int16[hn+6]=L,this.int16[hn+7]=k,this.uint16[hn+8]=Z,this.uint16[hn+9]=q,this.uint16[hn+10]=te,this.uint16[hn+11]=ye,this.uint16[hn+12]=Te,this.uint16[hn+13]=Ge,this.uint16[hn+14]=Le,this.uint16[hn+15]=nt,this.uint16[hn+16]=ft,this.uint16[hn+17]=Pt,this.uint16[hn+18]=Ut,this.uint16[hn+19]=er,this.uint16[hn+20]=Ar,this.uint16[hn+21]=Nr,this.uint16[hn+22]=yn,this.uint32[hi+12]=en,this.float32[hi+13]=En,this.float32[hi+14]=tn,this.float32[hi+15]=si,this.float32[hi+16]=kn,s},o}(Vi);dh.prototype.bytesPerElement=68,Hr("StructArrayLayout8i15ui1ul4f68",dh);var cl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},o.prototype.emplace=function(s,p){return this.float32[1*s+0]=p,s},o}(Vi);cl.prototype.bytesPerElement=4,Hr("StructArrayLayout1f4",cl);var Js=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g){var y=this.length;return this.resize(y+1),this.emplace(y,s,p,g)},o.prototype.emplace=function(s,p,g,y){var E=3*s;return this.int16[E+0]=p,this.int16[E+1]=g,this.int16[E+2]=y,s},o}(Vi);Js.prototype.bytesPerElement=6,Hr("StructArrayLayout3i6",Js);var mh=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g){var y=this.length;return this.resize(y+1),this.emplace(y,s,p,g)},o.prototype.emplace=function(s,p,g,y){var E=4*s;return this.uint32[2*s+0]=p,this.uint16[E+2]=g,this.uint16[E+3]=y,s},o}(Vi);mh.prototype.bytesPerElement=8,Hr("StructArrayLayout1ul2ui8",mh);var Ml=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p){var g=this.length;return this.resize(g+1),this.emplace(g,s,p)},o.prototype.emplace=function(s,p,g){var y=2*s;return this.uint16[y+0]=p,this.uint16[y+1]=g,s},o}(Vi);Ml.prototype.bytesPerElement=4,Hr("StructArrayLayout2ui4",Ml);var jh=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},o.prototype.emplace=function(s,p){return this.uint16[1*s+0]=p,s},o}(Vi);jh.prototype.bytesPerElement=2,Hr("StructArrayLayout1ui2",jh);var Dc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(s,p,g,y){var E=this.length;return this.resize(E+1),this.emplace(E,s,p,g,y)},o.prototype.emplace=function(s,p,g,y,E){var w=4*s;return this.float32[w+0]=p,this.float32[w+1]=g,this.float32[w+2]=y,this.float32[w+3]=E,s},o}(Vi);Dc.prototype.bytesPerElement=16,Hr("StructArrayLayout4f16",Dc);var l=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new Oe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,s),o}(nc);l.prototype.size=20;var h=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(s){return new l(this,s)},o}(oc);Hr("CollisionBoxArray",h);var c=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,s),o}(nc);c.prototype.size=48;var d=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(s){return new c(this,s)},o}(Rs);Hr("PlacedSymbolArray",d);var x=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,s),o}(nc);x.prototype.size=68;var T=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(s){return new x(this,s)},o}(dh);Hr("SymbolInstanceArray",T);var S=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getoffsetX=function(s){return this.float32[1*s+0]},o}(cl);Hr("GlyphOffsetArray",S);var I=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getx=function(s){return this.int16[3*s+0]},o.prototype.gety=function(s){return this.int16[3*s+1]},o.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},o}(Js);Hr("SymbolLineVertexArray",I);var N=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,s),o}(nc);N.prototype.size=8;var j=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(s){return new N(this,s)},o}(mh);Hr("FeatureIndexArray",j);var ne=ma([{name:"a_pos",components:2,type:"Int16"}],4).members,oe=function(n){n===void 0&&(n=[]),this.segments=n};function se(n,o){return 256*(n=qt(Math.floor(n),0,255))+qt(Math.floor(o),0,255)}oe.prototype.prepareSegment=function(n,o,s,p){var g=this.segments[this.segments.length-1];return n>oe.MAX_VERTEX_ARRAY_LENGTH&&tt("Max vertices per segment is "+oe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+n),(!g||g.vertexLength+n>oe.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:o.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g},oe.prototype.get=function(){return this.segments},oe.prototype.destroy=function(){for(var n=0,o=this.segments;n<o.length;n+=1){var s=o[n];for(var p in s.vaos)s.vaos[p].destroy()}},oe.simpleSegment=function(n,o,s,p){return new oe([{vertexOffset:n,primitiveOffset:o,vertexLength:s,primitiveLength:p,vaos:{},sortKey:0}])},oe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Hr("SegmentVector",oe);var we=ma([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),be=at(function(n){n.exports=function(o,s){var p,g,y,E,w,M,L,k;for(g=o.length-(p=3&o.length),y=s,w=3432918353,M=461845907,k=0;k<g;)L=255&o.charCodeAt(k)|(255&o.charCodeAt(++k))<<8|(255&o.charCodeAt(++k))<<16|(255&o.charCodeAt(++k))<<24,++k,y=27492+(65535&(E=5*(65535&(y=(y^=L=(65535&(L=(L=(65535&L)*w+(((L>>>16)*w&65535)<<16)&4294967295)<<15|L>>>17))*M+(((L>>>16)*M&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(L=0,p){case 3:L^=(255&o.charCodeAt(k+2))<<16;case 2:L^=(255&o.charCodeAt(k+1))<<8;case 1:y^=L=(65535&(L=(L=(65535&(L^=255&o.charCodeAt(k)))*w+(((L>>>16)*w&65535)<<16)&4294967295)<<15|L>>>17))*M+(((L>>>16)*M&65535)<<16)&4294967295}return y^=o.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}}),Ze=at(function(n){n.exports=function(o,s){for(var p,g=o.length,y=s^g,E=0;g>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24))+((1540483477*(p>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),g-=4,++E;switch(g){case 3:y^=(255&o.charCodeAt(E+2))<<16;case 2:y^=(255&o.charCodeAt(E+1))<<8;case 1:y=1540483477*(65535&(y^=255&o.charCodeAt(E)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}}),ge=be,Ve=Ze;ge.murmur3=be,ge.murmur2=Ve;var $e=function(){this.ids=[],this.positions=[],this.indexed=!1};$e.prototype.add=function(n,o,s,p){this.ids.push(Lt(n)),this.positions.push(o,s,p)},$e.prototype.getPositions=function(n){for(var o=Lt(n),s=0,p=this.ids.length-1;s<p;){var g=s+p>>1;this.ids[g]>=o?p=g:s=g+1}for(var y=[];this.ids[s]===o;)y.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return y},$e.serialize=function(n,o){var s=new Float64Array(n.ids),p=new Uint32Array(n.positions);return function g(y,E,w,M){for(;w<M;){for(var L=y[w+M>>1],k=w-1,Z=M+1;;){do k++;while(y[k]<L);do Z--;while(y[Z]>L);if(k>=Z)break;Tt(y,k,Z),Tt(E,3*k,3*Z),Tt(E,3*k+1,3*Z+1),Tt(E,3*k+2,3*Z+2)}Z-w<M-Z?(g(y,E,w,Z),w=Z+1):(g(y,E,Z+1,M),M=Z)}}(s,p,0,s.length-1),o&&o.push(s.buffer,p.buffer),{ids:s,positions:p}},$e.deserialize=function(n){var o=new $e;return o.ids=n.ids,o.positions=n.positions,o.indexed=!0,o};var ht=Math.pow(2,53)-1;function Lt(n){var o=+n;return!isNaN(o)&&o<=ht?o:ge(String(n))}function Tt(n,o,s){var p=n[o];n[o]=n[s],n[s]=p}Hr("FeaturePositionMap",$e);var jt=function(n,o){this.gl=n.gl,this.location=o},ar=function(n){function o(s,p){n.call(this,s,p),this.current=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},o}(jt),Ir=function(n){function o(s,p){n.call(this,s,p),this.current=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},o}(jt),Tr=function(n){function o(s,p){n.call(this,s,p),this.current=[0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},o}(jt),Qr=function(n){function o(s,p){n.call(this,s,p),this.current=[0,0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},o}(jt),mn=function(n){function o(s,p){n.call(this,s,p),this.current=[0,0,0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},o}(jt),Cn=function(n){function o(s,p){n.call(this,s,p),this.current=oi.transparent}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},o}(jt),_n=new Float32Array(16),wi=function(n){function o(s,p){n.call(this,s,p),this.current=_n}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var p=1;p<16;p++)if(s[p]!==this.current[p]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},o}(jt);function nn(n){return[se(255*n.r,255*n.g),se(255*n.b,255*n.a)]}var Vn=function(n,o,s){this.value=n,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=s};Vn.prototype.setUniform=function(n,o,s){n.set(s.constantOr(this.value))},Vn.prototype.getBinding=function(n,o,s){return this.type==="color"?new Cn(n,o):new Ir(n,o)};var ri=function(n,o){this.uniformNames=o.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};ri.prototype.setConstantPatternPositions=function(n,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=n.tlbr},ri.prototype.setUniform=function(n,o,s,p){var g=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&n.set(g)},ri.prototype.getBinding=function(n,o,s){return s.substr(0,9)==="u_pattern"?new mn(n,o):new Ir(n,o)};var Zn=function(n,o,s,p){this.expression=n,this.type=s,this.maxValue=0,this.paintVertexAttributes=o.map(function(g){return{name:"a_"+g,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new p};Zn.prototype.populatePaintArray=function(n,o,s,p,g){var y=this.paintVertexArray.length,E=this.expression.evaluate(new $n(0),o,{},p,[],g);this.paintVertexArray.resize(n),this._setPaintValue(y,n,E)},Zn.prototype.updatePaintArray=function(n,o,s,p){var g=this.expression.evaluate({zoom:0},s,p);this._setPaintValue(n,o,g)},Zn.prototype._setPaintValue=function(n,o,s){if(this.type==="color")for(var p=nn(s),g=n;g<o;g++)this.paintVertexArray.emplace(g,p[0],p[1]);else{for(var y=n;y<o;y++)this.paintVertexArray.emplace(y,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},Zn.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Zn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Fn=function(n,o,s,p,g,y){this.expression=n,this.uniformNames=o.map(function(E){return"u_"+E+"_t"}),this.type=s,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=o.map(function(E){return{name:"a_"+E,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new y};Fn.prototype.populatePaintArray=function(n,o,s,p,g){var y=this.expression.evaluate(new $n(this.zoom),o,{},p,[],g),E=this.expression.evaluate(new $n(this.zoom+1),o,{},p,[],g),w=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(w,n,y,E)},Fn.prototype.updatePaintArray=function(n,o,s,p){var g=this.expression.evaluate({zoom:this.zoom},s,p),y=this.expression.evaluate({zoom:this.zoom+1},s,p);this._setPaintValue(n,o,g,y)},Fn.prototype._setPaintValue=function(n,o,s,p){if(this.type==="color")for(var g=nn(s),y=nn(p),E=n;E<o;E++)this.paintVertexArray.emplace(E,g[0],g[1],y[0],y[1]);else{for(var w=n;w<o;w++)this.paintVertexArray.emplace(w,s,p);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(p))}},Fn.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Fn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Fn.prototype.setUniform=function(n,o){var s=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=qt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);n.set(p)},Fn.prototype.getBinding=function(n,o,s){return new Ir(n,o)};var Wn=function(n,o,s,p,g,y){this.expression=n,this.type=o,this.useIntegerZoom=s,this.zoom=p,this.layerId=y,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g};Wn.prototype.populatePaintArray=function(n,o,s){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(p,n,o.patterns&&o.patterns[this.layerId],s)},Wn.prototype.updatePaintArray=function(n,o,s,p,g){this._setPaintValues(n,o,s.patterns&&s.patterns[this.layerId],g)},Wn.prototype._setPaintValues=function(n,o,s,p){if(p&&s){var g=p[s.min],y=p[s.mid],E=p[s.max];if(g&&y&&E)for(var w=n;w<o;w++)this.zoomInPaintVertexArray.emplace(w,y.tl[0],y.tl[1],y.br[0],y.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],y.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(w,y.tl[0],y.tl[1],y.br[0],y.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],y.pixelRatio,E.pixelRatio)}},Wn.prototype.upload=function(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,we.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,we.members,this.expression.isStateDependent))},Wn.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var In=function(n,o,s){this.binders={},this._buffers=[];var p=[];for(var g in n.paint._values)if(s(g)){var y=n.paint.get(g);if(y instanceof es&&ku(y.property.specification)){var E=ca(g,n.type),w=y.value,M=y.property.specification.type,L=y.property.useIntegerZoom,k=y.property.specification["property-type"],Z=k==="cross-faded"||k==="cross-faded-data-driven";if(w.kind==="constant")this.binders[g]=Z?new ri(w.value,E):new Vn(w.value,E,M),p.push("/u_"+g);else if(w.kind==="source"||Z){var q=Mo(g,M,"source");this.binders[g]=Z?new Wn(w,M,L,o,q,n.id):new Zn(w,E,M,q),p.push("/a_"+g)}else{var te=Mo(g,M,"composite");this.binders[g]=new Fn(w,E,M,L,o,te),p.push("/z_"+g)}}}this.cacheKey=p.sort().join("")};In.prototype.getMaxValue=function(n){var o=this.binders[n];return o instanceof Zn||o instanceof Fn?o.maxValue:0},In.prototype.populatePaintArrays=function(n,o,s,p,g){for(var y in this.binders){var E=this.binders[y];(E instanceof Zn||E instanceof Fn||E instanceof Wn)&&E.populatePaintArray(n,o,s,p,g)}},In.prototype.setConstantPatternPositions=function(n,o){for(var s in this.binders){var p=this.binders[s];p instanceof ri&&p.setConstantPatternPositions(n,o)}},In.prototype.updatePaintArrays=function(n,o,s,p,g){var y=!1;for(var E in n)for(var w=0,M=o.getPositions(E);w<M.length;w+=1){var L=M[w],k=s.feature(L.index);for(var Z in this.binders){var q=this.binders[Z];if((q instanceof Zn||q instanceof Fn||q instanceof Wn)&&q.expression.isStateDependent===!0){var te=p.paint.get(Z);q.expression=te.value,q.updatePaintArray(L.start,L.end,k,n[E],g),y=!0}}}return y},In.prototype.defines=function(){var n=[];for(var o in this.binders){var s=this.binders[o];(s instanceof Vn||s instanceof ri)&&n.push.apply(n,s.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return n},In.prototype.getBinderAttributes=function(){var n=[];for(var o in this.binders){var s=this.binders[o];if(s instanceof Zn||s instanceof Fn)for(var p=0;p<s.paintVertexAttributes.length;p++)n.push(s.paintVertexAttributes[p].name);else if(s instanceof Wn)for(var g=0;g<we.members.length;g++)n.push(we.members[g].name)}return n},In.prototype.getBinderUniforms=function(){var n=[];for(var o in this.binders){var s=this.binders[o];if(s instanceof Vn||s instanceof ri||s instanceof Fn)for(var p=0,g=s.uniformNames;p<g.length;p+=1)n.push(g[p])}return n},In.prototype.getPaintVertexBuffers=function(){return this._buffers},In.prototype.getUniforms=function(n,o){var s=[];for(var p in this.binders){var g=this.binders[p];if(g instanceof Vn||g instanceof ri||g instanceof Fn)for(var y=0,E=g.uniformNames;y<E.length;y+=1){var w=E[y];if(o[w]){var M=g.getBinding(n,o[w],w);s.push({name:w,property:p,binding:M})}}}return s},In.prototype.setUniforms=function(n,o,s,p){for(var g=0,y=o;g<y.length;g+=1){var E=y[g],w=E.name,M=E.property;this.binders[M].setUniform(E.binding,p,s.get(M),w)}},In.prototype.updatePaintBuffers=function(n){for(var o in this._buffers=[],this.binders){var s=this.binders[o];if(n&&s instanceof Wn){var p=n.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(s instanceof Zn||s instanceof Fn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},In.prototype.upload=function(n){for(var o in this.binders){var s=this.binders[o];(s instanceof Zn||s instanceof Fn||s instanceof Wn)&&s.upload(n)}this.updatePaintBuffers()},In.prototype.destroy=function(){for(var n in this.binders){var o=this.binders[n];(o instanceof Zn||o instanceof Fn||o instanceof Wn)&&o.destroy()}};var Pn=function(n,o,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var p=0,g=n;p<g.length;p+=1){var y=g[p];this.programConfigurations[y.id]=new In(y,o,s)}this.needsUpload=!1,this._featureMap=new $e,this._bufferOffset=0};function ca(n,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(o+"-","").replace(/-/g,"_")]}function Mo(n,o,s){var p={color:{source:ll,composite:Dc},number:{source:cl,composite:ll}},g=function(y){return{"line-pattern":{source:lu,composite:lu},"fill-pattern":{source:lu,composite:lu},"fill-extrusion-pattern":{source:lu,composite:lu}}[y]}(n);return g&&g[s]||p[o][s]}Pn.prototype.populatePaintArrays=function(n,o,s,p,g,y){for(var E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,o,p,g,y);o.id!==void 0&&this._featureMap.add(o.id,s,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0},Pn.prototype.updatePaintArrays=function(n,o,s,p){for(var g=0,y=s;g<y.length;g+=1){var E=y[g];this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(n,this._featureMap,o,E,p)||this.needsUpload}},Pn.prototype.get=function(n){return this.programConfigurations[n]},Pn.prototype.upload=function(n){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}},Pn.prototype.destroy=function(){for(var n in this.programConfigurations)this.programConfigurations[n].destroy()},Hr("ConstantBinder",Vn),Hr("CrossFadedConstantBinder",ri),Hr("SourceExpressionBinder",Zn),Hr("CrossFadedCompositeBinder",Wn),Hr("CompositeExpressionBinder",Fn),Hr("ProgramConfiguration",In,{omit:["_buffers"]}),Hr("ProgramConfigurationSet",Pn);var va=Math.pow(2,14)-1,ga=-va-1;function To(n){for(var o=8192/n.extent,s=n.loadGeometry(),p=0;p<s.length;p++)for(var g=s[p],y=0;y<g.length;y++){var E=g[y],w=Math.round(E.x*o),M=Math.round(E.y*o);E.x=qt(w,ga,va),E.y=qt(M,ga,va),(w<E.x||w>E.x+1||M<E.y||M>E.y+1)&&tt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function Ao(n,o){return{type:n.type,id:n.id,properties:n.properties,geometry:o?To(n):[]}}function Ya(n,o,s,p,g){n.emplaceBack(2*o+(p+1)/2,2*s+(g+1)/2)}var za=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ul,this.indexArray=new hu,this.segments=new oe,this.programConfigurations=new Pn(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function fu(n,o){for(var s=0;s<n.length;s++)if(pu(o,n[s]))return!0;for(var p=0;p<o.length;p++)if(pu(n,o[p]))return!0;return!!ac(n,o)}function ts(n,o,s){return!!pu(n,o)||!!wu(o,n,s)}function eu(n,o){if(n.length===1)return Cu(o,n[0]);for(var s=0;s<o.length;s++)for(var p=o[s],g=0;g<p.length;g++)if(pu(n,p[g]))return!0;for(var y=0;y<n.length;y++)if(Cu(o,n[y]))return!0;for(var E=0;E<o.length;E++)if(ac(n,o[E]))return!0;return!1}function Is(n,o,s){if(n.length>1){if(ac(n,o))return!0;for(var p=0;p<o.length;p++)if(wu(o[p],n,s))return!0}for(var g=0;g<n.length;g++)if(wu(n[g],o,s))return!0;return!1}function ac(n,o){if(n.length===0||o.length===0)return!1;for(var s=0;s<n.length-1;s++)for(var p=n[s],g=n[s+1],y=0;y<o.length-1;y++)if(hl(p,g,o[y],o[y+1]))return!0;return!1}function hl(n,o,s,p){return Jt(n,s,p)!==Jt(o,s,p)&&Jt(n,o,s)!==Jt(n,o,p)}function wu(n,o,s){var p=s*s;if(o.length===1)return n.distSqr(o[0])<p;for(var g=1;g<o.length;g++)if(fl(n,o[g-1],o[g])<p)return!0;return!1}function fl(n,o,s){var p=o.distSqr(s);if(p===0)return n.distSqr(o);var g=((n.x-o.x)*(s.x-o.x)+(n.y-o.y)*(s.y-o.y))/p;return n.distSqr(g<0?o:g>1?s:s.sub(o)._mult(g)._add(o))}function Cu(n,o){for(var s,p,g,y=!1,E=0;E<n.length;E++)for(var w=0,M=(s=n[E]).length-1;w<s.length;M=w++)(p=s[w]).y>o.y!=(g=s[M]).y>o.y&&o.x<(g.x-p.x)*(o.y-p.y)/(g.y-p.y)+p.x&&(y=!y);return y}function pu(n,o){for(var s=!1,p=0,g=n.length-1;p<n.length;g=p++){var y=n[p],E=n[g];y.y>o.y!=E.y>o.y&&o.x<(E.x-y.x)*(o.y-y.y)/(E.y-y.y)+y.x&&(s=!s)}return s}function pl(n,o,s){var p=s[0],g=s[2];if(n.x<p.x&&o.x<p.x||n.x>g.x&&o.x>g.x||n.y<p.y&&o.y<p.y||n.y>g.y&&o.y>g.y)return!1;var y=Jt(n,o,s[0]);return y!==Jt(n,o,s[1])||y!==Jt(n,o,s[2])||y!==Jt(n,o,s[3])}function Va(n,o,s){var p=o.paint.get(n).value;return p.kind==="constant"?p.value:s.programConfigurations.get(o.id).getMaxValue(n)}function Uo(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function ps(n,o,s,p,g){if(!o[0]&&!o[1])return n;var y=Oe.convert(o)._mult(g);s==="viewport"&&y._rotate(-p);for(var E=[],w=0;w<n.length;w++)E.push(n[w].sub(y));return E}za.prototype.populate=function(n,o,s){var p=this.layers[0],g=[],y=null;p.type==="circle"&&(y=p.layout.get("circle-sort-key"));for(var E=0,w=n;E<w.length;E+=1){var M=w[E],L=M.feature,k=M.id,Z=M.index,q=M.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,ye=Ao(L,te);if(this.layers[0]._featureFilter.filter(new $n(this.zoom),ye,s)){var Te=y?y.evaluate(ye,{},s):void 0,Ge={id:k,properties:L.properties,type:L.type,sourceLayerIndex:q,index:Z,geometry:te?ye.geometry:To(L),patterns:{},sortKey:Te};g.push(Ge)}}y&&g.sort(function(Nr,yn){return Nr.sortKey-yn.sortKey});for(var Le=0,nt=g;Le<nt.length;Le+=1){var ft=nt[Le],Pt=ft.geometry,Ut=ft.index,er=ft.sourceLayerIndex,Ar=n[Ut].feature;this.addFeature(ft,Pt,Ut,s),o.featureIndex.insert(Ar,Pt,Ut,er,this.index)}},za.prototype.update=function(n,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,s)},za.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},za.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},za.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ne),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},za.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},za.prototype.addFeature=function(n,o,s,p){for(var g=0,y=o;g<y.length;g+=1)for(var E=0,w=y[g];E<w.length;E+=1){var M=w[E],L=M.x,k=M.y;if(!(L<0||L>=8192||k<0||k>=8192)){var Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),q=Z.vertexLength;Ya(this.layoutVertexArray,L,k,-1,-1),Ya(this.layoutVertexArray,L,k,1,-1),Ya(this.layoutVertexArray,L,k,1,1),Ya(this.layoutVertexArray,L,k,-1,1),this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+3,q+2),Z.vertexLength+=4,Z.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,{},p)},Hr("CircleBucket",za,{omit:["layers"]});var Ms=new xo({"circle-sort-key":new ln(Q.layout_circle["circle-sort-key"])}),du={paint:new xo({"circle-radius":new ln(Q.paint_circle["circle-radius"]),"circle-color":new ln(Q.paint_circle["circle-color"]),"circle-blur":new ln(Q.paint_circle["circle-blur"]),"circle-opacity":new ln(Q.paint_circle["circle-opacity"]),"circle-translate":new bn(Q.paint_circle["circle-translate"]),"circle-translate-anchor":new bn(Q.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bn(Q.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bn(Q.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ln(Q.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ln(Q.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ln(Q.paint_circle["circle-stroke-opacity"])}),layout:Ms},pi=typeof Float32Array!="undefined"?Float32Array:Array;function Ca(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Yo(n,o,s){var p=o[0],g=o[1],y=o[2],E=o[3],w=o[4],M=o[5],L=o[6],k=o[7],Z=o[8],q=o[9],te=o[10],ye=o[11],Te=o[12],Ge=o[13],Le=o[14],nt=o[15],ft=s[0],Pt=s[1],Ut=s[2],er=s[3];return n[0]=ft*p+Pt*w+Ut*Z+er*Te,n[1]=ft*g+Pt*M+Ut*q+er*Ge,n[2]=ft*y+Pt*L+Ut*te+er*Le,n[3]=ft*E+Pt*k+Ut*ye+er*nt,n[4]=(ft=s[4])*p+(Pt=s[5])*w+(Ut=s[6])*Z+(er=s[7])*Te,n[5]=ft*g+Pt*M+Ut*q+er*Ge,n[6]=ft*y+Pt*L+Ut*te+er*Le,n[7]=ft*E+Pt*k+Ut*ye+er*nt,n[8]=(ft=s[8])*p+(Pt=s[9])*w+(Ut=s[10])*Z+(er=s[11])*Te,n[9]=ft*g+Pt*M+Ut*q+er*Ge,n[10]=ft*y+Pt*L+Ut*te+er*Le,n[11]=ft*E+Pt*k+Ut*ye+er*nt,n[12]=(ft=s[12])*p+(Pt=s[13])*w+(Ut=s[14])*Z+(er=s[15])*Te,n[13]=ft*g+Pt*M+Ut*q+er*Ge,n[14]=ft*y+Pt*L+Ut*te+er*Le,n[15]=ft*E+Pt*k+Ut*ye+er*nt,n}Math.hypot||(Math.hypot=function(){for(var n=arguments,o=0,s=arguments.length;s--;)o+=n[s]*n[s];return Math.sqrt(o)});var Ru,Ol=Yo;function Xu(n,o,s){var p=o[0],g=o[1],y=o[2],E=o[3];return n[0]=s[0]*p+s[4]*g+s[8]*y+s[12]*E,n[1]=s[1]*p+s[5]*g+s[9]*y+s[13]*E,n[2]=s[2]*p+s[6]*g+s[10]*y+s[14]*E,n[3]=s[3]*p+s[7]*g+s[11]*y+s[15]*E,n}Ru=new pi(3),pi!=Float32Array&&(Ru[0]=0,Ru[1]=0,Ru[2]=0),function(){var n=new pi(4);pi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0)}();var Bc=(function(){var n=new pi(2);pi!=Float32Array&&(n[0]=0,n[1]=0)}(),function(n){function o(s){n.call(this,s,du)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(s){return new za(s)},o.prototype.queryRadius=function(s){var p=s;return Va("circle-radius",this,p)+Va("circle-stroke-width",this,p)+Uo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(s,p,g,y,E,w,M,L){for(var k=ps(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,M),Z=this.paint.get("circle-radius").evaluate(p,g)+this.paint.get("circle-stroke-width").evaluate(p,g),q=this.paint.get("circle-pitch-alignment")==="map",te=q?k:function(Ar,Nr){return Ar.map(function(yn){return Wu(yn,Nr)})}(k,L),ye=q?Z*M:Z,Te=0,Ge=y;Te<Ge.length;Te+=1)for(var Le=0,nt=Ge[Te];Le<nt.length;Le+=1){var ft=nt[Le],Pt=q?ft:Wu(ft,L),Ut=ye,er=Xu([],[ft.x,ft.y,0,1],L);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ut*=er[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ut*=w.cameraToCenterDistance/er[3]),ts(te,Pt,Ut))return!0}return!1},o}(Zs));function Wu(n,o){var s=Xu([],[n.x,n.y,0,1],o);return new Oe(s[0]/s[3],s[1]/s[3])}var dl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(za);function tu(n,o,s,p){var g=o.width,y=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==g*y*s)throw new RangeError("mismatched image size")}else p=new Uint8Array(g*y*s);return n.width=g,n.height=y,n.data=p,n}function ru(n,o,s){var p=o.width,g=o.height;if(p!==n.width||g!==n.height){var y=tu({},{width:p,height:g},s);ap(n,y,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,p),height:Math.min(n.height,g)},s),n.width=p,n.height=g,n.data=y.data}}function ap(n,o,s,p,g,y){if(g.width===0||g.height===0)return o;if(g.width>n.width||g.height>n.height||s.x>n.width-g.width||s.y>n.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>o.width||g.height>o.height||p.x>o.width-g.width||p.y>o.height-g.height)throw new RangeError("out of range destination coordinates for image copy");for(var E=n.data,w=o.data,M=0;M<g.height;M++)for(var L=((s.y+M)*n.width+s.x)*y,k=((p.y+M)*o.width+p.x)*y,Z=0;Z<g.width*y;Z++)w[k+Z]=E[L+Z];return o}Hr("HeatmapBucket",dl,{omit:["layers"]});var Pl=function(n,o){tu(this,n,1,o)};Pl.prototype.resize=function(n){ru(this,n,1)},Pl.prototype.clone=function(){return new Pl({width:this.width,height:this.height},new Uint8Array(this.data))},Pl.copy=function(n,o,s,p,g){ap(n,o,s,p,g,1)};var rs=function(n,o){tu(this,n,4,o)};rs.prototype.resize=function(n){ru(this,n,4)},rs.prototype.replace=function(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n},rs.prototype.clone=function(){return new rs({width:this.width,height:this.height},new Uint8Array(this.data))},rs.copy=function(n,o,s,p,g){ap(n,o,s,p,g,4)},Hr("AlphaImage",Pl),Hr("RGBAImage",rs);var Tf={paint:new xo({"heatmap-radius":new ln(Q.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ln(Q.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bn(Q.paint_heatmap["heatmap-intensity"]),"heatmap-color":new uu(Q.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bn(Q.paint_heatmap["heatmap-opacity"])})};function Af(n){var o={},s=n.resolution||256,p=n.clips?n.clips.length:1,g=n.image||new rs({width:s,height:p}),y=function(ye,Te,Ge){o[n.evaluationKey]=Ge;var Le=n.expression.evaluate(o);g.data[ye+Te+0]=Math.floor(255*Le.r/Le.a),g.data[ye+Te+1]=Math.floor(255*Le.g/Le.a),g.data[ye+Te+2]=Math.floor(255*Le.b/Le.a),g.data[ye+Te+3]=Math.floor(255*Le.a)};if(n.clips)for(var E=0,w=0;E<p;++E,w+=4*s)for(var M=0,L=0;M<s;M++,L+=4){var k=M/(s-1),Z=n.clips[E];y(w,L,Z.start*(1-k)+Z.end*k)}else for(var q=0,te=0;q<s;q++,te+=4)y(0,te,q/(s-1));return g}var vh=function(n){function o(s){n.call(this,s,Tf),this._updateColorRamp()}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(s){return new dl(s)},o.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Af({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Zs),qd={paint:new xo({"hillshade-illumination-direction":new bn(Q.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bn(Q.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bn(Q.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bn(Q.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bn(Q.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bn(Q.paint_hillshade["hillshade-accent-color"])})},Kd=function(n){function o(s){n.call(this,s,qd)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Zs),Yp=ma([{name:"a_pos",components:2,type:"Int16"}],4).members,gh=Hh,qp=Hh;function Hh(n,o,s){s=s||2;var p,g,y,E,w,M,L,k=o&&o.length,Z=k?o[0]*s:n.length,q=Kp(n,0,Z,s,!0),te=[];if(!q||q.next===q.prev)return te;if(k&&(q=function(Te,Ge,Le,nt){var ft,Pt,Ut,er=[];for(ft=0,Pt=Ge.length;ft<Pt;ft++)(Ut=Kp(Te,Ge[ft]*nt,ft<Pt-1?Ge[ft+1]*nt:Te.length,nt,!1))===Ut.next&&(Ut.steiner=!0),er.push(Cf(Ut));for(er.sort(Jd),ft=0;ft<er.length;ft++)Nc(er[ft],Le),Le=sc(Le,Le.next);return Le}(n,o,q,s)),n.length>80*s){p=y=n[0],g=E=n[1];for(var ye=s;ye<Z;ye+=s)(w=n[ye])<p&&(p=w),(M=n[ye+1])<g&&(g=M),w>y&&(y=w),M>E&&(E=M);L=(L=Math.max(y-p,E-g))!==0?1/L:0}return Fc(q,te,s,p,g,L),te}function Kp(n,o,s,p,g){var y,E;if(g===Zc(n,o,s,p)>0)for(y=o;y<s;y+=p)E=xh(y,n[y],n[y+1],E);else for(y=s-p;y>=o;y-=p)E=xh(y,n[y],n[y+1],E);return E&&uc(E,E.next)&&(Dl(E),E=E.next),E}function sc(n,o){if(!n)return n;o||(o=n);var s,p=n;do if(s=!1,p.steiner||!uc(p,p.next)&&ko(p.prev,p,p.next)!==0)p=p.next;else{if(Dl(p),(p=o=p.prev)===p.next)break;s=!0}while(s||p!==o);return o}function Fc(n,o,s,p,g,y,E){if(n){!E&&y&&function(k,Z,q,te){var ye=k;do ye.z===null&&(ye.z=_h(ye.x,ye.y,Z,q,te)),ye.prevZ=ye.prev,ye.nextZ=ye.next,ye=ye.next;while(ye!==k);ye.prevZ.nextZ=null,ye.prevZ=null,function(Te){var Ge,Le,nt,ft,Pt,Ut,er,Ar,Nr=1;do{for(Le=Te,Te=null,Pt=null,Ut=0;Le;){for(Ut++,nt=Le,er=0,Ge=0;Ge<Nr&&(er++,nt=nt.nextZ);Ge++);for(Ar=Nr;er>0||Ar>0&&nt;)er!==0&&(Ar===0||!nt||Le.z<=nt.z)?(ft=Le,Le=Le.nextZ,er--):(ft=nt,nt=nt.nextZ,Ar--),Pt?Pt.nextZ=ft:Te=ft,ft.prevZ=Pt,Pt=ft;Le=nt}Pt.nextZ=null,Nr*=2}while(Ut>1)}(ye)}(n,p,g,y);for(var w,M,L=n;n.prev!==n.next;)if(w=n.prev,M=n.next,y?Qd(n,p,g,y):$d(n))o.push(w.i/s),o.push(n.i/s),o.push(M.i/s),Dl(n),n=M.next,L=M.next;else if((n=M)===L){E?E===1?Fc(n=Sf(sc(n),o,s),o,s,p,g,y,2):E===2&&sp(n,o,s,p,g,y):Fc(sc(n),o,s,p,g,y,1);break}}}function $d(n){var o=n.prev,s=n,p=n.next;if(ko(o,s,p)>=0)return!1;for(var g=n.next.next;g!==n.prev;){if(Ll(o.x,o.y,s.x,s.y,p.x,p.y,g.x,g.y)&&ko(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Qd(n,o,s,p){var g=n.prev,y=n,E=n.next;if(ko(g,y,E)>=0)return!1;for(var w=g.x>y.x?g.x>E.x?g.x:E.x:y.x>E.x?y.x:E.x,M=g.y>y.y?g.y>E.y?g.y:E.y:y.y>E.y?y.y:E.y,L=_h(g.x<y.x?g.x<E.x?g.x:E.x:y.x<E.x?y.x:E.x,g.y<y.y?g.y<E.y?g.y:E.y:y.y<E.y?y.y:E.y,o,s,p),k=_h(w,M,o,s,p),Z=n.prevZ,q=n.nextZ;Z&&Z.z>=L&&q&&q.z<=k;){if(Z!==n.prev&&Z!==n.next&&Ll(g.x,g.y,y.x,y.y,E.x,E.y,Z.x,Z.y)&&ko(Z.prev,Z,Z.next)>=0||(Z=Z.prevZ,q!==n.prev&&q!==n.next&&Ll(g.x,g.y,y.x,y.y,E.x,E.y,q.x,q.y)&&ko(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;Z&&Z.z>=L;){if(Z!==n.prev&&Z!==n.next&&Ll(g.x,g.y,y.x,y.y,E.x,E.y,Z.x,Z.y)&&ko(Z.prev,Z,Z.next)>=0)return!1;Z=Z.prevZ}for(;q&&q.z<=k;){if(q!==n.prev&&q!==n.next&&Ll(g.x,g.y,y.x,y.y,E.x,E.y,q.x,q.y)&&ko(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function Sf(n,o,s){var p=n;do{var g=p.prev,y=p.next.next;!uc(g,y)&&Uc(g,p,p.next,y)&&lc(g,y)&&lc(y,g)&&(o.push(g.i/s),o.push(p.i/s),o.push(y.i/s),Dl(p),Dl(p.next),p=n=y),p=p.next}while(p!==n);return sc(p)}function sp(n,o,s,p,g,y){var E=n;do{for(var w=E.next.next;w!==E.prev;){if(E.i!==w.i&&Rf(E,w)){var M=yh(E,w);return E=sc(E,E.next),M=sc(M,M.next),Fc(E,o,s,p,g,y),void Fc(M,o,s,p,g,y)}w=w.next}E=E.next}while(E!==n)}function Jd(n,o){return n.x-o.x}function Nc(n,o){if(o=function(p,g){var y,E=g,w=p.x,M=p.y,L=-1/0;do{if(M<=E.y&&M>=E.next.y&&E.next.y!==E.y){var k=E.x+(M-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(k<=w&&k>L){if(L=k,k===w){if(M===E.y)return E;if(M===E.next.y)return E.next}y=E.x<E.next.x?E:E.next}}E=E.next}while(E!==g);if(!y)return null;if(w===L)return y;var Z,q=y,te=y.x,ye=y.y,Te=1/0;E=y;do w>=E.x&&E.x>=te&&w!==E.x&&Ll(M<ye?w:L,M,te,ye,M<ye?L:w,M,E.x,E.y)&&(Z=Math.abs(M-E.y)/(w-E.x),lc(E,p)&&(Z<Te||Z===Te&&(E.x>y.x||E.x===y.x&&wf(y,E)))&&(y=E,Te=Z)),E=E.next;while(E!==q);return y}(n,o)){var s=yh(o,n);sc(o,o.next),sc(s,s.next)}}function wf(n,o){return ko(n.prev,n,o.prev)<0&&ko(o.next,n,n.next)<0}function _h(n,o,s,p,g){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-s)*g)|n<<8))|n<<4))|n<<2))|n<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*g)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Cf(n){var o=n,s=n;do(o.x<s.x||o.x===s.x&&o.y<s.y)&&(s=o),o=o.next;while(o!==n);return s}function Ll(n,o,s,p,g,y,E,w){return(g-E)*(o-w)-(n-E)*(y-w)>=0&&(n-E)*(p-w)-(s-E)*(o-w)>=0&&(s-E)*(y-w)-(g-E)*(p-w)>=0}function Rf(n,o){return n.next.i!==o.i&&n.prev.i!==o.i&&!function(s,p){var g=s;do{if(g.i!==s.i&&g.next.i!==s.i&&g.i!==p.i&&g.next.i!==p.i&&Uc(g,g.next,s,p))return!0;g=g.next}while(g!==s);return!1}(n,o)&&(lc(n,o)&&lc(o,n)&&function(s,p){var g=s,y=!1,E=(s.x+p.x)/2,w=(s.y+p.y)/2;do g.y>w!=g.next.y>w&&g.next.y!==g.y&&E<(g.next.x-g.x)*(w-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==s);return y}(n,o)&&(ko(n.prev,n,o.prev)||ko(n,o.prev,o))||uc(n,o)&&ko(n.prev,n,n.next)>0&&ko(o.prev,o,o.next)>0)}function ko(n,o,s){return(o.y-n.y)*(s.x-o.x)-(o.x-n.x)*(s.y-o.y)}function uc(n,o){return n.x===o.x&&n.y===o.y}function Uc(n,o,s,p){var g=zc(ko(n,o,s)),y=zc(ko(n,o,p)),E=zc(ko(s,p,n)),w=zc(ko(s,p,o));return g!==y&&E!==w||!(g!==0||!kc(n,s,o))||!(y!==0||!kc(n,p,o))||!(E!==0||!kc(s,n,p))||!(w!==0||!kc(s,o,p))}function kc(n,o,s){return o.x<=Math.max(n.x,s.x)&&o.x>=Math.min(n.x,s.x)&&o.y<=Math.max(n.y,s.y)&&o.y>=Math.min(n.y,s.y)}function zc(n){return n>0?1:n<0?-1:0}function lc(n,o){return ko(n.prev,n,n.next)<0?ko(n,o,n.next)>=0&&ko(n,n.prev,o)>=0:ko(n,o,n.prev)<0||ko(n,n.next,o)<0}function yh(n,o){var s=new Vc(n.i,n.x,n.y),p=new Vc(o.i,o.x,o.y),g=n.next,y=o.prev;return n.next=o,o.prev=n,s.next=g,g.prev=s,p.next=s,s.prev=p,y.next=p,p.prev=y,p}function xh(n,o,s,p){var g=new Vc(n,o,s);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function Dl(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Vc(n,o,s){this.i=n,this.x=o,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zc(n,o,s,p){for(var g=0,y=o,E=s-p;y<s;y+=p)g+=(n[E]-n[y])*(n[y+1]+n[E+1]),E=y;return g}function $p(n,o,s,p,g){(function y(E,w,M,L,k){for(;L>M;){if(L-M>600){var Z=L-M+1,q=w-M+1,te=Math.log(Z),ye=.5*Math.exp(2*te/3),Te=.5*Math.sqrt(te*ye*(Z-ye)/Z)*(q-Z/2<0?-1:1);y(E,w,Math.max(M,Math.floor(w-q*ye/Z+Te)),Math.min(L,Math.floor(w+(Z-q)*ye/Z+Te)),k)}var Ge=E[w],Le=M,nt=L;for(Bl(E,M,w),k(E[L],Ge)>0&&Bl(E,M,L);Le<nt;){for(Bl(E,Le,nt),Le++,nt--;k(E[Le],Ge)<0;)Le++;for(;k(E[nt],Ge)>0;)nt--}k(E[M],Ge)===0?Bl(E,M,nt):Bl(E,++nt,L),nt<=w&&(M=nt+1),w<=nt&&(L=nt-1)}})(n,o,s||0,p||n.length-1,g||jc)}function Bl(n,o,s){var p=n[o];n[o]=n[s],n[s]=p}function jc(n,o){return n<o?-1:n>o?1:0}function If(n,o){var s=n.length;if(s<=1)return[n];for(var p,g,y=[],E=0;E<s;E++){var w=wr(n[E]);w!==0&&(n[E].area=Math.abs(w),g===void 0&&(g=w<0),g===w<0?(p&&y.push(p),p=[n[E]]):p.push(n[E]))}if(p&&y.push(p),o>1)for(var M=0;M<y.length;M++)y[M].length<=o||($p(y[M],o,1,y[M].length-1,up),y[M]=y[M].slice(0,o));return y}function up(n,o){return o.area-n.area}function Mf(n,o,s){for(var p=s.patternDependencies,g=!1,y=0,E=o;y<E.length;y+=1){var w=E[y].paint.get(n+"-pattern");w.isConstant()||(g=!0);var M=w.constantOr(null);M&&(g=!0,p[M.to]=!0,p[M.from]=!0)}return g}function lp(n,o,s,p,g){for(var y=g.patternDependencies,E=0,w=o;E<w.length;E+=1){var M=w[E],L=M.paint.get(n+"-pattern").value;if(L.kind!=="constant"){var k=L.evaluate({zoom:p-1},s,{},g.availableImages),Z=L.evaluate({zoom:p},s,{},g.availableImages),q=L.evaluate({zoom:p+1},s,{},g.availableImages);Z=Z&&Z.name?Z.name:Z,q=q&&q.name?q.name:q,y[k=k&&k.name?k.name:k]=!0,y[Z]=!0,y[q]=!0,s.patterns[M.id]={min:k,mid:Z,max:q}}}return s}Hh.deviation=function(n,o,s,p){var g=o&&o.length,y=Math.abs(Zc(n,0,g?o[0]*s:n.length,s));if(g)for(var E=0,w=o.length;E<w;E++)y-=Math.abs(Zc(n,o[E]*s,E<w-1?o[E+1]*s:n.length,s));var M=0;for(E=0;E<p.length;E+=3){var L=p[E]*s,k=p[E+1]*s,Z=p[E+2]*s;M+=Math.abs((n[L]-n[Z])*(n[k+1]-n[L+1])-(n[L]-n[k])*(n[Z+1]-n[L+1]))}return y===0&&M===0?0:Math.abs((M-y)/y)},Hh.flatten=function(n){for(var o=n[0][0].length,s={vertices:[],holes:[],dimensions:o},p=0,g=0;g<n.length;g++){for(var y=0;y<n[g].length;y++)for(var E=0;E<o;E++)s.vertices.push(n[g][y][E]);g>0&&s.holes.push(p+=n[g-1].length)}return s},gh.default=qp;var Gu=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ul,this.indexArray=new hu,this.indexArray2=new Ml,this.programConfigurations=new Pn(n.layers,n.zoom),this.segments=new oe,this.segments2=new oe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Gu.prototype.populate=function(n,o,s){this.hasPattern=Mf("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),g=[],y=0,E=n;y<E.length;y+=1){var w=E[y],M=w.feature,L=w.id,k=w.index,Z=w.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,te=Ao(M,q);if(this.layers[0]._featureFilter.filter(new $n(this.zoom),te,s)){var ye=p?p.evaluate(te,{},s,o.availableImages):void 0,Te={id:L,properties:M.properties,type:M.type,sourceLayerIndex:Z,index:k,geometry:q?te.geometry:To(M),patterns:{},sortKey:ye};g.push(Te)}}p&&g.sort(function(Ar,Nr){return Ar.sortKey-Nr.sortKey});for(var Ge=0,Le=g;Ge<Le.length;Ge+=1){var nt=Le[Ge],ft=nt.geometry,Pt=nt.index,Ut=nt.sourceLayerIndex;if(this.hasPattern){var er=lp("fill",this.layers,nt,this.zoom,o);this.patternFeatures.push(er)}else this.addFeature(nt,ft,Pt,s,{});o.featureIndex.insert(n[Pt].feature,ft,Pt,Ut,this.index)}},Gu.prototype.update=function(n,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,s)},Gu.prototype.addFeatures=function(n,o,s){for(var p=0,g=this.patternFeatures;p<g.length;p+=1){var y=g[p];this.addFeature(y,y.geometry,y.index,o,s)}},Gu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Gu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Gu.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Yp),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0},Gu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Gu.prototype.addFeature=function(n,o,s,p,g){for(var y=0,E=If(o,500);y<E.length;y+=1){for(var w=E[y],M=0,L=0,k=w;L<k.length;L+=1)M+=k[L].length;for(var Z=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),q=Z.vertexLength,te=[],ye=[],Te=0,Ge=w;Te<Ge.length;Te+=1){var Le=Ge[Te];if(Le.length!==0){Le!==w[0]&&ye.push(te.length/2);var nt=this.segments2.prepareSegment(Le.length,this.layoutVertexArray,this.indexArray2),ft=nt.vertexLength;this.layoutVertexArray.emplaceBack(Le[0].x,Le[0].y),this.indexArray2.emplaceBack(ft+Le.length-1,ft),te.push(Le[0].x),te.push(Le[0].y);for(var Pt=1;Pt<Le.length;Pt++)this.layoutVertexArray.emplaceBack(Le[Pt].x,Le[Pt].y),this.indexArray2.emplaceBack(ft+Pt-1,ft+Pt),te.push(Le[Pt].x),te.push(Le[Pt].y);nt.vertexLength+=Le.length,nt.primitiveLength+=Le.length}}for(var Ut=gh(te,ye),er=0;er<Ut.length;er+=3)this.indexArray.emplaceBack(q+Ut[er],q+Ut[er+1],q+Ut[er+2]);Z.vertexLength+=M,Z.primitiveLength+=Ut.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,g,p)},Hr("FillBucket",Gu,{omit:["layers","patternFeatures"]});var Fl=new xo({"fill-sort-key":new ln(Q.layout_fill["fill-sort-key"])}),cp={paint:new xo({"fill-antialias":new bn(Q.paint_fill["fill-antialias"]),"fill-opacity":new ln(Q.paint_fill["fill-opacity"]),"fill-color":new ln(Q.paint_fill["fill-color"]),"fill-outline-color":new ln(Q.paint_fill["fill-outline-color"]),"fill-translate":new bn(Q.paint_fill["fill-translate"]),"fill-translate-anchor":new bn(Q.paint_fill["fill-translate-anchor"]),"fill-pattern":new fs(Q.paint_fill["fill-pattern"])}),layout:Fl},hp=function(n){function o(s){n.call(this,s,cp)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.recalculate=function(s,p){n.prototype.recalculate.call(this,s,p);var g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(s){return new Gu(s)},o.prototype.queryRadius=function(){return Uo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(s,p,g,y,E,w,M){return eu(ps(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,M),y)},o.prototype.isTileClipped=function(){return!0},o}(Zs),fp=ma([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Qp=Hc;function Hc(n,o,s,p,g){this.properties={},this.extent=s,this.type=0,this._pbf=n,this._geometry=-1,this._keys=p,this._values=g,n.readFields(em,this,o)}function em(n,o,s){n==1?o.id=s.readVarint():n==2?function(p,g){for(var y=p.readVarint()+p.pos;p.pos<y;){var E=g._keys[p.readVarint()],w=g._values[p.readVarint()];g.properties[E]=w}}(s,o):n==3?o.type=s.readVarint():n==4&&(o._geometry=s.pos)}function ml(n){for(var o,s,p=0,g=0,y=n.length,E=y-1;g<y;E=g++)p+=((s=n[E]).x-(o=n[g]).x)*(o.y+s.y);return p}Hc.types=["Unknown","Point","LineString","Polygon"],Hc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var o,s=n.readVarint()+n.pos,p=1,g=0,y=0,E=0,w=[];n.pos<s;){if(g<=0){var M=n.readVarint();p=7&M,g=M>>3}if(g--,p===1||p===2)y+=n.readSVarint(),E+=n.readSVarint(),p===1&&(o&&w.push(o),o=[]),o.push(new Oe(y,E));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&w.push(o),w},Hc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var o=n.readVarint()+n.pos,s=1,p=0,g=0,y=0,E=1/0,w=-1/0,M=1/0,L=-1/0;n.pos<o;){if(p<=0){var k=n.readVarint();s=7&k,p=k>>3}if(p--,s===1||s===2)(g+=n.readSVarint())<E&&(E=g),g>w&&(w=g),(y+=n.readSVarint())<M&&(M=y),y>L&&(L=y);else if(s!==7)throw new Error("unknown command "+s)}return[E,M,w,L]},Hc.prototype.toGeoJSON=function(n,o,s){var p,g,y=this.extent*Math.pow(2,s),E=this.extent*n,w=this.extent*o,M=this.loadGeometry(),L=Hc.types[this.type];function k(te){for(var ye=0;ye<te.length;ye++){var Te=te[ye];te[ye]=[360*(Te.x+E)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(Te.y+w)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var Z=[];for(p=0;p<M.length;p++)Z[p]=M[p][0];k(M=Z);break;case 2:for(p=0;p<M.length;p++)k(M[p]);break;case 3:for(M=function(te){var ye=te.length;if(ye<=1)return[te];for(var Te,Ge,Le=[],nt=0;nt<ye;nt++){var ft=ml(te[nt]);ft!==0&&(Ge===void 0&&(Ge=ft<0),Ge===ft<0?(Te&&Le.push(Te),Te=[te[nt]]):Te.push(te[nt]))}return Te&&Le.push(Te),Le}(M),p=0;p<M.length;p++)for(g=0;g<M[p].length;g++)k(M[p][g])}M.length===1?M=M[0]:L="Multi"+L;var q={type:"Feature",geometry:{type:L,coordinates:M},properties:this.properties};return"id"in this&&(q.id=this.id),q};var Of=Xc;function Xc(n,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(cc,this,o),this.length=this._features.length}function cc(n,o,s){n===15?o.version=s.readVarint():n===1?o.name=s.readString():n===5?o.extent=s.readVarint():n===2?o._features.push(s.pos):n===3?o._keys.push(s.readString()):n===4&&o._values.push(function(p){for(var g=null,y=p.readVarint()+p.pos;p.pos<y;){var E=p.readVarint()>>3;g=E===1?p.readString():E===2?p.readFloat():E===3?p.readDouble():E===4?p.readVarint64():E===5?p.readVarint():E===6?p.readSVarint():E===7?p.readBoolean():null}return g}(s))}function pp(n,o,s){if(n===3){var p=new Of(s,s.readVarint()+s.pos);p.length&&(o[p.name]=p)}}Xc.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var o=this._pbf.readVarint()+this._pbf.pos;return new Qp(this._pbf,o,this.extent,this._keys,this._values)};var Nl={VectorTile:function(n,o){this.layers=n.readFields(pp,{},o)},VectorTileFeature:Qp,VectorTileLayer:Of},Xh=Nl.VectorTileFeature.types,Pf=Math.pow(2,13);function ds(n,o,s,p,g,y,E,w){n.emplaceBack(o,s,2*Math.floor(p*Pf)+E,g*Pf*2,y*Pf*2,Math.round(w))}var ns=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Hu,this.indexArray=new hu,this.programConfigurations=new Pn(n.layers,n.zoom),this.segments=new oe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function _a(n,o){return n.x===o.x&&(n.x<0||n.x>8192)||n.y===o.y&&(n.y<0||n.y>8192)}ns.prototype.populate=function(n,o,s){this.features=[],this.hasPattern=Mf("fill-extrusion",this.layers,o);for(var p=0,g=n;p<g.length;p+=1){var y=g[p],E=y.feature,w=y.id,M=y.index,L=y.sourceLayerIndex,k=this.layers[0]._featureFilter.needGeometry,Z=Ao(E,k);if(this.layers[0]._featureFilter.filter(new $n(this.zoom),Z,s)){var q={id:w,sourceLayerIndex:L,index:M,geometry:k?Z.geometry:To(E),properties:E.properties,type:E.type,patterns:{}};this.hasPattern?this.features.push(lp("fill-extrusion",this.layers,q,this.zoom,o)):this.addFeature(q,q.geometry,M,s,{}),o.featureIndex.insert(E,q.geometry,M,L,this.index,!0)}}},ns.prototype.addFeatures=function(n,o,s){for(var p=0,g=this.features;p<g.length;p+=1){var y=g[p];this.addFeature(y,y.geometry,y.index,o,s)}},ns.prototype.update=function(n,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,s)},ns.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ns.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,fp),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ns.prototype.addFeature=function(n,o,s,p,g){for(var y=0,E=If(o,500);y<E.length;y+=1){for(var w=E[y],M=0,L=0,k=w;L<k.length;L+=1)M+=k[L].length;for(var Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),q=0,te=w;q<te.length;q+=1){var ye=te[q];if(ye.length!==0&&!((hi=ye).every(function(Bn){return Bn.x<0})||hi.every(function(Bn){return Bn.x>8192})||hi.every(function(Bn){return Bn.y<0})||hi.every(function(Bn){return Bn.y>8192})))for(var Te=0,Ge=0;Ge<ye.length;Ge++){var Le=ye[Ge];if(Ge>=1){var nt=ye[Ge-1];if(!_a(Le,nt)){Z.vertexLength+4>oe.MAX_VERTEX_ARRAY_LENGTH&&(Z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var ft=Le.sub(nt)._perp()._unit(),Pt=nt.dist(Le);Te+Pt>32768&&(Te=0),ds(this.layoutVertexArray,Le.x,Le.y,ft.x,ft.y,0,0,Te),ds(this.layoutVertexArray,Le.x,Le.y,ft.x,ft.y,0,1,Te),ds(this.layoutVertexArray,nt.x,nt.y,ft.x,ft.y,0,0,Te+=Pt),ds(this.layoutVertexArray,nt.x,nt.y,ft.x,ft.y,0,1,Te);var Ut=Z.vertexLength;this.indexArray.emplaceBack(Ut,Ut+2,Ut+1),this.indexArray.emplaceBack(Ut+1,Ut+2,Ut+3),Z.vertexLength+=4,Z.primitiveLength+=2}}}}if(Z.vertexLength+M>oe.MAX_VERTEX_ARRAY_LENGTH&&(Z=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),Xh[n.type]==="Polygon"){for(var er=[],Ar=[],Nr=Z.vertexLength,yn=0,en=w;yn<en.length;yn+=1){var En=en[yn];if(En.length!==0){En!==w[0]&&Ar.push(er.length/2);for(var tn=0;tn<En.length;tn++){var si=En[tn];ds(this.layoutVertexArray,si.x,si.y,0,0,1,1,0),er.push(si.x),er.push(si.y)}}}for(var kn=gh(er,Ar),hn=0;hn<kn.length;hn+=3)this.indexArray.emplaceBack(Nr+kn[hn],Nr+kn[hn+2],Nr+kn[hn+1]);Z.primitiveLength+=kn.length/3,Z.vertexLength+=M}}var hi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,g,p)},Hr("FillExtrusionBucket",ns,{omit:["layers","features"]});var nu={paint:new xo({"fill-extrusion-opacity":new bn(Q["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ln(Q["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bn(Q["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bn(Q["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new fs(Q["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ln(Q["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ln(Q["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bn(Q["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Jp=function(n){function o(s){n.call(this,s,nu)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(s){return new ns(s)},o.prototype.queryRadius=function(){return Uo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(s,p,g,y,E,w,M,L){var k=ps(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,M),Z=this.paint.get("fill-extrusion-height").evaluate(p,g),q=this.paint.get("fill-extrusion-base").evaluate(p,g),te=function(Te,Ge,Le,nt){for(var ft=[],Pt=0,Ut=Te;Pt<Ut.length;Pt+=1){var er=Ut[Pt],Ar=[er.x,er.y,0,1];Xu(Ar,Ar,Ge),ft.push(new Oe(Ar[0]/Ar[3],Ar[1]/Ar[3]))}return ft}(k,L),ye=function(Te,Ge,Le,nt){for(var ft=[],Pt=[],Ut=nt[8]*Ge,er=nt[9]*Ge,Ar=nt[10]*Ge,Nr=nt[11]*Ge,yn=nt[8]*Le,en=nt[9]*Le,En=nt[10]*Le,tn=nt[11]*Le,si=0,kn=Te;si<kn.length;si+=1){for(var hn=[],hi=[],Bn=0,Ci=kn[si];Bn<Ci.length;Bn+=1){var Sn=Ci[Bn],bi=Sn.x,Po=Sn.y,na=nt[0]*bi+nt[4]*Po+nt[12],Ko=nt[1]*bi+nt[5]*Po+nt[13],So=nt[2]*bi+nt[6]*Po+nt[14],$o=nt[3]*bi+nt[7]*Po+nt[15],ia=So+Ar,Ha=$o+Nr,Os=na+yn,qa=Ko+en,ms=So+En,fa=$o+tn,Ka=new Oe((na+Ut)/Ha,(Ko+er)/Ha);Ka.z=ia/Ha,hn.push(Ka);var Ei=new Oe(Os/fa,qa/fa);Ei.z=ms/fa,hi.push(Ei)}ft.push(hn),Pt.push(hi)}return[ft,Pt]}(y,q,Z,L);return function(Te,Ge,Le){var nt=1/0;eu(Le,Ge)&&(nt=ed(Le,Ge[0]));for(var ft=0;ft<Ge.length;ft++)for(var Pt=Ge[ft],Ut=Te[ft],er=0;er<Pt.length-1;er++){var Ar=Pt[er],Nr=[Ar,Pt[er+1],Ut[er+1],Ut[er],Ar];fu(Le,Nr)&&(nt=Math.min(nt,ed(Le,Nr)))}return nt!==1/0&&nt}(ye[0],ye[1],te)},o}(Zs);function Wh(n,o){return n.x*o.x+n.y*o.y}function ed(n,o){if(n.length===1){for(var s,p=0,g=o[p++];!s||g.equals(s);)if(!(s=o[p++]))return 1/0;for(;p<o.length;p++){var y=o[p],E=n[0],w=s.sub(g),M=y.sub(g),L=E.sub(g),k=Wh(w,w),Z=Wh(w,M),q=Wh(M,M),te=Wh(L,w),ye=Wh(L,M),Te=k*q-Z*Z,Ge=(q*te-Z*ye)/Te,Le=(k*ye-Z*te)/Te,nt=g.z*(1-Ge-Le)+s.z*Ge+y.z*Le;if(isFinite(nt))return nt}return 1/0}for(var ft=1/0,Pt=0,Ut=o;Pt<Ut.length;Pt+=1)ft=Math.min(ft,Ut[Pt].z);return ft}var tm=ma([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,td=ma([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,rd=Nl.VectorTileFeature.types,rm=Math.cos(Math.PI/180*37.5),dp=Math.pow(2,14)/.5,is=function(n){var o=this;this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){o.gradients[s.id]={}}),this.layoutVertexArray=new Cs,this.layoutVertexArray2=new ll,this.indexArray=new hu,this.programConfigurations=new Pn(n.layers,n.zoom),this.segments=new oe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};is.prototype.populate=function(n,o,s){this.hasPattern=Mf("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),g=[],y=0,E=n;y<E.length;y+=1){var w=E[y],M=w.feature,L=w.id,k=w.index,Z=w.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,te=Ao(M,q);if(this.layers[0]._featureFilter.filter(new $n(this.zoom),te,s)){var ye=p?p.evaluate(te,{},s):void 0,Te={id:L,properties:M.properties,type:M.type,sourceLayerIndex:Z,index:k,geometry:q?te.geometry:To(M),patterns:{},sortKey:ye};g.push(Te)}}p&&g.sort(function(Ar,Nr){return Ar.sortKey-Nr.sortKey});for(var Ge=0,Le=g;Ge<Le.length;Ge+=1){var nt=Le[Ge],ft=nt.geometry,Pt=nt.index,Ut=nt.sourceLayerIndex;if(this.hasPattern){var er=lp("line",this.layers,nt,this.zoom,o);this.patternFeatures.push(er)}else this.addFeature(nt,ft,Pt,s,{});o.featureIndex.insert(n[Pt].feature,ft,Pt,Ut,this.index)}},is.prototype.update=function(n,o,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,s)},is.prototype.addFeatures=function(n,o,s){for(var p=0,g=this.patternFeatures;p<g.length;p+=1){var y=g[p];this.addFeature(y,y.geometry,y.index,o,s)}},is.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},is.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},is.prototype.upload=function(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,td)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,tm),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},is.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},is.prototype.lineFeatureClips=function(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}},is.prototype.addFeature=function(n,o,s,p,g){var y=this.layers[0].layout,E=y.get("line-join").evaluate(n,{}),w=y.get("line-cap"),M=y.get("line-miter-limit"),L=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(var k=0,Z=o;k<Z.length;k+=1)this.addLine(Z[k],n,E,w,M,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,s,g,p)},is.prototype.addLine=function(n,o,s,p,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var E=0;E<n.length-1;E++)this.totalDistance+=n[E].dist(n[E+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var w=rd[o.type]==="Polygon",M=n.length;M>=2&&n[M-1].equals(n[M-2]);)M--;for(var L=0;L<M-1&&n[L].equals(n[L+1]);)L++;if(!(M<(w?3:2))){s==="bevel"&&(g=1.05);var k,Z=this.overscaling<=16?122880/(512*this.overscaling):0,q=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray),te=void 0,ye=void 0,Te=void 0,Ge=void 0;this.e1=this.e2=-1,w&&(Ge=n[L].sub(k=n[M-2])._unit()._perp());for(var Le=L;Le<M;Le++)if(!(ye=Le===M-1?w?n[L+1]:void 0:n[Le+1])||!n[Le].equals(ye)){Ge&&(Te=Ge),k&&(te=k),k=n[Le],Ge=ye?ye.sub(k)._unit()._perp():Te;var nt=(Te=Te||Ge).add(Ge);nt.x===0&&nt.y===0||nt._unit();var ft=Te.x*Ge.x+Te.y*Ge.y,Pt=nt.x*Ge.x+nt.y*Ge.y,Ut=Pt!==0?1/Pt:1/0,er=2*Math.sqrt(2-2*Pt),Ar=Pt<rm&&te&&ye,Nr=Te.x*Ge.y-Te.y*Ge.x>0;if(Ar&&Le>L){var yn=k.dist(te);if(yn>2*Z){var en=k.sub(k.sub(te)._mult(Z/yn)._round());this.updateDistance(te,en),this.addCurrentVertex(en,Te,0,0,q),te=en}}var En=te&&ye,tn=En?s:w?"butt":p;if(En&&tn==="round"&&(Ut<y?tn="miter":Ut<=2&&(tn="fakeround")),tn==="miter"&&Ut>g&&(tn="bevel"),tn==="bevel"&&(Ut>2&&(tn="flipbevel"),Ut<g&&(tn="miter")),te&&this.updateDistance(te,k),tn==="miter")nt._mult(Ut),this.addCurrentVertex(k,nt,0,0,q);else if(tn==="flipbevel"){if(Ut>100)nt=Ge.mult(-1);else{var si=Ut*Te.add(Ge).mag()/Te.sub(Ge).mag();nt._perp()._mult(si*(Nr?-1:1))}this.addCurrentVertex(k,nt,0,0,q),this.addCurrentVertex(k,nt.mult(-1),0,0,q)}else if(tn==="bevel"||tn==="fakeround"){var kn=-Math.sqrt(Ut*Ut-1),hn=Nr?kn:0,hi=Nr?0:kn;if(te&&this.addCurrentVertex(k,Te,hn,hi,q),tn==="fakeround")for(var Bn=Math.round(180*er/Math.PI/20),Ci=1;Ci<Bn;Ci++){var Sn=Ci/Bn;if(Sn!==.5){var bi=Sn-.5;Sn+=Sn*bi*(Sn-1)*((1.0904+ft*(ft*(3.55645-1.43519*ft)-3.2452))*bi*bi+(.848013+ft*(.215638*ft-1.06021)))}var Po=Ge.sub(Te)._mult(Sn)._add(Te)._unit()._mult(Nr?-1:1);this.addHalfVertex(k,Po.x,Po.y,!1,Nr,0,q)}ye&&this.addCurrentVertex(k,Ge,-hn,-hi,q)}else if(tn==="butt")this.addCurrentVertex(k,nt,0,0,q);else if(tn==="square"){var na=te?1:-1;this.addCurrentVertex(k,nt,na,na,q)}else tn==="round"&&(te&&(this.addCurrentVertex(k,Te,0,0,q),this.addCurrentVertex(k,Te,1,1,q,!0)),ye&&(this.addCurrentVertex(k,Ge,-1,-1,q,!0),this.addCurrentVertex(k,Ge,0,0,q)));if(Ar&&Le<M-1){var Ko=k.dist(ye);if(Ko>2*Z){var So=k.add(ye.sub(k)._mult(Z/Ko)._round());this.updateDistance(k,So),this.addCurrentVertex(So,Ge,0,0,q),k=So}}}}},is.prototype.addCurrentVertex=function(n,o,s,p,g,y){y===void 0&&(y=!1);var E=o.y*p-o.x,w=-o.y-o.x*p;this.addHalfVertex(n,o.x+o.y*s,o.y-o.x*s,y,!1,s,g),this.addHalfVertex(n,E,w,y,!0,-p,g),this.distance>dp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,o,s,p,g,y))},is.prototype.addHalfVertex=function(n,o,s,p,g,y,E){var w=.5*(this.lineClips?this.scaledDistance*(dp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n.x<<1)+(p?1:0),(n.y<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(y===0?0:y<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var M=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),E.primitiveLength++),g?this.e2=M:this.e1=M},is.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},is.prototype.updateDistance=function(n,o){this.distance+=n.dist(o),this.updateScaledDistance()},Hr("LineBucket",is,{omit:["layers","patternFeatures"]});var nm=new xo({"line-cap":new bn(Q.layout_line["line-cap"]),"line-join":new ln(Q.layout_line["line-join"]),"line-miter-limit":new bn(Q.layout_line["line-miter-limit"]),"line-round-limit":new bn(Q.layout_line["line-round-limit"]),"line-sort-key":new ln(Q.layout_line["line-sort-key"])}),mp={paint:new xo({"line-opacity":new ln(Q.paint_line["line-opacity"]),"line-color":new ln(Q.paint_line["line-color"]),"line-translate":new bn(Q.paint_line["line-translate"]),"line-translate-anchor":new bn(Q.paint_line["line-translate-anchor"]),"line-width":new ln(Q.paint_line["line-width"]),"line-gap-width":new ln(Q.paint_line["line-gap-width"]),"line-offset":new ln(Q.paint_line["line-offset"]),"line-blur":new ln(Q.paint_line["line-blur"]),"line-dasharray":new Ga(Q.paint_line["line-dasharray"]),"line-pattern":new fs(Q.paint_line["line-pattern"]),"line-gradient":new uu(Q.paint_line["line-gradient"])}),layout:nm},vp=new(function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(s,p){return p=new $n(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),n.prototype.possiblyEvaluate.call(this,s,p)},o.prototype.evaluate=function(s,p,g,y){return p=ir({},p,{zoom:Math.floor(p.zoom)}),n.prototype.evaluate.call(this,s,p,g,y)},o}(ln))(mp.paint.properties["line-width"].specification);vp.useIntegerZoom=!0;var nd=function(n){function o(s){n.call(this,s,mp),this.gradientVersion=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ts,this.gradientVersion=(this.gradientVersion+1)%zt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(s,p){n.prototype.recalculate.call(this,s,p),this.paint._values["line-floorwidth"]=vp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},o.prototype.createBucket=function(s){return new is(s)},o.prototype.queryRadius=function(s){var p=s,g=gp(Va("line-width",this,p),Va("line-gap-width",this,p)),y=Va("line-offset",this,p);return g/2+Math.abs(y)+Uo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(s,p,g,y,E,w,M){var L=ps(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,M),k=M/2*gp(this.paint.get("line-width").evaluate(p,g),this.paint.get("line-gap-width").evaluate(p,g)),Z=this.paint.get("line-offset").evaluate(p,g);return Z&&(y=function(q,te){for(var ye=[],Te=new Oe(0,0),Ge=0;Ge<q.length;Ge++){for(var Le=q[Ge],nt=[],ft=0;ft<Le.length;ft++){var Pt=Le[ft],Ut=Le[ft+1],er=ft===0?Te:Pt.sub(Le[ft-1])._unit()._perp(),Ar=ft===Le.length-1?Te:Ut.sub(Pt)._unit()._perp(),Nr=er._add(Ar)._unit();Nr._mult(1/(Nr.x*Ar.x+Nr.y*Ar.y)),nt.push(Nr._mult(te)._add(Pt))}ye.push(nt)}return ye}(y,Z*M)),function(q,te,ye){for(var Te=0;Te<te.length;Te++){var Ge=te[Te];if(q.length>=3){for(var Le=0;Le<Ge.length;Le++)if(pu(q,Ge[Le]))return!0}if(Is(q,Ge,ye))return!0}return!1}(L,y,k)},o.prototype.isTileClipped=function(){return!0},o}(Zs);function gp(n,o){return o>0?o+2*n:n}var id=ma([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),im=ma([{name:"a_projected_pos",components:3,type:"Float32"}],4),od=(ma([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ma([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),_p=(ma([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ma([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),F=ma([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function le(n,o,s){return n.sections.forEach(function(p){p.text=function(g,y,E){var w=y.layout.get("text-transform").evaluate(E,{});return w==="uppercase"?g=g.toLocaleUpperCase():w==="lowercase"&&(g=g.toLocaleLowerCase()),$s.applyArabicShaping&&(g=$s.applyArabicShaping(g)),g}(p.text,o,s)}),n}ma([{name:"triangle",components:3,type:"Uint16"}]),ma([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ma([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ma([{type:"Float32",name:"offsetX"}]),ma([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var De={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},At=function(n,o,s,p,g){var y,E,w=8*g-p-1,M=(1<<w)-1,L=M>>1,k=-7,Z=s?g-1:0,q=s?-1:1,te=n[o+Z];for(Z+=q,y=te&(1<<-k)-1,te>>=-k,k+=w;k>0;y=256*y+n[o+Z],Z+=q,k-=8);for(E=y&(1<<-k)-1,y>>=-k,k+=p;k>0;E=256*E+n[o+Z],Z+=q,k-=8);if(y===0)y=1-L;else{if(y===M)return E?NaN:1/0*(te?-1:1);E+=Math.pow(2,p),y-=L}return(te?-1:1)*E*Math.pow(2,y-p)},$t=function(n,o,s,p,g,y){var E,w,M,L=8*y-g-1,k=(1<<L)-1,Z=k>>1,q=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,te=p?0:y-1,ye=p?1:-1,Te=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,E=k):(E=Math.floor(Math.log(o)/Math.LN2),o*(M=Math.pow(2,-E))<1&&(E--,M*=2),(o+=E+Z>=1?q/M:q*Math.pow(2,1-Z))*M>=2&&(E++,M/=2),E+Z>=k?(w=0,E=k):E+Z>=1?(w=(o*M-1)*Math.pow(2,g),E+=Z):(w=o*Math.pow(2,Z-1)*Math.pow(2,g),E=0));g>=8;n[s+te]=255&w,te+=ye,w/=256,g-=8);for(E=E<<g|w,L+=g;L>0;n[s+te]=255&E,te+=ye,E/=256,L-=8);n[s+te-ye]|=128*Te},Ct=pt;function pt(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}pt.Varint=0,pt.Fixed64=1,pt.Bytes=2,pt.Fixed32=5;var mr=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function dr(n){return n.type===pt.Bytes?n.readVarint()+n.pos:n.pos+1}function Pr(n,o,s){return s?4294967296*o+(n>>>0):4294967296*(o>>>0)+(n>>>0)}function xr(n,o,s){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));s.realloc(p);for(var g=s.pos-1;g>=n;g--)s.buf[g+p]=s.buf[g]}function Mr(n,o){for(var s=0;s<n.length;s++)o.writeVarint(n[s])}function kr(n,o){for(var s=0;s<n.length;s++)o.writeSVarint(n[s])}function fr(n,o){for(var s=0;s<n.length;s++)o.writeFloat(n[s])}function Or(n,o){for(var s=0;s<n.length;s++)o.writeDouble(n[s])}function lt(n,o){for(var s=0;s<n.length;s++)o.writeBoolean(n[s])}function Zt(n,o){for(var s=0;s<n.length;s++)o.writeFixed32(n[s])}function br(n,o){for(var s=0;s<n.length;s++)o.writeSFixed32(n[s])}function Wr(n,o){for(var s=0;s<n.length;s++)o.writeFixed64(n[s])}function ur(n,o){for(var s=0;s<n.length;s++)o.writeSFixed64(n[s])}function Jr(n,o){return(n[o]|n[o+1]<<8|n[o+2]<<16)+16777216*n[o+3]}function vr(n,o,s){n[s]=o,n[s+1]=o>>>8,n[s+2]=o>>>16,n[s+3]=o>>>24}function qr(n,o){return(n[o]|n[o+1]<<8|n[o+2]<<16)+(n[o+3]<<24)}function lr(n,o,s){n===1&&s.readMessage(Vr,o)}function Vr(n,o,s){if(n===3){var p=s.readMessage(Rn,{}),g=p.width,y=p.height,E=p.left,w=p.top,M=p.advance;o.push({id:p.id,bitmap:new Pl({width:g+6,height:y+6},p.bitmap),metrics:{width:g,height:y,left:E,top:w,advance:M}})}}function Rn(n,o,s){n===1?o.id=s.readVarint():n===2?o.bitmap=s.readBytes():n===3?o.width=s.readVarint():n===4?o.height=s.readVarint():n===5?o.left=s.readSVarint():n===6?o.top=s.readSVarint():n===7&&(o.advance=s.readVarint())}function Gn(n){for(var o=0,s=0,p=0,g=n;p<g.length;p+=1){var y=g[p];o+=y.w*y.h,s=Math.max(s,y.w)}n.sort(function(Te,Ge){return Ge.h-Te.h});for(var E=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),s),h:1/0}],w=0,M=0,L=0,k=n;L<k.length;L+=1)for(var Z=k[L],q=E.length-1;q>=0;q--){var te=E[q];if(!(Z.w>te.w||Z.h>te.h)){if(Z.x=te.x,Z.y=te.y,M=Math.max(M,Z.y+Z.h),w=Math.max(w,Z.x+Z.w),Z.w===te.w&&Z.h===te.h){var ye=E.pop();q<E.length&&(E[q]=ye)}else Z.h===te.h?(te.x+=Z.w,te.w-=Z.w):Z.w===te.w?(te.y+=Z.h,te.h-=Z.h):(E.push({x:te.x+Z.w,y:te.y,w:te.w-Z.w,h:Z.h}),te.y+=Z.h,te.h-=Z.h);break}}return{w,h:M,fill:o/(w*M)||0}}pt.prototype={destroy:function(){this.buf=null},readFields:function(n,o,s){for(s=s||this.length;this.pos<s;){var p=this.readVarint(),g=p>>3,y=this.pos;this.type=7&p,n(g,o,this),this.pos===y&&this.skip(p)}return o},readMessage:function(n,o){return this.readFields(n,o,this.readVarint()+this.pos)},readFixed32:function(){var n=Jr(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=qr(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Jr(this.buf,this.pos)+4294967296*Jr(this.buf,this.pos+4);return this.pos+=8,n},readSFixed64:function(){var n=Jr(this.buf,this.pos)+4294967296*qr(this.buf,this.pos+4);return this.pos+=8,n},readFloat:function(){var n=At(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=At(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var o,s,p=this.buf;return o=127&(s=p[this.pos++]),s<128?o:(o|=(127&(s=p[this.pos++]))<<7,s<128?o:(o|=(127&(s=p[this.pos++]))<<14,s<128?o:(o|=(127&(s=p[this.pos++]))<<21,s<128?o:function(g,y,E){var w,M,L=E.buf;if(w=(112&(M=L[E.pos++]))>>4,M<128||(w|=(127&(M=L[E.pos++]))<<3,M<128)||(w|=(127&(M=L[E.pos++]))<<10,M<128)||(w|=(127&(M=L[E.pos++]))<<17,M<128)||(w|=(127&(M=L[E.pos++]))<<24,M<128)||(w|=(1&(M=L[E.pos++]))<<31,M<128))return Pr(g,w,y);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(s=p[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,o=this.pos;return this.pos=n,n-o>=12&&mr?function(s,p,g){return mr.decode(s.subarray(p,g))}(this.buf,o,n):function(s,p,g){for(var y="",E=p;E<g;){var w,M,L,k=s[E],Z=null,q=k>239?4:k>223?3:k>191?2:1;if(E+q>g)break;q===1?k<128&&(Z=k):q===2?(192&(w=s[E+1]))==128&&(Z=(31&k)<<6|63&w)<=127&&(Z=null):q===3?(M=s[E+2],(192&(w=s[E+1]))==128&&(192&M)==128&&((Z=(15&k)<<12|(63&w)<<6|63&M)<=2047||Z>=55296&&Z<=57343)&&(Z=null)):q===4&&(M=s[E+2],L=s[E+3],(192&(w=s[E+1]))==128&&(192&M)==128&&(192&L)==128&&((Z=(15&k)<<18|(63&w)<<12|(63&M)<<6|63&L)<=65535||Z>=1114112)&&(Z=null)),Z===null?(Z=65533,q=1):Z>65535&&(Z-=65536,y+=String.fromCharCode(Z>>>10&1023|55296),Z=56320|1023&Z),y+=String.fromCharCode(Z),E+=q}return y}(this.buf,o,n)},readBytes:function(){var n=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,n);return this.pos=n,o},readPackedVarint:function(n,o){if(this.type!==pt.Bytes)return n.push(this.readVarint(o));var s=dr(this);for(n=n||[];this.pos<s;)n.push(this.readVarint(o));return n},readPackedSVarint:function(n){if(this.type!==pt.Bytes)return n.push(this.readSVarint());var o=dr(this);for(n=n||[];this.pos<o;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==pt.Bytes)return n.push(this.readBoolean());var o=dr(this);for(n=n||[];this.pos<o;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==pt.Bytes)return n.push(this.readFloat());var o=dr(this);for(n=n||[];this.pos<o;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==pt.Bytes)return n.push(this.readDouble());var o=dr(this);for(n=n||[];this.pos<o;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==pt.Bytes)return n.push(this.readFixed32());var o=dr(this);for(n=n||[];this.pos<o;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==pt.Bytes)return n.push(this.readSFixed32());var o=dr(this);for(n=n||[];this.pos<o;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==pt.Bytes)return n.push(this.readFixed64());var o=dr(this);for(n=n||[];this.pos<o;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==pt.Bytes)return n.push(this.readSFixed64());var o=dr(this);for(n=n||[];this.pos<o;)n.push(this.readSFixed64());return n},skip:function(n){var o=7&n;if(o===pt.Varint)for(;this.buf[this.pos++]>127;);else if(o===pt.Bytes)this.pos=this.readVarint()+this.pos;else if(o===pt.Fixed32)this.pos+=4;else{if(o!==pt.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(n,o){this.writeVarint(n<<3|o)},realloc:function(n){for(var o=this.length||16;o<this.pos+n;)o*=2;if(o!==this.length){var s=new Uint8Array(o);s.set(this.buf),this.buf=s,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),vr(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),vr(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),vr(this.buf,-1&n,this.pos),vr(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),vr(this.buf,-1&n,this.pos),vr(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(o,s){var p,g;if(o>=0?(p=o%4294967296|0,g=o/4294967296|0):(g=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,g=g+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(y,E,w){w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,w.buf[w.pos]=127&(y>>>=7)}(p,0,s),function(y,E){var w=(7&y)<<4;E.buf[E.pos++]|=w|((y>>>=3)?128:0),y&&(E.buf[E.pos++]=127&y|((y>>>=7)?128:0),y&&(E.buf[E.pos++]=127&y|((y>>>=7)?128:0),y&&(E.buf[E.pos++]=127&y|((y>>>=7)?128:0),y&&(E.buf[E.pos++]=127&y|((y>>>=7)?128:0),y&&(E.buf[E.pos++]=127&y)))))}(g,s)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var o=this.pos;this.pos=function(p,g,y){for(var E,w,M=0;M<g.length;M++){if((E=g.charCodeAt(M))>55295&&E<57344){if(!w){E>56319||M+1===g.length?(p[y++]=239,p[y++]=191,p[y++]=189):w=E;continue}if(E<56320){p[y++]=239,p[y++]=191,p[y++]=189,w=E;continue}E=w-55296<<10|E-56320|65536,w=null}else w&&(p[y++]=239,p[y++]=191,p[y++]=189,w=null);E<128?p[y++]=E:(E<2048?p[y++]=E>>6|192:(E<65536?p[y++]=E>>12|224:(p[y++]=E>>18|240,p[y++]=E>>12&63|128),p[y++]=E>>6&63|128),p[y++]=63&E|128)}return y}(this.buf,n,this.pos);var s=this.pos-o;s>=128&&xr(o,s,this),this.pos=o-1,this.writeVarint(s),this.pos+=s},writeFloat:function(n){this.realloc(4),$t(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),$t(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var o=n.length;this.writeVarint(o),this.realloc(o);for(var s=0;s<o;s++)this.buf[this.pos++]=n[s]},writeRawMessage:function(n,o){this.pos++;var s=this.pos;n(o,this);var p=this.pos-s;p>=128&&xr(s,p,this),this.pos=s-1,this.writeVarint(p),this.pos+=p},writeMessage:function(n,o,s){this.writeTag(n,pt.Bytes),this.writeRawMessage(o,s)},writePackedVarint:function(n,o){o.length&&this.writeMessage(n,Mr,o)},writePackedSVarint:function(n,o){o.length&&this.writeMessage(n,kr,o)},writePackedBoolean:function(n,o){o.length&&this.writeMessage(n,lt,o)},writePackedFloat:function(n,o){o.length&&this.writeMessage(n,fr,o)},writePackedDouble:function(n,o){o.length&&this.writeMessage(n,Or,o)},writePackedFixed32:function(n,o){o.length&&this.writeMessage(n,Zt,o)},writePackedSFixed32:function(n,o){o.length&&this.writeMessage(n,br,o)},writePackedFixed64:function(n,o){o.length&&this.writeMessage(n,Wr,o)},writePackedSFixed64:function(n,o){o.length&&this.writeMessage(n,ur,o)},writeBytesField:function(n,o){this.writeTag(n,pt.Bytes),this.writeBytes(o)},writeFixed32Field:function(n,o){this.writeTag(n,pt.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(n,o){this.writeTag(n,pt.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(n,o){this.writeTag(n,pt.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(n,o){this.writeTag(n,pt.Fixed64),this.writeSFixed64(o)},writeVarintField:function(n,o){this.writeTag(n,pt.Varint),this.writeVarint(o)},writeSVarintField:function(n,o){this.writeTag(n,pt.Varint),this.writeSVarint(o)},writeStringField:function(n,o){this.writeTag(n,pt.Bytes),this.writeString(o)},writeFloatField:function(n,o){this.writeTag(n,pt.Fixed32),this.writeFloat(o)},writeDoubleField:function(n,o){this.writeTag(n,pt.Fixed64),this.writeDouble(o)},writeBooleanField:function(n,o){this.writeVarintField(n,!!o)}};var Zr=function(n,o){var s=o.pixelRatio,p=o.version,g=o.stretchX,y=o.stretchY,E=o.content;this.paddedRect=n,this.pixelRatio=s,this.stretchX=g,this.stretchY=y,this.content=E,this.version=p},gr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};gr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},gr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},gr.tlbr.get=function(){return this.tl.concat(this.br)},gr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Zr.prototype,gr);var _e=function(n,o){var s={},p={};this.haveRenderCallbacks=[];var g=[];this.addImages(n,s,g),this.addImages(o,p,g);var y=Gn(g),E=new rs({width:y.w||1,height:y.h||1});for(var w in n){var M=n[w],L=s[w].paddedRect;rs.copy(M.data,E,{x:0,y:0},{x:L.x+1,y:L.y+1},M.data)}for(var k in o){var Z=o[k],q=p[k].paddedRect,te=q.x+1,ye=q.y+1,Te=Z.data.width,Ge=Z.data.height;rs.copy(Z.data,E,{x:0,y:0},{x:te,y:ye},Z.data),rs.copy(Z.data,E,{x:0,y:Ge-1},{x:te,y:ye-1},{width:Te,height:1}),rs.copy(Z.data,E,{x:0,y:0},{x:te,y:ye+Ge},{width:Te,height:1}),rs.copy(Z.data,E,{x:Te-1,y:0},{x:te-1,y:ye},{width:1,height:Ge}),rs.copy(Z.data,E,{x:0,y:0},{x:te+Te,y:ye},{width:1,height:Ge})}this.image=E,this.iconPositions=s,this.patternPositions=p};_e.prototype.addImages=function(n,o,s){for(var p in n){var g=n[p],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};s.push(y),o[p]=new Zr(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},_e.prototype.patchUpdatedImages=function(n,o){for(var s in n.dispatchRenderCallbacks(this.haveRenderCallbacks),n.updatedImages)this.patchUpdatedImage(this.iconPositions[s],n.getImage(s),o),this.patchUpdatedImage(this.patternPositions[s],n.getImage(s),o)},_e.prototype.patchUpdatedImage=function(n,o,s){if(n&&o&&n.version!==o.version){n.version=o.version;var p=n.tl;s.update(o.data,void 0,{x:p[0],y:p[1]})}},Hr("ImagePosition",Zr),Hr("ImageAtlas",_e);var D={horizontal:1,vertical:2,horizontalOnly:3},ni=function(){this.scale=1,this.fontStack="",this.imageName=null};ni.forText=function(n,o){var s=new ni;return s.scale=n||1,s.fontStack=o,s},ni.forImage=function(n){var o=new ni;return o.imageName=n,o};var O=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function li(n,o,s,p,g,y,E,w,M,L,k,Z,q,te,ye,Te){var Ge,Le=O.fromFeature(n,g);Z===D.vertical&&Le.verticalizePunctuation();var nt=$s.processBidirectionalText,ft=$s.processStyledBidirectionalText;if(nt&&Le.sections.length===1){Ge=[];for(var Pt=0,Ut=nt(Le.toString(),ta(Le,L,y,o,p,te,ye));Pt<Ut.length;Pt+=1){var er=Ut[Pt],Ar=new O;Ar.text=er,Ar.sections=Le.sections;for(var Nr=0;Nr<er.length;Nr++)Ar.sectionIndex.push(0);Ge.push(Ar)}}else if(ft){Ge=[];for(var yn=0,en=ft(Le.text,Le.sectionIndex,ta(Le,L,y,o,p,te,ye));yn<en.length;yn+=1){var En=en[yn],tn=new O;tn.text=En[0],tn.sectionIndex=En[1],tn.sections=Le.sections,Ge.push(tn)}}else Ge=function(hn,hi){for(var Bn=[],Ci=hn.text,Sn=0,bi=0,Po=hi;bi<Po.length;bi+=1){var na=Po[bi];Bn.push(hn.substring(Sn,na)),Sn=na}return Sn<Ci.length&&Bn.push(hn.substring(Sn,Ci.length)),Bn}(Le,ta(Le,L,y,o,p,te,ye));var si=[],kn={positionedLines:si,text:Le.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:Z,iconsInText:!1,verticalizable:!1};return function(hn,hi,Bn,Ci,Sn,bi,Po,na,Ko,So,$o,ia){for(var Ha=0,Os=-17,qa=0,ms=0,fa=na==="right"?1:na==="left"?0:.5,Ka=0,Ei=0,ji=Sn;Ei<ji.length;Ei+=1){var qi=ji[Ei];qi.trim();var Ri=qi.getMaxScale(),vs=24*(Ri-1),Ma={positionedGlyphs:[],lineOffset:0};hn.positionedLines[Ka]=Ma;var vo=Ma.positionedGlyphs,oa=0;if(qi.length()){for(var Oa=0;Oa<qi.length();Oa++){var Ui=qi.getSection(Oa),Iu=qi.getSectionIndex(Oa),js=qi.getCharCode(Oa),gs=0,Qo=null,vl=null,gl=null,bp=24,Yc=!(Ko===D.horizontal||!$o&&!Oc(js)||$o&&(Xn[js]||(qc=js,zr.Arabic(qc)||zr["Arabic Supplement"](qc)||zr["Arabic Extended-A"](qc)||zr["Arabic Presentation Forms-A"](qc)||zr["Arabic Presentation Forms-B"](qc))));if(Ui.imageName){var qh=Ci[Ui.imageName];if(!qh)continue;gl=Ui.imageName,hn.iconsInText=hn.iconsInText||!0,vl=qh.paddedRect;var Eh=qh.displaySize;Ui.scale=24*Ui.scale/ia,gs=vs+(24-Eh[1]*Ui.scale),bp=(Qo={width:Eh[0],height:Eh[1],left:1,top:-3,advance:Yc?Eh[1]:Eh[0]}).advance;var Kh=Yc?Eh[0]*Ui.scale-24*Ri:Eh[1]*Ui.scale-24*Ri;Kh>0&&Kh>oa&&(oa=Kh)}else{var hd=Bn[Ui.fontStack],Bf=hd&&hd[js];if(Bf&&Bf.rect)vl=Bf.rect,Qo=Bf.metrics;else{var Ep=hi[Ui.fontStack],fd=Ep&&Ep[js];if(!fd)continue;Qo=fd.metrics}gs=24*(Ri-Ui.scale)}Yc?(hn.verticalizable=!0,vo.push({glyph:js,imageName:gl,x:Ha,y:Os+gs,vertical:Yc,scale:Ui.scale,fontStack:Ui.fontStack,sectionIndex:Iu,metrics:Qo,rect:vl}),Ha+=bp*Ui.scale+So):(vo.push({glyph:js,imageName:gl,x:Ha,y:Os+gs,vertical:Yc,scale:Ui.scale,fontStack:Ui.fontStack,sectionIndex:Iu,metrics:Qo,rect:vl}),Ha+=Qo.advance*Ui.scale+So)}vo.length!==0&&(qa=Math.max(Ha-So,qa),ha(vo,0,vo.length-1,fa,oa)),Ha=0;var pd=bi*Ri+oa;Ma.lineOffset=Math.max(oa,vs),Os+=pd,ms=Math.max(pd,ms),++Ka}else Os+=bi,++Ka}var qc,Tp=Os- -17,$h=oo(Po),Th=$h.horizontalAlign,Ff=$h.verticalAlign;(function(dd,md,Ap,Nf,vd,Uf,Sp,kf,gd){var Qh,wp=(md-Ap)*vd;Qh=Uf!==Sp?-kf*Nf- -17:(-Nf*gd+.5)*Sp;for(var zf=0,Cp=dd;zf<Cp.length;zf+=1)for(var Jh=0,Rp=Cp[zf].positionedGlyphs;Jh<Rp.length;Jh+=1){var Ah=Rp[Jh];Ah.x+=wp,Ah.y+=Qh}})(hn.positionedLines,fa,Th,Ff,qa,ms,bi,Tp,Sn.length),hn.top+=-Ff*Tp,hn.bottom=hn.top+Tp,hn.left+=-Th*qa,hn.right=hn.left+qa}(kn,o,s,p,Ge,E,w,M,Z,L,q,Te),!function(hn){for(var hi=0,Bn=hn;hi<Bn.length;hi+=1)if(Bn[hi].positionedGlyphs.length!==0)return!1;return!0}(si)&&kn}O.fromFeature=function(n,o){for(var s=new O,p=0;p<n.sections.length;p++){var g=n.sections[p];g.image?s.addImageSection(g):s.addTextSection(g,o)}return s},O.prototype.length=function(){return this.text.length},O.prototype.getSection=function(n){return this.sections[this.sectionIndex[n]]},O.prototype.getSectionIndex=function(n){return this.sectionIndex[n]},O.prototype.getCharCode=function(n){return this.text.charCodeAt(n)},O.prototype.verticalizePunctuation=function(){this.text=function(n){for(var o="",s=0;s<n.length;s++){var p=n.charCodeAt(s+1)||null,g=n.charCodeAt(s-1)||null;o+=p&&Pc(p)&&!De[n[s+1]]||g&&Pc(g)&&!De[n[s-1]]||!De[n[s]]?n[s]:De[n[s]]}return o}(this.text)},O.prototype.trim=function(){for(var n=0,o=0;o<this.text.length&&Xn[this.text.charCodeAt(o)];o++)n++;for(var s=this.text.length,p=this.text.length-1;p>=0&&p>=n&&Xn[this.text.charCodeAt(p)];p--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)},O.prototype.substring=function(n,o){var s=new O;return s.text=this.text.substring(n,o),s.sectionIndex=this.sectionIndex.slice(n,o),s.sections=this.sections,s},O.prototype.toString=function(){return this.text},O.prototype.getMaxScale=function(){var n=this;return this.sectionIndex.reduce(function(o,s){return Math.max(o,n.sections[s].scale)},0)},O.prototype.addTextSection=function(n,o){this.text+=n.text,this.sections.push(ni.forText(n.scale,n.fontStack||o));for(var s=this.sections.length-1,p=0;p<n.text.length;++p)this.sectionIndex.push(s)},O.prototype.addImageSection=function(n){var o=n.image?n.image.name:"";if(o.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(ni.forImage(o)),this.sectionIndex.push(this.sections.length-1)):tt("Reached maximum number of images 6401")}else tt("Can't add FormattedSection with an empty image.")},O.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Xn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Un={};function Fi(n,o,s,p,g,y){if(o.imageName){var E=p[o.imageName];return E?E.displaySize[0]*o.scale*24/y+g:0}var w=s[o.fontStack],M=w&&w[n];return M?M.metrics.advance*o.scale+g:0}function fo(n,o,s,p){var g=Math.pow(n-o,2);return p?n<o?g/2:2*g:g+Math.abs(s)*s}function Za(n,o,s){var p=0;return n===10&&(p-=1e4),s&&(p+=150),n!==40&&n!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function _i(n,o,s,p,g,y){for(var E=null,w=fo(o,s,g,y),M=0,L=p;M<L.length;M+=1){var k=L[M],Z=fo(o-k.x,s,g,y)+k.badness;Z<=w&&(E=k,w=Z)}return{index:n,x:o,priorBreak:E,badness:w}}function ta(n,o,s,p,g,y,E){if(y!=="point")return[];if(!n)return[];for(var w,M=[],L=function(Ge,Le,nt,ft,Pt,Ut){for(var er=0,Ar=0;Ar<Ge.length();Ar++){var Nr=Ge.getSection(Ar);er+=Fi(Ge.getCharCode(Ar),Nr,ft,Pt,Le,Ut)}return er/Math.max(1,Math.ceil(er/nt))}(n,o,s,p,g,E),k=n.text.indexOf("\u200B")>=0,Z=0,q=0;q<n.length();q++){var te=n.getSection(q),ye=n.getCharCode(q);if(Xn[ye]||(Z+=Fi(ye,te,p,g,o,E)),q<n.length()-1){var Te=!((w=ye)<11904||!(zr["Bopomofo Extended"](w)||zr.Bopomofo(w)||zr["CJK Compatibility Forms"](w)||zr["CJK Compatibility Ideographs"](w)||zr["CJK Compatibility"](w)||zr["CJK Radicals Supplement"](w)||zr["CJK Strokes"](w)||zr["CJK Symbols and Punctuation"](w)||zr["CJK Unified Ideographs Extension A"](w)||zr["CJK Unified Ideographs"](w)||zr["Enclosed CJK Letters and Months"](w)||zr["Halfwidth and Fullwidth Forms"](w)||zr.Hiragana(w)||zr["Ideographic Description Characters"](w)||zr["Kangxi Radicals"](w)||zr["Katakana Phonetic Extensions"](w)||zr.Katakana(w)||zr["Vertical Forms"](w)||zr["Yi Radicals"](w)||zr["Yi Syllables"](w)));(Un[ye]||Te||te.imageName)&&M.push(_i(q+1,Z,L,M,Za(ye,n.getCharCode(q+1),Te&&k),!1))}}return function Ge(Le){return Le?Ge(Le.priorBreak).concat(Le.index):[]}(_i(n.length(),Z,L,M,0,!0))}function oo(n){var o=.5,s=.5;switch(n){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:o,verticalAlign:s}}function ha(n,o,s,p,g){if(p||g)for(var y=n[s],E=(n[s].x+y.metrics.advance*y.scale)*p,w=o;w<=s;w++)n[w].x-=E,n[w].y+=g}function ya(n,o,s,p,g,y){var E,w=n.image;if(w.content){var M=w.content,L=w.pixelRatio||1;E=[M[0]/L,M[1]/L,w.displaySize[0]-M[2]/L,w.displaySize[1]-M[3]/L]}var k,Z,q,te,ye=o.left*y,Te=o.right*y;s==="width"||s==="both"?(te=g[0]+ye-p[3],Z=g[0]+Te+p[1]):Z=(te=g[0]+(ye+Te-w.displaySize[0])/2)+w.displaySize[0];var Ge=o.top*y,Le=o.bottom*y;return s==="height"||s==="both"?(k=g[1]+Ge-p[0],q=g[1]+Le+p[2]):q=(k=g[1]+(Ge+Le-w.displaySize[1])/2)+w.displaySize[1],{image:w,top:k,right:Z,bottom:q,left:te,collisionPadding:E}}Un[10]=!0,Un[32]=!0,Un[38]=!0,Un[40]=!0,Un[41]=!0,Un[43]=!0,Un[45]=!0,Un[47]=!0,Un[173]=!0,Un[183]=!0,Un[8203]=!0,Un[8208]=!0,Un[8211]=!0,Un[8231]=!0;var qo=function(n){function o(s,p,g,y){n.call(this,s,p),this.angle=g,y!==void 0&&(this.segment=y)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(Oe);function xa(n,o){var s=o.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new $n(n+1))};if(s.kind==="source")return{kind:"source"};for(var p=s.zoomStops,g=s.interpolationType,y=0;y<p.length&&p[y]<=n;)y++;for(var E=y=Math.max(0,y-1);E<p.length&&p[E]<n+1;)E++;E=Math.min(p.length-1,E);var w=p[y],M=p[E];return s.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:M,interpolationType:g}:{kind:"camera",minZoom:w,maxZoom:M,minSize:s.evaluate(new $n(w)),maxSize:s.evaluate(new $n(M)),interpolationType:g}}function os(n,o,s){var p=o.uSize,g=s.lowerSize;return n.kind==="source"?g/128:n.kind==="composite"?Eo(g/128,s.upperSize/128,o.uSizeT):p}function Ra(n,o){var s=0,p=0;if(n.kind==="constant")p=n.layoutSize;else if(n.kind!=="source"){var g=n.interpolationType,y=g?qt(Ua.interpolationFactor(g,o,n.minZoom,n.maxZoom),0,1):0;n.kind==="camera"?p=Eo(n.minSize,n.maxSize,y):s=y}return{uSizeT:s,uSize:p}}Hr("Anchor",qo);var ai=Object.freeze({__proto__:null,getSizeData:xa,evaluateSizeForFeature:os,evaluateSizeForZoom:Ra,SIZE_PACK_FACTOR:128});function as(n,o,s,p,g){if(o.segment===void 0)return!0;for(var y=o,E=o.segment+1,w=0;w>-s/2;){if(--E<0)return!1;w-=n[E].dist(y),y=n[E]}w+=n[E].dist(n[E+1]),E++;for(var M=[],L=0;w<s/2;){var k=n[E],Z=n[E+1];if(!Z)return!1;var q=n[E-1].angleTo(k)-k.angleTo(Z);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:w,angleDelta:q}),L+=q;w-M[0].distance>p;)L-=M.shift().angleDelta;if(L>g)return!1;E++,w+=k.dist(Z)}return!0}function Zi(n){for(var o=0,s=0;s<n.length-1;s++)o+=n[s].dist(n[s+1]);return o}function Ln(n,o,s){return n?.6*o*s:0}function xi(n,o){return Math.max(n?n.right-n.left:0,o?o.right-o.left:0)}function Ni(n,o,s,p,g,y){for(var E=Ln(s,g,y),w=xi(s,p)*y,M=0,L=Zi(n)/2,k=0;k<n.length-1;k++){var Z=n[k],q=n[k+1],te=Z.dist(q);if(M+te>L){var ye=(L-M)/te,Te=Eo(Z.x,q.x,ye),Ge=Eo(Z.y,q.y,ye),Le=new qo(Te,Ge,q.angleTo(Z),k);return Le._round(),!E||as(n,Le,w,E,o)?Le:void 0}M+=te}}function ba(n,o,s,p,g,y,E,w,M){var L=Ln(p,y,E),k=xi(p,g),Z=k*E,q=n[0].x===0||n[0].x===M||n[0].y===0||n[0].y===M;return o-Z<o/4&&(o=Z+o/4),function te(ye,Te,Ge,Le,nt,ft,Pt,Ut,er){for(var Ar=ft/2,Nr=Zi(ye),yn=0,en=Te-Ge,En=[],tn=0;tn<ye.length-1;tn++){for(var si=ye[tn],kn=ye[tn+1],hn=si.dist(kn),hi=kn.angleTo(si);en+Ge<yn+hn;){var Bn=((en+=Ge)-yn)/hn,Ci=Eo(si.x,kn.x,Bn),Sn=Eo(si.y,kn.y,Bn);if(Ci>=0&&Ci<er&&Sn>=0&&Sn<er&&en-Ar>=0&&en+Ar<=Nr){var bi=new qo(Ci,Sn,hi,tn);bi._round(),Le&&!as(ye,bi,ft,Le,nt)||En.push(bi)}}yn+=hn}return Ut||En.length||Pt||(En=te(ye,yn/2,Ge,Le,nt,ft,Pt,!0,er)),En}(n,q?o/2*w%o:(k/2+2*y)*E*w%o,o,L,s,Z,q,!1,M)}function Yu(n,o,s,p,g){for(var y=[],E=0;E<n.length;E++)for(var w=n[E],M=void 0,L=0;L<w.length-1;L++){var k=w[L],Z=w[L+1];k.x<o&&Z.x<o||(k.x<o?k=new Oe(o,k.y+(o-k.x)/(Z.x-k.x)*(Z.y-k.y))._round():Z.x<o&&(Z=new Oe(o,k.y+(o-k.x)/(Z.x-k.x)*(Z.y-k.y))._round()),k.y<s&&Z.y<s||(k.y<s?k=new Oe(k.x+(s-k.y)/(Z.y-k.y)*(Z.x-k.x),s)._round():Z.y<s&&(Z=new Oe(k.x+(s-k.y)/(Z.y-k.y)*(Z.x-k.x),s)._round()),k.x>=p&&Z.x>=p||(k.x>=p?k=new Oe(p,k.y+(p-k.x)/(Z.x-k.x)*(Z.y-k.y))._round():Z.x>=p&&(Z=new Oe(p,k.y+(p-k.x)/(Z.x-k.x)*(Z.y-k.y))._round()),k.y>=g&&Z.y>=g||(k.y>=g?k=new Oe(k.x+(g-k.y)/(Z.y-k.y)*(Z.x-k.x),g)._round():Z.y>=g&&(Z=new Oe(k.x+(g-k.y)/(Z.y-k.y)*(Z.x-k.x),g)._round()),M&&k.equals(M[M.length-1])||y.push(M=[k]),M.push(Z)))))}return y}function Ae(n,o,s,p){var g=[],y=n.image,E=y.pixelRatio,w=y.paddedRect.w-2,M=y.paddedRect.h-2,L=n.right-n.left,k=n.bottom-n.top,Z=y.stretchX||[[0,w]],q=y.stretchY||[[0,M]],te=function(Ci,Sn){return Ci+Sn[1]-Sn[0]},ye=Z.reduce(te,0),Te=q.reduce(te,0),Ge=w-ye,Le=M-Te,nt=0,ft=ye,Pt=0,Ut=Te,er=0,Ar=Ge,Nr=0,yn=Le;if(y.content&&p){var en=y.content;nt=Dt(Z,0,en[0]),Pt=Dt(q,0,en[1]),ft=Dt(Z,en[0],en[2]),Ut=Dt(q,en[1],en[3]),er=en[0]-nt,Nr=en[1]-Pt,Ar=en[2]-en[0]-ft,yn=en[3]-en[1]-Ut}var En=function(Ci,Sn,bi,Po){var na=on(Ci.stretch-nt,ft,L,n.left),Ko=ci(Ci.fixed-er,Ar,Ci.stretch,ye),So=on(Sn.stretch-Pt,Ut,k,n.top),$o=ci(Sn.fixed-Nr,yn,Sn.stretch,Te),ia=on(bi.stretch-nt,ft,L,n.left),Ha=ci(bi.fixed-er,Ar,bi.stretch,ye),Os=on(Po.stretch-Pt,Ut,k,n.top),qa=ci(Po.fixed-Nr,yn,Po.stretch,Te),ms=new Oe(na,So),fa=new Oe(ia,So),Ka=new Oe(ia,Os),Ei=new Oe(na,Os),ji=new Oe(Ko/E,$o/E),qi=new Oe(Ha/E,qa/E),Ri=o*Math.PI/180;if(Ri){var vs=Math.sin(Ri),Ma=Math.cos(Ri),vo=[Ma,-vs,vs,Ma];ms._matMult(vo),fa._matMult(vo),Ei._matMult(vo),Ka._matMult(vo)}var oa=Ci.stretch+Ci.fixed,Oa=Sn.stretch+Sn.fixed;return{tl:ms,tr:fa,bl:Ei,br:Ka,tex:{x:y.paddedRect.x+1+oa,y:y.paddedRect.y+1+Oa,w:bi.stretch+bi.fixed-oa,h:Po.stretch+Po.fixed-Oa},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ji,pixelOffsetBR:qi,minFontScaleX:Ar/E/L,minFontScaleY:yn/E/k,isSDF:s}};if(p&&(y.stretchX||y.stretchY))for(var tn=vt(Z,Ge,ye),si=vt(q,Le,Te),kn=0;kn<tn.length-1;kn++)for(var hn=tn[kn],hi=tn[kn+1],Bn=0;Bn<si.length-1;Bn++)g.push(En(hn,si[Bn],hi,si[Bn+1]));else g.push(En({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:M+1}));return g}function Dt(n,o,s){for(var p=0,g=0,y=n;g<y.length;g+=1){var E=y[g];p+=Math.max(o,Math.min(s,E[1]))-Math.max(o,Math.min(s,E[0]))}return p}function vt(n,o,s){for(var p=[{fixed:-1,stretch:0}],g=0,y=n;g<y.length;g+=1){var E=y[g],w=E[0],M=E[1],L=p[p.length-1];p.push({fixed:w-L.stretch,stretch:L.stretch}),p.push({fixed:w-L.stretch,stretch:L.stretch+(M-w)})}return p.push({fixed:o+1,stretch:s}),p}function on(n,o,s,p){return n/o*s+p}function ci(n,o,s,p){return n-o*s/p}var ao=function(n,o,s,p,g,y,E,w,M,L){if(this.boxStartIndex=n.length,M){var k=y.top,Z=y.bottom,q=y.collisionPadding;q&&(k-=q[1],Z+=q[3]);var te=Z-k;te>0&&(te=Math.max(10,te),this.circleDiameter=te)}else{var ye=y.top*E-w,Te=y.bottom*E+w,Ge=y.left*E-w,Le=y.right*E+w,nt=y.collisionPadding;if(nt&&(Ge-=nt[0]*E,ye-=nt[1]*E,Le+=nt[2]*E,Te+=nt[3]*E),L){var ft=new Oe(Ge,ye),Pt=new Oe(Le,ye),Ut=new Oe(Ge,Te),er=new Oe(Le,Te),Ar=L*Math.PI/180;ft._rotate(Ar),Pt._rotate(Ar),Ut._rotate(Ar),er._rotate(Ar),Ge=Math.min(ft.x,Pt.x,Ut.x,er.x),Le=Math.max(ft.x,Pt.x,Ut.x,er.x),ye=Math.min(ft.y,Pt.y,Ut.y,er.y),Te=Math.max(ft.y,Pt.y,Ut.y,er.y)}n.emplaceBack(o.x,o.y,Ge,ye,Le,Te,s,p,g)}this.boxEndIndex=n.length},J=function(n,o){if(n===void 0&&(n=[]),o===void 0&&(o=fe),this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function fe(n,o){return n<o?-1:n>o?1:0}function Be(n,o,s){o===void 0&&(o=1),s===void 0&&(s=!1);for(var p=1/0,g=1/0,y=-1/0,E=-1/0,w=n[0],M=0;M<w.length;M++){var L=w[M];(!M||L.x<p)&&(p=L.x),(!M||L.y<g)&&(g=L.y),(!M||L.x>y)&&(y=L.x),(!M||L.y>E)&&(E=L.y)}var k=Math.min(y-p,E-g),Z=k/2,q=new J([],mt);if(k===0)return new Oe(p,g);for(var te=p;te<y;te+=k)for(var ye=g;ye<E;ye+=k)q.push(new dt(te+Z,ye+Z,Z,n));for(var Te=function(nt){for(var ft=0,Pt=0,Ut=0,er=nt[0],Ar=0,Nr=er.length,yn=Nr-1;Ar<Nr;yn=Ar++){var en=er[Ar],En=er[yn],tn=en.x*En.y-En.x*en.y;Pt+=(en.x+En.x)*tn,Ut+=(en.y+En.y)*tn,ft+=3*tn}return new dt(Pt/ft,Ut/ft,0,nt)}(n),Ge=q.length;q.length;){var Le=q.pop();(Le.d>Te.d||!Te.d)&&(Te=Le,s&&console.log("found best %d after %d probes",Math.round(1e4*Le.d)/1e4,Ge)),Le.max-Te.d<=o||(q.push(new dt(Le.p.x-(Z=Le.h/2),Le.p.y-Z,Z,n)),q.push(new dt(Le.p.x+Z,Le.p.y-Z,Z,n)),q.push(new dt(Le.p.x-Z,Le.p.y+Z,Z,n)),q.push(new dt(Le.p.x+Z,Le.p.y+Z,Z,n)),Ge+=4)}return s&&(console.log("num probes: "+Ge),console.log("best distance: "+Te.d)),Te.p}function mt(n,o){return o.max-n.max}function dt(n,o,s,p){this.p=new Oe(n,o),this.h=s,this.d=function(g,y){for(var E=!1,w=1/0,M=0;M<y.length;M++)for(var L=y[M],k=0,Z=L.length,q=Z-1;k<Z;q=k++){var te=L[k],ye=L[q];te.y>g.y!=ye.y>g.y&&g.x<(ye.x-te.x)*(g.y-te.y)/(ye.y-te.y)+te.x&&(E=!E),w=Math.min(w,fl(g,te,ye))}return(E?1:-1)*Math.sqrt(w)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}J.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},J.prototype.pop=function(){if(this.length!==0){var n=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),n}},J.prototype.peek=function(){return this.data[0]},J.prototype._up=function(n){for(var o=this.data,s=this.compare,p=o[n];n>0;){var g=n-1>>1,y=o[g];if(s(p,y)>=0)break;o[n]=y,n=g}o[n]=p},J.prototype._down=function(n){for(var o=this.data,s=this.compare,p=this.length>>1,g=o[n];n<p;){var y=1+(n<<1),E=o[y],w=y+1;if(w<this.length&&s(o[w],E)<0&&(y=w,E=o[w]),s(E,g)>=0)break;o[n]=E,n=y}o[n]=g};var Xe=Number.POSITIVE_INFINITY;function Ye(n,o){return o[1]!==Xe?function(s,p,g){var y=0,E=0;switch(p=Math.abs(p),g=Math.abs(g),s){case"top-right":case"top-left":case"top":E=g-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-g}switch(s){case"top-right":case"bottom-right":case"right":y=-p;break;case"top-left":case"bottom-left":case"left":y=p}return[y,E]}(n,o[0],o[1]):function(s,p){var g=0,y=0;p<0&&(p=0);var E=p/Math.sqrt(2);switch(s){case"top-right":case"top-left":y=E-7;break;case"bottom-right":case"bottom-left":y=7-E;break;case"bottom":y=7-p;break;case"top":y=p-7}switch(s){case"top-right":case"bottom-right":g=-E;break;case"top-left":case"bottom-left":g=E;break;case"left":g=p;break;case"right":g=-p}return[g,y]}(n,o[0])}function Qe(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ee(n,o,s,p,g,y,E,w,M,L,k,Z,q,te,ye){var Te=function(Pt,Ut,er,Ar,Nr,yn,en,En){for(var tn=Ar.layout.get("text-rotate").evaluate(yn,{})*Math.PI/180,si=[],kn=0,hn=Ut.positionedLines;kn<hn.length;kn+=1)for(var hi=hn[kn],Bn=0,Ci=hi.positionedGlyphs;Bn<Ci.length;Bn+=1){var Sn=Ci[Bn];if(Sn.rect){var bi=Sn.rect||{},Po=4,na=!0,Ko=1,So=0,$o=(Nr||En)&&Sn.vertical,ia=Sn.metrics.advance*Sn.scale/2;if(En&&Ut.verticalizable&&(So=hi.lineOffset/2-(Sn.imageName?-(24-Sn.metrics.width*Sn.scale)/2:24*(Sn.scale-1))),Sn.imageName){var Ha=en[Sn.imageName];na=Ha.sdf,Po=1/(Ko=Ha.pixelRatio)}var Os=Nr?[Sn.x+ia,Sn.y]:[0,0],qa=Nr?[0,0]:[Sn.x+ia+er[0],Sn.y+er[1]-So],ms=[0,0];$o&&(ms=qa,qa=[0,0]);var fa=(Sn.metrics.left-Po)*Sn.scale-ia+qa[0],Ka=(-Sn.metrics.top-Po)*Sn.scale+qa[1],Ei=fa+bi.w*Sn.scale/Ko,ji=Ka+bi.h*Sn.scale/Ko,qi=new Oe(fa,Ka),Ri=new Oe(Ei,Ka),vs=new Oe(fa,ji),Ma=new Oe(Ei,ji);if($o){var vo=new Oe(-ia,ia- -17),oa=-Math.PI/2,Oa=12-ia,Ui=new Oe(22-Oa,-(Sn.imageName?Oa:0)),Iu=new(Function.prototype.bind.apply(Oe,[null].concat(ms)));qi._rotateAround(oa,vo)._add(Ui)._add(Iu),Ri._rotateAround(oa,vo)._add(Ui)._add(Iu),vs._rotateAround(oa,vo)._add(Ui)._add(Iu),Ma._rotateAround(oa,vo)._add(Ui)._add(Iu)}if(tn){var js=Math.sin(tn),gs=Math.cos(tn),Qo=[gs,-js,js,gs];qi._matMult(Qo),Ri._matMult(Qo),vs._matMult(Qo),Ma._matMult(Qo)}var vl=new Oe(0,0),gl=new Oe(0,0);si.push({tl:qi,tr:Ri,bl:vs,br:Ma,tex:bi,writingMode:Ut.writingMode,glyphOffset:Os,sectionIndex:Sn.sectionIndex,isSDF:na,pixelOffsetTL:vl,pixelOffsetBR:gl,minFontScaleX:0,minFontScaleY:0})}}return si}(0,s,w,g,y,E,p,n.allowVerticalPlacement),Ge=n.textSizeData,Le=null;Ge.kind==="source"?(Le=[128*g.layout.get("text-size").evaluate(E,{})])[0]>32640&&tt(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ge.kind==="composite"&&((Le=[128*te.compositeTextSizes[0].evaluate(E,{},ye),128*te.compositeTextSizes[1].evaluate(E,{},ye)])[0]>32640||Le[1]>32640)&&tt(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),n.addSymbols(n.text,Te,Le,w,y,E,L,o,M.lineStartIndex,M.lineLength,q,ye);for(var nt=0,ft=k;nt<ft.length;nt+=1)Z[ft[nt]]=n.text.placedSymbolArray.length-1;return 4*Te.length}function We(n){for(var o in n)return n[o];return null}function ue(n,o,s,p){var g=n.compareText;if(o in g){for(var y=g[o],E=y.length-1;E>=0;E--)if(p.dist(y[E])<s)return!0}else g[o]=[];return g[o].push(p),!1}var He=Nl.VectorTileFeature.types,Et=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kt(n,o,s,p,g,y,E,w,M,L,k,Z,q){var te=w?Math.min(32640,Math.round(w[0])):0,ye=w?Math.min(32640,Math.round(w[1])):0;n.emplaceBack(o,s,Math.round(32*p),Math.round(32*g),y,E,(te<<1)+(M?1:0),ye,16*L,16*k,256*Z,256*q)}function hr(n,o,s){n.emplaceBack(o.x,o.y,s),n.emplaceBack(o.x,o.y,s),n.emplaceBack(o.x,o.y,s),n.emplaceBack(o.x,o.y,s)}function Wt(n){for(var o=0,s=n.sections;o<s.length;o+=1)if(kh(s[o].text))return!0;return!1}var Ht=function(n){this.layoutVertexArray=new Zh,this.indexArray=new hu,this.programConfigurations=n,this.segments=new oe,this.dynamicLayoutVertexArray=new ic,this.opacityVertexArray=new wa,this.placedSymbolArray=new d};Ht.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ht.prototype.upload=function(n,o,s,p){this.isEmpty()||(s&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,id.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,im.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Et,!0),this.opacityVertexBuffer.itemSize=1),(s||p)&&this.programConfigurations.upload(n))},Ht.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Hr("SymbolBuffers",Ht);var cn=function(n,o,s){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new s,this.segments=new oe,this.collisionVertexArray=new ph};cn.prototype.upload=function(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,od.members,!0)},cn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Hr("CollisionBuffers",cn);var Ot=function(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(y){return y.id}),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ca([]),this.placementViewportMatrix=Ca([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xa(this.zoom,o["text-size"]),this.iconSizeData=xa(this.zoom,o["icon-size"]);var s=this.layers[0].layout,p=s.get("symbol-sort-key"),g=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(y){return D[y]})),this.stateDependentLayerIds=this.layers.filter(function(y){return y.isStateDependent()}).map(function(y){return y.id}),this.sourceID=n.sourceID};Ot.prototype.createArrays=function(){this.text=new Ht(new Pn(this.layers,this.zoom,function(n){return/^text/.test(n)})),this.icon=new Ht(new Pn(this.layers,this.zoom,function(n){return/^icon/.test(n)})),this.glyphOffsetArray=new S,this.lineVertexArray=new I,this.symbolInstances=new T},Ot.prototype.calculateGlyphDependencies=function(n,o,s,p,g){for(var y=0;y<n.length;y++)if(o[n.charCodeAt(y)]=!0,(s||p)&&g){var E=De[n.charAt(y)];E&&(o[E.charCodeAt(0)]=!0)}},Ot.prototype.populate=function(n,o,s){var p=this.layers[0],g=p.layout,y=g.get("text-font"),E=g.get("text-field"),w=g.get("icon-image"),M=(E.value.kind!=="constant"||E.value.value instanceof eo&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),L=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,k=g.get("symbol-sort-key");if(this.features=[],M||L){for(var Z=o.iconDependencies,q=o.glyphDependencies,te=o.availableImages,ye=new $n(this.zoom),Te=0,Ge=n;Te<Ge.length;Te+=1){var Le=Ge[Te],nt=Le.feature,ft=Le.id,Pt=Le.index,Ut=Le.sourceLayerIndex,er=p._featureFilter.needGeometry,Ar=Ao(nt,er);if(p._featureFilter.filter(ye,Ar,s)){er||(Ar.geometry=To(nt));var Nr=void 0;if(M){var yn=p.getValueAndResolveTokens("text-field",Ar,s,te),en=eo.factory(yn);Wt(en)&&(this.hasRTLText=!0),(!this.hasRTLText||Ef()==="unavailable"||this.hasRTLText&&$s.isParsed())&&(Nr=le(en,p,Ar))}var En=void 0;if(L){var tn=p.getValueAndResolveTokens("icon-image",Ar,s,te);En=tn instanceof co?tn:co.fromString(tn)}if(Nr||En){var si=this.sortFeaturesByKey?k.evaluate(Ar,{},s):void 0;if(this.features.push({id:ft,text:Nr,icon:En,index:Pt,sourceLayerIndex:Ut,geometry:Ar.geometry,properties:nt.properties,type:He[nt.type],sortKey:si}),En&&(Z[En.name]=!0),Nr){var kn=y.evaluate(Ar,{},s).join(","),hn=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(D.vertical)>=0;for(var hi=0,Bn=Nr.sections;hi<Bn.length;hi+=1){var Ci=Bn[hi];if(Ci.image)Z[Ci.image.name]=!0;else{var Sn=qs(Nr.toString()),bi=Ci.fontStack||kn,Po=q[bi]=q[bi]||{};this.calculateGlyphDependencies(Ci.text,Po,hn,this.allowVerticalPlacement,Sn)}}}}}}g.get("symbol-placement")==="line"&&(this.features=function(na){var Ko={},So={},$o=[],ia=0;function Ha(vo){$o.push(na[vo]),ia++}function Os(vo,oa,Oa){var Ui=So[vo];return delete So[vo],So[oa]=Ui,$o[Ui].geometry[0].pop(),$o[Ui].geometry[0]=$o[Ui].geometry[0].concat(Oa[0]),Ui}function qa(vo,oa,Oa){var Ui=Ko[oa];return delete Ko[oa],Ko[vo]=Ui,$o[Ui].geometry[0].shift(),$o[Ui].geometry[0]=Oa[0].concat($o[Ui].geometry[0]),Ui}function ms(vo,oa,Oa){var Ui=Oa?oa[0][oa[0].length-1]:oa[0][0];return vo+":"+Ui.x+":"+Ui.y}for(var fa=0;fa<na.length;fa++){var Ka=na[fa],Ei=Ka.geometry,ji=Ka.text?Ka.text.toString():null;if(ji){var qi=ms(ji,Ei),Ri=ms(ji,Ei,!0);if(qi in So&&Ri in Ko&&So[qi]!==Ko[Ri]){var vs=qa(qi,Ri,Ei),Ma=Os(qi,Ri,$o[vs].geometry);delete Ko[qi],delete So[Ri],So[ms(ji,$o[Ma].geometry,!0)]=Ma,$o[vs].geometry=null}else qi in So?Os(qi,Ri,Ei):Ri in Ko?qa(qi,Ri,Ei):(Ha(fa),Ko[qi]=ia-1,So[Ri]=ia-1)}else Ha(fa)}return $o.filter(function(vo){return vo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(na,Ko){return na.sortKey-Ko.sortKey})}},Ot.prototype.update=function(n,o,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,o,this.layers,s),this.icon.programConfigurations.updatePaintArrays(n,o,this.layers,s))},Ot.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ot.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ot.prototype.upload=function(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ot.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ot.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ot.prototype.addToLineVertexArray=function(n,o){var s=this.lineVertexArray.length;if(n.segment!==void 0){for(var p=n.dist(o[n.segment+1]),g=n.dist(o[n.segment]),y={},E=n.segment+1;E<o.length;E++)y[E]={x:o[E].x,y:o[E].y,tileUnitDistanceFromAnchor:p},E<o.length-1&&(p+=o[E+1].dist(o[E]));for(var w=n.segment||0;w>=0;w--)y[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:g},w>0&&(g+=o[w-1].dist(o[w]));for(var M=0;M<o.length;M++){var L=y[M];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},Ot.prototype.addSymbols=function(n,o,s,p,g,y,E,w,M,L,k,Z){for(var q=n.indexArray,te=n.layoutVertexArray,ye=n.segments.prepareSegment(4*o.length,te,q,this.canOverlap?y.sortKey:void 0),Te=this.glyphOffsetArray.length,Ge=ye.vertexLength,Le=this.allowVerticalPlacement&&E===D.vertical?Math.PI/2:0,nt=y.text&&y.text.sections,ft=0;ft<o.length;ft++){var Pt=o[ft],Ut=Pt.tl,er=Pt.tr,Ar=Pt.bl,Nr=Pt.br,yn=Pt.tex,en=Pt.pixelOffsetTL,En=Pt.pixelOffsetBR,tn=Pt.minFontScaleX,si=Pt.minFontScaleY,kn=Pt.glyphOffset,hn=Pt.isSDF,hi=Pt.sectionIndex,Bn=ye.vertexLength,Ci=kn[1];kt(te,w.x,w.y,Ut.x,Ci+Ut.y,yn.x,yn.y,s,hn,en.x,en.y,tn,si),kt(te,w.x,w.y,er.x,Ci+er.y,yn.x+yn.w,yn.y,s,hn,En.x,en.y,tn,si),kt(te,w.x,w.y,Ar.x,Ci+Ar.y,yn.x,yn.y+yn.h,s,hn,en.x,En.y,tn,si),kt(te,w.x,w.y,Nr.x,Ci+Nr.y,yn.x+yn.w,yn.y+yn.h,s,hn,En.x,En.y,tn,si),hr(n.dynamicLayoutVertexArray,w,Le),q.emplaceBack(Bn,Bn+1,Bn+2),q.emplaceBack(Bn+1,Bn+2,Bn+3),ye.vertexLength+=4,ye.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kn[0]),ft!==o.length-1&&hi===o[ft+1].sectionIndex||n.programConfigurations.populatePaintArrays(te.length,y,y.index,{},Z,nt&&nt[hi])}n.placedSymbolArray.emplaceBack(w.x,w.y,Te,this.glyphOffsetArray.length-Te,Ge,M,L,w.segment,s?s[0]:0,s?s[1]:0,p[0],p[1],E,0,!1,0,k)},Ot.prototype._addCollisionDebugVertex=function(n,o,s,p,g,y){return o.emplaceBack(0,0),n.emplaceBack(s.x,s.y,p,g,Math.round(y.x),Math.round(y.y))},Ot.prototype.addCollisionDebugVertices=function(n,o,s,p,g,y,E){var w=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),M=w.vertexLength,L=g.layoutVertexArray,k=g.collisionVertexArray,Z=E.anchorX,q=E.anchorY;this._addCollisionDebugVertex(L,k,y,Z,q,new Oe(n,o)),this._addCollisionDebugVertex(L,k,y,Z,q,new Oe(s,o)),this._addCollisionDebugVertex(L,k,y,Z,q,new Oe(s,p)),this._addCollisionDebugVertex(L,k,y,Z,q,new Oe(n,p)),w.vertexLength+=4;var te=g.indexArray;te.emplaceBack(M,M+1),te.emplaceBack(M+1,M+2),te.emplaceBack(M+2,M+3),te.emplaceBack(M+3,M),w.primitiveLength+=4},Ot.prototype.addDebugCollisionBoxes=function(n,o,s,p){for(var g=n;g<o;g++){var y=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,p?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,s)}},Ot.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cn(cu,_p.members,Ml),this.iconCollisionBox=new cn(cu,_p.members,Ml);for(var n=0;n<this.symbolInstances.length;n++){var o=this.symbolInstances.get(n);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Ot.prototype._deserializeCollisionBoxesForSymbol=function(n,o,s,p,g,y,E,w,M){for(var L={},k=o;k<s;k++){var Z=n.get(k);L.textBox={x1:Z.x1,y1:Z.y1,x2:Z.x2,y2:Z.y2,anchorPointX:Z.anchorPointX,anchorPointY:Z.anchorPointY},L.textFeatureIndex=Z.featureIndex;break}for(var q=p;q<g;q++){var te=n.get(q);L.verticalTextBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},L.verticalTextFeatureIndex=te.featureIndex;break}for(var ye=y;ye<E;ye++){var Te=n.get(ye);L.iconBox={x1:Te.x1,y1:Te.y1,x2:Te.x2,y2:Te.y2,anchorPointX:Te.anchorPointX,anchorPointY:Te.anchorPointY},L.iconFeatureIndex=Te.featureIndex;break}for(var Ge=w;Ge<M;Ge++){var Le=n.get(Ge);L.verticalIconBox={x1:Le.x1,y1:Le.y1,x2:Le.x2,y2:Le.y2,anchorPointX:Le.anchorPointX,anchorPointY:Le.anchorPointY},L.verticalIconFeatureIndex=Le.featureIndex;break}return L},Ot.prototype.deserializeCollisionBoxes=function(n){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var s=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},Ot.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ot.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ot.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ot.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ot.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ot.prototype.addIndicesForPlacedSymbol=function(n,o){for(var s=n.placedSymbolArray.get(o),p=s.vertexStartIndex+4*s.numGlyphs,g=s.vertexStartIndex;g<p;g+=4)n.indexArray.emplaceBack(g,g+1,g+2),n.indexArray.emplaceBack(g+1,g+2,g+3)},Ot.prototype.getSortedSymbolIndexes=function(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(n),s=Math.cos(n),p=[],g=[],y=[],E=0;E<this.symbolInstances.length;++E){y.push(E);var w=this.symbolInstances.get(E);p.push(0|Math.round(o*w.anchorX+s*w.anchorY)),g.push(w.featureIndex)}return y.sort(function(M,L){return p[M]-p[L]||g[L]-g[M]}),y},Ot.prototype.addToSortKeyRanges=function(n,o){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===o?s.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})},Ot.prototype.sortFeatures=function(n){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,p=this.symbolInstanceIndexes;s<p.length;s+=1){var g=this.symbolInstances.get(p[s]);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(function(y,E,w){y>=0&&w.indexOf(y)===E&&o.addIndicesForPlacedSymbol(o.text,y)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Hr("SymbolBucket",Ot,{omit:["layers","collisionBoxArray","features","compareText"]}),Ot.MAX_GLYPHS=65535,Ot.addDynamicAttributes=hr;var pn=new xo({"symbol-placement":new bn(Q.layout_symbol["symbol-placement"]),"symbol-spacing":new bn(Q.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bn(Q.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ln(Q.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bn(Q.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bn(Q.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bn(Q.layout_symbol["icon-ignore-placement"]),"icon-optional":new bn(Q.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bn(Q.layout_symbol["icon-rotation-alignment"]),"icon-size":new ln(Q.layout_symbol["icon-size"]),"icon-text-fit":new bn(Q.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bn(Q.layout_symbol["icon-text-fit-padding"]),"icon-image":new ln(Q.layout_symbol["icon-image"]),"icon-rotate":new ln(Q.layout_symbol["icon-rotate"]),"icon-padding":new bn(Q.layout_symbol["icon-padding"]),"icon-keep-upright":new bn(Q.layout_symbol["icon-keep-upright"]),"icon-offset":new ln(Q.layout_symbol["icon-offset"]),"icon-anchor":new ln(Q.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bn(Q.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bn(Q.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bn(Q.layout_symbol["text-rotation-alignment"]),"text-field":new ln(Q.layout_symbol["text-field"]),"text-font":new ln(Q.layout_symbol["text-font"]),"text-size":new ln(Q.layout_symbol["text-size"]),"text-max-width":new ln(Q.layout_symbol["text-max-width"]),"text-line-height":new bn(Q.layout_symbol["text-line-height"]),"text-letter-spacing":new ln(Q.layout_symbol["text-letter-spacing"]),"text-justify":new ln(Q.layout_symbol["text-justify"]),"text-radial-offset":new ln(Q.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bn(Q.layout_symbol["text-variable-anchor"]),"text-anchor":new ln(Q.layout_symbol["text-anchor"]),"text-max-angle":new bn(Q.layout_symbol["text-max-angle"]),"text-writing-mode":new bn(Q.layout_symbol["text-writing-mode"]),"text-rotate":new ln(Q.layout_symbol["text-rotate"]),"text-padding":new bn(Q.layout_symbol["text-padding"]),"text-keep-upright":new bn(Q.layout_symbol["text-keep-upright"]),"text-transform":new ln(Q.layout_symbol["text-transform"]),"text-offset":new ln(Q.layout_symbol["text-offset"]),"text-allow-overlap":new bn(Q.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bn(Q.layout_symbol["text-ignore-placement"]),"text-optional":new bn(Q.layout_symbol["text-optional"])}),Dn={paint:new xo({"icon-opacity":new ln(Q.paint_symbol["icon-opacity"]),"icon-color":new ln(Q.paint_symbol["icon-color"]),"icon-halo-color":new ln(Q.paint_symbol["icon-halo-color"]),"icon-halo-width":new ln(Q.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ln(Q.paint_symbol["icon-halo-blur"]),"icon-translate":new bn(Q.paint_symbol["icon-translate"]),"icon-translate-anchor":new bn(Q.paint_symbol["icon-translate-anchor"]),"text-opacity":new ln(Q.paint_symbol["text-opacity"]),"text-color":new ln(Q.paint_symbol["text-color"],{runtimeType:Rr,getOverride:function(n){return n.textColor},hasOverride:function(n){return!!n.textColor}}),"text-halo-color":new ln(Q.paint_symbol["text-halo-color"]),"text-halo-width":new ln(Q.paint_symbol["text-halo-width"]),"text-halo-blur":new ln(Q.paint_symbol["text-halo-blur"]),"text-translate":new bn(Q.paint_symbol["text-translate"]),"text-translate-anchor":new bn(Q.paint_symbol["text-translate-anchor"])}),layout:pn},jn=function(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Fr,this.defaultValue=n};jn.prototype.evaluate=function(n){if(n.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default},jn.prototype.eachChild=function(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)},jn.prototype.outputDefined=function(){return!1},jn.prototype.serialize=function(){return null},Hr("FormatSectionOverride",jn,{omit:["defaultValue"]});var Oi=function(n){function o(s){n.call(this,s,Dn)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.recalculate=function(s,p){if(n.prototype.recalculate.call(this,s,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var g=this.layout.get("text-writing-mode");if(g){for(var y=[],E=0,w=g;E<w.length;E+=1){var M=w[E];y.indexOf(M)<0&&y.push(M)}this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(s,p,g,y){var E=this.layout.get(s).evaluate(p,{},g,y),w=this._unevaluatedLayout._values[s];return w.isDataDriven()||As(w.value)||!E?E:function(M,L){return L.replace(/{([^{}]+)}/g,function(k,Z){return Z in M?String(M[Z]):""})}(p.properties,E)},o.prototype.createBucket=function(s){return new Ot(s)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var s=0,p=Dn.paint.overridableProperties;s<p.length;s+=1){var g=p[s];if(o.hasPaintOverride(this.layout,g)){var y,E=this.paint.get(g),w=new jn(E),M=new Sa(w,E.property.specification);y=E.value.kind==="constant"||E.value.kind==="source"?new il("source",M):new Sl("composite",M,E.value.zoomStops,E.value._interpolationType),this.paint._values[g]=new es(E.property,y,E.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(s,p,g){return!(!this.layout||p.isDataDriven()||g.isDataDriven())&&o.hasPaintOverride(this.layout,s)},o.hasPaintOverride=function(s,p){var g=s.get("text-field"),y=Dn.paint.properties[p],E=!1,w=function(k){for(var Z=0,q=k;Z<q.length;Z+=1)if(y.overrides&&y.overrides.hasOverride(q[Z]))return void(E=!0)};if(g.value.kind==="constant"&&g.value.value instanceof eo)w(g.value.value.sections);else if(g.value.kind==="source"){var M=function(k){E||(k instanceof no&&Gi(k.value)===Li?w(k.value.sections):k instanceof Wa?w(k.sections):k.eachChild(M))},L=g.value;L._styleExpression&&M(L._styleExpression.expression)}return E},o}(Zs),Ea={paint:new xo({"background-color":new bn(Q.paint_background["background-color"]),"background-pattern":new Ga(Q.paint_background["background-pattern"]),"background-opacity":new bn(Q.paint_background["background-opacity"])})},qu=function(n){function o(s){n.call(this,s,Ea)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Zs),Lf={paint:new xo({"raster-opacity":new bn(Q.paint_raster["raster-opacity"]),"raster-hue-rotate":new bn(Q.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bn(Q.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bn(Q.paint_raster["raster-brightness-max"]),"raster-saturation":new bn(Q.paint_raster["raster-saturation"]),"raster-contrast":new bn(Q.paint_raster["raster-contrast"]),"raster-resampling":new bn(Q.paint_raster["raster-resampling"]),"raster-fade-duration":new bn(Q.paint_raster["raster-fade-duration"])})},mu=function(n){function o(s){n.call(this,s,Lf)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Zs),ad=function(n){function o(s){n.call(this,s,{}),this.implementation=s}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},o.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},o}(Zs),Ul={circle:Bc,heatmap:vh,hillshade:Kd,fill:hp,"fill-extrusion":Jp,line:nd,symbol:Oi,background:qu,raster:mu},yp=Re.HTMLImageElement,pv=Re.HTMLCanvasElement,dv=Re.HTMLVideoElement,mv=Re.ImageData,sd=Re.ImageBitmap,bh=function(n,o,s,p){this.context=n,this.format=s,this.texture=n.gl.createTexture(),this.update(o,p)};bh.prototype.update=function(n,o,s){var p=n.width,g=n.height,y=!(this.size&&this.size[0]===p&&this.size[1]===g||s),E=this.context,w=E.gl;if(this.useMipmap=!!(o&&o.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!o||o.premultiply!==!1)),y)this.size=[p,g],n instanceof yp||n instanceof pv||n instanceof dv||n instanceof mv||sd&&n instanceof sd?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,n):w.texImage2D(w.TEXTURE_2D,0,this.format,p,g,0,this.format,w.UNSIGNED_BYTE,n.data);else{var M=s||{x:0,y:0},L=M.x,k=M.y;n instanceof yp||n instanceof pv||n instanceof dv||n instanceof mv||sd&&n instanceof sd?w.texSubImage2D(w.TEXTURE_2D,0,L,k,w.RGBA,w.UNSIGNED_BYTE,n):w.texSubImage2D(w.TEXTURE_2D,0,L,k,p,g,w.RGBA,w.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D)},bh.prototype.bind=function(n,o,s){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),s!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=p.LINEAR),n!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,s||n),this.filter=n),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},bh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},bh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var om=function(n){var o=this;this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};om.prototype.trigger=function(){var n=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){n._triggered=!1,n._callback()},0))},om.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Gh=function(n,o,s){this.target=n,this.parent=o,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},vn(["receive","process"],this),this.invoker=new om(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=$()?n:Re};function vv(n,o,s){var p=2*Math.PI*6378137/256/Math.pow(2,s);return[n*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}Gh.prototype.send=function(n,o,s,p,g){var y=this;g===void 0&&(g=!1);var E=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[E]=s);var w=he(this.globalScope)?void 0:[];return this.target.postMessage({id:E,type:n,hasCallback:!!s,targetMapId:p,mustQueue:g,sourceMapId:this.mapId,data:Qa(o,w)},w),{cancel:function(){s&&delete y.callbacks[E],y.target.postMessage({id:E,type:"<cancel>",targetMapId:p,sourceMapId:y.mapId})}}},Gh.prototype.receive=function(n){var o=n.data,s=o.id;if(s&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[s];var p=this.cancelCallbacks[s];delete this.cancelCallbacks[s],p&&p()}else $()||o.mustQueue?(this.tasks[s]=o,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,o)},Gh.prototype.process=function(){if(this.taskQueue.length){var n=this.taskQueue.shift(),o=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(n,o)}},Gh.prototype.processTask=function(n,o){var s=this;if(o.type==="<response>"){var p=this.callbacks[n];delete this.callbacks[n],p&&(o.error?p(io(o.error)):p(null,io(o.data)))}else{var g=!1,y=he(this.globalScope)?void 0:[],E=o.hasCallback?function(k,Z){g=!0,delete s.cancelCallbacks[n],s.target.postMessage({id:n,type:"<response>",sourceMapId:s.mapId,error:k?Qa(k):null,data:Qa(Z,y)},y)}:function(k){g=!0},w=null,M=io(o.data);if(this.parent[o.type])w=this.parent[o.type](o.sourceMapId,M,E);else if(this.parent.getWorkerSource){var L=o.type.split(".");w=this.parent.getWorkerSource(o.sourceMapId,L[0],M.source)[L[1]](M,E)}else E(new Error("Could not find function "+o.type));!g&&w&&w.cancel&&(this.cancelCallbacks[n]=w.cancel)}},Gh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ja=function(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))};ja.prototype.setNorthEast=function(n){return this._ne=n instanceof Oo?new Oo(n.lng,n.lat):Oo.convert(n),this},ja.prototype.setSouthWest=function(n){return this._sw=n instanceof Oo?new Oo(n.lng,n.lat):Oo.convert(n),this},ja.prototype.extend=function(n){var o,s,p=this._sw,g=this._ne;if(n instanceof Oo)o=n,s=n;else{if(!(n instanceof ja))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(ja.convert(n)):this.extend(Oo.convert(n)):this;if(s=n._ne,!(o=n._sw)||!s)return this}return p||g?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),g.lng=Math.max(s.lng,g.lng),g.lat=Math.max(s.lat,g.lat)):(this._sw=new Oo(o.lng,o.lat),this._ne=new Oo(s.lng,s.lat)),this},ja.prototype.getCenter=function(){return new Oo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ja.prototype.getSouthWest=function(){return this._sw},ja.prototype.getNorthEast=function(){return this._ne},ja.prototype.getNorthWest=function(){return new Oo(this.getWest(),this.getNorth())},ja.prototype.getSouthEast=function(){return new Oo(this.getEast(),this.getSouth())},ja.prototype.getWest=function(){return this._sw.lng},ja.prototype.getSouth=function(){return this._sw.lat},ja.prototype.getEast=function(){return this._ne.lng},ja.prototype.getNorth=function(){return this._ne.lat},ja.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ja.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ja.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ja.prototype.contains=function(n){var o=Oo.convert(n),s=o.lng,p=o.lat,g=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g},ja.convert=function(n){return!n||n instanceof ja?n:new ja(n)};var Oo=function(n,o){if(isNaN(n)||isNaN(o))throw new Error("Invalid LngLat object: ("+n+", "+o+")");if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Oo.prototype.wrap=function(){return new Oo(Yt(this.lng,-180,180),this.lat)},Oo.prototype.toArray=function(){return[this.lng,this.lat]},Oo.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Oo.prototype.distanceTo=function(n){var o=Math.PI/180,s=this.lat*o,p=n.lat*o,g=Math.sin(s)*Math.sin(p)+Math.cos(s)*Math.cos(p)*Math.cos((n.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(g,1))},Oo.prototype.toBounds=function(n){n===void 0&&(n=0);var o=360*n/40075017,s=o/Math.cos(Math.PI/180*this.lat);return new ja(new Oo(this.lng-s,this.lat-o),new Oo(this.lng+s,this.lat+o))},Oo.convert=function(n){if(n instanceof Oo)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Oo(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Oo(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var am=2*Math.PI*63710088e-1;function sm(n){return am*Math.cos(n*Math.PI/180)}function gv(n){return(180+n)/360}function Xt(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function _v(n,o){return n/sm(o)}function ud(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}var kl=function(n,o,s){s===void 0&&(s=0),this.x=+n,this.y=+o,this.z=+s};kl.fromLngLat=function(n,o){o===void 0&&(o=0);var s=Oo.convert(n);return new kl(gv(s.lng),Xt(s.lat),_v(o,s.lat))},kl.prototype.toLngLat=function(){return new Oo(360*this.x-180,ud(this.y))},kl.prototype.toAltitude=function(){return this.z*sm(ud(this.y))},kl.prototype.meterInMercatorCoordinateUnits=function(){return 1/am*(n=ud(this.y),1/Math.cos(n*Math.PI/180));var n};var Yh=function(n,o,s){this.z=n,this.x=o,this.y=s,this.key=xp(0,n,n,o,s)};Yh.prototype.equals=function(n){return this.z===n.z&&this.x===n.x&&this.y===n.y},Yh.prototype.url=function(n,o){var s,p,g,y,E,w=(p=this.y,g=this.z,y=vv(256*(s=this.x),256*(p=Math.pow(2,g)-p-1),g),E=vv(256*(s+1),256*(p+1),g),y[0]+","+y[1]+","+E[0]+","+E[1]),M=function(L,k,Z){for(var q,te="",ye=L;ye>0;ye--)te+=(k&(q=1<<ye-1)?1:0)+(Z&q?2:0);return te}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",M).replace("{bbox-epsg-3857}",w)},Yh.prototype.getTilePoint=function(n){var o=Math.pow(2,this.z);return new Oe(8192*(n.x*o-this.x),8192*(n.y*o-this.y))},Yh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var po=function(n,o){this.wrap=n,this.canonical=o,this.key=xp(n,o.z,o.z,o.x,o.y)},Ia=function(n,o,s,p,g){this.overscaledZ=n,this.wrap=o,this.canonical=new Yh(s,+p,+g),this.key=xp(o,n,s,p,g)};function xp(n,o,s,p,g){(n*=2)<0&&(n=-1*n-1);var y=1<<s;return(y*y*n+y*g+p).toString(36)+s.toString(36)+o.toString(36)}Ia.prototype.equals=function(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)},Ia.prototype.scaledTo=function(n){var o=this.canonical.z-n;return n>this.canonical.z?new Ia(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ia(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)},Ia.prototype.calculateScaledKey=function(n,o){var s=this.canonical.z-n;return n>this.canonical.z?xp(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y):xp(this.wrap*+o,n,n,this.canonical.x>>s,this.canonical.y>>s)},Ia.prototype.isChildOf=function(n){if(n.wrap!==this.wrap)return!1;var o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o},Ia.prototype.children=function(n){if(this.overscaledZ>=n)return[new Ia(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,s=2*this.canonical.x,p=2*this.canonical.y;return[new Ia(o,this.wrap,o,s,p),new Ia(o,this.wrap,o,s+1,p),new Ia(o,this.wrap,o,s,p+1),new Ia(o,this.wrap,o,s+1,p+1)]},Ia.prototype.isLessThan=function(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))},Ia.prototype.wrapped=function(){return new Ia(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Ia.prototype.unwrapTo=function(n){return new Ia(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)},Ia.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Ia.prototype.toUnwrapped=function(){return new po(this.wrap,this.canonical)},Ia.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Ia.prototype.getTilePoint=function(n){return this.canonical.getTilePoint(new kl(n.x-this.wrap,n.y))},Hr("CanonicalTileID",Yh),Hr("OverscaledTileID",Ia,{omit:["posMatrix"]});var Wc=function(n,o,s){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return tt('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=s||"mapbox";for(var g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};Wc.prototype.get=function(n,o){var s=new Uint8Array(this.data.buffer),p=4*this._idx(n,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[p],s[p+1],s[p+2])},Wc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Wc.prototype._idx=function(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)},Wc.prototype._unpackMapbox=function(n,o,s){return(256*n*256+256*o+s)/10-1e4},Wc.prototype._unpackTerrarium=function(n,o,s){return 256*n+o+s/256-32768},Wc.prototype.getPixels=function(){return new rs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Wc.prototype.backfillBorder=function(n,o,s){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,g=o*this.dim+this.dim,y=s*this.dim,E=s*this.dim+this.dim;switch(o){case-1:p=g-1;break;case 1:g=p+1}switch(s){case-1:y=E-1;break;case 1:E=y+1}for(var w=-o*this.dim,M=-s*this.dim,L=y;L<E;L++)for(var k=p;k<g;k++)this.data[this._idx(k,L)]=n.data[this._idx(k+w,L+M)]},Hr("DEMData",Wc);var ld=function(n){this._stringToNumber={},this._numberToString=[];for(var o=0;o<n.length;o++){var s=n[o];this._stringToNumber[s]=o,this._numberToString[o]=s}};ld.prototype.encode=function(n){return this._stringToNumber[n]},ld.prototype.decode=function(n){return this._numberToString[n]};var cd=function(n,o,s,p,g){this.type="Feature",this._vectorTileFeature=n,n._z=o,n._x=s,n._y=p,this.properties=n.properties,this.id=g},yv={geometry:{configurable:!0}};yv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},yv.geometry.set=function(n){this._geometry=n},cd.prototype.toJSON=function(){var n={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(n[o]=this[o]);return n},Object.defineProperties(cd.prototype,yv);var Df=function(){this.state={},this.stateChanges={},this.deletedStates={}};Df.prototype.updateState=function(n,o,s){var p=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][p]=this.stateChanges[n][p]||{},ir(this.stateChanges[n][p],s),this.deletedStates[n]===null)for(var g in this.deletedStates[n]={},this.state[n])g!==p&&(this.deletedStates[n][g]=null);else if(this.deletedStates[n]&&this.deletedStates[n][p]===null)for(var y in this.deletedStates[n][p]={},this.state[n][p])s[y]||(this.deletedStates[n][p][y]=null);else for(var E in s)this.deletedStates[n]&&this.deletedStates[n][p]&&this.deletedStates[n][p][E]===null&&delete this.deletedStates[n][p][E]},Df.prototype.removeFeatureState=function(n,o,s){if(this.deletedStates[n]!==null){var p=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},s&&o!==void 0)this.deletedStates[n][p]!==null&&(this.deletedStates[n][p]=this.deletedStates[n][p]||{},this.deletedStates[n][p][s]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][p])for(s in this.deletedStates[n][p]={},this.stateChanges[n][p])this.deletedStates[n][p][s]=null;else this.deletedStates[n][p]=null;else this.deletedStates[n]=null}},Df.prototype.getState=function(n,o){var s=String(o),p=ir({},(this.state[n]||{})[s],(this.stateChanges[n]||{})[s]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){var g=this.deletedStates[n][o];if(g===null)return{};for(var y in g)delete p[y]}return p},Df.prototype.initializeTileState=function(n,o){n.setFeatureState(this.state,o)},Df.prototype.coalesceChanges=function(n,o){var s={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var g={};for(var y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),ir(this.state[p][y],this.stateChanges[p][y]),g[y]=this.state[p][y];s[p]=g}for(var E in this.deletedStates){this.state[E]=this.state[E]||{};var w={};if(this.deletedStates[E]===null)for(var M in this.state[E])w[M]={},this.state[E][M]={};else for(var L in this.deletedStates[E]){if(this.deletedStates[E][L]===null)this.state[E][L]={};else for(var k=0,Z=Object.keys(this.deletedStates[E][L]);k<Z.length;k+=1)delete this.state[E][L][Z[k]];w[L]=this.state[E][L]}s[E]=s[E]||{},ir(s[E],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var q in n)n[q].setFeatureState(s,o)};var Gc=function(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Wo(8192,16,0),this.grid3D=new Wo(8192,16,0),this.featureIndexArray=new j,this.promoteId=o};function xv(n,o,s,p,g){return Yn(n,function(y,E){var w=o instanceof rc?o.get(E):null;return w&&w.evaluate?w.evaluate(s,p,g):w})}function bv(n){for(var o=1/0,s=1/0,p=-1/0,g=-1/0,y=0,E=n;y<E.length;y+=1){var w=E[y];o=Math.min(o,w.x),s=Math.min(s,w.y),p=Math.max(p,w.x),g=Math.max(g,w.y)}return{minX:o,minY:s,maxX:p,maxY:g}}function Wg(n,o){return o-n}Gc.prototype.insert=function(n,o,s,p,g,y){var E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,p,g);for(var w=y?this.grid3D:this.grid,M=0;M<o.length;M++){for(var L=o[M],k=[1/0,1/0,-1/0,-1/0],Z=0;Z<L.length;Z++){var q=L[Z];k[0]=Math.min(k[0],q.x),k[1]=Math.min(k[1],q.y),k[2]=Math.max(k[2],q.x),k[3]=Math.max(k[3],q.y)}k[0]<8192&&k[1]<8192&&k[2]>=0&&k[3]>=0&&w.insert(E,k[0],k[1],k[2],k[3])}},Gc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Nl.VectorTile(new Ct(this.rawTileData)).layers,this.sourceLayerCoder=new ld(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Gc.prototype.query=function(n,o,s,p){var g=this;this.loadVTLayers();for(var y=n.params||{},E=8192/n.tileSize/n.scale,w=wl(y.filter),M=n.queryGeometry,L=n.queryPadding*E,k=bv(M),Z=this.grid.query(k.minX-L,k.minY-L,k.maxX+L,k.maxY+L),q=bv(n.cameraQueryGeometry),te=this.grid3D.query(q.minX-L,q.minY-L,q.maxX+L,q.maxY+L,function(Pt,Ut,er,Ar){return function(Nr,yn,en,En,tn){for(var si=0,kn=Nr;si<kn.length;si+=1){var hn=kn[si];if(yn<=hn.x&&en<=hn.y&&En>=hn.x&&tn>=hn.y)return!0}var hi=[new Oe(yn,en),new Oe(yn,tn),new Oe(En,tn),new Oe(En,en)];if(Nr.length>2){for(var Bn=0,Ci=hi;Bn<Ci.length;Bn+=1)if(pu(Nr,Ci[Bn]))return!0}for(var Sn=0;Sn<Nr.length-1;Sn++)if(pl(Nr[Sn],Nr[Sn+1],hi))return!0;return!1}(n.cameraQueryGeometry,Pt-L,Ut-L,er+L,Ar+L)}),ye=0,Te=te;ye<Te.length;ye+=1)Z.push(Te[ye]);Z.sort(Wg);for(var Ge,Le={},nt=function(Pt){var Ut=Z[Pt];if(Ut!==Ge){Ge=Ut;var er=g.featureIndexArray.get(Ut),Ar=null;g.loadMatchingFeature(Le,er.bucketIndex,er.sourceLayerIndex,er.featureIndex,w,y.layers,y.availableImages,o,s,p,function(Nr,yn,en){return Ar||(Ar=To(Nr)),yn.queryIntersectsFeature(M,Nr,en,Ar,g.z,n.transform,E,n.pixelPosMatrix)})}},ft=0;ft<Z.length;ft++)nt(ft);return Le},Gc.prototype.loadMatchingFeature=function(n,o,s,p,g,y,E,w,M,L,k){var Z=this.bucketLayerIDs[o];if(!y||function(Nr,yn){for(var en=0;en<Nr.length;en++)if(yn.indexOf(Nr[en])>=0)return!0;return!1}(y,Z)){var q=this.sourceLayerCoder.decode(s),te=this.vtLayers[q].feature(p);if(g.needGeometry){var ye=Ao(te,!0);if(!g.filter(new $n(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!g.filter(new $n(this.tileID.overscaledZ),te))return;for(var Te=this.getId(te,q),Ge=0;Ge<Z.length;Ge++){var Le=Z[Ge];if(!(y&&y.indexOf(Le)<0)){var nt=w[Le];if(nt){var ft={};Te!==void 0&&L&&(ft=L.getState(nt.sourceLayer||"_geojsonTileLayer",Te));var Pt=ir({},M[Le]);Pt.paint=xv(Pt.paint,nt.paint,te,ft,E),Pt.layout=xv(Pt.layout,nt.layout,te,ft,E);var Ut=!k||k(te,nt,ft);if(Ut){var er=new cd(te,this.z,this.x,this.y,Te);er.layer=Pt;var Ar=n[Le];Ar===void 0&&(Ar=n[Le]=[]),Ar.push({featureIndex:p,feature:er,intersectionZ:Ut})}}}}}},Gc.prototype.lookupSymbolFeatures=function(n,o,s,p,g,y,E,w){var M={};this.loadVTLayers();for(var L=wl(g),k=0,Z=n;k<Z.length;k+=1)this.loadMatchingFeature(M,s,p,Z[k],L,y,E,w,o);return M},Gc.prototype.hasLayer=function(n){for(var o=0,s=this.bucketLayerIDs;o<s.length;o+=1)for(var p=0,g=s[o];p<g.length;p+=1)if(n===g[p])return!0;return!1},Gc.prototype.getId=function(n,o){var s=n.id;return this.promoteId&&typeof(s=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(s=Number(s)),s},Hr("FeatureIndex",Gc,{omit:["rawTileData","sourceLayerCoder"]});var ra=function(n,o){this.tileID=n,this.uid=Sr(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ra.prototype.registerFadeDuration=function(n){var o=n+this.timeAdded;o<On.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},ra.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ra.prototype.loadVectorData=function(n,o,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){for(var p in n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(L,k){var Z={};if(!k)return Z;for(var q=function(){var Te=ye[te],Ge=Te.layerIds.map(function(ft){return k.getLayer(ft)}).filter(Boolean);if(Ge.length!==0){Te.layers=Ge,Te.stateDependentLayerIds&&(Te.stateDependentLayers=Te.stateDependentLayerIds.map(function(ft){return Ge.filter(function(Pt){return Pt.id===ft})[0]}));for(var Le=0,nt=Ge;Le<nt.length;Le+=1)Z[nt[Le].id]=Te}},te=0,ye=L;te<ye.length;te+=1)q();return Z}(n.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var g=this.buckets[p];if(g instanceof Ot){if(this.hasSymbolBuckets=!0,!s)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var y in this.buckets){var E=this.buckets[y];if(E instanceof Ot&&E.hasRTLText){this.hasRTLText=!0,$s.isLoading()||$s.isLoaded()||Ef()!=="deferred"||ws();break}}for(var w in this.queryPadding=0,this.buckets){var M=this.buckets[w];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(w).queryRadius(M))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new h},ra.prototype.unloadVectorData=function(){for(var n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ra.prototype.getBucket=function(n){return this.buckets[n.id]},ra.prototype.upload=function(n){for(var o in this.buckets){var s=this.buckets[o];s.uploadPending()&&s.upload(n)}var p=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new bh(n,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new bh(n,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},ra.prototype.prepare=function(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)},ra.prototype.queryRenderedFeatures=function(n,o,s,p,g,y,E,w,M,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:y,tileSize:this.tileSize,pixelPosMatrix:L,transform:w,params:E,queryPadding:this.queryPadding*M},n,o,s):{}},ra.prototype.querySourceFeatures=function(n,o){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var p=s.loadVTLayers(),g=o?o.sourceLayer:"",y=p._geojsonTileLayer||p[g];if(y)for(var E=wl(o&&o.filter),w=this.tileID.canonical,M=w.z,L=w.x,k=w.y,Z={z:M,x:L,y:k},q=0;q<y.length;q++){var te=y.feature(q);if(E.needGeometry){var ye=Ao(te,!0);if(!E.filter(new $n(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!E.filter(new $n(this.tileID.overscaledZ),te))continue;var Te=s.getId(te,g),Ge=new cd(te,M,L,k,Te);Ge.tile=Z,n.push(Ge)}}},ra.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ra.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ra.prototype.setExpiryData=function(n){var o=this.expirationTime;if(n.cacheControl){var s=me(n.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){var p=Date.now(),g=!1;if(this.expirationTime>p)g=!1;else if(o)if(this.expirationTime<o)g=!0;else{var y=this.expirationTime-o;y?this.expirationTime=p+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ra.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ra.prototype.setFeatureState=function(n,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var g=this.buckets[p],y=g.layers[0].sourceLayer||"_geojsonTileLayer",E=s[y],w=n[y];if(E&&w&&Object.keys(w).length!==0){g.update(w,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});var M=o&&o.style&&o.style.getLayer(p);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(g)))}}}},ra.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ra.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<On.now()},ra.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ra.prototype.setHoldDuration=function(n){this.symbolFadeHoldUntil=On.now()+n},ra.prototype.setDependencies=function(n,o){for(var s={},p=0,g=o;p<g.length;p+=1)s[g[p]]=!0;this.dependencies[n]=s},ra.prototype.hasDependency=function(n,o){for(var s=0,p=n;s<p.length;s+=1){var g=this.dependencies[p[s]];if(g){for(var y=0,E=o;y<E.length;y+=1)if(g[E[y]])return!0}}return!1};var hc=Re.performance,Ev=function(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},hc.mark(this._marks.start)};Ev.prototype.finish=function(){hc.mark(this._marks.end);var n=hc.getEntriesByName(this._marks.measure);return n.length===0&&(hc.measure(this._marks.measure,this._marks.start,this._marks.end),n=hc.getEntriesByName(this._marks.measure),hc.clearMarks(this._marks.start),hc.clearMarks(this._marks.end),hc.clearMeasures(this._marks.measure)),n},v.Actor=Gh,v.AlphaImage=Pl,v.CanonicalTileID=Yh,v.CollisionBoxArray=h,v.Color=oi,v.DEMData=Wc,v.DataConstantProperty=bn,v.DictionaryCoder=ld,v.EXTENT=8192,v.ErrorEvent=Se,v.EvaluationParameters=$n,v.Event=ce,v.Evented=Ue,v.FeatureIndex=Gc,v.FillBucket=Gu,v.FillExtrusionBucket=ns,v.ImageAtlas=_e,v.ImagePosition=Zr,v.LineBucket=is,v.LngLat=Oo,v.LngLatBounds=ja,v.MercatorCoordinate=kl,v.ONE_EM=24,v.OverscaledTileID=Ia,v.Point=Oe,v.Point$1=Oe,v.Properties=xo,v.Protobuf=Ct,v.RGBAImage=rs,v.RequestManager=Ur,v.RequestPerformance=Ev,v.ResourceType=K,v.SegmentVector=oe,v.SourceFeatureState=Df,v.StructArrayLayout1ui2=jh,v.StructArrayLayout2f1f2i16=ka,v.StructArrayLayout2i4=ul,v.StructArrayLayout3ui6=hu,v.StructArrayLayout4i8=Lc,v.SymbolBucket=Ot,v.Texture=bh,v.Tile=ra,v.Transitionable=da,v.Uniform1f=Ir,v.Uniform1i=ar,v.Uniform2f=Tr,v.Uniform3f=Qr,v.Uniform4f=mn,v.UniformColor=Cn,v.UniformMatrix4f=wi,v.UnwrappedTileID=po,v.ValidationError=ve,v.WritingMode=D,v.ZoomHistory=ec,v.add=function(n,o,s){return n[0]=o[0]+s[0],n[1]=o[1]+s[1],n[2]=o[2]+s[2],n},v.addDynamicAttributes=hr,v.asyncAll=function(n,o,s){if(!n.length)return s(null,[]);var p=n.length,g=new Array(n.length),y=null;n.forEach(function(E,w){o(E,function(M,L){M&&(y=M),g[w]=L,--p==0&&s(y,g)})})},v.bezier=ct,v.bindAll=vn,v.browser=On,v.cacheEntryPossiblyAdded=function(n){++ot>_u&&(n.getActor().send("enforceCacheSizeLimit",Ws),ot=0)},v.clamp=qt,v.clearTileCache=function(n){var o=Re.caches.delete("mapbox-tiles");n&&o.catch(n).then(function(){return n()})},v.clipLine=Yu,v.clone=function(n){var o=new pi(16);return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},v.clone$1=Pe,v.clone$2=function(n){var o=new pi(3);return o[0]=n[0],o[1]=n[1],o[2]=n[2],o},v.collisionCircleLayout=F,v.config=Xr,v.create=function(){var n=new pi(16);return pi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},v.create$1=function(){var n=new pi(9);return pi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},v.create$2=function(){var n=new pi(4);return pi!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},v.createCommonjsModule=at,v.createExpression=Al,v.createLayout=ma,v.createStyleLayer=function(n){return n.type==="custom"?new ad(n):new Ul[n.type](n)},v.cross=function(n,o,s){var p=o[0],g=o[1],y=o[2],E=s[0],w=s[1],M=s[2];return n[0]=g*M-y*w,n[1]=y*E-p*M,n[2]=p*w-g*E,n},v.deepEqual=function n(o,s){if(Array.isArray(o)){if(!Array.isArray(s)||o.length!==s.length)return!1;for(var p=0;p<o.length;p++)if(!n(o[p],s[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&s!==null){if(typeof s!="object"||Object.keys(o).length!==Object.keys(s).length)return!1;for(var g in o)if(!n(o[g],s[g]))return!1;return!0}return o===s},v.dot=function(n,o){return n[0]*o[0]+n[1]*o[1]+n[2]*o[2]},v.dot$1=function(n,o){return n[0]*o[0]+n[1]*o[1]+n[2]*o[2]+n[3]*o[3]},v.ease=st,v.emitValidationErrors=Zu,v.endsWith=ii,v.enforceCacheSizeLimit=function(n){Do(),Wi&&Wi.then(function(o){o.keys().then(function(s){for(var p=0;p<s.length-n;p++)o.delete(s[p])})})},v.evaluateSizeForFeature=os,v.evaluateSizeForZoom=Ra,v.evaluateVariableOffset=Ye,v.evented=zh,v.extend=ir,v.featureFilter=wl,v.filterObject=xt,v.fromRotation=function(n,o){var s=Math.sin(o),p=Math.cos(o);return n[0]=p,n[1]=s,n[2]=0,n[3]=-s,n[4]=p,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},v.getAnchorAlignment=oo,v.getAnchorJustification=Qe,v.getArrayBuffer=sr,v.getImage=P,v.getJSON=function(n,o){return Bt(ir(n,{type:"json"}),o)},v.getRTLTextPluginStatus=Ef,v.getReferrer=Fe,v.getVideo=function(n,o){var s,p,g=Re.document.createElement("video");g.muted=!0,g.onloadstart=function(){o(null,g)};for(var y=0;y<n.length;y++){var E=Re.document.createElement("source");s=n[y],p=void 0,(p=Re.document.createElement("a")).href=s,(p.protocol!==Re.document.location.protocol||p.host!==Re.document.location.host)&&(g.crossOrigin="Anonymous"),E.src=n[y],g.appendChild(E)}return{cancel:function(){}}},v.identity=Ca,v.invert=function(n,o){var s=o[0],p=o[1],g=o[2],y=o[3],E=o[4],w=o[5],M=o[6],L=o[7],k=o[8],Z=o[9],q=o[10],te=o[11],ye=o[12],Te=o[13],Ge=o[14],Le=o[15],nt=s*w-p*E,ft=s*M-g*E,Pt=s*L-y*E,Ut=p*M-g*w,er=p*L-y*w,Ar=g*L-y*M,Nr=k*Te-Z*ye,yn=k*Ge-q*ye,en=k*Le-te*ye,En=Z*Ge-q*Te,tn=Z*Le-te*Te,si=q*Le-te*Ge,kn=nt*si-ft*tn+Pt*En+Ut*en-er*yn+Ar*Nr;return kn?(n[0]=(w*si-M*tn+L*En)*(kn=1/kn),n[1]=(g*tn-p*si-y*En)*kn,n[2]=(Te*Ar-Ge*er+Le*Ut)*kn,n[3]=(q*er-Z*Ar-te*Ut)*kn,n[4]=(M*en-E*si-L*yn)*kn,n[5]=(s*si-g*en+y*yn)*kn,n[6]=(Ge*Pt-ye*Ar-Le*ft)*kn,n[7]=(k*Ar-q*Pt+te*ft)*kn,n[8]=(E*tn-w*en+L*Nr)*kn,n[9]=(p*en-s*tn-y*Nr)*kn,n[10]=(ye*er-Te*Pt+Le*nt)*kn,n[11]=(Z*Pt-k*er-te*nt)*kn,n[12]=(w*yn-E*En-M*Nr)*kn,n[13]=(s*En-p*yn+g*Nr)*kn,n[14]=(Te*ft-ye*Ut-Ge*nt)*kn,n[15]=(k*Ut-Z*ft+q*nt)*kn,n):null},v.isChar=zr,v.isMapboxURL=Mn,v.keysDifference=function(n,o){var s=[];for(var p in n)p in o||s.push(p);return s},v.makeRequest=Bt,v.mapObject=Yn,v.mercatorXfromLng=gv,v.mercatorYfromLat=Xt,v.mercatorZfromAltitude=_v,v.mul=Ol,v.multiply=Yo,v.mvt=Nl,v.nextPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},v.normalize=function(n,o){var s=o[0],p=o[1],g=o[2],y=s*s+p*p+g*g;return y>0&&(y=1/Math.sqrt(y)),n[0]=o[0]*y,n[1]=o[1]*y,n[2]=o[2]*y,n},v.number=Eo,v.offscreenCanvasSupported=z,v.ortho=function(n,o,s,p,g,y,E){var w=1/(o-s),M=1/(p-g),L=1/(y-E);return n[0]=-2*w,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*M,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*L,n[11]=0,n[12]=(o+s)*w,n[13]=(g+p)*M,n[14]=(E+y)*L,n[15]=1,n},v.parseGlyphPBF=function(n){return new Ct(n).readFields(lr,[])},v.pbf=Ct,v.performSymbolLayout=function(n,o,s,p,g,y,E){n.createArrays(),n.tilePixelRatio=8192/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;var w=n.layers[0].layout,M=n.layers[0]._unevaluatedLayout._values,L={};if(n.textSizeData.kind==="composite"){var k=n.textSizeData,Z=k.maxZoom;L.compositeTextSizes=[M["text-size"].possiblyEvaluate(new $n(k.minZoom),E),M["text-size"].possiblyEvaluate(new $n(Z),E)]}if(n.iconSizeData.kind==="composite"){var q=n.iconSizeData,te=q.maxZoom;L.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new $n(q.minZoom),E),M["icon-size"].possiblyEvaluate(new $n(te),E)]}L.layoutTextSize=M["text-size"].possiblyEvaluate(new $n(n.zoom+1),E),L.layoutIconSize=M["icon-size"].possiblyEvaluate(new $n(n.zoom+1),E),L.textMaxSize=M["text-size"].possiblyEvaluate(new $n(18));for(var ye=24*w.get("text-line-height"),Te=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point",Ge=w.get("text-keep-upright"),Le=w.get("text-size"),nt=function(){var Ut=Pt[ft],er=w.get("text-font").evaluate(Ut,{},E).join(","),Ar=Le.evaluate(Ut,{},E),Nr=L.layoutTextSize.evaluate(Ut,{},E),yn=L.layoutIconSize.evaluate(Ut,{},E),en={horizontal:{},vertical:void 0},En=Ut.text,tn=[0,0];if(En){var si=En.toString(),kn=24*w.get("text-letter-spacing").evaluate(Ut,{},E),hn=function(Ei){for(var ji=0,qi=Ei;ji<qi.length;ji+=1)if(Ri=qi[ji].charCodeAt(0),zr.Arabic(Ri)||zr["Arabic Supplement"](Ri)||zr["Arabic Extended-A"](Ri)||zr["Arabic Presentation Forms-A"](Ri)||zr["Arabic Presentation Forms-B"](Ri))return!1;var Ri;return!0}(si)?kn:0,hi=w.get("text-anchor").evaluate(Ut,{},E),Bn=w.get("text-variable-anchor");if(!Bn){var Ci=w.get("text-radial-offset").evaluate(Ut,{},E);tn=Ci?Ye(hi,[24*Ci,Xe]):w.get("text-offset").evaluate(Ut,{},E).map(function(Ei){return 24*Ei})}var Sn=Te?"center":w.get("text-justify").evaluate(Ut,{},E),bi=w.get("symbol-placement"),Po=bi==="point"?24*w.get("text-max-width").evaluate(Ut,{},E):0,na=function(){n.allowVerticalPlacement&&qs(si)&&(en.vertical=li(En,o,s,g,er,Po,ye,hi,"left",hn,tn,D.vertical,!0,bi,Nr,Ar))};if(!Te&&Bn){for(var Ko=Sn==="auto"?Bn.map(function(Ei){return Qe(Ei)}):[Sn],So=!1,$o=0;$o<Ko.length;$o++){var ia=Ko[$o];if(!en.horizontal[ia])if(So)en.horizontal[ia]=en.horizontal[0];else{var Ha=li(En,o,s,g,er,Po,ye,"center",ia,hn,tn,D.horizontal,!1,bi,Nr,Ar);Ha&&(en.horizontal[ia]=Ha,So=Ha.positionedLines.length===1)}}na()}else{Sn==="auto"&&(Sn=Qe(hi));var Os=li(En,o,s,g,er,Po,ye,hi,Sn,hn,tn,D.horizontal,!1,bi,Nr,Ar);Os&&(en.horizontal[Sn]=Os),na(),qs(si)&&Te&&Ge&&(en.vertical=li(En,o,s,g,er,Po,ye,hi,Sn,hn,tn,D.vertical,!1,bi,Nr,Ar))}}var qa=void 0,ms=!1;if(Ut.icon&&Ut.icon.name){var fa=p[Ut.icon.name];fa&&(qa=function(Ei,ji,qi){var Ri=oo(qi),vs=ji[0]-Ei.displaySize[0]*Ri.horizontalAlign,Ma=ji[1]-Ei.displaySize[1]*Ri.verticalAlign;return{image:Ei,top:Ma,bottom:Ma+Ei.displaySize[1],left:vs,right:vs+Ei.displaySize[0]}}(g[Ut.icon.name],w.get("icon-offset").evaluate(Ut,{},E),w.get("icon-anchor").evaluate(Ut,{},E)),ms=fa.sdf,n.sdfIcons===void 0?n.sdfIcons=fa.sdf:n.sdfIcons!==fa.sdf&&tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fa.pixelRatio!==n.pixelRatio||w.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}var Ka=We(en.horizontal)||en.vertical;n.iconsInText=!!Ka&&Ka.iconsInText,(Ka||qa)&&function(Ei,ji,qi,Ri,vs,Ma,vo,oa,Oa,Ui,Iu){var js=Ma.textMaxSize.evaluate(ji,{});js===void 0&&(js=vo);var gs,Qo=Ei.layers[0].layout,vl=Qo.get("icon-offset").evaluate(ji,{},Iu),gl=We(qi.horizontal),bp=vo/24,Yc=Ei.tilePixelRatio*bp,qh=Ei.tilePixelRatio*js/24,Eh=Ei.tilePixelRatio*oa,Kh=Ei.tilePixelRatio*Qo.get("symbol-spacing"),hd=Qo.get("text-padding")*Ei.tilePixelRatio,Bf=Qo.get("icon-padding")*Ei.tilePixelRatio,Ep=Qo.get("text-max-angle")/180*Math.PI,fd=Qo.get("text-rotation-alignment")==="map"&&Qo.get("symbol-placement")!=="point",pd=Qo.get("icon-rotation-alignment")==="map"&&Qo.get("symbol-placement")!=="point",qc=Qo.get("symbol-placement"),Tp=Kh/2,$h=Qo.get("icon-text-fit");Ri&&$h!=="none"&&(Ei.allowVerticalPlacement&&qi.vertical&&(gs=ya(Ri,qi.vertical,$h,Qo.get("icon-text-fit-padding"),vl,bp)),gl&&(Ri=ya(Ri,gl,$h,Qo.get("icon-text-fit-padding"),vl,bp)));var Th=function(Gg,Ip){Ip.x<0||Ip.x>=8192||Ip.y<0||Ip.y>=8192||function(Jo,zl,Yg,Sh,hm,Sv,_d,fc,yd,Mp,xd,bd,fm,wv,Op,Cv,Rv,Iv,Mv,Ov,Mu,Ed,Pv,pc,qg){var Lv,ef,Vf,tf,Zf,jf=Jo.addToLineVertexArray(zl,Yg),Hf=0,Pp=0,Ps=0,pm=0,dm=-1,mm=-1,Kc={},Dv=ge(""),Td=0,vm=0;if(fc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Td=(Lv=fc.layout.get("text-offset").evaluate(Mu,{},pc).map(function(Wf){return 24*Wf}))[0],vm=Lv[1]):(Td=24*fc.layout.get("text-radial-offset").evaluate(Mu,{},pc),vm=Xe),Jo.allowVerticalPlacement&&Sh.vertical){var Bv=fc.layout.get("text-rotate").evaluate(Mu,{},pc)+90;tf=new ao(yd,zl,Mp,xd,bd,Sh.vertical,fm,wv,Op,Bv),_d&&(Zf=new ao(yd,zl,Mp,xd,bd,_d,Rv,Iv,Op,Bv))}if(hm){var gm=fc.layout.get("icon-rotate").evaluate(Mu,{}),_m=fc.layout.get("icon-text-fit")!=="none",Fv=Ae(hm,gm,Pv,_m),ym=_d?Ae(_d,gm,Pv,_m):void 0;Vf=new ao(yd,zl,Mp,xd,bd,hm,Rv,Iv,!1,gm),Hf=4*Fv.length;var xm=Jo.iconSizeData,Xf=null;xm.kind==="source"?(Xf=[128*fc.layout.get("icon-size").evaluate(Mu,{})])[0]>32640&&tt(Jo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):xm.kind==="composite"&&((Xf=[128*Ed.compositeIconSizes[0].evaluate(Mu,{},pc),128*Ed.compositeIconSizes[1].evaluate(Mu,{},pc)])[0]>32640||Xf[1]>32640)&&tt(Jo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Jo.addSymbols(Jo.icon,Fv,Xf,Ov,Mv,Mu,!1,zl,jf.lineStartIndex,jf.lineLength,-1,pc),dm=Jo.icon.placedSymbolArray.length-1,ym&&(Pp=4*ym.length,Jo.addSymbols(Jo.icon,ym,Xf,Ov,Mv,Mu,D.vertical,zl,jf.lineStartIndex,jf.lineLength,-1,pc),mm=Jo.icon.placedSymbolArray.length-1)}for(var bm in Sh.horizontal){var Lp=Sh.horizontal[bm];if(!ef){Dv=ge(Lp.text);var Kg=fc.layout.get("text-rotate").evaluate(Mu,{},pc);ef=new ao(yd,zl,Mp,xd,bd,Lp,fm,wv,Op,Kg)}var Nv=Lp.positionedLines.length===1;if(Ps+=Ee(Jo,zl,Lp,Sv,fc,Op,Mu,Cv,jf,Sh.vertical?D.horizontal:D.horizontalOnly,Nv?Object.keys(Sh.horizontal):[bm],Kc,dm,Ed,pc),Nv)break}Sh.vertical&&(pm+=Ee(Jo,zl,Sh.vertical,Sv,fc,Op,Mu,Cv,jf,D.vertical,["vertical"],Kc,mm,Ed,pc));var $g=ef?ef.boxStartIndex:Jo.collisionBoxArray.length,Qg=ef?ef.boxEndIndex:Jo.collisionBoxArray.length,Jg=tf?tf.boxStartIndex:Jo.collisionBoxArray.length,Uv=tf?tf.boxEndIndex:Jo.collisionBoxArray.length,e_=Vf?Vf.boxStartIndex:Jo.collisionBoxArray.length,t_=Vf?Vf.boxEndIndex:Jo.collisionBoxArray.length,kv=Zf?Zf.boxStartIndex:Jo.collisionBoxArray.length,Ad=Zf?Zf.boxEndIndex:Jo.collisionBoxArray.length,Vl=-1,Dp=function(Wf,Em){return Wf&&Wf.circleDiameter?Math.max(Wf.circleDiameter,Em):Em};Vl=Dp(ef,Vl),Vl=Dp(tf,Vl),Vl=Dp(Vf,Vl);var zv=(Vl=Dp(Zf,Vl))>-1?1:0;zv&&(Vl*=qg/24),Jo.glyphOffsetArray.length>=Ot.MAX_GLYPHS&&tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Mu.sortKey!==void 0&&Jo.addToSortKeyRanges(Jo.symbolInstances.length,Mu.sortKey),Jo.symbolInstances.emplaceBack(zl.x,zl.y,Kc.right>=0?Kc.right:-1,Kc.center>=0?Kc.center:-1,Kc.left>=0?Kc.left:-1,Kc.vertical||-1,dm,mm,Dv,$g,Qg,Jg,Uv,e_,t_,kv,Ad,Mp,Ps,pm,Hf,Pp,zv,0,fm,Td,vm,Vl)}(Ei,Ip,Gg,qi,Ri,vs,gs,Ei.layers[0],Ei.collisionBoxArray,ji.index,ji.sourceLayerIndex,Ei.index,Yc,hd,fd,Oa,Eh,Bf,pd,vl,ji,Ma,Ui,Iu,vo)};if(qc==="line")for(var Ff=0,dd=Yu(ji.geometry,0,0,8192,8192);Ff<dd.length;Ff+=1)for(var md=dd[Ff],Ap=0,Nf=ba(md,Kh,Ep,qi.vertical||gl,Ri,24,qh,Ei.overscaling,8192);Ap<Nf.length;Ap+=1){var vd=Nf[Ap];gl&&ue(Ei,gl.text,Tp,vd)||Th(md,vd)}else if(qc==="line-center")for(var Uf=0,Sp=ji.geometry;Uf<Sp.length;Uf+=1){var kf=Sp[Uf];if(kf.length>1){var gd=Ni(kf,Ep,qi.vertical||gl,Ri,24,qh);gd&&Th(kf,gd)}}else if(ji.type==="Polygon")for(var Qh=0,wp=If(ji.geometry,0);Qh<wp.length;Qh+=1){var zf=wp[Qh],Cp=Be(zf,16);Th(zf[0],new qo(Cp.x,Cp.y,0))}else if(ji.type==="LineString")for(var Jh=0,Rp=ji.geometry;Jh<Rp.length;Jh+=1){var Ah=Rp[Jh];Th(Ah,new qo(Ah[0].x,Ah[0].y,0))}else if(ji.type==="Point")for(var um=0,Tv=ji.geometry;um<Tv.length;um+=1)for(var lm=0,Av=Tv[um];lm<Av.length;lm+=1){var cm=Av[lm];Th([cm],new qo(cm.x,cm.y,0))}}(n,Ut,en,qa,p,L,Nr,yn,tn,ms,E)},ft=0,Pt=n.features;ft<Pt.length;ft+=1)nt();y&&n.generateCollisionDebugBuffers()},v.perspective=function(n,o,s,p,g){var y,E=1/Math.tan(o/2);return n[0]=E/s,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=E,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,g!=null&&g!==1/0?(n[10]=(g+p)*(y=1/(p-g)),n[14]=2*g*p*y):(n[10]=-1,n[14]=-2*p),n},v.pick=function(n,o){for(var s={},p=0;p<o.length;p++){var g=o[p];g in n&&(s[g]=n[g])}return s},v.plugin=$s,v.polygonIntersectsPolygon=fu,v.postMapLoadEvent=Vo,v.postTurnstileEvent=ea,v.potpack=Gn,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=Hr,v.registerForPluginStateChange=function(n){return n({pluginStatus:hs,pluginURL:Ja}),zh.on("pluginStateChange",n),n},v.renderColorRamp=Af,v.rotate=function(n,o,s){var p=o[0],g=o[1],y=o[2],E=o[3],w=Math.sin(s),M=Math.cos(s);return n[0]=p*M+y*w,n[1]=g*M+E*w,n[2]=p*-w+y*M,n[3]=g*-w+E*M,n},v.rotateX=function(n,o,s){var p=Math.sin(s),g=Math.cos(s),y=o[4],E=o[5],w=o[6],M=o[7],L=o[8],k=o[9],Z=o[10],q=o[11];return o!==n&&(n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15]),n[4]=y*g+L*p,n[5]=E*g+k*p,n[6]=w*g+Z*p,n[7]=M*g+q*p,n[8]=L*g-y*p,n[9]=k*g-E*p,n[10]=Z*g-w*p,n[11]=q*g-M*p,n},v.rotateZ=function(n,o,s){var p=Math.sin(s),g=Math.cos(s),y=o[0],E=o[1],w=o[2],M=o[3],L=o[4],k=o[5],Z=o[6],q=o[7];return o!==n&&(n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15]),n[0]=y*g+L*p,n[1]=E*g+k*p,n[2]=w*g+Z*p,n[3]=M*g+q*p,n[4]=L*g-y*p,n[5]=k*g-E*p,n[6]=Z*g-w*p,n[7]=q*g-M*p,n},v.scale=function(n,o,s){var p=s[0],g=s[1],y=s[2];return n[0]=o[0]*p,n[1]=o[1]*p,n[2]=o[2]*p,n[3]=o[3]*p,n[4]=o[4]*g,n[5]=o[5]*g,n[6]=o[6]*g,n[7]=o[7]*g,n[8]=o[8]*y,n[9]=o[9]*y,n[10]=o[10]*y,n[11]=o[11]*y,n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},v.scale$1=function(n,o,s){return n[0]=o[0]*s,n[1]=o[1]*s,n[2]=o[2]*s,n[3]=o[3]*s,n},v.scale$2=function(n,o,s){return n[0]=o[0]*s,n[1]=o[1]*s,n[2]=o[2]*s,n},v.setCacheLimits=function(n,o){Ws=n,_u=o},v.setRTLTextPlugin=function(n,o,s){if(s===void 0&&(s=!1),hs==="deferred"||hs==="loading"||hs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ja=On.resolveURL(n),hs="deferred",fh=o,tc(),s||ws()},v.sphericalToCartesian=function(n){var o=n[0],s=n[1],p=n[2];return s+=90,s*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(s)*Math.sin(p),y:o*Math.sin(s)*Math.sin(p),z:o*Math.cos(p)}},v.sqrLen=function(n){var o=n[0],s=n[1];return o*o+s*s},v.styleSpec=Q,v.sub=function(n,o,s){return n[0]=o[0]-s[0],n[1]=o[1]-s[1],n[2]=o[2]-s[2],n},v.symbolSize=ai,v.transformMat3=function(n,o,s){var p=o[0],g=o[1],y=o[2];return n[0]=p*s[0]+g*s[3]+y*s[6],n[1]=p*s[1]+g*s[4]+y*s[7],n[2]=p*s[2]+g*s[5]+y*s[8],n},v.transformMat4=Xu,v.translate=function(n,o,s){var p,g,y,E,w,M,L,k,Z,q,te,ye,Te=s[0],Ge=s[1],Le=s[2];return o===n?(n[12]=o[0]*Te+o[4]*Ge+o[8]*Le+o[12],n[13]=o[1]*Te+o[5]*Ge+o[9]*Le+o[13],n[14]=o[2]*Te+o[6]*Ge+o[10]*Le+o[14],n[15]=o[3]*Te+o[7]*Ge+o[11]*Le+o[15]):(g=o[1],y=o[2],E=o[3],w=o[4],M=o[5],L=o[6],k=o[7],Z=o[8],q=o[9],te=o[10],ye=o[11],n[0]=p=o[0],n[1]=g,n[2]=y,n[3]=E,n[4]=w,n[5]=M,n[6]=L,n[7]=k,n[8]=Z,n[9]=q,n[10]=te,n[11]=ye,n[12]=p*Te+w*Ge+Z*Le+o[12],n[13]=g*Te+M*Ge+q*Le+o[13],n[14]=y*Te+L*Ge+te*Le+o[14],n[15]=E*Te+k*Ge+ye*Le+o[15]),n},v.triggerPluginCompletionEvent=bf,v.uniqueId=Sr,v.validateCustomStyleLayer=function(n){var o=[],s=n.id;return s===void 0&&o.push({message:"layers."+s+': missing required property "id"'}),n.render===void 0&&o.push({message:"layers."+s+': missing required method "render"'}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&o.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),o},v.validateLight=xf,v.validateStyle=Rc,v.values=function(n){var o=[];for(var s in n)o.push(n[s]);return o},v.vectorTile=Nl,v.version="1.13.3",v.warnOnce=tt,v.webpSupported=xn,v.window=Re,v.wrap=Yt}),qe(["./shared"],function(v){"use strict";function at(B){var P=typeof B;if(P==="number"||P==="boolean"||P==="string"||B==null)return JSON.stringify(B);if(Array.isArray(B)){for(var V="[",Y=0,ce=B;Y<ce.length;Y+=1)V+=at(ce[Y])+",";return V+"]"}for(var Se=Object.keys(B).sort(),Ue="{",Q=0;Q<Se.length;Q++)Ue+=JSON.stringify(Se[Q])+":"+at(B[Se[Q]])+",";return Ue+"}"}function G(B){for(var P="",V=0,Y=v.refProperties;V<Y.length;V+=1)P+="/"+at(B[Y[V]]);return P}var Je=function(B){this.keyCache={},B&&this.replace(B)};Je.prototype.replace=function(B){this._layerConfigs={},this._layers={},this.update(B,[])},Je.prototype.update=function(B,P){for(var V=this,Y=0,ce=B;Y<ce.length;Y+=1){var Se=ce[Y];this._layerConfigs[Se.id]=Se;var Ue=this._layers[Se.id]=v.createStyleLayer(Se);Ue._featureFilter=v.featureFilter(Ue.filter),this.keyCache[Se.id]&&delete this.keyCache[Se.id]}for(var Q=0,ve=P;Q<ve.length;Q+=1){var rt=ve[Q];delete this.keyCache[rt],delete this._layerConfigs[rt],delete this._layers[rt]}this.familiesBySource={};for(var wt=0,nr=function(Er,Rr){for(var zn={},jr=0;jr<Er.length;jr++){var qn=Rr&&Rr[Er[jr].id]||G(Er[jr]);Rr&&(Rr[Er[jr].id]=qn);var Li=zn[qn];Li||(Li=zn[qn]=[]),Li.push(Er[jr])}var ei=[];for(var Ai in zn)ei.push(zn[Ai]);return ei}(v.values(this._layerConfigs),this.keyCache);wt<nr.length;wt+=1){var _t=nr[wt].map(function(Er){return V._layers[Er.id]}),Qt=_t[0];if(Qt.visibility!=="none"){var Br=Qt.source||"",Fr=this.familiesBySource[Br];Fr||(Fr=this.familiesBySource[Br]={});var Mt=Qt.sourceLayer||"_geojsonTileLayer",Dr=Fr[Mt];Dr||(Dr=Fr[Mt]=[]),Dr.push(_t)}}};var Oe=function(B){var P={},V=[];for(var Y in B){var ce=B[Y],Se=P[Y]={};for(var Ue in ce){var Q=ce[+Ue];if(Q&&Q.bitmap.width!==0&&Q.bitmap.height!==0){var ve={x:0,y:0,w:Q.bitmap.width+2,h:Q.bitmap.height+2};V.push(ve),Se[Ue]={rect:ve,metrics:Q.metrics}}}}var rt=v.potpack(V),wt=new v.AlphaImage({width:rt.w||1,height:rt.h||1});for(var nr in B){var _t=B[nr];for(var Qt in _t){var Br=_t[+Qt];if(Br&&Br.bitmap.width!==0&&Br.bitmap.height!==0){var Fr=P[nr][Qt].rect;v.AlphaImage.copy(Br.bitmap,wt,{x:0,y:0},{x:Fr.x+1,y:Fr.y+1},Br.bitmap)}}}this.image=wt,this.positions=P};v.register("GlyphAtlas",Oe);var yt=function(B){this.tileID=new v.OverscaledTileID(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId};function Re(B,P,V){for(var Y=new v.EvaluationParameters(P),ce=0,Se=B;ce<Se.length;ce+=1)Se[ce].recalculate(Y,V)}function zt(B,P){var V=v.getArrayBuffer(B.request,function(Y,ce,Se,Ue){Y?P(Y):ce&&P(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(ce)),rawData:ce,cacheControl:Se,expires:Ue})});return function(){V.cancel(),P()}}yt.prototype.parse=function(B,P,V,Y,ce){var Se=this;this.status="parsing",this.data=B,this.collisionBoxArray=new v.CollisionBoxArray;var Ue=new v.DictionaryCoder(Object.keys(B.layers).sort()),Q=new v.FeatureIndex(this.tileID,this.promoteId);Q.bucketLayerIDs=[];var ve,rt,wt,nr,_t={},Qt={featureIndex:Q,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},Br=P.familiesBySource[this.source];for(var Fr in Br){var Mt=B.layers[Fr];if(Mt){Mt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+Fr+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Dr=Ue.encode(Fr),Er=[],Rr=0;Rr<Mt.length;Rr++){var zn=Mt.feature(Rr),jr=Q.getId(zn,Fr);Er.push({feature:zn,id:jr,index:Rr,sourceLayerIndex:Dr})}for(var qn=0,Li=Br[Fr];qn<Li.length;qn+=1){var ei=Li[qn],Ai=ei[0];Ai.minzoom&&this.zoom<Math.floor(Ai.minzoom)||Ai.maxzoom&&this.zoom>=Ai.maxzoom||Ai.visibility!=="none"&&(Re(ei,this.zoom,V),(_t[Ai.id]=Ai.createBucket({index:Q.bucketLayerIDs.length,layers:ei,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Dr,sourceID:this.source})).populate(Er,Qt,this.tileID.canonical),Q.bucketLayerIDs.push(ei.map(function(mi){return mi.id})))}}}var di=v.mapObject(Qt.glyphDependencies,function(mi){return Object.keys(mi).map(Number)});Object.keys(di).length?Y.send("getGlyphs",{uid:this.uid,stacks:di},function(mi,Jn){ve||(ve=mi,rt=Jn,ro.call(Se))}):rt={};var Aa=Object.keys(Qt.iconDependencies);Aa.length?Y.send("getImages",{icons:Aa,source:this.source,tileID:this.tileID,type:"icons"},function(mi,Jn){ve||(ve=mi,wt=Jn,ro.call(Se))}):wt={};var Bi=Object.keys(Qt.patternDependencies);function ro(){if(ve)return ce(ve);if(rt&&wt&&nr){var mi=new Oe(rt),Jn=new v.ImageAtlas(wt,nr);for(var oi in _t){var bo=_t[oi];bo instanceof v.SymbolBucket?(Re(bo.layers,this.zoom,V),v.performSymbolLayout(bo,rt,mi.positions,wt,Jn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):bo.hasPattern&&(bo instanceof v.LineBucket||bo instanceof v.FillBucket||bo instanceof v.FillExtrusionBucket)&&(Re(bo.layers,this.zoom,V),bo.addFeatures(Qt,this.tileID.canonical,Jn.patternPositions))}this.status="done",ce(null,{buckets:v.values(_t).filter(function(Fs){return!Fs.isEmpty()}),featureIndex:Q,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:mi.image,imageAtlas:Jn,glyphMap:this.returnDependencies?rt:null,iconMap:this.returnDependencies?wt:null,glyphPositions:this.returnDependencies?mi.positions:null})}}Bi.length?Y.send("getImages",{icons:Bi,source:this.source,tileID:this.tileID,type:"patterns"},function(mi,Jn){ve||(ve=mi,nr=Jn,ro.call(Se))}):nr={},ro.call(this)};var ct=function(B,P,V,Y){this.actor=B,this.layerIndex=P,this.availableImages=V,this.loadVectorData=Y||zt,this.loading={},this.loaded={}};ct.prototype.loadTile=function(B,P){var V=this,Y=B.uid;this.loading||(this.loading={});var ce=!!(B&&B.request&&B.request.collectResourceTiming)&&new v.RequestPerformance(B.request),Se=this.loading[Y]=new yt(B);Se.abort=this.loadVectorData(B,function(Ue,Q){if(delete V.loading[Y],Ue||!Q)return Se.status="done",V.loaded[Y]=Se,P(Ue);var ve=Q.rawData,rt={};Q.expires&&(rt.expires=Q.expires),Q.cacheControl&&(rt.cacheControl=Q.cacheControl);var wt={};if(ce){var nr=ce.finish();nr&&(wt.resourceTiming=JSON.parse(JSON.stringify(nr)))}Se.vectorTile=Q.vectorTile,Se.parse(Q.vectorTile,V.layerIndex,V.availableImages,V.actor,function(_t,Qt){if(_t||!Qt)return P(_t);P(null,v.extend({rawTileData:ve.slice(0)},Qt,rt,wt))}),V.loaded=V.loaded||{},V.loaded[Y]=Se})},ct.prototype.reloadTile=function(B,P){var V=this,Y=this.loaded,ce=B.uid,Se=this;if(Y&&Y[ce]){var Ue=Y[ce];Ue.showCollisionBoxes=B.showCollisionBoxes;var Q=function(ve,rt){var wt=Ue.reloadCallback;wt&&(delete Ue.reloadCallback,Ue.parse(Ue.vectorTile,Se.layerIndex,V.availableImages,Se.actor,wt)),P(ve,rt)};Ue.status==="parsing"?Ue.reloadCallback=Q:Ue.status==="done"&&(Ue.vectorTile?Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,Q):Q())}},ct.prototype.abortTile=function(B,P){var V=this.loading,Y=B.uid;V&&V[Y]&&V[Y].abort&&(V[Y].abort(),delete V[Y]),P()},ct.prototype.removeTile=function(B,P){var V=this.loaded,Y=B.uid;V&&V[Y]&&delete V[Y],P()};var st=v.window.ImageBitmap,qt=function(){this.loaded={}};function Yt(B,P){if(B.length!==0){ir(B[0],P);for(var V=1;V<B.length;V++)ir(B[V],!P)}}function ir(B,P){for(var V=0,Y=0,ce=0,Se=B.length,Ue=Se-1;ce<Se;Ue=ce++){var Q=(B[ce][0]-B[Ue][0])*(B[Ue][1]+B[ce][1]),ve=V+Q;Y+=Math.abs(V)>=Math.abs(Q)?V-ve+Q:Q-ve+V,V=ve}V+Y>=0!=!!P&&B.reverse()}qt.prototype.loadTile=function(B,P){var V=B.uid,Y=B.encoding,ce=B.rawImageData,Se=st&&ce instanceof st?this.getImageData(ce):ce,Ue=new v.DEMData(V,Se,Y);this.loaded=this.loaded||{},this.loaded[V]=Ue,P(null,Ue)},qt.prototype.getImageData=function(B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);var P=this.offscreenCanvasContext.getImageData(-1,-1,B.width+2,B.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:P.width,height:P.height},P.data)},qt.prototype.removeTile=function(B){var P=this.loaded,V=B.uid;P&&P[V]&&delete P[V]};var or=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,Sr=function(B){this._feature=B,this.extent=v.EXTENT,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))};Sr.prototype.loadGeometry=function(){if(this._feature.type===1){for(var B=[],P=0,V=this._feature.geometry;P<V.length;P+=1){var Y=V[P];B.push([new v.Point$1(Y[0],Y[1])])}return B}for(var ce=[],Se=0,Ue=this._feature.geometry;Se<Ue.length;Se+=1){for(var Q=[],ve=0,rt=Ue[Se];ve<rt.length;ve+=1){var wt=rt[ve];Q.push(new v.Point$1(wt[0],wt[1]))}ce.push(Q)}return ce},Sr.prototype.toGeoJSON=function(B,P,V){return or.call(this,B,P,V)};var _r=function(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=B.length,this._features=B};_r.prototype.feature=function(B){return new Sr(this._features[B])};var Gr=v.vectorTile.VectorTileFeature,vn=ii;function ii(B,P){this.options=P||{},this.features=B,this.length=B.length}function Yn(B,P){this.id=typeof B.id=="number"?B.id:void 0,this.type=B.type,this.rawGeometry=B.type===1?[B.geometry]:B.geometry,this.properties=B.tags,this.extent=P||4096}ii.prototype.feature=function(B){return new Yn(this.features[B],this.options.extent)},Yn.prototype.loadGeometry=function(){var B=this.rawGeometry;this.geometry=[];for(var P=0;P<B.length;P++){for(var V=B[P],Y=[],ce=0;ce<V.length;ce++)Y.push(new v.Point$1(V[ce][0],V[ce][1]));this.geometry.push(Y)}return this.geometry},Yn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var B=this.geometry,P=1/0,V=-1/0,Y=1/0,ce=-1/0,Se=0;Se<B.length;Se++)for(var Ue=B[Se],Q=0;Q<Ue.length;Q++){var ve=Ue[Q];P=Math.min(P,ve.x),V=Math.max(V,ve.x),Y=Math.min(Y,ve.y),ce=Math.max(ce,ve.y)}return[P,Y,V,ce]},Yn.prototype.toGeoJSON=Gr.prototype.toGeoJSON;var xt=Ft,Pe=vn;function Ft(B){var P=new v.pbf;return function(V,Y){for(var ce in V.layers)Y.writeMessage(3,tt,V.layers[ce])}(B,P),P.finish()}function tt(B,P){var V;P.writeVarintField(15,B.version||1),P.writeStringField(1,B.name||""),P.writeVarintField(5,B.extent||4096);var Y={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<B.length;V++)Y.feature=B.feature(V),P.writeMessage(2,Jt,Y);var ce=Y.keys;for(V=0;V<ce.length;V++)P.writeStringField(3,ce[V]);var Se=Y.values;for(V=0;V<Se.length;V++)P.writeMessage(4,he,Se[V])}function Jt(B,P){var V=B.feature;V.id!==void 0&&P.writeVarintField(1,V.id),P.writeMessage(2,wr,B),P.writeVarintField(3,V.type),P.writeMessage(4,W,V)}function wr(B,P){var V=B.feature,Y=B.keys,ce=B.values,Se=B.keycache,Ue=B.valuecache;for(var Q in V.properties){var ve=Se[Q];ve===void 0&&(Y.push(Q),Se[Q]=ve=Y.length-1),P.writeVarint(ve);var rt=V.properties[Q],wt=typeof rt;wt!=="string"&&wt!=="boolean"&&wt!=="number"&&(rt=JSON.stringify(rt));var nr=wt+":"+rt,_t=Ue[nr];_t===void 0&&(ce.push(rt),Ue[nr]=_t=ce.length-1),P.writeVarint(_t)}}function $(B,P){return(P<<3)+(7&B)}function me(B){return B<<1^B>>31}function W(B,P){for(var V=B.loadGeometry(),Y=B.type,ce=0,Se=0,Ue=V.length,Q=0;Q<Ue;Q++){var ve=V[Q],rt=1;Y===1&&(rt=ve.length),P.writeVarint($(1,rt));for(var wt=Y===3?ve.length-1:ve.length,nr=0;nr<wt;nr++){nr===1&&Y!==1&&P.writeVarint($(2,wt-1));var _t=ve[nr].x-ce,Qt=ve[nr].y-Se;P.writeVarint(me(_t)),P.writeVarint(me(Qt)),ce+=_t,Se+=Qt}Y===3&&P.writeVarint($(7,1))}}function he(B,P){var V=typeof B;V==="string"?P.writeStringField(1,B):V==="boolean"?P.writeBooleanField(7,B):V==="number"&&(B%1!=0?P.writeDoubleField(3,B):B<0?P.writeSVarintField(6,B):P.writeVarintField(5,B))}function ae(B,P,V,Y){Me(B,V,Y),Me(P,2*V,2*Y),Me(P,2*V+1,2*Y+1)}function Me(B,P,V){var Y=B[P];B[P]=B[V],B[V]=Y}function je(B,P,V,Y){var ce=B-V,Se=P-Y;return ce*ce+Se*Se}xt.fromVectorTileJs=Ft,xt.fromGeojsonVt=function(B,P){P=P||{};var V={};for(var Y in B)V[Y]=new vn(B[Y].features,P),V[Y].name=Y,V[Y].version=P.version,V[Y].extent=P.extent;return Ft({layers:V})},xt.GeoJSONWrapper=Pe;var ut=function(B){return B[0]},St=function(B){return B[1]},bt=function(B,P,V,Y,ce){P===void 0&&(P=ut),V===void 0&&(V=St),Y===void 0&&(Y=64),ce===void 0&&(ce=Float64Array),this.nodeSize=Y,this.points=B;for(var Se=B.length<65536?Uint16Array:Uint32Array,Ue=this.ids=new Se(B.length),Q=this.coords=new ce(2*B.length),ve=0;ve<B.length;ve++)Ue[ve]=ve,Q[2*ve]=P(B[ve]),Q[2*ve+1]=V(B[ve]);(function rt(wt,nr,_t,Qt,Br,Fr){if(!(Br-Qt<=_t)){var Mt=Qt+Br>>1;(function Dr(Er,Rr,zn,jr,qn,Li){for(;qn>jr;){if(qn-jr>600){var ei=qn-jr+1,Ai=zn-jr+1,di=Math.log(ei),Aa=.5*Math.exp(2*di/3),Bi=.5*Math.sqrt(di*Aa*(ei-Aa)/ei)*(Ai-ei/2<0?-1:1);Dr(Er,Rr,zn,Math.max(jr,Math.floor(zn-Ai*Aa/ei+Bi)),Math.min(qn,Math.floor(zn+(ei-Ai)*Aa/ei+Bi)),Li)}var ro=Rr[2*zn+Li],mi=jr,Jn=qn;for(ae(Er,Rr,jr,zn),Rr[2*qn+Li]>ro&&ae(Er,Rr,jr,qn);mi<Jn;){for(ae(Er,Rr,mi,Jn),mi++,Jn--;Rr[2*mi+Li]<ro;)mi++;for(;Rr[2*Jn+Li]>ro;)Jn--}Rr[2*jr+Li]===ro?ae(Er,Rr,jr,Jn):ae(Er,Rr,++Jn,qn),Jn<=zn&&(jr=Jn+1),zn<=Jn&&(qn=Jn-1)}})(wt,nr,Mt,Qt,Br,Fr%2),rt(wt,nr,_t,Qt,Mt-1,Fr+1),rt(wt,nr,_t,Mt+1,Br,Fr+1)}})(Ue,Q,Y,0,Ue.length-1,0)};bt.prototype.range=function(B,P,V,Y){return function(ce,Se,Ue,Q,ve,rt,wt){for(var nr,_t,Qt=[0,ce.length-1,0],Br=[];Qt.length;){var Fr=Qt.pop(),Mt=Qt.pop(),Dr=Qt.pop();if(Mt-Dr<=wt)for(var Er=Dr;Er<=Mt;Er++)_t=Se[2*Er+1],(nr=Se[2*Er])>=Ue&&nr<=ve&&_t>=Q&&_t<=rt&&Br.push(ce[Er]);else{var Rr=Math.floor((Dr+Mt)/2);_t=Se[2*Rr+1],(nr=Se[2*Rr])>=Ue&&nr<=ve&&_t>=Q&&_t<=rt&&Br.push(ce[Rr]);var zn=(Fr+1)%2;(Fr===0?Ue<=nr:Q<=_t)&&(Qt.push(Dr),Qt.push(Rr-1),Qt.push(zn)),(Fr===0?ve>=nr:rt>=_t)&&(Qt.push(Rr+1),Qt.push(Mt),Qt.push(zn))}}return Br}(this.ids,this.coords,B,P,V,Y,this.nodeSize)},bt.prototype.within=function(B,P,V){return function(Y,ce,Se,Ue,Q,ve){for(var rt=[0,Y.length-1,0],wt=[],nr=Q*Q;rt.length;){var _t=rt.pop(),Qt=rt.pop(),Br=rt.pop();if(Qt-Br<=ve)for(var Fr=Br;Fr<=Qt;Fr++)je(ce[2*Fr],ce[2*Fr+1],Se,Ue)<=nr&&wt.push(Y[Fr]);else{var Mt=Math.floor((Br+Qt)/2),Dr=ce[2*Mt],Er=ce[2*Mt+1];je(Dr,Er,Se,Ue)<=nr&&wt.push(Y[Mt]);var Rr=(_t+1)%2;(_t===0?Se-Q<=Dr:Ue-Q<=Er)&&(rt.push(Br),rt.push(Mt-1),rt.push(Rr)),(_t===0?Se+Q>=Dr:Ue+Q>=Er)&&(rt.push(Mt+1),rt.push(Qt),rt.push(Rr))}}return wt}(this.ids,this.coords,B,P,V,this.nodeSize)};var Lr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(B){return B}},Cr=function(B){this.options=Qn(Object.create(Lr),B),this.trees=new Array(this.options.maxZoom+1)};function On(B,P,V,Y,ce){return{x:B,y:P,zoom:1/0,id:V,parentId:-1,numPoints:Y,properties:ce}}function Xr(B,P){var V=B.geometry.coordinates,Y=V[1];return{x:rn(V[0]),y:Kr(Y),zoom:1/0,index:P,parentId:-1}}function xn(B){return{type:"Feature",id:B.id,properties:Yr(B),geometry:{type:"Point",coordinates:[(Y=B.x,360*(Y-.5)),(P=B.y,V=(180-360*P)*Math.PI/180,360*Math.atan(Math.exp(V))/Math.PI-90)]}};var P,V,Y}function Yr(B){var P=B.numPoints,V=P>=1e4?Math.round(P/1e3)+"k":P>=1e3?Math.round(P/100)/10+"k":P;return Qn(Qn({},B.properties),{cluster:!0,cluster_id:B.id,point_count:P,point_count_abbreviated:V})}function rn(B){return B/360+.5}function Kr(B){var P=Math.sin(B*Math.PI/180),V=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return V<0?0:V>1?1:V}function Qn(B,P){for(var V in P)B[V]=P[V];return B}function Ur(B){return B.x}function Mn(B){return B.y}function $r(B,P,V,Y,ce,Se){var Ue=ce-V,Q=Se-Y;if(Ue!==0||Q!==0){var ve=((B-V)*Ue+(P-Y)*Q)/(Ue*Ue+Q*Q);ve>1?(V=ce,Y=Se):ve>0&&(V+=Ue*ve,Y+=Q*ve)}return(Ue=B-V)*Ue+(Q=P-Y)*Q}function un(B,P,V,Y){var ce={id:B===void 0?null:B,type:P,geometry:V,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Se){var Ue=Se.geometry,Q=Se.type;if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")zi(Se,Ue);else if(Q==="Polygon"||Q==="MultiLineString")for(var ve=0;ve<Ue.length;ve++)zi(Se,Ue[ve]);else if(Q==="MultiPolygon")for(ve=0;ve<Ue.length;ve++)for(var rt=0;rt<Ue[ve].length;rt++)zi(Se,Ue[ve][rt])}(ce),ce}function zi(B,P){for(var V=0;V<P.length;V+=3)B.minX=Math.min(B.minX,P[V]),B.minY=Math.min(B.minY,P[V+1]),B.maxX=Math.max(B.maxX,P[V]),B.maxY=Math.max(B.maxY,P[V+1])}function gi(B,P,V,Y){if(P.geometry){var ce=P.geometry.coordinates,Se=P.geometry.type,Ue=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Q=[],ve=P.id;if(V.promoteId?ve=P.properties[V.promoteId]:V.generateId&&(ve=Y||0),Se==="Point")_o(ce,Q);else if(Se==="MultiPoint")for(var rt=0;rt<ce.length;rt++)_o(ce[rt],Q);else if(Se==="LineString")Ii(ce,Q,Ue,!1);else if(Se==="MultiLineString"){if(V.lineMetrics){for(rt=0;rt<ce.length;rt++)Ii(ce[rt],Q=[],Ue,!1),B.push(un(ve,"LineString",Q,P.properties));return}ie(ce,Q,Ue,!1)}else if(Se==="Polygon")ie(ce,Q,Ue,!0);else{if(Se!=="MultiPolygon"){if(Se==="GeometryCollection"){for(rt=0;rt<P.geometry.geometries.length;rt++)gi(B,{id:ve,geometry:P.geometry.geometries[rt],properties:P.properties},V,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(rt=0;rt<ce.length;rt++){var wt=[];ie(ce[rt],wt,Ue,!0),Q.push(wt)}}B.push(un(ve,Se,Q,P.properties))}}function _o(B,P){P.push(Wi(B[0])),P.push(Ji(B[1])),P.push(0)}function Ii(B,P,V,Y){for(var ce,Se,Ue=0,Q=0;Q<B.length;Q++){var ve=Wi(B[Q][0]),rt=Ji(B[Q][1]);P.push(ve),P.push(rt),P.push(0),Q>0&&(Ue+=Y?(ce*rt-ve*Se)/2:Math.sqrt(Math.pow(ve-ce,2)+Math.pow(rt-Se,2))),ce=ve,Se=rt}var wt=P.length-3;P[2]=1,function nr(_t,Qt,Br,Fr){for(var Mt,Dr=Fr,Er=Br-Qt>>1,Rr=Br-Qt,zn=_t[Qt],jr=_t[Qt+1],qn=_t[Br],Li=_t[Br+1],ei=Qt+3;ei<Br;ei+=3){var Ai=$r(_t[ei],_t[ei+1],zn,jr,qn,Li);if(Ai>Dr)Mt=ei,Dr=Ai;else if(Ai===Dr){var di=Math.abs(ei-Er);di<Rr&&(Mt=ei,Rr=di)}}Dr>Fr&&(Mt-Qt>3&&nr(_t,Qt,Mt,Fr),_t[Mt+2]=Dr,Br-Mt>3&&nr(_t,Mt,Br,Fr))}(P,0,wt,V),P[wt+2]=1,P.size=Math.abs(Ue),P.start=0,P.end=P.size}function ie(B,P,V,Y){for(var ce=0;ce<B.length;ce++){var Se=[];Ii(B[ce],Se,V,Y),P.push(Se)}}function Wi(B){return B/360+.5}function Ji(B){var P=Math.sin(B*Math.PI/180),V=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return V<0?0:V>1?1:V}function to(B,P,V,Y,ce,Se,Ue,Q){if(Y/=P,Se>=(V/=P)&&Ue<Y)return B;if(Ue<V||Se>=Y)return null;for(var ve=[],rt=0;rt<B.length;rt++){var wt=B[rt],nr=wt.geometry,_t=wt.type,Qt=ce===0?wt.minX:wt.minY,Br=ce===0?wt.maxX:wt.maxY;if(Qt>=V&&Br<Y)ve.push(wt);else if(!(Br<V||Qt>=Y)){var Fr=[];if(_t==="Point"||_t==="MultiPoint")aa(nr,Fr,V,Y,ce);else if(_t==="LineString")ea(nr,Fr,V,Y,ce,!1,Q.lineMetrics);else if(_t==="MultiLineString")Vo(nr,Fr,V,Y,ce,!1);else if(_t==="Polygon")Vo(nr,Fr,V,Y,ce,!0);else if(_t==="MultiPolygon")for(var Mt=0;Mt<nr.length;Mt++){var Dr=[];Vo(nr[Mt],Dr,V,Y,ce,!0),Dr.length&&Fr.push(Dr)}if(Fr.length){if(Q.lineMetrics&&_t==="LineString"){for(Mt=0;Mt<Fr.length;Mt++)ve.push(un(wt.id,_t,Fr[Mt],wt.tags));continue}_t!=="LineString"&&_t!=="MultiLineString"||(Fr.length===1?(_t="LineString",Fr=Fr[0]):_t="MultiLineString"),_t!=="Point"&&_t!=="MultiPoint"||(_t=Fr.length===3?"Point":"MultiPoint"),ve.push(un(wt.id,_t,Fr,wt.tags))}}}return ve.length?ve:null}function aa(B,P,V,Y,ce){for(var Se=0;Se<B.length;Se+=3){var Ue=B[Se+ce];Ue>=V&&Ue<=Y&&(P.push(B[Se]),P.push(B[Se+1]),P.push(B[Se+2]))}}function ea(B,P,V,Y,ce,Se,Ue){for(var Q,ve,rt=Bs(B),wt=ce===0?_u:Do,nr=B.start,_t=0;_t<B.length-3;_t+=3){var Qt=B[_t],Br=B[_t+1],Fr=B[_t+2],Mt=B[_t+3],Dr=B[_t+4],Er=ce===0?Qt:Br,Rr=ce===0?Mt:Dr,zn=!1;Ue&&(Q=Math.sqrt(Math.pow(Qt-Mt,2)+Math.pow(Br-Dr,2))),Er<V?Rr>V&&(ve=wt(rt,Qt,Br,Mt,Dr,V),Ue&&(rt.start=nr+Q*ve)):Er>Y?Rr<Y&&(ve=wt(rt,Qt,Br,Mt,Dr,Y),Ue&&(rt.start=nr+Q*ve)):Ws(rt,Qt,Br,Fr),Rr<V&&Er>=V&&(ve=wt(rt,Qt,Br,Mt,Dr,V),zn=!0),Rr>Y&&Er<=Y&&(ve=wt(rt,Qt,Br,Mt,Dr,Y),zn=!0),!Se&&zn&&(Ue&&(rt.end=nr+Q*ve),P.push(rt),rt=Bs(B)),Ue&&(nr+=Q)}var jr=B.length-3;Qt=B[jr],Br=B[jr+1],Fr=B[jr+2],(Er=ce===0?Qt:Br)>=V&&Er<=Y&&Ws(rt,Qt,Br,Fr),jr=rt.length-3,Se&&jr>=3&&(rt[jr]!==rt[0]||rt[jr+1]!==rt[1])&&Ws(rt,rt[0],rt[1],rt[2]),rt.length&&P.push(rt)}function Bs(B){var P=[];return P.size=B.size,P.start=B.start,P.end=B.end,P}function Vo(B,P,V,Y,ce,Se){for(var Ue=0;Ue<B.length;Ue++)ea(B[Ue],P,V,Y,ce,Se,!1)}function Ws(B,P,V,Y){B.push(P),B.push(V),B.push(Y)}function _u(B,P,V,Y,ce,Se){var Ue=(Se-P)/(Y-P);return B.push(Se),B.push(V+(ce-V)*Ue),B.push(1),Ue}function Do(B,P,V,Y,ce,Se){var Ue=(Se-V)/(ce-V);return B.push(P+(Y-P)*Ue),B.push(Se),B.push(1),Ue}function uo(B,P){for(var V=[],Y=0;Y<B.length;Y++){var ce,Se=B[Y],Ue=Se.type;if(Ue==="Point"||Ue==="MultiPoint"||Ue==="LineString")ce=lo(Se.geometry,P);else if(Ue==="MultiLineString"||Ue==="Polygon"){ce=[];for(var Q=0;Q<Se.geometry.length;Q++)ce.push(lo(Se.geometry[Q],P))}else if(Ue==="MultiPolygon")for(ce=[],Q=0;Q<Se.geometry.length;Q++){for(var ve=[],rt=0;rt<Se.geometry[Q].length;rt++)ve.push(lo(Se.geometry[Q][rt],P));ce.push(ve)}V.push(un(Se.id,Ue,ce,Se.tags))}return V}function lo(B,P){var V=[];V.size=B.size,B.start!==void 0&&(V.start=B.start,V.end=B.end);for(var Y=0;Y<B.length;Y+=3)V.push(B[Y]+P,B[Y+1],B[Y+2]);return V}function ot(B,P){if(B.transformed)return B;var V,Y,ce,Se=1<<B.z,Ue=B.x,Q=B.y;for(V=0;V<B.features.length;V++){var ve=B.features[V],rt=ve.geometry,wt=ve.type;if(ve.geometry=[],wt===1)for(Y=0;Y<rt.length;Y+=2)ve.geometry.push(z(rt[Y],rt[Y+1],P,Se,Ue,Q));else for(Y=0;Y<rt.length;Y++){var nr=[];for(ce=0;ce<rt[Y].length;ce+=2)nr.push(z(rt[Y][ce],rt[Y][ce+1],P,Se,Ue,Q));ve.geometry.push(nr)}}return B.transformed=!0,B}function z(B,P,V,Y,ce,Se){return[Math.round(V*(B*Y-ce)),Math.round(V*(P*Y-Se))]}function K(B,P,V,Y,ce){for(var Se=P===ce.maxZoom?0:ce.tolerance/((1<<P)*ce.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:Y,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Q=0;Q<B.length;Q++){Ue.numFeatures++,de(Ue,B[Q],Se,ce);var ve=B[Q].minX,rt=B[Q].minY,wt=B[Q].maxX,nr=B[Q].maxY;ve<Ue.minX&&(Ue.minX=ve),rt<Ue.minY&&(Ue.minY=rt),wt>Ue.maxX&&(Ue.maxX=wt),nr>Ue.maxY&&(Ue.maxY=nr)}return Ue}function de(B,P,V,Y){var ce=P.geometry,Se=P.type,Ue=[];if(Se==="Point"||Se==="MultiPoint")for(var Q=0;Q<ce.length;Q+=3)Ue.push(ce[Q]),Ue.push(ce[Q+1]),B.numPoints++,B.numSimplified++;else if(Se==="LineString")Fe(Ue,ce,B,V,!1,!1);else if(Se==="MultiLineString"||Se==="Polygon")for(Q=0;Q<ce.length;Q++)Fe(Ue,ce[Q],B,V,Se==="Polygon",Q===0);else if(Se==="MultiPolygon")for(var ve=0;ve<ce.length;ve++){var rt=ce[ve];for(Q=0;Q<rt.length;Q++)Fe(Ue,rt[Q],B,V,!0,Q===0)}if(Ue.length){var wt=P.tags||null;if(Se==="LineString"&&Y.lineMetrics){for(var nr in wt={},P.tags)wt[nr]=P.tags[nr];wt.mapbox_clip_start=ce.start/ce.size,wt.mapbox_clip_end=ce.end/ce.size}var _t={geometry:Ue,type:Se==="Polygon"||Se==="MultiPolygon"?3:Se==="LineString"||Se==="MultiLineString"?2:1,tags:wt};P.id!==null&&(_t.id=P.id),B.features.push(_t)}}function Fe(B,P,V,Y,ce,Se){var Ue=Y*Y;if(Y>0&&P.size<(ce?Ue:Y))V.numPoints+=P.length/3;else{for(var Q=[],ve=0;ve<P.length;ve+=3)(Y===0||P[ve+2]>Ue)&&(V.numSimplified++,Q.push(P[ve]),Q.push(P[ve+1])),V.numPoints++;ce&&function(rt,wt){for(var nr=0,_t=0,Qt=rt.length,Br=Qt-2;_t<Qt;Br=_t,_t+=2)nr+=(rt[_t]-rt[Br])*(rt[_t+1]+rt[Br+1]);if(nr>0===wt)for(_t=0,Qt=rt.length;_t<Qt/2;_t+=2){var Fr=rt[_t],Mt=rt[_t+1];rt[_t]=rt[Qt-2-_t],rt[_t+1]=rt[Qt-1-_t],rt[Qt-2-_t]=Fr,rt[Qt-1-_t]=Mt}}(Q,Se),B.push(Q)}}function Ce(B,P){var V=(P=this.options=function(ce,Se){for(var Ue in Se)ce[Ue]=Se[Ue];return ce}(Object.create(this.options),P)).debug;if(V&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var Y=function(ce,Se){var Ue=[];if(ce.type==="FeatureCollection")for(var Q=0;Q<ce.features.length;Q++)gi(Ue,ce.features[Q],Se,Q);else gi(Ue,ce.type==="Feature"?ce:{geometry:ce},Se);return Ue}(B,P);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Y=function(ce,Se){var Ue=Se.buffer/Se.extent,Q=ce,ve=to(ce,1,-1-Ue,Ue,0,-1,2,Se),rt=to(ce,1,1-Ue,2+Ue,0,-1,2,Se);return(ve||rt)&&(Q=to(ce,1,-Ue,1+Ue,0,-1,2,Se)||[],ve&&(Q=uo(ve,1).concat(Q)),rt&&(Q=Q.concat(uo(rt,-1)))),Q}(Y,P)).length&&this.splitTile(Y,0,0,0),V&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Nt(B,P,V){return 32*((1<<B)*V+P)+B}function Bt(B,P){var V=B.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);var Y=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!Y)return P(null,null);var ce=new _r(Y.features),Se=xt(ce);Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),P(null,{vectorTile:ce,rawData:Se.buffer})}Cr.prototype.load=function(B){var P=this.options,V=P.log,Y=P.minZoom,ce=P.maxZoom,Se=P.nodeSize;V&&console.time("total time");var Ue="prepare "+B.length+" points";V&&console.time(Ue),this.points=B;for(var Q=[],ve=0;ve<B.length;ve++)B[ve].geometry&&Q.push(Xr(B[ve],ve));this.trees[ce+1]=new bt(Q,Ur,Mn,Se,Float32Array),V&&console.timeEnd(Ue);for(var rt=ce;rt>=Y;rt--){var wt=+Date.now();Q=this._cluster(Q,rt),this.trees[rt]=new bt(Q,Ur,Mn,Se,Float32Array),V&&console.log("z%d: %d clusters in %dms",rt,Q.length,+Date.now()-wt)}return V&&console.timeEnd("total time"),this},Cr.prototype.getClusters=function(B,P){var V=((B[0]+180)%360+360)%360-180,Y=Math.max(-90,Math.min(90,B[1])),ce=B[2]===180?180:((B[2]+180)%360+360)%360-180,Se=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)V=-180,ce=180;else if(V>ce){var Ue=this.getClusters([V,Y,180,Se],P),Q=this.getClusters([-180,Y,ce,Se],P);return Ue.concat(Q)}for(var ve=this.trees[this._limitZoom(P)],rt=[],wt=0,nr=ve.range(rn(V),Kr(Se),rn(ce),Kr(Y));wt<nr.length;wt+=1){var _t=ve.points[nr[wt]];rt.push(_t.numPoints?xn(_t):this.points[_t.index])}return rt},Cr.prototype.getChildren=function(B){var P=this._getOriginId(B),V=this._getOriginZoom(B),Y="No cluster with the specified id.",ce=this.trees[V];if(!ce)throw new Error(Y);var Se=ce.points[P];if(!Se)throw new Error(Y);for(var Ue=this.options.radius/(this.options.extent*Math.pow(2,V-1)),Q=[],ve=0,rt=ce.within(Se.x,Se.y,Ue);ve<rt.length;ve+=1){var wt=ce.points[rt[ve]];wt.parentId===B&&Q.push(wt.numPoints?xn(wt):this.points[wt.index])}if(Q.length===0)throw new Error(Y);return Q},Cr.prototype.getLeaves=function(B,P,V){var Y=[];return this._appendLeaves(Y,B,P=P||10,V=V||0,0),Y},Cr.prototype.getTile=function(B,P,V){var Y=this.trees[this._limitZoom(B)],ce=Math.pow(2,B),Se=this.options,Ue=Se.radius/Se.extent,Q=(V-Ue)/ce,ve=(V+1+Ue)/ce,rt={features:[]};return this._addTileFeatures(Y.range((P-Ue)/ce,Q,(P+1+Ue)/ce,ve),Y.points,P,V,ce,rt),P===0&&this._addTileFeatures(Y.range(1-Ue/ce,Q,1,ve),Y.points,ce,V,ce,rt),P===ce-1&&this._addTileFeatures(Y.range(0,Q,Ue/ce,ve),Y.points,-1,V,ce,rt),rt.features.length?rt:null},Cr.prototype.getClusterExpansionZoom=function(B){for(var P=this._getOriginZoom(B)-1;P<=this.options.maxZoom;){var V=this.getChildren(B);if(P++,V.length!==1)break;B=V[0].properties.cluster_id}return P},Cr.prototype._appendLeaves=function(B,P,V,Y,ce){for(var Se=0,Ue=this.getChildren(P);Se<Ue.length;Se+=1){var Q=Ue[Se],ve=Q.properties;if(ve&&ve.cluster?ce+ve.point_count<=Y?ce+=ve.point_count:ce=this._appendLeaves(B,ve.cluster_id,V,Y,ce):ce<Y?ce++:B.push(Q),B.length===V)break}return ce},Cr.prototype._addTileFeatures=function(B,P,V,Y,ce,Se){for(var Ue=0,Q=B;Ue<Q.length;Ue+=1){var ve=P[Q[Ue]],rt=ve.numPoints,wt={type:1,geometry:[[Math.round(this.options.extent*(ve.x*ce-V)),Math.round(this.options.extent*(ve.y*ce-Y))]],tags:rt?Yr(ve):this.points[ve.index].properties},nr=void 0;rt?nr=ve.id:this.options.generateId?nr=ve.index:this.points[ve.index].id&&(nr=this.points[ve.index].id),nr!==void 0&&(wt.id=nr),Se.features.push(wt)}},Cr.prototype._limitZoom=function(B){return Math.max(this.options.minZoom,Math.min(+B,this.options.maxZoom+1))},Cr.prototype._cluster=function(B,P){for(var V=[],Y=this.options,ce=Y.reduce,Se=Y.minPoints,Ue=Y.radius/(Y.extent*Math.pow(2,P)),Q=0;Q<B.length;Q++){var ve=B[Q];if(!(ve.zoom<=P)){ve.zoom=P;for(var rt=this.trees[P+1],wt=rt.within(ve.x,ve.y,Ue),nr=ve.numPoints||1,_t=nr,Qt=0,Br=wt;Qt<Br.length;Qt+=1){var Fr=rt.points[Br[Qt]];Fr.zoom>P&&(_t+=Fr.numPoints||1)}if(_t>=Se){for(var Mt=ve.x*nr,Dr=ve.y*nr,Er=ce&&nr>1?this._map(ve,!0):null,Rr=(Q<<5)+(P+1)+this.points.length,zn=0,jr=wt;zn<jr.length;zn+=1){var qn=rt.points[jr[zn]];if(!(qn.zoom<=P)){qn.zoom=P;var Li=qn.numPoints||1;Mt+=qn.x*Li,Dr+=qn.y*Li,qn.parentId=Rr,ce&&(Er||(Er=this._map(ve,!0)),ce(Er,this._map(qn)))}}ve.parentId=Rr,V.push(On(Mt/_t,Dr/_t,Rr,_t,Er))}else if(V.push(ve),_t>1)for(var ei=0,Ai=wt;ei<Ai.length;ei+=1){var di=rt.points[Ai[ei]];di.zoom<=P||(di.zoom=P,V.push(di))}}}return V},Cr.prototype._getOriginId=function(B){return B-this.points.length>>5},Cr.prototype._getOriginZoom=function(B){return(B-this.points.length)%32},Cr.prototype._map=function(B,P){if(B.numPoints)return P?Qn({},B.properties):B.properties;var V=this.points[B.index].properties,Y=this.options.map(V);return P&&Y===V?Qn({},Y):Y},Ce.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ce.prototype.splitTile=function(B,P,V,Y,ce,Se,Ue){for(var Q=[B,P,V,Y],ve=this.options,rt=ve.debug;Q.length;){Y=Q.pop(),V=Q.pop(),P=Q.pop(),B=Q.pop();var wt=1<<P,nr=Nt(P,V,Y),_t=this.tiles[nr];if(!_t&&(rt>1&&console.time("creation"),_t=this.tiles[nr]=K(B,P,V,Y,ve),this.tileCoords.push({z:P,x:V,y:Y}),rt)){rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,V,Y,_t.numFeatures,_t.numPoints,_t.numSimplified),console.timeEnd("creation"));var Qt="z"+P;this.stats[Qt]=(this.stats[Qt]||0)+1,this.total++}if(_t.source=B,ce){if(P===ve.maxZoom||P===ce)continue;var Br=1<<ce-P;if(V!==Math.floor(Se/Br)||Y!==Math.floor(Ue/Br))continue}else if(P===ve.indexMaxZoom||_t.numPoints<=ve.indexMaxPoints)continue;if(_t.source=null,B.length!==0){rt>1&&console.time("clipping");var Fr,Mt,Dr,Er,Rr,zn,jr=.5*ve.buffer/ve.extent,qn=.5-jr,Li=.5+jr,ei=1+jr;Fr=Mt=Dr=Er=null,Rr=to(B,wt,V-jr,V+Li,0,_t.minX,_t.maxX,ve),zn=to(B,wt,V+qn,V+ei,0,_t.minX,_t.maxX,ve),B=null,Rr&&(Fr=to(Rr,wt,Y-jr,Y+Li,1,_t.minY,_t.maxY,ve),Mt=to(Rr,wt,Y+qn,Y+ei,1,_t.minY,_t.maxY,ve),Rr=null),zn&&(Dr=to(zn,wt,Y-jr,Y+Li,1,_t.minY,_t.maxY,ve),Er=to(zn,wt,Y+qn,Y+ei,1,_t.minY,_t.maxY,ve),zn=null),rt>1&&console.timeEnd("clipping"),Q.push(Fr||[],P+1,2*V,2*Y),Q.push(Mt||[],P+1,2*V,2*Y+1),Q.push(Dr||[],P+1,2*V+1,2*Y),Q.push(Er||[],P+1,2*V+1,2*Y+1)}}},Ce.prototype.getTile=function(B,P,V){var Y=this.options,ce=Y.extent,Se=Y.debug;if(B<0||B>24)return null;var Ue=1<<B,Q=Nt(B,P=(P%Ue+Ue)%Ue,V);if(this.tiles[Q])return ot(this.tiles[Q],ce);Se>1&&console.log("drilling down to z%d-%d-%d",B,P,V);for(var ve,rt=B,wt=P,nr=V;!ve&&rt>0;)rt--,wt=Math.floor(wt/2),nr=Math.floor(nr/2),ve=this.tiles[Nt(rt,wt,nr)];return ve&&ve.source?(Se>1&&console.log("found parent tile z%d-%d-%d",rt,wt,nr),Se>1&&console.time("drilling down"),this.splitTile(ve.source,rt,wt,nr,B,P,V),Se>1&&console.timeEnd("drilling down"),this.tiles[Q]?ot(this.tiles[Q],ce):null):null};var sr=function(B){function P(V,Y,ce,Se){B.call(this,V,Y,ce,Bt),Se&&(this.loadGeoJSON=Se)}return B&&(P.__proto__=B),(P.prototype=Object.create(B&&B.prototype)).constructor=P,P.prototype.loadData=function(V,Y){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Y,this._pendingLoadDataParams=V,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},P.prototype._loadData=function(){var V=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Y=this._pendingCallback,ce=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Se=!!(ce&&ce.request&&ce.request.collectResourceTiming)&&new v.RequestPerformance(ce.request);this.loadGeoJSON(ce,function(Ue,Q){if(Ue||!Q)return Y(Ue);if(typeof Q!="object")return Y(new Error("Input data given to '"+ce.source+"' is not a valid GeoJSON object."));(function _t(Qt,Br){var Fr,Mt=Qt&&Qt.type;if(Mt==="FeatureCollection")for(Fr=0;Fr<Qt.features.length;Fr++)_t(Qt.features[Fr],Br);else if(Mt==="GeometryCollection")for(Fr=0;Fr<Qt.geometries.length;Fr++)_t(Qt.geometries[Fr],Br);else if(Mt==="Feature")_t(Qt.geometry,Br);else if(Mt==="Polygon")Yt(Qt.coordinates,Br);else if(Mt==="MultiPolygon")for(Fr=0;Fr<Qt.coordinates.length;Fr++)Yt(Qt.coordinates[Fr],Br);return Qt})(Q,!0);try{if(ce.filter){var ve=v.createExpression(ce.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(function(_t){return _t.key+": "+_t.message}).join(", "));var rt=Q.features.filter(function(_t){return ve.value.evaluate({zoom:0},_t)});Q={type:"FeatureCollection",features:rt}}V._geoJSONIndex=ce.cluster?new Cr(function(_t){var Qt=_t.superclusterOptions,Br=_t.clusterProperties;if(!Br||!Qt)return Qt;for(var Fr={},Mt={},Dr={accumulated:null,zoom:0},Er={properties:null},Rr=Object.keys(Br),zn=0,jr=Rr;zn<jr.length;zn+=1){var qn=jr[zn],Li=Br[qn],ei=Li[0],Ai=v.createExpression(Li[1]),di=v.createExpression(typeof ei=="string"?[ei,["accumulated"],["get",qn]]:ei);Fr[qn]=Ai.value,Mt[qn]=di.value}return Qt.map=function(Aa){Er.properties=Aa;for(var Bi={},ro=0,mi=Rr;ro<mi.length;ro+=1){var Jn=mi[ro];Bi[Jn]=Fr[Jn].evaluate(Dr,Er)}return Bi},Qt.reduce=function(Aa,Bi){Er.properties=Bi;for(var ro=0,mi=Rr;ro<mi.length;ro+=1){var Jn=mi[ro];Dr.accumulated=Aa[Jn],Aa[Jn]=Mt[Jn].evaluate(Dr,Er)}},Qt}(ce)).load(Q.features):function(_t,Qt){return new Ce(_t,Qt)}(Q,ce.geojsonVtOptions)}catch(_t){return Y(_t)}V.loaded={};var wt={};if(Se){var nr=Se.finish();nr&&(wt.resourceTiming={},wt.resourceTiming[ce.source]=JSON.parse(JSON.stringify(nr)))}Y(null,wt)})}},P.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},P.prototype.reloadTile=function(V,Y){var ce=this.loaded;return ce&&ce[V.uid]?B.prototype.reloadTile.call(this,V,Y):this.loadTile(V,Y)},P.prototype.loadGeoJSON=function(V,Y){if(V.request)v.getJSON(V.request,Y);else{if(typeof V.data!="string")return Y(new Error("Input data given to '"+V.source+"' is not a valid GeoJSON object."));try{return Y(null,JSON.parse(V.data))}catch(ce){return Y(new Error("Input data given to '"+V.source+"' is not a valid GeoJSON object."))}}},P.prototype.removeSource=function(V,Y){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Y()},P.prototype.getClusterExpansionZoom=function(V,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ce){Y(ce)}},P.prototype.getClusterChildren=function(V,Y){try{Y(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ce){Y(ce)}},P.prototype.getClusterLeaves=function(V,Y){try{Y(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ce){Y(ce)}},P}(ct),It=function(B){var P=this;this.self=B,this.actor=new v.Actor(B,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ct,geojson:sr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(V,Y){if(P.workerSourceTypes[V])throw new Error('Worker source with name "'+V+'" already registered.');P.workerSourceTypes[V]=Y},this.self.registerRTLTextPlugin=function(V){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=V.applyArabicShaping,v.plugin.processBidirectionalText=V.processBidirectionalText,v.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}};return It.prototype.setReferrer=function(B,P){this.referrer=P},It.prototype.setImages=function(B,P,V){for(var Y in this.availableImages[B]=P,this.workerSources[B]){var ce=this.workerSources[B][Y];for(var Se in ce)ce[Se].availableImages=P}V()},It.prototype.setLayers=function(B,P,V){this.getLayerIndex(B).replace(P),V()},It.prototype.updateLayers=function(B,P,V){this.getLayerIndex(B).update(P.layers,P.removedIds),V()},It.prototype.loadTile=function(B,P,V){this.getWorkerSource(B,P.type,P.source).loadTile(P,V)},It.prototype.loadDEMTile=function(B,P,V){this.getDEMWorkerSource(B,P.source).loadTile(P,V)},It.prototype.reloadTile=function(B,P,V){this.getWorkerSource(B,P.type,P.source).reloadTile(P,V)},It.prototype.abortTile=function(B,P,V){this.getWorkerSource(B,P.type,P.source).abortTile(P,V)},It.prototype.removeTile=function(B,P,V){this.getWorkerSource(B,P.type,P.source).removeTile(P,V)},It.prototype.removeDEMTile=function(B,P){this.getDEMWorkerSource(B,P.source).removeTile(P)},It.prototype.removeSource=function(B,P,V){if(this.workerSources[B]&&this.workerSources[B][P.type]&&this.workerSources[B][P.type][P.source]){var Y=this.workerSources[B][P.type][P.source];delete this.workerSources[B][P.type][P.source],Y.removeSource!==void 0?Y.removeSource(P,V):V()}},It.prototype.loadWorkerSource=function(B,P,V){try{this.self.importScripts(P.url),V()}catch(Y){V(Y.toString())}},It.prototype.syncRTLPluginState=function(B,P,V){try{v.plugin.setState(P);var Y=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&Y!=null){this.self.importScripts(Y);var ce=v.plugin.isParsed();V(ce?void 0:new Error("RTL Text Plugin failed to import scripts from "+Y),ce)}}catch(Se){V(Se.toString())}},It.prototype.getAvailableImages=function(B){var P=this.availableImages[B];return P||(P=[]),P},It.prototype.getLayerIndex=function(B){var P=this.layerIndexes[B];return P||(P=this.layerIndexes[B]=new Je),P},It.prototype.getWorkerSource=function(B,P,V){var Y=this;return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][P]||(this.workerSources[B][P]={}),this.workerSources[B][P][V]||(this.workerSources[B][P][V]=new this.workerSourceTypes[P]({send:function(ce,Se,Ue){Y.actor.send(ce,Se,Ue,B)}},this.getLayerIndex(B),this.getAvailableImages(B))),this.workerSources[B][P][V]},It.prototype.getDEMWorkerSource=function(B,P){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][P]||(this.demWorkerSources[B][P]=new qt),this.demWorkerSources[B][P]},It.prototype.enforceCacheSizeLimit=function(B,P){v.enforceCacheSizeLimit(P)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new It(self)),It}),qe(["./shared"],function(v){"use strict";var at=v.createCommonjsModule(function(l){function h(x){return!c(x)}function c(x){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,I,N=new Blob([""],{type:"text/javascript"}),j=URL.createObjectURL(N);try{I=new Worker(j),S=!0}catch(ne){S=!1}return I&&I.terminate(),URL.revokeObjectURL(j),S}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var S=document.createElement("canvas");S.width=S.height=1;var I=S.getContext("2d");if(!I)return!1;var N=I.getImageData(0,0,1,1);return N&&N.width===S.width}()?(d[T=x&&x.failIfMajorPerformanceCaveat]===void 0&&(d[T]=function(S){var I=function(j){var ne=document.createElement("canvas"),oe=Object.create(h.webGLContextAttributes);return oe.failIfMajorPerformanceCaveat=j,ne.probablySupportsContext?ne.probablySupportsContext("webgl",oe)||ne.probablySupportsContext("experimental-webgl",oe):ne.supportsContext?ne.supportsContext("webgl",oe)||ne.supportsContext("experimental-webgl",oe):ne.getContext("webgl",oe)||ne.getContext("experimental-webgl",oe)}(S);if(!I)return!1;var N=I.createShader(I.VERTEX_SHADER);return!(!N||I.isContextLost())&&(I.shaderSource(N,"void main() {}"),I.compileShader(N),I.getShaderParameter(N,I.COMPILE_STATUS)===!0)}(T)),d[T]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var T}l.exports?l.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=c);var d={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),G={create:function(l,h,c){var d=v.window.document.createElement(l);return h!==void 0&&(d.className=h),c&&c.appendChild(d),d},createNS:function(l,h){return v.window.document.createElementNS(l,h)}},Je=v.window.document&&v.window.document.documentElement.style;function Oe(l){if(!Je)return l[0];for(var h=0;h<l.length;h++)if(l[h]in Je)return l[h];return l[0]}var yt,Re=Oe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);G.disableDrag=function(){Je&&Re&&(yt=Je[Re],Je[Re]="none")},G.enableDrag=function(){Je&&Re&&(Je[Re]=yt)};var zt=Oe(["transform","WebkitTransform"]);G.setTransform=function(l,h){l.style[zt]=h};var ct=!1;try{var st=Object.defineProperty({},"passive",{get:function(){ct=!0}});v.window.addEventListener("test",st,st),v.window.removeEventListener("test",st,st)}catch(l){ct=!1}G.addEventListener=function(l,h,c,d){d===void 0&&(d={}),l.addEventListener(h,c,"passive"in d&&ct?d:d.capture)},G.removeEventListener=function(l,h,c,d){d===void 0&&(d={}),l.removeEventListener(h,c,"passive"in d&&ct?d:d.capture)};var qt=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",qt,!0)};function Yt(l){var h=l.userImage;return!!(h&&h.render&&h.render())&&(l.data.replace(new Uint8Array(h.data.buffer)),!0)}G.suppressClick=function(){v.window.addEventListener("click",qt,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",qt,!0)},0)},G.mousePos=function(l,h){var c=l.getBoundingClientRect();return new v.Point(h.clientX-c.left-l.clientLeft,h.clientY-c.top-l.clientTop)},G.touchPos=function(l,h){for(var c=l.getBoundingClientRect(),d=[],x=0;x<h.length;x++)d.push(new v.Point(h[x].clientX-c.left-l.clientLeft,h[x].clientY-c.top-l.clientTop));return d},G.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},G.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var ir=function(l){function h(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,x=this.requestors;d<x.length;d+=1){var T=x[d];this._notify(T.ids,T.callback)}this.requestors=[]}},h.prototype.getImage=function(c){return this.images[c]},h.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},h.prototype._validate=function(c,d){var x=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),x=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),x=!1),this._validateContent(d.content,d)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),x=!1),x},h.prototype._validateStretch=function(c,d){if(!c)return!0;for(var x=0,T=0,S=c;T<S.length;T+=1){var I=S[T];if(I[0]<x||I[1]<I[0]||d<I[1])return!1;x=I[1]}return!0},h.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},h.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},h.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(c,d){var x=!0;if(!this.isLoaded())for(var T=0,S=c;T<S.length;T+=1)this.images[S[T]]||(x=!1);this.isLoaded()||x?this._notify(c,d):this.requestors.push({ids:c,callback:d})},h.prototype._notify=function(c,d){for(var x={},T=0,S=c;T<S.length;T+=1){var I=S[T];this.images[I]||this.fire(new v.Event("styleimagemissing",{id:I}));var N=this.images[I];N?x[I]={data:N.data.clone(),pixelRatio:N.pixelRatio,sdf:N.sdf,version:N.version,stretchX:N.stretchX,stretchY:N.stretchY,content:N.content,hasRenderCallback:!!(N.userImage&&N.userImage.render)}:v.warnOnce('Image "'+I+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,x)},h.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},h.prototype.getPattern=function(c){var d=this.patterns[c],x=this.getImage(c);if(!x)return null;if(d&&d.position.version===x.version)return d.position;if(d)d.position.version=x.version;else{var T={w:x.data.width+2,h:x.data.height+2,x:0,y:0},S=new v.ImagePosition(T,x);this.patterns[c]={bin:T,position:S}}return this._updatePatternAtlas(),this.patterns[c].position},h.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var x=v.potpack(c),T=x.w,S=x.h,I=this.atlasImage;for(var N in I.resize({width:T||1,height:S||1}),this.patterns){var j=this.patterns[N].bin,ne=j.x+1,oe=j.y+1,se=this.images[N].data,we=se.width,be=se.height;v.RGBAImage.copy(se,I,{x:0,y:0},{x:ne,y:oe},{width:we,height:be}),v.RGBAImage.copy(se,I,{x:0,y:be-1},{x:ne,y:oe-1},{width:we,height:1}),v.RGBAImage.copy(se,I,{x:0,y:0},{x:ne,y:oe+be},{width:we,height:1}),v.RGBAImage.copy(se,I,{x:we-1,y:0},{x:ne-1,y:oe},{width:1,height:be}),v.RGBAImage.copy(se,I,{x:0,y:0},{x:ne+we,y:oe},{width:1,height:be})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(c){for(var d=0,x=c;d<x.length;d+=1){var T=x[d];if(!this.callbackDispatchedThisFrame[T]){this.callbackDispatchedThisFrame[T]=!0;var S=this.images[T];Yt(S)&&this.updateImage(T,S)}}},h}(v.Evented),or=Gr,Sr=Gr,_r=1e20;function Gr(l,h,c,d,x,T){this.fontSize=l||24,this.buffer=h===void 0?3:h,this.cutoff=d||.25,this.fontFamily=x||"sans-serif",this.fontWeight=T||"normal",this.radius=c||8;var S=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=S,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.d=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Int16Array(S),this.middle=Math.round(S/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function vn(l,h,c,d,x,T,S){for(var I=0;I<h;I++){for(var N=0;N<c;N++)d[N]=l[N*h+I];for(ii(d,x,T,S,c),N=0;N<c;N++)l[N*h+I]=x[N]}for(N=0;N<c;N++){for(I=0;I<h;I++)d[I]=l[N*h+I];for(ii(d,x,T,S,h),I=0;I<h;I++)l[N*h+I]=Math.sqrt(x[I])}}function ii(l,h,c,d,x){c[0]=0,d[0]=-_r,d[1]=+_r;for(var T=1,S=0;T<x;T++){for(var I=(l[T]+T*T-(l[c[S]]+c[S]*c[S]))/(2*T-2*c[S]);I<=d[S];)S--,I=(l[T]+T*T-(l[c[S]]+c[S]*c[S]))/(2*T-2*c[S]);c[++S]=T,d[S]=I,d[S+1]=+_r}for(T=0,S=0;T<x;T++){for(;d[S+1]<T;)S++;h[T]=(T-c[S])*(T-c[S])+l[c[S]]}}Gr.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var x=h.data[4*d+3]/255;this.gridOuter[d]=x===1?0:x===0?_r:Math.pow(Math.max(0,.5-x),2),this.gridInner[d]=x===1?_r:x===0?0:Math.pow(Math.max(0,x-.5),2)}for(vn(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),vn(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},or.default=Sr;var Yn=function(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}};Yn.prototype.setURL=function(l){this.url=l},Yn.prototype.getGlyphs=function(l,h){var c=this,d=[];for(var x in l)for(var T=0,S=l[x];T<S.length;T+=1)d.push({stack:x,id:S[T]});v.asyncAll(d,function(I,N){var j=I.stack,ne=I.id,oe=c.entries[j];oe||(oe=c.entries[j]={glyphs:{},requests:{},ranges:{}});var se=oe.glyphs[ne];if(se===void 0){if(se=c._tinySDF(oe,j,ne))return oe.glyphs[ne]=se,void N(null,{stack:j,id:ne,glyph:se});var we=Math.floor(ne/256);if(256*we>65535)N(new Error("glyphs > 65535 not supported"));else if(oe.ranges[we])N(null,{stack:j,id:ne,glyph:se});else{var be=oe.requests[we];be||(be=oe.requests[we]=[],Yn.loadGlyphRange(j,we,c.url,c.requestManager,function(Ze,ge){if(ge){for(var Ve in ge)c._doesCharSupportLocalGlyph(+Ve)||(oe.glyphs[+Ve]=ge[+Ve]);oe.ranges[we]=!0}for(var $e=0,ht=be;$e<ht.length;$e+=1)(0,ht[$e])(Ze,ge);delete oe.requests[we]})),be.push(function(Ze,ge){Ze?N(Ze):ge&&N(null,{stack:j,id:ne,glyph:ge[ne]||null})})}}else N(null,{stack:j,id:ne,glyph:se})},function(I,N){if(I)h(I);else if(N){for(var j={},ne=0,oe=N;ne<oe.length;ne+=1){var se=oe[ne],we=se.stack,be=se.id,Ze=se.glyph;(j[we]||(j[we]={}))[be]=Ze&&{id:Ze.id,bitmap:Ze.bitmap.clone(),metrics:Ze.metrics}}h(null,j)}})},Yn.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},Yn.prototype._tinySDF=function(l,h,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var x=l.tinySDF;if(!x){var T="400";/bold/i.test(h)?T="900":/medium/i.test(h)?T="500":/light/i.test(h)&&(T="200"),x=l.tinySDF=new Yn.TinySDF(24,3,8,.25,d,T)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},x.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Yn.loadGlyphRange=function(l,h,c,d,x){var T=256*h,S=T+255,I=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",T+"-"+S),v.ResourceType.Glyphs);v.getArrayBuffer(I,function(N,j){if(N)x(N);else if(j){for(var ne={},oe=0,se=v.parseGlyphPBF(j);oe<se.length;oe+=1){var we=se[oe];ne[we.id]=we}x(null,ne)}})},Yn.TinySDF=or;var xt=function(){this.specification=v.styleSpec.light.position};xt.prototype.possiblyEvaluate=function(l,h){return v.sphericalToCartesian(l.expression.evaluate(h))},xt.prototype.interpolate=function(l,h,c){return{x:v.number(l.x,h.x,c),y:v.number(l.y,h.y,c),z:v.number(l.z,h.z,c)}};var Pe=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new xt,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),Ft=function(l){function h(c){l.call(this),this._transitionable=new v.Transitionable(Pe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(v.validateLight,c,d))for(var x in c){var T=c[x];v.endsWith(x,"-transition")?this._transitionable.setTransition(x.slice(0,-11),T):this._transitionable.setValue(x,T)}},h.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},h.prototype._validate=function(c,d,x){return(!x||x.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},h}(v.Evented),tt=function(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};tt.prototype.getDash=function(l,h){var c=l.join(",")+String(h);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,h)),this.dashEntry[c]},tt.prototype.getDashRanges=function(l,h,c){var d=[],x=l.length%2==1?-l[l.length-1]*c:0,T=l[0]*c,S=!0;d.push({left:x,right:T,isDash:S,zeroLength:l[0]===0});for(var I=l[0],N=1;N<l.length;N++){var j=l[N];d.push({left:x=I*c,right:T=(I+=j)*c,isDash:S=!S,zeroLength:j===0})}return d},tt.prototype.addRoundDash=function(l,h,c){for(var d=h/2,x=-c;x<=c;x++)for(var T=this.width*(this.nextRow+c+x),S=0,I=l[S],N=0;N<this.width;N++){N/I.right>1&&(I=l[++S]);var j=Math.abs(N-I.left),ne=Math.abs(N-I.right),oe=Math.min(j,ne),se=void 0,we=x/c*(d+1);if(I.isDash){var be=d-Math.abs(we);se=Math.sqrt(oe*oe+be*be)}else se=d-Math.sqrt(oe*oe+we*we);this.data[T+N]=Math.max(0,Math.min(255,se+128))}},tt.prototype.addRegularDash=function(l){for(var h=l.length-1;h>=0;--h){var c=l[h],d=l[h+1];c.zeroLength?l.splice(h,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(h,1))}var x=l[0],T=l[l.length-1];x.isDash===T.isDash&&(x.left=T.left-this.width,T.right=x.right+this.width);for(var S=this.width*this.nextRow,I=0,N=l[I],j=0;j<this.width;j++){j/N.right>1&&(N=l[++I]);var ne=Math.abs(j-N.left),oe=Math.abs(j-N.right),se=Math.min(ne,oe);this.data[S+j]=Math.max(0,Math.min(255,(N.isDash?se:-se)+128))}},tt.prototype.addDash=function(l,h){var c=h?7:0,d=2*c+1;if(this.nextRow+d>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var x=0,T=0;T<l.length;T++)x+=l[T];if(x!==0){var S=this.width/x,I=this.getDashRanges(l,this.width,S);h?this.addRoundDash(I,S,c):this.addRegularDash(I)}var N={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:x};return this.nextRow+=d,this.dirty=!0,N},tt.prototype.bind=function(l){var h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var Jt=function l(h,c){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var d=this.workerPool.acquire(this.id),x=0;x<d.length;x++){var T=new l.Actor(d[x],c,this.id);T.name="Worker "+x,this.actors.push(T)}};function wr(l,h,c){var d=function(x,T){if(x)return c(x);if(T){var S=v.pick(v.extend(T,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(S.vectorLayers=T.vector_layers,S.vectorLayerIds=S.vectorLayers.map(function(I){return I.id})),S.tiles=h.canonicalizeTileset(S,l.url),c(null,S)}};return l.url?v.getJSON(h.transformRequest(h.normalizeSourceURL(l.url),v.ResourceType.Source),d):v.browser.frame(function(){return d(null,l)})}Jt.prototype.broadcast=function(l,h,c){v.asyncAll(this.actors,function(d,x){d.send(l,h,x)},c=c||function(){})},Jt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Jt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Jt.Actor=v.Actor;var $=function(l,h,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=c||24};$.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},$.prototype.contains=function(l){var h=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*h),d=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*h),x=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*h),T=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*h);return l.x>=c&&l.x<x&&l.y>=d&&l.y<T};var me=function(l){function h(c,d,x,T){if(l.call(this),this.id=c,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(d,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,function(d,x){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):x&&(v.extend(c,x),x.bounds&&(c.tileBounds=new $(x.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(x.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(x.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},h.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return v.extend({},this._options)},h.prototype.loadTile=function(c,d){var x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),T={request:this.map._requestManager.transformRequest(x,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function S(I,N){return delete c.request,c.aborted?d(null):I&&I.status!==404?d(I):(N&&N.resourceTiming&&(c.resourceTiming=N.resourceTiming),this.map._refreshExpiredTiles&&N&&c.setExpiryData(N),c.loadVectorData(N,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}T.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",T,S.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",T,S.bind(this)))},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(v.Evented),W=function(l){function h(c,d,x,T){l.call(this),this.id=c,this.dispatcher=x,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},d),v.extend(this,v.pick(d,["url","scheme","tileSize"]))}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,function(d,x){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):x&&(v.extend(c,x),x.bounds&&(c.tileBounds=new $(x.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(x.tiles),v.postMapLoadEvent(x.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return v.extend({},this._options)},h.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},h.prototype.loadTile=function(c,d){var x=this,T=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(T,v.ResourceType.Tile),function(S,I){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(S)c.state="errored",d(S);else if(I){x.map._refreshExpiredTiles&&c.setExpiryData(I),delete I.cacheControl,delete I.expires;var N=x.map.painter.context,j=N.gl;c.texture=x.map.painter.getTileTexture(I.width),c.texture?c.texture.update(I,{useMipmap:!0}):(c.texture=new v.Texture(N,I,j.RGBA,{useMipmap:!0}),c.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST),N.extTextureFilterAnisotropic&&j.texParameterf(j.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(x.dispatcher),d(null)}})},h.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},h.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},h.prototype.hasTransition=function(){return!1},h}(v.Evented),he=function(l){function h(c,d,x,T){l.call(this,c,d,x,T),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(c,d){var x=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function T(S,I){S&&(c.state="errored",d(S)),I&&(c.dem=I,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=v.getImage(this.map._requestManager.transformRequest(x,v.ResourceType.Tile),function(S,I){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(S)c.state="errored",d(S);else if(I){this.map._refreshExpiredTiles&&c.setExpiryData(I),delete I.cacheControl,delete I.expires;var N=v.window.ImageBitmap&&I instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?I:v.browser.getImageData(I,1),j={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:N,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",j,T.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},h.prototype._getNeighboringTiles=function(c){var d=c.canonical,x=Math.pow(2,d.z),T=(d.x-1+x)%x,S=d.x===0?c.wrap-1:c.wrap,I=(d.x+1+x)%x,N=d.x+1===x?c.wrap+1:c.wrap,j={};return j[new v.OverscaledTileID(c.overscaledZ,S,d.z,T,d.y).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,N,d.z,I,d.y).key]={backfilled:!1},d.y>0&&(j[new v.OverscaledTileID(c.overscaledZ,S,d.z,T,d.y-1).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,N,d.z,I,d.y-1).key]={backfilled:!1}),d.y+1<x&&(j[new v.OverscaledTileID(c.overscaledZ,S,d.z,T,d.y+1).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},j[new v.OverscaledTileID(c.overscaledZ,N,d.z,I,d.y+1).key]={backfilled:!1}),j},h.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},h}(W),ae=function(l){function h(c,d,x,T){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=x.getActor(),this.setEventedParent(T),this._data=d.data,this._options=v.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var S=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*S,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*S,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:v.EXTENT,radius:(d.clusterRadius||50)*S,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new v.ErrorEvent(d));else{var x={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(x.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",x))}})},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(x){if(x)d.fire(new v.ErrorEvent(x));else{var T={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(T.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new v.Event("data",T))}}),this},h.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},h.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},h.prototype.getClusterLeaves=function(c,d,x,T){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:x},T),this},h.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var x=v.extend({},this.workerOptions),T=this._data;typeof T=="string"?(x.request=this.map._requestManager.transformRequest(v.browser.resolveURL(T),v.ResourceType.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(T),this.actor.send(this.type+".loadData",x,function(S,I){d._removed||I&&I.abandoned||(d._loaded=!0,I&&I.resourceTiming&&I.resourceTiming[d.id]&&(d._resourceTiming=I.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:x.source},null),c(S))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(c,d){var x=this,T=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(T,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(S,I){return delete c.request,c.unloadVectorData(),c.aborted?d(null):S?d(S):(c.loadVectorData(I,x.map.painter,T==="reloadTile"),d(null))})},h.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},h.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(v.Evented),Me=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),je=function(l){function h(c,d,x,T){l.call(this),this.id=c,this.dispatcher=x,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(c,d){var x=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(T,S){x._loaded=!0,T?x.fire(new v.ErrorEvent(T)):S&&(x.image=S,c&&(x.coordinates=c),d&&d(),x._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(c){this.map=c,this.load()},h.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var x=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(S){for(var I=1/0,N=1/0,j=-1/0,ne=-1/0,oe=0,se=S;oe<se.length;oe+=1){var we=se[oe];I=Math.min(I,we.x),N=Math.min(N,we.y),j=Math.max(j,we.x),ne=Math.max(ne,we.y)}var be=Math.max(j-I,ne-N),Ze=Math.max(0,Math.floor(-Math.log(be)/Math.LN2)),ge=Math.pow(2,Ze);return new v.CanonicalTileID(Ze,Math.floor((I+j)/2*ge),Math.floor((N+ne)/2*ge))}(x),this.minzoom=this.maxzoom=this.tileID.z;var T=x.map(function(S){return d.tileID.getTilePoint(S)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(T[0].x,T[0].y,0,0),this._boundsArray.emplaceBack(T[1].x,T[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(T[3].x,T[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(T[2].x,T[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Me.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[x];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},h.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(v.Evented),ut=function(l){function h(c,d,x,T){l.call(this,c,d,x,T),this.roundZoom=!0,this.type="video",this.options=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var x=0,T=d.urls;x<T.length;x+=1)this.urls.push(this.map._requestManager.transformRequest(T[x],v.ResourceType.Source).url);v.getVideo(this.urls,function(S,I){c._loaded=!0,S?c.fire(new v.ErrorEvent(S)):I&&(c.video=I,c.video.loop=!0,c.video.setAttribute("playsinline",""),c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Me.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[x];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(je),St=function(l){function h(c,d,x,T){l.call(this,c,d,x,T),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(S){return!Array.isArray(S)||S.length!==2||S.some(function(I){return typeof I!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,x=d.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,Me.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(d,this.canvas,x.RGBA,{premultiply:!0}),this.tiles){var S=this.tiles[T];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var x=d[c];if(isNaN(x)||x<=0)return!0}return!1},h}(je),bt={vector:me,raster:W,"raster-dem":he,geojson:ae,video:ut,image:je,canvas:St};function Lr(l,h){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(h.toUnwrapped()))}function Cr(l,h,c,d,x,T){var S=function(Ze,ge,Ve){if(Ze)for(var $e=0,ht=Ze;$e<ht.length;$e+=1){var Lt=ge[ht[$e]];if(Lt&&Lt.source===Ve&&Lt.type==="fill-extrusion")return!0}else for(var Tt in ge){var jt=ge[Tt];if(jt.source===Ve&&jt.type==="fill-extrusion")return!0}return!1}(x&&x.layers,h,l.id),I=T.maxPitchScaleFactor(),N=l.tilesIn(d,I,S);N.sort(On);for(var j=[],ne=0,oe=N;ne<oe.length;ne+=1){var se=oe[ne];j.push({wrappedTileID:se.tileID.wrapped().key,queryResults:se.tile.queryRenderedFeatures(h,c,l._state,se.queryGeometry,se.cameraQueryGeometry,se.scale,x,T,I,Lr(l.transform,se.tileID))})}var we=function(Ze){for(var ge={},Ve={},$e=0,ht=Ze;$e<ht.length;$e+=1){var Lt=ht[$e],Tt=Lt.queryResults,jt=Lt.wrappedTileID,ar=Ve[jt]=Ve[jt]||{};for(var Ir in Tt)for(var Tr=Tt[Ir],Qr=ar[Ir]=ar[Ir]||{},mn=ge[Ir]=ge[Ir]||[],Cn=0,_n=Tr;Cn<_n.length;Cn+=1){var wi=_n[Cn];Qr[wi.featureIndex]||(Qr[wi.featureIndex]=!0,mn.push(wi))}}return ge}(j);for(var be in we)we[be].forEach(function(Ze){var ge=Ze.feature,Ve=l.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Ve});return we}function On(l,h){var c=l.tileID,d=h.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Xr=function(l,h){this.max=l,this.onRemove=h,this.reset()};Xr.prototype.reset=function(){for(var l in this.data)for(var h=0,c=this.data[l];h<c.length;h+=1){var d=c[h];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Xr.prototype.add=function(l,h,c){var d=this,x=l.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);var T={value:h,timeout:void 0};if(c!==void 0&&(T.timeout=setTimeout(function(){d.remove(l,T)},c)),this.data[x].push(T),this.order.push(x),this.order.length>this.max){var S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this},Xr.prototype.has=function(l){return l.wrapped().key in this.data},Xr.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Xr.prototype._getAndRemoveByKey=function(l){var h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value},Xr.prototype.getByKey=function(l){var h=this.data[l];return h?h[0].value:null},Xr.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Xr.prototype.remove=function(l,h){if(!this.has(l))return this;var c=l.wrapped().key,d=h===void 0?0:this.data[c].indexOf(h),x=this.data[c][d];return this.data[c].splice(d,1),x.timeout&&clearTimeout(x.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(x.value),this.order.splice(this.order.indexOf(c),1),this},Xr.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},Xr.prototype.filter=function(l){var h=[];for(var c in this.data)for(var d=0,x=this.data[c];d<x.length;d+=1){var T=x[d];l(T.value)||h.push(T)}for(var S=0,I=h;S<I.length;S+=1){var N=I[S];this.remove(N.value.tileID,N)}};var xn=function(l,h,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};xn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},xn.prototype.updateData=function(l){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},xn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Yr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},rn=function(l,h,c,d){this.length=h.length,this.attributes=c,this.itemSize=h.bytesPerElement,this.dynamicDraw=d,this.context=l;var x=l.gl;this.buffer=x.createBuffer(),l.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};rn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},rn.prototype.updateData=function(l){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)},rn.prototype.enableAttributes=function(l,h){for(var c=0;c<this.attributes.length;c++){var d=h.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},rn.prototype.setVertexAttribPointers=function(l,h,c){for(var d=0;d<this.attributes.length;d++){var x=this.attributes[d],T=h.attributes[x.name];T!==void 0&&l.vertexAttribPointer(T,x.components,l[Yr[x.type]],!1,this.itemSize,x.offset+this.itemSize*(c||0))}},rn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Kr=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Kr.prototype.get=function(){return this.current},Kr.prototype.set=function(l){},Kr.prototype.getDefault=function(){return this.default},Kr.prototype.setDefault=function(){this.set(this.default)};var Qn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return v.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(Kr),Ur=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},h}(Kr),Mn=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},h}(Kr),$r=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(Kr),un=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},h}(Kr),zi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},h}(Kr),gi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},h}(Kr),_o=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},h}(Kr),Ii=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},h}(Kr),ie=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},h}(Kr),Wi=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},h}(Kr),Ji=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},h}(Kr),to=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},h}(Kr),aa=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},h}(Kr),ea=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return v.Color.transparent},h.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},h}(Kr),Bs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},h}(Kr),Vo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},h}(Kr),Ws=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},h}(Kr),_u=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},h}(Kr),Do=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},h}(Kr),uo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},h}(Kr),lo=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},h.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},h}(Kr),ot=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},h}(Kr),z=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(Kr),K=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},h}(Kr),de=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},h}(Kr),Fe=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},h}(Kr),Ce=function(l){function h(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},h}(Kr),Nt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},h}(Kr),Bt=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},h}(Kr),sr=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},h}(Kr),It=function(l){function h(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(Kr),B=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},h}(It),P=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},h}(It),V=function(l,h,c,d){this.context=l,this.width=h,this.height=c;var x=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new B(l,x),d&&(this.depthAttachment=new P(l,x))};V.prototype.destroy=function(){var l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var Y=function(l,h,c){this.func=l,this.mask=h,this.range=c};Y.ReadOnly=!1,Y.ReadWrite=!0,Y.disabled=new Y(519,Y.ReadOnly,[0,1]);var ce=function(l,h,c,d,x,T){this.test=l,this.ref=h,this.mask=c,this.fail=d,this.depthFail=x,this.pass=T};ce.disabled=new ce({func:519,mask:0},0,0,7680,7680,7680);var Se=function(l,h,c){this.blendFunction=l,this.blendColor=h,this.mask=c};Se.disabled=new Se(Se.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Se.unblended=new Se(Se.Replace,v.Color.transparent,[!0,!0,!0,!0]),Se.alphaBlended=new Se([1,771],v.Color.transparent,[!0,!0,!0,!0]);var Ue=function(l,h,c){this.enable=l,this.mode=h,this.frontFace=c};Ue.disabled=new Ue(!1,1029,2305),Ue.backCCW=new Ue(!0,1029,2305);var Q=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Qn(this),this.clearDepth=new Ur(this),this.clearStencil=new Mn(this),this.colorMask=new $r(this),this.depthMask=new un(this),this.stencilMask=new zi(this),this.stencilFunc=new gi(this),this.stencilOp=new _o(this),this.stencilTest=new Ii(this),this.depthRange=new ie(this),this.depthTest=new Wi(this),this.depthFunc=new Ji(this),this.blend=new to(this),this.blendFunc=new aa(this),this.blendColor=new ea(this),this.blendEquation=new Bs(this),this.cullFace=new Vo(this),this.cullFaceSide=new Ws(this),this.frontFace=new _u(this),this.program=new Do(this),this.activeTexture=new uo(this),this.viewport=new lo(this),this.bindFramebuffer=new ot(this),this.bindRenderbuffer=new z(this),this.bindTexture=new K(this),this.bindVertexBuffer=new de(this),this.bindElementBuffer=new Fe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ce(this),this.pixelStoreUnpack=new Nt(this),this.pixelStoreUnpackPremultiplyAlpha=new Bt(this),this.pixelStoreUnpackFlipY=new sr(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};Q.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Q.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Q.prototype.createIndexBuffer=function(l,h){return new xn(this,l,h)},Q.prototype.createVertexBuffer=function(l,h,c){return new rn(this,l,h,c)},Q.prototype.createRenderbuffer=function(l,h,c){var d=this.gl,x=d.createRenderbuffer();return this.bindRenderbuffer.set(x),d.renderbufferStorage(d.RENDERBUFFER,l,h,c),this.bindRenderbuffer.set(null),x},Q.prototype.createFramebuffer=function(l,h,c){return new V(this,l,h,c)},Q.prototype.clear=function(l){var h=l.color,c=l.depth,d=this.gl,x=0;h&&(x|=d.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(x|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(x)},Q.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},Q.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},Q.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},Q.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,Se.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},Q.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ve=function(l){function h(c,d,x){var T=this;l.call(this),this.id=c,this.dispatcher=x,this.on("data",function(S){S.dataType==="source"&&S.sourceDataType==="metadata"&&(T._sourceLoaded=!0),T._sourceLoaded&&!T._paused&&S.dataType==="source"&&S.sourceDataType==="content"&&(T.reload(),T.transform&&T.update(T.transform))}),this.on("error",function(){T._sourceErrored=!0}),this._source=function(S,I,N,j){var ne=new bt[I.type](S,I,N,j);if(ne.id!==S)throw new Error("Expected Source id to be "+S+" instead of "+ne.id);return v.bindAll(["load","abort","unload","serialize","prepare"],ne),ne}(c,d,x,this),this._tiles={},this._cache=new Xr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},h.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},h.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},h.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var x=this._tiles[d];x.upload(c),x.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(rt).map(function(c){return c.key})},h.prototype.getRenderableIds=function(c){var d=this,x=[];for(var T in this._tiles)this._isIdRenderable(T,c)&&x.push(this._tiles[T]);return c?x.sort(function(S,I){var N=S.tileID,j=I.tileID,ne=new v.Point(N.canonical.x,N.canonical.y)._rotate(d.transform.angle),oe=new v.Point(j.canonical.x,j.canonical.y)._rotate(d.transform.angle);return N.overscaledZ-j.overscaledZ||oe.y-ne.y||oe.x-ne.x}).map(function(S){return S.tileID.key}):x.map(function(S){return S.tileID}).sort(rt).map(function(S){return S.key})},h.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},h.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},h.prototype._reloadTile=function(c,d){var x=this._tiles[c];x&&(x.state!=="loading"&&(x.state=d),this._loadTile(x,this._tileLoaded.bind(this,x,c,d)))},h.prototype._tileLoaded=function(c,d,x,T){if(T)return c.state="errored",void(T.status!==404?this._source.fire(new v.ErrorEvent(T,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),x==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},h.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),x=0;x<d.length;x++){var T=d[x];if(c.neighboringTiles&&c.neighboringTiles[T]){var S=this.getTileByID(T);I(c,S),I(S,c)}}function I(N,j){N.needsHillshadePrepare=!0;var ne=j.tileID.canonical.x-N.tileID.canonical.x,oe=j.tileID.canonical.y-N.tileID.canonical.y,se=Math.pow(2,N.tileID.canonical.z),we=j.tileID.key;ne===0&&oe===0||Math.abs(oe)>1||(Math.abs(ne)>1&&(Math.abs(ne+se)===1?ne+=se:Math.abs(ne-se)===1&&(ne-=se)),j.dem&&N.dem&&(N.dem.backfillBorder(j.dem,ne,oe),N.neighboringTiles&&N.neighboringTiles[we]&&(N.neighboringTiles[we].backfilled=!0)))}},h.prototype.getTile=function(c){return this.getTileByID(c.key)},h.prototype.getTileByID=function(c){return this._tiles[c]},h.prototype._retainLoadedChildren=function(c,d,x,T){for(var S in this._tiles){var I=this._tiles[S];if(!(T[S]||!I.hasData()||I.tileID.overscaledZ<=d||I.tileID.overscaledZ>x)){for(var N=I.tileID;I&&I.tileID.overscaledZ>d+1;){var j=I.tileID.scaledTo(I.tileID.overscaledZ-1);(I=this._tiles[j.key])&&I.hasData()&&(N=j)}for(var ne=N;ne.overscaledZ>d;)if(c[(ne=ne.scaledTo(ne.overscaledZ-1)).key]){T[N.key]=N;break}}}},h.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var x=this._loadedParentTiles[c.key];return x&&x.tileID.overscaledZ>=d?x:null}for(var T=c.overscaledZ-1;T>=d;T--){var S=c.scaledTo(T),I=this._getLoadedTile(S);if(I)return I}},h.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},h.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,x=Math.ceil(c.height/this._source.tileSize)+1,T=Math.floor(d*x*5),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(S)},h.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var x={};for(var T in this._tiles){var S=this._tiles[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+d),x[S.tileID.key]=S}for(var I in this._tiles=x,this._timers)clearTimeout(this._timers[I]),delete this._timers[I];for(var N in this._tiles)this._setTileReloadTimer(N,this._tiles[N])}},h.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var x;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?x=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(ar){return new v.OverscaledTileID(ar.canonical.z,ar.wrap,ar.canonical.z,ar.canonical.x,ar.canonical.y)}):(x=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(x=x.filter(function(ar){return d._source.hasTile(ar)}))):x=[];var T=c.coveringZoomLevel(this._source),S=Math.max(T-h.maxOverzooming,this._source.minzoom),I=Math.max(T+h.maxUnderzooming,this._source.minzoom),N=this._updateRetainedTiles(x,T);if(wt(this._source.type)){for(var j={},ne={},oe=0,se=Object.keys(N);oe<se.length;oe+=1){var we=se[oe],be=N[we],Ze=this._tiles[we];if(Ze&&!(Ze.fadeEndTime&&Ze.fadeEndTime<=v.browser.now())){var ge=this.findLoadedParent(be,S);ge&&(this._addTile(ge.tileID),j[ge.tileID.key]=ge.tileID),ne[we]=be}}for(var Ve in this._retainLoadedChildren(ne,T,I,N),j)N[Ve]||(this._coveredTiles[Ve]=!0,N[Ve]=j[Ve])}for(var $e in N)this._tiles[$e].clearFadeHold();for(var ht=0,Lt=v.keysDifference(this._tiles,N);ht<Lt.length;ht+=1){var Tt=Lt[ht],jt=this._tiles[Tt];jt.hasSymbolBuckets&&!jt.holdingForFade()?jt.setHoldDuration(this.map._fadeDuration):jt.hasSymbolBuckets&&!jt.symbolFadeFinished()||this._removeTile(Tt)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},h.prototype._updateRetainedTiles=function(c,d){for(var x={},T={},S=Math.max(d-h.maxOverzooming,this._source.minzoom),I=Math.max(d+h.maxUnderzooming,this._source.minzoom),N={},j=0,ne=c;j<ne.length;j+=1){var oe=ne[j],se=this._addTile(oe);x[oe.key]=oe,se.hasData()||d<this._source.maxzoom&&(N[oe.key]=oe)}this._retainLoadedChildren(N,d,I,x);for(var we=0,be=c;we<be.length;we+=1){var Ze=be[we],ge=this._tiles[Ze.key];if(!ge.hasData()){if(d+1>this._source.maxzoom){var Ve=Ze.children(this._source.maxzoom)[0],$e=this.getTile(Ve);if($e&&$e.hasData()){x[Ve.key]=Ve;continue}}else{var ht=Ze.children(this._source.maxzoom);if(x[ht[0].key]&&x[ht[1].key]&&x[ht[2].key]&&x[ht[3].key])continue}for(var Lt=ge.wasRequested(),Tt=Ze.overscaledZ-1;Tt>=S;--Tt){var jt=Ze.scaledTo(Tt);if(T[jt.key]||(T[jt.key]=!0,!(ge=this.getTile(jt))&&Lt&&(ge=this._addTile(jt)),ge&&(x[jt.key]=jt,Lt=ge.wasRequested(),ge.hasData())))break}}}return x},h.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],x=void 0,T=this._tiles[c].tileID;T.overscaledZ>0;){if(T.key in this._loadedParentTiles){x=this._loadedParentTiles[T.key];break}d.push(T.key);var S=T.scaledTo(T.overscaledZ-1);if(x=this._getLoadedTile(S))break;T=S}for(var I=0,N=d;I<N.length;I+=1)this._loadedParentTiles[N[I]]=x}},h.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var x=!!d;return x||(d=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,x||this._source.fire(new v.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},h.prototype._setTileReloadTimer=function(c,d){var x=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var T=d.getExpiryTimeout();T&&(this._timers[c]=setTimeout(function(){x._reloadTile(c,"expired"),delete x._timers[c]},T))},h.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},h.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},h.prototype.tilesIn=function(c,d,x){var T=this,S=[],I=this.transform;if(!I)return S;for(var N=x?I.getCameraQueryGeometry(c):c,j=c.map(function(Tt){return I.pointCoordinate(Tt)}),ne=N.map(function(Tt){return I.pointCoordinate(Tt)}),oe=this.getIds(),se=1/0,we=1/0,be=-1/0,Ze=-1/0,ge=0,Ve=ne;ge<Ve.length;ge+=1){var $e=Ve[ge];se=Math.min(se,$e.x),we=Math.min(we,$e.y),be=Math.max(be,$e.x),Ze=Math.max(Ze,$e.y)}for(var ht=function(Tt){var jt=T._tiles[oe[Tt]];if(!jt.holdingForFade()){var ar=jt.tileID,Ir=Math.pow(2,I.zoom-jt.tileID.overscaledZ),Tr=d*jt.queryPadding*v.EXTENT/jt.tileSize/Ir,Qr=[ar.getTilePoint(new v.MercatorCoordinate(se,we)),ar.getTilePoint(new v.MercatorCoordinate(be,Ze))];if(Qr[0].x-Tr<v.EXTENT&&Qr[0].y-Tr<v.EXTENT&&Qr[1].x+Tr>=0&&Qr[1].y+Tr>=0){var mn=j.map(function(_n){return ar.getTilePoint(_n)}),Cn=ne.map(function(_n){return ar.getTilePoint(_n)});S.push({tile:jt,tileID:ar,queryGeometry:mn,cameraQueryGeometry:Cn,scale:Ir})}}},Lt=0;Lt<oe.length;Lt++)ht(Lt);return S},h.prototype.getVisibleCoordinates=function(c){for(var d=this,x=this.getRenderableIds(c).map(function(N){return d._tiles[N].tileID}),T=0,S=x;T<S.length;T+=1){var I=S[T];I.posMatrix=this.transform.calculatePosMatrix(I.toUnwrapped())}return x},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(wt(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=v.browser.now())return!0}return!1},h.prototype.setFeatureState=function(c,d,x){this._state.updateState(c=c||"_geojsonTileLayer",d,x)},h.prototype.removeFeatureState=function(c,d,x){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,x)},h.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},h.prototype.setDependencies=function(c,d,x){var T=this._tiles[c];T&&T.setDependencies(d,x)},h.prototype.reloadTilesForDependencies=function(c,d){for(var x in this._tiles)this._tiles[x].hasDependency(c,d)&&this._reloadTile(x,"reloading");this._cache.filter(function(T){return!T.hasDependency(c,d)})},h}(v.Evented);function rt(l,h){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*h.wrap)-+(h.wrap<0);return l.overscaledZ-h.overscaledZ||d-c||h.canonical.y-l.canonical.y||h.canonical.x-l.canonical.x}function wt(l){return l==="raster"||l==="image"||l==="video"}function nr(){return new v.window.Worker(Dc.workerUrl)}ve.maxOverzooming=10,ve.maxUnderzooming=3;var _t="mapboxgl_preloaded_worker_pool",Qt=function(){this.active={}};Qt.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<Qt.workerCount;)this.workers.push(new nr);return this.active[l]=!0,this.workers.slice()},Qt.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},Qt.prototype.isPreloaded=function(){return!!this.active[_t]},Qt.prototype.numActive=function(){return Object.keys(this.active).length};var Br,Fr=Math.floor(v.browser.hardwareConcurrency/2);function Mt(){return Br||(Br=new Qt),Br}function Dr(l,h){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return v.refProperties.forEach(function(x){x in h&&(c[x]=h[x])}),c}function Er(l){l=l.slice();for(var h=Object.create(null),c=0;c<l.length;c++)h[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=Dr(l[d],h[l[d].ref]));return l}Qt.workerCount=Math.max(Math.min(Fr,6),1);var Rr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function zn(l,h,c){c.push({command:Rr.addSource,args:[l,h[l]]})}function jr(l,h,c){h.push({command:Rr.removeSource,args:[l]}),c[l]=!0}function qn(l,h,c,d){jr(l,c,d),zn(l,h,c)}function Li(l,h,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],h[c][d]))return!1;for(d in h[c])if(h[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],h[c][d]))return!1;return!0}function ei(l,h,c,d,x,T){var S;for(S in h=h||{},l=l||{})l.hasOwnProperty(S)&&(v.deepEqual(l[S],h[S])||c.push({command:T,args:[d,S,h[S],x]}));for(S in h)h.hasOwnProperty(S)&&!l.hasOwnProperty(S)&&(v.deepEqual(l[S],h[S])||c.push({command:T,args:[d,S,h[S],x]}))}function Ai(l){return l.id}function di(l,h){return l[h.id]=h,l}var Aa=function(l,h){this.reset(l,h)};Aa.prototype.reset=function(l,h){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Aa.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var h=1,c=this._distances[h],d=l*this.paddedLength+this.padding;c<d&&h<this._distances.length;)c=this._distances[++h];var x=h-1,T=this._distances[x],S=c-T,I=S>0?(d-T)/S:0;return this.points[x].mult(1-I).add(this.points[h].mult(I))};var Bi=function(l,h,c){var d=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(h/c);for(var T=0;T<this.xCellCount*this.yCellCount;T++)d.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function ro(l,h,c,d,x){var T=v.create();return h?(v.scale(T,T,[1/x,1/x,1]),c||v.rotateZ(T,T,d.angle)):v.multiply(T,d.labelPlaneMatrix,l),T}function mi(l,h,c,d,x){if(h){var T=v.clone(l);return v.scale(T,T,[x,x,1]),c||v.rotateZ(T,T,-d.angle),T}return d.glCoordMatrix}function Jn(l,h){var c=[l.x,l.y,0,1];yo(c,c,h);var d=c[3];return{point:new v.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function oi(l,h){return .5+l/h*.5}function bo(l,h){var c=l[0]/l[3],d=l[1]/l[3];return c>=-h[0]&&c<=h[0]&&d>=-h[1]&&d<=h[1]}function Fs(l,h,c,d,x,T,S,I){var N=d?l.textSizeData:l.iconSizeData,j=v.evaluateSizeForZoom(N,c.transform.zoom),ne=[256/c.width*2+1,256/c.height*2+1],oe=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;oe.clear();for(var se=l.lineVertexArray,we=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,be=c.transform.width/c.transform.height,Ze=!1,ge=0;ge<we.length;ge++){var Ve=we.get(ge);if(Ve.hidden||Ve.writingMode===v.WritingMode.vertical&&!Ze)no(Ve.numGlyphs,oe);else{Ze=!1;var $e=[Ve.anchorX,Ve.anchorY,0,1];if(v.transformMat4($e,$e,h),bo($e,ne)){var ht=oi(c.transform.cameraToCenterDistance,$e[3]),Lt=v.evaluateSizeForFeature(N,j,Ve),Tt=S?Lt/ht:Lt*ht,jt=new v.Point(Ve.anchorX,Ve.anchorY),ar=Jn(jt,x).point,Ir={},Tr=yu(Ve,Tt,!1,I,h,x,T,l.glyphOffsetArray,se,oe,ar,jt,Ir,be);Ze=Tr.useVertical,(Tr.notEnoughRoom||Ze||Tr.needsFlipping&&yu(Ve,Tt,!0,I,h,x,T,l.glyphOffsetArray,se,oe,ar,jt,Ir,be).notEnoughRoom)&&no(Ve.numGlyphs,oe)}else no(Ve.numGlyphs,oe)}}d?l.text.dynamicLayoutVertexBuffer.updateData(oe):l.icon.dynamicLayoutVertexBuffer.updateData(oe)}function eo(l,h,c,d,x,T,S,I,N,j,ne){var oe=I.glyphStartIndex+I.numGlyphs,se=I.lineStartIndex,we=I.lineStartIndex+I.lineLength,be=h.getoffsetX(I.glyphStartIndex),Ze=h.getoffsetX(oe-1),ge=Gi(l*be,c,d,x,T,S,I.segment,se,we,N,j,ne);if(!ge)return null;var Ve=Gi(l*Ze,c,d,x,T,S,I.segment,se,we,N,j,ne);return Ve?{first:ge,last:Ve}:null}function co(l,h,c,d){return l===v.WritingMode.horizontal&&Math.abs(c.y-h.y)>Math.abs(c.x-h.x)*d?{useVertical:!0}:(l===v.WritingMode.vertical?h.y<c.y:h.x>c.x)?{needsFlipping:!0}:null}function yu(l,h,c,d,x,T,S,I,N,j,ne,oe,se,we){var be,Ze=h/24,ge=l.lineOffsetX*Ze,Ve=l.lineOffsetY*Ze;if(l.numGlyphs>1){var $e=l.glyphStartIndex+l.numGlyphs,ht=l.lineStartIndex,Lt=l.lineStartIndex+l.lineLength,Tt=eo(Ze,I,ge,Ve,c,ne,oe,l,N,T,se);if(!Tt)return{notEnoughRoom:!0};var jt=Jn(Tt.first.point,S).point,ar=Jn(Tt.last.point,S).point;if(d&&!c){var Ir=co(l.writingMode,jt,ar,we);if(Ir)return Ir}be=[Tt.first];for(var Tr=l.glyphStartIndex+1;Tr<$e-1;Tr++)be.push(Gi(Ze*I.getoffsetX(Tr),ge,Ve,c,ne,oe,l.segment,ht,Lt,N,T,se));be.push(Tt.last)}else{if(d&&!c){var Qr=Jn(oe,x).point,mn=l.lineStartIndex+l.segment+1,Cn=new v.Point(N.getx(mn),N.gety(mn)),_n=Jn(Cn,x),wi=_n.signedDistanceFromCamera>0?_n.point:_s(oe,Cn,Qr,1,x),nn=co(l.writingMode,Qr,wi,we);if(nn)return nn}var Vn=Gi(Ze*I.getoffsetX(l.glyphStartIndex),ge,Ve,c,ne,oe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,N,T,se);if(!Vn)return{notEnoughRoom:!0};be=[Vn]}for(var ri=0,Zn=be;ri<Zn.length;ri+=1){var Fn=Zn[ri];v.addDynamicAttributes(j,Fn.point,Fn.angle)}return{}}function _s(l,h,c,d,x){var T=Jn(l.add(l.sub(h)._unit()),x).point,S=c.sub(T);return c.add(S._mult(d/S.mag()))}function Gi(l,h,c,d,x,T,S,I,N,j,ne,oe){var se=d?l-h:l+h,we=se>0?1:-1,be=0;d&&(we*=-1,be=Math.PI),we<0&&(be+=Math.PI);for(var Ze=we>0?I+S:I+S+1,ge=x,Ve=x,$e=0,ht=0,Lt=Math.abs(se),Tt=[];$e+ht<=Lt;){if((Ze+=we)<I||Ze>=N)return null;if(Ve=ge,Tt.push(ge),(ge=oe[Ze])===void 0){var jt=new v.Point(j.getx(Ze),j.gety(Ze)),ar=Jn(jt,ne);if(ar.signedDistanceFromCamera>0)ge=oe[Ze]=ar.point;else{var Ir=Ze-we;ge=_s($e===0?T:new v.Point(j.getx(Ir),j.gety(Ir)),jt,Ve,Lt-$e+1,ne)}}$e+=ht,ht=Ve.dist(ge)}var Tr=(Lt-$e)/ht,Qr=ge.sub(Ve),mn=Qr.mult(Tr)._add(Ve);mn._add(Qr._unit()._perp()._mult(c*we));var Cn=be+Math.atan2(ge.y-Ve.y,ge.x-Ve.x);return Tt.push(mn),{point:mn,angle:Cn,path:Tt}}Bi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Bi.prototype.insert=function(l,h,c,d,x){this._forEachCell(h,c,d,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(x)},Bi.prototype.insertCircle=function(l,h,c,d){this._forEachCell(h-d,c-d,h+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(c),this.circles.push(d)},Bi.prototype._insertBoxCell=function(l,h,c,d,x,T){this.boxCells[x].push(T)},Bi.prototype._insertCircleCell=function(l,h,c,d,x,T){this.circleCells[x].push(T)},Bi.prototype._query=function(l,h,c,d,x,T){if(c<0||l>this.width||d<0||h>this.height)return!x&&[];var S=[];if(l<=0&&h<=0&&this.width<=c&&this.height<=d){if(x)return!0;for(var I=0;I<this.boxKeys.length;I++)S.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(var N=0;N<this.circleKeys.length;N++){var j=this.circles[3*N],ne=this.circles[3*N+1],oe=this.circles[3*N+2];S.push({key:this.circleKeys[N],x1:j-oe,y1:ne-oe,x2:j+oe,y2:ne+oe})}return T?S.filter(T):S}return this._forEachCell(l,h,c,d,this._queryCell,S,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?S.length>0:S},Bi.prototype._queryCircle=function(l,h,c,d,x){var T=l-c,S=l+c,I=h-c,N=h+c;if(S<0||T>this.width||N<0||I>this.height)return!d&&[];var j=[];return this._forEachCell(T,I,S,N,this._queryCellCircle,j,{hitTest:d,circle:{x:l,y:h,radius:c},seenUids:{box:{},circle:{}}},x),d?j.length>0:j},Bi.prototype.query=function(l,h,c,d,x){return this._query(l,h,c,d,!1,x)},Bi.prototype.hitTest=function(l,h,c,d,x){return this._query(l,h,c,d,!0,x)},Bi.prototype.hitTestCircle=function(l,h,c,d){return this._queryCircle(l,h,c,!0,d)},Bi.prototype._queryCell=function(l,h,c,d,x,T,S,I){var N=S.seenUids,j=this.boxCells[x];if(j!==null)for(var ne=this.bboxes,oe=0,se=j;oe<se.length;oe+=1){var we=se[oe];if(!N.box[we]){N.box[we]=!0;var be=4*we;if(l<=ne[be+2]&&h<=ne[be+3]&&c>=ne[be+0]&&d>=ne[be+1]&&(!I||I(this.boxKeys[we]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[we],x1:ne[be],y1:ne[be+1],x2:ne[be+2],y2:ne[be+3]})}}}var Ze=this.circleCells[x];if(Ze!==null)for(var ge=this.circles,Ve=0,$e=Ze;Ve<$e.length;Ve+=1){var ht=$e[Ve];if(!N.circle[ht]){N.circle[ht]=!0;var Lt=3*ht;if(this._circleAndRectCollide(ge[Lt],ge[Lt+1],ge[Lt+2],l,h,c,d)&&(!I||I(this.circleKeys[ht]))){if(S.hitTest)return T.push(!0),!0;var Tt=ge[Lt],jt=ge[Lt+1],ar=ge[Lt+2];T.push({key:this.circleKeys[ht],x1:Tt-ar,y1:jt-ar,x2:Tt+ar,y2:jt+ar})}}}},Bi.prototype._queryCellCircle=function(l,h,c,d,x,T,S,I){var N=S.circle,j=S.seenUids,ne=this.boxCells[x];if(ne!==null)for(var oe=this.bboxes,se=0,we=ne;se<we.length;se+=1){var be=we[se];if(!j.box[be]){j.box[be]=!0;var Ze=4*be;if(this._circleAndRectCollide(N.x,N.y,N.radius,oe[Ze+0],oe[Ze+1],oe[Ze+2],oe[Ze+3])&&(!I||I(this.boxKeys[be])))return T.push(!0),!0}}var ge=this.circleCells[x];if(ge!==null)for(var Ve=this.circles,$e=0,ht=ge;$e<ht.length;$e+=1){var Lt=ht[$e];if(!j.circle[Lt]){j.circle[Lt]=!0;var Tt=3*Lt;if(this._circlesCollide(Ve[Tt],Ve[Tt+1],Ve[Tt+2],N.x,N.y,N.radius)&&(!I||I(this.circleKeys[Lt])))return T.push(!0),!0}}},Bi.prototype._forEachCell=function(l,h,c,d,x,T,S,I){for(var N=this._convertToXCellCoord(l),j=this._convertToYCellCoord(h),ne=this._convertToXCellCoord(c),oe=this._convertToYCellCoord(d),se=N;se<=ne;se++)for(var we=j;we<=oe;we++)if(x.call(this,l,h,c,d,this.xCellCount*we+se,T,S,I))return},Bi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Bi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Bi.prototype._circlesCollide=function(l,h,c,d,x,T){var S=d-l,I=x-h,N=c+T;return N*N>S*S+I*I},Bi.prototype._circleAndRectCollide=function(l,h,c,d,x,T,S){var I=(T-d)/2,N=Math.abs(l-(d+I));if(N>I+c)return!1;var j=(S-x)/2,ne=Math.abs(h-(x+j));if(ne>j+c)return!1;if(N<=I||ne<=j)return!0;var oe=N-I,se=ne-j;return oe*oe+se*se<=c*c};var sa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function no(l,h){for(var c=0;c<l;c++){var d=h.length;h.resize(d+4),h.float32.set(sa,3*d)}}function yo(l,h,c){var d=h[0],x=h[1];return l[0]=c[0]*d+c[4]*x+c[12],l[1]=c[1]*d+c[5]*x+c[13],l[3]=c[3]*d+c[7]*x+c[15],l}var Fa=function(l,h,c){h===void 0&&(h=new Bi(l.width+200,l.height+200,25)),c===void 0&&(c=new Bi(l.width+200,l.height+200,25)),this.transform=l,this.grid=h,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Ki(l,h,c){return h*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Fa.prototype.placeCollisionBox=function(l,h,c,d,x){var T=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),S=c*T.perspectiveRatio,I=l.x1*S+T.point.x,N=l.y1*S+T.point.y,j=l.x2*S+T.point.x,ne=l.y2*S+T.point.y;return!this.isInsideGrid(I,N,j,ne)||!h&&this.grid.hitTest(I,N,j,ne,x)?{box:[],offscreen:!1}:{box:[I,N,j,ne],offscreen:this.isOffscreen(I,N,j,ne)}},Fa.prototype.placeCollisionCircles=function(l,h,c,d,x,T,S,I,N,j,ne,oe,se){var we=[],be=new v.Point(h.anchorX,h.anchorY),Ze=Jn(be,T),ge=oi(this.transform.cameraToCenterDistance,Ze.signedDistanceFromCamera),Ve=(j?x/ge:x*ge)/v.ONE_EM,$e=Jn(be,S).point,ht=eo(Ve,d,h.lineOffsetX*Ve,h.lineOffsetY*Ve,!1,$e,be,h,c,S,{}),Lt=!1,Tt=!1,jt=!0;if(ht){for(var ar=.5*oe*ge+se,Ir=new v.Point(-100,-100),Tr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),Qr=new Aa,mn=ht.first,Cn=ht.last,_n=[],wi=mn.path.length-1;wi>=1;wi--)_n.push(mn.path[wi]);for(var nn=1;nn<Cn.path.length;nn++)_n.push(Cn.path[nn]);var Vn=2.5*ar;if(I){var ri=_n.map(function(Is){return Jn(Is,I)});_n=ri.some(function(Is){return Is.signedDistanceFromCamera<=0})?[]:ri.map(function(Is){return Is.point})}var Zn=[];if(_n.length>0){for(var Fn=_n[0].clone(),Wn=_n[0].clone(),In=1;In<_n.length;In++)Fn.x=Math.min(Fn.x,_n[In].x),Fn.y=Math.min(Fn.y,_n[In].y),Wn.x=Math.max(Wn.x,_n[In].x),Wn.y=Math.max(Wn.y,_n[In].y);Zn=Fn.x>=Ir.x&&Wn.x<=Tr.x&&Fn.y>=Ir.y&&Wn.y<=Tr.y?[_n]:Wn.x<Ir.x||Fn.x>Tr.x||Wn.y<Ir.y||Fn.y>Tr.y?[]:v.clipLine([_n],Ir.x,Ir.y,Tr.x,Tr.y)}for(var Pn=0,ca=Zn;Pn<ca.length;Pn+=1){var Mo;Qr.reset(ca[Pn],.25*ar),Mo=Qr.length<=.5*ar?1:Math.ceil(Qr.paddedLength/Vn)+1;for(var va=0;va<Mo;va++){var ga=va/Math.max(Mo-1,1),To=Qr.lerp(ga),Ao=To.x+100,Ya=To.y+100;we.push(Ao,Ya,ar,0);var za=Ao-ar,fu=Ya-ar,ts=Ao+ar,eu=Ya+ar;if(jt=jt&&this.isOffscreen(za,fu,ts,eu),Tt=Tt||this.isInsideGrid(za,fu,ts,eu),!l&&this.grid.hitTestCircle(Ao,Ya,ar,ne)&&(Lt=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Lt}}}}return{circles:!N&&Lt||!Tt?[]:we,offscreen:jt,collisionDetected:Lt}},Fa.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],c=1/0,d=1/0,x=-1/0,T=-1/0,S=0,I=l;S<I.length;S+=1){var N=I[S],j=new v.Point(N.x+100,N.y+100);c=Math.min(c,j.x),d=Math.min(d,j.y),x=Math.max(x,j.x),T=Math.max(T,j.y),h.push(j)}for(var ne={},oe={},se=0,we=this.grid.query(c,d,x,T).concat(this.ignoredGrid.query(c,d,x,T));se<we.length;se+=1){var be=we[se],Ze=be.key;if(ne[Ze.bucketInstanceId]===void 0&&(ne[Ze.bucketInstanceId]={}),!ne[Ze.bucketInstanceId][Ze.featureIndex]){var ge=[new v.Point(be.x1,be.y1),new v.Point(be.x2,be.y1),new v.Point(be.x2,be.y2),new v.Point(be.x1,be.y2)];v.polygonIntersectsPolygon(h,ge)&&(ne[Ze.bucketInstanceId][Ze.featureIndex]=!0,oe[Ze.bucketInstanceId]===void 0&&(oe[Ze.bucketInstanceId]=[]),oe[Ze.bucketInstanceId].push(Ze.featureIndex))}}return oe},Fa.prototype.insertCollisionBox=function(l,h,c,d,x){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:x},l[0],l[1],l[2],l[3])},Fa.prototype.insertCollisionCircles=function(l,h,c,d,x){for(var T=h?this.ignoredGrid:this.grid,S={bucketInstanceId:c,featureIndex:d,collisionGroupID:x},I=0;I<l.length;I+=4)T.insertCircle(S,l[I],l[I+1],l[I+2])},Fa.prototype.projectAndGetPerspectiveRatio=function(l,h,c){var d=[h,c,0,1];return yo(d,d,l),{point:new v.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Fa.prototype.isOffscreen=function(l,h,c,d){return c<100||l>=this.screenRightBoundary||d<100||h>this.screenBottomBoundary},Fa.prototype.isInsideGrid=function(l,h,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&h<this.gridBottomBoundary},Fa.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var Wa=function(l,h,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):d&&c?1:0,this.placed=c};Wa.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Na=function(l,h,c,d,x){this.text=new Wa(l?l.text:null,h,c,x),this.icon=new Wa(l?l.icon:null,h,d,x)};Na.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var xu=function(l,h,c){this.text=l,this.icon=h,this.skipFade=c},ys=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},yc=function(l,h,c,d,x){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=x},Bo=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Yi(l,h,c,d,x){var T=v.getAnchorAlignment(l),S=-(T.horizontalAlign-.5)*h,I=-(T.verticalAlign-.5)*c,N=v.evaluateVariableOffset(l,d);return new v.Point(S+N[0]*x,I+N[1]*x)}function $a(l,h,c,d,x,T){var S=l.x1,I=l.x2,N=l.y1,j=l.y2,ne=l.anchorPointX,oe=l.anchorPointY,se=new v.Point(h,c);return d&&se._rotate(x?T:-T),{x1:S+se.x,y1:N+se.y,x2:I+se.x,y2:j+se.y,anchorPointX:ne,anchorPointY:oe}}Bo.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:function(c){return c.collisionGroupID===h}}}return this.collisionGroups[l]};var Zo=function(l,h,c,d){this.transform=l.clone(),this.collisionIndex=new Fa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Bo(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function re(l,h,c,d,x){l.emplaceBack(h?1:0,c?1:0,d||0,x||0),l.emplaceBack(h?1:0,c?1:0,d||0,x||0),l.emplaceBack(h?1:0,c?1:0,d||0,x||0),l.emplaceBack(h?1:0,c?1:0,d||0,x||0)}Zo.prototype.getBucketParts=function(l,h,c,d){var x=c.getBucket(h),T=c.latestFeatureIndex;if(x&&T&&h.id===x.layerIds[0]){var S=c.collisionBoxArray,I=x.layers[0].layout,N=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),j=c.tileSize/v.EXTENT,ne=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),oe=I.get("text-pitch-alignment")==="map",se=I.get("text-rotation-alignment")==="map",we=Ki(c,1,this.transform.zoom),be=ro(ne,oe,se,this.transform,we),Ze=null;if(oe){var ge=mi(ne,oe,se,this.transform,we);Ze=v.multiply([],this.transform.labelPlaneMatrix,ge)}this.retainedQueryData[x.bucketInstanceId]=new yc(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,c.tileID);var Ve={bucket:x,layout:I,posMatrix:ne,textLabelPlaneMatrix:be,labelToScreenMatrix:Ze,scale:N,textPixelRatio:j,holdingForFade:c.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(d)for(var $e=0,ht=x.sortKeyRanges;$e<ht.length;$e+=1){var Lt=ht[$e];l.push({sortKey:Lt.sortKey,symbolInstanceStart:Lt.symbolInstanceStart,symbolInstanceEnd:Lt.symbolInstanceEnd,parameters:Ve})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Ve})}},Zo.prototype.attemptAnchorPlacement=function(l,h,c,d,x,T,S,I,N,j,ne,oe,se,we,be){var Ze,ge=[oe.textOffset0,oe.textOffset1],Ve=Yi(l,c,d,ge,x),$e=this.collisionIndex.placeCollisionBox($a(h,Ve.x,Ve.y,T,S,this.transform.angle),ne,I,N,j.predicate);if(!be||this.collisionIndex.placeCollisionBox($a(be,Ve.x,Ve.y,T,S,this.transform.angle),ne,I,N,j.predicate).box.length!==0)return $e.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID].text&&(Ze=this.prevPlacement.variableOffsets[oe.crossTileID].anchor),this.variableOffsets[oe.crossTileID]={textOffset:ge,width:c,height:d,anchor:l,textBoxScale:x,prevAnchor:Ze},this.markUsedJustification(se,l,oe,we),se.allowVerticalPlacement&&(this.markUsedOrientation(se,we,oe),this.placedOrientations[oe.crossTileID]=we),{shift:Ve,placedGlyphBoxes:$e}):void 0},Zo.prototype.placeLayerBucketPart=function(l,h,c){var d=this,x=l.parameters,T=x.bucket,S=x.layout,I=x.posMatrix,N=x.textLabelPlaneMatrix,j=x.labelToScreenMatrix,ne=x.textPixelRatio,oe=x.holdingForFade,se=x.collisionBoxArray,we=x.partiallyEvaluatedTextSize,be=x.collisionGroup,Ze=S.get("text-optional"),ge=S.get("icon-optional"),Ve=S.get("text-allow-overlap"),$e=S.get("icon-allow-overlap"),ht=S.get("text-rotation-alignment")==="map",Lt=S.get("text-pitch-alignment")==="map",Tt=S.get("icon-text-fit")!=="none",jt=S.get("symbol-z-order")==="viewport-y",ar=Ve&&($e||!T.hasIconData()||ge),Ir=$e&&(Ve||!T.hasTextData()||Ze);!T.collisionArrays&&se&&T.deserializeCollisionBoxes(se);var Tr=function(nn,Vn){if(!h[nn.crossTileID])if(oe)d.placements[nn.crossTileID]=new xu(!1,!1,!1);else{var ri,Zn=!1,Fn=!1,Wn=!0,In=null,Pn={box:null,offscreen:null},ca={box:null,offscreen:null},Mo=null,va=null,ga=0,To=0,Ao=0;Vn.textFeatureIndex?ga=Vn.textFeatureIndex:nn.useRuntimeCollisionCircles&&(ga=nn.featureIndex),Vn.verticalTextFeatureIndex&&(To=Vn.verticalTextFeatureIndex);var Ya=Vn.textBox;if(Ya){var za=function(pi){var Ca=v.WritingMode.horizontal;if(T.allowVerticalPlacement&&!pi&&d.prevPlacement){var Yo=d.prevPlacement.placedOrientations[nn.crossTileID];Yo&&(d.placedOrientations[nn.crossTileID]=Yo,d.markUsedOrientation(T,Ca=Yo,nn))}return Ca},fu=function(pi,Ca){if(T.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&Vn.verticalTextBox)for(var Yo=0,Ru=T.writingModes;Yo<Ru.length&&(Ru[Yo]===v.WritingMode.vertical?(Pn=Ca(),ca=Pn):Pn=pi(),!(Pn&&Pn.box&&Pn.box.length));Yo+=1);else Pn=pi()};if(S.get("text-variable-anchor")){var ts=S.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[nn.crossTileID]){var eu=d.prevPlacement.variableOffsets[nn.crossTileID];ts.indexOf(eu.anchor)>0&&(ts=ts.filter(function(pi){return pi!==eu.anchor})).unshift(eu.anchor)}var Is=function(pi,Ca,Yo){for(var Ru=pi.x2-pi.x1,Ol=pi.y2-pi.y1,Xu=nn.textBoxScale,Bc=Tt&&!$e?Ca:null,Wu={box:[],offscreen:!1},dl=Ve?2*ts.length:ts.length,tu=0;tu<dl;++tu){var ru=d.attemptAnchorPlacement(ts[tu%ts.length],pi,Ru,Ol,Xu,ht,Lt,ne,I,be,tu>=ts.length,nn,T,Yo,Bc);if(ru&&(Wu=ru.placedGlyphBoxes)&&Wu.box&&Wu.box.length){Zn=!0,In=ru.shift;break}}return Wu};fu(function(){return Is(Ya,Vn.iconBox,v.WritingMode.horizontal)},function(){var pi=Vn.verticalTextBox;return T.allowVerticalPlacement&&!(Pn&&Pn.box&&Pn.box.length)&&nn.numVerticalGlyphVertices>0&&pi?Is(pi,Vn.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Pn&&(Zn=Pn.box,Wn=Pn.offscreen);var ac=za(Pn&&Pn.box);if(!Zn&&d.prevPlacement){var hl=d.prevPlacement.variableOffsets[nn.crossTileID];hl&&(d.variableOffsets[nn.crossTileID]=hl,d.markUsedJustification(T,hl.anchor,nn,ac))}}else{var wu=function(pi,Ca){var Yo=d.collisionIndex.placeCollisionBox(pi,Ve,ne,I,be.predicate);return Yo&&Yo.box&&Yo.box.length&&(d.markUsedOrientation(T,Ca,nn),d.placedOrientations[nn.crossTileID]=Ca),Yo};fu(function(){return wu(Ya,v.WritingMode.horizontal)},function(){var pi=Vn.verticalTextBox;return T.allowVerticalPlacement&&nn.numVerticalGlyphVertices>0&&pi?wu(pi,v.WritingMode.vertical):{box:null,offscreen:null}}),za(Pn&&Pn.box&&Pn.box.length)}}if(Zn=(ri=Pn)&&ri.box&&ri.box.length>0,Wn=ri&&ri.offscreen,nn.useRuntimeCollisionCircles){var fl=T.text.placedSymbolArray.get(nn.centerJustifiedTextSymbolIndex),Cu=v.evaluateSizeForFeature(T.textSizeData,we,fl),pu=S.get("text-padding");Mo=d.collisionIndex.placeCollisionCircles(Ve,fl,T.lineVertexArray,T.glyphOffsetArray,Cu,I,N,j,c,Lt,be.predicate,nn.collisionCircleDiameter,pu),Zn=Ve||Mo.circles.length>0&&!Mo.collisionDetected,Wn=Wn&&Mo.offscreen}if(Vn.iconFeatureIndex&&(Ao=Vn.iconFeatureIndex),Vn.iconBox){var pl=function(pi){var Ca=Tt&&In?$a(pi,In.x,In.y,ht,Lt,d.transform.angle):pi;return d.collisionIndex.placeCollisionBox(Ca,$e,ne,I,be.predicate)};Fn=ca&&ca.box&&ca.box.length&&Vn.verticalIconBox?(va=pl(Vn.verticalIconBox)).box.length>0:(va=pl(Vn.iconBox)).box.length>0,Wn=Wn&&va.offscreen}var Va=Ze||nn.numHorizontalGlyphVertices===0&&nn.numVerticalGlyphVertices===0,Uo=ge||nn.numIconVertices===0;if(Va||Uo?Uo?Va||(Fn=Fn&&Zn):Zn=Fn&&Zn:Fn=Zn=Fn&&Zn,Zn&&ri&&ri.box&&d.collisionIndex.insertCollisionBox(ri.box,S.get("text-ignore-placement"),T.bucketInstanceId,ca&&ca.box&&To?To:ga,be.ID),Fn&&va&&d.collisionIndex.insertCollisionBox(va.box,S.get("icon-ignore-placement"),T.bucketInstanceId,Ao,be.ID),Mo&&(Zn&&d.collisionIndex.insertCollisionCircles(Mo.circles,S.get("text-ignore-placement"),T.bucketInstanceId,ga,be.ID),c)){var ps=T.bucketInstanceId,Ms=d.collisionCircleArrays[ps];Ms===void 0&&(Ms=d.collisionCircleArrays[ps]=new ys);for(var du=0;du<Mo.circles.length;du+=4)Ms.circles.push(Mo.circles[du+0]),Ms.circles.push(Mo.circles[du+1]),Ms.circles.push(Mo.circles[du+2]),Ms.circles.push(Mo.collisionDetected?1:0)}d.placements[nn.crossTileID]=new xu(Zn||ar,Fn||Ir,Wn||T.justReloaded),h[nn.crossTileID]=!0}};if(jt)for(var Qr=T.getSortedSymbolIndexes(this.transform.angle),mn=Qr.length-1;mn>=0;--mn){var Cn=Qr[mn];Tr(T.symbolInstances.get(Cn),T.collisionArrays[Cn])}else for(var _n=l.symbolInstanceStart;_n<l.symbolInstanceEnd;_n++)Tr(T.symbolInstances.get(_n),T.collisionArrays[_n]);if(c&&T.bucketInstanceId in this.collisionCircleArrays){var wi=this.collisionCircleArrays[T.bucketInstanceId];v.invert(wi.invProjMatrix,I),wi.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1},Zo.prototype.markUsedJustification=function(l,h,c,d){var x;x=d===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(h)];for(var T=0,S=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];T<S.length;T+=1){var I=S[T];I>=0&&(l.text.placedSymbolArray.get(I).crossTileID=x>=0&&I!==x?0:c.crossTileID)}},Zo.prototype.markUsedOrientation=function(l,h,c){for(var d=h===v.WritingMode.horizontal||h===v.WritingMode.horizontalOnly?h:0,x=h===v.WritingMode.vertical?h:0,T=0,S=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];T<S.length;T+=1)l.text.placedSymbolArray.get(S[T]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=x)},Zo.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,c=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var d=h?h.symbolFadeChange(l):1,x=h?h.opacities:{},T=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(var I in this.placements){var N=this.placements[I],j=x[I];j?(this.opacities[I]=new Na(j,d,N.text,N.icon),c=c||N.text!==j.text.placed||N.icon!==j.icon.placed):(this.opacities[I]=new Na(null,d,N.text,N.icon,N.skipFade),c=c||N.text||N.icon)}for(var ne in x){var oe=x[ne];if(!this.opacities[ne]){var se=new Na(oe,d,!1,!1);se.isHidden()||(this.opacities[ne]=se,c=c||oe.text.placed||oe.icon.placed)}}for(var we in T)this.variableOffsets[we]||!this.opacities[we]||this.opacities[we].isHidden()||(this.variableOffsets[we]=T[we]);for(var be in S)this.placedOrientations[be]||!this.opacities[be]||this.opacities[be].isHidden()||(this.placedOrientations[be]=S[be]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)},Zo.prototype.updateLayerOpacities=function(l,h){for(var c={},d=0,x=h;d<x.length;d+=1){var T=x[d],S=T.getBucket(l);S&&T.latestFeatureIndex&&l.id===S.layerIds[0]&&this.updateBucketOpacities(S,c,T.collisionBoxArray)}},Zo.prototype.updateBucketOpacities=function(l,h,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var x=l.layers[0].layout,T=new Na(null,0,!1,!1,!0),S=x.get("text-allow-overlap"),I=x.get("icon-allow-overlap"),N=x.get("text-variable-anchor"),j=x.get("text-rotation-alignment")==="map",ne=x.get("text-pitch-alignment")==="map",oe=x.get("icon-text-fit")!=="none",se=new Na(null,0,S&&(I||!l.hasIconData()||x.get("icon-optional")),I&&(S||!l.hasTextData()||x.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var we=function(Ve,$e,ht){for(var Lt=0;Lt<$e/4;Lt++)Ve.opacityVertexArray.emplaceBack(ht)},be=function(Ve){var $e=l.symbolInstances.get(Ve),ht=$e.numHorizontalGlyphVertices,Lt=$e.numVerticalGlyphVertices,Tt=$e.crossTileID,jt=d.opacities[Tt];h[Tt]?jt=T:jt||(d.opacities[Tt]=jt=se),h[Tt]=!0;var ar=$e.numIconVertices>0,Ir=d.placedOrientations[$e.crossTileID],Tr=Ir===v.WritingMode.vertical,Qr=Ir===v.WritingMode.horizontal||Ir===v.WritingMode.horizontalOnly;if(ht>0||Lt>0){var mn=ua(jt.text);we(l.text,ht,Tr?Ho:mn),we(l.text,Lt,Qr?Ho:mn);var Cn=jt.text.isHidden();[$e.rightJustifiedTextSymbolIndex,$e.centerJustifiedTextSymbolIndex,$e.leftJustifiedTextSymbolIndex].forEach(function(Pn){Pn>=0&&(l.text.placedSymbolArray.get(Pn).hidden=Cn||Tr?1:0)}),$e.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get($e.verticalPlacedTextSymbolIndex).hidden=Cn||Qr?1:0);var _n=d.variableOffsets[$e.crossTileID];_n&&d.markUsedJustification(l,_n.anchor,$e,Ir);var wi=d.placedOrientations[$e.crossTileID];wi&&(d.markUsedJustification(l,"left",$e,wi),d.markUsedOrientation(l,wi,$e))}if(ar){var nn=ua(jt.icon),Vn=!(oe&&$e.verticalPlacedIconSymbolIndex&&Tr);$e.placedIconSymbolIndex>=0&&(we(l.icon,$e.numIconVertices,Vn?nn:Ho),l.icon.placedSymbolArray.get($e.placedIconSymbolIndex).hidden=jt.icon.isHidden()),$e.verticalPlacedIconSymbolIndex>=0&&(we(l.icon,$e.numVerticalIconVertices,Vn?Ho:nn),l.icon.placedSymbolArray.get($e.verticalPlacedIconSymbolIndex).hidden=jt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var ri=l.collisionArrays[Ve];if(ri){var Zn=new v.Point(0,0);if(ri.textBox||ri.verticalTextBox){var Fn=!0;if(N){var Wn=d.variableOffsets[Tt];Wn?(Zn=Yi(Wn.anchor,Wn.width,Wn.height,Wn.textOffset,Wn.textBoxScale),j&&Zn._rotate(ne?d.transform.angle:-d.transform.angle)):Fn=!1}ri.textBox&&re(l.textCollisionBox.collisionVertexArray,jt.text.placed,!Fn||Tr,Zn.x,Zn.y),ri.verticalTextBox&&re(l.textCollisionBox.collisionVertexArray,jt.text.placed,!Fn||Qr,Zn.x,Zn.y)}var In=!!(!Qr&&ri.verticalIconBox);ri.iconBox&&re(l.iconCollisionBox.collisionVertexArray,jt.icon.placed,In,oe?Zn.x:0,oe?Zn.y:0),ri.verticalIconBox&&re(l.iconCollisionBox.collisionVertexArray,jt.icon.placed,!In,oe?Zn.x:0,oe?Zn.y:0)}}},Ze=0;Ze<l.symbolInstances.length;Ze++)be(Ze);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var ge=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=ge.invProjMatrix,l.placementViewportMatrix=ge.viewportMatrix,l.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Zo.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Zo.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Zo.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Zo.prototype.stillRecent=function(l,h){var c=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*c>l},Zo.prototype.setStale=function(){this.stale=!0};var pe=Math.pow(2,25),Ke=Math.pow(2,24),Vt=Math.pow(2,17),yr=Math.pow(2,16),dn=Math.pow(2,9),Si=Math.pow(2,8),jo=Math.pow(2,1);function ua(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var h=l.placed?1:0,c=Math.floor(127*l.opacity);return c*pe+h*Ke+c*Vt+h*yr+c*dn+h*Si+c*jo+h}var Ho=0,xs=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};xs.prototype.continuePlacement=function(l,h,c,d,x){for(var T=this._bucketParts;this._currentTileIndex<l.length;)if(h.getBucketParts(T,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort(function(S,I){return S.sortKey-I.sortKey}));this._currentPartIndex<T.length;)if(h.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,x())return!0;return!1};var bs=function(l,h,c,d,x,T,S){this.placement=new Zo(l,x,T,S),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};bs.prototype.isDone=function(){return this._done},bs.prototype.continuePlacement=function(l,h,c){for(var d=this,x=v.browser.now(),T=function(){var N=v.browser.now()-x;return!d._forceFullPlacement&&N>2};this._currentPlacementIndex>=0;){var S=h[l[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=I)&&(!S.maxzoom||S.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new xs(S)),this._inProgressLayer.continuePlacement(c[S.source],this.placement,this._showCollisionBoxes,S,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},bs.prototype.commit=function(l){return this.placement.commit(l),this.placement};var th=512/v.EXTENT/2,Ch=function(l,h,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<h.length;d++){var x=h.get(d),T=x.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,l)})}};Ch.prototype.getScaledCoordinates=function(l,h){var c=th/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((h.canonical.y*v.EXTENT+l.anchorY)*c)}},Ch.prototype.findMatches=function(l,h,c){for(var d=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),x=0;x<l.length;x++){var T=l.get(x);if(!T.crossTileID){var S=this.indexedSymbolInstances[T.key];if(S)for(var I=this.getScaledCoordinates(T,h),N=0,j=S;N<j.length;N+=1){var ne=j[N];if(Math.abs(ne.coord.x-I.x)<=d&&Math.abs(ne.coord.y-I.y)<=d&&!c[ne.crossTileID]){c[ne.crossTileID]=!0,T.crossTileID=ne.crossTileID;break}}}}};var ti=function(){this.maxCrossTileID=0};ti.prototype.generate=function(){return++this.maxCrossTileID};var Es=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Es.prototype.handleWrapJump=function(l){var h=Math.round((l-this.lng)/360);if(h!==0)for(var c in this.indexes){var d=this.indexes[c],x={};for(var T in d){var S=d[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),x[S.tileID.key]=S}this.indexes[c]=x}this.lng=l},Es.prototype.addBucket=function(l,h,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<h.symbolInstances.length;d++)h.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var x=this.usedCrossTileIDs[l.overscaledZ];for(var T in this.indexes){var S=this.indexes[T];if(Number(T)>l.overscaledZ)for(var I in S){var N=S[I];N.tileID.isChildOf(l)&&N.findMatches(h.symbolInstances,l,x)}else{var j=S[l.scaledTo(Number(T)).key];j&&j.findMatches(h.symbolInstances,l,x)}}for(var ne=0;ne<h.symbolInstances.length;ne++){var oe=h.symbolInstances.get(ne);oe.crossTileID||(oe.crossTileID=c.generate(),x[oe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ch(l,h.symbolInstances,h.bucketInstanceId),!0},Es.prototype.removeBucketCrossTileIDs=function(l,h){for(var c in h.indexedSymbolInstances)for(var d=0,x=h.indexedSymbolInstances[c];d<x.length;d+=1)delete this.usedCrossTileIDs[l][x[d].crossTileID]},Es.prototype.removeStaleBuckets=function(l){var h=!1;for(var c in this.indexes){var d=this.indexes[c];for(var x in d)l[d[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[x]),delete d[x],h=!0)}return h};var Ns=function(){this.layerIndexes={},this.crossTileIDs=new ti,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ns.prototype.addLayer=function(l,h,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new Es);var x=!1,T={};d.handleWrapJump(c);for(var S=0,I=h;S<I.length;S+=1){var N=I[S],j=N.getBucket(l);j&&l.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(N.tileID,j,this.crossTileIDs)&&(x=!0),T[j.bucketInstanceId]=!0)}return d.removeStaleBuckets(T)&&(x=!0),x},Ns.prototype.pruneUnusedLayers=function(l){var h={};for(var c in l.forEach(function(d){h[d]=!0}),this.layerIndexes)h[c]||delete this.layerIndexes[c]};var au=function(l,h){return v.emitValidationErrors(l,h&&h.filter(function(c){return c.identifier!=="source.canvas"}))},bu=v.pick(Rr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Du=v.pick(Rr,["setCenter","setZoom","setBearing","setPitch"]),xc=function(){var l={},h=v.styleSpec.$version;for(var c in v.styleSpec.$root){var d,x=v.styleSpec.$root[c];x.required&&(d=c==="version"?h:x.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),Ts=function(l){function h(c,d){var x=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Jt(Mt(),this),this.imageManager=new ir,this.imageManager.setEventedParent(this),this.glyphManager=new Yn(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new tt(256,512),this.crossTileSymbolIndex=new Ns,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var T=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(S){T.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:S.pluginStatus,pluginURL:S.pluginURL},function(I,N){if(v.triggerPluginCompletionEvent(I),N&&N.every(function(ne){return ne}))for(var j in T.sourceCaches)T.sourceCaches[j].reload()})}),this.on("data",function(S){if(S.dataType==="source"&&S.sourceDataType==="metadata"){var I=x.sourceCaches[S.sourceId];if(I){var N=I.getSource();if(N&&N.vectorLayerIds)for(var j in x._layers){var ne=x._layers[j];ne.source===N.id&&x._validateLayer(ne)}}}})}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.loadURL=function(c,d){var x=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var T=typeof d.validate=="boolean"?d.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var S=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(S,function(I,N){x._request=null,I?x.fire(new v.ErrorEvent(I)):N&&x._load(N,T)})},h.prototype.loadJSON=function(c,d){var x=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){x._request=null,x._load(c,d.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(xc,!1)},h.prototype._load=function(c,d){if(!d||!au(this,v.validateStyle(c))){for(var x in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(x,c.sources[x],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var T=Er(this.stylesheet.layers);this._order=T.map(function(j){return j.id}),this._layers={},this._serializedLayers={};for(var S=0,I=T;S<I.length;S+=1){var N=I[S];(N=v.createStyleLayer(N)).setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N,this._serializedLayers[N.id]=N.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ft(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},h.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(x,T,S){var I,N,j,ne=v.browser.devicePixelRatio>1?"@2x":"",oe=v.getJSON(T.transformRequest(T.normalizeSpriteURL(x,ne,".json"),v.ResourceType.SpriteJSON),function(be,Ze){oe=null,j||(j=be,I=Ze,we())}),se=v.getImage(T.transformRequest(T.normalizeSpriteURL(x,ne,".png"),v.ResourceType.SpriteImage),function(be,Ze){se=null,j||(j=be,N=Ze,we())});function we(){if(j)S(j);else if(I&&N){var be=v.browser.getImageData(N),Ze={};for(var ge in I){var Ve=I[ge],$e=Ve.width,ht=Ve.height,Lt=Ve.x,Tt=Ve.y,jt=Ve.sdf,ar=Ve.pixelRatio,Ir=Ve.stretchX,Tr=Ve.stretchY,Qr=Ve.content,mn=new v.RGBAImage({width:$e,height:ht});v.RGBAImage.copy(be,mn,{x:Lt,y:Tt},{x:0,y:0},{width:$e,height:ht}),Ze[ge]={data:mn,pixelRatio:ar,sdf:jt,stretchX:Ir,stretchY:Tr,content:Qr}}S(null,Ze)}}return{cancel:function(){oe&&(oe.cancel(),oe=null),se&&(se.cancel(),se=null)}}}(c,this.map._requestManager,function(x,T){if(d._spriteRequest=null,x)d.fire(new v.ErrorEvent(x));else if(T)for(var S in T)d.imageManager.addImage(S,T[S]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new v.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var x=c.sourceLayer;if(x){var T=d.getSource();(T.type==="geojson"||T.vectorLayerIds&&T.vectorLayerIds.indexOf(x)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+x+'" does not exist on source "'+T.id+'" as specified by style layer "'+c.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(c){for(var d=[],x=0,T=c;x<T.length;x+=1){var S=this._layers[T[x]];S.type!=="custom"&&d.push(S.serialize())}return d},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var x=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);for(var S in(x.length||T.length)&&this._updateWorkerLayers(x,T),this._updatedSources){var I=this._updatedSources[S];I==="reload"?this._reloadSource(S):I==="clear"&&this._clearSource(S)}for(var N in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[N].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var j={};for(var ne in this.sourceCaches){var oe=this.sourceCaches[ne];j[ne]=oe.used,oe.used=!1}for(var se=0,we=this._order;se<we.length;se+=1){var be=this._layers[we[se]];be.recalculate(c,this._availableImages),!be.isHidden(c.zoom)&&be.source&&(this.sourceCaches[be.source].used=!0)}for(var Ze in j){var ge=this.sourceCaches[Ze];j[Ze]!==ge.used&&ge.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ze}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new v.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},h.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(c){var d=this;if(this._checkLoaded(),au(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Er(c.layers);var x=function(S,I){if(!S)return[{command:Rr.setStyle,args:[I]}];var N=[];try{if(!v.deepEqual(S.version,I.version))return[{command:Rr.setStyle,args:[I]}];v.deepEqual(S.center,I.center)||N.push({command:Rr.setCenter,args:[I.center]}),v.deepEqual(S.zoom,I.zoom)||N.push({command:Rr.setZoom,args:[I.zoom]}),v.deepEqual(S.bearing,I.bearing)||N.push({command:Rr.setBearing,args:[I.bearing]}),v.deepEqual(S.pitch,I.pitch)||N.push({command:Rr.setPitch,args:[I.pitch]}),v.deepEqual(S.sprite,I.sprite)||N.push({command:Rr.setSprite,args:[I.sprite]}),v.deepEqual(S.glyphs,I.glyphs)||N.push({command:Rr.setGlyphs,args:[I.glyphs]}),v.deepEqual(S.transition,I.transition)||N.push({command:Rr.setTransition,args:[I.transition]}),v.deepEqual(S.light,I.light)||N.push({command:Rr.setLight,args:[I.light]});var j={},ne=[];(function(se,we,be,Ze){var ge;for(ge in we=we||{},se=se||{})se.hasOwnProperty(ge)&&(we.hasOwnProperty(ge)||jr(ge,be,Ze));for(ge in we)we.hasOwnProperty(ge)&&(se.hasOwnProperty(ge)?v.deepEqual(se[ge],we[ge])||(se[ge].type==="geojson"&&we[ge].type==="geojson"&&Li(se,we,ge)?be.push({command:Rr.setGeoJSONSourceData,args:[ge,we[ge].data]}):qn(ge,we,be,Ze)):zn(ge,we,be))})(S.sources,I.sources,ne,j);var oe=[];S.layers&&S.layers.forEach(function(se){j[se.source]?N.push({command:Rr.removeLayer,args:[se.id]}):oe.push(se)}),N=N.concat(ne),function(se,we,be){we=we||[];var Ze,ge,Ve,$e,ht,Lt,Tt,jt=(se=se||[]).map(Ai),ar=we.map(Ai),Ir=se.reduce(di,{}),Tr=we.reduce(di,{}),Qr=jt.slice(),mn=Object.create(null);for(Ze=0,ge=0;Ze<jt.length;Ze++)Tr.hasOwnProperty(Ve=jt[Ze])?ge++:(be.push({command:Rr.removeLayer,args:[Ve]}),Qr.splice(Qr.indexOf(Ve,ge),1));for(Ze=0,ge=0;Ze<ar.length;Ze++)Qr[Qr.length-1-Ze]!==(Ve=ar[ar.length-1-Ze])&&(Ir.hasOwnProperty(Ve)?(be.push({command:Rr.removeLayer,args:[Ve]}),Qr.splice(Qr.lastIndexOf(Ve,Qr.length-ge),1)):ge++,be.push({command:Rr.addLayer,args:[Tr[Ve],Lt=Qr[Qr.length-Ze]]}),Qr.splice(Qr.length-Ze,0,Ve),mn[Ve]=!0);for(Ze=0;Ze<ar.length;Ze++)if($e=Ir[Ve=ar[Ze]],ht=Tr[Ve],!mn[Ve]&&!v.deepEqual($e,ht))if(v.deepEqual($e.source,ht.source)&&v.deepEqual($e["source-layer"],ht["source-layer"])&&v.deepEqual($e.type,ht.type)){for(Tt in ei($e.layout,ht.layout,be,Ve,null,Rr.setLayoutProperty),ei($e.paint,ht.paint,be,Ve,null,Rr.setPaintProperty),v.deepEqual($e.filter,ht.filter)||be.push({command:Rr.setFilter,args:[Ve,ht.filter]}),v.deepEqual($e.minzoom,ht.minzoom)&&v.deepEqual($e.maxzoom,ht.maxzoom)||be.push({command:Rr.setLayerZoomRange,args:[Ve,ht.minzoom,ht.maxzoom]}),$e)$e.hasOwnProperty(Tt)&&Tt!=="layout"&&Tt!=="paint"&&Tt!=="filter"&&Tt!=="metadata"&&Tt!=="minzoom"&&Tt!=="maxzoom"&&(Tt.indexOf("paint.")===0?ei($e[Tt],ht[Tt],be,Ve,Tt.slice(6),Rr.setPaintProperty):v.deepEqual($e[Tt],ht[Tt])||be.push({command:Rr.setLayerProperty,args:[Ve,Tt,ht[Tt]]}));for(Tt in ht)ht.hasOwnProperty(Tt)&&!$e.hasOwnProperty(Tt)&&Tt!=="layout"&&Tt!=="paint"&&Tt!=="filter"&&Tt!=="metadata"&&Tt!=="minzoom"&&Tt!=="maxzoom"&&(Tt.indexOf("paint.")===0?ei($e[Tt],ht[Tt],be,Ve,Tt.slice(6),Rr.setPaintProperty):v.deepEqual($e[Tt],ht[Tt])||be.push({command:Rr.setLayerProperty,args:[Ve,Tt,ht[Tt]]}))}else be.push({command:Rr.removeLayer,args:[Ve]}),Lt=Qr[Qr.lastIndexOf(Ve)+1],be.push({command:Rr.addLayer,args:[ht,Lt]})}(oe,I.layers,N)}catch(se){console.warn("Unable to compute style diff:",se),N=[{command:Rr.setStyle,args:[I]}]}return N}(this.serialize(),c).filter(function(S){return!(S.command in Du)});if(x.length===0)return!1;var T=x.filter(function(S){return!(S.command in bu)});if(T.length>0)throw new Error("Unimplemented: "+T.map(function(S){return S.command}).join(", ")+".");return x.forEach(function(S){S.command!=="setTransition"&&d[S.command].apply(d,S.args)}),this.stylesheet=c,!0},h.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},h.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},h.prototype.getImage=function(c){return this.imageManager.getImage(c)},h.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},h.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(c,d,x){var T=this;if(x===void 0&&(x={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,d,null,x))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var S=this.sourceCaches[c]=new ve(c,d,this.dispatcher);S.style=this,S.setEventedParent(this,function(){return{isSourceLoaded:T.loaded(),source:S.serialize(),sourceId:c}}),S.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var x=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],x.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),x.setEventedParent(null),x.clearTiles(),x.onRemove&&x.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},h.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},h.prototype.addLayer=function(c,d,x){x===void 0&&(x={}),this._checkLoaded();var T=c.id;if(this.getLayer(T))this.fire(new v.ErrorEvent(new Error('Layer with id "'+T+'" already exists on this map')));else{var S;if(c.type==="custom"){if(au(this,v.validateCustomStyleLayer(c)))return;S=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(T,c.source),c=v.clone$1(c),c=v.extend(c,{source:T})),this._validate(v.validateStyle.layer,"layers."+T,c,{arrayIndex:-1},x))return;S=v.createStyleLayer(c),this._validateLayer(S),S.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[S.id]=S.serialize()}var I=d?this._order.indexOf(d):this._order.length;if(d&&I===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(I,0,T),this._layerOrderChanged=!0,this._layers[T]=S,this._removedLayers[T]&&S.source&&S.type!=="custom"){var N=this._removedLayers[T];delete this._removedLayers[T],N.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}},h.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var x=this._order.indexOf(c);this._order.splice(x,1);var T=d?this._order.indexOf(d):this._order.length;d&&T===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(T,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var x=this._order.indexOf(c);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(c){return this._layers[c]},h.prototype.hasLayer=function(c){return c in this._layers},h.prototype.setLayerZoomRange=function(c,d,x){this._checkLoaded();var T=this.getLayer(c);T?T.minzoom===d&&T.maxzoom===x||(d!=null&&(T.minzoom=d),x!=null&&(T.maxzoom=x),this._updateLayer(T)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(c,d,x){x===void 0&&(x={}),this._checkLoaded();var T=this.getLayer(c);if(T){if(!v.deepEqual(T.filter,d))return d==null?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(v.validateStyle.filter,"layers."+T.id+".filter",d,null,x)||(T.filter=v.clone$1(d),this._updateLayer(T)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},h.prototype.setLayoutProperty=function(c,d,x,T){T===void 0&&(T={}),this._checkLoaded();var S=this.getLayer(c);S?v.deepEqual(S.getLayoutProperty(d),x)||(S.setLayoutProperty(d,x,T),this._updateLayer(S)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(c,d){var x=this.getLayer(c);if(x)return x.getLayoutProperty(d);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(c,d,x,T){T===void 0&&(T={}),this._checkLoaded();var S=this.getLayer(c);S?v.deepEqual(S.getPaintProperty(d),x)||(S.setPaintProperty(d,x,T)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},h.prototype.setFeatureState=function(c,d){this._checkLoaded();var x=c.source,T=c.sourceLayer,S=this.sourceCaches[x];if(S!==void 0){var I=S.getSource().type;I==="geojson"&&T?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):I!=="vector"||T?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),S.setFeatureState(T,c.id,d)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(c,d){this._checkLoaded();var x=c.source,T=this.sourceCaches[x];if(T!==void 0){var S=T.getSource().type,I=S==="vector"?c.sourceLayer:void 0;S!=="vector"||I?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(I,c.id,d):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,x=c.sourceLayer,T=this.sourceCaches[d];if(T!==void 0){if(T.getSource().type!=="vector"||x)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),T.getFeatureState(x,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},h.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,x=function(Ir){return d._layers[Ir].type==="fill-extrusion"},T={},S=[],I=this._order.length-1;I>=0;I--){var N=this._order[I];if(x(N)){T[N]=I;for(var j=0,ne=c;j<ne.length;j+=1){var oe=ne[j][N];if(oe)for(var se=0,we=oe;se<we.length;se+=1)S.push(we[se])}}}S.sort(function(Ir,Tr){return Tr.intersectionZ-Ir.intersectionZ});for(var be=[],Ze=this._order.length-1;Ze>=0;Ze--){var ge=this._order[Ze];if(x(ge))for(var Ve=S.length-1;Ve>=0;Ve--){var $e=S[Ve].feature;if(T[$e.layer.id]<Ze)break;be.push($e),S.pop()}else for(var ht=0,Lt=c;ht<Lt.length;ht+=1){var Tt=Lt[ht][ge];if(Tt)for(var jt=0,ar=Tt;jt<ar.length;jt+=1)be.push(ar[jt].feature)}}return be},h.prototype.queryRenderedFeatures=function(c,d,x){d&&d.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var T={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var S=0,I=d.layers;S<I.length;S+=1){var N=I[S],j=this._layers[N];if(!j)return this.fire(new v.ErrorEvent(new Error("The layer '"+N+"' does not exist in the map's style and cannot be queried for features."))),[];T[j.source]=!0}}var ne=[];for(var oe in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!T[oe]||ne.push(Cr(this.sourceCaches[oe],this._layers,this._serializedLayers,c,d,x));return this.placement&&ne.push(function(se,we,be,Ze,ge,Ve,$e){for(var ht={},Lt=Ve.queryRenderedSymbols(Ze),Tt=[],jt=0,ar=Object.keys(Lt).map(Number);jt<ar.length;jt+=1)Tt.push($e[ar[jt]]);Tt.sort(On);for(var Ir=function(){var _n=Qr[Tr],wi=_n.featureIndex.lookupSymbolFeatures(Lt[_n.bucketInstanceId],we,_n.bucketIndex,_n.sourceLayerIndex,ge.filter,ge.layers,ge.availableImages,se);for(var nn in wi){var Vn=ht[nn]=ht[nn]||[],ri=wi[nn];ri.sort(function(Wn,In){var Pn=_n.featureSortOrder;if(Pn){var ca=Pn.indexOf(Wn.featureIndex);return Pn.indexOf(In.featureIndex)-ca}return In.featureIndex-Wn.featureIndex});for(var Zn=0,Fn=ri;Zn<Fn.length;Zn+=1)Vn.push(Fn[Zn])}},Tr=0,Qr=Tt;Tr<Qr.length;Tr+=1)Ir();var mn=function(_n){ht[_n].forEach(function(wi){var nn=wi.feature,Vn=be[se[_n].source].getFeatureState(nn.layer["source-layer"],nn.id);nn.source=nn.layer.source,nn.layer["source-layer"]&&(nn.sourceLayer=nn.layer["source-layer"]),nn.state=Vn})};for(var Cn in ht)mn(Cn);return ht}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ne)},h.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var x=this.sourceCaches[c];return x?function(T,S){for(var I=T.getRenderableIds().map(function(we){return T.getTileByID(we)}),N=[],j={},ne=0;ne<I.length;ne++){var oe=I[ne],se=oe.tileID.canonical.key;j[se]||(j[se]=!0,oe.querySourceFeatures(N,S))}return N}(x,d):[]},h.prototype.addSourceType=function(c,d,x){return h.getSourceType(c)?x(new Error('A source type called "'+c+'" already exists.')):(h.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},x):x(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var x=this.light.getLight(),T=!1;for(var S in c)if(!v.deepEqual(c[S],x[S])){T=!0;break}if(T){var I={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(I)}},h.prototype._validate=function(c,d,x,T,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&au(this,c.call(v.validateStyle,v.extend({key:d,style:this.serialize(),value:x,styleSpec:v.styleSpec},T)))},h.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},h.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},h.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},h.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},h.prototype._updatePlacement=function(c,d,x,T,S){S===void 0&&(S=!1);for(var I=!1,N=!1,j={},ne=0,oe=this._order;ne<oe.length;ne+=1){var se=this._layers[oe[ne]];if(se.type==="symbol"){if(!j[se.source]){var we=this.sourceCaches[se.source];j[se.source]=we.getRenderableIds(!0).map(function($e){return we.getTileByID($e)}).sort(function($e,ht){return ht.tileID.overscaledZ-$e.tileID.overscaledZ||($e.tileID.isLessThan(ht.tileID)?-1:1)})}var be=this.crossTileSymbolIndex.addLayer(se,j[se.source],c.center.lng);I=I||be}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new bs(c,this._order,S,d,x,T,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),N=!0),I&&this.pauseablePlacement.placement.setStale()),N||I)for(var Ze=0,ge=this._order;Ze<ge.length;Ze+=1){var Ve=this._layers[ge[Ze]];Ve.type==="symbol"&&this.placement.updateLayerOpacities(Ve,j[Ve.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},h.prototype.getImages=function(c,d,x){this.imageManager.getImages(d.icons,x),this._updateTilesForChangedImages();var T=this.sourceCaches[d.source];T&&T.setDependencies(d.tileID.key,d.type,d.icons)},h.prototype.getGlyphs=function(c,d,x){this.glyphManager.getGlyphs(d.stacks,x)},h.prototype.getResource=function(c,d,x){return v.makeRequest(d,x)},h}(v.Evented);Ts.getSourceType=function(l){return bt[l]},Ts.setSourceType=function(l,h){bt[l]=h},Ts.registerForPluginStateChange=v.registerForPluginStateChange;var Eo=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),Eu=$i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Bu=$i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),rh=$i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),cf=$i(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),nh=$i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Rh=$i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ih=$i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Mh=$i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),hf=$i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ff=$i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),np=$i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),bc=$i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),pa=$i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),pf=$i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ua=$i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Tl=$i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ju=$i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Us=$i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),el=$i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Gs=$i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Fu=$i(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ks=$i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Nu=$i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),tl=$i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),df=$i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),mf=$i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function $i(l,h){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=h.match(/attribute ([\w]+) ([\w]+)/g),x=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=T?T.concat(x):x,I={};return{fragmentSource:l=l.replace(c,function(N,j,ne,oe,se){return I[se]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
varying `+ne+" "+oe+" "+se+`;
#else
uniform `+ne+" "+oe+" u_"+se+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+se+`
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`}),vertexSource:h=h.replace(c,function(N,j,ne,oe,se){var we=oe==="float"?"vec2":"vec4",be=se.match(/color/)?"color":we;return I[se]?j==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
uniform lowp float u_`+se+`_t;
attribute `+ne+" "+we+" a_"+se+`;
varying `+ne+" "+oe+" "+se+`;
#else
uniform `+ne+" "+oe+" u_"+se+`;
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_`+se+`
    `+se+" = a_"+se+`;
#else
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+se+`
    `+se+" = unpack_mix_"+be+"(a_"+se+", u_"+se+`_t);
#else
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`:j==="define"?`
#ifndef HAS_UNIFORM_u_`+se+`
uniform lowp float u_`+se+`_t;
attribute `+ne+" "+we+" a_"+se+`;
#else
uniform `+ne+" "+oe+" u_"+se+`;
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_`+se+`
    `+ne+" "+oe+" "+se+" = a_"+se+`;
#else
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+se+`
    `+ne+" "+oe+" "+se+" = unpack_mix_"+be+"(a_"+se+", u_"+se+`_t);
#else
    `+ne+" "+oe+" "+se+" = u_"+se+`;
#endif
`}),staticAttributes:d,staticUniforms:S}}var ip=Object.freeze({__proto__:null,prelude:Eu,background:Bu,backgroundPattern:rh,circle:cf,clippingMask:nh,heatmap:Rh,heatmapTexture:Ih,collisionBox:Mh,collisionCircle:hf,debug:ff,fill:np,fillOutline:bc,fillOutlinePattern:pa,fillPattern:pf,fillExtrusion:Ua,fillExtrusionPattern:Tl,hillshadePrepare:Ju,hillshade:Us,line:el,lineGradient:Gs,linePattern:Fu,lineSDF:ks,raster:Nu,symbolIcon:tl,symbolSDF:df,symbolTextAndIcon:mf}),ih=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Oh(l){for(var h=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");h.push(d.pop())}return h}ih.prototype.bind=function(l,h,c,d,x,T,S,I){this.context=l;for(var N=this.boundPaintVertexBuffers.length!==d.length,j=0;!N&&j<d.length;j++)this.boundPaintVertexBuffers[j]!==d[j]&&(N=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===c&&!N&&this.boundIndexBuffer===x&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===I?(l.bindVertexArrayOES.set(this.vao),S&&S.bind(),x&&x.dynamicDraw&&x.bind(),I&&I.bind()):this.freshBind(h,c,d,x,T,S,I)},ih.prototype.freshBind=function(l,h,c,d,x,T,S){var I,N=l.numAttributes,j=this.context,ne=j.gl;if(j.extVertexArrayObject)this.vao&&this.destroy(),this.vao=j.extVertexArrayObject.createVertexArrayOES(),j.bindVertexArrayOES.set(this.vao),I=0,this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=S;else{I=j.currentNumAttributes||0;for(var oe=N;oe<I;oe++)ne.disableVertexAttribArray(oe)}h.enableAttributes(ne,l);for(var se=0,we=c;se<we.length;se+=1)we[se].enableAttributes(ne,l);T&&T.enableAttributes(ne,l),S&&S.enableAttributes(ne,l),h.bind(),h.setVertexAttribPointers(ne,l,x);for(var be=0,Ze=c;be<Ze.length;be+=1){var ge=Ze[be];ge.bind(),ge.setVertexAttribPointers(ne,l,x)}T&&(T.bind(),T.setVertexAttribPointers(ne,l,x)),d&&d.bind(),S&&(S.bind(),S.setVertexAttribPointers(ne,l,x)),j.currentNumAttributes=N},ih.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Fo=function(l,h,c,d,x,T){var S=l.gl;this.program=S.createProgram();for(var I=Oh(c.staticAttributes),N=d?d.getBinderAttributes():[],j=I.concat(N),ne=c.staticUniforms?Oh(c.staticUniforms):[],oe=d?d.getBinderUniforms():[],se=[],we=0,be=ne.concat(oe);we<be.length;we+=1){var Ze=be[we];se.indexOf(Ze)<0&&se.push(Ze)}var ge=d?d.defines():[];T&&ge.push("#define OVERDRAW_INSPECTOR;");var Ve=ge.concat(Eu.fragmentSource,c.fragmentSource).join(`
`),$e=ge.concat(Eu.vertexSource,c.vertexSource).join(`
`),ht=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(ht,Ve),S.compileShader(ht),S.attachShader(this.program,ht);var Lt=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Lt,$e),S.compileShader(Lt),S.attachShader(this.program,Lt),this.attributes={};var Tt={};this.numAttributes=j.length;for(var jt=0;jt<this.numAttributes;jt++)j[jt]&&(S.bindAttribLocation(this.program,jt,j[jt]),this.attributes[j[jt]]=jt);S.linkProgram(this.program),S.deleteShader(Lt),S.deleteShader(ht);for(var ar=0;ar<se.length;ar++){var Ir=se[ar];if(Ir&&!Tt[Ir]){var Tr=S.getUniformLocation(this.program,Ir);Tr&&(Tt[Ir]=Tr)}}this.fixedUniforms=x(l,Tt),this.binderUniforms=d?d.getUniforms(l,Tt):[]}}};function Ph(l,h,c){var d=1/Ki(c,1,h.transform.tileZoom),x=Math.pow(2,c.tileID.overscaledZ),T=c.tileSize*Math.pow(2,h.transform.tileZoom)/x,S=T*(c.tileID.canonical.x+c.tileID.wrap*x),I=T*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[S>>16,I>>16],u_pixel_coord_lower:[65535&S,65535&I]}}Fo.prototype.draw=function(l,h,c,d,x,T,S,I,N,j,ne,oe,se,we,be,Ze){var ge,Ve=l.gl;if(!this.failedToCreate){for(var $e in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(x),l.setCullFace(T),this.fixedUniforms)this.fixedUniforms[$e].set(S[$e]);we&&we.setUniforms(l,this.binderUniforms,oe,{zoom:se});for(var ht=(ge={},ge[Ve.LINES]=2,ge[Ve.TRIANGLES]=3,ge[Ve.LINE_STRIP]=1,ge)[h],Lt=0,Tt=ne.get();Lt<Tt.length;Lt+=1){var jt=Tt[Lt],ar=jt.vaos||(jt.vaos={});(ar[I]||(ar[I]=new ih)).bind(l,this,N,we?we.getPaintVertexBuffers():[],j,jt.vertexOffset,be,Ze),Ve.drawElements(h,jt.primitiveLength*ht,Ve.UNSIGNED_SHORT,jt.primitiveOffset*ht*2)}}};var vf=function(l,h,c,d){var x=h.style.light,T=x.properties.get("position"),S=[T.x,T.y,T.z],I=v.create$1();x.properties.get("anchor")==="viewport"&&v.fromRotation(I,-h.transform.angle),v.transformMat3(S,S,I);var N=x.properties.get("color");return{u_matrix:l,u_lightpos:S,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+c,u_opacity:d}},us=function(l,h,c,d,x,T,S){return v.extend(vf(l,h,c,d),Ph(T,h,S),{u_height_factor:-Math.pow(2,x.overscaledZ)/S.tileSize/8})},Uu=function(l){return{u_matrix:l}},Tu=function(l,h,c,d){return v.extend(Uu(l),Ph(c,h,d))},rl=function(l,h){return{u_matrix:l,u_world:h}},oh=function(l,h,c,d,x){return v.extend(Tu(l,h,c,d),{u_world:x})},Gl=function(l,h,c,d){var x,T,S=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var I=Ki(c,1,S.zoom);x=!0,T=[I,I]}else x=!1,T=S.pixelsToGLUnits;return{u_camera_to_center_distance:S.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(h.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:T}},su=function(l,h,c){var d=Ki(c,1,h.zoom),x=Math.pow(2,h.zoom-c.tileID.overscaledZ),T=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[h.pixelsToGLUnits[0]/(d*x),h.pixelsToGLUnits[1]/(d*x)],u_overscale_factor:T}},Ec=function(l,h,c){return{u_matrix:l,u_inv_matrix:h,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},nl=function(l,h,c){return c===void 0&&(c=1),{u_matrix:l,u_color:h,u_overlay:0,u_overlay_scale:c}},ku=function(l){return{u_matrix:l}},Lh=function(l,h,c,d){return{u_matrix:l,u_extrude_scale:Ki(h,1,c),u_intensity:d}},Tc=function(l,h,c){var d=l.transform;return{u_matrix:Yl(l,h,c),u_ratio:1/Ki(h,1,d.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Kn=function(l,h,c,d){return v.extend(Tc(l,h,c),{u_image:0,u_image_height:d})},ah=function(l,h,c,d){var x=l.transform,T=zu(h,x);return{u_matrix:Yl(l,h,c),u_texsize:h.imageAtlasTexture.size,u_ratio:1/Ki(h,1,x.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[T,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},gf=function(l,h,c,d,x){var T=l.lineAtlas,S=zu(h,l.transform),I=c.layout.get("line-cap")==="round",N=T.getDash(d.from,I),j=T.getDash(d.to,I),ne=N.width*x.fromScale,oe=j.width*x.toScale;return v.extend(Tc(l,h,c),{u_patternscale_a:[S/ne,-N.height/2],u_patternscale_b:[S/oe,-j.height/2],u_sdfgamma:T.width/(256*Math.min(ne,oe)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:j.y,u_mix:x.t})};function zu(l,h){return 1/Ki(l,1,h.tileZoom)}function Yl(l,h,c){return l.translatePosMatrix(h.tileID.posMatrix,h,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Dh=function(l,h,c,d,x){return{u_matrix:l,u_tl_parent:h,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(S=x.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(T=x.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Mi(x.paint.get("raster-hue-rotate"))};var T,S};function Mi(l){l*=Math.PI/180;var h=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*h-c+1)/3,(Math.sqrt(3)*h-c+1)/3]}var la,Sa=function(l,h,c,d,x,T,S,I,N,j){var ne=x.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_pitch:ne.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:ne.width/ne.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+N,u_pitch_with_map:+d,u_texsize:j,u_texture:0}},As=function(l,h,c,d,x,T,S,I,N,j,ne){var oe=x.transform;return v.extend(Sa(l,h,c,d,x,T,S,I,N,j),{u_gamma_scale:d?Math.cos(oe._pitch)*oe.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+ne})},Al=function(l,h,c,d,x,T,S,I,N,j){return v.extend(As(l,h,c,d,x,T,S,I,!0,N,!0),{u_texsize_icon:j,u_texture_icon:1})},il=function(l,h,c){return{u_matrix:l,u_opacity:h,u_color:c}},Sl=function(l,h,c,d,x,T){return v.extend(function(S,I,N,j){var ne=N.imageManager.getPattern(S.from.toString()),oe=N.imageManager.getPattern(S.to.toString()),se=N.imageManager.getPixelSize(),we=se.width,be=se.height,Ze=Math.pow(2,j.tileID.overscaledZ),ge=j.tileSize*Math.pow(2,N.transform.tileZoom)/Ze,Ve=ge*(j.tileID.canonical.x+j.tileID.wrap*Ze),$e=ge*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ne.tl,u_pattern_br_a:ne.br,u_pattern_tl_b:oe.tl,u_pattern_br_b:oe.br,u_texsize:[we,be],u_mix:I.t,u_pattern_size_a:ne.displaySize,u_pattern_size_b:oe.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/Ki(j,1,N.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,$e>>16],u_pixel_coord_lower:[65535&Ve,65535&$e]}}(d,T,c,x),{u_matrix:l,u_opacity:h})},Ac={fillExtrusion:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_lightpos:new v.Uniform3f(l,h.u_lightpos),u_lightintensity:new v.Uniform1f(l,h.u_lightintensity),u_lightcolor:new v.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,h.u_vertical_gradient),u_opacity:new v.Uniform1f(l,h.u_opacity)}},fillExtrusionPattern:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_lightpos:new v.Uniform3f(l,h.u_lightpos),u_lightintensity:new v.Uniform1f(l,h.u_lightintensity),u_lightcolor:new v.Uniform3f(l,h.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,h.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,h.u_height_factor),u_image:new v.Uniform1i(l,h.u_image),u_texsize:new v.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,h.u_scale),u_fade:new v.Uniform1f(l,h.u_fade),u_opacity:new v.Uniform1f(l,h.u_opacity)}},fill:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix)}},fillPattern:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_image:new v.Uniform1i(l,h.u_image),u_texsize:new v.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,h.u_scale),u_fade:new v.Uniform1f(l,h.u_fade)}},fillOutline:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_world:new v.Uniform2f(l,h.u_world)}},fillOutlinePattern:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_world:new v.Uniform2f(l,h.u_world),u_image:new v.Uniform1i(l,h.u_image),u_texsize:new v.Uniform2f(l,h.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,h.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,h.u_scale),u_fade:new v.Uniform1f(l,h.u_fade)}},circle:function(l,h){return{u_camera_to_center_distance:new v.Uniform1f(l,h.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,h.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,h.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,h.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,h.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,h.u_matrix)}},collisionBox:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,h.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,h.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,h.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,h.u_overscale_factor)}},collisionCircle:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,h.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,h.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,h.u_viewport_size)}},debug:function(l,h){return{u_color:new v.UniformColor(l,h.u_color),u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_overlay:new v.Uniform1i(l,h.u_overlay),u_overlay_scale:new v.Uniform1f(l,h.u_overlay_scale)}},clippingMask:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix)}},heatmap:function(l,h){return{u_extrude_scale:new v.Uniform1f(l,h.u_extrude_scale),u_intensity:new v.Uniform1f(l,h.u_intensity),u_matrix:new v.UniformMatrix4f(l,h.u_matrix)}},heatmapTexture:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_world:new v.Uniform2f(l,h.u_world),u_image:new v.Uniform1i(l,h.u_image),u_color_ramp:new v.Uniform1i(l,h.u_color_ramp),u_opacity:new v.Uniform1f(l,h.u_opacity)}},hillshade:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_image:new v.Uniform1i(l,h.u_image),u_latrange:new v.Uniform2f(l,h.u_latrange),u_light:new v.Uniform2f(l,h.u_light),u_shadow:new v.UniformColor(l,h.u_shadow),u_highlight:new v.UniformColor(l,h.u_highlight),u_accent:new v.UniformColor(l,h.u_accent)}},hillshadePrepare:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_image:new v.Uniform1i(l,h.u_image),u_dimension:new v.Uniform2f(l,h.u_dimension),u_zoom:new v.Uniform1f(l,h.u_zoom),u_unpack:new v.Uniform4f(l,h.u_unpack)}},line:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_ratio:new v.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,h.u_units_to_pixels)}},lineGradient:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_ratio:new v.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,h.u_units_to_pixels),u_image:new v.Uniform1i(l,h.u_image),u_image_height:new v.Uniform1f(l,h.u_image_height)}},linePattern:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_texsize:new v.Uniform2f(l,h.u_texsize),u_ratio:new v.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,h.u_device_pixel_ratio),u_image:new v.Uniform1i(l,h.u_image),u_units_to_pixels:new v.Uniform2f(l,h.u_units_to_pixels),u_scale:new v.Uniform3f(l,h.u_scale),u_fade:new v.Uniform1f(l,h.u_fade)}},lineSDF:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_ratio:new v.Uniform1f(l,h.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,h.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,h.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,h.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,h.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,h.u_sdfgamma),u_image:new v.Uniform1i(l,h.u_image),u_tex_y_a:new v.Uniform1f(l,h.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,h.u_tex_y_b),u_mix:new v.Uniform1f(l,h.u_mix)}},raster:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_tl_parent:new v.Uniform2f(l,h.u_tl_parent),u_scale_parent:new v.Uniform1f(l,h.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,h.u_buffer_scale),u_fade_t:new v.Uniform1f(l,h.u_fade_t),u_opacity:new v.Uniform1f(l,h.u_opacity),u_image0:new v.Uniform1i(l,h.u_image0),u_image1:new v.Uniform1i(l,h.u_image1),u_brightness_low:new v.Uniform1f(l,h.u_brightness_low),u_brightness_high:new v.Uniform1f(l,h.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,h.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,h.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,h.u_spin_weights)}},symbolIcon:function(l,h){return{u_is_size_zoom_constant:new v.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,h.u_size_t),u_size:new v.Uniform1f(l,h.u_size),u_camera_to_center_distance:new v.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,h.u_pitch),u_rotate_symbol:new v.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,h.u_fade_change),u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new v.Uniform1i(l,h.u_is_text),u_pitch_with_map:new v.Uniform1i(l,h.u_pitch_with_map),u_texsize:new v.Uniform2f(l,h.u_texsize),u_texture:new v.Uniform1i(l,h.u_texture)}},symbolSDF:function(l,h){return{u_is_size_zoom_constant:new v.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,h.u_size_t),u_size:new v.Uniform1f(l,h.u_size),u_camera_to_center_distance:new v.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,h.u_pitch),u_rotate_symbol:new v.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,h.u_fade_change),u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new v.Uniform1i(l,h.u_is_text),u_pitch_with_map:new v.Uniform1i(l,h.u_pitch_with_map),u_texsize:new v.Uniform2f(l,h.u_texsize),u_texture:new v.Uniform1i(l,h.u_texture),u_gamma_scale:new v.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,h.u_is_halo)}},symbolTextAndIcon:function(l,h){return{u_is_size_zoom_constant:new v.Uniform1i(l,h.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,h.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,h.u_size_t),u_size:new v.Uniform1f(l,h.u_size),u_camera_to_center_distance:new v.Uniform1f(l,h.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,h.u_pitch),u_rotate_symbol:new v.Uniform1i(l,h.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,h.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,h.u_fade_change),u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,h.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,h.u_coord_matrix),u_is_text:new v.Uniform1i(l,h.u_is_text),u_pitch_with_map:new v.Uniform1i(l,h.u_pitch_with_map),u_texsize:new v.Uniform2f(l,h.u_texsize),u_texsize_icon:new v.Uniform2f(l,h.u_texsize_icon),u_texture:new v.Uniform1i(l,h.u_texture),u_texture_icon:new v.Uniform1i(l,h.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,h.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,h.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,h.u_is_halo)}},background:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_opacity:new v.Uniform1f(l,h.u_opacity),u_color:new v.UniformColor(l,h.u_color)}},backgroundPattern:function(l,h){return{u_matrix:new v.UniformMatrix4f(l,h.u_matrix),u_opacity:new v.Uniform1f(l,h.u_opacity),u_image:new v.Uniform1i(l,h.u_image),u_pattern_tl_a:new v.Uniform2f(l,h.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,h.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,h.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,h.u_pattern_br_b),u_texsize:new v.Uniform2f(l,h.u_texsize),u_mix:new v.Uniform1f(l,h.u_mix),u_pattern_size_a:new v.Uniform2f(l,h.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,h.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,h.u_scale_a),u_scale_b:new v.Uniform1f(l,h.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,h.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,h.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,h.u_tile_units_to_pixels)}}};function ql(l,h,c,d,x,T,S){for(var I=l.context,N=I.gl,j=l.useProgram("collisionBox"),ne=[],oe=0,se=0,we=0;we<d.length;we++){var be=d[we],Ze=h.getTile(be),ge=Ze.getBucket(c);if(ge){var Ve=be.posMatrix;x[0]===0&&x[1]===0||(Ve=l.translatePosMatrix(be.posMatrix,Ze,x,T));var $e=S?ge.textCollisionBox:ge.iconCollisionBox,ht=ge.collisionCircleArray;if(ht.length>0){var Lt=v.create(),Tt=Ve;v.mul(Lt,ge.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Lt,Lt,ge.placementViewportMatrix),ne.push({circleArray:ht,circleOffset:se,transform:Tt,invTransform:Lt}),se=oe+=ht.length/4}$e&&j.draw(I,N.LINES,Y.disabled,ce.disabled,l.colorModeForRenderPass(),Ue.disabled,su(Ve,l.transform,Ze),c.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,l.transform.zoom,null,null,$e.collisionVertexBuffer)}}if(S&&ne.length){var jt=l.useProgram("collisionCircle"),ar=new v.StructArrayLayout2f1f2i16;ar.resize(4*oe),ar._trim();for(var Ir=0,Tr=0,Qr=ne;Tr<Qr.length;Tr+=1)for(var mn=Qr[Tr],Cn=0;Cn<mn.circleArray.length/4;Cn++){var _n=4*Cn,wi=mn.circleArray[_n+0],nn=mn.circleArray[_n+1],Vn=mn.circleArray[_n+2],ri=mn.circleArray[_n+3];ar.emplace(Ir++,wi,nn,Vn,ri,0),ar.emplace(Ir++,wi,nn,Vn,ri,1),ar.emplace(Ir++,wi,nn,Vn,ri,2),ar.emplace(Ir++,wi,nn,Vn,ri,3)}(!la||la.length<2*oe)&&(la=function(Mo){var va=2*Mo,ga=new v.StructArrayLayout3ui6;ga.resize(va),ga._trim();for(var To=0;To<va;To++){var Ao=6*To;ga.uint16[Ao+0]=4*To+0,ga.uint16[Ao+1]=4*To+1,ga.uint16[Ao+2]=4*To+2,ga.uint16[Ao+3]=4*To+2,ga.uint16[Ao+4]=4*To+3,ga.uint16[Ao+5]=4*To+0}return ga}(oe));for(var Zn=I.createIndexBuffer(la,!0),Fn=I.createVertexBuffer(ar,v.collisionCircleLayout.members,!0),Wn=0,In=ne;Wn<In.length;Wn+=1){var Pn=In[Wn],ca=Ec(Pn.transform,Pn.invTransform,l.transform);jt.draw(I,N.TRIANGLES,Y.disabled,ce.disabled,l.colorModeForRenderPass(),Ue.disabled,ca,c.id,Fn,Zn,v.SegmentVector.simpleSegment(0,2*Pn.circleOffset,Pn.circleArray.length,Pn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Fn.destroy(),Zn.destroy()}}var Ys=v.identity(new Float32Array(16));function sh(l,h,c,d,x,T){var S=v.getAnchorAlignment(l),I=-(S.horizontalAlign-.5)*h,N=-(S.verticalAlign-.5)*c,j=v.evaluateVariableOffset(l,d);return new v.Point((I/x+j[0])*T,(N/x+j[1])*T)}function _f(l,h,c,d,x,T,S,I,N,j,ne){var oe=l.text.placedSymbolArray,se=l.text.dynamicLayoutVertexArray,we=l.icon.dynamicLayoutVertexArray,be={};se.clear();for(var Ze=0;Ze<oe.length;Ze++){var ge=oe.get(Ze),Ve=ge.hidden||!ge.crossTileID||l.allowVerticalPlacement&&!ge.placedOrientation?null:d[ge.crossTileID];if(Ve){var $e=new v.Point(ge.anchorX,ge.anchorY),ht=Jn($e,c?I:S),Lt=oi(T.cameraToCenterDistance,ht.signedDistanceFromCamera),Tt=x.evaluateSizeForFeature(l.textSizeData,j,ge)*Lt/v.ONE_EM;c&&(Tt*=l.tilePixelRatio/N);for(var jt=sh(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale,Tt),ar=c?Jn($e.add(jt),S).point:ht.point.add(h?jt.rotate(-T.angle):jt),Ir=l.allowVerticalPlacement&&ge.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Tr=0;Tr<ge.numGlyphs;Tr++)v.addDynamicAttributes(se,ar,Ir);ne&&ge.associatedIconIndex>=0&&(be[ge.associatedIconIndex]={shiftedAnchor:ar,angle:Ir})}else no(ge.numGlyphs,se)}if(ne){we.clear();for(var Qr=l.icon.placedSymbolArray,mn=0;mn<Qr.length;mn++){var Cn=Qr.get(mn);if(Cn.hidden)no(Cn.numGlyphs,we);else{var _n=be[mn];if(_n)for(var wi=0;wi<Cn.numGlyphs;wi++)v.addDynamicAttributes(we,_n.shiftedAnchor,_n.angle);else no(Cn.numGlyphs,we)}}l.icon.dynamicLayoutVertexBuffer.updateData(we)}l.text.dynamicLayoutVertexBuffer.updateData(se)}function yf(l,h,c){return c.iconsInText&&h?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function ol(l,h,c,d,x,T,S,I,N,j,ne,oe){for(var se=l.context,we=se.gl,be=l.transform,Ze=I==="map",ge=N==="map",Ve=Ze&&c.layout.get("symbol-placement")!=="point",$e=Ze&&!ge&&!Ve,ht=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Lt=!1,Tt=l.depthModeForSublayer(0,Y.ReadOnly),jt=c.layout.get("text-variable-anchor"),ar=[],Ir=0,Tr=d;Ir<Tr.length;Ir+=1){var Qr=Tr[Ir],mn=h.getTile(Qr),Cn=mn.getBucket(c);if(Cn){var _n=x?Cn.text:Cn.icon;if(_n&&_n.segments.get().length){var wi=_n.programConfigurations.get(c.id),nn=x||Cn.sdfIcons,Vn=x?Cn.textSizeData:Cn.iconSizeData,ri=ge||be.pitch!==0,Zn=l.useProgram(yf(nn,x,Cn),wi),Fn=v.evaluateSizeForZoom(Vn,be.zoom),Wn=void 0,In=[0,0],Pn=void 0,ca=void 0,Mo=null,va=void 0;if(x)Pn=mn.glyphAtlasTexture,ca=we.LINEAR,Wn=mn.glyphAtlasTexture.size,Cn.iconsInText&&(In=mn.imageAtlasTexture.size,Mo=mn.imageAtlasTexture,va=ri||l.options.rotating||l.options.zooming||Vn.kind==="composite"||Vn.kind==="camera"?we.LINEAR:we.NEAREST);else{var ga=c.layout.get("icon-size").constantOr(0)!==1||Cn.iconsNeedLinear;Pn=mn.imageAtlasTexture,ca=nn||l.options.rotating||l.options.zooming||ga||ri?we.LINEAR:we.NEAREST,Wn=mn.imageAtlasTexture.size}var To=Ki(mn,1,l.transform.zoom),Ao=ro(Qr.posMatrix,ge,Ze,l.transform,To),Ya=mi(Qr.posMatrix,ge,Ze,l.transform,To),za=jt&&Cn.hasTextData(),fu=c.layout.get("icon-text-fit")!=="none"&&za&&Cn.hasIconData();Ve&&Fs(Cn,Qr.posMatrix,l,x,Ao,Ya,ge,j);var ts=l.translatePosMatrix(Qr.posMatrix,mn,T,S),eu=Ve||x&&jt||fu?Ys:Ao,Is=l.translatePosMatrix(Ya,mn,T,S,!0),ac=nn&&c.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0,hl={program:Zn,buffers:_n,uniformValues:nn?Cn.iconsInText?Al(Vn.kind,Fn,$e,ge,l,ts,eu,Is,Wn,In):As(Vn.kind,Fn,$e,ge,l,ts,eu,Is,x,Wn,!0):Sa(Vn.kind,Fn,$e,ge,l,ts,eu,Is,x,Wn),atlasTexture:Pn,atlasTextureIcon:Mo,atlasInterpolation:ca,atlasInterpolationIcon:va,isSDF:nn,hasHalo:ac};if(ht&&Cn.canOverlap){Lt=!0;for(var wu=0,fl=_n.segments.get();wu<fl.length;wu+=1){var Cu=fl[wu];ar.push({segments:new v.SegmentVector([Cu]),sortKey:Cu.sortKey,state:hl})}}else ar.push({segments:_n.segments,sortKey:0,state:hl})}}}Lt&&ar.sort(function(Ms,du){return Ms.sortKey-du.sortKey});for(var pu=0,pl=ar;pu<pl.length;pu+=1){var Va=pl[pu],Uo=Va.state;if(se.activeTexture.set(we.TEXTURE0),Uo.atlasTexture.bind(Uo.atlasInterpolation,we.CLAMP_TO_EDGE),Uo.atlasTextureIcon&&(se.activeTexture.set(we.TEXTURE1),Uo.atlasTextureIcon&&Uo.atlasTextureIcon.bind(Uo.atlasInterpolationIcon,we.CLAMP_TO_EDGE)),Uo.isSDF){var ps=Uo.uniformValues;Uo.hasHalo&&(ps.u_is_halo=1,Xo(Uo.buffers,Va.segments,c,l,Uo.program,Tt,ne,oe,ps)),ps.u_is_halo=0}Xo(Uo.buffers,Va.segments,c,l,Uo.program,Tt,ne,oe,Uo.uniformValues)}}function Xo(l,h,c,d,x,T,S,I,N){var j=d.context;x.draw(j,j.gl.TRIANGLES,T,S,I,Ue.disabled,N,c.id,l.layoutVertexBuffer,l.indexBuffer,h,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function al(l,h,c,d,x,T,S){var I,N,j,ne,oe,se=l.context.gl,we=c.paint.get("fill-pattern"),be=we&&we.constantOr(1),Ze=c.getCrossfadeParameters();S?(N=be&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=se.LINES):(N=be?"fillPattern":"fill",I=se.TRIANGLES);for(var ge=0,Ve=d;ge<Ve.length;ge+=1){var $e=Ve[ge],ht=h.getTile($e);if(!be||ht.patternsLoaded()){var Lt=ht.getBucket(c);if(Lt){var Tt=Lt.programConfigurations.get(c.id),jt=l.useProgram(N,Tt);be&&(l.context.activeTexture.set(se.TEXTURE0),ht.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Tt.updatePaintBuffers(Ze));var ar=we.constantOr(null);if(ar&&ht.imageAtlas){var Ir=ht.imageAtlas,Tr=Ir.patternPositions[ar.to.toString()],Qr=Ir.patternPositions[ar.from.toString()];Tr&&Qr&&Tt.setConstantPatternPositions(Tr,Qr)}var mn=l.translatePosMatrix($e.posMatrix,ht,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(S){ne=Lt.indexBuffer2,oe=Lt.segments2;var Cn=[se.drawingBufferWidth,se.drawingBufferHeight];j=N==="fillOutlinePattern"&&be?oh(mn,l,Ze,ht,Cn):rl(mn,Cn)}else ne=Lt.indexBuffer,oe=Lt.segments,j=be?Tu(mn,l,Ze,ht):Uu(mn);jt.draw(l.context,I,x,l.stencilModeForClipping($e),T,Ue.disabled,j,c.id,Lt.layoutVertexBuffer,ne,oe,c.paint,l.transform.zoom,Tt)}}}}function Kl(l,h,c,d,x,T,S){for(var I=l.context,N=I.gl,j=c.paint.get("fill-extrusion-pattern"),ne=j.constantOr(1),oe=c.getCrossfadeParameters(),se=c.paint.get("fill-extrusion-opacity"),we=0,be=d;we<be.length;we+=1){var Ze=be[we],ge=h.getTile(Ze),Ve=ge.getBucket(c);if(Ve){var $e=Ve.programConfigurations.get(c.id),ht=l.useProgram(ne?"fillExtrusionPattern":"fillExtrusion",$e);ne&&(l.context.activeTexture.set(N.TEXTURE0),ge.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),$e.updatePaintBuffers(oe));var Lt=j.constantOr(null);if(Lt&&ge.imageAtlas){var Tt=ge.imageAtlas,jt=Tt.patternPositions[Lt.to.toString()],ar=Tt.patternPositions[Lt.from.toString()];jt&&ar&&$e.setConstantPatternPositions(jt,ar)}var Ir=l.translatePosMatrix(Ze.posMatrix,ge,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Tr=c.paint.get("fill-extrusion-vertical-gradient"),Qr=ne?us(Ir,l,Tr,se,Ze,oe,ge):vf(Ir,l,Tr,se);ht.draw(I,I.gl.TRIANGLES,x,T,S,Ue.backCCW,Qr,c.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,c.paint,l.transform.zoom,$e)}}}function wl(l,h,c,d,x,T){var S=l.context,I=S.gl,N=h.fbo;if(N){var j=l.useProgram("hillshade");S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,N.colorAttachment.get());var ne=function(oe,se,we){var be=we.paint.get("hillshade-shadow-color"),Ze=we.paint.get("hillshade-highlight-color"),ge=we.paint.get("hillshade-accent-color"),Ve=we.paint.get("hillshade-illumination-direction")*(Math.PI/180);we.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ve-=oe.transform.angle);var $e,ht,Lt,Tt=!oe.options.moving;return{u_matrix:oe.transform.calculatePosMatrix(se.tileID.toUnwrapped(),Tt),u_image:0,u_latrange:($e=se.tileID,ht=Math.pow(2,$e.canonical.z),Lt=$e.canonical.y,[new v.MercatorCoordinate(0,Lt/ht).toLngLat().lat,new v.MercatorCoordinate(0,(Lt+1)/ht).toLngLat().lat]),u_light:[we.paint.get("hillshade-exaggeration"),Ve],u_shadow:be,u_highlight:Ze,u_accent:ge}}(l,h,c);j.draw(S,I.TRIANGLES,d,x,T,Ue.disabled,ne,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function op(l,h,c,d,x,T){var S=l.context,I=S.gl,N=h.dem;if(N&&N.data){var j=N.dim,ne=N.stride,oe=N.getPixels();if(S.activeTexture.set(I.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||l.getTileTexture(ne),h.demTexture){var se=h.demTexture;se.update(oe,{premultiply:!1}),se.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else h.demTexture=new v.Texture(S,oe,I.RGBA,{premultiply:!1}),h.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);S.activeTexture.set(I.TEXTURE0);var we=h.fbo;if(!we){var be=new v.Texture(S,{width:j,height:j,data:null},I.RGBA);be.bind(I.LINEAR,I.CLAMP_TO_EDGE),(we=h.fbo=S.createFramebuffer(j,j,!0)).colorAttachment.set(be.texture)}S.bindFramebuffer.set(we.framebuffer),S.viewport.set([0,0,j,j]),l.useProgram("hillshadePrepare").draw(S,I.TRIANGLES,d,x,T,Ue.disabled,function(Ze,ge){var Ve=ge.stride,$e=v.create();return v.ortho($e,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate($e,$e,[0,-v.EXTENT,0]),{u_matrix:$e,u_image:1,u_dimension:[Ve,Ve],u_zoom:Ze.overscaledZ,u_unpack:ge.getUnpackVector()}}(h.tileID,N),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function uh(l,h,c,d,x){var T=d.paint.get("raster-fade-duration");if(T>0){var S=v.browser.now(),I=(S-l.timeAdded)/T,N=h?(S-h.timeAdded)/T:-1,j=c.getSource(),ne=x.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),oe=!h||Math.abs(h.tileID.overscaledZ-ne)>Math.abs(l.tileID.overscaledZ-ne),se=oe&&l.refreshedUponExpiration?1:v.clamp(oe?I:1-N,0,1);return l.refreshedUponExpiration&&I>=1&&(l.refreshedUponExpiration=!1),h?{opacity:1,mix:1-se}:{opacity:se,mix:0}}return{opacity:1,mix:0}}var Sc=new v.Color(1,0,0,1),sl=new v.Color(0,1,0,1),Bh=new v.Color(0,0,1,1),wc=new v.Color(1,0,1,1),Fh=new v.Color(0,1,1,1);function Cc(l,h,c,d){$l(l,0,h+c/2,l.transform.width,c,d)}function Nh(l,h,c,d){$l(l,h-c/2,0,c,l.transform.height,d)}function $l(l,h,c,d,x,T){var S=l.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(h*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,d*v.browser.devicePixelRatio,x*v.browser.devicePixelRatio),S.clear({color:T}),I.disable(I.SCISSOR_TEST)}function Ql(l,h,c){var d=l.context,x=d.gl,T=c.posMatrix,S=l.useProgram("debug"),I=Y.disabled,N=ce.disabled,j=l.colorModeForRenderPass();d.activeTexture.set(x.TEXTURE0),l.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),S.draw(d,x.LINE_STRIP,I,N,j,Ue.disabled,nl(T,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var ne=h.getTileByID(c.key).latestRawTileData,oe=Math.floor((ne&&ne.byteLength||0)/1024),se=h.getTile(c).tileSize,we=512/Math.min(se,512)*(c.overscaledZ/l.transform.zoom)*.5,be=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(be+=" => "+c.overscaledZ),function(Ze,ge){Ze.initDebugOverlayCanvas();var Ve=Ze.debugOverlayCanvas,$e=Ze.context.gl,ht=Ze.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,Ve.width,Ve.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(ge,5,5),ht.strokeText(ge,5,5),Ze.debugOverlayTexture.update(Ve),Ze.debugOverlayTexture.bind($e.LINEAR,$e.CLAMP_TO_EDGE)}(l,be+" "+oe+"kb"),S.draw(d,x.TRIANGLES,I,N,Se.alphaBlended,Ue.disabled,nl(T,v.Color.transparent,we),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Cl={symbol:function(l,h,c,d,x){if(l.renderPass==="translucent"){var T=ce.disabled,S=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(I,N,j,ne,oe,se,we){for(var be=N.transform,Ze=oe==="map",ge=se==="map",Ve=0,$e=I;Ve<$e.length;Ve+=1){var ht=$e[Ve],Lt=ne.getTile(ht),Tt=Lt.getBucket(j);if(Tt&&Tt.text&&Tt.text.segments.get().length){var jt=v.evaluateSizeForZoom(Tt.textSizeData,be.zoom),ar=Ki(Lt,1,N.transform.zoom),Ir=ro(ht.posMatrix,ge,Ze,N.transform,ar),Tr=j.layout.get("icon-text-fit")!=="none"&&Tt.hasIconData();if(jt){var Qr=Math.pow(2,be.zoom-Lt.tileID.overscaledZ);_f(Tt,Ze,ge,we,v.symbolSize,be,Ir,ht.posMatrix,Qr,jt,Tr)}}}}(d,l,c,h,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x),c.paint.get("icon-opacity").constantOr(1)!==0&&ol(l,h,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),T,S),c.paint.get("text-opacity").constantOr(1)!==0&&ol(l,h,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),T,S),h.map.showCollisionBoxes&&(ql(l,h,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ql(l,h,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,h,c,d){if(l.renderPass==="translucent"){var x=c.paint.get("circle-opacity"),T=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),I=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)!==0||T.constantOr(1)!==0&&S.constantOr(1)!==0){for(var N=l.context,j=N.gl,ne=l.depthModeForSublayer(0,Y.ReadOnly),oe=ce.disabled,se=l.colorModeForRenderPass(),we=[],be=0;be<d.length;be++){var Ze=d[be],ge=h.getTile(Ze),Ve=ge.getBucket(c);if(Ve){var $e=Ve.programConfigurations.get(c.id),ht={programConfiguration:$e,program:l.useProgram("circle",$e),layoutVertexBuffer:Ve.layoutVertexBuffer,indexBuffer:Ve.indexBuffer,uniformValues:Gl(l,Ze,ge,c)};if(I)for(var Lt=0,Tt=Ve.segments.get();Lt<Tt.length;Lt+=1){var jt=Tt[Lt];we.push({segments:new v.SegmentVector([jt]),sortKey:jt.sortKey,state:ht})}else we.push({segments:Ve.segments,sortKey:0,state:ht})}}I&&we.sort(function(mn,Cn){return mn.sortKey-Cn.sortKey});for(var ar=0,Ir=we;ar<Ir.length;ar+=1){var Tr=Ir[ar],Qr=Tr.state;Qr.program.draw(N,j.TRIANGLES,ne,oe,se,Ue.disabled,Qr.uniformValues,c.id,Qr.layoutVertexBuffer,Qr.indexBuffer,Tr.segments,c.paint,l.transform.zoom,Qr.programConfiguration)}}}},heatmap:function(l,h,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var x=l.context,T=x.gl,S=ce.disabled,I=new Se([T.ONE,T.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(we,be,Ze){var ge=we.gl;we.activeTexture.set(ge.TEXTURE1),we.viewport.set([0,0,be.width/4,be.height/4]);var Ve=Ze.heatmapFbo;if(Ve)ge.bindTexture(ge.TEXTURE_2D,Ve.colorAttachment.get()),we.bindFramebuffer.set(Ve.framebuffer);else{var $e=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,$e),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Ve=Ze.heatmapFbo=we.createFramebuffer(be.width/4,be.height/4,!1),function(ht,Lt,Tt,jt){var ar=ht.gl;ar.texImage2D(ar.TEXTURE_2D,0,ar.RGBA,Lt.width/4,Lt.height/4,0,ar.RGBA,ht.extRenderToTextureHalfFloat?ht.extTextureHalfFloat.HALF_FLOAT_OES:ar.UNSIGNED_BYTE,null),jt.colorAttachment.set(Tt)}(we,be,$e,Ve)}})(x,l,c),x.clear({color:v.Color.transparent});for(var N=0;N<d.length;N++){var j=d[N];if(!h.hasRenderableParent(j)){var ne=h.getTile(j),oe=ne.getBucket(c);if(oe){var se=oe.programConfigurations.get(c.id);l.useProgram("heatmap",se).draw(x,T.TRIANGLES,Y.disabled,S,I,Ue.disabled,Lh(j.posMatrix,ne,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,c.paint,l.transform.zoom,se)}}}x.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(we,be){var Ze=we.context,ge=Ze.gl,Ve=be.heatmapFbo;if(Ve){Ze.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,Ve.colorAttachment.get()),Ze.activeTexture.set(ge.TEXTURE1);var $e=be.colorRampTexture;$e||($e=be.colorRampTexture=new v.Texture(Ze,be.colorRamp,ge.RGBA)),$e.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),we.useProgram("heatmapTexture").draw(Ze,ge.TRIANGLES,Y.disabled,ce.disabled,we.colorModeForRenderPass(),Ue.disabled,function(ht,Lt,Tt,jt){var ar=v.create();v.ortho(ar,0,ht.width,ht.height,0,0,1);var Ir=ht.context.gl;return{u_matrix:ar,u_world:[Ir.drawingBufferWidth,Ir.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Lt.paint.get("heatmap-opacity")}}(we,be),be.id,we.viewportBuffer,we.quadTriangleIndexBuffer,we.viewportSegments,be.paint,we.transform.zoom)}}(l,c))},line:function(l,h,c,d){if(l.renderPass==="translucent"){var x=c.paint.get("line-opacity"),T=c.paint.get("line-width");if(x.constantOr(1)!==0&&T.constantOr(1)!==0)for(var S=l.depthModeForSublayer(0,Y.ReadOnly),I=l.colorModeForRenderPass(),N=c.paint.get("line-dasharray"),j=c.paint.get("line-pattern"),ne=j.constantOr(1),oe=c.paint.get("line-gradient"),se=c.getCrossfadeParameters(),we=ne?"linePattern":N?"lineSDF":oe?"lineGradient":"line",be=l.context,Ze=be.gl,ge=!0,Ve=0,$e=d;Ve<$e.length;Ve+=1){var ht=$e[Ve],Lt=h.getTile(ht);if(!ne||Lt.patternsLoaded()){var Tt=Lt.getBucket(c);if(Tt){var jt=Tt.programConfigurations.get(c.id),ar=l.context.program.get(),Ir=l.useProgram(we,jt),Tr=ge||Ir.program!==ar,Qr=j.constantOr(null);if(Qr&&Lt.imageAtlas){var mn=Lt.imageAtlas,Cn=mn.patternPositions[Qr.to.toString()],_n=mn.patternPositions[Qr.from.toString()];Cn&&_n&&jt.setConstantPatternPositions(Cn,_n)}var wi=ne?ah(l,Lt,c,se):N?gf(l,Lt,c,N,se):oe?Kn(l,Lt,c,Tt.lineClipsArray.length):Tc(l,Lt,c);if(ne)be.activeTexture.set(Ze.TEXTURE0),Lt.imageAtlasTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),jt.updatePaintBuffers(se);else if(N&&(Tr||l.lineAtlas.dirty))be.activeTexture.set(Ze.TEXTURE0),l.lineAtlas.bind(be);else if(oe){var nn=Tt.gradients[c.id],Vn=nn.texture;if(c.gradientVersion!==nn.version){var ri=256;if(c.stepInterpolant){var Zn=h.getSource().maxzoom,Fn=ht.canonical.z===Zn?Math.ceil(1<<l.transform.maxZoom-ht.canonical.z):1;ri=v.clamp(v.nextPowerOfTwo(Tt.maxLineLength/v.EXTENT*1024*Fn),256,be.maxTextureSize)}nn.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ri,image:nn.gradient||void 0,clips:Tt.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new v.Texture(be,nn.gradient,Ze.RGBA),nn.version=c.gradientVersion,Vn=nn.texture}be.activeTexture.set(Ze.TEXTURE0),Vn.bind(c.stepInterpolant?Ze.NEAREST:Ze.LINEAR,Ze.CLAMP_TO_EDGE)}Ir.draw(be,Ze.TRIANGLES,S,l.stencilModeForClipping(ht),I,Ue.disabled,wi,c.id,Tt.layoutVertexBuffer,Tt.indexBuffer,Tt.segments,c.paint,l.transform.zoom,jt,Tt.layoutVertexBuffer2),ge=!1}}}}},fill:function(l,h,c,d){var x=c.paint.get("fill-color"),T=c.paint.get("fill-opacity");if(T.constantOr(1)!==0){var S=l.colorModeForRenderPass(),I=c.paint.get("fill-pattern"),N=l.opaquePassEnabledForLayer()&&!I.constantOr(1)&&x.constantOr(v.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===N){var j=l.depthModeForSublayer(1,l.renderPass==="opaque"?Y.ReadWrite:Y.ReadOnly);al(l,h,c,d,j,S,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var ne=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,Y.ReadOnly);al(l,h,c,d,ne,S,!0)}}},"fill-extrusion":function(l,h,c,d){var x=c.paint.get("fill-extrusion-opacity");if(x!==0&&l.renderPass==="translucent"){var T=new Y(l.context.gl.LEQUAL,Y.ReadWrite,l.depthRangeFor3D);if(x!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))Kl(l,h,c,d,T,ce.disabled,Se.disabled),Kl(l,h,c,d,T,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var S=l.colorModeForRenderPass();Kl(l,h,c,d,T,ce.disabled,S)}}},hillshade:function(l,h,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var x=l.context,T=l.depthModeForSublayer(0,Y.ReadOnly),S=l.colorModeForRenderPass(),I=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],N=I[0],j=0,ne=I[1];j<ne.length;j+=1){var oe=ne[j],se=h.getTile(oe);se.needsHillshadePrepare&&l.renderPass==="offscreen"?op(l,se,c,T,ce.disabled,S):l.renderPass==="translucent"&&wl(l,se,c,T,N[oe.overscaledZ],S)}x.viewport.set([0,0,l.width,l.height])}},raster:function(l,h,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var x=l.context,T=x.gl,S=h.getSource(),I=l.useProgram("raster"),N=l.colorModeForRenderPass(),j=S instanceof je?[{},d]:l.stencilConfigForOverlap(d),ne=j[0],oe=j[1],se=oe[oe.length-1].overscaledZ,we=!l.options.moving,be=0,Ze=oe;be<Ze.length;be+=1){var ge=Ze[be],Ve=l.depthModeForSublayer(ge.overscaledZ-se,c.paint.get("raster-opacity")===1?Y.ReadWrite:Y.ReadOnly,T.LESS),$e=h.getTile(ge),ht=l.transform.calculatePosMatrix(ge.toUnwrapped(),we);$e.registerFadeDuration(c.paint.get("raster-fade-duration"));var Lt=h.findLoadedParent(ge,0),Tt=uh($e,Lt,h,c,l.transform),jt=void 0,ar=void 0,Ir=c.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;x.activeTexture.set(T.TEXTURE0),$e.texture.bind(Ir,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),x.activeTexture.set(T.TEXTURE1),Lt?(Lt.texture.bind(Ir,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),jt=Math.pow(2,Lt.tileID.overscaledZ-$e.tileID.overscaledZ),ar=[$e.tileID.canonical.x*jt%1,$e.tileID.canonical.y*jt%1]):$e.texture.bind(Ir,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);var Tr=Dh(ht,ar||[0,0],jt||1,Tt,c);S instanceof je?I.draw(x,T.TRIANGLES,Ve,ce.disabled,N,Ue.disabled,Tr,c.id,S.boundsBuffer,l.quadTriangleIndexBuffer,S.boundsSegments):I.draw(x,T.TRIANGLES,Ve,ne[ge.overscaledZ],N,Ue.disabled,Tr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,h,c){var d=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(x!==0){var T=l.context,S=T.gl,I=l.transform,N=I.tileSize,j=c.paint.get("background-pattern");if(!l.isPatternMissing(j)){var ne=!j&&d.a===1&&x===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===ne){var oe=ce.disabled,se=l.depthModeForSublayer(0,ne==="opaque"?Y.ReadWrite:Y.ReadOnly),we=l.colorModeForRenderPass(),be=l.useProgram(j?"backgroundPattern":"background"),Ze=I.coveringTiles({tileSize:N});j&&(T.activeTexture.set(S.TEXTURE0),l.imageManager.bind(l.context));for(var ge=c.getCrossfadeParameters(),Ve=0,$e=Ze;Ve<$e.length;Ve+=1){var ht=$e[Ve],Lt=l.transform.calculatePosMatrix(ht.toUnwrapped()),Tt=j?Sl(Lt,x,l,j,{tileID:ht,tileSize:N},ge):il(Lt,x,d);be.draw(T,S.TRIANGLES,se,oe,we,Ue.disabled,Tt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,h,c){for(var d=0;d<c.length;d++)Ql(l,h,c[d])},custom:function(l,h,c){var d=l.context,x=c.implementation;if(l.renderPass==="offscreen"){var T=x.prerender;T&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),T.call(x,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(ce.disabled);var S=x.renderingMode==="3d"?new Y(l.context.gl.LEQUAL,Y.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Y.ReadOnly);d.setDepthMode(S),x.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},mo=function(l,h){this.context=new Q(l),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=ve.maxUnderzooming+ve.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ns,this.gpuTimers={}};mo.prototype.resize=function(l,h){if(this.width=l*v.browser.devicePixelRatio,this.height=h*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},mo.prototype.setup=function(){var l=this.context,h=new v.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(v.EXTENT,0),h.emplaceBack(0,v.EXTENT),h.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(h,Eo.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,Eo.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var d=new v.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(v.EXTENT,0,v.EXTENT,0),d.emplaceBack(0,v.EXTENT,0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,Me.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var x=new v.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(x,Eo.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var T=new v.StructArrayLayout1ui2;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(T);var S=new v.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var I=this.context.gl;this.stencilClearMode=new ce({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)},mo.prototype.clearStencil=function(){var l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,Y.disabled,this.stencilClearMode,Se.disabled,Ue.disabled,ku(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},mo.prototype._renderTileClippingMasks=function(l,h){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&h&&h.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+h.length>256&&this.clearStencil(),c.setColorMode(Se.disabled),c.setDepthMode(Y.disabled);var x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var T=0,S=h;T<S.length;T+=1){var I=S[T],N=this._tileClippingMaskIDs[I.key]=this.nextStencilID++;x.draw(c,d.TRIANGLES,Y.disabled,new ce({func:d.ALWAYS,mask:0},N,255,d.KEEP,d.KEEP,d.REPLACE),Se.disabled,Ue.disabled,ku(I.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},mo.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,h=this.context.gl;return new ce({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)},mo.prototype.stencilModeForClipping=function(l){var h=this.context.gl;return new ce({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)},mo.prototype.stencilConfigForOverlap=function(l){var h,c=this.context.gl,d=l.sort(function(N,j){return j.overscaledZ-N.overscaledZ}),x=d[d.length-1].overscaledZ,T=d[0].overscaledZ-x+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();for(var S={},I=0;I<T;I++)S[I+x]=new ce({func:c.GEQUAL,mask:255},I+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=T,[S,d]}return[(h={},h[x]=ce.disabled,h),d]},mo.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Se([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Se.unblended:Se.alphaBlended},mo.prototype.depthModeForSublayer=function(l,h,c){if(!this.opaquePassEnabledForLayer())return Y.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Y(c||this.context.gl.LEQUAL,h,[d,d])},mo.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},mo.prototype.render=function(l,h){var c=this;this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var d=this.style._order,x=this.style.sourceCaches;for(var T in x){var S=x[T];S.used&&S.prepare(this.context)}var I,N,j={},ne={},oe={};for(var se in x){var we=x[se];j[se]=we.getVisibleCoordinates(),ne[se]=j[se].slice().reverse(),oe[se]=we.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var be=0;be<d.length;be++)if(this.style._layers[d[be]].is3D()){this.opaquePassCutoff=be;break}this.renderPass="offscreen";for(var Ze=0,ge=d;Ze<ge.length;Ze+=1){var Ve=this.style._layers[ge[Ze]];if(Ve.hasOffscreenPass()&&!Ve.isHidden(this.transform.zoom)){var $e=ne[Ve.source];(Ve.type==="custom"||$e.length)&&this.renderLayer(this,x[Ve.source],Ve,$e)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var ht=this.style._layers[d[this.currentLayer]],Lt=x[ht.source],Tt=j[ht.source];this._renderTileClippingMasks(ht,Tt),this.renderLayer(this,Lt,ht,Tt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var jt=this.style._layers[d[this.currentLayer]],ar=x[jt.source],Ir=(jt.type==="symbol"?oe:ne)[jt.source];this._renderTileClippingMasks(jt,j[jt.source]),this.renderLayer(this,ar,jt,Ir)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Tr){Tr.source&&!Tr.isHidden(c.transform.zoom)&&(Tr.source!==(N&&N.id)&&(N=c.style.sourceCaches[Tr.source]),(!I||I.getSource().maxzoom<N.getSource().maxzoom)&&(I=N))}),I&&Cl.debug(this,I,I.getVisibleCoordinates())),this.options.showPadding&&function(Tr){var Qr=Tr.transform.padding;Cc(Tr,Tr.transform.height-(Qr.top||0),3,Sc),Cc(Tr,Qr.bottom||0,3,sl),Nh(Tr,Qr.left||0,3,Bh),Nh(Tr,Tr.transform.width-(Qr.right||0),3,wc);var mn=Tr.transform.centerPoint;(function(Cn,_n,wi,nn){$l(Cn,_n-1,wi-10,2,20,nn),$l(Cn,_n-10,wi-1,20,2,nn)})(Tr,mn.x,Tr.transform.height-mn.y,Fh)}(this),this.context.setDefault()},mo.prototype.renderLayer=function(l,h,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Cl[c.type](l,h,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},mo.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var h=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),c.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,c.query)}},mo.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},mo.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},mo.prototype.queryGpuTimers=function(l){var h={};for(var c in l){var d=l[c],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(d.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(d.query),h[c]=T}return h},mo.prototype.translatePosMatrix=function(l,h,c,d,x){if(!c[0]&&!c[1])return l;var T=x?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(T){var S=Math.sin(T),I=Math.cos(T);c=[c[0]*I-c[1]*S,c[0]*S+c[1]*I]}var N=[x?c[0]:Ki(h,c[0],this.transform.zoom),x?c[1]:Ki(h,c[1],this.transform.zoom),0],j=new Float32Array(16);return v.translate(j,l,N),j},mo.prototype.saveTileTexture=function(l){var h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]},mo.prototype.getTileTexture=function(l){var h=this._tileTextures[l];return h&&h.length>0?h.pop():null},mo.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var h=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!h||!c},mo.prototype.useProgram=function(l,h){this.cache=this.cache||{};var c=""+l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Fo(this.context,l,ip[l],h,Ac[l],this._showOverdrawInspector)),this.cache[c]},mo.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},mo.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},mo.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},mo.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var lh=function(l,h){this.points=l,this.planes=h};lh.fromInvProjectionMatrix=function(l,h,c){var d=Math.pow(2,c),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(S){return v.transformMat4([],S,l)}).map(function(S){return v.scale$1([],S,1/S[3]/h*d)}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(S){var I=v.sub([],x[S[0]],x[S[1]]),N=v.sub([],x[S[2]],x[S[1]]),j=v.normalize([],v.cross([],I,N)),ne=-v.dot(j,x[S[1]]);return j.concat(ne)});return new lh(x,T)};var Au=function(l,h){this.min=l,this.max=h,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Au.prototype.quadrant=function(l){for(var h=[l%2==0,l<2],c=v.clone$2(this.min),d=v.clone$2(this.max),x=0;x<h.length;x++)c[x]=h[x]?this.min[x]:this.center[x],d[x]=h[x]?this.center[x]:this.max[x];return d[2]=this.max[2],new Au(c,d)},Au.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Au.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Au.prototype.intersects=function(l){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var x=l.planes[d],T=0,S=0;S<h.length;S++)T+=v.dot$1(x,h[S])>=0;if(T===0)return 0;T!==h.length&&(c=!1)}if(c)return 2;for(var I=0;I<3;I++){for(var N=Number.MAX_VALUE,j=-Number.MAX_VALUE,ne=0;ne<l.points.length;ne++){var oe=l.points[ne][I]-this.min[I];N=Math.min(N,oe),j=Math.max(j,oe)}if(j<0||N>this.max[I]-this.min[I])return 0}return 1};var Rl=function(l,h,c,d){if(l===void 0&&(l=0),h===void 0&&(h=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(h)||h<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=c,this.right=d};Rl.prototype.interpolate=function(l,h,c){return h.top!=null&&l.top!=null&&(this.top=v.number(l.top,h.top,c)),h.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,h.bottom,c)),h.left!=null&&l.left!=null&&(this.left=v.number(l.left,h.left,c)),h.right!=null&&l.right!=null&&(this.right=v.number(l.right,h.right,c)),this},Rl.prototype.getCenter=function(l,h){var c=v.clamp((this.left+l-this.right)/2,0,l),d=v.clamp((this.top+h-this.bottom)/2,0,h);return new v.Point(c,d)},Rl.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Rl.prototype.clone=function(){return new Rl(this.top,this.bottom,this.left,this.right)},Rl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var yi=function(l,h,c,d,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=x===void 0||x,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Rl,this._posMatrixCache={},this._alignedPosMatrixCache={}},ho={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};yi.prototype.clone=function(){var l=new yi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},ho.minZoom.get=function(){return this._minZoom},ho.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},ho.maxZoom.get=function(){return this._maxZoom},ho.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},ho.minPitch.get=function(){return this._minPitch},ho.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},ho.maxPitch.get=function(){return this._maxPitch},ho.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},ho.renderWorldCopies.get=function(){return this._renderWorldCopies},ho.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},ho.worldSize.get=function(){return this.tileSize*this.scale},ho.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ho.size.get=function(){return new v.Point(this.width,this.height)},ho.bearing.get=function(){return-this.angle/Math.PI*180},ho.bearing.set=function(l){var h=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ho.pitch.get=function(){return this._pitch/Math.PI*180},ho.pitch.set=function(l){var h=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},ho.fov.get=function(){return this._fov/Math.PI*180},ho.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},ho.zoom.get=function(){return this._zoom},ho.zoom.set=function(l){var h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},ho.center.get=function(){return this._center},ho.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},ho.padding.get=function(){return this._edgeInsets.toJSON()},ho.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},ho.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},yi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},yi.prototype.interpolatePadding=function(l,h,c){this._unmodified=!1,this._edgeInsets.interpolate(l,h,c),this._constrain(),this._calcMatrices()},yi.prototype.coveringZoomLevel=function(l){var h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)},yi.prototype.getVisibleUnwrappedCoordinates=function(l){var h=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),d=this.pointCoordinate(new v.Point(this.width,0)),x=this.pointCoordinate(new v.Point(this.width,this.height)),T=this.pointCoordinate(new v.Point(0,this.height)),S=Math.floor(Math.min(c.x,d.x,x.x,T.x)),I=Math.floor(Math.max(c.x,d.x,x.x,T.x)),N=S-1;N<=I+1;N++)N!==0&&h.push(new v.UnwrappedTileID(N,l));return h},yi.prototype.coveringTiles=function(l){var h=this.coveringZoomLevel(l),c=h;if(l.minzoom!==void 0&&h<l.minzoom)return[];l.maxzoom!==void 0&&h>l.maxzoom&&(h=l.maxzoom);var d=v.MercatorCoordinate.fromLngLat(this.center),x=Math.pow(2,h),T=[x*d.x,x*d.y,0],S=lh.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),I=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(I=h);var N=function(Tr){return{aabb:new Au([Tr*x,0,0],[(Tr+1)*x,x,0]),zoom:0,x:0,y:0,wrap:Tr,fullyVisible:!1}},j=[],ne=[],oe=h,se=l.reparseOverscaled?c:h;if(this._renderWorldCopies)for(var we=1;we<=3;we++)j.push(N(-we)),j.push(N(we));for(j.push(N(0));j.length>0;){var be=j.pop(),Ze=be.x,ge=be.y,Ve=be.fullyVisible;if(!Ve){var $e=be.aabb.intersects(S);if($e===0)continue;Ve=$e===2}var ht=be.aabb.distanceX(T),Lt=be.aabb.distanceY(T),Tt=Math.max(Math.abs(ht),Math.abs(Lt));if(be.zoom===oe||Tt>3+(1<<oe-be.zoom)-2&&be.zoom>=I)ne.push({tileID:new v.OverscaledTileID(be.zoom===oe?se:be.zoom,be.wrap,be.zoom,Ze,ge),distanceSq:v.sqrLen([T[0]-.5-Ze,T[1]-.5-ge])});else for(var jt=0;jt<4;jt++){var ar=(Ze<<1)+jt%2,Ir=(ge<<1)+(jt>>1);j.push({aabb:be.aabb.quadrant(jt),zoom:be.zoom+1,x:ar,y:Ir,wrap:be.wrap,fullyVisible:Ve})}}return ne.sort(function(Tr,Qr){return Tr.distanceSq-Qr.distanceSq}).map(function(Tr){return Tr.tileID})},yi.prototype.resize=function(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()},ho.unmodified.get=function(){return this._unmodified},yi.prototype.zoomScale=function(l){return Math.pow(2,l)},yi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},yi.prototype.project=function(l){var h=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(h)*this.worldSize)},yi.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},ho.point.get=function(){return this.project(this.center)},yi.prototype.setLocationAtPoint=function(l,h){var c=this.pointCoordinate(h),d=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(l),T=new v.MercatorCoordinate(x.x-(c.x-d.x),x.y-(c.y-d.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())},yi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},yi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},yi.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},yi.prototype.coordinateLocation=function(l){return l.toLngLat()},yi.prototype.pointCoordinate=function(l){var h=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(h,h,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var d=h[3],x=c[3],T=h[1]/d,S=c[1]/x,I=h[2]/d,N=c[2]/x,j=I===N?0:(0-I)/(N-I);return new v.MercatorCoordinate(v.number(h[0]/d,c[0]/x,j)/this.worldSize,v.number(T,S,j)/this.worldSize)},yi.prototype.coordinatePoint=function(l){var h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(h,h,this.pixelMatrix),new v.Point(h[0]/h[3],h[1]/h[3])},yi.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},yi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},yi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},yi.prototype.calculatePosMatrix=function(l,h){h===void 0&&(h=!1);var c=l.key,d=h?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var x=l.canonical,T=this.worldSize/this.zoomScale(x.z),S=x.x+Math.pow(2,x.z)*l.wrap,I=v.identity(new Float64Array(16));return v.translate(I,I,[S*T,x.y*T,0]),v.scale(I,I,[T/v.EXTENT,T/v.EXTENT,1]),v.multiply(I,h?this.alignedProjMatrix:this.projMatrix,I),d[c]=new Float32Array(I),d[c]},yi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},yi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,h,c,d,x=-90,T=90,S=-180,I=180,N=this.size,j=this._unmodified;if(this.latRange){var ne=this.latRange;x=v.mercatorYfromLat(ne[1])*this.worldSize,l=(T=v.mercatorYfromLat(ne[0])*this.worldSize)-x<N.y?N.y/(T-x):0}if(this.lngRange){var oe=this.lngRange;S=v.mercatorXfromLng(oe[0])*this.worldSize,h=(I=v.mercatorXfromLng(oe[1])*this.worldSize)-S<N.x?N.x/(I-S):0}var se=this.point,we=Math.max(h||0,l||0);if(we)return this.center=this.unproject(new v.Point(h?(I+S)/2:se.x,l?(T+x)/2:se.y)),this.zoom+=this.scaleZoom(we),this._unmodified=j,void(this._constraining=!1);if(this.latRange){var be=se.y,Ze=N.y/2;be-Ze<x&&(d=x+Ze),be+Ze>T&&(d=T-Ze)}if(this.lngRange){var ge=se.x,Ve=N.x/2;ge-Ve<S&&(c=S+Ve),ge+Ve>I&&(c=I-Ve)}c===void 0&&d===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:se.x,d!==void 0?d:se.y))),this._unmodified=j,this._constraining=!1}},yi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-h-c,.01,Math.PI-.01)),x=this.point,T=x.x,S=x.y,I=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),N=this.height/50,j=new Float64Array(16);v.perspective(j,this._fov,this.width/this.height,N,I),j[8]=2*-l.x/this.width,j[9]=2*l.y/this.height,v.scale(j,j,[1,-1,1]),v.translate(j,j,[0,0,-this.cameraToCenterDistance]),v.rotateX(j,j,this._pitch),v.rotateZ(j,j,this.angle),v.translate(j,j,[-T,-S,0]),this.mercatorMatrix=v.scale([],j,[this.worldSize,this.worldSize,this.worldSize]),v.scale(j,j,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=j,this.invProjMatrix=v.invert([],this.projMatrix);var ne=this.width%2/2,oe=this.height%2/2,se=Math.cos(this.angle),we=Math.sin(this.angle),be=T-Math.round(T)+se*ne+we*oe,Ze=S-Math.round(S)+se*oe+we*ne,ge=new Float64Array(j);if(v.translate(ge,ge,[be>.5?be-1:be,Ze>.5?Ze-1:Ze,0]),this.alignedProjMatrix=ge,j=v.create(),v.scale(j,j,[this.width/2,-this.height/2,1]),v.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=v.create(),v.scale(j,j,[1,-1,1]),v.translate(j,j,[-1,-1,0]),v.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(j=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=j,this._posMatrixCache={},this._alignedPosMatrixCache={}}},yi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},yi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},yi.prototype.getCameraQueryGeometry=function(l){var h=this.getCameraPoint();if(l.length===1)return[l[0],h];for(var c=h.x,d=h.y,x=h.x,T=h.y,S=0,I=l;S<I.length;S+=1){var N=I[S];c=Math.min(c,N.x),d=Math.min(d,N.y),x=Math.max(x,N.x),T=Math.max(T,N.y)}return[new v.Point(c,d),new v.Point(x,d),new v.Point(x,T),new v.Point(c,T),new v.Point(c,d)]},Object.defineProperties(yi.prototype,ho);var ls=function(l){var h,c,d,x;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),c=!1,d=null,x=function(){d=null,c&&(h(),d=setTimeout(x,300),c=!1)},function(){return c=!0,d||x(),d})};ls.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ls.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ls.prototype.getHashString=function(l){var h=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,d),T=Math.round(h.lng*x)/x,S=Math.round(h.lat*x)/x,I=this._map.getBearing(),N=this._map.getPitch(),j="";if(j+=l?"/"+T+"/"+S+"/"+c:c+"/"+S+"/"+T,(I||N)&&(j+="/"+Math.round(10*I)/10),N&&(j+="/"+Math.round(N)),this._hashName){var ne=this._hashName,oe=!1,se=v.window.location.hash.slice(1).split("&").map(function(we){var be=we.split("=")[0];return be===ne?(oe=!0,be+"="+j):we}).filter(function(we){return we});return oe||se.push(ne+"="+j),"#"+se.join("&")}return"#"+j},ls.prototype._getCurrentHash=function(){var l,h=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===h._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},ls.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:h,pitch:+(l[4]||0)}),!0}return!1},ls.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(h){}};var No={linearity:.3,easing:v.bezier(0,0,.3,1)},Vu=v.extend({deceleration:2500,maxSpeed:1400},No),Rc=v.extend({deceleration:20,maxSpeed:1400},No),xf=v.extend({deceleration:1e3,maxSpeed:360},No),Ic=v.extend({deceleration:1e3,maxSpeed:90},No),ch=function(l){this._map=l,this.clear()};function Zu(l,h){(!l.duration||l.duration<h.duration)&&(l.duration=h.duration,l.easing=h.easing)}function Wo(l,h,c){var d=c.maxSpeed,x=c.linearity,T=c.deceleration,S=v.clamp(l*x/(h/1e3),-d,d),I=Math.abs(S)/(T*x);return{easing:c.easing,duration:1e3*I,amount:S*(I/2)}}ch.prototype.clear=function(){this._inertiaBuffer=[]},ch.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},ch.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,h=v.browser.now();l.length>0&&h-l[0].time>160;)l.shift()},ch.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var x=d[c].settings;h.zoom+=x.zoomDelta||0,h.bearing+=x.bearingDelta||0,h.pitch+=x.pitchDelta||0,x.panDelta&&h.pan._add(x.panDelta),x.around&&(h.around=x.around),x.pinchAround&&(h.pinchAround=x.pinchAround)}var T=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,S={};if(h.pan.mag()){var I=Wo(h.pan.mag(),T,v.extend({},Vu,l||{}));S.offset=h.pan.mult(I.amount/h.pan.mag()),S.center=this._map.transform.center,Zu(S,I)}if(h.zoom){var N=Wo(h.zoom,T,Rc);S.zoom=this._map.transform.zoom+N.amount,Zu(S,N)}if(h.bearing){var j=Wo(h.bearing,T,xf);S.bearing=this._map.transform.bearing+v.clamp(j.amount,-179,179),Zu(S,j)}if(h.pitch){var ne=Wo(h.pitch,T,Ic);S.pitch=this._map.transform.pitch+ne.amount,Zu(S,ne)}if(S.zoom||S.bearing){var oe=h.pinchAround===void 0?h.around:h.pinchAround;S.around=oe?this._map.unproject(oe):this._map.getCenter()}return this.clear(),v.extend(S,{noMoveStart:!0})}};var Io=function(l){function h(d,x,T,S){S===void 0&&(S={});var I=G.mousePos(x.getCanvasContainer(),T),N=x.unproject(I);l.call(this,d,v.extend({point:I,lngLat:N,originalEvent:T},S)),this._defaultPrevented=!1,this.target=x}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(v.Event),Jl=function(l){function h(d,x,T){var S=d==="touchend"?T.changedTouches:T.touches,I=G.touchPos(x.getCanvasContainer(),S),N=I.map(function(oe){return x.unproject(oe)}),j=I.reduce(function(oe,se,we,be){return oe.add(se.div(be.length))},new v.Point(0,0)),ne=x.unproject(j);l.call(this,d,{points:I,point:j,lngLats:N,lngLat:ne,originalEvent:T}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(v.Event),Uh=function(l){function h(d,x,T){l.call(this,d,{originalEvent:T}),this._defaultPrevented=!1}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,c),h}(v.Event),Go=function(l,h){this._map=l,this._clickTolerance=h.clickTolerance};Go.prototype.reset=function(){delete this._mousedownPos},Go.prototype.wheel=function(l){return this._firePreventable(new Uh(l.type,this._map,l))},Go.prototype.mousedown=function(l,h){return this._mousedownPos=h,this._firePreventable(new Io(l.type,this._map,l))},Go.prototype.mouseup=function(l){this._map.fire(new Io(l.type,this._map,l))},Go.prototype.click=function(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Io(l.type,this._map,l))},Go.prototype.dblclick=function(l){return this._firePreventable(new Io(l.type,this._map,l))},Go.prototype.mouseover=function(l){this._map.fire(new Io(l.type,this._map,l))},Go.prototype.mouseout=function(l){this._map.fire(new Io(l.type,this._map,l))},Go.prototype.touchstart=function(l){return this._firePreventable(new Jl(l.type,this._map,l))},Go.prototype.touchmove=function(l){this._map.fire(new Jl(l.type,this._map,l))},Go.prototype.touchend=function(l){this._map.fire(new Jl(l.type,this._map,l))},Go.prototype.touchcancel=function(l){this._map.fire(new Jl(l.type,this._map,l))},Go.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Go.prototype.isEnabled=function(){return!0},Go.prototype.isActive=function(){return!1},Go.prototype.enable=function(){},Go.prototype.disable=function(){};var Hr=function(l){this._map=l};Hr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Hr.prototype.mousemove=function(l){this._map.fire(new Io(l.type,this._map,l))},Hr.prototype.mousedown=function(){this._delayContextMenu=!0},Hr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Io("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Hr.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Io(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},Hr.prototype.isEnabled=function(){return!0},Hr.prototype.isActive=function(){return!1},Hr.prototype.enable=function(){},Hr.prototype.disable=function(){};var Ss=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1};function hh(l,h){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=h[d];return c}Ss.prototype.isEnabled=function(){return!!this._enabled},Ss.prototype.isActive=function(){return!!this._active},Ss.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ss.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ss.prototype.mousedown=function(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(G.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},Ss.prototype.mousemoveWindow=function(l,h){if(this._active){var c=h;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=G.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var x=Math.min(d.x,c.x),T=Math.max(d.x,c.x),S=Math.min(d.y,c.y),I=Math.max(d.y,c.y);G.setTransform(this._box,"translate("+x+"px,"+S+"px)"),this._box.style.width=T-x+"px",this._box.style.height=I-S+"px"}}},Ss.prototype.mouseupWindow=function(l,h){var c=this;if(this._active&&l.button===0){var d=this._startPos,x=h;if(this.reset(),G.suppressClick(),d.x!==x.x||d.y!==x.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(T){return T.fitScreenCoordinates(d,x,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},Ss.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},Ss.prototype.blur=function(){this.reset()},Ss.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos},Ss.prototype._fireEvent=function(l,h){return this._map.fire(new v.Event(l,{originalEvent:h}))};var Mc=function(l){this.reset(),this.numTouches=l.numTouches};Mc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Mc.prototype.touchstart=function(l,h,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var x=new v.Point(0,0),T=0,S=d;T<S.length;T+=1)x._add(S[T]);return x.div(d.length)}(h),this.touches=hh(c,h)))},Mc.prototype.touchmove=function(l,h,c){if(!this.aborted&&this.centroid){var d=hh(c,h);for(var x in this.touches){var T=d[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}},Mc.prototype.touchend=function(l,h,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Qa=function(l){this.singleTap=new Mc(l),this.numTaps=l.numTaps,this.reset()};Qa.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Qa.prototype.touchstart=function(l,h,c){this.singleTap.touchstart(l,h,c)},Qa.prototype.touchmove=function(l,h,c){this.singleTap.touchmove(l,h,c)},Qa.prototype.touchend=function(l,h,c){var d=this.singleTap.touchend(l,h,c);if(d){var x=l.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(d)<30;if(x&&T||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var io=function(){this._zoomIn=new Qa({numTouches:1,numTaps:2}),this._zoomOut=new Qa({numTouches:2,numTaps:1}),this.reset()};io.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},io.prototype.touchstart=function(l,h,c){this._zoomIn.touchstart(l,h,c),this._zoomOut.touchstart(l,h,c)},io.prototype.touchmove=function(l,h,c){this._zoomIn.touchmove(l,h,c),this._zoomOut.touchmove(l,h,c)},io.prototype.touchend=function(l,h,c){var d=this,x=this._zoomIn.touchend(l,h,c),T=this._zoomOut.touchend(l,h,c);return x?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(S){return S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:l})}}):T?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(S){return S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(T)},{originalEvent:l})}}):void 0},io.prototype.touchcancel=function(){this.reset()},io.prototype.enable=function(){this._enabled=!0},io.prototype.disable=function(){this._enabled=!1,this.reset()},io.prototype.isEnabled=function(){return this._enabled},io.prototype.isActive=function(){return this._active};var ec={0:1,2:2},zr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};zr.prototype.blur=function(){this.reset()},zr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},zr.prototype._correctButton=function(l,h){return!1},zr.prototype._move=function(l,h){return{}},zr.prototype.mousedown=function(l,h){if(!this._lastPoint){var c=G.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=h,this._eventButton=c)}},zr.prototype.mousemoveWindow=function(l,h){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,x){var T=ec[x];return d.buttons===void 0||(d.buttons&T)!==T}(l,this._eventButton))this.reset();else if(this._moved||!(h.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(c,h)}},zr.prototype.mouseupWindow=function(l){this._lastPoint&&G.mouseButton(l)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())},zr.prototype.enable=function(){this._enabled=!0},zr.prototype.disable=function(){this._enabled=!1,this.reset()},zr.prototype.isEnabled=function(){return this._enabled},zr.prototype.isActive=function(){return this._active};var qs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},h.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},h}(zr),Oc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var x=.8*(d.x-c.x);if(x)return this._active=!0,{bearingDelta:x}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(zr),Pc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},h.prototype._move=function(c,d){var x=-.5*(d.y-c.y);if(x)return this._active=!0,{pitchDelta:x}},h.prototype.contextmenu=function(c){c.preventDefault()},h}(zr),Ks=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ks.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},Ks.prototype.touchstart=function(l,h,c){return this._calculateTransform(l,h,c)},Ks.prototype.touchmove=function(l,h,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,h,c)},Ks.prototype.touchend=function(l,h,c){this._calculateTransform(l,h,c),this._active&&c.length<this._minTouches&&this.reset()},Ks.prototype.touchcancel=function(){this.reset()},Ks.prototype._calculateTransform=function(l,h,c){c.length>0&&(this._active=!0);var d=hh(c,h),x=new v.Point(0,0),T=new v.Point(0,0),S=0;for(var I in d){var N=d[I],j=this._touches[I];j&&(x._add(N),T._add(N.sub(j)),S++,d[I]=N)}if(this._touches=d,!(S<this._minTouches)&&T.mag()){var ne=T.div(S);if(this._sum._add(ne),!(this._sum.mag()<this._clickTolerance))return{around:x.div(S),panDelta:ne}}},Ks.prototype.enable=function(){this._enabled=!0},Ks.prototype.disable=function(){this._enabled=!1,this.reset()},Ks.prototype.isEnabled=function(){return this._enabled},Ks.prototype.isActive=function(){return this._active};var cs=function(){this.reset()};function kh(l,h,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return h[d]}function fh(l,h){return Math.log(l/h)/Math.LN2}cs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},cs.prototype._start=function(l){},cs.prototype._move=function(l,h,c){return{}},cs.prototype.touchstart=function(l,h,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([h[0],h[1]]))},cs.prototype.touchmove=function(l,h,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,x=d[1],T=kh(c,h,d[0]),S=kh(c,h,x);if(T&&S){var I=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],I,l)}}},cs.prototype.touchend=function(l,h,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,x=d[1],T=kh(c,h,d[0]),S=kh(c,h,x);T&&S||(this._active&&G.suppressClick(),this.reset())}},cs.prototype.touchcancel=function(){this.reset()},cs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},cs.prototype.disable=function(){this._enabled=!1,this.reset()},cs.prototype.isEnabled=function(){return this._enabled},cs.prototype.isActive=function(){return this._active};var hs=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},h.prototype._move=function(c,d){var x=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(fh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fh(this._distance,x),pinchAround:d}},h}(cs);function Ja(l,h){return 180*l.angleWith(h)/Math.PI}var bf=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},h.prototype._move=function(c,d){var x=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ja(this._vector,x),pinchAround:d}},h.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,x=Ja(c,this._startVector);return Math.abs(x)<d},h}(cs);function tc(l){return Math.abs(l.y)>Math.abs(l.x)}var zh=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(c){this._lastPoints=c,tc(c[0].sub(c[1]))&&(this._valid=!1)},h.prototype._move=function(c,d,x){var T=c[0].sub(this._lastPoints[0]),S=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(T,S,x.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(T.y+S.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(c,d,x){if(this._valid!==void 0)return this._valid;var T=c.mag()>=2,S=d.mag()>=2;if(T||S){if(!T||!S)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;var I=c.y>0==d.y>0;return tc(c)&&tc(d)&&I}},h}(cs),Ef={panStep:100,bearingStep:15,pitchStep:10},ws=function(){var l=Ef;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function $s(l){return l*(2-l)}ws.prototype.blur=function(){this.reset()},ws.prototype.reset=function(){this._active=!1},ws.prototype.keydown=function(l){var h=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,x=0,T=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),T=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),T=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,x=0),{cameraAnimation:function(I){var N=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:$s,zoom:c?Math.round(N)+c*(l.shiftKey?2:1):N,bearing:I.getBearing()+d*h._bearingStep,pitch:I.getPitch()+x*h._pitchStep,offset:[-T*h._panStep,-S*h._panStep],center:I.getCenter()},{originalEvent:l})}}}},ws.prototype.enable=function(){this._enabled=!0},ws.prototype.disable=function(){this._enabled=!1,this.reset()},ws.prototype.isEnabled=function(){return this._enabled},ws.prototype.isActive=function(){return this._active},ws.prototype.disableRotation=function(){this._rotationDisabled=!0},ws.prototype.enableRotation=function(){this._rotationDisabled=!1};var $n=function(l,h){this._map=l,this._el=l.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};$n.prototype.setZoomRate=function(l){this._defaultZoomRate=l},$n.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},$n.prototype.isEnabled=function(){return!!this._enabled},$n.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},$n.prototype.isZooming=function(){return!!this._zooming},$n.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},$n.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},$n.prototype.wheel=function(l){if(this.isEnabled()){var h=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}},$n.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},$n.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=G.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},$n.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var x=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(x*d))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var T,S=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,I=this._startZoom,N=this._easing,j=!1;if(this._type==="wheel"&&I&&N){var ne=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),oe=N(ne);T=v.number(I,S,oe),ne<1?this._frameId||(this._frameId=!0):j=!0}else T=S,j=!0;return this._active=!0,j&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!j,zoomDelta:T-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},$n.prototype._smoothOutEasing=function(l){var h=v.ease;if(this._prevEase){var c=this._prevEase,d=(v.browser.now()-c.start)/c.duration,x=c.easing(d+.01)-c.easing(d),T=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-T*T);h=v.bezier(T,S,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:h},h},$n.prototype.blur=function(){this.reset()},$n.prototype.reset=function(){this._active=!1};var zs=function(l,h){this._clickZoom=l,this._tapZoom=h};zs.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},zs.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},zs.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},zs.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Vs=function(){this.reset()};Vs.prototype.reset=function(){this._active=!1},Vs.prototype.blur=function(){this.reset()},Vs.prototype.dblclick=function(l,h){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(h)},{originalEvent:l})}}},Vs.prototype.enable=function(){this._enabled=!0},Vs.prototype.disable=function(){this._enabled=!1,this.reset()},Vs.prototype.isEnabled=function(){return this._enabled},Vs.prototype.isActive=function(){return this._active};var da=function(){this._tap=new Qa({numTouches:1,numTaps:1}),this.reset()};da.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},da.prototype.touchstart=function(l,h,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=h[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,h,c))},da.prototype.touchmove=function(l,h,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=h[0],x=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(l,h,c)},da.prototype.touchend=function(l,h,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,h,c)&&(this._tapTime=l.timeStamp)},da.prototype.touchcancel=function(){this.reset()},da.prototype.enable=function(){this._enabled=!0},da.prototype.disable=function(){this._enabled=!1,this.reset()},da.prototype.isEnabled=function(){return this._enabled},da.prototype.isActive=function(){return this._active};var Il=function(l,h,c){this._el=l,this._mousePan=h,this._touchPan=c};Il.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Il.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Il.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Il.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ju=function(l,h,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=c};ju.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ju.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ju.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ju.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Qs=function(l,h,c,d){this._el=l,this._touchZoom=h,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Qs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Qs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Qs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Qs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Qs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Qs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var es=function(l){return l.zoom||l.drag||l.pitch||l.rotate},rc=function(l){function h(){l.apply(this,arguments)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h}(v.Event);function bn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var ln=function(l,h){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ch(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var d=0,x=this._listeners;d<x.length;d+=1){var T=x[d],S=T[0];G.addEventListener(S,T[1],S===v.window.document?this.handleWindowEvent:this.handleEvent,T[2])}};ln.prototype.destroy=function(){for(var l=0,h=this._listeners;l<h.length;l+=1){var c=h[l],d=c[0];G.removeEventListener(d,c[1],d===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},ln.prototype._addDefaultHandlers=function(l){var h=this._map,c=h.getCanvasContainer();this._add("mapEvent",new Go(h,l));var d=h.boxZoom=new Ss(h,l);this._add("boxZoom",d);var x=new io,T=new Vs;h.doubleClickZoom=new zs(T,x),this._add("tapZoom",x),this._add("clickZoom",T);var S=new da;this._add("tapDragZoom",S);var I=h.touchPitch=new zh;this._add("touchPitch",I);var N=new Oc(l),j=new Pc(l);h.dragRotate=new ju(l,N,j),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);var ne=new qs(l),oe=new Ks(l);h.dragPan=new Il(c,ne,oe),this._add("mousePan",ne),this._add("touchPan",oe,["touchZoom","touchRotate"]);var se=new bf,we=new hs;h.touchZoomRotate=new Qs(c,we,se,S),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]);var be=h.scrollZoom=new $n(h,this);this._add("scrollZoom",be,["mousePan"]);var Ze=h.keyboard=new ws;this._add("keyboard",Ze),this._add("blockableMapEvent",new Hr(h));for(var ge=0,Ve=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ge<Ve.length;ge+=1){var $e=Ve[ge];l.interactive&&l[$e]&&h[$e].enable(l[$e])}},ln.prototype._add=function(l,h,c){this._handlers.push({handlerName:l,handler:h,allowed:c}),this._handlersById[l]=h},ln.prototype.stop=function(l){if(!this._updatingCamera){for(var h=0,c=this._handlers;h<c.length;h+=1)c[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},ln.prototype.isActive=function(){for(var l=0,h=this._handlers;l<h.length;l+=1)if(h[l].handler.isActive())return!0;return!1},ln.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ln.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ln.prototype.isMoving=function(){return!!es(this._eventsInProgress)||this.isZooming()},ln.prototype._blockedByActive=function(l,h,c){for(var d in l)if(d!==c&&(!h||h.indexOf(d)<0))return!0;return!1},ln.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},ln.prototype._getMapTouches=function(l){for(var h=[],c=0,d=l;c<d.length;c+=1){var x=d[c];this._el.contains(x.target)&&h.push(x)}return h},ln.prototype.handleEvent=function(l,h){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},x={},T={},S=l.touches?this._getMapTouches(l.touches):void 0,I=S?G.touchPos(this._el,S):G.mousePos(this._el,l),N=0,j=this._handlers;N<j.length;N+=1){var ne=j[N],oe=ne.handlerName,se=ne.handler,we=ne.allowed;if(se.isEnabled()){var be=void 0;this._blockedByActive(T,we,oe)?se.reset():se[h||l.type]&&(be=se[h||l.type](l,I,S),this.mergeHandlerResult(d,x,be,oe,c),be&&be.needsRenderFrame&&this._triggerRenderFrame()),(be||se.isActive())&&(T[oe]=se)}}var Ze={};for(var ge in this._previousActiveHandlers)T[ge]||(Ze[ge]=c);this._previousActiveHandlers=T,(Object.keys(Ze).length||bn(d))&&(this._changes.push([d,x,Ze]),this._triggerRenderFrame()),(Object.keys(T).length||bn(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ve=d.cameraAnimation;Ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ve(this._map))},ln.prototype.mergeHandlerResult=function(l,h,c,d,x){if(c){v.extend(l,c);var T={handlerName:d,originalEvent:c.originalEvent||x};c.zoomDelta!==void 0&&(h.zoom=T),c.panDelta!==void 0&&(h.drag=T),c.pitchDelta!==void 0&&(h.pitch=T),c.bearingDelta!==void 0&&(h.rotate=T)}},ln.prototype._applyChanges=function(){for(var l={},h={},c={},d=0,x=this._changes;d<x.length;d+=1){var T=x[d],S=T[0],I=T[1],N=T[2];S.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(S.panDelta)),S.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+S.zoomDelta),S.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+S.bearingDelta),S.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+S.pitchDelta),S.around!==void 0&&(l.around=S.around),S.pinchAround!==void 0&&(l.pinchAround=S.pinchAround),S.noInertia&&(l.noInertia=S.noInertia),v.extend(h,I),v.extend(c,N)}this._updateMapTransform(l,h,c),this._changes=[]},ln.prototype._updateMapTransform=function(l,h,c){var d=this._map,x=d.transform;if(!bn(l))return this._fireEvents(h,c,!0);var T=l.panDelta,S=l.zoomDelta,I=l.bearingDelta,N=l.pitchDelta,j=l.around,ne=l.pinchAround;ne!==void 0&&(j=ne),d._stop(!0),j=j||d.transform.centerPoint;var oe=x.pointLocation(T?j.sub(T):j);I&&(x.bearing+=I),N&&(x.pitch+=N),S&&(x.zoom+=S),x.setLocationAtPoint(oe,j),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,c,!0)},ln.prototype._fireEvents=function(l,h,c){var d=this,x=es(this._eventsInProgress),T=es(l),S={};for(var I in l)this._eventsInProgress[I]||(S[I+"start"]=l[I].originalEvent),this._eventsInProgress[I]=l[I];for(var N in!x&&T&&this._fireEvent("movestart",T.originalEvent),S)this._fireEvent(N,S[N]);for(var j in T&&this._fireEvent("move",T.originalEvent),l)this._fireEvent(j,l[j].originalEvent);var ne,oe={};for(var se in this._eventsInProgress){var we=this._eventsInProgress[se],be=we.handlerName,Ze=we.originalEvent;this._handlersById[be].isActive()||(delete this._eventsInProgress[se],oe[se+"end"]=ne=h[be]||Ze)}for(var ge in oe)this._fireEvent(ge,oe[ge]);var Ve=es(this._eventsInProgress);if(c&&(x||T)&&!Ve){this._updatingCamera=!0;var $e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ht=function(Lt){return Lt!==0&&-d._bearingSnap<Lt&&Lt<d._bearingSnap};$e?(ht($e.bearing||this._map.getBearing())&&($e.bearing=0),this._map.easeTo($e,{originalEvent:ne})):(this._map.fire(new v.Event("moveend",{originalEvent:ne})),ht(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ln.prototype._fireEvent=function(l,h){this._map.fire(new v.Event(l,h?{originalEvent:h}:{}))},ln.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete l._frameId,l.handleEvent(new rc("renderFrame",{timeStamp:h})),l._applyChanges()})},ln.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var fs=function(l){function h(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},h.prototype.panBy=function(c,d,x){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},d),x)},h.prototype.panTo=function(c,d,x){return this.easeTo(v.extend({center:c},d),x)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},h.prototype.zoomTo=function(c,d,x){return this.easeTo(v.extend({zoom:c},d),x)},h.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},h.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},h.prototype.rotateTo=function(c,d,x){return this.easeTo(v.extend({bearing:c},d),x)},h.prototype.resetNorth=function(c,d){return this.rotateTo(0,v.extend({duration:1e3},c),d),this},h.prototype.resetNorthPitch=function(c,d){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),d),this},h.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},h.prototype.cameraForBounds=function(c,d){c=v.LngLatBounds.convert(c);var x=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),x,d)},h.prototype._cameraForBoxAndBearing=function(c,d,x,T){var S={top:0,bottom:0,right:0,left:0};if(typeof(T=v.extend({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},T)).padding=="number"){var I=T.padding;T.padding={top:I,bottom:I,right:I,left:I}}T.padding=v.extend(S,T.padding);var N=this.transform,j=N.padding,ne=N.project(v.LngLat.convert(c)),oe=N.project(v.LngLat.convert(d)),se=ne.rotate(-x*Math.PI/180),we=oe.rotate(-x*Math.PI/180),be=new v.Point(Math.max(se.x,we.x),Math.max(se.y,we.y)),Ze=new v.Point(Math.min(se.x,we.x),Math.min(se.y,we.y)),ge=be.sub(Ze),Ve=(N.width-(j.left+j.right+T.padding.left+T.padding.right))/ge.x,$e=(N.height-(j.top+j.bottom+T.padding.top+T.padding.bottom))/ge.y;if(!($e<0||Ve<0)){var ht=Math.min(N.scaleZoom(N.scale*Math.min(Ve,$e)),T.maxZoom),Lt=typeof T.offset.x=="number"?new v.Point(T.offset.x,T.offset.y):v.Point.convert(T.offset),Tt=new v.Point((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(x*Math.PI/180),jt=Lt.add(Tt).mult(N.scale/N.zoomScale(ht));return{center:N.unproject(ne.add(oe).div(2).sub(jt)),zoom:ht,bearing:x}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(c,d,x){return this._fitInternal(this.cameraForBounds(c,d),d,x)},h.prototype.fitScreenCoordinates=function(c,d,x,T,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(d)),x,T),T,S)},h.prototype._fitInternal=function(c,d,x){return c?(delete(d=v.extend(c,d)).padding,d.linear?this.easeTo(d,x):this.flyTo(d,x)):this},h.prototype.jumpTo=function(c,d){this.stop();var x=this.transform,T=!1,S=!1,I=!1;return"zoom"in c&&x.zoom!==+c.zoom&&(T=!0,x.zoom=+c.zoom),c.center!==void 0&&(x.center=v.LngLat.convert(c.center)),"bearing"in c&&x.bearing!==+c.bearing&&(S=!0,x.bearing=+c.bearing),"pitch"in c&&x.pitch!==+c.pitch&&(I=!0,x.pitch=+c.pitch),c.padding==null||x.isPaddingEqual(c.padding)||(x.padding=c.padding),this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),T&&this.fire(new v.Event("zoomstart",d)).fire(new v.Event("zoom",d)).fire(new v.Event("zoomend",d)),S&&this.fire(new v.Event("rotatestart",d)).fire(new v.Event("rotate",d)).fire(new v.Event("rotateend",d)),I&&this.fire(new v.Event("pitchstart",d)).fire(new v.Event("pitch",d)).fire(new v.Event("pitchend",d)),this.fire(new v.Event("moveend",d))},h.prototype.easeTo=function(c,d){var x=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var T=this.transform,S=this.getZoom(),I=this.getBearing(),N=this.getPitch(),j=this.getPadding(),ne="zoom"in c?+c.zoom:S,oe="bearing"in c?this._normalizeBearing(c.bearing,I):I,se="pitch"in c?+c.pitch:N,we="padding"in c?c.padding:T.padding,be=v.Point.convert(c.offset),Ze=T.centerPoint.add(be),ge=T.pointLocation(Ze),Ve=v.LngLat.convert(c.center||ge);this._normalizeCenter(Ve);var $e,ht,Lt=T.project(ge),Tt=T.project(Ve).sub(Lt),jt=T.zoomScale(ne-S);c.around&&($e=v.LngLat.convert(c.around),ht=T.locationPoint($e));var ar={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ne!==S,this._rotating=this._rotating||I!==oe,this._pitching=this._pitching||se!==N,this._padding=!T.isPaddingEqual(we),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,ar),this._ease(function(Ir){if(x._zooming&&(T.zoom=v.number(S,ne,Ir)),x._rotating&&(T.bearing=v.number(I,oe,Ir)),x._pitching&&(T.pitch=v.number(N,se,Ir)),x._padding&&(T.interpolatePadding(j,we,Ir),Ze=T.centerPoint.add(be)),$e)T.setLocationAtPoint($e,ht);else{var Tr=T.zoomScale(T.zoom-S),Qr=ne>S?Math.min(2,jt):Math.max(.5,jt),mn=Math.pow(Qr,1-Ir),Cn=T.unproject(Lt.add(Tt.mult(Ir*mn)).mult(Tr));T.setLocationAtPoint(T.renderWorldCopies?Cn.wrap():Cn,Ze)}x._fireMoveEvents(d)},function(Ir){x._afterEase(d,Ir)},c),this},h.prototype._prepareEase=function(c,d,x){x===void 0&&(x={}),this._moving=!0,d||x.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!x.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!x.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!x.pitching&&this.fire(new v.Event("pitchstart",c))},h.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},h.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var x=this._zooming,T=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new v.Event("zoomend",c)),T&&this.fire(new v.Event("rotateend",c)),S&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},h.prototype.flyTo=function(c,d){var x=this;if(!c.essential&&v.browser.prefersReducedMotion){var T=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(T,d)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var S=this.transform,I=this.getZoom(),N=this.getBearing(),j=this.getPitch(),ne=this.getPadding(),oe="zoom"in c?v.clamp(+c.zoom,S.minZoom,S.maxZoom):I,se="bearing"in c?this._normalizeBearing(c.bearing,N):N,we="pitch"in c?+c.pitch:j,be="padding"in c?c.padding:S.padding,Ze=S.zoomScale(oe-I),ge=v.Point.convert(c.offset),Ve=S.centerPoint.add(ge),$e=S.pointLocation(Ve),ht=v.LngLat.convert(c.center||$e);this._normalizeCenter(ht);var Lt=S.project($e),Tt=S.project(ht).sub(Lt),jt=c.curve,ar=Math.max(S.width,S.height),Ir=ar/Ze,Tr=Tt.mag();if("minZoom"in c){var Qr=v.clamp(Math.min(c.minZoom,I,oe),S.minZoom,S.maxZoom),mn=ar/S.zoomScale(Qr-I);jt=Math.sqrt(mn/Tr*2)}var Cn=jt*jt;function _n(In){var Pn=(Ir*Ir-ar*ar+(In?-1:1)*Cn*Cn*Tr*Tr)/(2*(In?Ir:ar)*Cn*Tr);return Math.log(Math.sqrt(Pn*Pn+1)-Pn)}function wi(In){return(Math.exp(In)-Math.exp(-In))/2}function nn(In){return(Math.exp(In)+Math.exp(-In))/2}var Vn=_n(0),ri=function(In){return nn(Vn)/nn(Vn+jt*In)},Zn=function(In){return ar*((nn(Vn)*(wi(Pn=Vn+jt*In)/nn(Pn))-wi(Vn))/Cn)/Tr;var Pn},Fn=(_n(1)-Vn)/jt;if(Math.abs(Tr)<1e-6||!isFinite(Fn)){if(Math.abs(ar-Ir)<1e-6)return this.easeTo(c,d);var Wn=Ir<ar?-1:1;Fn=Math.abs(Math.log(Ir/ar))/jt,Zn=function(){return 0},ri=function(In){return Math.exp(Wn*jt*In)}}return c.duration="duration"in c?+c.duration:1e3*Fn/("screenSpeed"in c?+c.screenSpeed/jt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=N!==se,this._pitching=we!==j,this._padding=!S.isPaddingEqual(be),this._prepareEase(d,!1),this._ease(function(In){var Pn=In*Fn,ca=1/ri(Pn);S.zoom=In===1?oe:I+S.scaleZoom(ca),x._rotating&&(S.bearing=v.number(N,se,In)),x._pitching&&(S.pitch=v.number(j,we,In)),x._padding&&(S.interpolatePadding(ne,be,In),Ve=S.centerPoint.add(ge));var Mo=In===1?ht:S.unproject(Lt.add(Tt.mult(Zn(Pn))).mult(ca));S.setLocationAtPoint(S.renderWorldCopies?Mo.wrap():Mo,Ve),x._fireMoveEvents(d)},function(){return x._afterEase(d)},c),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,d)}if(!c){var T=this.handlers;T&&T.stop(!1)}return this},h.prototype._ease=function(c,d,x){x.animate===!1||x.duration===0?(c(1),d()):(this._easeStart=v.browser.now(),this._easeOptions=x,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(c,d){c=v.wrap(c,-180,180);var x=Math.abs(c-d);return Math.abs(c-360-d)<x&&(c-=360),Math.abs(c+360-d)<x&&(c+=360),c},h.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var x=c.lng-d.center.lng;c.lng+=x>180?-360:x<-180?360:0}},h}(v.Evented),Ga=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Ga.prototype.getDefaultPosition=function(){return"bottom-right"},Ga.prototype.onAdd=function(l){var h=this.options&&this.options.compact;return this._map=l,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Ga.prototype.onRemove=function(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Ga.prototype._setElementTitle=function(l,h){var c=this._map._getUIString("AttributionControl."+h);l.title=c,l.setAttribute("aria-label",c)},Ga.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Ga.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=h.reduce(function(d,x,T){return x.value&&(d+=x.key+"="+x.value+(T<h.length-1?"&":"")),d},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},Ga.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Ga.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(I){return typeof I!="string"?"":I})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var c=this._map.style.sourceCaches;for(var d in c){var x=c[d];if(x.used){var T=x.getSource();T.attribution&&l.indexOf(T.attribution)<0&&l.push(T.attribution)}}l.sort(function(I,N){return I.length-N.length});var S=(l=l.filter(function(I,N){for(var j=N+1;j<l.length;j++)if(l[j].indexOf(I)>=0)return!1;return!0})).join(" | ");S!==this._attribHTML&&(this._attribHTML=S,l.length?(this._innerContainer.innerHTML=S,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Ga.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var uu=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};uu.prototype.onAdd=function(l){this._map=l,this._container=G.create("div","mapboxgl-ctrl");var h=G.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},uu.prototype.onRemove=function(){G.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},uu.prototype.getDefaultPosition=function(){return"bottom-left"},uu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},uu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var h in l)if(l[h].getSource().mapbox_logo)return!0;return!1}},uu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var h=l[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var xo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};xo.prototype.add=function(l){var h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h},xo.prototype.remove=function(l){for(var h=this._currentlyRunning,c=0,d=h?this._queue.concat(h):this._queue;c<d.length;c+=1){var x=d[c];if(x.id===l)return void(x.cancelled=!0)}},xo.prototype.run=function(l){l===void 0&&(l=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=h;c<d.length;c+=1){var x=d[c];if(!x.cancelled&&(x.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},xo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Zs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Su=v.window.HTMLImageElement,nc=v.window.HTMLElement,Vi=v.window.ImageBitmap,ma={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Vh=function(l){function h(d){var x=this;if((d=v.extend({},ma,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var T=new yi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,T,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new xo,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Zs,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new v.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=v.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof nc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return x._update(!1)}),this.on("moveend",function(){return x._update(!1)}),this.on("zoom",function(){return x._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ln(this,d),this._hash=d.hash&&new ls(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,v.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Ga({customAttribution:d.customAttribution})),this.addControl(new uu,d.logoPosition),this.on("style.load",function(){x.transform.unmodified&&x.jumpTo(x.style.stylesheet)}),this.on("data",function(S){x._update(S.dataType==="style"),x.fire(new v.Event(S.dataType+"data",S))}),this.on("dataloading",function(S){x.fire(new v.Event(S.dataType+"dataloading",S))})}l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(d,x){if(x===void 0&&(x=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var T=d.onAdd(this);this._controls.push(d);var S=this._controlPositions[x];return x.indexOf("bottom")!==-1?S.insertBefore(T,S.firstChild):S.appendChild(T),this},h.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var x=this._controls.indexOf(d);return x>-1&&this._controls.splice(x,1),d.onRemove(this),this},h.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},h.prototype.resize=function(d){var x=this._containerDimensions(),T=x[0],S=x[1];if(T===this.transform.width&&S===this.transform.height)return this;this._resizeCanvas(T,S),this.transform.resize(T,S),this.painter.resize(T,S);var I=!this._moving;return I&&this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),this.fire(new v.Event("resize",d)),I&&this.fire(new v.Event("moveend",d)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(v.LngLatBounds.convert(d)),this._update()},h.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},h.prototype.project=function(d){return this.transform.locationPoint(v.LngLat.convert(d))},h.prototype.unproject=function(d){return this.transform.pointLocation(v.Point.convert(d))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(d,x,T){var S,I=this;if(d==="mouseenter"||d==="mouseover"){var N=!1;return{layer:x,listener:T,delegates:{mousemove:function(ne){var oe=I.getLayer(x)?I.queryRenderedFeatures(ne.point,{layers:[x]}):[];oe.length?N||(N=!0,T.call(I,new Io(d,I,ne.originalEvent,{features:oe}))):N=!1},mouseout:function(){N=!1}}}}if(d==="mouseleave"||d==="mouseout"){var j=!1;return{layer:x,listener:T,delegates:{mousemove:function(ne){(I.getLayer(x)?I.queryRenderedFeatures(ne.point,{layers:[x]}):[]).length?j=!0:j&&(j=!1,T.call(I,new Io(d,I,ne.originalEvent)))},mouseout:function(ne){j&&(j=!1,T.call(I,new Io(d,I,ne.originalEvent)))}}}}return{layer:x,listener:T,delegates:(S={},S[d]=function(ne){var oe=I.getLayer(x)?I.queryRenderedFeatures(ne.point,{layers:[x]}):[];oe.length&&(ne.features=oe,T.call(I,ne),delete ne.features)},S)}},h.prototype.on=function(d,x,T){if(T===void 0)return l.prototype.on.call(this,d,x);var S=this._createDelegatedListener(d,x,T);for(var I in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(S),S.delegates)this.on(I,S.delegates[I]);return this},h.prototype.once=function(d,x,T){if(T===void 0)return l.prototype.once.call(this,d,x);var S=this._createDelegatedListener(d,x,T);for(var I in S.delegates)this.once(I,S.delegates[I]);return this},h.prototype.off=function(d,x,T){var S=this;return T===void 0?l.prototype.off.call(this,d,x):(this._delegatedListeners&&this._delegatedListeners[d]&&function(I){for(var N=I[d],j=0;j<N.length;j++){var ne=N[j];if(ne.layer===x&&ne.listener===T){for(var oe in ne.delegates)S.off(oe,ne.delegates[oe]);return N.splice(j,1),S}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(d,x){if(!this.style)return[];var T;if(x!==void 0||d===void 0||d instanceof v.Point||Array.isArray(d)||(x=d,d=void 0),x=x||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof d[0]=="number")T=[v.Point.convert(d)];else{var S=v.Point.convert(d[0]),I=v.Point.convert(d[1]);T=[S,new v.Point(I.x,S.y),I,new v.Point(S.x,I.y),S]}return this.style.queryRenderedFeatures(T,x,this.transform)},h.prototype.querySourceFeatures=function(d,x){return this.style.querySourceFeatures(d,x)},h.prototype.setStyle=function(d,x){return(x=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},x)).diff!==!1&&x.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,x),this):(this._localIdeographFontFamily=x.localIdeographFontFamily,this._updateStyle(d,x))},h.prototype._getUIString=function(d){var x=this._locale[d];if(x==null)throw new Error("Missing UI string '"+d+"'");return x},h.prototype._updateStyle=function(d,x){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new Ts(this,x||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ts(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(d,x){var T=this;if(typeof d=="string"){var S=this._requestManager.normalizeStyleURL(d),I=this._requestManager.transformRequest(S,v.ResourceType.Style);v.getJSON(I,function(N,j){N?T.fire(new v.ErrorEvent(N)):j&&T._updateDiff(j,x)})}else typeof d=="object"&&this._updateDiff(d,x)},h.prototype._updateDiff=function(d,x){try{this.style.setState(d)&&this._update(!0)}catch(T){v.warnOnce("Unable to perform style diff: "+(T.message||T.error||T)+".  Rebuilding the style from scratch."),this._updateStyle(d,x)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(d,x){return this._lazyInitEmptyStyle(),this.style.addSource(d,x),this._update(!0)},h.prototype.isSourceLoaded=function(d){var x=this.style&&this.style.sourceCaches[d];if(x!==void 0)return x.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},h.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var x in d){var T=d[x]._tiles;for(var S in T){var I=T[S];if(I.state!=="loaded"&&I.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(d,x,T){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,x,T)},h.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},h.prototype.getSource=function(d){return this.style.getSource(d)},h.prototype.addImage=function(d,x,T){T===void 0&&(T={});var S=T.pixelRatio;S===void 0&&(S=1);var I=T.sdf;I===void 0&&(I=!1);var N=T.stretchX,j=T.stretchY,ne=T.content;if(this._lazyInitEmptyStyle(),x instanceof Su||Vi&&x instanceof Vi){var oe=v.browser.getImageData(x);this.style.addImage(d,{data:new v.RGBAImage({width:oe.width,height:oe.height},oe.data),pixelRatio:S,stretchX:N,stretchY:j,content:ne,sdf:I,version:0})}else{if(x.width===void 0||x.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var se=x;this.style.addImage(d,{data:new v.RGBAImage({width:x.width,height:x.height},new Uint8Array(x.data)),pixelRatio:S,stretchX:N,stretchY:j,content:ne,sdf:I,version:0,userImage:se}),se.onAdd&&se.onAdd(this,d)}},h.prototype.updateImage=function(d,x){var T=this.style.getImage(d);if(!T)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var S=x instanceof Su||Vi&&x instanceof Vi?v.browser.getImageData(x):x,I=S.width,N=S.height,j=S.data;return I===void 0||N===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):I!==T.data.width||N!==T.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(T.data.replace(j,!(x instanceof Su||Vi&&x instanceof Vi)),void this.style.updateImage(d,T))},h.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(d){this.style.removeImage(d)},h.prototype.loadImage=function(d,x){v.getImage(this._requestManager.transformRequest(d,v.ResourceType.Image),x)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(d,x){return this._lazyInitEmptyStyle(),this.style.addLayer(d,x),this._update(!0)},h.prototype.moveLayer=function(d,x){return this.style.moveLayer(d,x),this._update(!0)},h.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},h.prototype.getLayer=function(d){return this.style.getLayer(d)},h.prototype.setLayerZoomRange=function(d,x,T){return this.style.setLayerZoomRange(d,x,T),this._update(!0)},h.prototype.setFilter=function(d,x,T){return T===void 0&&(T={}),this.style.setFilter(d,x,T),this._update(!0)},h.prototype.getFilter=function(d){return this.style.getFilter(d)},h.prototype.setPaintProperty=function(d,x,T,S){return S===void 0&&(S={}),this.style.setPaintProperty(d,x,T,S),this._update(!0)},h.prototype.getPaintProperty=function(d,x){return this.style.getPaintProperty(d,x)},h.prototype.setLayoutProperty=function(d,x,T,S){return S===void 0&&(S={}),this.style.setLayoutProperty(d,x,T,S),this._update(!0)},h.prototype.getLayoutProperty=function(d,x){return this.style.getLayoutProperty(d,x)},h.prototype.setLight=function(d,x){return x===void 0&&(x={}),this._lazyInitEmptyStyle(),this.style.setLight(d,x),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(d,x){return this.style.setFeatureState(d,x),this._update()},h.prototype.removeFeatureState=function(d,x){return this.style.removeFeatureState(d,x),this._update()},h.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var d=0,x=0;return this._container&&(d=this._container.clientWidth||400,x=this._container.clientHeight||300),[d,x]},h.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=G.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var x=this._canvasContainer=G.create("div","mapboxgl-canvas-container",d);this._interactive&&x.classList.add("mapboxgl-interactive"),this._canvas=G.create("canvas","mapboxgl-canvas",x),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var T=this._containerDimensions();this._resizeCanvas(T[0],T[1]);var S=this._controlContainer=G.create("div","mapboxgl-control-container",d),I=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(N){I[N]=G.create("div","mapboxgl-ctrl-"+N,S)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(d,x){var T=v.browser.devicePixelRatio||1;this._canvas.width=T*d,this._canvas.height=T*x,this._canvas.style.width=d+"px",this._canvas.style.height=x+"px"},h.prototype._setupPainter=function(){var d=v.extend({},at.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),x=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);x?(this.painter=new mo(x,this.transform),v.webpSupported.testSupport(x)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:d}))},h.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:d}))},h.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},h.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},h.prototype._render=function(d){var x,T=this,S=0,I=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(x=I.createQueryEXT(),I.beginQueryEXT(I.TIME_ELAPSED_EXT,x),S=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var N=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var j=this.transform.zoom,ne=v.browser.now();this.style.zoomHistory.update(j,ne);var oe=new v.EvaluationParameters(j,{now:ne,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),se=oe.crossFadingFactor();se===1&&se===this._crossFadingFactor||(N=!0,this._crossFadingFactor=se),this.style.update(oe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||N)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var we=v.browser.now()-S;I.endQueryEXT(I.TIME_ELAPSED_EXT,x),setTimeout(function(){var ge=I.getQueryObjectEXT(x,I.QUERY_RESULT_EXT)/1e6;I.deleteQueryEXT(x),T.fire(new v.Event("gpu-timing-frame",{cpuTime:we,gpuTime:ge}))},50)}if(this.listens("gpu-timing-layer")){var be=this.painter.collectGpuTimers();setTimeout(function(){var ge=T.painter.queryGpuTimers(be);T.fire(new v.Event("gpu-timing-layer",{layerTimes:ge}))},50)}var Ze=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ze||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||Ze||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,x=this._controls;d<x.length;d+=1)x[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var T=this.painter.context.gl.getExtension("WEBGL_lose_context");T&&T.loseContext(),ul(this._canvasContainer),ul(this._controlContainer),ul(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},h.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(x){d._frame=null,d._render(x)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},h.prototype._setCacheLimits=function(d,x){v.setCacheLimits(d,x)},c.version.get=function(){return v.version},Object.defineProperties(h.prototype,c),h}(fs);function ul(l){l.parentNode&&l.parentNode.removeChild(l)}var Lc={showCompass:!0,showZoom:!0,visualizePitch:!1},Hu=function(l){var h=this;this.options=v.extend({},Lc,l),this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return h._map.zoomIn({},{originalEvent:c})}),G.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return h._map.zoomOut({},{originalEvent:c})}),G.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:c}):h._map.resetNorth({},{originalEvent:c})}),this._compassIcon=G.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Hu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),h=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Hu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Hu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cs(this._map,this._compass,this.options.visualizePitch)),this._container},Hu.prototype.onRemove=function(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Hu.prototype._createButton=function(l,h){var c=G.create("button",l,this._container);return c.type="button",c.addEventListener("click",h),c},Hu.prototype._setButtonTitle=function(l,h){var c=this._map._getUIString("NavigationControl."+h);l.title=c,l.setAttribute("aria-label",c)};var Cs=function(l,h,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new Oc({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new Pc({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),G.addEventListener(h,"mousedown",this.mousedown),G.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(h,"touchmove",this.touchmove),G.addEventListener(h,"touchend",this.touchend),G.addEventListener(h,"touchcancel",this.reset)};function ll(l,h,c){if(l=new v.LngLat(l.lng,l.lat),h){var d=new v.LngLat(l.lng-360,l.lat),x=new v.LngLat(l.lng+360,l.lat),T=c.locationPoint(l).distSqr(h);c.locationPoint(d).distSqr(h)<T?l=d:c.locationPoint(x).distSqr(h)<T&&(l=x)}for(;Math.abs(l.lng-c.center.lng)>180;){var S=c.locationPoint(l);if(S.x>=0&&S.y>=0&&S.x<=c.width&&S.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Cs.prototype.down=function(l,h){this.mouseRotate.mousedown(l,h),this.mousePitch&&this.mousePitch.mousedown(l,h),G.disableDrag()},Cs.prototype.move=function(l,h){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,h);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var x=this.mousePitch.mousemoveWindow(l,h);x&&x.pitchDelta&&c.setPitch(c.getPitch()+x.pitchDelta)}},Cs.prototype.off=function(){var l=this.element;G.removeEventListener(l,"mousedown",this.mousedown),G.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(l,"touchmove",this.touchmove),G.removeEventListener(l,"touchend",this.touchend),G.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Cs.prototype.offTemp=function(){G.enableDrag(),G.removeEventListener(v.window,"mousemove",this.mousemove),G.removeEventListener(v.window,"mouseup",this.mouseup)},Cs.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),G.mousePos(this.element,l)),G.addEventListener(v.window,"mousemove",this.mousemove),G.addEventListener(v.window,"mouseup",this.mouseup)},Cs.prototype.mousemove=function(l){this.move(l,G.mousePos(this.element,l))},Cs.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Cs.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Cs.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Cs.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Cs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var lu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zh(l,h,c){var d=l.classList;for(var x in lu)d.remove("mapboxgl-"+c+"-anchor-"+x);d.add("mapboxgl-"+c+"-anchor-"+h)}var ic,wa=function(l){function h(c,d){if(l.call(this),(c instanceof v.window.HTMLElement||d)&&(c=v.extend({element:c},d)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div"),this._element.setAttribute("aria-label","Map marker");var x=G.createNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","41px"),x.setAttributeNS(null,"width","27px"),x.setAttributeNS(null,"viewBox","0 0 27 41");var T=G.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");var S=G.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");var I=G.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");for(var N=0,j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];N<j.length;N+=1){var ne=j[N],oe=G.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",ne.rx),oe.setAttributeNS(null,"ry",ne.ry),I.appendChild(oe)}var se=G.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"fill",this._color);var we=G.createNS("http://www.w3.org/2000/svg","path");we.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),se.appendChild(we);var be=G.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"fill","#000000");var Ze=G.createNS("http://www.w3.org/2000/svg","path");Ze.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),be.appendChild(Ze);var ge=G.createNS("http://www.w3.org/2000/svg","g");ge.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ge.setAttributeNS(null,"fill","#FFFFFF");var Ve=G.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");var $e=G.createNS("http://www.w3.org/2000/svg","circle");$e.setAttributeNS(null,"fill","#000000"),$e.setAttributeNS(null,"opacity","0.25"),$e.setAttributeNS(null,"cx","5.5"),$e.setAttributeNS(null,"cy","5.5"),$e.setAttributeNS(null,"r","5.4999962");var ht=G.createNS("http://www.w3.org/2000/svg","circle");ht.setAttributeNS(null,"fill","#FFFFFF"),ht.setAttributeNS(null,"cx","5.5"),ht.setAttributeNS(null,"cy","5.5"),ht.setAttributeNS(null,"r","5.4999962"),Ve.appendChild($e),Ve.appendChild(ht),S.appendChild(I),S.appendChild(se),S.appendChild(be),S.appendChild(ge),S.appendChild(Ve),x.appendChild(S),x.setAttributeNS(null,"height",41*this._scale+"px"),x.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(x),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Lt){Lt.preventDefault()}),this._element.addEventListener("mousedown",function(Lt){Lt.preventDefault()}),Zh(this._element,this._anchor,"marker"),this._popup=null}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(c){var d=c.code,x=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&x!==32&&x!==13||this.togglePopup()},h.prototype._onMapClick=function(c){var d=c.originalEvent.target,x=this._element;this._popup&&(d===x||x.contains(d))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},h.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ll(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,lu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+x+" "+d)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},h.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(v.Evented),oc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},cu=0,ka=!1,ph=function(l){function h(c){l.call(this),this.options=v.extend({},oc,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.onAdd=function(c){var d;return this._map=c,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,ic!==void 0?d(ic):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(x){d(ic=x.state!=="denied")}):d(ic=!!v.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,cu=0,ka=!1},h.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),x=c.coords;return d&&(x.longitude<d.getWest()||x.longitude>d.getEast()||x.latitude<d.getSouth()||x.latitude>d.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},h.prototype._updateCamera=function(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude),x=c.coords.accuracy,T=this._map.getBearing(),S=v.extend({bearing:T},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(x),S,{geolocateSource:!0})},h.prototype._updateMarker=function(c){if(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),x=this._map.unproject([1,c]),T=d.distanceTo(x),S=Math.ceil(2*this._accuracy/T);this._circleElement.style.width=S+"px",this._circleElement.style.height=S+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&ka)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(S){return S.preventDefault()}),this._geolocateButton=G.create("button","mapboxgl-ctrl-geolocate",this._container),G.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{var T=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new wa(this._dotElement),this._circleElement=G.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(S){S.geolocateSource||d._watchState!=="ACTIVE_LOCK"||S.originalEvent&&S.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new v.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":cu--,ka=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++cu>1?(c={maximumAge:6e5,timeout:0},ka=!0):(c=this.options.positionOptions,ka=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(v.Evented),hu={maxWidth:100,unit:"metric"},Rs=function(l){this.options=v.extend({},hu,l),v.bindAll(["_onMove","setUnit"],this)};function dh(l,h,c){var d=c&&c.maxWidth||100,x=l._container.clientHeight/2,T=l.unproject([0,x]),S=l.unproject([d,x]),I=T.distanceTo(S);if(c&&c.unit==="imperial"){var N=3.2808*I;N>5280?cl(h,d,N/5280,l._getUIString("ScaleControl.Miles")):cl(h,d,N,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?cl(h,d,I/1852,l._getUIString("ScaleControl.NauticalMiles")):I>=1e3?cl(h,d,I/1e3,l._getUIString("ScaleControl.Kilometers")):cl(h,d,I,l._getUIString("ScaleControl.Meters"))}function cl(l,h,c,d){var x,T,S,I=(x=c,(T=Math.pow(10,(""+Math.floor(x)).length-1))*(S=(S=x/T)>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(N){var j=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*j)/j}(S)));l.style.width=h*(I/c)+"px",l.innerHTML=I+"&nbsp;"+d}Rs.prototype.getDefaultPosition=function(){return"bottom-left"},Rs.prototype._onMove=function(){dh(this._map,this._container,this.options)},Rs.prototype.onAdd=function(l){return this._map=l,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Rs.prototype.onRemove=function(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Rs.prototype.setUnit=function(l){this.options.unit=l,dh(this._map,this._container,this.options)};var Js=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Js.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Js.prototype.onRemove=function(){G.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Js.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Js.prototype._setupUI=function(){var l=this._fullscreenButton=G.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Js.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Js.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Js.prototype._isFullscreen=function(){return this._fullscreen},Js.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Js.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var mh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ml=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),jh=function(l){function h(c){l.call(this),this.options=v.extend(Object.create(mh),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(h.__proto__=l),(h.prototype=Object.create(l&&l.prototype)).constructor=h,h.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},h.prototype.setHTML=function(c){var d,x=v.window.document.createDocumentFragment(),T=v.window.document.createElement("body");for(T.innerHTML=c;d=T.firstChild;)x.appendChild(d);return this.setDOMContent(x)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},h.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},h.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},h.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},h.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=G.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(c){this._update(c.point)},h.prototype._onMouseMove=function(c){this._update(c.point)},h.prototype._onDrag=function(c){this._update(c.point)},h.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=G.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(oe){return d._container.classList.add(oe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ll(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var x=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),T=this.options.anchor,S=function oe(se){if(se){if(typeof se=="number"){var we=Math.round(Math.sqrt(.5*Math.pow(se,2)));return{center:new v.Point(0,0),top:new v.Point(0,se),"top-left":new v.Point(we,we),"top-right":new v.Point(-we,we),bottom:new v.Point(0,-se),"bottom-left":new v.Point(we,-we),"bottom-right":new v.Point(-we,-we),left:new v.Point(se,0),right:new v.Point(-se,0)}}if(se instanceof v.Point||Array.isArray(se)){var be=v.Point.convert(se);return{center:be,top:be,"top-left":be,"top-right":be,bottom:be,"bottom-left":be,"bottom-right":be,left:be,right:be}}return{center:v.Point.convert(se.center||[0,0]),top:v.Point.convert(se.top||[0,0]),"top-left":v.Point.convert(se["top-left"]||[0,0]),"top-right":v.Point.convert(se["top-right"]||[0,0]),bottom:v.Point.convert(se.bottom||[0,0]),"bottom-left":v.Point.convert(se["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(se["bottom-right"]||[0,0]),left:v.Point.convert(se.left||[0,0]),right:v.Point.convert(se.right||[0,0])}}return oe(new v.Point(0,0))}(this.options.offset);if(!T){var I,N=this._container.offsetWidth,j=this._container.offsetHeight;I=x.y+S.bottom.y<j?["top"]:x.y>this._map.transform.height-j?["bottom"]:[],x.x<N/2?I.push("left"):x.x>this._map.transform.width-N/2&&I.push("right"),T=I.length===0?"bottom":I.join("-")}var ne=x.add(S[T]).round();G.setTransform(this._container,lu[T]+" translate("+ne.x+"px,"+ne.y+"px)"),Zh(this._container,T,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Ml);c&&c.focus()}},h.prototype._onClose=function(){this.remove()},h}(v.Evented),Dc={version:v.version,supported:at,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Vh,NavigationControl:Hu,GeolocateControl:ph,AttributionControl:Ga,ScaleControl:Rs,FullscreenControl:Js,Popup:jh,Marker:wa,Style:Ts,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Mt().acquire(_t)},clearPrewarmedResources:function(){var l=Br;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(_t),Br=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return Qt.workerCount},set workerCount(l){Qt.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return Dc}),ze})},51663:function(pr,Gt,H){"use strict";pr.exports=qe;var ze=H(30551);function qe($){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView($)?$:new Uint8Array($||0),this.pos=0,this.type=0,this.length=this.buf.length}qe.Varint=0,qe.Fixed64=1,qe.Bytes=2,qe.Fixed32=5;var v=65536*65536,at=1/v,G=12,Je=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8");qe.prototype={destroy:function(){this.buf=null},readFields:function($,me,W){for(W=W||this.length;this.pos<W;){var he=this.readVarint(),ae=he>>3,Me=this.pos;this.type=he&7,$(ae,me,this),this.pos===Me&&this.skip(he)}return me},readMessage:function($,me){return this.readFields($,me,this.readVarint()+this.pos)},readFixed32:function(){var $=xt(this.buf,this.pos);return this.pos+=4,$},readSFixed32:function(){var $=Ft(this.buf,this.pos);return this.pos+=4,$},readFixed64:function(){var $=xt(this.buf,this.pos)+xt(this.buf,this.pos+4)*v;return this.pos+=8,$},readSFixed64:function(){var $=xt(this.buf,this.pos)+Ft(this.buf,this.pos+4)*v;return this.pos+=8,$},readFloat:function(){var $=ze.read(this.buf,this.pos,!0,23,4);return this.pos+=4,$},readDouble:function(){var $=ze.read(this.buf,this.pos,!0,52,8);return this.pos+=8,$},readVarint:function($){var me=this.buf,W,he;return he=me[this.pos++],W=he&127,he<128||(he=me[this.pos++],W|=(he&127)<<7,he<128)||(he=me[this.pos++],W|=(he&127)<<14,he<128)||(he=me[this.pos++],W|=(he&127)<<21,he<128)?W:(he=me[this.pos],W|=(he&15)<<28,Oe(W,$,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var $=this.readVarint();return $%2===1?($+1)/-2:$/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var $=this.readVarint()+this.pos,me=this.pos;return this.pos=$,$-me>=G&&Je?Jt(this.buf,me,$):tt(this.buf,me,$)},readBytes:function(){var $=this.readVarint()+this.pos,me=this.buf.subarray(this.pos,$);return this.pos=$,me},readPackedVarint:function($,me){if(this.type!==qe.Bytes)return $.push(this.readVarint(me));var W=yt(this);for($=$||[];this.pos<W;)$.push(this.readVarint(me));return $},readPackedSVarint:function($){if(this.type!==qe.Bytes)return $.push(this.readSVarint());var me=yt(this);for($=$||[];this.pos<me;)$.push(this.readSVarint());return $},readPackedBoolean:function($){if(this.type!==qe.Bytes)return $.push(this.readBoolean());var me=yt(this);for($=$||[];this.pos<me;)$.push(this.readBoolean());return $},readPackedFloat:function($){if(this.type!==qe.Bytes)return $.push(this.readFloat());var me=yt(this);for($=$||[];this.pos<me;)$.push(this.readFloat());return $},readPackedDouble:function($){if(this.type!==qe.Bytes)return $.push(this.readDouble());var me=yt(this);for($=$||[];this.pos<me;)$.push(this.readDouble());return $},readPackedFixed32:function($){if(this.type!==qe.Bytes)return $.push(this.readFixed32());var me=yt(this);for($=$||[];this.pos<me;)$.push(this.readFixed32());return $},readPackedSFixed32:function($){if(this.type!==qe.Bytes)return $.push(this.readSFixed32());var me=yt(this);for($=$||[];this.pos<me;)$.push(this.readSFixed32());return $},readPackedFixed64:function($){if(this.type!==qe.Bytes)return $.push(this.readFixed64());var me=yt(this);for($=$||[];this.pos<me;)$.push(this.readFixed64());return $},readPackedSFixed64:function($){if(this.type!==qe.Bytes)return $.push(this.readSFixed64());var me=yt(this);for($=$||[];this.pos<me;)$.push(this.readSFixed64());return $},skip:function($){var me=$&7;if(me===qe.Varint)for(;this.buf[this.pos++]>127;);else if(me===qe.Bytes)this.pos=this.readVarint()+this.pos;else if(me===qe.Fixed32)this.pos+=4;else if(me===qe.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+me)},writeTag:function($,me){this.writeVarint($<<3|me)},realloc:function($){for(var me=this.length||16;me<this.pos+$;)me*=2;if(me!==this.length){var W=new Uint8Array(me);W.set(this.buf),this.buf=W,this.length=me}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function($){this.realloc(4),Pe(this.buf,$,this.pos),this.pos+=4},writeSFixed32:function($){this.realloc(4),Pe(this.buf,$,this.pos),this.pos+=4},writeFixed64:function($){this.realloc(8),Pe(this.buf,$&-1,this.pos),Pe(this.buf,Math.floor($*at),this.pos+4),this.pos+=8},writeSFixed64:function($){this.realloc(8),Pe(this.buf,$&-1,this.pos),Pe(this.buf,Math.floor($*at),this.pos+4),this.pos+=8},writeVarint:function($){if($=+$||0,$>268435455||$<0){zt($,this);return}this.realloc(4),this.buf[this.pos++]=$&127|($>127?128:0),!($<=127)&&(this.buf[this.pos++]=($>>>=7)&127|($>127?128:0),!($<=127)&&(this.buf[this.pos++]=($>>>=7)&127|($>127?128:0),!($<=127)&&(this.buf[this.pos++]=$>>>7&127)))},writeSVarint:function($){this.writeVarint($<0?-$*2-1:$*2)},writeBoolean:function($){this.writeVarint(!!$)},writeString:function($){$=String($),this.realloc($.length*4),this.pos++;var me=this.pos;this.pos=wr(this.buf,$,this.pos);var W=this.pos-me;W>=128&&qt(me,W,this),this.pos=me-1,this.writeVarint(W),this.pos+=W},writeFloat:function($){this.realloc(4),ze.write(this.buf,$,this.pos,!0,23,4),this.pos+=4},writeDouble:function($){this.realloc(8),ze.write(this.buf,$,this.pos,!0,52,8),this.pos+=8},writeBytes:function($){var me=$.length;this.writeVarint(me),this.realloc(me);for(var W=0;W<me;W++)this.buf[this.pos++]=$[W]},writeRawMessage:function($,me){this.pos++;var W=this.pos;$(me,this);var he=this.pos-W;he>=128&&qt(W,he,this),this.pos=W-1,this.writeVarint(he),this.pos+=he},writeMessage:function($,me,W){this.writeTag($,qe.Bytes),this.writeRawMessage(me,W)},writePackedVarint:function($,me){me.length&&this.writeMessage($,Yt,me)},writePackedSVarint:function($,me){me.length&&this.writeMessage($,ir,me)},writePackedBoolean:function($,me){me.length&&this.writeMessage($,_r,me)},writePackedFloat:function($,me){me.length&&this.writeMessage($,or,me)},writePackedDouble:function($,me){me.length&&this.writeMessage($,Sr,me)},writePackedFixed32:function($,me){me.length&&this.writeMessage($,Gr,me)},writePackedSFixed32:function($,me){me.length&&this.writeMessage($,vn,me)},writePackedFixed64:function($,me){me.length&&this.writeMessage($,ii,me)},writePackedSFixed64:function($,me){me.length&&this.writeMessage($,Yn,me)},writeBytesField:function($,me){this.writeTag($,qe.Bytes),this.writeBytes(me)},writeFixed32Field:function($,me){this.writeTag($,qe.Fixed32),this.writeFixed32(me)},writeSFixed32Field:function($,me){this.writeTag($,qe.Fixed32),this.writeSFixed32(me)},writeFixed64Field:function($,me){this.writeTag($,qe.Fixed64),this.writeFixed64(me)},writeSFixed64Field:function($,me){this.writeTag($,qe.Fixed64),this.writeSFixed64(me)},writeVarintField:function($,me){this.writeTag($,qe.Varint),this.writeVarint(me)},writeSVarintField:function($,me){this.writeTag($,qe.Varint),this.writeSVarint(me)},writeStringField:function($,me){this.writeTag($,qe.Bytes),this.writeString(me)},writeFloatField:function($,me){this.writeTag($,qe.Fixed32),this.writeFloat(me)},writeDoubleField:function($,me){this.writeTag($,qe.Fixed64),this.writeDouble(me)},writeBooleanField:function($,me){this.writeVarintField($,!!me)}};function Oe($,me,W){var he=W.buf,ae,Me;if(Me=he[W.pos++],ae=(Me&112)>>4,Me<128||(Me=he[W.pos++],ae|=(Me&127)<<3,Me<128)||(Me=he[W.pos++],ae|=(Me&127)<<10,Me<128)||(Me=he[W.pos++],ae|=(Me&127)<<17,Me<128)||(Me=he[W.pos++],ae|=(Me&127)<<24,Me<128)||(Me=he[W.pos++],ae|=(Me&1)<<31,Me<128))return Re($,ae,me);throw new Error("Expected varint not more than 10 bytes")}function yt($){return $.type===qe.Bytes?$.readVarint()+$.pos:$.pos+1}function Re($,me,W){return W?me*4294967296+($>>>0):(me>>>0)*4294967296+($>>>0)}function zt($,me){var W,he;if($>=0?(W=$%4294967296|0,he=$/4294967296|0):(W=~(-$%4294967296),he=~(-$/4294967296),W^4294967295?W=W+1|0:(W=0,he=he+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");me.realloc(10),ct(W,he,me),st(he,me)}function ct($,me,W){W.buf[W.pos++]=$&127|128,$>>>=7,W.buf[W.pos++]=$&127|128,$>>>=7,W.buf[W.pos++]=$&127|128,$>>>=7,W.buf[W.pos++]=$&127|128,$>>>=7,W.buf[W.pos]=$&127}function st($,me){var W=($&7)<<4;me.buf[me.pos++]|=W|(($>>>=3)?128:0),$&&(me.buf[me.pos++]=$&127|(($>>>=7)?128:0),$&&(me.buf[me.pos++]=$&127|(($>>>=7)?128:0),$&&(me.buf[me.pos++]=$&127|(($>>>=7)?128:0),$&&(me.buf[me.pos++]=$&127|(($>>>=7)?128:0),$&&(me.buf[me.pos++]=$&127)))))}function qt($,me,W){var he=me<=16383?1:me<=2097151?2:me<=268435455?3:Math.floor(Math.log(me)/(Math.LN2*7));W.realloc(he);for(var ae=W.pos-1;ae>=$;ae--)W.buf[ae+he]=W.buf[ae]}function Yt($,me){for(var W=0;W<$.length;W++)me.writeVarint($[W])}function ir($,me){for(var W=0;W<$.length;W++)me.writeSVarint($[W])}function or($,me){for(var W=0;W<$.length;W++)me.writeFloat($[W])}function Sr($,me){for(var W=0;W<$.length;W++)me.writeDouble($[W])}function _r($,me){for(var W=0;W<$.length;W++)me.writeBoolean($[W])}function Gr($,me){for(var W=0;W<$.length;W++)me.writeFixed32($[W])}function vn($,me){for(var W=0;W<$.length;W++)me.writeSFixed32($[W])}function ii($,me){for(var W=0;W<$.length;W++)me.writeFixed64($[W])}function Yn($,me){for(var W=0;W<$.length;W++)me.writeSFixed64($[W])}function xt($,me){return($[me]|$[me+1]<<8|$[me+2]<<16)+$[me+3]*16777216}function Pe($,me,W){$[W]=me,$[W+1]=me>>>8,$[W+2]=me>>>16,$[W+3]=me>>>24}function Ft($,me){return($[me]|$[me+1]<<8|$[me+2]<<16)+($[me+3]<<24)}function tt($,me,W){for(var he="",ae=me;ae<W;){var Me=$[ae],je=null,ut=Me>239?4:Me>223?3:Me>191?2:1;if(ae+ut>W)break;var St,bt,Lr;ut===1?Me<128&&(je=Me):ut===2?(St=$[ae+1],(St&192)===128&&(je=(Me&31)<<6|St&63,je<=127&&(je=null))):ut===3?(St=$[ae+1],bt=$[ae+2],(St&192)===128&&(bt&192)===128&&(je=(Me&15)<<12|(St&63)<<6|bt&63,(je<=2047||je>=55296&&je<=57343)&&(je=null))):ut===4&&(St=$[ae+1],bt=$[ae+2],Lr=$[ae+3],(St&192)===128&&(bt&192)===128&&(Lr&192)===128&&(je=(Me&15)<<18|(St&63)<<12|(bt&63)<<6|Lr&63,(je<=65535||je>=1114112)&&(je=null))),je===null?(je=65533,ut=1):je>65535&&(je-=65536,he+=String.fromCharCode(je>>>10&1023|55296),je=56320|je&1023),he+=String.fromCharCode(je),ae+=ut}return he}function Jt($,me,W){return Je.decode($.subarray(me,W))}function wr($,me,W){for(var he=0,ae,Me;he<me.length;he++){if(ae=me.charCodeAt(he),ae>55295&&ae<57344)if(Me)if(ae<56320){$[W++]=239,$[W++]=191,$[W++]=189,Me=ae;continue}else ae=Me-55296<<10|ae-56320|65536,Me=null;else{ae>56319||he+1===me.length?($[W++]=239,$[W++]=191,$[W++]=189):Me=ae;continue}else Me&&($[W++]=239,$[W++]=191,$[W++]=189,Me=null);ae<128?$[W++]=ae:(ae<2048?$[W++]=ae>>6|192:(ae<65536?$[W++]=ae>>12|224:($[W++]=ae>>18|240,$[W++]=ae>>12&63|128),$[W++]=ae>>6&63|128),$[W++]=ae&63|128)}return W}},41227:function(pr,Gt,H){var ze=H(14224);(function(qe,v){pr.exports=v()})(this,function(){"use strict";function qe(ot,z){var K={label:0,sent:function(){if(Ce[0]&1)throw Ce[1];return Ce[1]},trys:[],ops:[]},de,Fe,Ce,Nt;return Nt={next:Bt(0),throw:Bt(1),return:Bt(2)},typeof Symbol=="function"&&(Nt[Symbol.iterator]=function(){return this}),Nt;function Bt(It){return function(B){return sr([It,B])}}function sr(It){if(de)throw new TypeError("Generator is already executing.");for(;K;)try{if(de=1,Fe&&(Ce=It[0]&2?Fe.return:It[0]?Fe.throw||((Ce=Fe.return)&&Ce.call(Fe),0):Fe.next)&&!(Ce=Ce.call(Fe,It[1])).done)return Ce;switch(Fe=0,Ce&&(It=[It[0]&2,Ce.value]),It[0]){case 0:case 1:Ce=It;break;case 4:return K.label++,{value:It[1],done:!1};case 5:K.label++,Fe=It[1],It=[0];continue;case 7:It=K.ops.pop(),K.trys.pop();continue;default:if(Ce=K.trys,!(Ce=Ce.length>0&&Ce[Ce.length-1])&&(It[0]===6||It[0]===2)){K=0;continue}if(It[0]===3&&(!Ce||It[1]>Ce[0]&&It[1]<Ce[3])){K.label=It[1];break}if(It[0]===6&&K.label<Ce[1]){K.label=Ce[1],Ce=It;break}if(Ce&&K.label<Ce[2]){K.label=Ce[2],K.ops.push(It);break}Ce[2]&&K.ops.pop(),K.trys.pop();continue}It=z.call(ot,K)}catch(B){It=[6,B],Fe=0}finally{de=Ce=0}if(It[0]&5)throw It[1];return{value:It[0]?It[1]:void 0,done:!0}}}var v=function(){function ot(z,K){this.next=null,this.key=z,this.data=K,this.left=null,this.right=null}return ot}();function at(ot,z){return ot>z?1:ot<z?-1:0}function G(ot,z,K){for(var de=new v(null,null),Fe=de,Ce=de;;){var Nt=K(ot,z.key);if(Nt<0){if(z.left===null)break;if(K(ot,z.left.key)<0){var Bt=z.left;if(z.left=Bt.right,Bt.right=z,z=Bt,z.left===null)break}Ce.left=z,Ce=z,z=z.left}else if(Nt>0){if(z.right===null)break;if(K(ot,z.right.key)>0){var Bt=z.right;if(z.right=Bt.left,Bt.left=z,z=Bt,z.right===null)break}Fe.right=z,Fe=z,z=z.right}else break}return Fe.right=z.left,Ce.left=z.right,z.left=de.right,z.right=de.left,z}function Je(ot,z,K,de){var Fe=new v(ot,z);if(K===null)return Fe.left=Fe.right=null,Fe;K=G(ot,K,de);var Ce=de(ot,K.key);return Ce<0?(Fe.left=K.left,Fe.right=K,K.left=null):Ce>=0&&(Fe.right=K.right,Fe.left=K,K.right=null),Fe}function Oe(ot,z,K){var de=null,Fe=null;if(z){z=G(ot,z,K);var Ce=K(z.key,ot);Ce===0?(de=z.left,Fe=z.right):Ce<0?(Fe=z.right,z.right=null,de=z):(de=z.left,z.left=null,Fe=z)}return{left:de,right:Fe}}function yt(ot,z,K){return z===null?ot:(ot===null||(z=G(ot.key,z,K),z.left=ot),z)}function Re(ot,z,K,de,Fe){if(ot){de(""+z+(K?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Fe(ot)+`
`);var Ce=z+(K?"    ":"\u2502   ");ot.left&&Re(ot.left,Ce,!1,de,Fe),ot.right&&Re(ot.right,Ce,!0,de,Fe)}}var zt=function(){function ot(z){z===void 0&&(z=at),this._root=null,this._size=0,this._comparator=z}return ot.prototype.insert=function(z,K){return this._size++,this._root=Je(z,K,this._root,this._comparator)},ot.prototype.add=function(z,K){var de=new v(z,K);this._root===null&&(de.left=de.right=null,this._size++,this._root=de);var Fe=this._comparator,Ce=G(z,this._root,Fe),Nt=Fe(z,Ce.key);return Nt===0?this._root=Ce:(Nt<0?(de.left=Ce.left,de.right=Ce,Ce.left=null):Nt>0&&(de.right=Ce.right,de.left=Ce,Ce.right=null),this._size++,this._root=de),this._root},ot.prototype.remove=function(z){this._root=this._remove(z,this._root,this._comparator)},ot.prototype._remove=function(z,K,de){var Fe;if(K===null)return null;K=G(z,K,de);var Ce=de(z,K.key);return Ce===0?(K.left===null?Fe=K.right:(Fe=G(z,K.left,de),Fe.right=K.right),this._size--,Fe):K},ot.prototype.pop=function(){var z=this._root;if(z){for(;z.left;)z=z.left;return this._root=G(z.key,this._root,this._comparator),this._root=this._remove(z.key,this._root,this._comparator),{key:z.key,data:z.data}}return null},ot.prototype.findStatic=function(z){for(var K=this._root,de=this._comparator;K;){var Fe=de(z,K.key);if(Fe===0)return K;Fe<0?K=K.left:K=K.right}return null},ot.prototype.find=function(z){return this._root&&(this._root=G(z,this._root,this._comparator),this._comparator(z,this._root.key)!==0)?null:this._root},ot.prototype.contains=function(z){for(var K=this._root,de=this._comparator;K;){var Fe=de(z,K.key);if(Fe===0)return!0;Fe<0?K=K.left:K=K.right}return!1},ot.prototype.forEach=function(z,K){for(var de=this._root,Fe=[],Ce=!1;!Ce;)de!==null?(Fe.push(de),de=de.left):Fe.length!==0?(de=Fe.pop(),z.call(K,de),de=de.right):Ce=!0;return this},ot.prototype.range=function(z,K,de,Fe){for(var Ce=[],Nt=this._comparator,Bt=this._root,sr;Ce.length!==0||Bt;)if(Bt)Ce.push(Bt),Bt=Bt.left;else{if(Bt=Ce.pop(),sr=Nt(Bt.key,K),sr>0)break;if(Nt(Bt.key,z)>=0&&de.call(Fe,Bt))return this;Bt=Bt.right}return this},ot.prototype.keys=function(){var z=[];return this.forEach(function(K){var de=K.key;return z.push(de)}),z},ot.prototype.values=function(){var z=[];return this.forEach(function(K){var de=K.data;return z.push(de)}),z},ot.prototype.min=function(){return this._root?this.minNode(this._root).key:null},ot.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},ot.prototype.minNode=function(z){if(z===void 0&&(z=this._root),z)for(;z.left;)z=z.left;return z},ot.prototype.maxNode=function(z){if(z===void 0&&(z=this._root),z)for(;z.right;)z=z.right;return z},ot.prototype.at=function(z){for(var K=this._root,de=!1,Fe=0,Ce=[];!de;)if(K)Ce.push(K),K=K.left;else if(Ce.length>0){if(K=Ce.pop(),Fe===z)return K;Fe++,K=K.right}else de=!0;return null},ot.prototype.next=function(z){var K=this._root,de=null;if(z.right){for(de=z.right;de.left;)de=de.left;return de}for(var Fe=this._comparator;K;){var Ce=Fe(z.key,K.key);if(Ce===0)break;Ce<0?(de=K,K=K.left):K=K.right}return de},ot.prototype.prev=function(z){var K=this._root,de=null;if(z.left!==null){for(de=z.left;de.right;)de=de.right;return de}for(var Fe=this._comparator;K;){var Ce=Fe(z.key,K.key);if(Ce===0)break;Ce<0?K=K.left:(de=K,K=K.right)}return de},ot.prototype.clear=function(){return this._root=null,this._size=0,this},ot.prototype.toList=function(){return qt(this._root)},ot.prototype.load=function(z,K,de){K===void 0&&(K=[]),de===void 0&&(de=!1);var Fe=z.length,Ce=this._comparator;if(de&&or(z,K,0,Fe-1,Ce),this._root===null)this._root=ct(z,K,0,Fe),this._size=Fe;else{var Nt=ir(this.toList(),st(z,K),Ce);Fe=this._size+Fe,this._root=Yt({head:Nt},0,Fe)}return this},ot.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(ot.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(ot.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),ot.prototype.toString=function(z){z===void 0&&(z=function(de){return String(de.key)});var K=[];return Re(this._root,"",!0,function(de){return K.push(de)},z),K.join("")},ot.prototype.update=function(z,K,de){var Fe=this._comparator,Ce=Oe(z,this._root,Fe),Nt=Ce.left,Bt=Ce.right;Fe(z,K)<0?Bt=Je(K,de,Bt,Fe):Nt=Je(K,de,Nt,Fe),this._root=yt(Nt,Bt,Fe)},ot.prototype.split=function(z){return Oe(z,this._root,this._comparator)},ot.prototype[Symbol.iterator]=function(){var z,K,de;return qe(this,function(Fe){switch(Fe.label){case 0:z=this._root,K=[],de=!1,Fe.label=1;case 1:return de?[3,6]:z===null?[3,2]:(K.push(z),z=z.left,[3,5]);case 2:return K.length===0?[3,4]:(z=K.pop(),[4,z]);case 3:return Fe.sent(),z=z.right,[3,5];case 4:de=!0,Fe.label=5;case 5:return[3,1];case 6:return[2]}})},ot}();function ct(ot,z,K,de){var Fe=de-K;if(Fe>0){var Ce=K+Math.floor(Fe/2),Nt=ot[Ce],Bt=z[Ce],sr=new v(Nt,Bt);return sr.left=ct(ot,z,K,Ce),sr.right=ct(ot,z,Ce+1,de),sr}return null}function st(ot,z){for(var K=new v(null,null),de=K,Fe=0;Fe<ot.length;Fe++)de=de.next=new v(ot[Fe],z[Fe]);return de.next=null,K.next}function qt(ot){for(var z=ot,K=[],de=!1,Fe=new v(null,null),Ce=Fe;!de;)z?(K.push(z),z=z.left):K.length>0?(z=Ce=Ce.next=K.pop(),z=z.right):de=!0;return Ce.next=null,Fe.next}function Yt(ot,z,K){var de=K-z;if(de>0){var Fe=z+Math.floor(de/2),Ce=Yt(ot,z,Fe),Nt=ot.head;return Nt.left=Ce,ot.head=ot.head.next,Nt.right=Yt(ot,Fe+1,K),Nt}return null}function ir(ot,z,K){for(var de=new v(null,null),Fe=de,Ce=ot,Nt=z;Ce!==null&&Nt!==null;)K(Ce.key,Nt.key)<0?(Fe.next=Ce,Ce=Ce.next):(Fe.next=Nt,Nt=Nt.next),Fe=Fe.next;return Ce!==null?Fe.next=Ce:Nt!==null&&(Fe.next=Nt),de.next}function or(ot,z,K,de,Fe){if(!(K>=de)){for(var Ce=ot[K+de>>1],Nt=K-1,Bt=de+1;;){do Nt++;while(Fe(ot[Nt],Ce)<0);do Bt--;while(Fe(ot[Bt],Ce)>0);if(Nt>=Bt)break;var sr=ot[Nt];ot[Nt]=ot[Bt],ot[Bt]=sr,sr=z[Nt],z[Nt]=z[Bt],z[Bt]=sr}or(ot,z,K,Bt,Fe),or(ot,z,Bt+1,de,Fe)}}const Sr=(ot,z)=>ot.ll.x<=z.x&&z.x<=ot.ur.x&&ot.ll.y<=z.y&&z.y<=ot.ur.y,_r=(ot,z)=>{if(z.ur.x<ot.ll.x||ot.ur.x<z.ll.x||z.ur.y<ot.ll.y||ot.ur.y<z.ll.y)return null;const K=ot.ll.x<z.ll.x?z.ll.x:ot.ll.x,de=ot.ur.x<z.ur.x?ot.ur.x:z.ur.x,Fe=ot.ll.y<z.ll.y?z.ll.y:ot.ll.y,Ce=ot.ur.y<z.ur.y?ot.ur.y:z.ur.y;return{ll:{x:K,y:Fe},ur:{x:de,y:Ce}}};let Gr=Number.EPSILON;Gr===void 0&&(Gr=Math.pow(2,-52));const vn=Gr*Gr,ii=(ot,z)=>{if(-Gr<ot&&ot<Gr&&-Gr<z&&z<Gr)return 0;const K=ot-z;return K*K<vn*ot*z?0:ot<z?-1:1};class Yn{constructor(){this.reset()}reset(){this.xRounder=new xt,this.yRounder=new xt}round(z,K){return{x:this.xRounder.round(z),y:this.yRounder.round(K)}}}class xt{constructor(){this.tree=new zt,this.round(0)}round(z){const K=this.tree.add(z),de=this.tree.prev(K);if(de!==null&&ii(K.key,de.key)===0)return this.tree.remove(z),de.key;const Fe=this.tree.next(K);return Fe!==null&&ii(K.key,Fe.key)===0?(this.tree.remove(z),Fe.key):z}}const Pe=new Yn,Ft=11102230246251565e-32,tt=134217729,Jt=(3+8*Ft)*Ft;function wr(ot,z,K,de,Fe){let Ce,Nt,Bt,sr,It=z[0],B=de[0],P=0,V=0;B>It==B>-It?(Ce=It,It=z[++P]):(Ce=B,B=de[++V]);let Y=0;if(P<ot&&V<K)for(B>It==B>-It?(Nt=It+Ce,Bt=Ce-(Nt-It),It=z[++P]):(Nt=B+Ce,Bt=Ce-(Nt-B),B=de[++V]),Ce=Nt,Bt!==0&&(Fe[Y++]=Bt);P<ot&&V<K;)B>It==B>-It?(Nt=Ce+It,sr=Nt-Ce,Bt=Ce-(Nt-sr)+(It-sr),It=z[++P]):(Nt=Ce+B,sr=Nt-Ce,Bt=Ce-(Nt-sr)+(B-sr),B=de[++V]),Ce=Nt,Bt!==0&&(Fe[Y++]=Bt);for(;P<ot;)Nt=Ce+It,sr=Nt-Ce,Bt=Ce-(Nt-sr)+(It-sr),It=z[++P],Ce=Nt,Bt!==0&&(Fe[Y++]=Bt);for(;V<K;)Nt=Ce+B,sr=Nt-Ce,Bt=Ce-(Nt-sr)+(B-sr),B=de[++V],Ce=Nt,Bt!==0&&(Fe[Y++]=Bt);return(Ce!==0||Y===0)&&(Fe[Y++]=Ce),Y}function $(ot,z){let K=z[0];for(let de=1;de<ot;de++)K+=z[de];return K}function me(ot){return new Float64Array(ot)}const W=(3+16*Ft)*Ft,he=(2+12*Ft)*Ft,ae=(9+64*Ft)*Ft*Ft,Me=me(4),je=me(8),ut=me(12),St=me(16),bt=me(4);function Lr(ot,z,K,de,Fe,Ce,Nt){let Bt,sr,It,B,P,V,Y,ce,Se,Ue,Q,ve,rt,wt,nr,_t,Qt,Br;const Fr=ot-Fe,Mt=K-Fe,Dr=z-Ce,Er=de-Ce;wt=Fr*Er,V=tt*Fr,Y=V-(V-Fr),ce=Fr-Y,V=tt*Er,Se=V-(V-Er),Ue=Er-Se,nr=ce*Ue-(wt-Y*Se-ce*Se-Y*Ue),_t=Dr*Mt,V=tt*Dr,Y=V-(V-Dr),ce=Dr-Y,V=tt*Mt,Se=V-(V-Mt),Ue=Mt-Se,Qt=ce*Ue-(_t-Y*Se-ce*Se-Y*Ue),Q=nr-Qt,P=nr-Q,Me[0]=nr-(Q+P)+(P-Qt),ve=wt+Q,P=ve-wt,rt=wt-(ve-P)+(Q-P),Q=rt-_t,P=rt-Q,Me[1]=rt-(Q+P)+(P-_t),Br=ve+Q,P=Br-ve,Me[2]=ve-(Br-P)+(Q-P),Me[3]=Br;let Rr=$(4,Me),zn=he*Nt;if(Rr>=zn||-Rr>=zn||(P=ot-Fr,Bt=ot-(Fr+P)+(P-Fe),P=K-Mt,It=K-(Mt+P)+(P-Fe),P=z-Dr,sr=z-(Dr+P)+(P-Ce),P=de-Er,B=de-(Er+P)+(P-Ce),Bt===0&&sr===0&&It===0&&B===0)||(zn=ae*Nt+Jt*Math.abs(Rr),Rr+=Fr*B+Er*Bt-(Dr*It+Mt*sr),Rr>=zn||-Rr>=zn))return Rr;wt=Bt*Er,V=tt*Bt,Y=V-(V-Bt),ce=Bt-Y,V=tt*Er,Se=V-(V-Er),Ue=Er-Se,nr=ce*Ue-(wt-Y*Se-ce*Se-Y*Ue),_t=sr*Mt,V=tt*sr,Y=V-(V-sr),ce=sr-Y,V=tt*Mt,Se=V-(V-Mt),Ue=Mt-Se,Qt=ce*Ue-(_t-Y*Se-ce*Se-Y*Ue),Q=nr-Qt,P=nr-Q,bt[0]=nr-(Q+P)+(P-Qt),ve=wt+Q,P=ve-wt,rt=wt-(ve-P)+(Q-P),Q=rt-_t,P=rt-Q,bt[1]=rt-(Q+P)+(P-_t),Br=ve+Q,P=Br-ve,bt[2]=ve-(Br-P)+(Q-P),bt[3]=Br;const jr=wr(4,Me,4,bt,je);wt=Fr*B,V=tt*Fr,Y=V-(V-Fr),ce=Fr-Y,V=tt*B,Se=V-(V-B),Ue=B-Se,nr=ce*Ue-(wt-Y*Se-ce*Se-Y*Ue),_t=Dr*It,V=tt*Dr,Y=V-(V-Dr),ce=Dr-Y,V=tt*It,Se=V-(V-It),Ue=It-Se,Qt=ce*Ue-(_t-Y*Se-ce*Se-Y*Ue),Q=nr-Qt,P=nr-Q,bt[0]=nr-(Q+P)+(P-Qt),ve=wt+Q,P=ve-wt,rt=wt-(ve-P)+(Q-P),Q=rt-_t,P=rt-Q,bt[1]=rt-(Q+P)+(P-_t),Br=ve+Q,P=Br-ve,bt[2]=ve-(Br-P)+(Q-P),bt[3]=Br;const qn=wr(jr,je,4,bt,ut);wt=Bt*B,V=tt*Bt,Y=V-(V-Bt),ce=Bt-Y,V=tt*B,Se=V-(V-B),Ue=B-Se,nr=ce*Ue-(wt-Y*Se-ce*Se-Y*Ue),_t=sr*It,V=tt*sr,Y=V-(V-sr),ce=sr-Y,V=tt*It,Se=V-(V-It),Ue=It-Se,Qt=ce*Ue-(_t-Y*Se-ce*Se-Y*Ue),Q=nr-Qt,P=nr-Q,bt[0]=nr-(Q+P)+(P-Qt),ve=wt+Q,P=ve-wt,rt=wt-(ve-P)+(Q-P),Q=rt-_t,P=rt-Q,bt[1]=rt-(Q+P)+(P-_t),Br=ve+Q,P=Br-ve,bt[2]=ve-(Br-P)+(Q-P),bt[3]=Br;const Li=wr(qn,ut,4,bt,St);return St[Li-1]}function Cr(ot,z,K,de,Fe,Ce){const Nt=(z-Ce)*(K-Fe),Bt=(ot-Fe)*(de-Ce),sr=Nt-Bt,It=Math.abs(Nt+Bt);return Math.abs(sr)>=W*It?sr:-Lr(ot,z,K,de,Fe,Ce,It)}const On=(ot,z)=>ot.x*z.y-ot.y*z.x,Xr=(ot,z)=>ot.x*z.x+ot.y*z.y,xn=(ot,z,K)=>{const de=Cr(ot.x,ot.y,z.x,z.y,K.x,K.y);return de>0?-1:de<0?1:0},Yr=ot=>Math.sqrt(Xr(ot,ot)),rn=(ot,z,K)=>{const de={x:z.x-ot.x,y:z.y-ot.y},Fe={x:K.x-ot.x,y:K.y-ot.y};return On(Fe,de)/Yr(Fe)/Yr(de)},Kr=(ot,z,K)=>{const de={x:z.x-ot.x,y:z.y-ot.y},Fe={x:K.x-ot.x,y:K.y-ot.y};return Xr(Fe,de)/Yr(Fe)/Yr(de)},Qn=(ot,z,K)=>z.y===0?null:{x:ot.x+z.x/z.y*(K-ot.y),y:K},Ur=(ot,z,K)=>z.x===0?null:{x:K,y:ot.y+z.y/z.x*(K-ot.x)},Mn=(ot,z,K,de)=>{if(z.x===0)return Ur(K,de,ot.x);if(de.x===0)return Ur(ot,z,K.x);if(z.y===0)return Qn(K,de,ot.y);if(de.y===0)return Qn(ot,z,K.y);const Fe=On(z,de);if(Fe==0)return null;const Ce={x:K.x-ot.x,y:K.y-ot.y},Nt=On(Ce,z)/Fe,Bt=On(Ce,de)/Fe,sr=ot.x+Bt*z.x,It=K.x+Nt*de.x,B=ot.y+Bt*z.y,P=K.y+Nt*de.y,V=(sr+It)/2,Y=(B+P)/2;return{x:V,y:Y}};class $r{static compare(z,K){const de=$r.comparePoints(z.point,K.point);return de!==0?de:(z.point!==K.point&&z.link(K),z.isLeft!==K.isLeft?z.isLeft?1:-1:zi.compare(z.segment,K.segment))}static comparePoints(z,K){return z.x<K.x?-1:z.x>K.x?1:z.y<K.y?-1:z.y>K.y?1:0}constructor(z,K){z.events===void 0?z.events=[this]:z.events.push(this),this.point=z,this.isLeft=K}link(z){if(z.point===this.point)throw new Error("Tried to link already linked events");const K=z.point.events;for(let de=0,Fe=K.length;de<Fe;de++){const Ce=K[de];this.point.events.push(Ce),Ce.point=this.point}this.checkForConsuming()}checkForConsuming(){const z=this.point.events.length;for(let K=0;K<z;K++){const de=this.point.events[K];if(de.segment.consumedBy===void 0)for(let Fe=K+1;Fe<z;Fe++){const Ce=this.point.events[Fe];Ce.consumedBy===void 0&&de.otherSE.point.events===Ce.otherSE.point.events&&de.segment.consume(Ce.segment)}}}getAvailableLinkedEvents(){const z=[];for(let K=0,de=this.point.events.length;K<de;K++){const Fe=this.point.events[K];Fe!==this&&!Fe.segment.ringOut&&Fe.segment.isInResult()&&z.push(Fe)}return z}getLeftmostComparator(z){const K=new Map,de=Fe=>{const Ce=Fe.otherSE;K.set(Fe,{sine:rn(this.point,z.point,Ce.point),cosine:Kr(this.point,z.point,Ce.point)})};return(Fe,Ce)=>{K.has(Fe)||de(Fe),K.has(Ce)||de(Ce);const{sine:Nt,cosine:Bt}=K.get(Fe),{sine:sr,cosine:It}=K.get(Ce);return Nt>=0&&sr>=0?Bt<It?1:Bt>It?-1:0:Nt<0&&sr<0?Bt<It?-1:Bt>It?1:0:sr<Nt?-1:sr>Nt?1:0}}}let un=0;class zi{static compare(z,K){const de=z.leftSE.point.x,Fe=K.leftSE.point.x,Ce=z.rightSE.point.x,Nt=K.rightSE.point.x;if(Nt<de)return 1;if(Ce<Fe)return-1;const Bt=z.leftSE.point.y,sr=K.leftSE.point.y,It=z.rightSE.point.y,B=K.rightSE.point.y;if(de<Fe){if(sr<Bt&&sr<It)return 1;if(sr>Bt&&sr>It)return-1;const P=z.comparePoint(K.leftSE.point);if(P<0)return 1;if(P>0)return-1;const V=K.comparePoint(z.rightSE.point);return V!==0?V:-1}if(de>Fe){if(Bt<sr&&Bt<B)return-1;if(Bt>sr&&Bt>B)return 1;const P=K.comparePoint(z.leftSE.point);if(P!==0)return P;const V=z.comparePoint(K.rightSE.point);return V<0?1:V>0?-1:1}if(Bt<sr)return-1;if(Bt>sr)return 1;if(Ce<Nt){const P=K.comparePoint(z.rightSE.point);if(P!==0)return P}if(Ce>Nt){const P=z.comparePoint(K.rightSE.point);if(P<0)return 1;if(P>0)return-1}if(Ce!==Nt){const P=It-Bt,V=Ce-de,Y=B-sr,ce=Nt-Fe;if(P>V&&Y<ce)return 1;if(P<V&&Y>ce)return-1}return Ce>Nt?1:Ce<Nt||It<B?-1:It>B?1:z.id<K.id?-1:z.id>K.id?1:0}constructor(z,K,de,Fe){this.id=++un,this.leftSE=z,z.segment=this,z.otherSE=K,this.rightSE=K,K.segment=this,K.otherSE=z,this.rings=de,this.windings=Fe}static fromRing(z,K,de){let Fe,Ce,Nt;const Bt=$r.comparePoints(z,K);if(Bt<0)Fe=z,Ce=K,Nt=1;else if(Bt>0)Fe=K,Ce=z,Nt=-1;else throw new Error(`Tried to create degenerate segment at [${z.x}, ${z.y}]`);const sr=new $r(Fe,!0),It=new $r(Ce,!1);return new zi(sr,It,[de],[Nt])}replaceRightSE(z){this.rightSE=z,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const z=this.leftSE.point.y,K=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:z<K?z:K},ur:{x:this.rightSE.point.x,y:z>K?z:K}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(z){return z.x===this.leftSE.point.x&&z.y===this.leftSE.point.y||z.x===this.rightSE.point.x&&z.y===this.rightSE.point.y}comparePoint(z){if(this.isAnEndpoint(z))return 0;const K=this.leftSE.point,de=this.rightSE.point,Fe=this.vector();if(K.x===de.x)return z.x===K.x?0:z.x<K.x?1:-1;const Ce=(z.y-K.y)/Fe.y,Nt=K.x+Ce*Fe.x;if(z.x===Nt)return 0;const Bt=(z.x-K.x)/Fe.x,sr=K.y+Bt*Fe.y;return z.y===sr?0:z.y<sr?-1:1}getIntersection(z){const K=this.bbox(),de=z.bbox(),Fe=_r(K,de);if(Fe===null)return null;const Ce=this.leftSE.point,Nt=this.rightSE.point,Bt=z.leftSE.point,sr=z.rightSE.point,It=Sr(K,Bt)&&this.comparePoint(Bt)===0,B=Sr(de,Ce)&&z.comparePoint(Ce)===0,P=Sr(K,sr)&&this.comparePoint(sr)===0,V=Sr(de,Nt)&&z.comparePoint(Nt)===0;if(B&&It)return V&&!P?Nt:!V&&P?sr:null;if(B)return P&&Ce.x===sr.x&&Ce.y===sr.y?null:Ce;if(It)return V&&Nt.x===Bt.x&&Nt.y===Bt.y?null:Bt;if(V&&P)return null;if(V)return Nt;if(P)return sr;const Y=Mn(Ce,this.vector(),Bt,z.vector());return Y===null||!Sr(Fe,Y)?null:Pe.round(Y.x,Y.y)}split(z){const K=[],de=z.events!==void 0,Fe=new $r(z,!0),Ce=new $r(z,!1),Nt=this.rightSE;this.replaceRightSE(Ce),K.push(Ce),K.push(Fe);const Bt=new zi(Fe,Nt,this.rings.slice(),this.windings.slice());return $r.comparePoints(Bt.leftSE.point,Bt.rightSE.point)>0&&Bt.swapEvents(),$r.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),de&&(Fe.checkForConsuming(),Ce.checkForConsuming()),K}swapEvents(){const z=this.rightSE;this.rightSE=this.leftSE,this.leftSE=z,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let K=0,de=this.windings.length;K<de;K++)this.windings[K]*=-1}consume(z){let K=this,de=z;for(;K.consumedBy;)K=K.consumedBy;for(;de.consumedBy;)de=de.consumedBy;const Fe=zi.compare(K,de);if(Fe!==0){if(Fe>0){const Ce=K;K=de,de=Ce}if(K.prev===de){const Ce=K;K=de,de=Ce}for(let Ce=0,Nt=de.rings.length;Ce<Nt;Ce++){const Bt=de.rings[Ce],sr=de.windings[Ce],It=K.rings.indexOf(Bt);It===-1?(K.rings.push(Bt),K.windings.push(sr)):K.windings[It]+=sr}de.rings=null,de.windings=null,de.consumedBy=K,de.leftSE.consumedBy=K.leftSE,de.rightSE.consumedBy=K.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const z=this.prev.consumedBy||this.prev;this._beforeState=z.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const z=this.beforeState();this._afterState={rings:z.rings.slice(0),windings:z.windings.slice(0),multiPolys:[]};const K=this._afterState.rings,de=this._afterState.windings,Fe=this._afterState.multiPolys;for(let Bt=0,sr=this.rings.length;Bt<sr;Bt++){const It=this.rings[Bt],B=this.windings[Bt],P=K.indexOf(It);P===-1?(K.push(It),de.push(B)):de[P]+=B}const Ce=[],Nt=[];for(let Bt=0,sr=K.length;Bt<sr;Bt++){if(de[Bt]===0)continue;const It=K[Bt],B=It.poly;if(Nt.indexOf(B)===-1)if(It.isExterior)Ce.push(B);else{Nt.indexOf(B)===-1&&Nt.push(B);const P=Ce.indexOf(It.poly);P!==-1&&Ce.splice(P,1)}}for(let Bt=0,sr=Ce.length;Bt<sr;Bt++){const It=Ce[Bt].multiPoly;Fe.indexOf(It)===-1&&Fe.push(It)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const z=this.beforeState().multiPolys,K=this.afterState().multiPolys;switch(Vo.type){case"union":{const de=z.length===0,Fe=K.length===0;this._isInResult=de!==Fe;break}case"intersection":{let de,Fe;z.length<K.length?(de=z.length,Fe=K.length):(de=K.length,Fe=z.length),this._isInResult=Fe===Vo.numMultiPolys&&de<Fe;break}case"xor":{const de=Math.abs(z.length-K.length);this._isInResult=de%2===1;break}case"difference":{const de=Fe=>Fe.length===1&&Fe[0].isSubject;this._isInResult=de(z)!==de(K);break}default:throw new Error(`Unrecognized operation type found ${Vo.type}`)}return this._isInResult}}class gi{constructor(z,K,de){if(!Array.isArray(z)||z.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=K,this.isExterior=de,this.segments=[],typeof z[0][0]!="number"||typeof z[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const Fe=Pe.round(z[0][0],z[0][1]);this.bbox={ll:{x:Fe.x,y:Fe.y},ur:{x:Fe.x,y:Fe.y}};let Ce=Fe;for(let Nt=1,Bt=z.length;Nt<Bt;Nt++){if(typeof z[Nt][0]!="number"||typeof z[Nt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let sr=Pe.round(z[Nt][0],z[Nt][1]);sr.x===Ce.x&&sr.y===Ce.y||(this.segments.push(zi.fromRing(Ce,sr,this)),sr.x<this.bbox.ll.x&&(this.bbox.ll.x=sr.x),sr.y<this.bbox.ll.y&&(this.bbox.ll.y=sr.y),sr.x>this.bbox.ur.x&&(this.bbox.ur.x=sr.x),sr.y>this.bbox.ur.y&&(this.bbox.ur.y=sr.y),Ce=sr)}(Fe.x!==Ce.x||Fe.y!==Ce.y)&&this.segments.push(zi.fromRing(Ce,Fe,this))}getSweepEvents(){const z=[];for(let K=0,de=this.segments.length;K<de;K++){const Fe=this.segments[K];z.push(Fe.leftSE),z.push(Fe.rightSE)}return z}}class _o{constructor(z,K){if(!Array.isArray(z))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new gi(z[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let de=1,Fe=z.length;de<Fe;de++){const Ce=new gi(z[de],this,!1);Ce.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Ce.bbox.ll.x),Ce.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Ce.bbox.ll.y),Ce.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Ce.bbox.ur.x),Ce.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Ce.bbox.ur.y),this.interiorRings.push(Ce)}this.multiPoly=K}getSweepEvents(){const z=this.exteriorRing.getSweepEvents();for(let K=0,de=this.interiorRings.length;K<de;K++){const Fe=this.interiorRings[K].getSweepEvents();for(let Ce=0,Nt=Fe.length;Ce<Nt;Ce++)z.push(Fe[Ce])}return z}}class Ii{constructor(z,K){if(!Array.isArray(z))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof z[0][0][0]=="number"&&(z=[z])}catch(de){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let de=0,Fe=z.length;de<Fe;de++){const Ce=new _o(z[de],this);Ce.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Ce.bbox.ll.x),Ce.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Ce.bbox.ll.y),Ce.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Ce.bbox.ur.x),Ce.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Ce.bbox.ur.y),this.polys.push(Ce)}this.isSubject=K}getSweepEvents(){const z=[];for(let K=0,de=this.polys.length;K<de;K++){const Fe=this.polys[K].getSweepEvents();for(let Ce=0,Nt=Fe.length;Ce<Nt;Ce++)z.push(Fe[Ce])}return z}}class ie{static factory(z){const K=[];for(let de=0,Fe=z.length;de<Fe;de++){const Ce=z[de];if(!Ce.isInResult()||Ce.ringOut)continue;let Nt=null,Bt=Ce.leftSE,sr=Ce.rightSE;const It=[Bt],B=Bt.point,P=[];for(;Nt=Bt,Bt=sr,It.push(Bt),Bt.point!==B;)for(;;){const V=Bt.getAvailableLinkedEvents();if(V.length===0){const Se=It[0].point,Ue=It[It.length-1].point;throw new Error(`Unable to complete output ring starting at [${Se.x}, ${Se.y}]. Last matching segment found ends at [${Ue.x}, ${Ue.y}].`)}if(V.length===1){sr=V[0].otherSE;break}let Y=null;for(let Se=0,Ue=P.length;Se<Ue;Se++)if(P[Se].point===Bt.point){Y=Se;break}if(Y!==null){const Se=P.splice(Y)[0],Ue=It.splice(Se.index);Ue.unshift(Ue[0].otherSE),K.push(new ie(Ue.reverse()));continue}P.push({index:It.length,point:Bt.point});const ce=Bt.getLeftmostComparator(Nt);sr=V.sort(ce)[0].otherSE;break}K.push(new ie(It))}return K}constructor(z){this.events=z;for(let K=0,de=z.length;K<de;K++)z[K].segment.ringOut=this;this.poly=null}getGeom(){let z=this.events[0].point;const K=[z];for(let It=1,B=this.events.length-1;It<B;It++){const P=this.events[It].point,V=this.events[It+1].point;xn(P,z,V)!==0&&(K.push(P),z=P)}if(K.length===1)return null;const de=K[0],Fe=K[1];xn(de,z,Fe)===0&&K.shift(),K.push(K[0]);const Ce=this.isExteriorRing()?1:-1,Nt=this.isExteriorRing()?0:K.length-1,Bt=this.isExteriorRing()?K.length:-1,sr=[];for(let It=Nt;It!=Bt;It+=Ce)sr.push([K[It].x,K[It].y]);return sr}isExteriorRing(){if(this._isExteriorRing===void 0){const z=this.enclosingRing();this._isExteriorRing=z?!z.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let z=this.events[0];for(let Fe=1,Ce=this.events.length;Fe<Ce;Fe++){const Nt=this.events[Fe];$r.compare(z,Nt)>0&&(z=Nt)}let K=z.segment.prevInResult(),de=K?K.prevInResult():null;for(;;){if(!K)return null;if(!de)return K.ringOut;if(de.ringOut!==K.ringOut)return de.ringOut.enclosingRing()!==K.ringOut?K.ringOut:K.ringOut.enclosingRing();K=de.prevInResult(),de=K?K.prevInResult():null}}}class Wi{constructor(z){this.exteriorRing=z,z.poly=this,this.interiorRings=[]}addInterior(z){this.interiorRings.push(z),z.poly=this}getGeom(){const z=[this.exteriorRing.getGeom()];if(z[0]===null)return null;for(let K=0,de=this.interiorRings.length;K<de;K++){const Fe=this.interiorRings[K].getGeom();Fe!==null&&z.push(Fe)}return z}}class Ji{constructor(z){this.rings=z,this.polys=this._composePolys(z)}getGeom(){const z=[];for(let K=0,de=this.polys.length;K<de;K++){const Fe=this.polys[K].getGeom();Fe!==null&&z.push(Fe)}return z}_composePolys(z){const K=[];for(let de=0,Fe=z.length;de<Fe;de++){const Ce=z[de];if(!Ce.poly)if(Ce.isExteriorRing())K.push(new Wi(Ce));else{const Nt=Ce.enclosingRing();Nt.poly||K.push(new Wi(Nt)),Nt.poly.addInterior(Ce)}}return K}}class to{constructor(z){let K=arguments.length>1&&arguments[1]!==void 0?arguments[1]:zi.compare;this.queue=z,this.tree=new zt(K),this.segments=[]}process(z){const K=z.segment,de=[];if(z.consumedBy)return z.isLeft?this.queue.remove(z.otherSE):this.tree.remove(K),de;const Fe=z.isLeft?this.tree.add(K):this.tree.find(K);if(!Fe)throw new Error(`Unable to find segment #${K.id} [${K.leftSE.point.x}, ${K.leftSE.point.y}] -> [${K.rightSE.point.x}, ${K.rightSE.point.y}] in SweepLine tree.`);let Ce=Fe,Nt=Fe,Bt,sr;for(;Bt===void 0;)Ce=this.tree.prev(Ce),Ce===null?Bt=null:Ce.key.consumedBy===void 0&&(Bt=Ce.key);for(;sr===void 0;)Nt=this.tree.next(Nt),Nt===null?sr=null:Nt.key.consumedBy===void 0&&(sr=Nt.key);if(z.isLeft){let It=null;if(Bt){const P=Bt.getIntersection(K);if(P!==null&&(K.isAnEndpoint(P)||(It=P),!Bt.isAnEndpoint(P))){const V=this._splitSafely(Bt,P);for(let Y=0,ce=V.length;Y<ce;Y++)de.push(V[Y])}}let B=null;if(sr){const P=sr.getIntersection(K);if(P!==null&&(K.isAnEndpoint(P)||(B=P),!sr.isAnEndpoint(P))){const V=this._splitSafely(sr,P);for(let Y=0,ce=V.length;Y<ce;Y++)de.push(V[Y])}}if(It!==null||B!==null){let P=null;It===null?P=B:B===null?P=It:P=$r.comparePoints(It,B)<=0?It:B,this.queue.remove(K.rightSE),de.push(K.rightSE);const V=K.split(P);for(let Y=0,ce=V.length;Y<ce;Y++)de.push(V[Y])}de.length>0?(this.tree.remove(K),de.push(z)):(this.segments.push(K),K.prev=Bt)}else{if(Bt&&sr){const It=Bt.getIntersection(sr);if(It!==null){if(!Bt.isAnEndpoint(It)){const B=this._splitSafely(Bt,It);for(let P=0,V=B.length;P<V;P++)de.push(B[P])}if(!sr.isAnEndpoint(It)){const B=this._splitSafely(sr,It);for(let P=0,V=B.length;P<V;P++)de.push(B[P])}}}this.tree.remove(K)}return de}_splitSafely(z,K){this.tree.remove(z);const de=z.rightSE;this.queue.remove(de);const Fe=z.split(K);return Fe.push(de),z.consumedBy===void 0&&this.tree.add(z),Fe}}const aa=typeof ze!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ea=typeof ze!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Bs{run(z,K,de){Vo.type=z,Pe.reset();const Fe=[new Ii(K,!0)];for(let P=0,V=de.length;P<V;P++)Fe.push(new Ii(de[P],!1));if(Vo.numMultiPolys=Fe.length,Vo.type==="difference"){const P=Fe[0];let V=1;for(;V<Fe.length;)_r(Fe[V].bbox,P.bbox)!==null?V++:Fe.splice(V,1)}if(Vo.type==="intersection")for(let P=0,V=Fe.length;P<V;P++){const Y=Fe[P];for(let ce=P+1,Se=Fe.length;ce<Se;ce++)if(_r(Y.bbox,Fe[ce].bbox)===null)return[]}const Ce=new zt($r.compare);for(let P=0,V=Fe.length;P<V;P++){const Y=Fe[P].getSweepEvents();for(let ce=0,Se=Y.length;ce<Se;ce++)if(Ce.insert(Y[ce]),Ce.size>aa)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const Nt=new to(Ce);let Bt=Ce.size,sr=Ce.pop();for(;sr;){const P=sr.key;if(Ce.size===Bt){const Y=P.segment;throw new Error(`Unable to pop() ${P.isLeft?"left":"right"} SweepEvent [${P.point.x}, ${P.point.y}] from segment #${Y.id} [${Y.leftSE.point.x}, ${Y.leftSE.point.y}] -> [${Y.rightSE.point.x}, ${Y.rightSE.point.y}] from queue.`)}if(Ce.size>aa)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(Nt.segments.length>ea)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const V=Nt.process(P);for(let Y=0,ce=V.length;Y<ce;Y++){const Se=V[Y];Se.consumedBy===void 0&&Ce.insert(Se)}Bt=Ce.size,sr=Ce.pop()}Pe.reset();const It=ie.factory(Nt.segments);return new Ji(It).getGeom()}}const Vo=new Bs;var lo={union:function(ot){for(var z=arguments.length,K=new Array(z>1?z-1:0),de=1;de<z;de++)K[de-1]=arguments[de];return Vo.run("union",ot,K)},intersection:function(ot){for(var z=arguments.length,K=new Array(z>1?z-1:0),de=1;de<z;de++)K[de-1]=arguments[de];return Vo.run("intersection",ot,K)},xor:function(ot){for(var z=arguments.length,K=new Array(z>1?z-1:0),de=1;de<z;de++)K[de-1]=arguments[de];return Vo.run("xor",ot,K)},difference:function(ot){for(var z=arguments.length,K=new Array(z>1?z-1:0),de=1;de<z;de++)K[de-1]=arguments[de];return Vo.run("difference",ot,K)}};return lo})},79801:function(pr){(function(Gt,H){pr.exports=H()})(this,function(){"use strict";var Gt=function(F){return F instanceof Uint8Array||F instanceof Uint16Array||F instanceof Uint32Array||F instanceof Int8Array||F instanceof Int16Array||F instanceof Int32Array||F instanceof Float32Array||F instanceof Float64Array||F instanceof Uint8ClampedArray},H=function(F,le){for(var De=Object.keys(le),At=0;At<De.length;++At)F[De[At]]=le[De[At]];return F},ze=`
`;function qe(F){return typeof atob!="undefined"?atob(F):"base64:"+F}function v(F){var le=new Error("(regl) "+F);throw console.error(le),le}function at(F,le){F||v(le)}function G(F){return F?": "+F:""}function Je(F,le,De){F in le||v("unknown parameter ("+F+")"+G(De)+". possible values: "+Object.keys(le).join())}function Oe(F,le){Gt(F)||v("invalid parameter type"+G(le)+". must be a typed array")}function yt(F,le){switch(le){case"number":return typeof F=="number";case"object":return typeof F=="object";case"string":return typeof F=="string";case"boolean":return typeof F=="boolean";case"function":return typeof F=="function";case"undefined":return typeof F=="undefined";case"symbol":return typeof F=="symbol"}}function Re(F,le,De){yt(F,le)||v("invalid parameter type"+G(De)+". expected "+le+", got "+typeof F)}function zt(F,le){F>=0&&(F|0)===F||v("invalid parameter type, ("+F+")"+G(le)+". must be a nonnegative integer")}function ct(F,le,De){le.indexOf(F)<0&&v("invalid value"+G(De)+". must be one of: "+le)}var st=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function qt(F){Object.keys(F).forEach(function(le){st.indexOf(le)<0&&v('invalid regl constructor argument "'+le+'". must be one of '+st)})}function Yt(F,le){for(F=F+"";F.length<le;)F=" "+F;return F}function ir(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function or(F,le){this.number=F,this.line=le,this.errors=[]}function Sr(F,le,De){this.file=F,this.line=le,this.message=De}function _r(){var F=new Error,le=(F.stack||F).toString(),De=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(le);if(De)return De[1];var At=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(le);return At?At[1]:"unknown"}function Gr(){var F=new Error,le=(F.stack||F).toString(),De=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(le);if(De)return De[1];var At=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(le);return At?At[1]:"unknown"}function vn(F,le){var De=F.split(`
`),At=1,$t=0,Ct={unknown:new ir,0:new ir};Ct.unknown.name=Ct[0].name=le||_r(),Ct.unknown.lines.push(new or(0,""));for(var pt=0;pt<De.length;++pt){var mr=De[pt],dr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(mr);if(dr)switch(dr[1]){case"line":var Pr=/(\d+)(\s+\d+)?/.exec(dr[2]);Pr&&(At=Pr[1]|0,Pr[2]&&($t=Pr[2]|0,$t in Ct||(Ct[$t]=new ir)));break;case"define":var xr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(dr[2]);xr&&(Ct[$t].name=xr[1]?qe(xr[2]):xr[2]);break}Ct[$t].lines.push(new or(At++,mr))}return Object.keys(Ct).forEach(function(Mr){var kr=Ct[Mr];kr.lines.forEach(function(fr){kr.index[fr.number]=fr})}),Ct}function ii(F){var le=[];return F.split(`
`).forEach(function(De){if(!(De.length<5)){var At=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(De);At?le.push(new Sr(At[1]|0,At[2]|0,At[3].trim())):De.length>0&&le.push(new Sr("unknown",0,De))}}),le}function Yn(F,le){le.forEach(function(De){var At=F[De.file];if(At){var $t=At.index[De.line];if($t){$t.errors.push(De),At.hasErrors=!0;return}}F.unknown.hasErrors=!0,F.unknown.lines[0].errors.push(De)})}function xt(F,le,De,At,$t){if(!F.getShaderParameter(le,F.COMPILE_STATUS)){var Ct=F.getShaderInfoLog(le),pt=At===F.FRAGMENT_SHADER?"fragment":"vertex";me(De,"string",pt+" shader source must be a string",$t);var mr=vn(De,$t),dr=ii(Ct);Yn(mr,dr),Object.keys(mr).forEach(function(Pr){var xr=mr[Pr];if(!xr.hasErrors)return;var Mr=[""],kr=[""];function fr(Or,lt){Mr.push(Or),kr.push(lt||"")}fr("file number "+Pr+": "+xr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),xr.lines.forEach(function(Or){if(Or.errors.length>0){fr(Yt(Or.number,4)+"|  ","background-color:yellow; font-weight:bold"),fr(Or.line+ze,"color:red; background-color:yellow; font-weight:bold");var lt=0;Or.errors.forEach(function(Zt){var br=Zt.message,Wr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(br);if(Wr){var ur=Wr[1];switch(br=Wr[2],ur){case"assign":ur="=";break}lt=Math.max(Or.line.indexOf(ur,lt),0)}else lt=0;fr(Yt("| ",6)),fr(Yt("^^^",lt+3)+ze,"font-weight:bold"),fr(Yt("| ",6)),fr(br+ze,"font-weight:bold")}),fr(Yt("| ",6)+ze)}else fr(Yt(Or.number,4)+"|  "),fr(Or.line+ze,"color:red")}),typeof document!="undefined"&&!window.chrome?(kr[0]=Mr.join("%c"),console.log.apply(console,kr)):console.log(Mr.join(""))}),at.raise("Error compiling "+pt+" shader, "+mr[0].name)}}function Pe(F,le,De,At,$t){if(!F.getProgramParameter(le,F.LINK_STATUS)){var Ct=F.getProgramInfoLog(le),pt=vn(De,$t),mr=vn(At,$t),dr='Error linking program with vertex shader, "'+mr[0].name+'", and fragment shader "'+pt[0].name+'"';typeof document!="undefined"?console.log("%c"+dr+ze+"%c"+Ct,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(dr+ze+Ct),at.raise(dr)}}function Ft(F){F._commandRef=_r()}function tt(F,le,De,At){Ft(F);function $t(dr){return dr?At.id(dr):0}F._fragId=$t(F.static.frag),F._vertId=$t(F.static.vert);function Ct(dr,Pr){Object.keys(Pr).forEach(function(xr){dr[At.id(xr)]=!0})}var pt=F._uniformSet={};Ct(pt,le.static),Ct(pt,le.dynamic);var mr=F._attributeSet={};Ct(mr,De.static),Ct(mr,De.dynamic),F._hasCount="count"in F.static||"count"in F.dynamic||"elements"in F.static||"elements"in F.dynamic}function Jt(F,le){var De=Gr();v(F+" in command "+(le||_r())+(De==="unknown"?"":" called from "+De))}function wr(F,le,De){F||Jt(le,De||_r())}function $(F,le,De,At){F in le||Jt("unknown parameter ("+F+")"+G(De)+". possible values: "+Object.keys(le).join(),At||_r())}function me(F,le,De,At){yt(F,le)||Jt("invalid parameter type"+G(De)+". expected "+le+", got "+typeof F,At||_r())}function W(F){F()}function he(F,le,De){F.texture?ct(F.texture._texture.internalformat,le,"unsupported texture format for attachment"):ct(F.renderbuffer._renderbuffer.format,De,"unsupported renderbuffer format for attachment")}var ae=33071,Me=9728,je=9984,ut=9985,St=9986,bt=9987,Lr=5120,Cr=5121,On=5122,Xr=5123,xn=5124,Yr=5125,rn=5126,Kr=32819,Qn=32820,Ur=33635,Mn=34042,$r=36193,un={};un[Lr]=un[Cr]=1,un[On]=un[Xr]=un[$r]=un[Ur]=un[Kr]=un[Qn]=2,un[xn]=un[Yr]=un[rn]=un[Mn]=4;function zi(F,le){return F===Qn||F===Kr||F===Ur?2:F===Mn?4:un[F]*le}function gi(F){return!(F&F-1)&&!!F}function _o(F,le,De){var At,$t=le.width,Ct=le.height,pt=le.channels;at($t>0&&$t<=De.maxTextureSize&&Ct>0&&Ct<=De.maxTextureSize,"invalid texture shape"),(F.wrapS!==ae||F.wrapT!==ae)&&at(gi($t)&&gi(Ct),"incompatible wrap mode for texture, both width and height must be power of 2"),le.mipmask===1?$t!==1&&Ct!==1&&at(F.minFilter!==je&&F.minFilter!==St&&F.minFilter!==ut&&F.minFilter!==bt,"min filter requires mipmap"):(at(gi($t)&&gi(Ct),"texture must be a square power of 2 to support mipmapping"),at(le.mipmask===($t<<1)-1,"missing or incomplete mipmap data")),le.type===rn&&(De.extensions.indexOf("oes_texture_float_linear")<0&&at(F.minFilter===Me&&F.magFilter===Me,"filter not supported, must enable oes_texture_float_linear"),at(!F.genMipmaps,"mipmap generation not supported with float textures"));var mr=le.images;for(At=0;At<16;++At)if(mr[At]){var dr=$t>>At,Pr=Ct>>At;at(le.mipmask&1<<At,"missing mipmap data");var xr=mr[At];if(at(xr.width===dr&&xr.height===Pr,"invalid shape for mip images"),at(xr.format===le.format&&xr.internalformat===le.internalformat&&xr.type===le.type,"incompatible type for mip image"),!xr.compressed)if(xr.data){var Mr=Math.ceil(zi(xr.type,pt)*dr/xr.unpackAlignment)*xr.unpackAlignment;at(xr.data.byteLength===Mr*Pr,"invalid data for image, buffer size is inconsistent with image format")}else xr.element||xr.copy}else F.genMipmaps||at((le.mipmask&1<<At)===0,"extra mipmap data");le.compressed&&at(!F.genMipmaps,"mipmap generation for compressed images not supported")}function Ii(F,le,De,At){var $t=F.width,Ct=F.height,pt=F.channels;at($t>0&&$t<=At.maxTextureSize&&Ct>0&&Ct<=At.maxTextureSize,"invalid texture shape"),at($t===Ct,"cube map must be square"),at(le.wrapS===ae&&le.wrapT===ae,"wrap mode not supported by cube map");for(var mr=0;mr<De.length;++mr){var dr=De[mr];at(dr.width===$t&&dr.height===Ct,"inconsistent cube map face shape"),le.genMipmaps&&(at(!dr.compressed,"can not generate mipmap for compressed textures"),at(dr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Pr=dr.images,xr=0;xr<16;++xr){var Mr=Pr[xr];if(Mr){var kr=$t>>xr,fr=Ct>>xr;at(dr.mipmask&1<<xr,"missing mipmap data"),at(Mr.width===kr&&Mr.height===fr,"invalid shape for mip images"),at(Mr.format===F.format&&Mr.internalformat===F.internalformat&&Mr.type===F.type,"incompatible type for mip image"),Mr.compressed||(Mr.data?at(Mr.data.byteLength===kr*fr*Math.max(zi(Mr.type,pt),Mr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Mr.element||Mr.copy)}}}}var ie=H(at,{optional:W,raise:v,commandRaise:Jt,command:wr,parameter:Je,commandParameter:$,constructor:qt,type:Re,commandType:me,isTypedArray:Oe,nni:zt,oneOf:ct,shaderError:xt,linkError:Pe,callSite:Gr,saveCommandRef:Ft,saveDrawInfo:tt,framebufferFormat:he,guessCommand:_r,texture2D:_o,textureCube:Ii}),Wi=0,Ji=0;function to(F,le){this.id=Wi++,this.type=F,this.data=le}function aa(F){return F.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ea(F){if(F.length===0)return[];var le=F.charAt(0),De=F.charAt(F.length-1);if(F.length>1&&le===De&&(le==='"'||le==="'"))return['"'+aa(F.substr(1,F.length-2))+'"'];var At=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(F);if(At)return ea(F.substr(0,At.index)).concat(ea(At[1])).concat(ea(F.substr(At.index+At[0].length)));var $t=F.split(".");if($t.length===1)return['"'+aa(F)+'"'];for(var Ct=[],pt=0;pt<$t.length;++pt)Ct=Ct.concat(ea($t[pt]));return Ct}function Bs(F){return"["+ea(F).join("][")+"]"}function Vo(F,le){return new to(F,Bs(le+""))}function Ws(F){return typeof F=="function"&&!F._reglType||F instanceof to}function _u(F,le){return typeof F=="function"?new to(Ji,F):F}var Do={DynamicVariable:to,define:Vo,isDynamic:Ws,unbox:_u,accessor:Bs},uo={next:typeof requestAnimationFrame=="function"?function(F){return requestAnimationFrame(F)}:function(F){return setTimeout(F,16)},cancel:typeof cancelAnimationFrame=="function"?function(F){return cancelAnimationFrame(F)}:clearTimeout},lo=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ot(){var F={"":0},le=[""];return{id:function(De){var At=F[De];return At||(At=F[De]=le.length,le.push(De),At)},str:function(De){return le[De]}}}function z(F,le,De){var At=document.createElement("canvas");H(At.style,{border:0,margin:0,padding:0,top:0,left:0}),F.appendChild(At),F===document.body&&(At.style.position="absolute",H(F.style,{margin:0,padding:0}));function $t(){var mr=window.innerWidth,dr=window.innerHeight;if(F!==document.body){var Pr=F.getBoundingClientRect();mr=Pr.right-Pr.left,dr=Pr.bottom-Pr.top}At.width=De*mr,At.height=De*dr,H(At.style,{width:mr+"px",height:dr+"px"})}var Ct;F!==document.body&&typeof ResizeObserver=="function"?(Ct=new ResizeObserver(function(){setTimeout($t)}),Ct.observe(F)):window.addEventListener("resize",$t,!1);function pt(){Ct?Ct.disconnect():window.removeEventListener("resize",$t),F.removeChild(At)}return $t(),{canvas:At,onDestroy:pt}}function K(F,le){function De(At){try{return F.getContext(At,le)}catch($t){return null}}return De("webgl")||De("experimental-webgl")||De("webgl-experimental")}function de(F){return typeof F.nodeName=="string"&&typeof F.appendChild=="function"&&typeof F.getBoundingClientRect=="function"}function Fe(F){return typeof F.drawArrays=="function"||typeof F.drawElements=="function"}function Ce(F){return typeof F=="string"?F.split():(ie(Array.isArray(F),"invalid extension array"),F)}function Nt(F){return typeof F=="string"?(ie(typeof document!="undefined","not supported outside of DOM"),document.querySelector(F)):F}function Bt(F){var le=F||{},De,At,$t,Ct,pt={},mr=[],dr=[],Pr=typeof window=="undefined"?1:window.devicePixelRatio,xr=!1,Mr=function(Or){Or&&ie.raise(Or)},kr=function(){};if(typeof le=="string"?(ie(typeof document!="undefined","selector queries only supported in DOM enviroments"),De=document.querySelector(le),ie(De,"invalid query string for element")):typeof le=="object"?de(le)?De=le:Fe(le)?(Ct=le,$t=Ct.canvas):(ie.constructor(le),"gl"in le?Ct=le.gl:"canvas"in le?$t=Nt(le.canvas):"container"in le&&(At=Nt(le.container)),"attributes"in le&&(pt=le.attributes,ie.type(pt,"object","invalid context attributes")),"extensions"in le&&(mr=Ce(le.extensions)),"optionalExtensions"in le&&(dr=Ce(le.optionalExtensions)),"onDone"in le&&(ie.type(le.onDone,"function","invalid or missing onDone callback"),Mr=le.onDone),"profile"in le&&(xr=!!le.profile),"pixelRatio"in le&&(Pr=+le.pixelRatio,ie(Pr>0,"invalid pixel ratio"))):ie.raise("invalid arguments to regl"),De&&(De.nodeName.toLowerCase()==="canvas"?$t=De:At=De),!Ct){if(!$t){ie(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var fr=z(At||document.body,Mr,Pr);if(!fr)return null;$t=fr.canvas,kr=fr.onDestroy}pt.premultipliedAlpha===void 0&&(pt.premultipliedAlpha=!0),Ct=K($t,pt)}return Ct?{gl:Ct,canvas:$t,container:At,extensions:mr,optionalExtensions:dr,pixelRatio:Pr,profile:xr,onDone:Mr,onDestroy:kr}:(kr(),Mr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function sr(F,le){var De={};function At(pt){ie.type(pt,"string","extension name must be string");var mr=pt.toLowerCase(),dr;try{dr=De[mr]=F.getExtension(mr)}catch(Pr){}return!!dr}for(var $t=0;$t<le.extensions.length;++$t){var Ct=le.extensions[$t];if(!At(Ct))return le.onDestroy(),le.onDone('"'+Ct+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return le.optionalExtensions.forEach(At),{extensions:De,restore:function(){Object.keys(De).forEach(function(pt){if(De[pt]&&!At(pt))throw new Error("(regl): error restoring extension "+pt)})}}}function It(F,le){for(var De=Array(F),At=0;At<F;++At)De[At]=le(At);return De}var B=5120,P=5121,V=5122,Y=5123,ce=5124,Se=5125,Ue=5126;function Q(F){for(var le=16;le<=1<<28;le*=16)if(F<=le)return le;return 0}function ve(F){var le,De;return le=(F>65535)<<4,F>>>=le,De=(F>255)<<3,F>>>=De,le|=De,De=(F>15)<<2,F>>>=De,le|=De,De=(F>3)<<1,F>>>=De,le|=De,le|F>>1}function rt(){var F=It(8,function(){return[]});function le(Ct){var pt=Q(Ct),mr=F[ve(pt)>>2];return mr.length>0?mr.pop():new ArrayBuffer(pt)}function De(Ct){F[ve(Ct.byteLength)>>2].push(Ct)}function At(Ct,pt){var mr=null;switch(Ct){case B:mr=new Int8Array(le(pt),0,pt);break;case P:mr=new Uint8Array(le(pt),0,pt);break;case V:mr=new Int16Array(le(2*pt),0,pt);break;case Y:mr=new Uint16Array(le(2*pt),0,pt);break;case ce:mr=new Int32Array(le(4*pt),0,pt);break;case Se:mr=new Uint32Array(le(4*pt),0,pt);break;case Ue:mr=new Float32Array(le(4*pt),0,pt);break;default:return null}return mr.length!==pt?mr.subarray(0,pt):mr}function $t(Ct){De(Ct.buffer)}return{alloc:le,free:De,allocType:At,freeType:$t}}var wt=rt();wt.zero=rt();var nr=3408,_t=3410,Qt=3411,Br=3412,Fr=3413,Mt=3414,Dr=3415,Er=33901,Rr=33902,zn=3379,jr=3386,qn=34921,Li=36347,ei=36348,Ai=35661,di=35660,Aa=34930,Bi=36349,ro=34076,mi=34024,Jn=7936,oi=7937,bo=7938,Fs=35724,eo=34047,co=36063,yu=34852,_s=3553,Gi=34067,sa=34069,no=33984,yo=6408,Fa=5126,Ki=5121,Wa=36160,Na=36053,xu=36064,ys=16384,yc=function(F,le){var De=1;le.ext_texture_filter_anisotropic&&(De=F.getParameter(eo));var At=1,$t=1;le.webgl_draw_buffers&&(At=F.getParameter(yu),$t=F.getParameter(co));var Ct=!!le.oes_texture_float;if(Ct){var pt=F.createTexture();F.bindTexture(_s,pt),F.texImage2D(_s,0,yo,1,1,0,yo,Fa,null);var mr=F.createFramebuffer();if(F.bindFramebuffer(Wa,mr),F.framebufferTexture2D(Wa,xu,_s,pt,0),F.bindTexture(_s,null),F.checkFramebufferStatus(Wa)!==Na)Ct=!1;else{F.viewport(0,0,1,1),F.clearColor(1,0,0,1),F.clear(ys);var dr=wt.allocType(Fa,4);F.readPixels(0,0,1,1,yo,Fa,dr),F.getError()?Ct=!1:(F.deleteFramebuffer(mr),F.deleteTexture(pt),Ct=dr[0]===1),wt.freeType(dr)}}var Pr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),xr=!0;if(!Pr){var Mr=F.createTexture(),kr=wt.allocType(Ki,36);F.activeTexture(no),F.bindTexture(Gi,Mr),F.texImage2D(sa,0,yo,3,3,0,yo,Ki,kr),wt.freeType(kr),F.bindTexture(Gi,null),F.deleteTexture(Mr),xr=!F.getError()}return{colorBits:[F.getParameter(_t),F.getParameter(Qt),F.getParameter(Br),F.getParameter(Fr)],depthBits:F.getParameter(Mt),stencilBits:F.getParameter(Dr),subpixelBits:F.getParameter(nr),extensions:Object.keys(le).filter(function(fr){return!!le[fr]}),maxAnisotropic:De,maxDrawbuffers:At,maxColorAttachments:$t,pointSizeDims:F.getParameter(Er),lineWidthDims:F.getParameter(Rr),maxViewportDims:F.getParameter(jr),maxCombinedTextureUnits:F.getParameter(Ai),maxCubeMapSize:F.getParameter(ro),maxRenderbufferSize:F.getParameter(mi),maxTextureUnits:F.getParameter(Aa),maxTextureSize:F.getParameter(zn),maxAttributes:F.getParameter(qn),maxVertexUniforms:F.getParameter(Li),maxVertexTextureUnits:F.getParameter(di),maxVaryingVectors:F.getParameter(ei),maxFragmentUniforms:F.getParameter(Bi),glsl:F.getParameter(Fs),renderer:F.getParameter(oi),vendor:F.getParameter(Jn),version:F.getParameter(bo),readFloat:Ct,npotTextureCube:xr}};function Bo(F){return!!F&&typeof F=="object"&&Array.isArray(F.shape)&&Array.isArray(F.stride)&&typeof F.offset=="number"&&F.shape.length===F.stride.length&&(Array.isArray(F.data)||Gt(F.data))}var Yi=function(F){return Object.keys(F).map(function(le){return F[le]})},$a={shape:yr,flatten:Vt};function Zo(F,le,De){for(var At=0;At<le;++At)De[At]=F[At]}function re(F,le,De,At){for(var $t=0,Ct=0;Ct<le;++Ct)for(var pt=F[Ct],mr=0;mr<De;++mr)At[$t++]=pt[mr]}function pe(F,le,De,At,$t,Ct){for(var pt=Ct,mr=0;mr<le;++mr)for(var dr=F[mr],Pr=0;Pr<De;++Pr)for(var xr=dr[Pr],Mr=0;Mr<At;++Mr)$t[pt++]=xr[Mr]}function Ke(F,le,De,At,$t){for(var Ct=1,pt=De+1;pt<le.length;++pt)Ct*=le[pt];var mr=le[De];if(le.length-De===4){var dr=le[De+1],Pr=le[De+2],xr=le[De+3];for(pt=0;pt<mr;++pt)pe(F[pt],dr,Pr,xr,At,$t),$t+=Ct}else for(pt=0;pt<mr;++pt)Ke(F[pt],le,De+1,At,$t),$t+=Ct}function Vt(F,le,De,At){var $t=1;if(le.length)for(var Ct=0;Ct<le.length;++Ct)$t*=le[Ct];else $t=0;var pt=At||wt.allocType(De,$t);switch(le.length){case 0:break;case 1:Zo(F,le[0],pt);break;case 2:re(F,le[0],le[1],pt);break;case 3:pe(F,le[0],le[1],le[2],pt,0);break;default:Ke(F,le,0,pt,0)}return pt}function yr(F){for(var le=[],De=F;De.length;De=De[0])le.push(De.length);return le}var dn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Si=5120,jo=5122,ua=5124,Ho=5121,xs=5123,bs=5125,th=5126,Ch=5126,ti={int8:Si,int16:jo,int32:ua,uint8:Ho,uint16:xs,uint32:bs,float:th,float32:Ch},Es=35048,Ns=35040,au={dynamic:Es,stream:Ns,static:35044},bu=$a.flatten,Du=$a.shape,xc=35044,Ts=35040,Eo=5121,Eu=5126,Bu=[];Bu[5120]=1,Bu[5122]=2,Bu[5124]=4,Bu[5121]=1,Bu[5123]=2,Bu[5125]=4,Bu[5126]=4;function rh(F){return dn[Object.prototype.toString.call(F)]|0}function cf(F,le){for(var De=0;De<le.length;++De)F[De]=le[De]}function nh(F,le,De,At,$t,Ct,pt){for(var mr=0,dr=0;dr<De;++dr)for(var Pr=0;Pr<At;++Pr)F[mr++]=le[$t*dr+Ct*Pr+pt]}function Rh(F,le,De,At){var $t=0,Ct={};function pt(lt){this.id=$t++,this.buffer=F.createBuffer(),this.type=lt,this.usage=xc,this.byteLength=0,this.dimension=1,this.dtype=Eo,this.persistentData=null,De.profile&&(this.stats={size:0})}pt.prototype.bind=function(){F.bindBuffer(this.type,this.buffer)},pt.prototype.destroy=function(){kr(this)};var mr=[];function dr(lt,Zt){var br=mr.pop();return br||(br=new pt(lt)),br.bind(),Mr(br,Zt,Ts,0,1,!1),br}function Pr(lt){mr.push(lt)}function xr(lt,Zt,br){lt.byteLength=Zt.byteLength,F.bufferData(lt.type,Zt,br)}function Mr(lt,Zt,br,Wr,ur,Jr){var vr;if(lt.usage=br,Array.isArray(Zt)){if(lt.dtype=Wr||Eu,Zt.length>0){var qr;if(Array.isArray(Zt[0])){vr=Du(Zt);for(var lr=1,Vr=1;Vr<vr.length;++Vr)lr*=vr[Vr];lt.dimension=lr,qr=bu(Zt,vr,lt.dtype),xr(lt,qr,br),Jr?lt.persistentData=qr:wt.freeType(qr)}else if(typeof Zt[0]=="number"){lt.dimension=ur;var Rn=wt.allocType(lt.dtype,Zt.length);cf(Rn,Zt),xr(lt,Rn,br),Jr?lt.persistentData=Rn:wt.freeType(Rn)}else Gt(Zt[0])?(lt.dimension=Zt[0].length,lt.dtype=Wr||rh(Zt[0])||Eu,qr=bu(Zt,[Zt.length,Zt[0].length],lt.dtype),xr(lt,qr,br),Jr?lt.persistentData=qr:wt.freeType(qr)):ie.raise("invalid buffer data")}}else if(Gt(Zt))lt.dtype=Wr||rh(Zt),lt.dimension=ur,xr(lt,Zt,br),Jr&&(lt.persistentData=new Uint8Array(new Uint8Array(Zt.buffer)));else if(Bo(Zt)){vr=Zt.shape;var Gn=Zt.stride,Zr=Zt.offset,gr=0,_e=0,D=0,ni=0;vr.length===1?(gr=vr[0],_e=1,D=Gn[0],ni=0):vr.length===2?(gr=vr[0],_e=vr[1],D=Gn[0],ni=Gn[1]):ie.raise("invalid shape"),lt.dtype=Wr||rh(Zt.data)||Eu,lt.dimension=_e;var O=wt.allocType(lt.dtype,gr*_e);nh(O,Zt.data,gr,_e,D,ni,Zr),xr(lt,O,br),Jr?lt.persistentData=O:wt.freeType(O)}else Zt instanceof ArrayBuffer?(lt.dtype=Eo,lt.dimension=ur,xr(lt,Zt,br),Jr&&(lt.persistentData=new Uint8Array(new Uint8Array(Zt)))):ie.raise("invalid buffer data")}function kr(lt){le.bufferCount--,At(lt);var Zt=lt.buffer;ie(Zt,"buffer must not be deleted already"),F.deleteBuffer(Zt),lt.buffer=null,delete Ct[lt.id]}function fr(lt,Zt,br,Wr){le.bufferCount++;var ur=new pt(Zt);Ct[ur.id]=ur;function Jr(lr){var Vr=xc,Rn=null,Gn=0,Zr=0,gr=1;return Array.isArray(lr)||Gt(lr)||Bo(lr)||lr instanceof ArrayBuffer?Rn=lr:typeof lr=="number"?Gn=lr|0:lr&&(ie.type(lr,"object","buffer arguments must be an object, a number or an array"),"data"in lr&&(ie(Rn===null||Array.isArray(Rn)||Gt(Rn)||Bo(Rn),"invalid data for buffer"),Rn=lr.data),"usage"in lr&&(ie.parameter(lr.usage,au,"invalid buffer usage"),Vr=au[lr.usage]),"type"in lr&&(ie.parameter(lr.type,ti,"invalid buffer type"),Zr=ti[lr.type]),"dimension"in lr&&(ie.type(lr.dimension,"number","invalid dimension"),gr=lr.dimension|0),"length"in lr&&(ie.nni(Gn,"buffer length must be a nonnegative integer"),Gn=lr.length|0)),ur.bind(),Rn?Mr(ur,Rn,Vr,Zr,gr,Wr):(Gn&&F.bufferData(ur.type,Gn,Vr),ur.dtype=Zr||Eo,ur.usage=Vr,ur.dimension=gr,ur.byteLength=Gn),De.profile&&(ur.stats.size=ur.byteLength*Bu[ur.dtype]),Jr}function vr(lr,Vr){ie(Vr+lr.byteLength<=ur.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+lr.byteLength+" starting from offset "+Vr+" to a buffer of size "+ur.byteLength),F.bufferSubData(ur.type,Vr,lr)}function qr(lr,Vr){var Rn=(Vr||0)|0,Gn;if(ur.bind(),Gt(lr)||lr instanceof ArrayBuffer)vr(lr,Rn);else if(Array.isArray(lr)){if(lr.length>0)if(typeof lr[0]=="number"){var Zr=wt.allocType(ur.dtype,lr.length);cf(Zr,lr),vr(Zr,Rn),wt.freeType(Zr)}else if(Array.isArray(lr[0])||Gt(lr[0])){Gn=Du(lr);var gr=bu(lr,Gn,ur.dtype);vr(gr,Rn),wt.freeType(gr)}else ie.raise("invalid buffer data")}else if(Bo(lr)){Gn=lr.shape;var _e=lr.stride,D=0,ni=0,O=0,li=0;Gn.length===1?(D=Gn[0],ni=1,O=_e[0],li=0):Gn.length===2?(D=Gn[0],ni=Gn[1],O=_e[0],li=_e[1]):ie.raise("invalid shape");var Xn=Array.isArray(lr.data)?ur.dtype:rh(lr.data),Un=wt.allocType(Xn,D*ni);nh(Un,lr.data,D,ni,O,li,lr.offset),vr(Un,Rn),wt.freeType(Un)}else ie.raise("invalid data for buffer subdata");return Jr}return br||Jr(lt),Jr._reglType="buffer",Jr._buffer=ur,Jr.subdata=qr,De.profile&&(Jr.stats=ur.stats),Jr.destroy=function(){kr(ur)},Jr}function Or(){Yi(Ct).forEach(function(lt){lt.buffer=F.createBuffer(),F.bindBuffer(lt.type,lt.buffer),F.bufferData(lt.type,lt.persistentData||lt.byteLength,lt.usage)})}return De.profile&&(le.getTotalBufferSize=function(){var lt=0;return Object.keys(Ct).forEach(function(Zt){lt+=Ct[Zt].stats.size}),lt}),{create:fr,createStream:dr,destroyStream:Pr,clear:function(){Yi(Ct).forEach(kr),mr.forEach(kr)},getBuffer:function(lt){return lt&&lt._buffer instanceof pt?lt._buffer:null},restore:Or,_initBuffer:Mr}}var Ih=0,Mh=0,hf=1,ff=1,np=4,bc=4,pa={points:Ih,point:Mh,lines:hf,line:ff,triangles:np,triangle:bc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},pf=0,Ua=1,Tl=4,Ju=5120,Us=5121,el=5122,Gs=5123,Fu=5124,ks=5125,Nu=34963,tl=35040,df=35044;function mf(F,le,De,At){var $t={},Ct=0,pt={uint8:Us,uint16:Gs};le.oes_element_index_uint&&(pt.uint32=ks);function mr(Or){this.id=Ct++,$t[this.id]=this,this.buffer=Or,this.primType=Tl,this.vertCount=0,this.type=0}mr.prototype.bind=function(){this.buffer.bind()};var dr=[];function Pr(Or){var lt=dr.pop();return lt||(lt=new mr(De.create(null,Nu,!0,!1)._buffer)),Mr(lt,Or,tl,-1,-1,0,0),lt}function xr(Or){dr.push(Or)}function Mr(Or,lt,Zt,br,Wr,ur,Jr){Or.buffer.bind();var vr;if(lt){var qr=Jr;!Jr&&(!Gt(lt)||Bo(lt)&&!Gt(lt.data))&&(qr=le.oes_element_index_uint?ks:Gs),De._initBuffer(Or.buffer,lt,Zt,qr,3)}else F.bufferData(Nu,ur,Zt),Or.buffer.dtype=vr||Us,Or.buffer.usage=Zt,Or.buffer.dimension=3,Or.buffer.byteLength=ur;if(vr=Jr,!Jr){switch(Or.buffer.dtype){case Us:case Ju:vr=Us;break;case Gs:case el:vr=Gs;break;case ks:case Fu:vr=ks;break;default:ie.raise("unsupported type for element array")}Or.buffer.dtype=vr}Or.type=vr,ie(vr!==ks||!!le.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var lr=Wr;lr<0&&(lr=Or.buffer.byteLength,vr===Gs?lr>>=1:vr===ks&&(lr>>=2)),Or.vertCount=lr;var Vr=br;if(br<0){Vr=Tl;var Rn=Or.buffer.dimension;Rn===1&&(Vr=pf),Rn===2&&(Vr=Ua),Rn===3&&(Vr=Tl)}Or.primType=Vr}function kr(Or){At.elementsCount--,ie(Or.buffer!==null,"must not double destroy elements"),delete $t[Or.id],Or.buffer.destroy(),Or.buffer=null}function fr(Or,lt){var Zt=De.create(null,Nu,!0),br=new mr(Zt._buffer);At.elementsCount++;function Wr(ur){if(!ur)Zt(),br.primType=Tl,br.vertCount=0,br.type=Us;else if(typeof ur=="number")Zt(ur),br.primType=Tl,br.vertCount=ur|0,br.type=Us;else{var Jr=null,vr=df,qr=-1,lr=-1,Vr=0,Rn=0;Array.isArray(ur)||Gt(ur)||Bo(ur)?Jr=ur:(ie.type(ur,"object","invalid arguments for elements"),"data"in ur&&(Jr=ur.data,ie(Array.isArray(Jr)||Gt(Jr)||Bo(Jr),"invalid data for element buffer")),"usage"in ur&&(ie.parameter(ur.usage,au,"invalid element buffer usage"),vr=au[ur.usage]),"primitive"in ur&&(ie.parameter(ur.primitive,pa,"invalid element buffer primitive"),qr=pa[ur.primitive]),"count"in ur&&(ie(typeof ur.count=="number"&&ur.count>=0,"invalid vertex count for elements"),lr=ur.count|0),"type"in ur&&(ie.parameter(ur.type,pt,"invalid buffer type"),Rn=pt[ur.type]),"length"in ur?Vr=ur.length|0:(Vr=lr,Rn===Gs||Rn===el?Vr*=2:(Rn===ks||Rn===Fu)&&(Vr*=4))),Mr(br,Jr,vr,qr,lr,Vr,Rn)}return Wr}return Wr(Or),Wr._reglType="elements",Wr._elements=br,Wr.subdata=function(ur,Jr){return Zt.subdata(ur,Jr),Wr},Wr.destroy=function(){kr(br)},Wr}return{create:fr,createStream:Pr,destroyStream:xr,getElements:function(Or){return typeof Or=="function"&&Or._elements instanceof mr?Or._elements:null},clear:function(){Yi($t).forEach(kr)}}}var $i=new Float32Array(1),ip=new Uint32Array($i.buffer),ih=5123;function Oh(F){for(var le=wt.allocType(ih,F.length),De=0;De<F.length;++De)if(isNaN(F[De]))le[De]=65535;else if(F[De]===1/0)le[De]=31744;else if(F[De]===-1/0)le[De]=64512;else{$i[0]=F[De];var At=ip[0],$t=At>>>31<<15,Ct=(At<<1>>>24)-127,pt=At>>13&1023;if(Ct<-24)le[De]=$t;else if(Ct<-14){var mr=-14-Ct;le[De]=$t+(pt+1024>>mr)}else Ct>15?le[De]=$t+31744:le[De]=$t+(Ct+15<<10)+pt}return le}function Fo(F){return Array.isArray(F)||Gt(F)}var Ph=function(F){return!(F&F-1)&&!!F},vf=34467,us=3553,Uu=34067,Tu=34069,rl=6408,oh=6406,Gl=6407,su=6409,Ec=6410,nl=32854,ku=32855,Lh=36194,Tc=32819,Kn=32820,ah=33635,gf=34042,zu=6402,Yl=34041,Dh=35904,Mi=35906,la=36193,Sa=33776,As=33777,Al=33778,il=33779,Sl=35986,Ac=35987,ql=34798,Ys=35840,sh=35841,_f=35842,yf=35843,ol=36196,Xo=5121,al=5123,Kl=5125,wl=5126,op=10242,uh=10243,Sc=10497,sl=33071,Bh=33648,wc=10240,Fh=10241,Cc=9728,Nh=9729,$l=9984,Ql=9985,Cl=9986,mo=9987,lh=33170,Au=4352,Rl=4353,yi=4354,ho=34046,ls=3317,No=37440,Vu=37441,Rc=37443,xf=37444,Ic=33984,ch=[$l,Cl,Ql,mo],Zu=[0,su,Ec,Gl,rl],Wo={};Wo[su]=Wo[oh]=Wo[zu]=1,Wo[Yl]=Wo[Ec]=2,Wo[Gl]=Wo[Dh]=3,Wo[rl]=Wo[Mi]=4;function Io(F){return"[object "+F+"]"}var Jl=Io("HTMLCanvasElement"),Uh=Io("OffscreenCanvas"),Go=Io("CanvasRenderingContext2D"),Hr=Io("ImageBitmap"),Ss=Io("HTMLImageElement"),hh=Io("HTMLVideoElement"),Mc=Object.keys(dn).concat([Jl,Uh,Go,Hr,Ss,hh]),Qa=[];Qa[Xo]=1,Qa[wl]=4,Qa[la]=2,Qa[al]=2,Qa[Kl]=4;var io=[];io[nl]=2,io[ku]=2,io[Lh]=2,io[Yl]=4,io[Sa]=.5,io[As]=.5,io[Al]=1,io[il]=1,io[Sl]=.5,io[Ac]=1,io[ql]=1,io[Ys]=.5,io[sh]=.25,io[_f]=.5,io[yf]=.25,io[ol]=.5;function ec(F){return Array.isArray(F)&&(F.length===0||typeof F[0]=="number")}function zr(F){if(!Array.isArray(F))return!1;var le=F.length;return!(le===0||!Fo(F[0]))}function qs(F){return Object.prototype.toString.call(F)}function Oc(F){return qs(F)===Jl}function Pc(F){return qs(F)===Uh}function Ks(F){return qs(F)===Go}function cs(F){return qs(F)===Hr}function kh(F){return qs(F)===Ss}function fh(F){return qs(F)===hh}function hs(F){if(!F)return!1;var le=qs(F);return Mc.indexOf(le)>=0?!0:ec(F)||zr(F)||Bo(F)}function Ja(F){return dn[Object.prototype.toString.call(F)]|0}function bf(F,le){var De=le.length;switch(F.type){case Xo:case al:case Kl:case wl:var At=wt.allocType(F.type,De);At.set(le),F.data=At;break;case la:F.data=Oh(le);break;default:ie.raise("unsupported texture type, must specify a typed array")}}function tc(F,le){return wt.allocType(F.type===la?wl:F.type,le)}function zh(F,le){F.type===la?(F.data=Oh(le),wt.freeType(le)):F.data=le}function Ef(F,le,De,At,$t,Ct){for(var pt=F.width,mr=F.height,dr=F.channels,Pr=pt*mr*dr,xr=tc(F,Pr),Mr=0,kr=0;kr<mr;++kr)for(var fr=0;fr<pt;++fr)for(var Or=0;Or<dr;++Or)xr[Mr++]=le[De*fr+At*kr+$t*Or+Ct];zh(F,xr)}function ws(F,le,De,At,$t,Ct){var pt;if(typeof io[F]!="undefined"?pt=io[F]:pt=Wo[F]*Qa[le],Ct&&(pt*=6),$t){for(var mr=0,dr=De;dr>=1;)mr+=pt*dr*dr,dr/=2;return mr}else return pt*De*At}function $s(F,le,De,At,$t,Ct,pt){var mr={"don't care":Au,"dont care":Au,nice:yi,fast:Rl},dr={repeat:Sc,clamp:sl,mirror:Bh},Pr={nearest:Cc,linear:Nh},xr=H({mipmap:mo,"nearest mipmap nearest":$l,"linear mipmap nearest":Ql,"nearest mipmap linear":Cl,"linear mipmap linear":mo},Pr),Mr={none:0,browser:xf},kr={uint8:Xo,rgba4:Tc,rgb565:ah,"rgb5 a1":Kn},fr={alpha:oh,luminance:su,"luminance alpha":Ec,rgb:Gl,rgba:rl,rgba4:nl,"rgb5 a1":ku,rgb565:Lh},Or={};le.ext_srgb&&(fr.srgb=Dh,fr.srgba=Mi),le.oes_texture_float&&(kr.float32=kr.float=wl),le.oes_texture_half_float&&(kr.float16=kr["half float"]=la),le.webgl_depth_texture&&(H(fr,{depth:zu,"depth stencil":Yl}),H(kr,{uint16:al,uint32:Kl,"depth stencil":gf})),le.webgl_compressed_texture_s3tc&&H(Or,{"rgb s3tc dxt1":Sa,"rgba s3tc dxt1":As,"rgba s3tc dxt3":Al,"rgba s3tc dxt5":il}),le.webgl_compressed_texture_atc&&H(Or,{"rgb atc":Sl,"rgba atc explicit alpha":Ac,"rgba atc interpolated alpha":ql}),le.webgl_compressed_texture_pvrtc&&H(Or,{"rgb pvrtc 4bppv1":Ys,"rgb pvrtc 2bppv1":sh,"rgba pvrtc 4bppv1":_f,"rgba pvrtc 2bppv1":yf}),le.webgl_compressed_texture_etc1&&(Or["rgb etc1"]=ol);var lt=Array.prototype.slice.call(F.getParameter(vf));Object.keys(Or).forEach(function(Ae){var Dt=Or[Ae];lt.indexOf(Dt)>=0&&(fr[Ae]=Dt)});var Zt=Object.keys(fr);De.textureFormats=Zt;var br=[];Object.keys(fr).forEach(function(Ae){var Dt=fr[Ae];br[Dt]=Ae});var Wr=[];Object.keys(kr).forEach(function(Ae){var Dt=kr[Ae];Wr[Dt]=Ae});var ur=[];Object.keys(Pr).forEach(function(Ae){var Dt=Pr[Ae];ur[Dt]=Ae});var Jr=[];Object.keys(xr).forEach(function(Ae){var Dt=xr[Ae];Jr[Dt]=Ae});var vr=[];Object.keys(dr).forEach(function(Ae){var Dt=dr[Ae];vr[Dt]=Ae});var qr=Zt.reduce(function(Ae,Dt){var vt=fr[Dt];return vt===su||vt===oh||vt===su||vt===Ec||vt===zu||vt===Yl||le.ext_srgb&&(vt===Dh||vt===Mi)?Ae[vt]=vt:vt===ku||Dt.indexOf("rgba")>=0?Ae[vt]=rl:Ae[vt]=Gl,Ae},{});function lr(){this.internalformat=rl,this.format=rl,this.type=Xo,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=xf,this.width=0,this.height=0,this.channels=0}function Vr(Ae,Dt){Ae.internalformat=Dt.internalformat,Ae.format=Dt.format,Ae.type=Dt.type,Ae.compressed=Dt.compressed,Ae.premultiplyAlpha=Dt.premultiplyAlpha,Ae.flipY=Dt.flipY,Ae.unpackAlignment=Dt.unpackAlignment,Ae.colorSpace=Dt.colorSpace,Ae.width=Dt.width,Ae.height=Dt.height,Ae.channels=Dt.channels}function Rn(Ae,Dt){if(!(typeof Dt!="object"||!Dt)){if("premultiplyAlpha"in Dt&&(ie.type(Dt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ae.premultiplyAlpha=Dt.premultiplyAlpha),"flipY"in Dt&&(ie.type(Dt.flipY,"boolean","invalid texture flip"),Ae.flipY=Dt.flipY),"alignment"in Dt&&(ie.oneOf(Dt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ae.unpackAlignment=Dt.alignment),"colorSpace"in Dt&&(ie.parameter(Dt.colorSpace,Mr,"invalid colorSpace"),Ae.colorSpace=Mr[Dt.colorSpace]),"type"in Dt){var vt=Dt.type;ie(le.oes_texture_float||!(vt==="float"||vt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ie(le.oes_texture_half_float||!(vt==="half float"||vt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ie(le.webgl_depth_texture||!(vt==="uint16"||vt==="uint32"||vt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(vt,kr,"invalid texture type"),Ae.type=kr[vt]}var on=Ae.width,ci=Ae.height,ao=Ae.channels,J=!1;"shape"in Dt?(ie(Array.isArray(Dt.shape)&&Dt.shape.length>=2,"shape must be an array"),on=Dt.shape[0],ci=Dt.shape[1],Dt.shape.length===3&&(ao=Dt.shape[2],ie(ao>0&&ao<=4,"invalid number of channels"),J=!0),ie(on>=0&&on<=De.maxTextureSize,"invalid width"),ie(ci>=0&&ci<=De.maxTextureSize,"invalid height")):("radius"in Dt&&(on=ci=Dt.radius,ie(on>=0&&on<=De.maxTextureSize,"invalid radius")),"width"in Dt&&(on=Dt.width,ie(on>=0&&on<=De.maxTextureSize,"invalid width")),"height"in Dt&&(ci=Dt.height,ie(ci>=0&&ci<=De.maxTextureSize,"invalid height")),"channels"in Dt&&(ao=Dt.channels,ie(ao>0&&ao<=4,"invalid number of channels"),J=!0)),Ae.width=on|0,Ae.height=ci|0,Ae.channels=ao|0;var fe=!1;if("format"in Dt){var Be=Dt.format;ie(le.webgl_depth_texture||!(Be==="depth"||Be==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(Be,fr,"invalid texture format");var mt=Ae.internalformat=fr[Be];Ae.format=qr[mt],Be in kr&&("type"in Dt||(Ae.type=kr[Be])),Be in Or&&(Ae.compressed=!0),fe=!0}!J&&fe?Ae.channels=Wo[Ae.format]:J&&!fe?Ae.channels!==Zu[Ae.format]&&(Ae.format=Ae.internalformat=Zu[Ae.channels]):fe&&J&&ie(Ae.channels===Wo[Ae.format],"number of channels inconsistent with specified format")}}function Gn(Ae){F.pixelStorei(No,Ae.flipY),F.pixelStorei(Vu,Ae.premultiplyAlpha),F.pixelStorei(Rc,Ae.colorSpace),F.pixelStorei(ls,Ae.unpackAlignment)}function Zr(){lr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function gr(Ae,Dt){var vt=null;if(hs(Dt)?vt=Dt:Dt&&(ie.type(Dt,"object","invalid pixel data type"),Rn(Ae,Dt),"x"in Dt&&(Ae.xOffset=Dt.x|0),"y"in Dt&&(Ae.yOffset=Dt.y|0),hs(Dt.data)&&(vt=Dt.data)),ie(!Ae.compressed||vt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Dt.copy){ie(!vt,"can not specify copy and data field for the same texture");var on=$t.viewportWidth,ci=$t.viewportHeight;Ae.width=Ae.width||on-Ae.xOffset,Ae.height=Ae.height||ci-Ae.yOffset,Ae.needsCopy=!0,ie(Ae.xOffset>=0&&Ae.xOffset<on&&Ae.yOffset>=0&&Ae.yOffset<ci&&Ae.width>0&&Ae.width<=on&&Ae.height>0&&Ae.height<=ci,"copy texture read out of bounds")}else if(!vt)Ae.width=Ae.width||1,Ae.height=Ae.height||1,Ae.channels=Ae.channels||4;else if(Gt(vt))Ae.channels=Ae.channels||4,Ae.data=vt,!("type"in Dt)&&Ae.type===Xo&&(Ae.type=Ja(vt));else if(ec(vt))Ae.channels=Ae.channels||4,bf(Ae,vt),Ae.alignment=1,Ae.needsFree=!0;else if(Bo(vt)){var ao=vt.data;!Array.isArray(ao)&&Ae.type===Xo&&(Ae.type=Ja(ao));var J=vt.shape,fe=vt.stride,Be,mt,dt,Xe,Ye,Qe;J.length===3?(dt=J[2],Qe=fe[2]):(ie(J.length===2,"invalid ndarray pixel data, must be 2 or 3D"),dt=1,Qe=1),Be=J[0],mt=J[1],Xe=fe[0],Ye=fe[1],Ae.alignment=1,Ae.width=Be,Ae.height=mt,Ae.channels=dt,Ae.format=Ae.internalformat=Zu[dt],Ae.needsFree=!0,Ef(Ae,ao,Xe,Ye,Qe,vt.offset)}else if(Oc(vt)||Pc(vt)||Ks(vt))Oc(vt)||Pc(vt)?Ae.element=vt:Ae.element=vt.canvas,Ae.width=Ae.element.width,Ae.height=Ae.element.height,Ae.channels=4;else if(cs(vt))Ae.element=vt,Ae.width=vt.width,Ae.height=vt.height,Ae.channels=4;else if(kh(vt))Ae.element=vt,Ae.width=vt.naturalWidth,Ae.height=vt.naturalHeight,Ae.channels=4;else if(fh(vt))Ae.element=vt,Ae.width=vt.videoWidth,Ae.height=vt.videoHeight,Ae.channels=4;else if(zr(vt)){var Ee=Ae.width||vt[0].length,We=Ae.height||vt.length,ue=Ae.channels;Fo(vt[0][0])?ue=ue||vt[0][0].length:ue=ue||1;for(var He=$a.shape(vt),Et=1,kt=0;kt<He.length;++kt)Et*=He[kt];var hr=tc(Ae,Et);$a.flatten(vt,He,"",hr),zh(Ae,hr),Ae.alignment=1,Ae.width=Ee,Ae.height=We,Ae.channels=ue,Ae.format=Ae.internalformat=Zu[ue],Ae.needsFree=!0}Ae.type===wl?ie(De.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ae.type===la&&ie(De.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function _e(Ae,Dt,vt){var on=Ae.element,ci=Ae.data,ao=Ae.internalformat,J=Ae.format,fe=Ae.type,Be=Ae.width,mt=Ae.height;Gn(Ae),on?F.texImage2D(Dt,vt,J,J,fe,on):Ae.compressed?F.compressedTexImage2D(Dt,vt,ao,Be,mt,0,ci):Ae.needsCopy?(At(),F.copyTexImage2D(Dt,vt,J,Ae.xOffset,Ae.yOffset,Be,mt,0)):F.texImage2D(Dt,vt,J,Be,mt,0,J,fe,ci||null)}function D(Ae,Dt,vt,on,ci){var ao=Ae.element,J=Ae.data,fe=Ae.internalformat,Be=Ae.format,mt=Ae.type,dt=Ae.width,Xe=Ae.height;Gn(Ae),ao?F.texSubImage2D(Dt,ci,vt,on,Be,mt,ao):Ae.compressed?F.compressedTexSubImage2D(Dt,ci,vt,on,fe,dt,Xe,J):Ae.needsCopy?(At(),F.copyTexSubImage2D(Dt,ci,vt,on,Ae.xOffset,Ae.yOffset,dt,Xe)):F.texSubImage2D(Dt,ci,vt,on,dt,Xe,Be,mt,J)}var ni=[];function O(){return ni.pop()||new Zr}function li(Ae){Ae.needsFree&&wt.freeType(Ae.data),Zr.call(Ae),ni.push(Ae)}function Xn(){lr.call(this),this.genMipmaps=!1,this.mipmapHint=Au,this.mipmask=0,this.images=Array(16)}function Un(Ae,Dt,vt){var on=Ae.images[0]=O();Ae.mipmask=1,on.width=Ae.width=Dt,on.height=Ae.height=vt,on.channels=Ae.channels=4}function Fi(Ae,Dt){var vt=null;if(hs(Dt))vt=Ae.images[0]=O(),Vr(vt,Ae),gr(vt,Dt),Ae.mipmask=1;else if(Rn(Ae,Dt),Array.isArray(Dt.mipmap))for(var on=Dt.mipmap,ci=0;ci<on.length;++ci)vt=Ae.images[ci]=O(),Vr(vt,Ae),vt.width>>=ci,vt.height>>=ci,gr(vt,on[ci]),Ae.mipmask|=1<<ci;else vt=Ae.images[0]=O(),Vr(vt,Ae),gr(vt,Dt),Ae.mipmask=1;Vr(Ae,Ae.images[0]),Ae.compressed&&(Ae.internalformat===Sa||Ae.internalformat===As||Ae.internalformat===Al||Ae.internalformat===il)&&ie(Ae.width%4===0&&Ae.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function fo(Ae,Dt){for(var vt=Ae.images,on=0;on<vt.length;++on){if(!vt[on])return;_e(vt[on],Dt,on)}}var Za=[];function _i(){var Ae=Za.pop()||new Xn;lr.call(Ae),Ae.mipmask=0;for(var Dt=0;Dt<16;++Dt)Ae.images[Dt]=null;return Ae}function ta(Ae){for(var Dt=Ae.images,vt=0;vt<Dt.length;++vt)Dt[vt]&&li(Dt[vt]),Dt[vt]=null;Za.push(Ae)}function oo(){this.minFilter=Cc,this.magFilter=Cc,this.wrapS=sl,this.wrapT=sl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Au}function ha(Ae,Dt){if("min"in Dt){var vt=Dt.min;ie.parameter(vt,xr),Ae.minFilter=xr[vt],ch.indexOf(Ae.minFilter)>=0&&!("faces"in Dt)&&(Ae.genMipmaps=!0)}if("mag"in Dt){var on=Dt.mag;ie.parameter(on,Pr),Ae.magFilter=Pr[on]}var ci=Ae.wrapS,ao=Ae.wrapT;if("wrap"in Dt){var J=Dt.wrap;typeof J=="string"?(ie.parameter(J,dr),ci=ao=dr[J]):Array.isArray(J)&&(ie.parameter(J[0],dr),ie.parameter(J[1],dr),ci=dr[J[0]],ao=dr[J[1]])}else{if("wrapS"in Dt){var fe=Dt.wrapS;ie.parameter(fe,dr),ci=dr[fe]}if("wrapT"in Dt){var Be=Dt.wrapT;ie.parameter(Be,dr),ao=dr[Be]}}if(Ae.wrapS=ci,Ae.wrapT=ao,"anisotropic"in Dt){var mt=Dt.anisotropic;ie(typeof mt=="number"&&mt>=1&&mt<=De.maxAnisotropic,"aniso samples must be between 1 and "),Ae.anisotropic=Dt.anisotropic}if("mipmap"in Dt){var dt=!1;switch(typeof Dt.mipmap){case"string":ie.parameter(Dt.mipmap,mr,"invalid mipmap hint"),Ae.mipmapHint=mr[Dt.mipmap],Ae.genMipmaps=!0,dt=!0;break;case"boolean":dt=Ae.genMipmaps=Dt.mipmap;break;case"object":ie(Array.isArray(Dt.mipmap),"invalid mipmap type"),Ae.genMipmaps=!1,dt=!0;break;default:ie.raise("invalid mipmap type")}dt&&!("min"in Dt)&&(Ae.minFilter=$l)}}function ya(Ae,Dt){F.texParameteri(Dt,Fh,Ae.minFilter),F.texParameteri(Dt,wc,Ae.magFilter),F.texParameteri(Dt,op,Ae.wrapS),F.texParameteri(Dt,uh,Ae.wrapT),le.ext_texture_filter_anisotropic&&F.texParameteri(Dt,ho,Ae.anisotropic),Ae.genMipmaps&&(F.hint(lh,Ae.mipmapHint),F.generateMipmap(Dt))}var qo=0,xa={},os=De.maxTextureUnits,Ra=Array(os).map(function(){return null});function ai(Ae){lr.call(this),this.mipmask=0,this.internalformat=rl,this.id=qo++,this.refCount=1,this.target=Ae,this.texture=F.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new oo,pt.profile&&(this.stats={size:0})}function as(Ae){F.activeTexture(Ic),F.bindTexture(Ae.target,Ae.texture)}function Zi(){var Ae=Ra[0];Ae?F.bindTexture(Ae.target,Ae.texture):F.bindTexture(us,null)}function Ln(Ae){var Dt=Ae.texture;ie(Dt,"must not double destroy texture");var vt=Ae.unit,on=Ae.target;vt>=0&&(F.activeTexture(Ic+vt),F.bindTexture(on,null),Ra[vt]=null),F.deleteTexture(Dt),Ae.texture=null,Ae.params=null,Ae.pixels=null,Ae.refCount=0,delete xa[Ae.id],Ct.textureCount--}H(ai.prototype,{bind:function(){var Ae=this;Ae.bindCount+=1;var Dt=Ae.unit;if(Dt<0){for(var vt=0;vt<os;++vt){var on=Ra[vt];if(on){if(on.bindCount>0)continue;on.unit=-1}Ra[vt]=Ae,Dt=vt;break}Dt>=os&&ie.raise("insufficient number of texture units"),pt.profile&&Ct.maxTextureUnits<Dt+1&&(Ct.maxTextureUnits=Dt+1),Ae.unit=Dt,F.activeTexture(Ic+Dt),F.bindTexture(Ae.target,Ae.texture)}return Dt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ln(this)}});function xi(Ae,Dt){var vt=new ai(us);xa[vt.id]=vt,Ct.textureCount++;function on(J,fe){var Be=vt.texInfo;oo.call(Be);var mt=_i();return typeof J=="number"?typeof fe=="number"?Un(mt,J|0,fe|0):Un(mt,J|0,J|0):J?(ie.type(J,"object","invalid arguments to regl.texture"),ha(Be,J),Fi(mt,J)):Un(mt,1,1),Be.genMipmaps&&(mt.mipmask=(mt.width<<1)-1),vt.mipmask=mt.mipmask,Vr(vt,mt),ie.texture2D(Be,mt,De),vt.internalformat=mt.internalformat,on.width=mt.width,on.height=mt.height,as(vt),fo(mt,us),ya(Be,us),Zi(),ta(mt),pt.profile&&(vt.stats.size=ws(vt.internalformat,vt.type,mt.width,mt.height,Be.genMipmaps,!1)),on.format=br[vt.internalformat],on.type=Wr[vt.type],on.mag=ur[Be.magFilter],on.min=Jr[Be.minFilter],on.wrapS=vr[Be.wrapS],on.wrapT=vr[Be.wrapT],on}function ci(J,fe,Be,mt){ie(!!J,"must specify image data");var dt=fe|0,Xe=Be|0,Ye=mt|0,Qe=O();return Vr(Qe,vt),Qe.width=0,Qe.height=0,gr(Qe,J),Qe.width=Qe.width||(vt.width>>Ye)-dt,Qe.height=Qe.height||(vt.height>>Ye)-Xe,ie(vt.type===Qe.type&&vt.format===Qe.format&&vt.internalformat===Qe.internalformat,"incompatible format for texture.subimage"),ie(dt>=0&&Xe>=0&&dt+Qe.width<=vt.width&&Xe+Qe.height<=vt.height,"texture.subimage write out of bounds"),ie(vt.mipmask&1<<Ye,"missing mipmap data"),ie(Qe.data||Qe.element||Qe.needsCopy,"missing image data"),as(vt),D(Qe,us,dt,Xe,Ye),Zi(),li(Qe),on}function ao(J,fe){var Be=J|0,mt=fe|0||Be;if(Be===vt.width&&mt===vt.height)return on;on.width=vt.width=Be,on.height=vt.height=mt,as(vt);for(var dt=0;vt.mipmask>>dt;++dt){var Xe=Be>>dt,Ye=mt>>dt;if(!Xe||!Ye)break;F.texImage2D(us,dt,vt.format,Xe,Ye,0,vt.format,vt.type,null)}return Zi(),pt.profile&&(vt.stats.size=ws(vt.internalformat,vt.type,Be,mt,!1,!1)),on}return on(Ae,Dt),on.subimage=ci,on.resize=ao,on._reglType="texture2d",on._texture=vt,pt.profile&&(on.stats=vt.stats),on.destroy=function(){vt.decRef()},on}function Ni(Ae,Dt,vt,on,ci,ao){var J=new ai(Uu);xa[J.id]=J,Ct.cubeCount++;var fe=new Array(6);function Be(Xe,Ye,Qe,Ee,We,ue){var He,Et=J.texInfo;for(oo.call(Et),He=0;He<6;++He)fe[He]=_i();if(typeof Xe=="number"||!Xe){var kt=Xe|0||1;for(He=0;He<6;++He)Un(fe[He],kt,kt)}else if(typeof Xe=="object")if(Ye)Fi(fe[0],Xe),Fi(fe[1],Ye),Fi(fe[2],Qe),Fi(fe[3],Ee),Fi(fe[4],We),Fi(fe[5],ue);else if(ha(Et,Xe),Rn(J,Xe),"faces"in Xe){var hr=Xe.faces;for(ie(Array.isArray(hr)&&hr.length===6,"cube faces must be a length 6 array"),He=0;He<6;++He)ie(typeof hr[He]=="object"&&!!hr[He],"invalid input for cube map face"),Vr(fe[He],J),Fi(fe[He],hr[He])}else for(He=0;He<6;++He)Fi(fe[He],Xe);else ie.raise("invalid arguments to cube map");for(Vr(J,fe[0]),De.npotTextureCube||ie(Ph(J.width)&&Ph(J.height),"your browser does not support non power or two texture dimensions"),Et.genMipmaps?J.mipmask=(fe[0].width<<1)-1:J.mipmask=fe[0].mipmask,ie.textureCube(J,Et,fe,De),J.internalformat=fe[0].internalformat,Be.width=fe[0].width,Be.height=fe[0].height,as(J),He=0;He<6;++He)fo(fe[He],Tu+He);for(ya(Et,Uu),Zi(),pt.profile&&(J.stats.size=ws(J.internalformat,J.type,Be.width,Be.height,Et.genMipmaps,!0)),Be.format=br[J.internalformat],Be.type=Wr[J.type],Be.mag=ur[Et.magFilter],Be.min=Jr[Et.minFilter],Be.wrapS=vr[Et.wrapS],Be.wrapT=vr[Et.wrapT],He=0;He<6;++He)ta(fe[He]);return Be}function mt(Xe,Ye,Qe,Ee,We){ie(!!Ye,"must specify image data"),ie(typeof Xe=="number"&&Xe===(Xe|0)&&Xe>=0&&Xe<6,"invalid face");var ue=Qe|0,He=Ee|0,Et=We|0,kt=O();return Vr(kt,J),kt.width=0,kt.height=0,gr(kt,Ye),kt.width=kt.width||(J.width>>Et)-ue,kt.height=kt.height||(J.height>>Et)-He,ie(J.type===kt.type&&J.format===kt.format&&J.internalformat===kt.internalformat,"incompatible format for texture.subimage"),ie(ue>=0&&He>=0&&ue+kt.width<=J.width&&He+kt.height<=J.height,"texture.subimage write out of bounds"),ie(J.mipmask&1<<Et,"missing mipmap data"),ie(kt.data||kt.element||kt.needsCopy,"missing image data"),as(J),D(kt,Tu+Xe,ue,He,Et),Zi(),li(kt),Be}function dt(Xe){var Ye=Xe|0;if(Ye!==J.width){Be.width=J.width=Ye,Be.height=J.height=Ye,as(J);for(var Qe=0;Qe<6;++Qe)for(var Ee=0;J.mipmask>>Ee;++Ee)F.texImage2D(Tu+Qe,Ee,J.format,Ye>>Ee,Ye>>Ee,0,J.format,J.type,null);return Zi(),pt.profile&&(J.stats.size=ws(J.internalformat,J.type,Be.width,Be.height,!1,!0)),Be}}return Be(Ae,Dt,vt,on,ci,ao),Be.subimage=mt,Be.resize=dt,Be._reglType="textureCube",Be._texture=J,pt.profile&&(Be.stats=J.stats),Be.destroy=function(){J.decRef()},Be}function ba(){for(var Ae=0;Ae<os;++Ae)F.activeTexture(Ic+Ae),F.bindTexture(us,null),Ra[Ae]=null;Yi(xa).forEach(Ln),Ct.cubeCount=0,Ct.textureCount=0}pt.profile&&(Ct.getTotalTextureSize=function(){var Ae=0;return Object.keys(xa).forEach(function(Dt){Ae+=xa[Dt].stats.size}),Ae});function Yu(){for(var Ae=0;Ae<os;++Ae){var Dt=Ra[Ae];Dt&&(Dt.bindCount=0,Dt.unit=-1,Ra[Ae]=null)}Yi(xa).forEach(function(vt){vt.texture=F.createTexture(),F.bindTexture(vt.target,vt.texture);for(var on=0;on<32;++on)if(vt.mipmask&1<<on)if(vt.target===us)F.texImage2D(us,on,vt.internalformat,vt.width>>on,vt.height>>on,0,vt.internalformat,vt.type,null);else for(var ci=0;ci<6;++ci)F.texImage2D(Tu+ci,on,vt.internalformat,vt.width>>on,vt.height>>on,0,vt.internalformat,vt.type,null);ya(vt.texInfo,vt.target)})}return{create2D:xi,createCube:Ni,clear:ba,getTexture:function(Ae){return null},restore:Yu}}var $n=36161,zs=32854,Vs=32855,da=36194,Il=33189,ju=36168,Qs=34041,es=35907,rc=34836,bn=34842,ln=34843,fs=[];fs[zs]=2,fs[Vs]=2,fs[da]=2,fs[Il]=2,fs[ju]=1,fs[Qs]=4,fs[es]=4,fs[rc]=16,fs[bn]=8,fs[ln]=6;function Ga(F,le,De){return fs[F]*le*De}var uu=function(F,le,De,At,$t){var Ct={rgba4:zs,rgb565:da,"rgb5 a1":Vs,depth:Il,stencil:ju,"depth stencil":Qs};le.ext_srgb&&(Ct.srgba=es),le.ext_color_buffer_half_float&&(Ct.rgba16f=bn,Ct.rgb16f=ln),le.webgl_color_buffer_float&&(Ct.rgba32f=rc);var pt=[];Object.keys(Ct).forEach(function(fr){var Or=Ct[fr];pt[Or]=fr});var mr=0,dr={};function Pr(fr){this.id=mr++,this.refCount=1,this.renderbuffer=fr,this.format=zs,this.width=0,this.height=0,$t.profile&&(this.stats={size:0})}Pr.prototype.decRef=function(){--this.refCount<=0&&xr(this)};function xr(fr){var Or=fr.renderbuffer;ie(Or,"must not double destroy renderbuffer"),F.bindRenderbuffer($n,null),F.deleteRenderbuffer(Or),fr.renderbuffer=null,fr.refCount=0,delete dr[fr.id],At.renderbufferCount--}function Mr(fr,Or){var lt=new Pr(F.createRenderbuffer());dr[lt.id]=lt,At.renderbufferCount++;function Zt(Wr,ur){var Jr=0,vr=0,qr=zs;if(typeof Wr=="object"&&Wr){var lr=Wr;if("shape"in lr){var Vr=lr.shape;ie(Array.isArray(Vr)&&Vr.length>=2,"invalid renderbuffer shape"),Jr=Vr[0]|0,vr=Vr[1]|0}else"radius"in lr&&(Jr=vr=lr.radius|0),"width"in lr&&(Jr=lr.width|0),"height"in lr&&(vr=lr.height|0);"format"in lr&&(ie.parameter(lr.format,Ct,"invalid renderbuffer format"),qr=Ct[lr.format])}else typeof Wr=="number"?(Jr=Wr|0,typeof ur=="number"?vr=ur|0:vr=Jr):Wr?ie.raise("invalid arguments to renderbuffer constructor"):Jr=vr=1;if(ie(Jr>0&&vr>0&&Jr<=De.maxRenderbufferSize&&vr<=De.maxRenderbufferSize,"invalid renderbuffer size"),!(Jr===lt.width&&vr===lt.height&&qr===lt.format))return Zt.width=lt.width=Jr,Zt.height=lt.height=vr,lt.format=qr,F.bindRenderbuffer($n,lt.renderbuffer),F.renderbufferStorage($n,qr,Jr,vr),ie(F.getError()===0,"invalid render buffer format"),$t.profile&&(lt.stats.size=Ga(lt.format,lt.width,lt.height)),Zt.format=pt[lt.format],Zt}function br(Wr,ur){var Jr=Wr|0,vr=ur|0||Jr;return Jr===lt.width&&vr===lt.height||(ie(Jr>0&&vr>0&&Jr<=De.maxRenderbufferSize&&vr<=De.maxRenderbufferSize,"invalid renderbuffer size"),Zt.width=lt.width=Jr,Zt.height=lt.height=vr,F.bindRenderbuffer($n,lt.renderbuffer),F.renderbufferStorage($n,lt.format,Jr,vr),ie(F.getError()===0,"invalid render buffer format"),$t.profile&&(lt.stats.size=Ga(lt.format,lt.width,lt.height))),Zt}return Zt(fr,Or),Zt.resize=br,Zt._reglType="renderbuffer",Zt._renderbuffer=lt,$t.profile&&(Zt.stats=lt.stats),Zt.destroy=function(){lt.decRef()},Zt}$t.profile&&(At.getTotalRenderbufferSize=function(){var fr=0;return Object.keys(dr).forEach(function(Or){fr+=dr[Or].stats.size}),fr});function kr(){Yi(dr).forEach(function(fr){fr.renderbuffer=F.createRenderbuffer(),F.bindRenderbuffer($n,fr.renderbuffer),F.renderbufferStorage($n,fr.format,fr.width,fr.height)}),F.bindRenderbuffer($n,null)}return{create:Mr,clear:function(){Yi(dr).forEach(xr)},restore:kr}},xo=36160,Zs=36161,Su=3553,nc=34069,Vi=36064,ma=36096,Vh=36128,ul=33306,Lc=36053,Hu=36054,Cs=36055,ll=36057,lu=36061,Zh=36193,ic=5121,wa=5126,oc=6407,cu=6408,ka=6402,ph=[oc,cu],hu=[];hu[cu]=4,hu[oc]=3;var Rs=[];Rs[ic]=1,Rs[wa]=4,Rs[Zh]=2;var dh=32854,cl=32855,Js=36194,mh=33189,Ml=36168,jh=34041,Dc=35907,l=34836,h=34842,c=34843,d=[dh,cl,Js,Dc,h,c,l],x={};x[Lc]="complete",x[Hu]="incomplete attachment",x[ll]="incomplete dimensions",x[Cs]="incomplete, missing attachment",x[lu]="unsupported";function T(F,le,De,At,$t,Ct){var pt={cur:null,next:null,dirty:!1,setFBO:null},mr=["rgba"],dr=["rgba4","rgb565","rgb5 a1"];le.ext_srgb&&dr.push("srgba"),le.ext_color_buffer_half_float&&dr.push("rgba16f","rgb16f"),le.webgl_color_buffer_float&&dr.push("rgba32f");var Pr=["uint8"];le.oes_texture_half_float&&Pr.push("half float","float16"),le.oes_texture_float&&Pr.push("float","float32");function xr(Zr,gr,_e){this.target=Zr,this.texture=gr,this.renderbuffer=_e;var D=0,ni=0;gr?(D=gr.width,ni=gr.height):_e&&(D=_e.width,ni=_e.height),this.width=D,this.height=ni}function Mr(Zr){Zr&&(Zr.texture&&Zr.texture._texture.decRef(),Zr.renderbuffer&&Zr.renderbuffer._renderbuffer.decRef())}function kr(Zr,gr,_e){if(Zr)if(Zr.texture){var D=Zr.texture._texture,ni=Math.max(1,D.width),O=Math.max(1,D.height);ie(ni===gr&&O===_e,"inconsistent width/height for supplied texture"),D.refCount+=1}else{var li=Zr.renderbuffer._renderbuffer;ie(li.width===gr&&li.height===_e,"inconsistent width/height for renderbuffer"),li.refCount+=1}}function fr(Zr,gr){gr&&(gr.texture?F.framebufferTexture2D(xo,Zr,gr.target,gr.texture._texture.texture,0):F.framebufferRenderbuffer(xo,Zr,Zs,gr.renderbuffer._renderbuffer.renderbuffer))}function Or(Zr){var gr=Su,_e=null,D=null,ni=Zr;typeof Zr=="object"&&(ni=Zr.data,"target"in Zr&&(gr=Zr.target|0)),ie.type(ni,"function","invalid attachment data");var O=ni._reglType;return O==="texture2d"?(_e=ni,ie(gr===Su)):O==="textureCube"?(_e=ni,ie(gr>=nc&&gr<nc+6,"invalid cube map target")):O==="renderbuffer"?(D=ni,gr=Zs):ie.raise("invalid regl object for attachment"),new xr(gr,_e,D)}function lt(Zr,gr,_e,D,ni){if(_e){var O=At.create2D({width:Zr,height:gr,format:D,type:ni});return O._texture.refCount=0,new xr(Su,O,null)}else{var li=$t.create({width:Zr,height:gr,format:D});return li._renderbuffer.refCount=0,new xr(Zs,null,li)}}function Zt(Zr){return Zr&&(Zr.texture||Zr.renderbuffer)}function br(Zr,gr,_e){Zr&&(Zr.texture?Zr.texture.resize(gr,_e):Zr.renderbuffer&&Zr.renderbuffer.resize(gr,_e),Zr.width=gr,Zr.height=_e)}var Wr=0,ur={};function Jr(){this.id=Wr++,ur[this.id]=this,this.framebuffer=F.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function vr(Zr){Zr.colorAttachments.forEach(Mr),Mr(Zr.depthAttachment),Mr(Zr.stencilAttachment),Mr(Zr.depthStencilAttachment)}function qr(Zr){var gr=Zr.framebuffer;ie(gr,"must not double destroy framebuffer"),F.deleteFramebuffer(gr),Zr.framebuffer=null,Ct.framebufferCount--,delete ur[Zr.id]}function lr(Zr){var gr;F.bindFramebuffer(xo,Zr.framebuffer);var _e=Zr.colorAttachments;for(gr=0;gr<_e.length;++gr)fr(Vi+gr,_e[gr]);for(gr=_e.length;gr<De.maxColorAttachments;++gr)F.framebufferTexture2D(xo,Vi+gr,Su,null,0);F.framebufferTexture2D(xo,ul,Su,null,0),F.framebufferTexture2D(xo,ma,Su,null,0),F.framebufferTexture2D(xo,Vh,Su,null,0),fr(ma,Zr.depthAttachment),fr(Vh,Zr.stencilAttachment),fr(ul,Zr.depthStencilAttachment);var D=F.checkFramebufferStatus(xo);!F.isContextLost()&&D!==Lc&&ie.raise("framebuffer configuration not supported, status = "+x[D]),F.bindFramebuffer(xo,pt.next?pt.next.framebuffer:null),pt.cur=pt.next,F.getError()}function Vr(Zr,gr){var _e=new Jr;Ct.framebufferCount++;function D(O,li){var Xn;ie(pt.next!==_e,"can not update framebuffer which is currently in use");var Un=0,Fi=0,fo=!0,Za=!0,_i=null,ta=!0,oo="rgba",ha="uint8",ya=1,qo=null,xa=null,os=null,Ra=!1;if(typeof O=="number")Un=O|0,Fi=li|0||Un;else if(!O)Un=Fi=1;else{ie.type(O,"object","invalid arguments for framebuffer");var ai=O;if("shape"in ai){var as=ai.shape;ie(Array.isArray(as)&&as.length>=2,"invalid shape for framebuffer"),Un=as[0],Fi=as[1]}else"radius"in ai&&(Un=Fi=ai.radius),"width"in ai&&(Un=ai.width),"height"in ai&&(Fi=ai.height);("color"in ai||"colors"in ai)&&(_i=ai.color||ai.colors,Array.isArray(_i)&&ie(_i.length===1||le.webgl_draw_buffers,"multiple render targets not supported")),_i||("colorCount"in ai&&(ya=ai.colorCount|0,ie(ya>0,"invalid color buffer count")),"colorTexture"in ai&&(ta=!!ai.colorTexture,oo="rgba4"),"colorType"in ai&&(ha=ai.colorType,ta?(ie(le.oes_texture_float||!(ha==="float"||ha==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ie(le.oes_texture_half_float||!(ha==="half float"||ha==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ha==="half float"||ha==="float16"?(ie(le.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),oo="rgba16f"):(ha==="float"||ha==="float32")&&(ie(le.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),oo="rgba32f"),ie.oneOf(ha,Pr,"invalid color type")),"colorFormat"in ai&&(oo=ai.colorFormat,mr.indexOf(oo)>=0?ta=!0:dr.indexOf(oo)>=0?ta=!1:ta?ie.oneOf(ai.colorFormat,mr,"invalid color format for texture"):ie.oneOf(ai.colorFormat,dr,"invalid color format for renderbuffer"))),("depthTexture"in ai||"depthStencilTexture"in ai)&&(Ra=!!(ai.depthTexture||ai.depthStencilTexture),ie(!Ra||le.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ai&&(typeof ai.depth=="boolean"?fo=ai.depth:(qo=ai.depth,Za=!1)),"stencil"in ai&&(typeof ai.stencil=="boolean"?Za=ai.stencil:(xa=ai.stencil,fo=!1)),"depthStencil"in ai&&(typeof ai.depthStencil=="boolean"?fo=Za=ai.depthStencil:(os=ai.depthStencil,fo=!1,Za=!1))}var Zi=null,Ln=null,xi=null,Ni=null;if(Array.isArray(_i))Zi=_i.map(Or);else if(_i)Zi=[Or(_i)];else for(Zi=new Array(ya),Xn=0;Xn<ya;++Xn)Zi[Xn]=lt(Un,Fi,ta,oo,ha);ie(le.webgl_draw_buffers||Zi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ie(Zi.length<=De.maxColorAttachments,"too many color attachments, not supported"),Un=Un||Zi[0].width,Fi=Fi||Zi[0].height,qo?Ln=Or(qo):fo&&!Za&&(Ln=lt(Un,Fi,Ra,"depth","uint32")),xa?xi=Or(xa):Za&&!fo&&(xi=lt(Un,Fi,!1,"stencil","uint8")),os?Ni=Or(os):!qo&&!xa&&Za&&fo&&(Ni=lt(Un,Fi,Ra,"depth stencil","depth stencil")),ie(!!qo+!!xa+!!os<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ba=null;for(Xn=0;Xn<Zi.length;++Xn)if(kr(Zi[Xn],Un,Fi),ie(!Zi[Xn]||Zi[Xn].texture&&ph.indexOf(Zi[Xn].texture._texture.format)>=0||Zi[Xn].renderbuffer&&d.indexOf(Zi[Xn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Xn+" is invalid"),Zi[Xn]&&Zi[Xn].texture){var Yu=hu[Zi[Xn].texture._texture.format]*Rs[Zi[Xn].texture._texture.type];ba===null?ba=Yu:ie(ba===Yu,"all color attachments much have the same number of bits per pixel.")}return kr(Ln,Un,Fi),ie(!Ln||Ln.texture&&Ln.texture._texture.format===ka||Ln.renderbuffer&&Ln.renderbuffer._renderbuffer.format===mh,"invalid depth attachment for framebuffer object"),kr(xi,Un,Fi),ie(!xi||xi.renderbuffer&&xi.renderbuffer._renderbuffer.format===Ml,"invalid stencil attachment for framebuffer object"),kr(Ni,Un,Fi),ie(!Ni||Ni.texture&&Ni.texture._texture.format===jh||Ni.renderbuffer&&Ni.renderbuffer._renderbuffer.format===jh,"invalid depth-stencil attachment for framebuffer object"),vr(_e),_e.width=Un,_e.height=Fi,_e.colorAttachments=Zi,_e.depthAttachment=Ln,_e.stencilAttachment=xi,_e.depthStencilAttachment=Ni,D.color=Zi.map(Zt),D.depth=Zt(Ln),D.stencil=Zt(xi),D.depthStencil=Zt(Ni),D.width=_e.width,D.height=_e.height,lr(_e),D}function ni(O,li){ie(pt.next!==_e,"can not resize a framebuffer which is currently in use");var Xn=Math.max(O|0,1),Un=Math.max(li|0||Xn,1);if(Xn===_e.width&&Un===_e.height)return D;for(var Fi=_e.colorAttachments,fo=0;fo<Fi.length;++fo)br(Fi[fo],Xn,Un);return br(_e.depthAttachment,Xn,Un),br(_e.stencilAttachment,Xn,Un),br(_e.depthStencilAttachment,Xn,Un),_e.width=D.width=Xn,_e.height=D.height=Un,lr(_e),D}return D(Zr,gr),H(D,{resize:ni,_reglType:"framebuffer",_framebuffer:_e,destroy:function(){qr(_e),vr(_e)},use:function(O){pt.setFBO({framebuffer:D},O)}})}function Rn(Zr){var gr=Array(6);function _e(ni){var O;ie(gr.indexOf(pt.next)<0,"can not update framebuffer which is currently in use");var li={color:null},Xn=0,Un=null,Fi="rgba",fo="uint8",Za=1;if(typeof ni=="number")Xn=ni|0;else if(!ni)Xn=1;else{ie.type(ni,"object","invalid arguments for framebuffer");var _i=ni;if("shape"in _i){var ta=_i.shape;ie(Array.isArray(ta)&&ta.length>=2,"invalid shape for framebuffer"),ie(ta[0]===ta[1],"cube framebuffer must be square"),Xn=ta[0]}else"radius"in _i&&(Xn=_i.radius|0),"width"in _i?(Xn=_i.width|0,"height"in _i&&ie(_i.height===Xn,"must be square")):"height"in _i&&(Xn=_i.height|0);("color"in _i||"colors"in _i)&&(Un=_i.color||_i.colors,Array.isArray(Un)&&ie(Un.length===1||le.webgl_draw_buffers,"multiple render targets not supported")),Un||("colorCount"in _i&&(Za=_i.colorCount|0,ie(Za>0,"invalid color buffer count")),"colorType"in _i&&(ie.oneOf(_i.colorType,Pr,"invalid color type"),fo=_i.colorType),"colorFormat"in _i&&(Fi=_i.colorFormat,ie.oneOf(_i.colorFormat,mr,"invalid color format for texture"))),"depth"in _i&&(li.depth=_i.depth),"stencil"in _i&&(li.stencil=_i.stencil),"depthStencil"in _i&&(li.depthStencil=_i.depthStencil)}var oo;if(Un)if(Array.isArray(Un))for(oo=[],O=0;O<Un.length;++O)oo[O]=Un[O];else oo=[Un];else{oo=Array(Za);var ha={radius:Xn,format:Fi,type:fo};for(O=0;O<Za;++O)oo[O]=At.createCube(ha)}for(li.color=Array(oo.length),O=0;O<oo.length;++O){var ya=oo[O];ie(typeof ya=="function"&&ya._reglType==="textureCube","invalid cube map"),Xn=Xn||ya.width,ie(ya.width===Xn&&ya.height===Xn,"invalid cube map shape"),li.color[O]={target:nc,data:oo[O]}}for(O=0;O<6;++O){for(var qo=0;qo<oo.length;++qo)li.color[qo].target=nc+O;O>0&&(li.depth=gr[0].depth,li.stencil=gr[0].stencil,li.depthStencil=gr[0].depthStencil),gr[O]?gr[O](li):gr[O]=Vr(li)}return H(_e,{width:Xn,height:Xn,color:oo})}function D(ni){var O,li=ni|0;if(ie(li>0&&li<=De.maxCubeMapSize,"invalid radius for cube fbo"),li===_e.width)return _e;var Xn=_e.color;for(O=0;O<Xn.length;++O)Xn[O].resize(li);for(O=0;O<6;++O)gr[O].resize(li);return _e.width=_e.height=li,_e}return _e(Zr),H(_e,{faces:gr,resize:D,_reglType:"framebufferCube",destroy:function(){gr.forEach(function(ni){ni.destroy()})}})}function Gn(){pt.cur=null,pt.next=null,pt.dirty=!0,Yi(ur).forEach(function(Zr){Zr.framebuffer=F.createFramebuffer(),lr(Zr)})}return H(pt,{getFramebuffer:function(Zr){if(typeof Zr=="function"&&Zr._reglType==="framebuffer"){var gr=Zr._framebuffer;if(gr instanceof Jr)return gr}return null},create:Vr,createCube:Rn,clear:function(){Yi(ur).forEach(qr)},restore:Gn})}var S=5126,I=34962;function N(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=S,this.offset=0,this.stride=0,this.divisor=0}function j(F,le,De,At,$t){for(var Ct=De.maxAttributes,pt=new Array(Ct),mr=0;mr<Ct;++mr)pt[mr]=new N;var dr=0,Pr={},xr={Record:N,scope:{},state:pt,currentVAO:null,targetVAO:null,restore:kr()?ur:function(){},createVAO:Jr,getVAO:Or,destroyBuffer:Mr,setVAO:kr()?lt:Zt,clear:kr()?br:function(){}};function Mr(vr){for(var qr=0;qr<pt.length;++qr){var lr=pt[qr];lr.buffer===vr&&(F.disableVertexAttribArray(qr),lr.buffer=null)}}function kr(){return le.oes_vertex_array_object}function fr(){return le.angle_instanced_arrays}function Or(vr){return typeof vr=="function"&&vr._vao?vr._vao:null}function lt(vr){if(vr!==xr.currentVAO){var qr=kr();vr?qr.bindVertexArrayOES(vr.vao):qr.bindVertexArrayOES(null),xr.currentVAO=vr}}function Zt(vr){if(vr!==xr.currentVAO){if(vr)vr.bindAttrs();else for(var qr=fr(),lr=0;lr<pt.length;++lr){var Vr=pt[lr];Vr.buffer?(F.enableVertexAttribArray(lr),F.vertexAttribPointer(lr,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offfset),qr&&qr.vertexAttribDivisorANGLE(lr,Vr.divisor)):(F.disableVertexAttribArray(lr),F.vertexAttrib4f(lr,Vr.x,Vr.y,Vr.z,Vr.w))}xr.currentVAO=vr}}function br(){Yi(Pr).forEach(function(vr){vr.destroy()})}function Wr(){this.id=++dr,this.attributes=[];var vr=kr();vr?this.vao=vr.createVertexArrayOES():this.vao=null,Pr[this.id]=this,this.buffers=[]}Wr.prototype.bindAttrs=function(){for(var vr=fr(),qr=this.attributes,lr=0;lr<qr.length;++lr){var Vr=qr[lr];Vr.buffer?(F.enableVertexAttribArray(lr),F.bindBuffer(I,Vr.buffer.buffer),F.vertexAttribPointer(lr,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offset),vr&&vr.vertexAttribDivisorANGLE(lr,Vr.divisor)):(F.disableVertexAttribArray(lr),F.vertexAttrib4f(lr,Vr.x,Vr.y,Vr.z,Vr.w))}for(var Rn=qr.length;Rn<Ct;++Rn)F.disableVertexAttribArray(Rn)},Wr.prototype.refresh=function(){var vr=kr();vr&&(vr.bindVertexArrayOES(this.vao),this.bindAttrs(),xr.currentVAO=this)},Wr.prototype.destroy=function(){if(this.vao){var vr=kr();this===xr.currentVAO&&(xr.currentVAO=null,vr.bindVertexArrayOES(null)),vr.deleteVertexArrayOES(this.vao),this.vao=null}Pr[this.id]&&(delete Pr[this.id],At.vaoCount-=1)};function ur(){var vr=kr();vr&&Yi(Pr).forEach(function(qr){qr.refresh()})}function Jr(vr){var qr=new Wr;At.vaoCount+=1;function lr(Vr){ie(Array.isArray(Vr),"arguments to vertex array constructor must be an array"),ie(Vr.length<Ct,"too many attributes"),ie(Vr.length>0,"must specify at least one attribute");for(var Rn=0;Rn<qr.buffers.length;++Rn)qr.buffers[Rn].destroy();qr.buffers.length=0;var Gn=qr.attributes;Gn.length=Vr.length;for(var Zr=0;Zr<Vr.length;++Zr){var gr=Vr[Zr],_e=Gn[Zr]=new N;if(Array.isArray(gr)||Gt(gr)||Bo(gr)){var D=$t.create(gr,I,!1,!0);_e.buffer=$t.getBuffer(D),_e.size=_e.buffer.dimension|0,_e.normalized=!1,_e.type=_e.buffer.dtype,_e.offset=0,_e.stride=0,_e.divisor=0,_e.state=1,qr.buffers.push(D)}else $t.getBuffer(gr)?(_e.buffer=$t.getBuffer(gr),_e.size=_e.buffer.dimension|0,_e.normalized=!1,_e.type=_e.buffer.dtype,_e.offset=0,_e.stride=0,_e.divisor=0,_e.state=1):$t.getBuffer(gr.buffer)?(_e.buffer=$t.getBuffer(gr.buffer),_e.size=(+gr.size||_e.buffer.dimension)|0,_e.normalized=!!gr.normalized||!1,"type"in gr?(ie.parameter(gr.type,ti,"invalid buffer type"),_e.type=ti[gr.type]):_e.type=_e.buffer.dtype,_e.offset=(gr.offset||0)|0,_e.stride=(gr.stride||0)|0,_e.divisor=(gr.divisor||0)|0,_e.state=1,ie(_e.size>=1&&_e.size<=4,"size must be between 1 and 4"),ie(_e.offset>=0,"invalid offset"),ie(_e.stride>=0&&_e.stride<=255,"stride must be between 0 and 255"),ie(_e.divisor>=0,"divisor must be positive"),ie(!_e.divisor||!!le.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in gr?(ie(Zr>0,"first attribute must not be a constant"),_e.x=+gr.x||0,_e.y=+gr.y||0,_e.z=+gr.z||0,_e.w=+gr.w||0,_e.state=2):ie(!1,"invalid attribute spec for location "+Zr)}return qr.refresh(),lr}return lr.destroy=function(){qr.destroy()},lr._vao=qr,lr._reglType="vao",lr(vr)}return xr}var ne=35632,oe=35633,se=35718,we=35721;function be(F,le,De,At){var $t={},Ct={};function pt(lt,Zt,br,Wr){this.name=lt,this.id=Zt,this.location=br,this.info=Wr}function mr(lt,Zt){for(var br=0;br<lt.length;++br)if(lt[br].id===Zt.id){lt[br].location=Zt.location;return}lt.push(Zt)}function dr(lt,Zt,br){var Wr=lt===ne?$t:Ct,ur=Wr[Zt];if(!ur){var Jr=le.str(Zt);ur=F.createShader(lt),F.shaderSource(ur,Jr),F.compileShader(ur),ie.shaderError(F,ur,Jr,lt,br),Wr[Zt]=ur}return ur}var Pr={},xr=[],Mr=0;function kr(lt,Zt){this.id=Mr++,this.fragId=lt,this.vertId=Zt,this.program=null,this.uniforms=[],this.attributes=[],At.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function fr(lt,Zt,br){var Wr,ur,Jr=dr(ne,lt.fragId),vr=dr(oe,lt.vertId),qr=lt.program=F.createProgram();if(F.attachShader(qr,Jr),F.attachShader(qr,vr),br)for(Wr=0;Wr<br.length;++Wr){var lr=br[Wr];F.bindAttribLocation(qr,lr[0],lr[1])}F.linkProgram(qr),ie.linkError(F,qr,le.str(lt.fragId),le.str(lt.vertId),Zt);var Vr=F.getProgramParameter(qr,se);At.profile&&(lt.stats.uniformsCount=Vr);var Rn=lt.uniforms;for(Wr=0;Wr<Vr;++Wr)if(ur=F.getActiveUniform(qr,Wr),ur)if(ur.size>1)for(var Gn=0;Gn<ur.size;++Gn){var Zr=ur.name.replace("[0]","["+Gn+"]");mr(Rn,new pt(Zr,le.id(Zr),F.getUniformLocation(qr,Zr),ur))}else mr(Rn,new pt(ur.name,le.id(ur.name),F.getUniformLocation(qr,ur.name),ur));var gr=F.getProgramParameter(qr,we);At.profile&&(lt.stats.attributesCount=gr);var _e=lt.attributes;for(Wr=0;Wr<gr;++Wr)ur=F.getActiveAttrib(qr,Wr),ur&&mr(_e,new pt(ur.name,le.id(ur.name),F.getAttribLocation(qr,ur.name),ur))}At.profile&&(De.getMaxUniformsCount=function(){var lt=0;return xr.forEach(function(Zt){Zt.stats.uniformsCount>lt&&(lt=Zt.stats.uniformsCount)}),lt},De.getMaxAttributesCount=function(){var lt=0;return xr.forEach(function(Zt){Zt.stats.attributesCount>lt&&(lt=Zt.stats.attributesCount)}),lt});function Or(){$t={},Ct={};for(var lt=0;lt<xr.length;++lt)fr(xr[lt],null,xr[lt].attributes.map(function(Zt){return[Zt.location,Zt.name]}))}return{clear:function(){var lt=F.deleteShader.bind(F);Yi($t).forEach(lt),$t={},Yi(Ct).forEach(lt),Ct={},xr.forEach(function(Zt){F.deleteProgram(Zt.program)}),xr.length=0,Pr={},De.shaderCount=0},program:function(lt,Zt,br,Wr){ie.command(lt>=0,"missing vertex shader",br),ie.command(Zt>=0,"missing fragment shader",br);var ur=Pr[Zt];ur||(ur=Pr[Zt]={});var Jr=ur[lt];if(Jr&&!Wr)return Jr;var vr=new kr(Zt,lt);return De.shaderCount++,fr(vr,br,Wr),Jr||(ur[lt]=vr),xr.push(vr),vr},restore:Or,shader:dr,frag:-1,vert:-1}}var Ze=6408,ge=5121,Ve=3333,$e=5126;function ht(F,le,De,At,$t,Ct,pt){function mr(xr){var Mr;le.next===null?(ie($t.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Mr=ge):(ie(le.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Mr=le.next.colorAttachments[0].texture._texture.type,Ct.oes_texture_float?(ie(Mr===ge||Mr===$e,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Mr===$e&&ie(pt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ie(Mr===ge,"Reading from a framebuffer is only allowed for the type 'uint8'"));var kr=0,fr=0,Or=At.framebufferWidth,lt=At.framebufferHeight,Zt=null;Gt(xr)?Zt=xr:xr&&(ie.type(xr,"object","invalid arguments to regl.read()"),kr=xr.x|0,fr=xr.y|0,ie(kr>=0&&kr<At.framebufferWidth,"invalid x offset for regl.read"),ie(fr>=0&&fr<At.framebufferHeight,"invalid y offset for regl.read"),Or=(xr.width||At.framebufferWidth-kr)|0,lt=(xr.height||At.framebufferHeight-fr)|0,Zt=xr.data||null),Zt&&(Mr===ge?ie(Zt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Mr===$e&&ie(Zt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ie(Or>0&&Or+kr<=At.framebufferWidth,"invalid width for read pixels"),ie(lt>0&&lt+fr<=At.framebufferHeight,"invalid height for read pixels"),De();var br=Or*lt*4;return Zt||(Mr===ge?Zt=new Uint8Array(br):Mr===$e&&(Zt=Zt||new Float32Array(br))),ie.isTypedArray(Zt,"data buffer for regl.read() must be a typedarray"),ie(Zt.byteLength>=br,"data buffer for regl.read() too small"),F.pixelStorei(Ve,4),F.readPixels(kr,fr,Or,lt,Ze,Mr,Zt),Zt}function dr(xr){var Mr;return le.setFBO({framebuffer:xr.framebuffer},function(){Mr=mr(xr)}),Mr}function Pr(xr){return!xr||!("framebuffer"in xr)?mr(xr):dr(xr)}return Pr}function Lt(F){return Array.prototype.slice.call(F)}function Tt(F){return Lt(F).join("")}function jt(){var F=0,le=[],De=[];function At(Mr){for(var kr=0;kr<De.length;++kr)if(De[kr]===Mr)return le[kr];var fr="g"+F++;return le.push(fr),De.push(Mr),fr}function $t(){var Mr=[];function kr(){Mr.push.apply(Mr,Lt(arguments))}var fr=[];function Or(){var lt="v"+F++;return fr.push(lt),arguments.length>0&&(Mr.push(lt,"="),Mr.push.apply(Mr,Lt(arguments)),Mr.push(";")),lt}return H(kr,{def:Or,toString:function(){return Tt([fr.length>0?"var "+fr.join(",")+";":"",Tt(Mr)])}})}function Ct(){var Mr=$t(),kr=$t(),fr=Mr.toString,Or=kr.toString;function lt(Zt,br){kr(Zt,br,"=",Mr.def(Zt,br),";")}return H(function(){Mr.apply(Mr,Lt(arguments))},{def:Mr.def,entry:Mr,exit:kr,save:lt,set:function(Zt,br,Wr){lt(Zt,br),Mr(Zt,br,"=",Wr,";")},toString:function(){return fr()+Or()}})}function pt(){var Mr=Tt(arguments),kr=Ct(),fr=Ct(),Or=kr.toString,lt=fr.toString;return H(kr,{then:function(){return kr.apply(kr,Lt(arguments)),this},else:function(){return fr.apply(fr,Lt(arguments)),this},toString:function(){var Zt=lt();return Zt&&(Zt="else{"+Zt+"}"),Tt(["if(",Mr,"){",Or(),"}",Zt])}})}var mr=$t(),dr={};function Pr(Mr,kr){var fr=[];function Or(){var ur="a"+fr.length;return fr.push(ur),ur}kr=kr||0;for(var lt=0;lt<kr;++lt)Or();var Zt=Ct(),br=Zt.toString,Wr=dr[Mr]=H(Zt,{arg:Or,toString:function(){return Tt(["function(",fr.join(),"){",br(),"}"])}});return Wr}function xr(){var Mr=['"use strict";',mr,"return {"];Object.keys(dr).forEach(function(Or){Mr.push('"',Or,'":',dr[Or].toString(),",")}),Mr.push("}");var kr=Tt(Mr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),fr=Function.apply(null,le.concat(kr));return fr.apply(null,De)}return{global:mr,link:At,block:$t,proc:Pr,scope:Ct,cond:pt,compile:xr}}var ar="xyzw".split(""),Ir=5121,Tr=1,Qr=2,mn=0,Cn=1,_n=2,wi=3,nn=4,Vn="dither",ri="blend.enable",Zn="blend.color",Fn="blend.equation",Wn="blend.func",In="depth.enable",Pn="depth.func",ca="depth.range",Mo="depth.mask",va="colorMask",ga="cull.enable",To="cull.face",Ao="frontFace",Ya="lineWidth",za="polygonOffset.enable",fu="polygonOffset.offset",ts="sample.alpha",eu="sample.enable",Is="sample.coverage",ac="stencil.enable",hl="stencil.mask",wu="stencil.func",fl="stencil.opFront",Cu="stencil.opBack",pu="scissor.enable",pl="scissor.box",Va="viewport",Uo="profile",ps="framebuffer",Ms="vert",du="frag",pi="elements",Ca="primitive",Yo="count",Ru="offset",Ol="instances",Xu="vao",Bc="Width",Wu="Height",dl=ps+Bc,tu=ps+Wu,ru=Va+Bc,ap=Va+Wu,Pl="drawingBuffer",rs=Pl+Bc,Tf=Pl+Wu,Af=[Wn,Fn,wu,fl,Cu,Is,Va,pl,fu],vh=34962,qd=34963,Kd=35632,Yp=35633,gh=3553,qp=34067,Hh=2884,Kp=3042,sc=3024,Fc=2960,$d=2929,Qd=3089,Sf=32823,sp=32926,Jd=32928,Nc=5126,wf=35664,_h=35665,Cf=35666,Ll=5124,Rf=35667,ko=35668,uc=35669,Uc=35670,kc=35671,zc=35672,lc=35673,yh=35674,xh=35675,Dl=35676,Vc=35678,Zc=35680,$p=4,Bl=1028,jc=1029,If=2304,up=2305,Mf=32775,lp=32776,Gu=519,Fl=7680,cp=0,hp=1,fp=32774,Qp=513,Hc=36160,em=36064,ml={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Of=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Xc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},cc={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},pp={frag:Kd,vert:Yp},Nl={cw:If,ccw:up};function Xh(F){return Array.isArray(F)||Gt(F)||Bo(F)}function Pf(F){return F.sort(function(le,De){return le===Va?-1:De===Va?1:le<De?-1:1})}function ds(F,le,De,At){this.thisDep=F,this.contextDep=le,this.propDep=De,this.append=At}function ns(F){return F&&!(F.thisDep||F.contextDep||F.propDep)}function _a(F){return new ds(!1,!1,!1,F)}function nu(F,le){var De=F.type;if(De===mn){var At=F.data.length;return new ds(!0,At>=1,At>=2,le)}else if(De===nn){var $t=F.data;return new ds($t.thisDep,$t.contextDep,$t.propDep,le)}else return new ds(De===wi,De===_n,De===Cn,le)}var Jp=new ds(!1,!1,!1,function(){});function Wh(F,le,De,At,$t,Ct,pt,mr,dr,Pr,xr,Mr,kr,fr,Or){var lt=Pr.Record,Zt={add:32774,subtract:32778,"reverse subtract":32779};De.ext_blend_minmax&&(Zt.min=Mf,Zt.max=lp);var br=De.angle_instanced_arrays,Wr=De.webgl_draw_buffers,ur={dirty:!0,profile:Or.profile},Jr={},vr=[],qr={},lr={};function Vr(J){return J.replace(".","_")}function Rn(J,fe,Be){var mt=Vr(J);vr.push(J),Jr[mt]=ur[mt]=!!Be,qr[mt]=fe}function Gn(J,fe,Be){var mt=Vr(J);vr.push(J),Array.isArray(Be)?(ur[mt]=Be.slice(),Jr[mt]=Be.slice()):ur[mt]=Jr[mt]=Be,lr[mt]=fe}Rn(Vn,sc),Rn(ri,Kp),Gn(Zn,"blendColor",[0,0,0,0]),Gn(Fn,"blendEquationSeparate",[fp,fp]),Gn(Wn,"blendFuncSeparate",[hp,cp,hp,cp]),Rn(In,$d,!0),Gn(Pn,"depthFunc",Qp),Gn(ca,"depthRange",[0,1]),Gn(Mo,"depthMask",!0),Gn(va,va,[!0,!0,!0,!0]),Rn(ga,Hh),Gn(To,"cullFace",jc),Gn(Ao,Ao,up),Gn(Ya,Ya,1),Rn(za,Sf),Gn(fu,"polygonOffset",[0,0]),Rn(ts,sp),Rn(eu,Jd),Gn(Is,"sampleCoverage",[1,!1]),Rn(ac,Fc),Gn(hl,"stencilMask",-1),Gn(wu,"stencilFunc",[Gu,0,-1]),Gn(fl,"stencilOpSeparate",[Bl,Fl,Fl,Fl]),Gn(Cu,"stencilOpSeparate",[jc,Fl,Fl,Fl]),Rn(pu,Qd),Gn(pl,"scissor",[0,0,F.drawingBufferWidth,F.drawingBufferHeight]),Gn(Va,Va,[0,0,F.drawingBufferWidth,F.drawingBufferHeight]);var Zr={gl:F,context:kr,strings:le,next:Jr,current:ur,draw:Mr,elements:Ct,buffer:$t,shader:xr,attributes:Pr.state,vao:Pr,uniforms:dr,framebuffer:mr,extensions:De,timer:fr,isBufferArgs:Xh},gr={primTypes:pa,compareFuncs:Xc,blendFuncs:ml,blendEquations:Zt,stencilOps:cc,glTypes:ti,orientationType:Nl};ie.optional(function(){Zr.isArrayLike=Fo}),Wr&&(gr.backBuffer=[jc],gr.drawBuffer=It(At.maxDrawbuffers,function(J){return J===0?[0]:It(J,function(fe){return em+fe})}));var _e=0;function D(){var J=jt(),fe=J.link,Be=J.global;J.id=_e++,J.batchId="0";var mt=fe(Zr),dt=J.shared={props:"a0"};Object.keys(Zr).forEach(function(We){dt[We]=Be.def(mt,".",We)}),ie.optional(function(){J.CHECK=fe(ie),J.commandStr=ie.guessCommand(),J.command=fe(J.commandStr),J.assert=function(We,ue,He){We("if(!(",ue,"))",this.CHECK,".commandRaise(",fe(He),",",this.command,");")},gr.invalidBlendCombinations=Of});var Xe=J.next={},Ye=J.current={};Object.keys(lr).forEach(function(We){Array.isArray(ur[We])&&(Xe[We]=Be.def(dt.next,".",We),Ye[We]=Be.def(dt.current,".",We))});var Qe=J.constants={};Object.keys(gr).forEach(function(We){Qe[We]=Be.def(JSON.stringify(gr[We]))}),J.invoke=function(We,ue){switch(ue.type){case mn:var He=["this",dt.context,dt.props,J.batchId];return We.def(fe(ue.data),".call(",He.slice(0,Math.max(ue.data.length+1,4)),")");case Cn:return We.def(dt.props,ue.data);case _n:return We.def(dt.context,ue.data);case wi:return We.def("this",ue.data);case nn:return ue.data.append(J,We),ue.data.ref}},J.attribCache={};var Ee={};return J.scopeAttrib=function(We){var ue=le.id(We);if(ue in Ee)return Ee[ue];var He=Pr.scope[ue];He||(He=Pr.scope[ue]=new lt);var Et=Ee[ue]=fe(He);return Et},J}function ni(J){var fe=J.static,Be=J.dynamic,mt;if(Uo in fe){var dt=!!fe[Uo];mt=_a(function(Ye,Qe){return dt}),mt.enable=dt}else if(Uo in Be){var Xe=Be[Uo];mt=nu(Xe,function(Ye,Qe){return Ye.invoke(Qe,Xe)})}return mt}function O(J,fe){var Be=J.static,mt=J.dynamic;if(ps in Be){var dt=Be[ps];return dt?(dt=mr.getFramebuffer(dt),ie.command(dt,"invalid framebuffer object"),_a(function(Ye,Qe){var Ee=Ye.link(dt),We=Ye.shared;Qe.set(We.framebuffer,".next",Ee);var ue=We.context;return Qe.set(ue,"."+dl,Ee+".width"),Qe.set(ue,"."+tu,Ee+".height"),Ee})):_a(function(Ye,Qe){var Ee=Ye.shared;Qe.set(Ee.framebuffer,".next","null");var We=Ee.context;return Qe.set(We,"."+dl,We+"."+rs),Qe.set(We,"."+tu,We+"."+Tf),"null"})}else if(ps in mt){var Xe=mt[ps];return nu(Xe,function(Ye,Qe){var Ee=Ye.invoke(Qe,Xe),We=Ye.shared,ue=We.framebuffer,He=Qe.def(ue,".getFramebuffer(",Ee,")");ie.optional(function(){Ye.assert(Qe,"!"+Ee+"||"+He,"invalid framebuffer object")}),Qe.set(ue,".next",He);var Et=We.context;return Qe.set(Et,"."+dl,He+"?"+He+".width:"+Et+"."+rs),Qe.set(Et,"."+tu,He+"?"+He+".height:"+Et+"."+Tf),He})}else return null}function li(J,fe,Be){var mt=J.static,dt=J.dynamic;function Xe(Ee){if(Ee in mt){var We=mt[Ee];ie.commandType(We,"object","invalid "+Ee,Be.commandStr);var ue=!0,He=We.x|0,Et=We.y|0,kt,hr;return"width"in We?(kt=We.width|0,ie.command(kt>=0,"invalid "+Ee,Be.commandStr)):ue=!1,"height"in We?(hr=We.height|0,ie.command(hr>=0,"invalid "+Ee,Be.commandStr)):ue=!1,new ds(!ue&&fe&&fe.thisDep,!ue&&fe&&fe.contextDep,!ue&&fe&&fe.propDep,function(cn,Ot){var pn=cn.shared.context,Dn=kt;"width"in We||(Dn=Ot.def(pn,".",dl,"-",He));var jn=hr;return"height"in We||(jn=Ot.def(pn,".",tu,"-",Et)),[He,Et,Dn,jn]})}else if(Ee in dt){var Wt=dt[Ee],Ht=nu(Wt,function(cn,Ot){var pn=cn.invoke(Ot,Wt);ie.optional(function(){cn.assert(Ot,pn+"&&typeof "+pn+'==="object"',"invalid "+Ee)});var Dn=cn.shared.context,jn=Ot.def(pn,".x|0"),Oi=Ot.def(pn,".y|0"),Ea=Ot.def('"width" in ',pn,"?",pn,".width|0:","(",Dn,".",dl,"-",jn,")"),qu=Ot.def('"height" in ',pn,"?",pn,".height|0:","(",Dn,".",tu,"-",Oi,")");return ie.optional(function(){cn.assert(Ot,Ea+">=0&&"+qu+">=0","invalid "+Ee)}),[jn,Oi,Ea,qu]});return fe&&(Ht.thisDep=Ht.thisDep||fe.thisDep,Ht.contextDep=Ht.contextDep||fe.contextDep,Ht.propDep=Ht.propDep||fe.propDep),Ht}else return fe?new ds(fe.thisDep,fe.contextDep,fe.propDep,function(cn,Ot){var pn=cn.shared.context;return[0,0,Ot.def(pn,".",dl),Ot.def(pn,".",tu)]}):null}var Ye=Xe(Va);if(Ye){var Qe=Ye;Ye=new ds(Ye.thisDep,Ye.contextDep,Ye.propDep,function(Ee,We){var ue=Qe.append(Ee,We),He=Ee.shared.context;return We.set(He,"."+ru,ue[2]),We.set(He,"."+ap,ue[3]),ue})}return{viewport:Ye,scissor_box:Xe(pl)}}function Xn(J,fe){var Be=J.static,mt=typeof Be[du]=="string"&&typeof Be[Ms]=="string";if(mt){if(Object.keys(fe.dynamic).length>0)return null;var dt=fe.static,Xe=Object.keys(dt);if(Xe.length>0&&typeof dt[Xe[0]]=="number"){for(var Ye=[],Qe=0;Qe<Xe.length;++Qe)ie(typeof dt[Xe[Qe]]=="number","must specify all vertex attribute locations when using vaos"),Ye.push([dt[Xe[Qe]]|0,Xe[Qe]]);return Ye}}return null}function Un(J,fe,Be){var mt=J.static,dt=J.dynamic;function Xe(ue){if(ue in mt){var He=le.id(mt[ue]);ie.optional(function(){xr.shader(pp[ue],He,ie.guessCommand())});var Et=_a(function(){return He});return Et.id=He,Et}else if(ue in dt){var kt=dt[ue];return nu(kt,function(hr,Wt){var Ht=hr.invoke(Wt,kt),cn=Wt.def(hr.shared.strings,".id(",Ht,")");return ie.optional(function(){Wt(hr.shared.shader,".shader(",pp[ue],",",cn,",",hr.command,");")}),cn})}return null}var Ye=Xe(du),Qe=Xe(Ms),Ee=null,We;return ns(Ye)&&ns(Qe)?(Ee=xr.program(Qe.id,Ye.id,null,Be),We=_a(function(ue,He){return ue.link(Ee)})):We=new ds(Ye&&Ye.thisDep||Qe&&Qe.thisDep,Ye&&Ye.contextDep||Qe&&Qe.contextDep,Ye&&Ye.propDep||Qe&&Qe.propDep,function(ue,He){var Et=ue.shared.shader,kt;Ye?kt=Ye.append(ue,He):kt=He.def(Et,".",du);var hr;Qe?hr=Qe.append(ue,He):hr=He.def(Et,".",Ms);var Wt=Et+".program("+hr+","+kt;return ie.optional(function(){Wt+=","+ue.command}),He.def(Wt+")")}),{frag:Ye,vert:Qe,progVar:We,program:Ee}}function Fi(J,fe){var Be=J.static,mt=J.dynamic;function dt(){if(pi in Be){var ue=Be[pi];Xh(ue)?ue=Ct.getElements(Ct.create(ue,!0)):ue&&(ue=Ct.getElements(ue),ie.command(ue,"invalid elements",fe.commandStr));var He=_a(function(kt,hr){if(ue){var Wt=kt.link(ue);return kt.ELEMENTS=Wt,Wt}return kt.ELEMENTS=null,null});return He.value=ue,He}else if(pi in mt){var Et=mt[pi];return nu(Et,function(kt,hr){var Wt=kt.shared,Ht=Wt.isBufferArgs,cn=Wt.elements,Ot=kt.invoke(hr,Et),pn=hr.def("null"),Dn=hr.def(Ht,"(",Ot,")"),jn=kt.cond(Dn).then(pn,"=",cn,".createStream(",Ot,");").else(pn,"=",cn,".getElements(",Ot,");");return ie.optional(function(){kt.assert(jn.else,"!"+Ot+"||"+pn,"invalid elements")}),hr.entry(jn),hr.exit(kt.cond(Dn).then(cn,".destroyStream(",pn,");")),kt.ELEMENTS=pn,pn})}return null}var Xe=dt();function Ye(){if(Ca in Be){var ue=Be[Ca];return ie.commandParameter(ue,pa,"invalid primitve",fe.commandStr),_a(function(Et,kt){return pa[ue]})}else if(Ca in mt){var He=mt[Ca];return nu(He,function(Et,kt){var hr=Et.constants.primTypes,Wt=Et.invoke(kt,He);return ie.optional(function(){Et.assert(kt,Wt+" in "+hr,"invalid primitive, must be one of "+Object.keys(pa))}),kt.def(hr,"[",Wt,"]")})}else if(Xe)return ns(Xe)?Xe.value?_a(function(Et,kt){return kt.def(Et.ELEMENTS,".primType")}):_a(function(){return $p}):new ds(Xe.thisDep,Xe.contextDep,Xe.propDep,function(Et,kt){var hr=Et.ELEMENTS;return kt.def(hr,"?",hr,".primType:",$p)});return null}function Qe(ue,He){if(ue in Be){var Et=Be[ue]|0;return ie.command(!He||Et>=0,"invalid "+ue,fe.commandStr),_a(function(hr,Wt){return He&&(hr.OFFSET=Et),Et})}else if(ue in mt){var kt=mt[ue];return nu(kt,function(hr,Wt){var Ht=hr.invoke(Wt,kt);return He&&(hr.OFFSET=Ht,ie.optional(function(){hr.assert(Wt,Ht+">=0","invalid "+ue)})),Ht})}else if(He&&Xe)return _a(function(hr,Wt){return hr.OFFSET="0",0});return null}var Ee=Qe(Ru,!0);function We(){if(Yo in Be){var ue=Be[Yo]|0;return ie.command(typeof ue=="number"&&ue>=0,"invalid vertex count",fe.commandStr),_a(function(){return ue})}else if(Yo in mt){var He=mt[Yo];return nu(He,function(hr,Wt){var Ht=hr.invoke(Wt,He);return ie.optional(function(){hr.assert(Wt,"typeof "+Ht+'==="number"&&'+Ht+">=0&&"+Ht+"===("+Ht+"|0)","invalid vertex count")}),Ht})}else if(Xe)if(ns(Xe)){if(Xe)return Ee?new ds(Ee.thisDep,Ee.contextDep,Ee.propDep,function(hr,Wt){var Ht=Wt.def(hr.ELEMENTS,".vertCount-",hr.OFFSET);return ie.optional(function(){hr.assert(Wt,Ht+">=0","invalid vertex offset/element buffer too small")}),Ht}):_a(function(hr,Wt){return Wt.def(hr.ELEMENTS,".vertCount")});var Et=_a(function(){return-1});return ie.optional(function(){Et.MISSING=!0}),Et}else{var kt=new ds(Xe.thisDep||Ee.thisDep,Xe.contextDep||Ee.contextDep,Xe.propDep||Ee.propDep,function(hr,Wt){var Ht=hr.ELEMENTS;return hr.OFFSET?Wt.def(Ht,"?",Ht,".vertCount-",hr.OFFSET,":-1"):Wt.def(Ht,"?",Ht,".vertCount:-1")});return ie.optional(function(){kt.DYNAMIC=!0}),kt}return null}return{elements:Xe,primitive:Ye(),count:We(),instances:Qe(Ol,!1),offset:Ee}}function fo(J,fe){var Be=J.static,mt=J.dynamic,dt={};return vr.forEach(function(Xe){var Ye=Vr(Xe);function Qe(Ee,We){if(Xe in Be){var ue=Ee(Be[Xe]);dt[Ye]=_a(function(){return ue})}else if(Xe in mt){var He=mt[Xe];dt[Ye]=nu(He,function(Et,kt){return We(Et,kt,Et.invoke(kt,He))})}}switch(Xe){case ga:case ri:case Vn:case ac:case In:case pu:case za:case ts:case eu:case Mo:return Qe(function(Ee){return ie.commandType(Ee,"boolean",Xe,fe.commandStr),Ee},function(Ee,We,ue){return ie.optional(function(){Ee.assert(We,"typeof "+ue+'==="boolean"',"invalid flag "+Xe,Ee.commandStr)}),ue});case Pn:return Qe(function(Ee){return ie.commandParameter(Ee,Xc,"invalid "+Xe,fe.commandStr),Xc[Ee]},function(Ee,We,ue){var He=Ee.constants.compareFuncs;return ie.optional(function(){Ee.assert(We,ue+" in "+He,"invalid "+Xe+", must be one of "+Object.keys(Xc))}),We.def(He,"[",ue,"]")});case ca:return Qe(function(Ee){return ie.command(Fo(Ee)&&Ee.length===2&&typeof Ee[0]=="number"&&typeof Ee[1]=="number"&&Ee[0]<=Ee[1],"depth range is 2d array",fe.commandStr),Ee},function(Ee,We,ue){ie.optional(function(){Ee.assert(We,Ee.shared.isArrayLike+"("+ue+")&&"+ue+".length===2&&typeof "+ue+'[0]==="number"&&typeof '+ue+'[1]==="number"&&'+ue+"[0]<="+ue+"[1]","depth range must be a 2d array")});var He=We.def("+",ue,"[0]"),Et=We.def("+",ue,"[1]");return[He,Et]});case Wn:return Qe(function(Ee){ie.commandType(Ee,"object","blend.func",fe.commandStr);var We="srcRGB"in Ee?Ee.srcRGB:Ee.src,ue="srcAlpha"in Ee?Ee.srcAlpha:Ee.src,He="dstRGB"in Ee?Ee.dstRGB:Ee.dst,Et="dstAlpha"in Ee?Ee.dstAlpha:Ee.dst;return ie.commandParameter(We,ml,Ye+".srcRGB",fe.commandStr),ie.commandParameter(ue,ml,Ye+".srcAlpha",fe.commandStr),ie.commandParameter(He,ml,Ye+".dstRGB",fe.commandStr),ie.commandParameter(Et,ml,Ye+".dstAlpha",fe.commandStr),ie.command(Of.indexOf(We+", "+He)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+We+", "+He+")",fe.commandStr),[ml[We],ml[He],ml[ue],ml[Et]]},function(Ee,We,ue){var He=Ee.constants.blendFuncs;ie.optional(function(){Ee.assert(We,ue+"&&typeof "+ue+'==="object"',"invalid blend func, must be an object")});function Et(pn,Dn){var jn=We.def('"',pn,Dn,'" in ',ue,"?",ue,".",pn,Dn,":",ue,".",pn);return ie.optional(function(){Ee.assert(We,jn+" in "+He,"invalid "+Xe+"."+pn+Dn+", must be one of "+Object.keys(ml))}),jn}var kt=Et("src","RGB"),hr=Et("dst","RGB");ie.optional(function(){var pn=Ee.constants.invalidBlendCombinations;Ee.assert(We,pn+".indexOf("+kt+'+", "+'+hr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Wt=We.def(He,"[",kt,"]"),Ht=We.def(He,"[",Et("src","Alpha"),"]"),cn=We.def(He,"[",hr,"]"),Ot=We.def(He,"[",Et("dst","Alpha"),"]");return[Wt,cn,Ht,Ot]});case Fn:return Qe(function(Ee){if(typeof Ee=="string")return ie.commandParameter(Ee,Zt,"invalid "+Xe,fe.commandStr),[Zt[Ee],Zt[Ee]];if(typeof Ee=="object")return ie.commandParameter(Ee.rgb,Zt,Xe+".rgb",fe.commandStr),ie.commandParameter(Ee.alpha,Zt,Xe+".alpha",fe.commandStr),[Zt[Ee.rgb],Zt[Ee.alpha]];ie.commandRaise("invalid blend.equation",fe.commandStr)},function(Ee,We,ue){var He=Ee.constants.blendEquations,Et=We.def(),kt=We.def(),hr=Ee.cond("typeof ",ue,'==="string"');return ie.optional(function(){function Wt(Ht,cn,Ot){Ee.assert(Ht,Ot+" in "+He,"invalid "+cn+", must be one of "+Object.keys(Zt))}Wt(hr.then,Xe,ue),Ee.assert(hr.else,ue+"&&typeof "+ue+'==="object"',"invalid "+Xe),Wt(hr.else,Xe+".rgb",ue+".rgb"),Wt(hr.else,Xe+".alpha",ue+".alpha")}),hr.then(Et,"=",kt,"=",He,"[",ue,"];"),hr.else(Et,"=",He,"[",ue,".rgb];",kt,"=",He,"[",ue,".alpha];"),We(hr),[Et,kt]});case Zn:return Qe(function(Ee){return ie.command(Fo(Ee)&&Ee.length===4,"blend.color must be a 4d array",fe.commandStr),It(4,function(We){return+Ee[We]})},function(Ee,We,ue){return ie.optional(function(){Ee.assert(We,Ee.shared.isArrayLike+"("+ue+")&&"+ue+".length===4","blend.color must be a 4d array")}),It(4,function(He){return We.def("+",ue,"[",He,"]")})});case hl:return Qe(function(Ee){return ie.commandType(Ee,"number",Ye,fe.commandStr),Ee|0},function(Ee,We,ue){return ie.optional(function(){Ee.assert(We,"typeof "+ue+'==="number"',"invalid stencil.mask")}),We.def(ue,"|0")});case wu:return Qe(function(Ee){ie.commandType(Ee,"object",Ye,fe.commandStr);var We=Ee.cmp||"keep",ue=Ee.ref||0,He="mask"in Ee?Ee.mask:-1;return ie.commandParameter(We,Xc,Xe+".cmp",fe.commandStr),ie.commandType(ue,"number",Xe+".ref",fe.commandStr),ie.commandType(He,"number",Xe+".mask",fe.commandStr),[Xc[We],ue,He]},function(Ee,We,ue){var He=Ee.constants.compareFuncs;ie.optional(function(){function Wt(){Ee.assert(We,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Wt(ue+"&&typeof ",ue,'==="object"'),Wt('!("cmp" in ',ue,")||(",ue,".cmp in ",He,")")});var Et=We.def('"cmp" in ',ue,"?",He,"[",ue,".cmp]",":",Fl),kt=We.def(ue,".ref|0"),hr=We.def('"mask" in ',ue,"?",ue,".mask|0:-1");return[Et,kt,hr]});case fl:case Cu:return Qe(function(Ee){ie.commandType(Ee,"object",Ye,fe.commandStr);var We=Ee.fail||"keep",ue=Ee.zfail||"keep",He=Ee.zpass||"keep";return ie.commandParameter(We,cc,Xe+".fail",fe.commandStr),ie.commandParameter(ue,cc,Xe+".zfail",fe.commandStr),ie.commandParameter(He,cc,Xe+".zpass",fe.commandStr),[Xe===Cu?jc:Bl,cc[We],cc[ue],cc[He]]},function(Ee,We,ue){var He=Ee.constants.stencilOps;ie.optional(function(){Ee.assert(We,ue+"&&typeof "+ue+'==="object"',"invalid "+Xe)});function Et(kt){return ie.optional(function(){Ee.assert(We,'!("'+kt+'" in '+ue+")||("+ue+"."+kt+" in "+He+")","invalid "+Xe+"."+kt+", must be one of "+Object.keys(cc))}),We.def('"',kt,'" in ',ue,"?",He,"[",ue,".",kt,"]:",Fl)}return[Xe===Cu?jc:Bl,Et("fail"),Et("zfail"),Et("zpass")]});case fu:return Qe(function(Ee){ie.commandType(Ee,"object",Ye,fe.commandStr);var We=Ee.factor|0,ue=Ee.units|0;return ie.commandType(We,"number",Ye+".factor",fe.commandStr),ie.commandType(ue,"number",Ye+".units",fe.commandStr),[We,ue]},function(Ee,We,ue){ie.optional(function(){Ee.assert(We,ue+"&&typeof "+ue+'==="object"',"invalid "+Xe)});var He=We.def(ue,".factor|0"),Et=We.def(ue,".units|0");return[He,Et]});case To:return Qe(function(Ee){var We=0;return Ee==="front"?We=Bl:Ee==="back"&&(We=jc),ie.command(!!We,Ye,fe.commandStr),We},function(Ee,We,ue){return ie.optional(function(){Ee.assert(We,ue+'==="front"||'+ue+'==="back"',"invalid cull.face")}),We.def(ue,'==="front"?',Bl,":",jc)});case Ya:return Qe(function(Ee){return ie.command(typeof Ee=="number"&&Ee>=At.lineWidthDims[0]&&Ee<=At.lineWidthDims[1],"invalid line width, must be a positive number between "+At.lineWidthDims[0]+" and "+At.lineWidthDims[1],fe.commandStr),Ee},function(Ee,We,ue){return ie.optional(function(){Ee.assert(We,"typeof "+ue+'==="number"&&'+ue+">="+At.lineWidthDims[0]+"&&"+ue+"<="+At.lineWidthDims[1],"invalid line width")}),ue});case Ao:return Qe(function(Ee){return ie.commandParameter(Ee,Nl,Ye,fe.commandStr),Nl[Ee]},function(Ee,We,ue){return ie.optional(function(){Ee.assert(We,ue+'==="cw"||'+ue+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),We.def(ue+'==="cw"?'+If+":"+up)});case va:return Qe(function(Ee){return ie.command(Fo(Ee)&&Ee.length===4,"color.mask must be length 4 array",fe.commandStr),Ee.map(function(We){return!!We})},function(Ee,We,ue){return ie.optional(function(){Ee.assert(We,Ee.shared.isArrayLike+"("+ue+")&&"+ue+".length===4","invalid color.mask")}),It(4,function(He){return"!!"+ue+"["+He+"]"})});case Is:return Qe(function(Ee){ie.command(typeof Ee=="object"&&Ee,Ye,fe.commandStr);var We="value"in Ee?Ee.value:1,ue=!!Ee.invert;return ie.command(typeof We=="number"&&We>=0&&We<=1,"sample.coverage.value must be a number between 0 and 1",fe.commandStr),[We,ue]},function(Ee,We,ue){ie.optional(function(){Ee.assert(We,ue+"&&typeof "+ue+'==="object"',"invalid sample.coverage")});var He=We.def('"value" in ',ue,"?+",ue,".value:1"),Et=We.def("!!",ue,".invert");return[He,Et]})}}),dt}function Za(J,fe){var Be=J.static,mt=J.dynamic,dt={};return Object.keys(Be).forEach(function(Xe){var Ye=Be[Xe],Qe;if(typeof Ye=="number"||typeof Ye=="boolean")Qe=_a(function(){return Ye});else if(typeof Ye=="function"){var Ee=Ye._reglType;Ee==="texture2d"||Ee==="textureCube"?Qe=_a(function(We){return We.link(Ye)}):Ee==="framebuffer"||Ee==="framebufferCube"?(ie.command(Ye.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Xe+'"',fe.commandStr),Qe=_a(function(We){return We.link(Ye.color[0])})):ie.commandRaise('invalid data for uniform "'+Xe+'"',fe.commandStr)}else Fo(Ye)?Qe=_a(function(We){var ue=We.global.def("[",It(Ye.length,function(He){return ie.command(typeof Ye[He]=="number"||typeof Ye[He]=="boolean","invalid uniform "+Xe,We.commandStr),Ye[He]}),"]");return ue}):ie.commandRaise('invalid or missing data for uniform "'+Xe+'"',fe.commandStr);Qe.value=Ye,dt[Xe]=Qe}),Object.keys(mt).forEach(function(Xe){var Ye=mt[Xe];dt[Xe]=nu(Ye,function(Qe,Ee){return Qe.invoke(Ee,Ye)})}),dt}function _i(J,fe){var Be=J.static,mt=J.dynamic,dt={};return Object.keys(Be).forEach(function(Xe){var Ye=Be[Xe],Qe=le.id(Xe),Ee=new lt;if(Xh(Ye))Ee.state=Tr,Ee.buffer=$t.getBuffer($t.create(Ye,vh,!1,!0)),Ee.type=0;else{var We=$t.getBuffer(Ye);if(We)Ee.state=Tr,Ee.buffer=We,Ee.type=0;else if(ie.command(typeof Ye=="object"&&Ye,"invalid data for attribute "+Xe,fe.commandStr),"constant"in Ye){var ue=Ye.constant;Ee.buffer="null",Ee.state=Qr,typeof ue=="number"?Ee.x=ue:(ie.command(Fo(ue)&&ue.length>0&&ue.length<=4,"invalid constant for attribute "+Xe,fe.commandStr),ar.forEach(function(cn,Ot){Ot<ue.length&&(Ee[cn]=ue[Ot])}))}else{Xh(Ye.buffer)?We=$t.getBuffer($t.create(Ye.buffer,vh,!1,!0)):We=$t.getBuffer(Ye.buffer),ie.command(!!We,'missing buffer for attribute "'+Xe+'"',fe.commandStr);var He=Ye.offset|0;ie.command(He>=0,'invalid offset for attribute "'+Xe+'"',fe.commandStr);var Et=Ye.stride|0;ie.command(Et>=0&&Et<256,'invalid stride for attribute "'+Xe+'", must be integer betweeen [0, 255]',fe.commandStr);var kt=Ye.size|0;ie.command(!("size"in Ye)||kt>0&&kt<=4,'invalid size for attribute "'+Xe+'", must be 1,2,3,4',fe.commandStr);var hr=!!Ye.normalized,Wt=0;"type"in Ye&&(ie.commandParameter(Ye.type,ti,"invalid type for attribute "+Xe,fe.commandStr),Wt=ti[Ye.type]);var Ht=Ye.divisor|0;"divisor"in Ye&&(ie.command(Ht===0||br,'cannot specify divisor for attribute "'+Xe+'", instancing not supported',fe.commandStr),ie.command(Ht>=0,'invalid divisor for attribute "'+Xe+'"',fe.commandStr)),ie.optional(function(){var cn=fe.commandStr,Ot=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ye).forEach(function(pn){ie.command(Ot.indexOf(pn)>=0,'unknown parameter "'+pn+'" for attribute pointer "'+Xe+'" (valid parameters are '+Ot+")",cn)})}),Ee.buffer=We,Ee.state=Tr,Ee.size=kt,Ee.normalized=hr,Ee.type=Wt||We.dtype,Ee.offset=He,Ee.stride=Et,Ee.divisor=Ht}}dt[Xe]=_a(function(cn,Ot){var pn=cn.attribCache;if(Qe in pn)return pn[Qe];var Dn={isStream:!1};return Object.keys(Ee).forEach(function(jn){Dn[jn]=Ee[jn]}),Ee.buffer&&(Dn.buffer=cn.link(Ee.buffer),Dn.type=Dn.type||Dn.buffer+".dtype"),pn[Qe]=Dn,Dn})}),Object.keys(mt).forEach(function(Xe){var Ye=mt[Xe];function Qe(Ee,We){var ue=Ee.invoke(We,Ye),He=Ee.shared,Et=Ee.constants,kt=He.isBufferArgs,hr=He.buffer;ie.optional(function(){Ee.assert(We,ue+"&&(typeof "+ue+'==="object"||typeof '+ue+'==="function")&&('+kt+"("+ue+")||"+hr+".getBuffer("+ue+")||"+hr+".getBuffer("+ue+".buffer)||"+kt+"("+ue+'.buffer)||("constant" in '+ue+"&&(typeof "+ue+'.constant==="number"||'+He.isArrayLike+"("+ue+".constant))))",'invalid dynamic attribute "'+Xe+'"')});var Wt={isStream:We.def(!1)},Ht=new lt;Ht.state=Tr,Object.keys(Ht).forEach(function(Dn){Wt[Dn]=We.def(""+Ht[Dn])});var cn=Wt.buffer,Ot=Wt.type;We("if(",kt,"(",ue,")){",Wt.isStream,"=true;",cn,"=",hr,".createStream(",vh,",",ue,");",Ot,"=",cn,".dtype;","}else{",cn,"=",hr,".getBuffer(",ue,");","if(",cn,"){",Ot,"=",cn,".dtype;",'}else if("constant" in ',ue,"){",Wt.state,"=",Qr,";","if(typeof "+ue+'.constant === "number"){',Wt[ar[0]],"=",ue,".constant;",ar.slice(1).map(function(Dn){return Wt[Dn]}).join("="),"=0;","}else{",ar.map(function(Dn,jn){return Wt[Dn]+"="+ue+".constant.length>"+jn+"?"+ue+".constant["+jn+"]:0;"}).join(""),"}}else{","if(",kt,"(",ue,".buffer)){",cn,"=",hr,".createStream(",vh,",",ue,".buffer);","}else{",cn,"=",hr,".getBuffer(",ue,".buffer);","}",Ot,'="type" in ',ue,"?",Et.glTypes,"[",ue,".type]:",cn,".dtype;",Wt.normalized,"=!!",ue,".normalized;");function pn(Dn){We(Wt[Dn],"=",ue,".",Dn,"|0;")}return pn("size"),pn("offset"),pn("stride"),pn("divisor"),We("}}"),We.exit("if(",Wt.isStream,"){",hr,".destroyStream(",cn,");","}"),Wt}dt[Xe]=nu(Ye,Qe)}),dt}function ta(J,fe){var Be=J.static,mt=J.dynamic;if(Xu in Be){var dt=Be[Xu];return dt!==null&&Pr.getVAO(dt)===null&&(dt=Pr.createVAO(dt)),_a(function(Ye){return Ye.link(Pr.getVAO(dt))})}else if(Xu in mt){var Xe=mt[Xu];return nu(Xe,function(Ye,Qe){var Ee=Ye.invoke(Qe,Xe);return Qe.def(Ye.shared.vao+".getVAO("+Ee+")")})}return null}function oo(J){var fe=J.static,Be=J.dynamic,mt={};return Object.keys(fe).forEach(function(dt){var Xe=fe[dt];mt[dt]=_a(function(Ye,Qe){return typeof Xe=="number"||typeof Xe=="boolean"?""+Xe:Ye.link(Xe)})}),Object.keys(Be).forEach(function(dt){var Xe=Be[dt];mt[dt]=nu(Xe,function(Ye,Qe){return Ye.invoke(Qe,Xe)})}),mt}function ha(J,fe,Be,mt,dt){var Xe=J.static,Ye=J.dynamic;ie.optional(function(){var pn=[ps,Ms,du,pi,Ca,Ru,Yo,Ol,Uo,Xu].concat(vr);function Dn(jn){Object.keys(jn).forEach(function(Oi){ie.command(pn.indexOf(Oi)>=0,'unknown parameter "'+Oi+'"',dt.commandStr)})}Dn(Xe),Dn(Ye)});var Qe=Xn(J,fe),Ee=O(J,dt),We=li(J,Ee,dt),ue=Fi(J,dt),He=fo(J,dt),Et=Un(J,dt,Qe);function kt(pn){var Dn=We[pn];Dn&&(He[pn]=Dn)}kt(Va),kt(Vr(pl));var hr=Object.keys(He).length>0,Wt={framebuffer:Ee,draw:ue,shader:Et,state:He,dirty:hr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Wt.profile=ni(J,dt),Wt.uniforms=Za(Be,dt),Wt.drawVAO=Wt.scopeVAO=ta(J,dt),!Wt.drawVAO&&Et.program&&!Qe&&De.angle_instanced_arrays){var Ht=!0,cn=Et.program.attributes.map(function(pn){var Dn=fe.static[pn];return Ht=Ht&&!!Dn,Dn});if(Ht&&cn.length>0){var Ot=Pr.getVAO(Pr.createVAO(cn));Wt.drawVAO=new ds(null,null,null,function(pn,Dn){return pn.link(Ot)}),Wt.useVAO=!0}}return Qe?Wt.useVAO=!0:Wt.attributes=_i(fe,dt),Wt.context=oo(mt,dt),Wt}function ya(J,fe,Be){var mt=J.shared,dt=mt.context,Xe=J.scope();Object.keys(Be).forEach(function(Ye){fe.save(dt,"."+Ye);var Qe=Be[Ye];Xe(dt,".",Ye,"=",Qe.append(J,fe),";")}),fe(Xe)}function qo(J,fe,Be,mt){var dt=J.shared,Xe=dt.gl,Ye=dt.framebuffer,Qe;Wr&&(Qe=fe.def(dt.extensions,".webgl_draw_buffers"));var Ee=J.constants,We=Ee.drawBuffer,ue=Ee.backBuffer,He;Be?He=Be.append(J,fe):He=fe.def(Ye,".next"),mt||fe("if(",He,"!==",Ye,".cur){"),fe("if(",He,"){",Xe,".bindFramebuffer(",Hc,",",He,".framebuffer);"),Wr&&fe(Qe,".drawBuffersWEBGL(",We,"[",He,".colorAttachments.length]);"),fe("}else{",Xe,".bindFramebuffer(",Hc,",null);"),Wr&&fe(Qe,".drawBuffersWEBGL(",ue,");"),fe("}",Ye,".cur=",He,";"),mt||fe("}")}function xa(J,fe,Be){var mt=J.shared,dt=mt.gl,Xe=J.current,Ye=J.next,Qe=mt.current,Ee=mt.next,We=J.cond(Qe,".dirty");vr.forEach(function(ue){var He=Vr(ue);if(!(He in Be.state)){var Et,kt;if(He in Ye){Et=Ye[He],kt=Xe[He];var hr=It(ur[He].length,function(Ht){return We.def(Et,"[",Ht,"]")});We(J.cond(hr.map(function(Ht,cn){return Ht+"!=="+kt+"["+cn+"]"}).join("||")).then(dt,".",lr[He],"(",hr,");",hr.map(function(Ht,cn){return kt+"["+cn+"]="+Ht}).join(";"),";"))}else{Et=We.def(Ee,".",He);var Wt=J.cond(Et,"!==",Qe,".",He);We(Wt),He in qr?Wt(J.cond(Et).then(dt,".enable(",qr[He],");").else(dt,".disable(",qr[He],");"),Qe,".",He,"=",Et,";"):Wt(dt,".",lr[He],"(",Et,");",Qe,".",He,"=",Et,";")}}}),Object.keys(Be.state).length===0&&We(Qe,".dirty=false;"),fe(We)}function os(J,fe,Be,mt){var dt=J.shared,Xe=J.current,Ye=dt.current,Qe=dt.gl;Pf(Object.keys(Be)).forEach(function(Ee){var We=Be[Ee];if(!(mt&&!mt(We))){var ue=We.append(J,fe);if(qr[Ee]){var He=qr[Ee];ns(We)?ue?fe(Qe,".enable(",He,");"):fe(Qe,".disable(",He,");"):fe(J.cond(ue).then(Qe,".enable(",He,");").else(Qe,".disable(",He,");")),fe(Ye,".",Ee,"=",ue,";")}else if(Fo(ue)){var Et=Xe[Ee];fe(Qe,".",lr[Ee],"(",ue,");",ue.map(function(kt,hr){return Et+"["+hr+"]="+kt}).join(";"),";")}else fe(Qe,".",lr[Ee],"(",ue,");",Ye,".",Ee,"=",ue,";")}})}function Ra(J,fe){br&&(J.instancing=fe.def(J.shared.extensions,".angle_instanced_arrays"))}function ai(J,fe,Be,mt,dt){var Xe=J.shared,Ye=J.stats,Qe=Xe.current,Ee=Xe.timer,We=Be.profile;function ue(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var He,Et;function kt(pn){He=fe.def(),pn(He,"=",ue(),";"),typeof dt=="string"?pn(Ye,".count+=",dt,";"):pn(Ye,".count++;"),fr&&(mt?(Et=fe.def(),pn(Et,"=",Ee,".getNumPendingQueries();")):pn(Ee,".beginQuery(",Ye,");"))}function hr(pn){pn(Ye,".cpuTime+=",ue(),"-",He,";"),fr&&(mt?pn(Ee,".pushScopeStats(",Et,",",Ee,".getNumPendingQueries(),",Ye,");"):pn(Ee,".endQuery();"))}function Wt(pn){var Dn=fe.def(Qe,".profile");fe(Qe,".profile=",pn,";"),fe.exit(Qe,".profile=",Dn,";")}var Ht;if(We){if(ns(We)){We.enable?(kt(fe),hr(fe.exit),Wt("true")):Wt("false");return}Ht=We.append(J,fe),Wt(Ht)}else Ht=fe.def(Qe,".profile");var cn=J.block();kt(cn),fe("if(",Ht,"){",cn,"}");var Ot=J.block();hr(Ot),fe.exit("if(",Ht,"){",Ot,"}")}function as(J,fe,Be,mt,dt){var Xe=J.shared;function Ye(Ee){switch(Ee){case wf:case Rf:case kc:return 2;case _h:case ko:case zc:return 3;case Cf:case uc:case lc:return 4;default:return 1}}function Qe(Ee,We,ue){var He=Xe.gl,Et=fe.def(Ee,".location"),kt=fe.def(Xe.attributes,"[",Et,"]"),hr=ue.state,Wt=ue.buffer,Ht=[ue.x,ue.y,ue.z,ue.w],cn=["buffer","normalized","offset","stride"];function Ot(){fe("if(!",kt,".buffer){",He,".enableVertexAttribArray(",Et,");}");var Dn=ue.type,jn;if(ue.size?jn=fe.def(ue.size,"||",We):jn=We,fe("if(",kt,".type!==",Dn,"||",kt,".size!==",jn,"||",cn.map(function(Ea){return kt+"."+Ea+"!=="+ue[Ea]}).join("||"),"){",He,".bindBuffer(",vh,",",Wt,".buffer);",He,".vertexAttribPointer(",[Et,jn,Dn,ue.normalized,ue.stride,ue.offset],");",kt,".type=",Dn,";",kt,".size=",jn,";",cn.map(function(Ea){return kt+"."+Ea+"="+ue[Ea]+";"}).join(""),"}"),br){var Oi=ue.divisor;fe("if(",kt,".divisor!==",Oi,"){",J.instancing,".vertexAttribDivisorANGLE(",[Et,Oi],");",kt,".divisor=",Oi,";}")}}function pn(){fe("if(",kt,".buffer){",He,".disableVertexAttribArray(",Et,");",kt,".buffer=null;","}if(",ar.map(function(Dn,jn){return kt+"."+Dn+"!=="+Ht[jn]}).join("||"),"){",He,".vertexAttrib4f(",Et,",",Ht,");",ar.map(function(Dn,jn){return kt+"."+Dn+"="+Ht[jn]+";"}).join(""),"}")}hr===Tr?Ot():hr===Qr?pn():(fe("if(",hr,"===",Tr,"){"),Ot(),fe("}else{"),pn(),fe("}"))}mt.forEach(function(Ee){var We=Ee.name,ue=Be.attributes[We],He;if(ue){if(!dt(ue))return;He=ue.append(J,fe)}else{if(!dt(Jp))return;var Et=J.scopeAttrib(We);ie.optional(function(){J.assert(fe,Et+".state","missing attribute "+We)}),He={},Object.keys(new lt).forEach(function(kt){He[kt]=fe.def(Et,".",kt)})}Qe(J.link(Ee),Ye(Ee.info.type),He)})}function Zi(J,fe,Be,mt,dt){for(var Xe=J.shared,Ye=Xe.gl,Qe,Ee=0;Ee<mt.length;++Ee){var We=mt[Ee],ue=We.name,He=We.info.type,Et=Be.uniforms[ue],kt=J.link(We),hr=kt+".location",Wt;if(Et){if(!dt(Et))continue;if(ns(Et)){var Ht=Et.value;if(ie.command(Ht!==null&&typeof Ht!="undefined",'missing uniform "'+ue+'"',J.commandStr),He===Vc||He===Zc){ie.command(typeof Ht=="function"&&(He===Vc&&(Ht._reglType==="texture2d"||Ht._reglType==="framebuffer")||He===Zc&&(Ht._reglType==="textureCube"||Ht._reglType==="framebufferCube")),"invalid texture for uniform "+ue,J.commandStr);var cn=J.link(Ht._texture||Ht.color[0]._texture);fe(Ye,".uniform1i(",hr,",",cn+".bind());"),fe.exit(cn,".unbind();")}else if(He===yh||He===xh||He===Dl){ie.optional(function(){ie.command(Fo(Ht),"invalid matrix for uniform "+ue,J.commandStr),ie.command(He===yh&&Ht.length===4||He===xh&&Ht.length===9||He===Dl&&Ht.length===16,"invalid length for matrix uniform "+ue,J.commandStr)});var Ot=J.global.def("new Float32Array(["+Array.prototype.slice.call(Ht)+"])"),pn=2;He===xh?pn=3:He===Dl&&(pn=4),fe(Ye,".uniformMatrix",pn,"fv(",hr,",false,",Ot,");")}else{switch(He){case Nc:ie.commandType(Ht,"number","uniform "+ue,J.commandStr),Qe="1f";break;case wf:ie.command(Fo(Ht)&&Ht.length===2,"uniform "+ue,J.commandStr),Qe="2f";break;case _h:ie.command(Fo(Ht)&&Ht.length===3,"uniform "+ue,J.commandStr),Qe="3f";break;case Cf:ie.command(Fo(Ht)&&Ht.length===4,"uniform "+ue,J.commandStr),Qe="4f";break;case Uc:ie.commandType(Ht,"boolean","uniform "+ue,J.commandStr),Qe="1i";break;case Ll:ie.commandType(Ht,"number","uniform "+ue,J.commandStr),Qe="1i";break;case kc:ie.command(Fo(Ht)&&Ht.length===2,"uniform "+ue,J.commandStr),Qe="2i";break;case Rf:ie.command(Fo(Ht)&&Ht.length===2,"uniform "+ue,J.commandStr),Qe="2i";break;case zc:ie.command(Fo(Ht)&&Ht.length===3,"uniform "+ue,J.commandStr),Qe="3i";break;case ko:ie.command(Fo(Ht)&&Ht.length===3,"uniform "+ue,J.commandStr),Qe="3i";break;case lc:ie.command(Fo(Ht)&&Ht.length===4,"uniform "+ue,J.commandStr),Qe="4i";break;case uc:ie.command(Fo(Ht)&&Ht.length===4,"uniform "+ue,J.commandStr),Qe="4i";break}fe(Ye,".uniform",Qe,"(",hr,",",Fo(Ht)?Array.prototype.slice.call(Ht):Ht,");")}continue}else Wt=Et.append(J,fe)}else{if(!dt(Jp))continue;Wt=fe.def(Xe.uniforms,"[",le.id(ue),"]")}He===Vc?fe("if(",Wt,"&&",Wt,'._reglType==="framebuffer"){',Wt,"=",Wt,".color[0];","}"):He===Zc&&fe("if(",Wt,"&&",Wt,'._reglType==="framebufferCube"){',Wt,"=",Wt,".color[0];","}"),ie.optional(function(){function qu(Ul,yp){J.assert(fe,Ul,'bad data or missing for uniform "'+ue+'".  '+yp)}function Lf(Ul){qu("typeof "+Wt+'==="'+Ul+'"',"invalid type, expected "+Ul)}function mu(Ul,yp){qu(Xe.isArrayLike+"("+Wt+")&&"+Wt+".length==="+Ul,"invalid vector, should have length "+Ul,J.commandStr)}function ad(Ul){qu("typeof "+Wt+'==="function"&&'+Wt+'._reglType==="texture'+(Ul===gh?"2d":"Cube")+'"',"invalid texture type",J.commandStr)}switch(He){case Ll:Lf("number");break;case Rf:mu(2,"number");break;case ko:mu(3,"number");break;case uc:mu(4,"number");break;case Nc:Lf("number");break;case wf:mu(2,"number");break;case _h:mu(3,"number");break;case Cf:mu(4,"number");break;case Uc:Lf("boolean");break;case kc:mu(2,"boolean");break;case zc:mu(3,"boolean");break;case lc:mu(4,"boolean");break;case yh:mu(4,"number");break;case xh:mu(9,"number");break;case Dl:mu(16,"number");break;case Vc:ad(gh);break;case Zc:ad(qp);break}});var Dn=1;switch(He){case Vc:case Zc:var jn=fe.def(Wt,"._texture");fe(Ye,".uniform1i(",hr,",",jn,".bind());"),fe.exit(jn,".unbind();");continue;case Ll:case Uc:Qe="1i";break;case Rf:case kc:Qe="2i",Dn=2;break;case ko:case zc:Qe="3i",Dn=3;break;case uc:case lc:Qe="4i",Dn=4;break;case Nc:Qe="1f";break;case wf:Qe="2f",Dn=2;break;case _h:Qe="3f",Dn=3;break;case Cf:Qe="4f",Dn=4;break;case yh:Qe="Matrix2fv";break;case xh:Qe="Matrix3fv";break;case Dl:Qe="Matrix4fv";break}if(fe(Ye,".uniform",Qe,"(",hr,","),Qe.charAt(0)==="M"){var Oi=Math.pow(He-yh+2,2),Ea=J.global.def("new Float32Array(",Oi,")");fe("false,(Array.isArray(",Wt,")||",Wt," instanceof Float32Array)?",Wt,":(",It(Oi,function(qu){return Ea+"["+qu+"]="+Wt+"["+qu+"]"}),",",Ea,")")}else Dn>1?fe(It(Dn,function(qu){return Wt+"["+qu+"]"})):fe(Wt);fe(");")}}function Ln(J,fe,Be,mt){var dt=J.shared,Xe=dt.gl,Ye=dt.draw,Qe=mt.draw;function Ee(){var jn=Qe.elements,Oi,Ea=fe;return jn?((jn.contextDep&&mt.contextDynamic||jn.propDep)&&(Ea=Be),Oi=jn.append(J,Ea)):Oi=Ea.def(Ye,".",pi),Oi&&Ea("if("+Oi+")"+Xe+".bindBuffer("+qd+","+Oi+".buffer.buffer);"),Oi}function We(){var jn=Qe.count,Oi,Ea=fe;return jn?((jn.contextDep&&mt.contextDynamic||jn.propDep)&&(Ea=Be),Oi=jn.append(J,Ea),ie.optional(function(){jn.MISSING&&J.assert(fe,"false","missing vertex count"),jn.DYNAMIC&&J.assert(Ea,Oi+">=0","missing vertex count")})):(Oi=Ea.def(Ye,".",Yo),ie.optional(function(){J.assert(Ea,Oi+">=0","missing vertex count")})),Oi}var ue=Ee();function He(jn){var Oi=Qe[jn];return Oi?Oi.contextDep&&mt.contextDynamic||Oi.propDep?Oi.append(J,Be):Oi.append(J,fe):fe.def(Ye,".",jn)}var Et=He(Ca),kt=He(Ru),hr=We();if(typeof hr=="number"){if(hr===0)return}else Be("if(",hr,"){"),Be.exit("}");var Wt,Ht;br&&(Wt=He(Ol),Ht=J.instancing);var cn=ue+".type",Ot=Qe.elements&&ns(Qe.elements);function pn(){function jn(){Be(Ht,".drawElementsInstancedANGLE(",[Et,hr,cn,kt+"<<(("+cn+"-"+Ir+")>>1)",Wt],");")}function Oi(){Be(Ht,".drawArraysInstancedANGLE(",[Et,kt,hr,Wt],");")}ue?Ot?jn():(Be("if(",ue,"){"),jn(),Be("}else{"),Oi(),Be("}")):Oi()}function Dn(){function jn(){Be(Xe+".drawElements("+[Et,hr,cn,kt+"<<(("+cn+"-"+Ir+")>>1)"]+");")}function Oi(){Be(Xe+".drawArrays("+[Et,kt,hr]+");")}ue?Ot?jn():(Be("if(",ue,"){"),jn(),Be("}else{"),Oi(),Be("}")):Oi()}br&&(typeof Wt!="number"||Wt>=0)?typeof Wt=="string"?(Be("if(",Wt,">0){"),pn(),Be("}else if(",Wt,"<0){"),Dn(),Be("}")):pn():Dn()}function xi(J,fe,Be,mt,dt){var Xe=D(),Ye=Xe.proc("body",dt);return ie.optional(function(){Xe.commandStr=fe.commandStr,Xe.command=Xe.link(fe.commandStr)}),br&&(Xe.instancing=Ye.def(Xe.shared.extensions,".angle_instanced_arrays")),J(Xe,Ye,Be,mt),Xe.compile().body}function Ni(J,fe,Be,mt){Ra(J,fe),Be.useVAO?Be.drawVAO?fe(J.shared.vao,".setVAO(",Be.drawVAO.append(J,fe),");"):fe(J.shared.vao,".setVAO(",J.shared.vao,".targetVAO);"):(fe(J.shared.vao,".setVAO(null);"),as(J,fe,Be,mt.attributes,function(){return!0})),Zi(J,fe,Be,mt.uniforms,function(){return!0}),Ln(J,fe,fe,Be)}function ba(J,fe){var Be=J.proc("draw",1);Ra(J,Be),ya(J,Be,fe.context),qo(J,Be,fe.framebuffer),xa(J,Be,fe),os(J,Be,fe.state),ai(J,Be,fe,!1,!0);var mt=fe.shader.progVar.append(J,Be);if(Be(J.shared.gl,".useProgram(",mt,".program);"),fe.shader.program)Ni(J,Be,fe,fe.shader.program);else{Be(J.shared.vao,".setVAO(null);");var dt=J.global.def("{}"),Xe=Be.def(mt,".id"),Ye=Be.def(dt,"[",Xe,"]");Be(J.cond(Ye).then(Ye,".call(this,a0);").else(Ye,"=",dt,"[",Xe,"]=",J.link(function(Qe){return xi(Ni,J,fe,Qe,1)}),"(",mt,");",Ye,".call(this,a0);"))}Object.keys(fe.state).length>0&&Be(J.shared.current,".dirty=true;")}function Yu(J,fe,Be,mt){J.batchId="a1",Ra(J,fe);function dt(){return!0}as(J,fe,Be,mt.attributes,dt),Zi(J,fe,Be,mt.uniforms,dt),Ln(J,fe,fe,Be)}function Ae(J,fe,Be,mt){Ra(J,fe);var dt=Be.contextDep,Xe=fe.def(),Ye="a0",Qe="a1",Ee=fe.def();J.shared.props=Ee,J.batchId=Xe;var We=J.scope(),ue=J.scope();fe(We.entry,"for(",Xe,"=0;",Xe,"<",Qe,";++",Xe,"){",Ee,"=",Ye,"[",Xe,"];",ue,"}",We.exit);function He(cn){return cn.contextDep&&dt||cn.propDep}function Et(cn){return!He(cn)}if(Be.needsContext&&ya(J,ue,Be.context),Be.needsFramebuffer&&qo(J,ue,Be.framebuffer),os(J,ue,Be.state,He),Be.profile&&He(Be.profile)&&ai(J,ue,Be,!1,!0),mt)Be.useVAO?Be.drawVAO?He(Be.drawVAO)?ue(J.shared.vao,".setVAO(",Be.drawVAO.append(J,ue),");"):We(J.shared.vao,".setVAO(",Be.drawVAO.append(J,We),");"):We(J.shared.vao,".setVAO(",J.shared.vao,".targetVAO);"):(We(J.shared.vao,".setVAO(null);"),as(J,We,Be,mt.attributes,Et),as(J,ue,Be,mt.attributes,He)),Zi(J,We,Be,mt.uniforms,Et),Zi(J,ue,Be,mt.uniforms,He),Ln(J,We,ue,Be);else{var kt=J.global.def("{}"),hr=Be.shader.progVar.append(J,ue),Wt=ue.def(hr,".id"),Ht=ue.def(kt,"[",Wt,"]");ue(J.shared.gl,".useProgram(",hr,".program);","if(!",Ht,"){",Ht,"=",kt,"[",Wt,"]=",J.link(function(cn){return xi(Yu,J,Be,cn,2)}),"(",hr,");}",Ht,".call(this,a0[",Xe,"],",Xe,");")}}function Dt(J,fe){var Be=J.proc("batch",2);J.batchId="0",Ra(J,Be);var mt=!1,dt=!0;Object.keys(fe.context).forEach(function(kt){mt=mt||fe.context[kt].propDep}),mt||(ya(J,Be,fe.context),dt=!1);var Xe=fe.framebuffer,Ye=!1;Xe?(Xe.propDep?mt=Ye=!0:Xe.contextDep&&mt&&(Ye=!0),Ye||qo(J,Be,Xe)):qo(J,Be,null),fe.state.viewport&&fe.state.viewport.propDep&&(mt=!0);function Qe(kt){return kt.contextDep&&mt||kt.propDep}xa(J,Be,fe),os(J,Be,fe.state,function(kt){return!Qe(kt)}),(!fe.profile||!Qe(fe.profile))&&ai(J,Be,fe,!1,"a1"),fe.contextDep=mt,fe.needsContext=dt,fe.needsFramebuffer=Ye;var Ee=fe.shader.progVar;if(Ee.contextDep&&mt||Ee.propDep)Ae(J,Be,fe,null);else{var We=Ee.append(J,Be);if(Be(J.shared.gl,".useProgram(",We,".program);"),fe.shader.program)Ae(J,Be,fe,fe.shader.program);else{Be(J.shared.vao,".setVAO(null);");var ue=J.global.def("{}"),He=Be.def(We,".id"),Et=Be.def(ue,"[",He,"]");Be(J.cond(Et).then(Et,".call(this,a0,a1);").else(Et,"=",ue,"[",He,"]=",J.link(function(kt){return xi(Ae,J,fe,kt,2)}),"(",We,");",Et,".call(this,a0,a1);"))}}Object.keys(fe.state).length>0&&Be(J.shared.current,".dirty=true;")}function vt(J,fe){var Be=J.proc("scope",3);J.batchId="a2";var mt=J.shared,dt=mt.current;ya(J,Be,fe.context),fe.framebuffer&&fe.framebuffer.append(J,Be),Pf(Object.keys(fe.state)).forEach(function(Ye){var Qe=fe.state[Ye],Ee=Qe.append(J,Be);Fo(Ee)?Ee.forEach(function(We,ue){Be.set(J.next[Ye],"["+ue+"]",We)}):Be.set(mt.next,"."+Ye,Ee)}),ai(J,Be,fe,!0,!0),[pi,Ru,Yo,Ol,Ca].forEach(function(Ye){var Qe=fe.draw[Ye];Qe&&Be.set(mt.draw,"."+Ye,""+Qe.append(J,Be))}),Object.keys(fe.uniforms).forEach(function(Ye){Be.set(mt.uniforms,"["+le.id(Ye)+"]",fe.uniforms[Ye].append(J,Be))}),Object.keys(fe.attributes).forEach(function(Ye){var Qe=fe.attributes[Ye].append(J,Be),Ee=J.scopeAttrib(Ye);Object.keys(new lt).forEach(function(We){Be.set(Ee,"."+We,Qe[We])})}),fe.scopeVAO&&Be.set(mt.vao,".targetVAO",fe.scopeVAO.append(J,Be));function Xe(Ye){var Qe=fe.shader[Ye];Qe&&Be.set(mt.shader,"."+Ye,Qe.append(J,Be))}Xe(Ms),Xe(du),Object.keys(fe.state).length>0&&(Be(dt,".dirty=true;"),Be.exit(dt,".dirty=true;")),Be("a1(",J.shared.context,",a0,",J.batchId,");")}function on(J){if(!(typeof J!="object"||Fo(J))){for(var fe=Object.keys(J),Be=0;Be<fe.length;++Be)if(Do.isDynamic(J[fe[Be]]))return!0;return!1}}function ci(J,fe,Be){var mt=fe.static[Be];if(!mt||!on(mt))return;var dt=J.global,Xe=Object.keys(mt),Ye=!1,Qe=!1,Ee=!1,We=J.global.def("{}");Xe.forEach(function(He){var Et=mt[He];if(Do.isDynamic(Et)){typeof Et=="function"&&(Et=mt[He]=Do.unbox(Et));var kt=nu(Et,null);Ye=Ye||kt.thisDep,Ee=Ee||kt.propDep,Qe=Qe||kt.contextDep}else{switch(dt(We,".",He,"="),typeof Et){case"number":dt(Et);break;case"string":dt('"',Et,'"');break;case"object":Array.isArray(Et)&&dt("[",Et.join(),"]");break;default:dt(J.link(Et));break}dt(";")}});function ue(He,Et){Xe.forEach(function(kt){var hr=mt[kt];if(Do.isDynamic(hr)){var Wt=He.invoke(Et,hr);Et(We,".",kt,"=",Wt,";")}})}fe.dynamic[Be]=new Do.DynamicVariable(nn,{thisDep:Ye,contextDep:Qe,propDep:Ee,ref:We,append:ue}),delete fe.static[Be]}function ao(J,fe,Be,mt,dt){var Xe=D();Xe.stats=Xe.link(dt),Object.keys(fe.static).forEach(function(Qe){ci(Xe,fe,Qe)}),Af.forEach(function(Qe){ci(Xe,J,Qe)});var Ye=ha(J,fe,Be,mt,Xe);return ba(Xe,Ye),vt(Xe,Ye),Dt(Xe,Ye),Xe.compile()}return{next:Jr,current:ur,procs:function(){var J=D(),fe=J.proc("poll"),Be=J.proc("refresh"),mt=J.block();fe(mt),Be(mt);var dt=J.shared,Xe=dt.gl,Ye=dt.next,Qe=dt.current;mt(Qe,".dirty=false;"),qo(J,fe),qo(J,Be,null,!0);var Ee;br&&(Ee=J.link(br)),De.oes_vertex_array_object&&Be(J.link(De.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var We=0;We<At.maxAttributes;++We){var ue=Be.def(dt.attributes,"[",We,"]"),He=J.cond(ue,".buffer");He.then(Xe,".enableVertexAttribArray(",We,");",Xe,".bindBuffer(",vh,",",ue,".buffer.buffer);",Xe,".vertexAttribPointer(",We,",",ue,".size,",ue,".type,",ue,".normalized,",ue,".stride,",ue,".offset);").else(Xe,".disableVertexAttribArray(",We,");",Xe,".vertexAttrib4f(",We,",",ue,".x,",ue,".y,",ue,".z,",ue,".w);",ue,".buffer=null;"),Be(He),br&&Be(Ee,".vertexAttribDivisorANGLE(",We,",",ue,".divisor);")}return Be(J.shared.vao,".currentVAO=null;",J.shared.vao,".setVAO(",J.shared.vao,".targetVAO);"),Object.keys(qr).forEach(function(Et){var kt=qr[Et],hr=mt.def(Ye,".",Et),Wt=J.block();Wt("if(",hr,"){",Xe,".enable(",kt,")}else{",Xe,".disable(",kt,")}",Qe,".",Et,"=",hr,";"),Be(Wt),fe("if(",hr,"!==",Qe,".",Et,"){",Wt,"}")}),Object.keys(lr).forEach(function(Et){var kt=lr[Et],hr=ur[Et],Wt,Ht,cn=J.block();if(cn(Xe,".",kt,"("),Fo(hr)){var Ot=hr.length;Wt=J.global.def(Ye,".",Et),Ht=J.global.def(Qe,".",Et),cn(It(Ot,function(pn){return Wt+"["+pn+"]"}),");",It(Ot,function(pn){return Ht+"["+pn+"]="+Wt+"["+pn+"];"}).join("")),fe("if(",It(Ot,function(pn){return Wt+"["+pn+"]!=="+Ht+"["+pn+"]"}).join("||"),"){",cn,"}")}else Wt=mt.def(Ye,".",Et),Ht=mt.def(Qe,".",Et),cn(Wt,");",Qe,".",Et,"=",Wt,";"),fe("if(",Wt,"!==",Ht,"){",cn,"}");Be(cn)}),J.compile()}(),compile:ao}}function ed(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var tm=34918,td=34919,rd=35007,rm=function(F,le){if(!le.ext_disjoint_timer_query)return null;var De=[];function At(){return De.pop()||le.ext_disjoint_timer_query.createQueryEXT()}function $t(br){De.push(br)}var Ct=[];function pt(br){var Wr=At();le.ext_disjoint_timer_query.beginQueryEXT(rd,Wr),Ct.push(Wr),fr(Ct.length-1,Ct.length,br)}function mr(){le.ext_disjoint_timer_query.endQueryEXT(rd)}function dr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Pr=[];function xr(){return Pr.pop()||new dr}function Mr(br){Pr.push(br)}var kr=[];function fr(br,Wr,ur){var Jr=xr();Jr.startQueryIndex=br,Jr.endQueryIndex=Wr,Jr.sum=0,Jr.stats=ur,kr.push(Jr)}var Or=[],lt=[];function Zt(){var br,Wr,ur=Ct.length;if(ur!==0){lt.length=Math.max(lt.length,ur+1),Or.length=Math.max(Or.length,ur+1),Or[0]=0,lt[0]=0;var Jr=0;for(br=0,Wr=0;Wr<Ct.length;++Wr){var vr=Ct[Wr];le.ext_disjoint_timer_query.getQueryObjectEXT(vr,td)?(Jr+=le.ext_disjoint_timer_query.getQueryObjectEXT(vr,tm),$t(vr)):Ct[br++]=vr,Or[Wr+1]=Jr,lt[Wr+1]=br}for(Ct.length=br,br=0,Wr=0;Wr<kr.length;++Wr){var qr=kr[Wr],lr=qr.startQueryIndex,Vr=qr.endQueryIndex;qr.sum+=Or[Vr]-Or[lr];var Rn=lt[lr],Gn=lt[Vr];Gn===Rn?(qr.stats.gpuTime+=qr.sum/1e6,Mr(qr)):(qr.startQueryIndex=Rn,qr.endQueryIndex=Gn,kr[br++]=qr)}kr.length=br}}return{beginQuery:pt,endQuery:mr,pushScopeStats:fr,update:Zt,getNumPendingQueries:function(){return Ct.length},clear:function(){De.push.apply(De,Ct);for(var br=0;br<De.length;br++)le.ext_disjoint_timer_query.deleteQueryEXT(De[br]);Ct.length=0,De.length=0},restore:function(){Ct.length=0,De.length=0}}},dp=16384,is=256,nm=1024,mp=34962,vp="webglcontextlost",nd="webglcontextrestored",gp=1,id=2,im=3;function od(F,le){for(var De=0;De<F.length;++De)if(F[De]===le)return De;return-1}function _p(F){var le=Bt(F);if(!le)return null;var De=le.gl,At=De.getContextAttributes(),$t=De.isContextLost(),Ct=sr(De,le);if(!Ct)return null;var pt=ot(),mr=ed(),dr=Ct.extensions,Pr=rm(De,dr),xr=lo(),Mr=De.drawingBufferWidth,kr=De.drawingBufferHeight,fr={tick:0,time:0,viewportWidth:Mr,viewportHeight:kr,framebufferWidth:Mr,framebufferHeight:kr,drawingBufferWidth:Mr,drawingBufferHeight:kr,pixelRatio:le.pixelRatio},Or={},lt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Zt=yc(De,dr),br=Rh(De,mr,le,ur),Wr=j(De,dr,Zt,mr,br);function ur(Ln){return Wr.destroyBuffer(Ln)}var Jr=mf(De,dr,br,mr),vr=be(De,pt,mr,le),qr=$s(De,dr,Zt,function(){Rn.procs.poll()},fr,mr,le),lr=uu(De,dr,Zt,mr,le),Vr=T(De,dr,Zt,qr,lr,mr),Rn=Wh(De,pt,dr,Zt,br,Jr,qr,Vr,Or,Wr,vr,lt,fr,Pr,le),Gn=ht(De,Vr,Rn.procs.poll,fr,At,dr,Zt),Zr=Rn.next,gr=De.canvas,_e=[],D=[],ni=[],O=[le.onDestroy],li=null;function Xn(){if(_e.length===0){Pr&&Pr.update(),li=null;return}li=uo.next(Xn),os();for(var Ln=_e.length-1;Ln>=0;--Ln){var xi=_e[Ln];xi&&xi(fr,null,0)}De.flush(),Pr&&Pr.update()}function Un(){!li&&_e.length>0&&(li=uo.next(Xn))}function Fi(){li&&(uo.cancel(Xn),li=null)}function fo(Ln){Ln.preventDefault(),$t=!0,Fi(),D.forEach(function(xi){xi()})}function Za(Ln){De.getError(),$t=!1,Ct.restore(),vr.restore(),br.restore(),qr.restore(),lr.restore(),Vr.restore(),Wr.restore(),Pr&&Pr.restore(),Rn.procs.refresh(),Un(),ni.forEach(function(xi){xi()})}gr&&(gr.addEventListener(vp,fo,!1),gr.addEventListener(nd,Za,!1));function _i(){_e.length=0,Fi(),gr&&(gr.removeEventListener(vp,fo),gr.removeEventListener(nd,Za)),vr.clear(),Vr.clear(),lr.clear(),qr.clear(),Jr.clear(),br.clear(),Wr.clear(),Pr&&Pr.clear(),O.forEach(function(Ln){Ln()})}function ta(Ln){ie(!!Ln,"invalid args to regl({...})"),ie.type(Ln,"object","invalid args to regl({...})");function xi(dt){var Xe=H({},dt);delete Xe.uniforms,delete Xe.attributes,delete Xe.context,delete Xe.vao,"stencil"in Xe&&Xe.stencil.op&&(Xe.stencil.opBack=Xe.stencil.opFront=Xe.stencil.op,delete Xe.stencil.op);function Ye(Qe){if(Qe in Xe){var Ee=Xe[Qe];delete Xe[Qe],Object.keys(Ee).forEach(function(We){Xe[Qe+"."+We]=Ee[We]})}}return Ye("blend"),Ye("depth"),Ye("cull"),Ye("stencil"),Ye("polygonOffset"),Ye("scissor"),Ye("sample"),"vao"in dt&&(Xe.vao=dt.vao),Xe}function Ni(dt){var Xe={},Ye={};return Object.keys(dt).forEach(function(Qe){var Ee=dt[Qe];Do.isDynamic(Ee)?Ye[Qe]=Do.unbox(Ee,Qe):Xe[Qe]=Ee}),{dynamic:Ye,static:Xe}}var ba=Ni(Ln.context||{}),Yu=Ni(Ln.uniforms||{}),Ae=Ni(Ln.attributes||{}),Dt=Ni(xi(Ln)),vt={gpuTime:0,cpuTime:0,count:0},on=Rn.compile(Dt,Ae,Yu,ba,vt),ci=on.draw,ao=on.batch,J=on.scope,fe=[];function Be(dt){for(;fe.length<dt;)fe.push(null);return fe}function mt(dt,Xe){var Ye;if($t&&ie.raise("context lost"),typeof dt=="function")return J.call(this,null,dt,0);if(typeof Xe=="function")if(typeof dt=="number")for(Ye=0;Ye<dt;++Ye)J.call(this,null,Xe,Ye);else if(Array.isArray(dt))for(Ye=0;Ye<dt.length;++Ye)J.call(this,dt[Ye],Xe,Ye);else return J.call(this,dt,Xe,0);else if(typeof dt=="number"){if(dt>0)return ao.call(this,Be(dt|0),dt|0)}else if(Array.isArray(dt)){if(dt.length)return ao.call(this,dt,dt.length)}else return ci.call(this,dt)}return H(mt,{stats:vt})}var oo=Vr.setFBO=ta({framebuffer:Do.define.call(null,gp,"framebuffer")});function ha(Ln,xi){var Ni=0;Rn.procs.poll();var ba=xi.color;ba&&(De.clearColor(+ba[0]||0,+ba[1]||0,+ba[2]||0,+ba[3]||0),Ni|=dp),"depth"in xi&&(De.clearDepth(+xi.depth),Ni|=is),"stencil"in xi&&(De.clearStencil(xi.stencil|0),Ni|=nm),ie(!!Ni,"called regl.clear with no buffer specified"),De.clear(Ni)}function ya(Ln){if(ie(typeof Ln=="object"&&Ln,"regl.clear() takes an object as input"),"framebuffer"in Ln)if(Ln.framebuffer&&Ln.framebuffer_reglType==="framebufferCube")for(var xi=0;xi<6;++xi)oo(H({framebuffer:Ln.framebuffer.faces[xi]},Ln),ha);else oo(Ln,ha);else ha(null,Ln)}function qo(Ln){ie.type(Ln,"function","regl.frame() callback must be a function"),_e.push(Ln);function xi(){var Ni=od(_e,Ln);ie(Ni>=0,"cannot cancel a frame twice");function ba(){var Yu=od(_e,ba);_e[Yu]=_e[_e.length-1],_e.length-=1,_e.length<=0&&Fi()}_e[Ni]=ba}return Un(),{cancel:xi}}function xa(){var Ln=Zr.viewport,xi=Zr.scissor_box;Ln[0]=Ln[1]=xi[0]=xi[1]=0,fr.viewportWidth=fr.framebufferWidth=fr.drawingBufferWidth=Ln[2]=xi[2]=De.drawingBufferWidth,fr.viewportHeight=fr.framebufferHeight=fr.drawingBufferHeight=Ln[3]=xi[3]=De.drawingBufferHeight}function os(){fr.tick+=1,fr.time=ai(),xa(),Rn.procs.poll()}function Ra(){xa(),Rn.procs.refresh(),Pr&&Pr.update()}function ai(){return(lo()-xr)/1e3}Ra();function as(Ln,xi){ie.type(xi,"function","listener callback must be a function");var Ni;switch(Ln){case"frame":return qo(xi);case"lost":Ni=D;break;case"restore":Ni=ni;break;case"destroy":Ni=O;break;default:ie.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ni.push(xi),{cancel:function(){for(var ba=0;ba<Ni.length;++ba)if(Ni[ba]===xi){Ni[ba]=Ni[Ni.length-1],Ni.pop();return}}}}var Zi=H(ta,{clear:ya,prop:Do.define.bind(null,gp),context:Do.define.bind(null,id),this:Do.define.bind(null,im),draw:ta({}),buffer:function(Ln){return br.create(Ln,mp,!1,!1)},elements:function(Ln){return Jr.create(Ln,!1)},texture:qr.create2D,cube:qr.createCube,renderbuffer:lr.create,framebuffer:Vr.create,framebufferCube:Vr.createCube,vao:Wr.createVAO,attributes:At,frame:qo,on:as,limits:Zt,hasExtension:function(Ln){return Zt.extensions.indexOf(Ln.toLowerCase())>=0},read:Gn,destroy:_i,_gl:De,_refresh:Ra,poll:function(){os(),Pr&&Pr.update()},now:ai,stats:mr});return le.onDone(null,Zi),Zi}return _p})},48096:function(pr){(function(Gt,H){pr.exports=H()})(this,function(){"use strict";function Gt(xt,Pe,Ft,tt,Jt,wr){if(!(Jt-tt<=Ft)){var $=tt+Jt>>1;H(xt,Pe,$,tt,Jt,wr%2),Gt(xt,Pe,Ft,tt,$-1,wr+1),Gt(xt,Pe,Ft,$+1,Jt,wr+1)}}function H(xt,Pe,Ft,tt,Jt,wr){for(;Jt>tt;){if(Jt-tt>600){var $=Jt-tt+1,me=Ft-tt+1,W=Math.log($),he=.5*Math.exp(2*W/3),ae=.5*Math.sqrt(W*he*($-he)/$)*(me-$/2<0?-1:1),Me=Math.max(tt,Math.floor(Ft-me*he/$+ae)),je=Math.min(Jt,Math.floor(Ft+($-me)*he/$+ae));H(xt,Pe,Ft,Me,je,wr)}var ut=Pe[2*Ft+wr],St=tt,bt=Jt;for(ze(xt,Pe,tt,Ft),Pe[2*Jt+wr]>ut&&ze(xt,Pe,tt,Jt);St<bt;){for(ze(xt,Pe,St,bt),St++,bt--;Pe[2*St+wr]<ut;)St++;for(;Pe[2*bt+wr]>ut;)bt--}Pe[2*tt+wr]===ut?ze(xt,Pe,tt,bt):(bt++,ze(xt,Pe,bt,Jt)),bt<=Ft&&(tt=bt+1),Ft<=bt&&(Jt=bt-1)}}function ze(xt,Pe,Ft,tt){qe(xt,Ft,tt),qe(Pe,2*Ft,2*tt),qe(Pe,2*Ft+1,2*tt+1)}function qe(xt,Pe,Ft){var tt=xt[Pe];xt[Pe]=xt[Ft],xt[Ft]=tt}function v(xt,Pe,Ft,tt,Jt,wr,$){for(var me=[0,xt.length-1,0],W=[],he,ae;me.length;){var Me=me.pop(),je=me.pop(),ut=me.pop();if(je-ut<=$){for(var St=ut;St<=je;St++)he=Pe[2*St],ae=Pe[2*St+1],he>=Ft&&he<=Jt&&ae>=tt&&ae<=wr&&W.push(xt[St]);continue}var bt=Math.floor((ut+je)/2);he=Pe[2*bt],ae=Pe[2*bt+1],he>=Ft&&he<=Jt&&ae>=tt&&ae<=wr&&W.push(xt[bt]);var Lr=(Me+1)%2;(Me===0?Ft<=he:tt<=ae)&&(me.push(ut),me.push(bt-1),me.push(Lr)),(Me===0?Jt>=he:wr>=ae)&&(me.push(bt+1),me.push(je),me.push(Lr))}return W}function at(xt,Pe,Ft,tt,Jt,wr){for(var $=[0,xt.length-1,0],me=[],W=Jt*Jt;$.length;){var he=$.pop(),ae=$.pop(),Me=$.pop();if(ae-Me<=wr){for(var je=Me;je<=ae;je++)G(Pe[2*je],Pe[2*je+1],Ft,tt)<=W&&me.push(xt[je]);continue}var ut=Math.floor((Me+ae)/2),St=Pe[2*ut],bt=Pe[2*ut+1];G(St,bt,Ft,tt)<=W&&me.push(xt[ut]);var Lr=(he+1)%2;(he===0?Ft-Jt<=St:tt-Jt<=bt)&&($.push(Me),$.push(ut-1),$.push(Lr)),(he===0?Ft+Jt>=St:tt+Jt>=bt)&&($.push(ut+1),$.push(ae),$.push(Lr))}return me}function G(xt,Pe,Ft,tt){var Jt=xt-Ft,wr=Pe-tt;return Jt*Jt+wr*wr}var Je=function(xt){return xt[0]},Oe=function(xt){return xt[1]},yt=function(Pe,Ft,tt,Jt,wr){Ft===void 0&&(Ft=Je),tt===void 0&&(tt=Oe),Jt===void 0&&(Jt=64),wr===void 0&&(wr=Float64Array),this.nodeSize=Jt,this.points=Pe;for(var $=Pe.length<65536?Uint16Array:Uint32Array,me=this.ids=new $(Pe.length),W=this.coords=new wr(Pe.length*2),he=0;he<Pe.length;he++)me[he]=he,W[2*he]=Ft(Pe[he]),W[2*he+1]=tt(Pe[he]);Gt(me,W,Jt,0,me.length-1,0)};yt.prototype.range=function(Pe,Ft,tt,Jt){return v(this.ids,this.coords,Pe,Ft,tt,Jt,this.nodeSize)},yt.prototype.within=function(Pe,Ft,tt){return at(this.ids,this.coords,Pe,Ft,tt,this.nodeSize)};var Re={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(xt){return xt}},zt=Math.fround||function(xt){return function(Pe){return xt[0]=+Pe,xt[0]}}(new Float32Array(1)),ct=function(Pe){this.options=vn(Object.create(Re),Pe),this.trees=new Array(this.options.maxZoom+1)};ct.prototype.load=function(Pe){var Ft=this.options,tt=Ft.log,Jt=Ft.minZoom,wr=Ft.maxZoom,$=Ft.nodeSize;tt&&console.time("total time");var me="prepare "+Pe.length+" points";tt&&console.time(me),this.points=Pe;for(var W=[],he=0;he<Pe.length;he++)Pe[he].geometry&&W.push(qt(Pe[he],he));this.trees[wr+1]=new yt(W,ii,Yn,$,Float32Array),tt&&console.timeEnd(me);for(var ae=wr;ae>=Jt;ae--){var Me=+Date.now();W=this._cluster(W,ae),this.trees[ae]=new yt(W,ii,Yn,$,Float32Array),tt&&console.log("z%d: %d clusters in %dms",ae,W.length,+Date.now()-Me)}return tt&&console.timeEnd("total time"),this},ct.prototype.getClusters=function(Pe,Ft){var tt=((Pe[0]+180)%360+360)%360-180,Jt=Math.max(-90,Math.min(90,Pe[1])),wr=Pe[2]===180?180:((Pe[2]+180)%360+360)%360-180,$=Math.max(-90,Math.min(90,Pe[3]));if(Pe[2]-Pe[0]>=360)tt=-180,wr=180;else if(tt>wr){var me=this.getClusters([tt,Jt,180,$],Ft),W=this.getClusters([-180,Jt,wr,$],Ft);return me.concat(W)}for(var he=this.trees[this._limitZoom(Ft)],ae=he.range(or(tt),Sr($),or(wr),Sr(Jt)),Me=[],je=0,ut=ae;je<ut.length;je+=1){var St=ut[je],bt=he.points[St];Me.push(bt.numPoints?Yt(bt):this.points[bt.index])}return Me},ct.prototype.getChildren=function(Pe){var Ft=this._getOriginId(Pe),tt=this._getOriginZoom(Pe),Jt="No cluster with the specified id.",wr=this.trees[tt];if(!wr)throw new Error(Jt);var $=wr.points[Ft];if(!$)throw new Error(Jt);for(var me=this.options.radius/(this.options.extent*Math.pow(2,tt-1)),W=wr.within($.x,$.y,me),he=[],ae=0,Me=W;ae<Me.length;ae+=1){var je=Me[ae],ut=wr.points[je];ut.parentId===Pe&&he.push(ut.numPoints?Yt(ut):this.points[ut.index])}if(he.length===0)throw new Error(Jt);return he},ct.prototype.getLeaves=function(Pe,Ft,tt){Ft=Ft||10,tt=tt||0;var Jt=[];return this._appendLeaves(Jt,Pe,Ft,tt,0),Jt},ct.prototype.getTile=function(Pe,Ft,tt){var Jt=this.trees[this._limitZoom(Pe)],wr=Math.pow(2,Pe),$=this.options,me=$.extent,W=$.radius,he=W/me,ae=(tt-he)/wr,Me=(tt+1+he)/wr,je={features:[]};return this._addTileFeatures(Jt.range((Ft-he)/wr,ae,(Ft+1+he)/wr,Me),Jt.points,Ft,tt,wr,je),Ft===0&&this._addTileFeatures(Jt.range(1-he/wr,ae,1,Me),Jt.points,wr,tt,wr,je),Ft===wr-1&&this._addTileFeatures(Jt.range(0,ae,he/wr,Me),Jt.points,-1,tt,wr,je),je.features.length?je:null},ct.prototype.getClusterExpansionZoom=function(Pe){for(var Ft=this._getOriginZoom(Pe)-1;Ft<=this.options.maxZoom;){var tt=this.getChildren(Pe);if(Ft++,tt.length!==1)break;Pe=tt[0].properties.cluster_id}return Ft},ct.prototype._appendLeaves=function(Pe,Ft,tt,Jt,wr){for(var $=this.getChildren(Ft),me=0,W=$;me<W.length;me+=1){var he=W[me],ae=he.properties;if(ae&&ae.cluster?wr+ae.point_count<=Jt?wr+=ae.point_count:wr=this._appendLeaves(Pe,ae.cluster_id,tt,Jt,wr):wr<Jt?wr++:Pe.push(he),Pe.length===tt)break}return wr},ct.prototype._addTileFeatures=function(Pe,Ft,tt,Jt,wr,$){for(var me=0,W=Pe;me<W.length;me+=1){var he=W[me],ae=Ft[he],Me=ae.numPoints,je=void 0,ut=void 0,St=void 0;if(Me)je=ir(ae),ut=ae.x,St=ae.y;else{var bt=this.points[ae.index];je=bt.properties,ut=or(bt.geometry.coordinates[0]),St=Sr(bt.geometry.coordinates[1])}var Lr={type:1,geometry:[[Math.round(this.options.extent*(ut*wr-tt)),Math.round(this.options.extent*(St*wr-Jt))]],tags:je},Cr=void 0;Me?Cr=ae.id:this.options.generateId?Cr=ae.index:this.points[ae.index].id&&(Cr=this.points[ae.index].id),Cr!==void 0&&(Lr.id=Cr),$.features.push(Lr)}},ct.prototype._limitZoom=function(Pe){return Math.max(this.options.minZoom,Math.min(Math.floor(+Pe),this.options.maxZoom+1))},ct.prototype._cluster=function(Pe,Ft){for(var tt=[],Jt=this.options,wr=Jt.radius,$=Jt.extent,me=Jt.reduce,W=Jt.minPoints,he=wr/($*Math.pow(2,Ft)),ae=0;ae<Pe.length;ae++){var Me=Pe[ae];if(!(Me.zoom<=Ft)){Me.zoom=Ft;for(var je=this.trees[Ft+1],ut=je.within(Me.x,Me.y,he),St=Me.numPoints||1,bt=St,Lr=0,Cr=ut;Lr<Cr.length;Lr+=1){var On=Cr[Lr],Xr=je.points[On];Xr.zoom>Ft&&(bt+=Xr.numPoints||1)}if(bt>St&&bt>=W){for(var xn=Me.x*St,Yr=Me.y*St,rn=me&&St>1?this._map(Me,!0):null,Kr=(ae<<5)+(Ft+1)+this.points.length,Qn=0,Ur=ut;Qn<Ur.length;Qn+=1){var Mn=Ur[Qn],$r=je.points[Mn];if(!($r.zoom<=Ft)){$r.zoom=Ft;var un=$r.numPoints||1;xn+=$r.x*un,Yr+=$r.y*un,$r.parentId=Kr,me&&(rn||(rn=this._map(Me,!0)),me(rn,this._map($r)))}}Me.parentId=Kr,tt.push(st(xn/bt,Yr/bt,Kr,bt,rn))}else if(tt.push(Me),bt>1)for(var zi=0,gi=ut;zi<gi.length;zi+=1){var _o=gi[zi],Ii=je.points[_o];Ii.zoom<=Ft||(Ii.zoom=Ft,tt.push(Ii))}}}return tt},ct.prototype._getOriginId=function(Pe){return Pe-this.points.length>>5},ct.prototype._getOriginZoom=function(Pe){return(Pe-this.points.length)%32},ct.prototype._map=function(Pe,Ft){if(Pe.numPoints)return Ft?vn({},Pe.properties):Pe.properties;var tt=this.points[Pe.index].properties,Jt=this.options.map(tt);return Ft&&Jt===tt?vn({},Jt):Jt};function st(xt,Pe,Ft,tt,Jt){return{x:zt(xt),y:zt(Pe),zoom:1/0,id:Ft,parentId:-1,numPoints:tt,properties:Jt}}function qt(xt,Pe){var Ft=xt.geometry.coordinates,tt=Ft[0],Jt=Ft[1];return{x:zt(or(tt)),y:zt(Sr(Jt)),zoom:1/0,index:Pe,parentId:-1}}function Yt(xt){return{type:"Feature",id:xt.id,properties:ir(xt),geometry:{type:"Point",coordinates:[_r(xt.x),Gr(xt.y)]}}}function ir(xt){var Pe=xt.numPoints,Ft=Pe>=1e4?Math.round(Pe/1e3)+"k":Pe>=1e3?Math.round(Pe/100)/10+"k":Pe;return vn(vn({},xt.properties),{cluster:!0,cluster_id:xt.id,point_count:Pe,point_count_abbreviated:Ft})}function or(xt){return xt/360+.5}function Sr(xt){var Pe=Math.sin(xt*Math.PI/180),Ft=.5-.25*Math.log((1+Pe)/(1-Pe))/Math.PI;return Ft<0?0:Ft>1?1:Ft}function _r(xt){return(xt-.5)*360}function Gr(xt){var Pe=(180-xt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Pe))/Math.PI-90}function vn(xt,Pe){for(var Ft in Pe)xt[Ft]=Pe[Ft];return xt}function ii(xt){return xt.x}function Yn(xt){return xt.y}return ct})},92175:function(pr,Gt,H){"use strict";H.d(Gt,{Z:function(){return qe}});var ze=H(778);function qe(v,at){var G=typeof Symbol!="undefined"&&v[Symbol.iterator]||v["@@iterator"];if(!G){if(Array.isArray(v)||(G=(0,ze.Z)(v))||at&&v&&typeof v.length=="number"){G&&(v=G);var Je=0,Oe=function(){};return{s:Oe,n:function(){return Je>=v.length?{done:!0}:{done:!1,value:v[Je++]}},e:function(st){throw st},f:Oe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var yt,Re=!0,zt=!1;return{s:function(){G=G.call(v)},n:function(){var st=G.next();return Re=st.done,st},e:function(st){zt=!0,yt=st},f:function(){try{Re||G.return==null||G.return()}finally{if(zt)throw yt}}}}}}]);
}());