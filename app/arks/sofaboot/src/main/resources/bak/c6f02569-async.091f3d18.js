(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_open-semantic-graph"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_open-semantic-graph"]||[]).push([["c6f02569"],{c6f02569:function(e,t,n){n.d(t,"__esModule",{value:!0}),n.e(t,{SemanticTokensProviderStyling:function(){return g;},toMultilineTokens2:function(){return m;}}),n("0cba99d7");var i=n("dd8f73a0"),s=n("9bfcb0cf"),r=n("47118010"),a=n("e7e5ddb3"),h=n("17014ea9");class o{static create(e,t){return new o(e,new l(t));}get startLineNumber(){return this._startLineNumber;}get endLineNumber(){return this._endLineNumber;}constructor(e,t){this._startLineNumber=e,this._tokens=t,this._endLineNumber=this._startLineNumber+this._tokens.getMaxDeltaLine();}toString(){return this._tokens.toString(this._startLineNumber);}_updateEndLineNumber(){this._endLineNumber=this._startLineNumber+this._tokens.getMaxDeltaLine();}isEmpty(){return this._tokens.isEmpty();}getLineTokens(e){return this._startLineNumber<=e&&e<=this._endLineNumber?this._tokens.getLineTokens(e-this._startLineNumber):null;}getRange(){let e=this._tokens.getRange();return e?new a.Range(this._startLineNumber+e.startLineNumber,e.startColumn,this._startLineNumber+e.endLineNumber,e.endColumn):e;}removeTokens(e){let t=e.startLineNumber-this._startLineNumber,n=e.endLineNumber-this._startLineNumber;this._startLineNumber+=this._tokens.removeTokens(t,e.startColumn-1,n,e.endColumn-1),this._updateEndLineNumber();}split(e){let t=e.startLineNumber-this._startLineNumber,n=e.endLineNumber-this._startLineNumber,[i,s,r]=this._tokens.split(t,e.startColumn-1,n,e.endColumn-1);return[new o(this._startLineNumber,i),new o(this._startLineNumber+r,s)];}applyEdit(e,t){let[n,i,s]=(0,h.countEOL)(t);this.acceptEdit(e,n,i,s,t.length>0?t.charCodeAt(0):0);}acceptEdit(e,t,n,i,s){this._acceptDeleteRange(e),this._acceptInsertText(new r.Position(e.startLineNumber,e.startColumn),t,n,i,s),this._updateEndLineNumber();}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return;let t=e.startLineNumber-this._startLineNumber,n=e.endLineNumber-this._startLineNumber;if(n<0){let e=n-t;this._startLineNumber-=e;return;}let i=this._tokens.getMaxDeltaLine();if(!(t>=i+1)){if(t<0&&n>=i+1){this._startLineNumber=0,this._tokens.clear();return;}if(t<0){let i=-t;this._startLineNumber-=i,this._tokens.acceptDeleteRange(e.startColumn-1,0,0,n,e.endColumn-1);}else this._tokens.acceptDeleteRange(0,t,e.startColumn-1,n,e.endColumn-1);}}_acceptInsertText(e,t,n,i,s){if(0===t&&0===n)return;let r=e.lineNumber-this._startLineNumber;if(r<0){this._startLineNumber+=t;return;}r>=this._tokens.getMaxDeltaLine()+1||this._tokens.acceptInsertText(r,e.column-1,t,n,i,s);}}class l{constructor(e){this._tokens=e,this._tokenCount=e.length/4;}toString(e){let t=[];for(let n=0;n<this._tokenCount;n++)t.push(`(${this._getDeltaLine(n)+e},${this._getStartCharacter(n)}-${this._getEndCharacter(n)})`);return`[${t.join(",")}]`;}getMaxDeltaLine(){let e=this._getTokenCount();return 0===e?-1:this._getDeltaLine(e-1);}getRange(){let e=this._getTokenCount();if(0===e)return null;let t=this._getStartCharacter(0),n=this._getDeltaLine(e-1),i=this._getEndCharacter(e-1);return new a.Range(0,t+1,n,i+1);}_getTokenCount(){return this._tokenCount;}_getDeltaLine(e){return this._tokens[4*e];}_getStartCharacter(e){return this._tokens[4*e+1];}_getEndCharacter(e){return this._tokens[4*e+2];}isEmpty(){return 0===this._getTokenCount();}getLineTokens(e){let t=0,n=this._getTokenCount()-1;for(;t<n;){let i=t+Math.floor((n-t)/2),s=this._getDeltaLine(i);if(s<e)t=i+1;else if(s>e)n=i-1;else{let s=i;for(;s>t&&this._getDeltaLine(s-1)===e;)s--;let r=i;for(;r<n&&this._getDeltaLine(r+1)===e;)r++;return new u(this._tokens.subarray(4*s,4*r+4));}}return this._getDeltaLine(t)===e?new u(this._tokens.subarray(4*t,4*t+4)):null;}clear(){this._tokenCount=0;}removeTokens(e,t,n,i){let s=this._tokens,r=this._tokenCount,a=0,h=!1,o=0;for(let l=0;l<r;l++){let r=4*l,u=s[r],_=s[r+1],d=s[r+2],c=s[r+3];if((u>e||u===e&&d>=t)&&(u<n||u===n&&_<=i))h=!0;else{if(0===a&&(o=u),h){let e=4*a;s[e]=u-o,s[e+1]=_,s[e+2]=d,s[e+3]=c;}a++;}}return this._tokenCount=a,o;}split(e,t,n,i){let s=this._tokens,r=this._tokenCount,a=[],h=[],o=a,u=0,_=0;for(let a=0;a<r;a++){let r=4*a,l=s[r],d=s[r+1],c=s[r+2],g=s[r+3];if(l>e||l===e&&c>=t){if(l<n||l===n&&d<=i)continue;o!==h&&(o=h,u=0,_=l);}o[u++]=l-_,o[u++]=d,o[u++]=c,o[u++]=g;}return[new l(new Uint32Array(a)),new l(new Uint32Array(h)),_];}acceptDeleteRange(e,t,n,i,s){let r=this._tokens,a=this._tokenCount,h=i-t,o=0,l=!1;for(let u=0;u<a;u++){let _=4*u,d=r[_],c=r[_+1],g=r[_+2],m=r[_+3];if(d<t||d===t&&g<=n){o++;continue;}if(d===t&&c<n)d===i&&g>s?g-=s-n:g=n;else if(d===t&&c===n){if(d===i&&g>s)g-=s-n;else{l=!0;continue;}}else if(d<i||d===i&&c<s){if(d===i&&g>s)d=t,g=(c=n)+(g-s);else{l=!0;continue;}}else if(d>i){if(0===h&&!l){o=a;break;}d-=h;}else if(d===i&&c>=s)e&&0===d&&(c+=e,g+=e),d-=h,c-=s-n,g-=s-n;else throw Error("Not possible!");let f=4*o;r[f]=d,r[f+1]=c,r[f+2]=g,r[f+3]=m,o++;}this._tokenCount=o;}acceptInsertText(e,t,n,i,s,r){let a=0===n&&1===i&&(r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122),h=this._tokens,o=this._tokenCount;for(let r=0;r<o;r++){let o=4*r,l=h[o],u=h[o+1],_=h[o+2];if(!(l<e)&&(l!==e||!(_<t))){if(l===e&&_===t){if(!a)continue;_+=1;}else if(l===e&&u<t&&t<_)0===n?_+=i:_=t;else{if(l===e&&u===t&&a)continue;if(l===e){if(l+=n,0===n)u+=i,_+=i;else{let e=_-u;_=(u=s+(u-t))+e;}}else l+=n;}h[o]=l,h[o+1]=u,h[o+2]=_;}}}}class u{constructor(e){this._tokens=e;}getCount(){return this._tokens.length/4;}getStartCharacter(e){return this._tokens[4*e+1];}getEndCharacter(e){return this._tokens[4*e+2];}getMetadata(e){return this._tokens[4*e+3];}}var _=n("4dc1b036"),d=this&&this.__decorate||function(e,t,n,i){var s,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var h=e.length-1;h>=0;h--)(s=e[h])&&(a=(r<3?s(a):r>3?s(t,n,a):s(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a;},c=this&&this.__param||function(e,t){return function(n,i){t(n,i,e);};};let g=class{constructor(e,t,n,i){this._legend=e,this._themeService=t,this._languageService=n,this._logService=i,this._hasWarnedOverlappingTokens=!1,this._hasWarnedInvalidLengthTokens=!1,this._hasWarnedInvalidEditStart=!1,this._hashTable=new k;}getMetadata(e,t,n){let i;let s=this._languageService.languageIdCodec.encodeLanguageId(n),r=this._hashTable.get(e,t,s);if(r)i=r.metadata;else{let r=this._legend.tokenTypes[e],a=[];if(r){let e=t;for(let t=0;e>0&&t<this._legend.tokenModifiers.length;t++)1&e&&a.push(this._legend.tokenModifiers[t]),e>>=1;let s=this._themeService.getColorTheme().getTokenStyleMetadata(r,a,n);void 0===s?i=2147483647:(i=0,void 0!==s.italic&&(i|=1|(s.italic?1:0)<<11),void 0!==s.bold&&(i|=2|(s.bold?2:0)<<11),void 0!==s.underline&&(i|=4|(s.underline?4:0)<<11),void 0!==s.strikethrough&&(i|=8|(s.strikethrough?8:0)<<11),s.foreground&&(i|=16|s.foreground<<15),0===i&&(i=2147483647));}else i=2147483647,r="not-in-legend";this._hashTable.add(e,t,s,i);}return i;}warnOverlappingSemanticTokens(e,t){this._hasWarnedOverlappingTokens||(this._hasWarnedOverlappingTokens=!0,this._logService.warn(`Overlapping semantic tokens detected at lineNumber ${e}, column ${t}`));}warnInvalidLengthSemanticTokens(e,t){this._hasWarnedInvalidLengthTokens||(this._hasWarnedInvalidLengthTokens=!0,this._logService.warn(`Semantic token with invalid length detected at lineNumber ${e}, column ${t}`));}warnInvalidEditStart(e,t,n,i,s){this._hasWarnedInvalidEditStart||(this._hasWarnedInvalidEditStart=!0,this._logService.warn(`Invalid semantic tokens edit detected (previousResultId: ${e}, resultId: ${t}) at edit #${n}: The provided start offset ${i} is outside the previous data (length ${s}).`));}};function m(e,t,n){let i=e.data,s=e.data.length/5|0,r=Math.max(Math.ceil(s/1024),400),a=[],h=0,l=1,u=0;for(;h<s;){let e=h,_=Math.min(e+r,s);if(_<s){let t=_;for(;t-1>e&&0===i[5*t];)t--;if(t-1===e){let e=_;for(;e+1<s&&0===i[5*e];)e++;_=e;}else _=t;}let d=new Uint32Array((_-e)*4),c=0,g=0,m=0,f=0;for(;h<_;){let e=5*h,s=i[e],r=i[e+1],a=l+s|0,o=0===s?u+r|0:r,_=o+i[e+2]|0,k=i[e+3],L=i[e+4];if(_<=o)t.warnInvalidLengthSemanticTokens(a,o+1);else if(m===a&&f>o)t.warnOverlappingSemanticTokens(a,o+1);else{let e=t.getMetadata(k,L,n);2147483647!==e&&(0===g&&(g=a),d[c]=a-g,d[c+1]=o,d[c+2]=_,d[c+3]=e,c+=4,m=a,f=_);}l=a,u=o,h++;}c!==d.length&&(d=d.subarray(0,c));let k=o.create(g,d);a.push(k);}return a;}g=d([c(1,i.IThemeService),c(2,_.ILanguageService),c(3,s.ILogService)],g);class f{constructor(e,t,n,i){this.tokenTypeIndex=e,this.tokenModifierSet=t,this.languageId=n,this.metadata=i,this.next=null;}}class k{static #e=this._SIZES=[3,7,13,31,61,127,251,509,1021,2039,4093,8191,16381,32749,65521,131071,262139,524287,1048573,2097143];constructor(){this._elementsCount=0,this._currentLengthIndex=0,this._currentLength=k._SIZES[this._currentLengthIndex],this._growCount=Math.round(this._currentLengthIndex+1<k._SIZES.length?2/3*this._currentLength:0),this._elements=[],k._nullOutEntries(this._elements,this._currentLength);}static _nullOutEntries(e,t){for(let n=0;n<t;n++)e[n]=null;}_hash2(e,t){return(e<<5)-e+t|0;}_hashFunc(e,t,n){return this._hash2(this._hash2(e,t),n)%this._currentLength;}get(e,t,n){let i=this._hashFunc(e,t,n),s=this._elements[i];for(;s;){if(s.tokenTypeIndex===e&&s.tokenModifierSet===t&&s.languageId===n)return s;s=s.next;}return null;}add(e,t,n,i){if(this._elementsCount++,0!==this._growCount&&this._elementsCount>=this._growCount){let e=this._elements;for(let t of(this._currentLengthIndex++,this._currentLength=k._SIZES[this._currentLengthIndex],this._growCount=Math.round(this._currentLengthIndex+1<k._SIZES.length?2/3*this._currentLength:0),this._elements=[],k._nullOutEntries(this._elements,this._currentLength),e)){let e=t;for(;e;){let t=e.next;e.next=null,this._add(e),e=t;}}}this._add(new f(e,t,n,i));}_add(e){let t=this._hashFunc(e.tokenTypeIndex,e.tokenModifierSet,e.languageId);e.next=this._elements[t],this._elements[t]=e;}}}}]);
