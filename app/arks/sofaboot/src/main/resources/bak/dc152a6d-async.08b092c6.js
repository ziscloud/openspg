(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_open-semantic-graph"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_open-semantic-graph"]||[]).push([["dc152a6d"],{dc152a6d:function(e,t,n){n.d(t,"__esModule",{value:!0}),n.e(t,{MirrorModel:function(){return g;},STOP_SYNC_MODEL_DELTA_TIME_MS:function(){return _;},WorkerTextModelSyncClient:function(){return c;},WorkerTextModelSyncServer:function(){return m;}});var s=n("6cfd0562"),i=n("77b755a9"),l=n("f2d5d1a7"),r=n("47118010"),o=n("e7e5ddb3"),u=n("4af8c435"),h=n("246b9c8c"),d=n("3c19877b");class a{constructor(e,t,n,s){this._uri=e,this._lines=t,this._eol=n,this._versionId=s,this._lineStarts=null,this._cachedTextValue=null;}dispose(){this._lines.length=0;}get version(){return this._versionId;}getText(){return null===this._cachedTextValue&&(this._cachedTextValue=this._lines.join(this._eol)),this._cachedTextValue;}onEvents(e){for(let t of(e.eol&&e.eol!==this._eol&&(this._eol=e.eol,this._lineStarts=null),e.changes))this._acceptDeleteRange(t.range),this._acceptInsertText(new r.Position(t.range.startLineNumber,t.range.startColumn),t.text);this._versionId=e.versionId,this._cachedTextValue=null;}_ensureLineStarts(){if(!this._lineStarts){let e=this._eol.length,t=this._lines.length,n=new Uint32Array(t);for(let s=0;s<t;s++)n[s]=this._lines[s].length+e;this._lineStarts=new d.PrefixSumComputer(n);}}_setLineText(e,t){this._lines[e]=t,this._lineStarts&&this._lineStarts.setValue(e,this._lines[e].length+this._eol.length);}_acceptDeleteRange(e){if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.startLineNumber-1].substring(e.endColumn-1));return;}this._setLineText(e.startLineNumber-1,this._lines[e.startLineNumber-1].substring(0,e.startColumn-1)+this._lines[e.endLineNumber-1].substring(e.endColumn-1)),this._lines.splice(e.startLineNumber,e.endLineNumber-e.startLineNumber),this._lineStarts&&this._lineStarts.removeValues(e.startLineNumber,e.endLineNumber-e.startLineNumber);}_acceptInsertText(e,t){if(0===t.length)return;let n=(0,h.splitLines)(t);if(1===n.length){this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]+this._lines[e.lineNumber-1].substring(e.column-1));return;}n[n.length-1]+=this._lines[e.lineNumber-1].substring(e.column-1),this._setLineText(e.lineNumber-1,this._lines[e.lineNumber-1].substring(0,e.column-1)+n[0]);let s=new Uint32Array(n.length-1);for(let t=1;t<n.length;t++)this._lines.splice(e.lineNumber+t-1,0,n[t]),s[t-1]=n[t].length+this._eol.length;this._lineStarts&&this._lineStarts.insertValues(e.lineNumber,s);}}let _=6e4;class c extends i.Disposable{constructor(e,t,n=!1){if(super(),this._syncedModels=Object.create(null),this._syncedModelsLastUsedTime=Object.create(null),this._proxy=e,this._modelService=t,!n){let e=new s.IntervalTimer;e.cancelAndSet(()=>this._checkStopModelSync(),Math.round(_/2)),this._register(e);}}dispose(){for(let e in this._syncedModels)(0,i.dispose)(this._syncedModels[e]);this._syncedModels=Object.create(null),this._syncedModelsLastUsedTime=Object.create(null),super.dispose();}ensureSyncedResources(e,t=!1){for(let n of e){let e=n.toString();this._syncedModels[e]||this._beginModelSync(n,t),this._syncedModels[e]&&(this._syncedModelsLastUsedTime[e]=new Date().getTime());}}_checkStopModelSync(){let e=new Date().getTime(),t=[];for(let n in this._syncedModelsLastUsedTime)e-this._syncedModelsLastUsedTime[n]>_&&t.push(n);for(let e of t)this._stopModelSync(e);}_beginModelSync(e,t){let n=this._modelService.getModel(e);if(!n||!t&&n.isTooLargeForSyncing())return;let s=e.toString();this._proxy.$acceptNewModel({url:n.uri.toString(),lines:n.getLinesContent(),EOL:n.getEOL(),versionId:n.getVersionId()});let l=new i.DisposableStore;l.add(n.onDidChangeContent(e=>{this._proxy.$acceptModelChanged(s.toString(),e);})),l.add(n.onWillDispose(()=>{this._stopModelSync(s);})),l.add((0,i.toDisposable)(()=>{this._proxy.$acceptRemovedModel(s);})),this._syncedModels[s]=l;}_stopModelSync(e){let t=this._syncedModels[e];delete this._syncedModels[e],delete this._syncedModelsLastUsedTime[e],(0,i.dispose)(t);}}class m{constructor(){this._models=Object.create(null);}getModel(e){return this._models[e];}getModels(){let e=[];return Object.keys(this._models).forEach(t=>e.push(this._models[t])),e;}$acceptNewModel(e){this._models[e.url]=new g(l.URI.parse(e.url),e.lines,e.EOL,e.versionId);}$acceptModelChanged(e,t){this._models[e]&&this._models[e].onEvents(t);}$acceptRemovedModel(e){this._models[e]&&delete this._models[e];}}class g extends a{get uri(){return this._uri;}get eol(){return this._eol;}getValue(){return this.getText();}findMatches(e){let t=[];for(let n=0;n<this._lines.length;n++){let s=this._lines[n],i=this.offsetAt(new r.Position(n+1,1));for(let n of s.matchAll(e))(n.index||0===n.index)&&(n.index=n.index+i),t.push(n);}return t;}getLinesContent(){return this._lines.slice(0);}getLineCount(){return this._lines.length;}getLineContent(e){return this._lines[e-1];}getWordAtPosition(e,t){let n=(0,u.getWordAtText)(e.column,(0,u.ensureValidWordDefinition)(t),this._lines[e.lineNumber-1],0);return n?new o.Range(e.lineNumber,n.startColumn,e.lineNumber,n.endColumn):null;}words(e){let t=this._lines,n=this._wordenize.bind(this),s=0,i="",l=0,r=[];return{*[Symbol.iterator](){for(;;)if(l<r.length){let e=i.substring(r[l].start,r[l].end);l+=1,yield e;}else if(s<t.length)r=n(i=t[s],e),l=0,s+=1;else break;}};}getLineWords(e,t){let n=this._lines[e-1],s=this._wordenize(n,t),i=[];for(let e of s)i.push({word:n.substring(e.start,e.end),startColumn:e.start+1,endColumn:e.end+1});return i;}_wordenize(e,t){let n;let s=[];for(t.lastIndex=0;(n=t.exec(e))&&0!==n[0].length;)s.push({start:n.index,end:n.index+n[0].length});return s;}getValueInRange(e){if((e=this._validateRange(e)).startLineNumber===e.endLineNumber)return this._lines[e.startLineNumber-1].substring(e.startColumn-1,e.endColumn-1);let t=this._eol,n=e.startLineNumber-1,s=e.endLineNumber-1,i=[];i.push(this._lines[n].substring(e.startColumn-1));for(let e=n+1;e<s;e++)i.push(this._lines[e]);return i.push(this._lines[s].substring(0,e.endColumn-1)),i.join(t);}offsetAt(e){return e=this._validatePosition(e),this._ensureLineStarts(),this._lineStarts.getPrefixSum(e.lineNumber-2)+(e.column-1);}positionAt(e){e=Math.max(0,e=Math.floor(e)),this._ensureLineStarts();let t=this._lineStarts.getIndexOf(e),n=this._lines[t.index].length;return{lineNumber:1+t.index,column:1+Math.min(t.remainder,n)};}_validateRange(e){let t=this._validatePosition({lineNumber:e.startLineNumber,column:e.startColumn}),n=this._validatePosition({lineNumber:e.endLineNumber,column:e.endColumn});return t.lineNumber!==e.startLineNumber||t.column!==e.startColumn||n.lineNumber!==e.endLineNumber||n.column!==e.endColumn?{startLineNumber:t.lineNumber,startColumn:t.column,endLineNumber:n.lineNumber,endColumn:n.column}:e;}_validatePosition(e){if(!r.Position.isIPosition(e))throw Error("bad position");let{lineNumber:t,column:n}=e,s=!1;if(t<1)t=1,n=1,s=!0;else if(t>this._lines.length)t=this._lines.length,n=this._lines[t-1].length+1,s=!0;else{let e=this._lines[t-1].length+1;n<1?(n=1,s=!0):n>e&&(n=e,s=!0);}return s?{lineNumber:t,column:n}:e;}}}}]);
